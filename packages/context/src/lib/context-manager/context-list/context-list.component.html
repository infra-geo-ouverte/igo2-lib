<igo-list [navigation]="true">
  <mat-form-field *ngIf="showFilter()" [ngClass]="auth.authenticated ? 'context-filter-min-width' : 'context-filter-max-width'">
    <input
      matInput
      type="text"
      [placeholder]="'igo.context.contextManager.filterPlaceHolder' | translate"
      [(ngModel)]="term">
    <button
      mat-button
      mat-icon-button
      matSuffix
      class="clear-button"
      *ngIf="term.length"
      aria-label="Clear"
      color="warn"
      (click)="clearFilter()">
      <mat-icon svgIcon="close"></mat-icon>
    </button>
  </mat-form-field>

  <button
  *ngIf="!sortedAlpha"
  mat-icon-button
  [matTooltip]="'igo.context.contextManager.sortAlphabetically' | translate"
  matTooltipShowDelay="500"
  (click)="toggleSort(true)">
  <mat-icon color="primary" svgIcon="sort-alphabetical"></mat-icon>
  </button>
  <button
    *ngIf="sortedAlpha"
    mat-icon-button
    [matTooltip]="'igo.context.contextManager.sortContextOrder' | translate"
    matTooltipShowDelay="500"
    (click)="toggleSort(false)">
    <mat-icon color="warn" svgIcon="sort-variant-remove"></mat-icon>
  </button>

  <button *ngIf="auth.authenticated"
    mat-icon-button
    [matTooltip]="'igo.context.bookmarkButton.create' | translate"
    matTooltipShowDelay="500"
    (click)="createContext()">
    <mat-icon color="primary" svgIcon="star"></mat-icon>
  </button>

  <!-- <button *ngIf="authenticated"
    mat-icon-button
    [matTooltip]="'igo.context.contextManager.userAccount' | translate"
    matTooltipShowDelay="500"
    [matMenuTriggerFor]="accountMenu">
    <mat-icon color="primary" svgIcon="account"></mat-icon>
  </button>
  <mat-menu #accountMenu="matMenu">
    <ng-container *ngFor="let user of users">
      <mat-checkbox
        class="mat-menu-item"
        [checked]="true"
        (change)="userSelection()">
        {{user}}
      </mat-checkbox>
    </ng-container>
  </mat-menu> -->

  <ng-template ngFor let-groupContexts [ngForOf]="contexts$ | async | keyvalue">

    <igo-collapsible *ngIf="groupContexts.value.length && auth.authenticated" [title]="titleMapping[groupContexts.key] | translate">

      <ng-template ngFor let-context [ngForOf]="groupContexts.value">
        <igo-context-item
          igoListItem
          color="accent"
          [selected]="selectedContext && selectedContext.uri === context.uri"
          [context]="context"
          [default]="context.id && this.defaultContextId && this.defaultContextId === context.id"
          (edit)="edit.emit(context)"
          (delete)="delete.emit(context)"
          (clone)="clone.emit(context)"
          (save)="save.emit(context)"
          (favorite)="favorite.emit(context)"
          (manageTools)="manageTools.emit(context)"
          (managePermissions)="managePermissions.emit(context)"
          (select)="select.emit(context)"
          (unselect)="unselect.emit(context)">
        </igo-context-item>
      </ng-template>

    </igo-collapsible>

    <ng-template *ngIf="groupContexts.value.length && !auth.authenticated" ngFor let-context [ngForOf]="groupContexts.value">
      <igo-context-item
        igoListItem
        color="accent"
        [selected]="selectedContext && selectedContext.uri === context.uri"
        [context]="context"
        [default]="this.defaultContextId === context.id"
        (select)="select.emit(context)"
        (unselect)="unselect.emit(context)">
      </igo-context-item>
    </ng-template>

  </ng-template>
</igo-list>
