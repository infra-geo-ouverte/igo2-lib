<mat-list-item>
  @if (haveGroup()) {
    <mat-icon class="catalog-browser-layer-carret" matListItemIcon></mat-icon>
  }
  <span
    matListItemTitle
    matTooltipShowDelay="500"
    [ngClass]="catalogAllowLegend ? 'igo-cataloglayer-title' : ''"
    (click)="askForLegend()"
    [matTooltip]="computeTitleTooltip()"
  >
    {{ title }}
  </span>

  <div matListItemMeta>
    @if (layer.externalProvider) {
      <button disabled="true" mat-icon-button>
        <mat-icon
          class="igo-cataloglayer-external-icon"
          tooltip-position="below"
          matTooltipShowDelay="500"
          [matTooltip]="'igo.geo.catalog.externalProvider.layer' | translate"
          color="primary"
          (click)="$event.stopPropagation()"
        >
          public
        </mat-icon>
      </button>
    }
    <igo-metadata-button [layer]="$any(layer)"></igo-metadata-button>

    <button
      (mouseenter)="onMouseEvent($event)"
      (mouseleave)="onMouseEvent($event)"
      mat-icon-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="computeTooltip() | translate"
      [color]="(isPreview$ | async) ? '' : added ? 'warn' : ''"
      (click)="onToggleClick($event)"
    >
      <mat-icon
        aria-hidden="false"
        matBadge="icon"
        [igoMatBadgeIcon]="getBadgeIcon()"
        igoMatBadgeColor="rgba(0,0,0,0.87)"
        igoMatBadgeBackgroundColor="none"
        [igoMatBadgeInverseColor]="true"
        [matBadgeHidden]="
          ((inRange$ | async) && (isVisible$ | async) === true) ||
          ((inRange$ | async) && !added) ||
          ((inRange$ | async) && (isPreview$ | async))
        "
        [matBadgeDisabled]="(inRange$ | async) === false"
        matBadgeSize="small"
        matBadgePosition="after"
      >
        {{ (isPreview$ | async) ? 'preview' : added ? 'delete' : 'add' }}
      </mat-icon>
    </button>
  </div>
</mat-list-item>

<div #legend class="igo-cataloglayer-legend-container">
  @if (
    (layerLegendShown$ | async) && (igoLayer$ | async) && catalogAllowLegend
  ) {
    <igo-layer-legend [layer]="igoLayer$ | async"> </igo-layer-legend>
  }
</div>
