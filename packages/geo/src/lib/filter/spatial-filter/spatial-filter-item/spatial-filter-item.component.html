<igo-geometry-form-field-input
  [formControl]="formControl"
  [map]="map"
  [geometryType]="geometryType"
  [drawGuide]="drawGuide$ | async"
  [measure]="measure"
  [drawStyle]="drawStyle$ | async"
  [overlayStyle]="overlayStyle$ | async">
</igo-geometry-form-field-input>

<div class="header">
  <mat-label class="title">{{'igo.geo.spatialFilter.search' | translate}} : </mat-label>
  <mat-radio-group [value]="selectedItemType">
      <mat-radio-button *ngFor="let item of itemType"
        [value]="item"
        (change)="onItemTypeChange($event)">
        {{'igo.geo.spatialFilter.' + item | translate}}
      </mat-radio-button>
  </mat-radio-group>
</div>

<mat-table class="thematics-list" *ngIf="selectedItemType==='Thematics'"
  [dataSource]="thematicsList">

  <!-- Name Column -->
  <ng-container matColumnDef="name">
    <mat-header-cell *matHeaderCellDef>{{'igo.geo.spatialFilter.layer' | translate}}</mat-header-cell>
    <mat-cell *matCellDef="let thematic"> {{thematic}} </mat-cell>
  </ng-container>

  <!-- Select Column -->
  <ng-container matColumnDef="select">
    <mat-header-cell *matHeaderCellDef>
      <mat-checkbox (change)="$event ? masterToggle() : null"
                    [checked]="selectedThematics.hasValue() && isAllSelected()"
                    [indeterminate]="selectedThematics.hasValue() && !isAllSelected()">
      </mat-checkbox>
    </mat-header-cell>
    <mat-cell *matCellDef="let row">
      <mat-checkbox (click)="$event.stopPropagation()"
                    (change)="$event ? onToggleChange(row) : null"
                    [checked]="selectedThematics.isSelected(row)">
      </mat-checkbox>
    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
  <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
</mat-table>

<div class="radius-unit" *ngIf="isPoint()">
  <form class="radius-form">
    <mat-form-field class="radius">
      <input type="number" matInput placeholder="{{'igo.geo.spatialFilter.radius' | translate}}" [formControl]="radiusFormControl" [value]="1000"
      (input)="getRadius($event)">
    </mat-form-field>
  </form>

  <mat-form-field class="unit-field">
    <mat-select
      [value]="measureUnit"
      (selectionChange)="onMeasureUnitChange($event.value)">
      <mat-option *ngFor="let measureUnit of measureUnits" [value]="measureUnit">
        {{('igo.geo.measure.' + measureUnit) | translate}}
      </mat-option>
    </mat-select>
  </mat-form-field>
</div>

<div class="buttons">

  <button *ngIf="selectedSourceAddress || selectedThematics" mat-raised-button class="remove-button" (click)="clearButton()">
    {{'igo.geo.spatialFilter.removeLayer' | translate}}
  </button>

  <button *ngIf="isPolygon() || isPoint()" mat-raised-button class="clear-form-button" (click)="formControl.reset()">
    {{'igo.geo.spatialFilter.clearForm' | translate}}
  </button>

  <button *ngIf="isPredefined()" mat-raised-button class="clear-search-button" (click)="clearSearch()">
    {{'igo.geo.spatialFilter.clearSearch' | translate}}
  </button>

  <button mat-raised-button class="search-button" [disabled]="disableSearchButton()"
  (click)="toggleSearchButton()">
    {{'igo.geo.spatialFilter.goSearch' | translate}}
  </button>

</div>

<div class="results" *ngIf="store">
  <mat-table class="results-list" [dataSource]="store.entities$.value">

    <!-- Type Column -->
    <ng-container matColumnDef="typeResults">
        <mat-header-cell *matHeaderCellDef>{{'igo.geo.spatialFilter.type' | translate}}</mat-header-cell>
        <mat-cell *matCellDef="let result"> {{result.meta.title}} </mat-cell>
      </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="nameResults">
      <mat-header-cell *matHeaderCellDef>{{'igo.geo.spatialFilter.searchResults' | translate}}</mat-header-cell>
      <mat-cell *matCellDef="let result"> {{result.properties.nom}} </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumnsResults"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumnsResults;"></mat-row>
  </mat-table>
</div>