<igo-list #igoList [ngClass]="(layerTool || selection) ? 'igo-list-min-height': 'igo-list-max-height'" [navigation]="false" [selection]="false">
  <igo-layer-list-tool *ngIf="showToolbar$ | async"
      floatLabel="auto"
      [layersAreAllVisible]="layersAreAllVisible"
      [term]="layerFilterAndSortOptions.keyword"
      [onlyVisible]="layerFilterAndSortOptions.onlyVisible"
      [sortAlpha]="layerFilterAndSortOptions.sortAlpha"
      (appliedFilterAndSort)="onAppliedFilterAndSortChange($event)"
      (selection)="toggleSelectionMode($event)">
    </igo-layer-list-tool>

  <ng-template ngFor let-layer let-i="index" [ngForOf]="layers$ | async">
    <igo-layer-item *ngIf="!(excludeBaseLayers && layer.baseLayer)"
        igoListItem
        [layer]="layer"
        [activeLayer]="activeLayer"
        [orderable]="orderable && !layer.baseLayer"
        [lowerDisabled]="getLowerLayer().id === layer.id"
        [raiseDisabled]="getUpperLayer().id === layer.id"
        [queryBadge]="queryBadge"
        [expandLegendIfVisible]="expandLegendOfVisibleLayers"
        [updateLegendOnResolutionChange]="updateLegendOnResolutionChange"
        [toggleLegendOnVisibilityChange]="toggleLegendOnVisibilityChange"
        [selectionMode]="selection"
        [selectAll]="selectAllCheck"
        (action)="toggleLayerTool($event)"
        (checkbox)="layersCheck($event)">
    </igo-layer-item>
  </ng-template>
</igo-list>

<igo-panel *ngIf="layerTool && activeLayer" class="igo-layer-actions-container" [title]="activeLayer.title">
  <div class="igo-layer-button-group">
  <ng-container igoLayerItemToolbar
    [ngTemplateOutlet]="templateLayerToolbar"
    [ngTemplateOutletContext]="{layer: activeLayer}">
  </ng-container>

  <ng-content select="[igoLayerItemToolbar]"></ng-content>
    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->
    <button
      color="primary"
      mat-icon-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matMenuTriggerFor]="opacityMenu"
      [matTooltip]="'igo.geo.layer.opacity' | translate">
      <mat-icon [matBadge]="badgeOpacity" matBadgeColor="primary" matBadgeSize="medium" svgIcon="opacity"></mat-icon>
    </button>

    <mat-menu #opacityMenu="matMenu">
      <div id="opacity-menu">
        <mat-slider
          id="opacity-slider"
          color="primary"
          thumbLabel
          tickInterval="5"
          step="5"
          [min]="0"
          [max]="100"
          [(ngModel)]="opacity"
          [matTooltip]="'igo.geo.layer.opacity' | translate"
          matTooltipShowDelay="500"
          tooltip-position="below">
        </mat-slider>
      </div>
    </mat-menu>

    <button
      color="primary"
      mat-icon-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="(sortAlpha || onlyVisible) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)"
      [disabled]="!orderable || activeLayer.baseLayer || getUpperLayer().id === activeLayer.id"
      (click)="activeLayer.map.raiseLayer(activeLayer)">
      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? '!' : ''" matBadgeColor="warn" matBadgeSize="medium" svgIcon="arrow-up"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="primary"
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="(sortAlpha || onlyVisible) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)"
      [disabled]="!orderable || activeLayer.baseLayer || getLowerLayer().id === activeLayer.id"
      (click)="activeLayer.map.lowerLayer(activeLayer)">
      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? '!' : ''" matBadgeColor="warn" matBadgeSize="medium" svgIcon="arrow-down"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="warn"
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="'igo.geo.layer.removeLayer' | translate"
      (click)="removeLayers()">
      <mat-icon svgIcon="delete"></mat-icon>
    </button>
  </div>
</igo-panel>

<igo-panel *ngIf="selection && layers.length > 0" class="igo-layer-actions-container" [title]="'igo.geo.layer.tools' | translate">
  <div class="igo-layer-button-group">

    <button
      mat-stroked-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [disabled]="layers.length === 0"
      [matTooltip]="selectAllCheck ?
                    ('igo.geo.layer.deselectAll' | translate) :
                    ('igo.geo.layer.selectAll' | translate)"
      (click)="selectAll()">
      {{selectAllCheck ? ('igo.geo.layer.deselectAll' | translate) :
                    ('igo.geo.layer.selectAll' | translate)}}
    </button>

    <!-- <label>{{ 'igo.geo.layer.opacity' | translate }} </label> -->
    <button
      color="primary"
      mat-icon-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [disabled]="layersChecked.length === 0"
      [matMenuTriggerFor]="opacityMenu"
      [matTooltip]="'igo.geo.layer.opacity' | translate">
      <mat-icon svgIcon="opacity"></mat-icon>
    </button>

    <mat-menu #opacityMenu="matMenu">
      <div id="opacity-menu">
        <mat-slider *ngIf="layersChecked.length"
          id="opacity-slider"
          color="primary"
          thumbLabel
          tickInterval="5"
          step="5"
          [min]="0"
          [max]="100"
          [(ngModel)]="checkOpacity"
          [matTooltip]="'igo.geo.layer.opacity' | translate"
          matTooltipShowDelay="500"
          tooltip-position="below">
        </mat-slider>
      </div>
    </mat-menu>

    <button
      color="primary"
      mat-icon-button
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="(sortAlpha || onlyVisible) ? ('igo.geo.layer.filterRaiseLayer' | translate) : ('igo.geo.layer.raiseLayer' | translate)"
      [disabled]="layersChecked.length === 0 || !orderable || !raisableLayers(layersChecked) || selectAllCheck === true"
      (click)="map.raiseLayers(layersChecked)">
      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? '!' : ''" matBadgeColor="warn" matBadgeSize="medium" svgIcon="arrow-up"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="primary"
      tooltip-position="below"
      matTooltipShowDelay="500"
      [matTooltip]="(sortAlpha || onlyVisible) ? ('igo.geo.layer.filterLowerLayer' | translate) : ('igo.geo.layer.lowerLayer' | translate)"
      [disabled]="layersChecked.length === 0 || !orderable || !lowerableLayers(layersChecked) || selectAllCheck === true"
      (click)="lowerLayers(layersChecked)">
      <mat-icon [matBadge]="(sortAlpha || onlyVisible || keyword) ? '!' : ''" matBadgeColor="warn" matBadgeSize="medium" svgIcon="arrow-down"></mat-icon>
    </button>

    <button
      mat-icon-button
      color="warn"
      tooltip-position="below"
      matTooltipShowDelay="500"
      [disabled]="layersChecked.length === 0"
      [matTooltip]="'igo.geo.layer.removeLayer' | translate"
      (click)="removeLayers(layersChecked)">
      <mat-icon svgIcon="delete"></mat-icon>
    </button>
  </div>
</igo-panel>
