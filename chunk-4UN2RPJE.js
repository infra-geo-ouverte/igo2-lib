import{a as PG}from"./chunk-2TSORJS7.js";import{f as mG,h as fG,n as gm,p as Kr,r as IG,s as Gn,t as KF,u as Ph,v as O1,x as n9}from"./chunk-LEXDMZQM.js";import{$ as YG,A as uo,Aa as id,B as UA,Ba as pl,C as ho,Ca as Zc,D as OG,Da as V1,E as DG,Ea as J_,F as RG,G as NG,Ga as eP,H as kh,Ha as vm,I as Su,Ia as bm,J as Oh,Ja as wm,K as ac,Ka as Ix,L as hl,M as JF,Ma as o9,N as GG,Na as a9,O as jG,P as VG,Pa as s9,Q as UG,R as zG,Ra as h0,V as $G,X as WG,Y as HG,Z as qG,a as Ta,aa as ZG,b as rG,ba as XG,c as Ju,ca as KG,da as QG,e as oc,ea as JG,f as RA,fa as e9,g as ks,ga as zA,ha as $A,i as Io,j as D1,ja as Wc,k as GA,l as R1,la as B1,m as xu,ma as t9,na as G1,o as QF,oa as j1,p as jA,pa as ym,q as ed,qa as i9,r as LG,ra as r9,s as d0,t as VA,u as Lh,v as N1,w as td,wa as Hc,x as Mx,xa as qc,y as _m,ya as Yc,z as kG,za as WA}from"./chunk-XOFOAZN4.js";import{$ as Xn,$a as ll,$b as E7,$c as D7,$d as ci,$e as xx,$f as Ax,Aa as a0,Ab as We,Ac as WF,Af as cG,Ag as BA,B as mp,Ba as Df,Bb as mm,Bc as cl,Bd as $7,Bg as BG,C as jo,Ca as jd,Cc as EA,Cd as P1,Cg as Cn,D as dm,Db as ve,Dc as Ei,Dg as gn,E as xA,Ea as Ke,Ec as P7,Ed as W7,Ef as uG,F as Fs,Fa as tc,Fb as ne,Fc as E1,Fd as kA,Fe as J7,Ff as dG,G as SA,Gb as Kn,Gd as H7,Gf as hG,H as Sh,Ha as ar,Hb as Tn,Hc as Wu,He as $t,Hf as pG,I as qr,Ia as MA,Ib as sr,Ic as L7,Id as qF,Ie as jt,J as UF,Ja as Ah,Jb as Do,Jc as vx,Je as Uc,Jf as ti,K as qs,Kb as Ir,Kc as fs,Kd as wx,Ke as dl,Kf as Qt,L as o0,La as hm,Lb as bi,Ld as fm,Le as ZF,M as Br,Ma as Rf,Mb as wi,Mc as Er,Md as L1,Me as eG,Mf as Fh,Na as S7,Nb as Xt,Nc as k7,Nd as q7,Nf as gG,O as Ol,Ob as _e,Of as Cx,Pa as hx,Pb as bt,Pf as _G,Q as y7,Qa as X_,Qb as Qe,Qe as Eh,R as $u,Ra as j,Rb as Nf,Rc as Bf,Rd as Y7,Rf as yG,S as v7,Sa as Ie,Sb as I7,Sc as Q_,Se as Yu,Sf as vG,T as Ps,Tb as Qn,Tc as TA,Td as Nn,Te as os,Ua as gp,Ub as Jn,Ue as DA,Uf as bG,Va as C7,Vb as eo,Vc as bx,Ve as Fn,Vf as wG,W as b7,Wb as Xi,Wc as O7,Wd as Bn,We as tG,Wf as xG,Xa as s0,Xb as lt,Xc as FA,Xd as Z7,Xe as kn,Xf as XF,Y as Of,Ya as Mh,Yb as Ih,Yc as T1,Yd as X7,Ye as Zu,Yf as SG,Z as Ch,Zb as fn,Zc as HF,Zd as co,Zf as CG,_ as ec,_a as K_,_b as Ys,_f as rr,a as Es,aa as Vo,ac as le,ad as l0,ae as Vt,af as zc,ag as k1,ba as bu,bb as $n,bc as ce,be as K7,bf as nc,c as $r,cc as Ao,cd as R7,cf as Xu,cg as AG,da as Dl,dc as Ac,df as c0,dg as MG,ea as qt,eb as Pe,ee as Gf,ef as Th,eg as rn,f as Si,fa as gr,fe as Hu,ff as Ku,fg as dn,g as ut,gb as M1,gf as Qu,gg as u0,h as g7,ha as Ln,hb as Or,hc as $F,ib as z,ie as Ls,if as iG,ig as Oi,j as BF,ja as pt,jb as fo,jc as I1,jd as N7,je as Ud,k as _7,ka as ga,kb as dr,ke as YF,kg as Tt,l as Gd,lb as pm,lc as T7,ld as PA,le as qu,lg as Et,m as Hs,mb as Vd,mc as lr,md as B7,mf as $c,mg as Di,n as Xr,na as nt,nb as px,nc as gx,nd as G7,nf as Sn,o as GF,oa as _r,ob as A7,oc as Vi,of as Sa,p as Gc,pa as Fi,pb as jc,pc as Uo,pd as j7,pf as nG,q as ai,qa as CA,qb as M7,qc as F7,qd as V7,qf as oG,r as A1,ra as w7,rb as zF,rc as IA,rd as U7,re as Mo,rf as Sx,rg as Nl,s as jF,sb as mx,sc as rc,se as Q7,ta as AA,tb as fx,td as F1,te as OA,tg as EG,u as dx,ub as $,ud as z7,ue as Vc,uf as aG,ug as TG,v as Nt,va as wu,vb as ee,vc as _a,vd as LA,vf as sG,w as Ts,wa as we,wb as ct,wc as Li,wd as Rl,x as kf,xa as xe,xb as Dr,xc as Gt,xf as lG,xg as FG,ya as fp,yb as Rr,yc as _x,ye as Gr,yf as NA,z as VF,za as x7,zb as ic,zc as yx,zd as ul,ze as jr}from"./chunk-J6VW2V73.js";import{a as ur,b as En,c as ux,e as Bd,f as m7,g as Jl,i as un,j as NF,k as f7}from"./chunk-P3CCBVUA.js";var cP=Bd((g9,lP)=>{(function(r){typeof g9=="object"&&typeof lP<"u"?lP.exports=r():typeof define=="function"&&define.amd?define([],r):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=r()})(function(){return function r(i,e,n){function o(h,p){if(!e[h]){if(!i[h]){var m=typeof ux=="function"&&ux;if(!p&&m)return m(h,!0);if(s)return s(h,!0);var f=new Error("Cannot find module '"+h+"'");throw f.code="MODULE_NOT_FOUND",f}var g=e[h]={exports:{}};i[h][0].call(g.exports,function(y){var _=i[h][1][y];return o(_||y)},g,g.exports,r,i,e,n)}return e[h].exports}for(var s=typeof ux=="function"&&ux,l=0;l<n.length;l++)o(n[l]);return o}({1:[function(r,i,e){"use strict";var n=r("./utils"),o=r("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(l){for(var h,p,m,f,g,y,_,w=[],A=0,k=l.length,R=k,q=n.getTypeOf(l)!=="string";A<l.length;)R=k-A,m=q?(h=l[A++],p=A<k?l[A++]:0,A<k?l[A++]:0):(h=l.charCodeAt(A++),p=A<k?l.charCodeAt(A++):0,A<k?l.charCodeAt(A++):0),f=h>>2,g=(3&h)<<4|p>>4,y=1<R?(15&p)<<2|m>>6:64,_=2<R?63&m:64,w.push(s.charAt(f)+s.charAt(g)+s.charAt(y)+s.charAt(_));return w.join("")},e.decode=function(l){var h,p,m,f,g,y,_=0,w=0,A="data:";if(l.substr(0,A.length)===A)throw new Error("Invalid base64 input, it looks like a data url.");var k,R=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===s.charAt(64)&&R--,l.charAt(l.length-2)===s.charAt(64)&&R--,R%1!=0)throw new Error("Invalid base64 input, bad content length.");for(k=o.uint8array?new Uint8Array(0|R):new Array(0|R);_<l.length;)h=s.indexOf(l.charAt(_++))<<2|(f=s.indexOf(l.charAt(_++)))>>4,p=(15&f)<<4|(g=s.indexOf(l.charAt(_++)))>>2,m=(3&g)<<6|(y=s.indexOf(l.charAt(_++))),k[w++]=h,g!==64&&(k[w++]=p),y!==64&&(k[w++]=m);return k}},{"./support":30,"./utils":32}],2:[function(r,i,e){"use strict";var n=r("./external"),o=r("./stream/DataWorker"),s=r("./stream/Crc32Probe"),l=r("./stream/DataLengthProbe");function h(p,m,f,g,y){this.compressedSize=p,this.uncompressedSize=m,this.crc32=f,this.compression=g,this.compressedContent=y}h.prototype={getContentWorker:function(){var p=new o(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),m=this;return p.on("end",function(){if(this.streamInfo.data_length!==m.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new o(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(p,m,f){return p.pipe(new s).pipe(new l("uncompressedSize")).pipe(m.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",m)},i.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,i,e){"use strict";var n=r("./stream/GenericWorker");e.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},e.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,i,e){"use strict";var n=r("./utils"),o=function(){for(var s,l=[],h=0;h<256;h++){s=h;for(var p=0;p<8;p++)s=1&s?3988292384^s>>>1:s>>>1;l[h]=s}return l}();i.exports=function(s,l){return s!==void 0&&s.length?n.getTypeOf(s)!=="string"?function(h,p,m,f){var g=o,y=f+m;h^=-1;for(var _=f;_<y;_++)h=h>>>8^g[255&(h^p[_])];return-1^h}(0|l,s,s.length,0):function(h,p,m,f){var g=o,y=f+m;h^=-1;for(var _=f;_<y;_++)h=h>>>8^g[255&(h^p.charCodeAt(_))];return-1^h}(0|l,s,s.length,0):0}},{"./utils":32}],5:[function(r,i,e){"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},{}],6:[function(r,i,e){"use strict";var n=null;n=typeof Promise<"u"?Promise:r("lie"),i.exports={Promise:n}},{lie:37}],7:[function(r,i,e){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=r("pako"),s=r("./utils"),l=r("./stream/GenericWorker"),h=n?"uint8array":"array";function p(m,f){l.call(this,"FlateWorker/"+m),this._pako=null,this._pakoAction=m,this._pakoOptions=f,this.meta={}}e.magic="\b\0",s.inherits(p,l),p.prototype.processChunk=function(m){this.meta=m.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(h,m.data),!1)},p.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var m=this;this._pako.onData=function(f){m.push({data:f,meta:m.meta})}},e.compressWorker=function(m){return new p("Deflate",m)},e.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,i,e){"use strict";function n(g,y){var _,w="";for(_=0;_<y;_++)w+=String.fromCharCode(255&g),g>>>=8;return w}function o(g,y,_,w,A,k){var R,q,X=g.file,ie=g.compression,ae=k!==h.utf8encode,be=s.transformTo("string",k(X.name)),me=s.transformTo("string",h.utf8encode(X.name)),fe=X.comment,ge=s.transformTo("string",k(fe)),ue=s.transformTo("string",h.utf8encode(fe)),se=me.length!==X.name.length,te=ue.length!==fe.length,Se="",Te="",Ee="",je=X.dir,Ne=X.date,ze={crc32:0,compressedSize:0,uncompressedSize:0};y&&!_||(ze.crc32=g.crc32,ze.compressedSize=g.compressedSize,ze.uncompressedSize=g.uncompressedSize);var Re=0;y&&(Re|=8),ae||!se&&!te||(Re|=2048);var Ge=0,He=0;je&&(Ge|=16),A==="UNIX"?(He=798,Ge|=function(Ae,Le){var Ye=Ae;return Ae||(Ye=Le?16893:33204),(65535&Ye)<<16}(X.unixPermissions,je)):(He=20,Ge|=function(Ae){return 63&(Ae||0)}(X.dosPermissions)),R=Ne.getUTCHours(),R<<=6,R|=Ne.getUTCMinutes(),R<<=5,R|=Ne.getUTCSeconds()/2,q=Ne.getUTCFullYear()-1980,q<<=4,q|=Ne.getUTCMonth()+1,q<<=5,q|=Ne.getUTCDate(),se&&(Te=n(1,1)+n(p(be),4)+me,Se+="up"+n(Te.length,2)+Te),te&&(Ee=n(1,1)+n(p(ge),4)+ue,Se+="uc"+n(Ee.length,2)+Ee);var ye="";return ye+=`
\0`,ye+=n(Re,2),ye+=ie.magic,ye+=n(R,2),ye+=n(q,2),ye+=n(ze.crc32,4),ye+=n(ze.compressedSize,4),ye+=n(ze.uncompressedSize,4),ye+=n(be.length,2),ye+=n(Se.length,2),{fileRecord:m.LOCAL_FILE_HEADER+ye+be+Se,dirRecord:m.CENTRAL_FILE_HEADER+n(He,2)+ye+n(ge.length,2)+"\0\0\0\0"+n(Ge,4)+n(w,4)+be+Se+ge}}var s=r("../utils"),l=r("../stream/GenericWorker"),h=r("../utf8"),p=r("../crc32"),m=r("../signature");function f(g,y,_,w){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=_,this.encodeFileName=w,this.streamFiles=g,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(f,l),f.prototype.push=function(g){var y=g.meta.percent||0,_=this.entriesCount,w=this._sources.length;this.accumulate?this.contentBuffer.push(g):(this.bytesWritten+=g.data.length,l.prototype.push.call(this,{data:g.data,meta:{currentFile:this.currentFile,percent:_?(y+100*(_-w-1))/_:100}}))},f.prototype.openedSource=function(g){this.currentSourceOffset=this.bytesWritten,this.currentFile=g.file.name;var y=this.streamFiles&&!g.file.dir;if(y){var _=o(g,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(g){this.accumulate=!1;var y=this.streamFiles&&!g.file.dir,_=o(g,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),y)this.push({data:function(w){return m.DATA_DESCRIPTOR+n(w.crc32,4)+n(w.compressedSize,4)+n(w.uncompressedSize,4)}(g),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var g=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var _=this.bytesWritten-g,w=function(A,k,R,q,X){var ie=s.transformTo("string",X(q));return m.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(A,2)+n(A,2)+n(k,4)+n(R,4)+n(ie.length,2)+ie}(this.dirRecords.length,_,g,this.zipComment,this.encodeFileName);this.push({data:w,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(g){this._sources.push(g);var y=this;return g.on("data",function(_){y.processChunk(_)}),g.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),g.on("error",function(_){y.error(_)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(g){var y=this._sources;if(!l.prototype.error.call(this,g))return!1;for(var _=0;_<y.length;_++)try{y[_].error(g)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var g=this._sources,y=0;y<g.length;y++)g[y].lock()},i.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,i,e){"use strict";var n=r("../compressions"),o=r("./ZipFileWorker");e.generateWorker=function(s,l,h){var p=new o(l.streamFiles,h,l.platform,l.encodeFileName),m=0;try{s.forEach(function(f,g){m++;var y=function(k,R){var q=k||R,X=n[q];if(!X)throw new Error(q+" is not a valid compression method !");return X}(g.options.compression,l.compression),_=g.options.compressionOptions||l.compressionOptions||{},w=g.dir,A=g.date;g._compressWorker(y,_).withStreamInfo("file",{name:f,dir:w,date:A,comment:g.comment||"",unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions}).pipe(p)}),p.entriesCount=m}catch(f){p.error(f)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,i,e){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new n;for(var s in this)typeof this[s]!="function"&&(o[s]=this[s]);return o}}(n.prototype=r("./object")).loadAsync=r("./load"),n.support=r("./support"),n.defaults=r("./defaults"),n.version="3.10.1",n.loadAsync=function(o,s){return new n().loadAsync(o,s)},n.external=r("./external"),i.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,i,e){"use strict";var n=r("./utils"),o=r("./external"),s=r("./utf8"),l=r("./zipEntries"),h=r("./stream/Crc32Probe"),p=r("./nodejsUtils");function m(f){return new o.Promise(function(g,y){var _=f.decompressed.getContentWorker().pipe(new h);_.on("error",function(w){y(w)}).on("end",function(){_.streamInfo.crc32!==f.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):g()}).resume()})}i.exports=function(f,g){var y=this;return g=n.extend(g||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),p.isNode&&p.isStream(f)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",f,!0,g.optimizedBinaryString,g.base64).then(function(_){var w=new l(g);return w.load(_),w}).then(function(_){var w=[o.Promise.resolve(_)],A=_.files;if(g.checkCRC32)for(var k=0;k<A.length;k++)w.push(m(A[k]));return o.Promise.all(w)}).then(function(_){for(var w=_.shift(),A=w.files,k=0;k<A.length;k++){var R=A[k],q=R.fileNameStr,X=n.resolve(R.fileNameStr);y.file(X,R.decompressed,{binary:!0,optimizedBinaryString:!0,date:R.date,dir:R.dir,comment:R.fileCommentStr.length?R.fileCommentStr:null,unixPermissions:R.unixPermissions,dosPermissions:R.dosPermissions,createFolders:g.createFolders}),R.dir||(y.file(X).unsafeOriginalName=q)}return w.zipComment.length&&(y.comment=w.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,i,e){"use strict";var n=r("../utils"),o=r("../stream/GenericWorker");function s(l,h){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(h)}n.inherits(s,o),s.prototype._bindStream=function(l){var h=this;(this._stream=l).pause(),l.on("data",function(p){h.push({data:p,meta:{percent:0}})}).on("error",function(p){h.isPaused?this.generatedError=p:h.error(p)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},s.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,i,e){"use strict";var n=r("readable-stream").Readable;function o(s,l,h){n.call(this,l),this._helper=s;var p=this;s.on("data",function(m,f){p.push(m)||p._helper.pause(),h&&h(f)}).on("error",function(m){p.emit("error",m)}).on("end",function(){p.push(null)})}r("../utils").inherits(o,n),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(r,i,e){"use strict";i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,o);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,o)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var o=new Buffer(n);return o.fill(0),o},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(r,i,e){"use strict";function n(X,ie,ae){var be,me=s.getTypeOf(ie),fe=s.extend(ae||{},p);fe.date=fe.date||new Date,fe.compression!==null&&(fe.compression=fe.compression.toUpperCase()),typeof fe.unixPermissions=="string"&&(fe.unixPermissions=parseInt(fe.unixPermissions,8)),fe.unixPermissions&&16384&fe.unixPermissions&&(fe.dir=!0),fe.dosPermissions&&16&fe.dosPermissions&&(fe.dir=!0),fe.dir&&(X=A(X)),fe.createFolders&&(be=w(X))&&k.call(this,be,!0);var ge=me==="string"&&fe.binary===!1&&fe.base64===!1;ae&&ae.binary!==void 0||(fe.binary=!ge),(ie instanceof m&&ie.uncompressedSize===0||fe.dir||!ie||ie.length===0)&&(fe.base64=!1,fe.binary=!0,ie="",fe.compression="STORE",me="string");var ue=null;ue=ie instanceof m||ie instanceof l?ie:y.isNode&&y.isStream(ie)?new _(X,ie):s.prepareContent(X,ie,fe.binary,fe.optimizedBinaryString,fe.base64);var se=new f(X,ue,fe);this.files[X]=se}var o=r("./utf8"),s=r("./utils"),l=r("./stream/GenericWorker"),h=r("./stream/StreamHelper"),p=r("./defaults"),m=r("./compressedObject"),f=r("./zipObject"),g=r("./generate"),y=r("./nodejsUtils"),_=r("./nodejs/NodejsStreamInputAdapter"),w=function(X){X.slice(-1)==="/"&&(X=X.substring(0,X.length-1));var ie=X.lastIndexOf("/");return 0<ie?X.substring(0,ie):""},A=function(X){return X.slice(-1)!=="/"&&(X+="/"),X},k=function(X,ie){return ie=ie!==void 0?ie:p.createFolders,X=A(X),this.files[X]||n.call(this,X,null,{dir:!0,createFolders:ie}),this.files[X]};function R(X){return Object.prototype.toString.call(X)==="[object RegExp]"}var q={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(X){var ie,ae,be;for(ie in this.files)be=this.files[ie],(ae=ie.slice(this.root.length,ie.length))&&ie.slice(0,this.root.length)===this.root&&X(ae,be)},filter:function(X){var ie=[];return this.forEach(function(ae,be){X(ae,be)&&ie.push(be)}),ie},file:function(X,ie,ae){if(arguments.length!==1)return X=this.root+X,n.call(this,X,ie,ae),this;if(R(X)){var be=X;return this.filter(function(fe,ge){return!ge.dir&&be.test(fe)})}var me=this.files[this.root+X];return me&&!me.dir?me:null},folder:function(X){if(!X)return this;if(R(X))return this.filter(function(me,fe){return fe.dir&&X.test(me)});var ie=this.root+X,ae=k.call(this,ie),be=this.clone();return be.root=ae.name,be},remove:function(X){X=this.root+X;var ie=this.files[X];if(ie||(X.slice(-1)!=="/"&&(X+="/"),ie=this.files[X]),ie&&!ie.dir)delete this.files[X];else for(var ae=this.filter(function(me,fe){return fe.name.slice(0,X.length)===X}),be=0;be<ae.length;be++)delete this.files[ae[be].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(X){var ie,ae={};try{if((ae=s.extend(X||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=ae.type.toLowerCase(),ae.compression=ae.compression.toUpperCase(),ae.type==="binarystring"&&(ae.type="string"),!ae.type)throw new Error("No output type specified.");s.checkSupport(ae.type),ae.platform!=="darwin"&&ae.platform!=="freebsd"&&ae.platform!=="linux"&&ae.platform!=="sunos"||(ae.platform="UNIX"),ae.platform==="win32"&&(ae.platform="DOS");var be=ae.comment||this.comment||"";ie=g.generateWorker(this,ae,be)}catch(me){(ie=new l("error")).error(me)}return new h(ie,ae.type||"string",ae.mimeType)},generateAsync:function(X,ie){return this.generateInternalStream(X).accumulate(ie)},generateNodeStream:function(X,ie){return(X=X||{}).type||(X.type="nodebuffer"),this.generateInternalStream(X).toNodejsStream(ie)}};i.exports=q},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,i,e){"use strict";i.exports=r("stream")},{stream:void 0}],17:[function(r,i,e){"use strict";var n=r("./DataReader");function o(s){n.call(this,s);for(var l=0;l<this.data.length;l++)s[l]=255&s[l]}r("../utils").inherits(o,n),o.prototype.byteAt=function(s){return this.data[this.zero+s]},o.prototype.lastIndexOfSignature=function(s){for(var l=s.charCodeAt(0),h=s.charCodeAt(1),p=s.charCodeAt(2),m=s.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===h&&this.data[f+2]===p&&this.data[f+3]===m)return f-this.zero;return-1},o.prototype.readAndCheckSignature=function(s){var l=s.charCodeAt(0),h=s.charCodeAt(1),p=s.charCodeAt(2),m=s.charCodeAt(3),f=this.readData(4);return l===f[0]&&h===f[1]&&p===f[2]&&m===f[3]},o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(r,i,e){"use strict";var n=r("../utils");function o(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var l,h=0;for(this.checkOffset(s),l=this.index+s-1;l>=this.index;l--)h=(h<<8)+this.byteAt(l);return this.index+=s,h},readString:function(s){return n.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},i.exports=o},{"../utils":32}],19:[function(r,i,e){"use strict";var n=r("./Uint8ArrayReader");function o(s){n.call(this,s)}r("../utils").inherits(o,n),o.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,i,e){"use strict";var n=r("./DataReader");function o(s){n.call(this,s)}r("../utils").inherits(o,n),o.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},o.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},o.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},o.prototype.readData=function(s){this.checkOffset(s);var l=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(r,i,e){"use strict";var n=r("./ArrayReader");function o(s){n.call(this,s)}r("../utils").inherits(o,n),o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(r,i,e){"use strict";var n=r("../utils"),o=r("../support"),s=r("./ArrayReader"),l=r("./StringReader"),h=r("./NodeBufferReader"),p=r("./Uint8ArrayReader");i.exports=function(m){var f=n.getTypeOf(m);return n.checkSupport(f),f!=="string"||o.uint8array?f==="nodebuffer"?new h(m):o.uint8array?new p(n.transformTo("uint8array",m)):new s(n.transformTo("array",m)):new l(m)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,i,e){"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,i,e){"use strict";var n=r("./GenericWorker"),o=r("../utils");function s(l){n.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(s,n),s.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(r,i,e){"use strict";var n=r("./GenericWorker"),o=r("../crc32");function s(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(s,n),s.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,i,e){"use strict";var n=r("../utils"),o=r("./GenericWorker");function s(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}n.inherits(s,o),s.prototype.processChunk=function(l){if(l){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(r,i,e){"use strict";var n=r("../utils"),o=r("./GenericWorker");function s(l){o.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(p){h.dataIsReady=!0,h.data=p,h.max=p&&p.length||0,h.type=n.getTypeOf(p),h.isPaused||h._tickAndRepeat()},function(p){h.error(p)})}n.inherits(s,o),s.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,h);break;case"uint8array":l=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":l=this.data.slice(this.index,h)}return this.index=h,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(r,i,e){"use strict";function n(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,s){return this._listeners[o].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,s){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,s)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var s=this;return o.on("data",function(l){s.processChunk(l)}),o.on("end",function(){s.end()}),o.on("error",function(l){s.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,s){return this.extraStreamInfo[o]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=n},{}],29:[function(r,i,e){"use strict";var n=r("../utils"),o=r("./ConvertWorker"),s=r("./GenericWorker"),l=r("../base64"),h=r("../support"),p=r("../external"),m=null;if(h.nodestream)try{m=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(y,_){return new p.Promise(function(w,A){var k=[],R=y._internalType,q=y._outputType,X=y._mimeType;y.on("data",function(ie,ae){k.push(ie),_&&_(ae)}).on("error",function(ie){k=[],A(ie)}).on("end",function(){try{var ie=function(ae,be,me){switch(ae){case"blob":return n.newBlob(n.transformTo("arraybuffer",be),me);case"base64":return l.encode(be);default:return n.transformTo(ae,be)}}(q,function(ae,be){var me,fe=0,ge=null,ue=0;for(me=0;me<be.length;me++)ue+=be[me].length;switch(ae){case"string":return be.join("");case"array":return Array.prototype.concat.apply([],be);case"uint8array":for(ge=new Uint8Array(ue),me=0;me<be.length;me++)ge.set(be[me],fe),fe+=be[me].length;return ge;case"nodebuffer":return Buffer.concat(be);default:throw new Error("concat : unsupported type '"+ae+"'")}}(R,k),X);w(ie)}catch(ae){A(ae)}k=[]}).resume()})}function g(y,_,w){var A=_;switch(_){case"blob":case"arraybuffer":A="uint8array";break;case"base64":A="string"}try{this._internalType=A,this._outputType=_,this._mimeType=w,n.checkSupport(A),this._worker=y.pipe(new o(A)),y.lock()}catch(k){this._worker=new s("error"),this._worker.error(k)}}g.prototype={accumulate:function(y){return f(this,y)},on:function(y,_){var w=this;return y==="data"?this._worker.on(y,function(A){_.call(w,A.data,A.meta)}):this._worker.on(y,function(){n.delay(_,arguments,w)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new m(this,{objectMode:this._outputType!=="nodebuffer"},y)}},i.exports=g},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,i,e){"use strict";if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",e.nodebuffer=typeof Buffer<"u",e.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")e.blob=!1;else{var n=new ArrayBuffer(0);try{e.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(n),e.blob=o.getBlob("application/zip").size===0}catch{e.blob=!1}}}try{e.nodestream=!!r("readable-stream").Readable}catch{e.nodestream=!1}},{"readable-stream":16}],31:[function(r,i,e){"use strict";for(var n=r("./utils"),o=r("./support"),s=r("./nodejsUtils"),l=r("./stream/GenericWorker"),h=new Array(256),p=0;p<256;p++)h[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;h[254]=h[254]=1;function m(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}e.utf8encode=function(g){return o.nodebuffer?s.newBufferFrom(g,"utf-8"):function(y){var _,w,A,k,R,q=y.length,X=0;for(k=0;k<q;k++)(64512&(w=y.charCodeAt(k)))==55296&&k+1<q&&(64512&(A=y.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(A-56320),k++),X+=w<128?1:w<2048?2:w<65536?3:4;for(_=o.uint8array?new Uint8Array(X):new Array(X),k=R=0;R<X;k++)(64512&(w=y.charCodeAt(k)))==55296&&k+1<q&&(64512&(A=y.charCodeAt(k+1)))==56320&&(w=65536+(w-55296<<10)+(A-56320),k++),w<128?_[R++]=w:(w<2048?_[R++]=192|w>>>6:(w<65536?_[R++]=224|w>>>12:(_[R++]=240|w>>>18,_[R++]=128|w>>>12&63),_[R++]=128|w>>>6&63),_[R++]=128|63&w);return _}(g)},e.utf8decode=function(g){return o.nodebuffer?n.transformTo("nodebuffer",g).toString("utf-8"):function(y){var _,w,A,k,R=y.length,q=new Array(2*R);for(_=w=0;_<R;)if((A=y[_++])<128)q[w++]=A;else if(4<(k=h[A]))q[w++]=65533,_+=k-1;else{for(A&=k===2?31:k===3?15:7;1<k&&_<R;)A=A<<6|63&y[_++],k--;1<k?q[w++]=65533:A<65536?q[w++]=A:(A-=65536,q[w++]=55296|A>>10&1023,q[w++]=56320|1023&A)}return q.length!==w&&(q.subarray?q=q.subarray(0,w):q.length=w),n.applyFromCharCode(q)}(g=n.transformTo(o.uint8array?"uint8array":"array",g))},n.inherits(m,l),m.prototype.processChunk=function(g){var y=n.transformTo(o.uint8array?"uint8array":"array",g.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var _=y;(y=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),y.set(_,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var w=function(k,R){var q;for((R=R||k.length)>k.length&&(R=k.length),q=R-1;0<=q&&(192&k[q])==128;)q--;return q<0||q===0?R:q+h[k[q]]>R?q:R}(y),A=y;w!==y.length&&(o.uint8array?(A=y.subarray(0,w),this.leftOver=y.subarray(w,y.length)):(A=y.slice(0,w),this.leftOver=y.slice(w,y.length))),this.push({data:e.utf8decode(A),meta:g.meta})},m.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=m,n.inherits(f,l),f.prototype.processChunk=function(g){this.push({data:e.utf8encode(g.data),meta:g.meta})},e.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,i,e){"use strict";var n=r("./support"),o=r("./base64"),s=r("./nodejsUtils"),l=r("./external");function h(_){return _}function p(_,w){for(var A=0;A<_.length;++A)w[A]=255&_.charCodeAt(A);return w}r("setimmediate"),e.newBlob=function(_,w){e.checkSupport("blob");try{return new Blob([_],{type:w})}catch{try{var A=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return A.append(_),A.getBlob(w)}catch{throw new Error("Bug : can't construct the Blob.")}}};var m={stringifyByChunk:function(_,w,A){var k=[],R=0,q=_.length;if(q<=A)return String.fromCharCode.apply(null,_);for(;R<q;)w==="array"||w==="nodebuffer"?k.push(String.fromCharCode.apply(null,_.slice(R,Math.min(R+A,q)))):k.push(String.fromCharCode.apply(null,_.subarray(R,Math.min(R+A,q)))),R+=A;return k.join("")},stringifyByChar:function(_){for(var w="",A=0;A<_.length;A++)w+=String.fromCharCode(_[A]);return w},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function f(_){var w=65536,A=e.getTypeOf(_),k=!0;if(A==="uint8array"?k=m.applyCanBeUsed.uint8array:A==="nodebuffer"&&(k=m.applyCanBeUsed.nodebuffer),k)for(;1<w;)try{return m.stringifyByChunk(_,A,w)}catch{w=Math.floor(w/2)}return m.stringifyByChar(_)}function g(_,w){for(var A=0;A<_.length;A++)w[A]=_[A];return w}e.applyFromCharCode=f;var y={};y.string={string:h,array:function(_){return p(_,new Array(_.length))},arraybuffer:function(_){return y.string.uint8array(_).buffer},uint8array:function(_){return p(_,new Uint8Array(_.length))},nodebuffer:function(_){return p(_,s.allocBuffer(_.length))}},y.array={string:f,array:h,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return s.newBufferFrom(_)}},y.arraybuffer={string:function(_){return f(new Uint8Array(_))},array:function(_){return g(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:h,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return s.newBufferFrom(new Uint8Array(_))}},y.uint8array={string:f,array:function(_){return g(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:h,nodebuffer:function(_){return s.newBufferFrom(_)}},y.nodebuffer={string:f,array:function(_){return g(_,new Array(_.length))},arraybuffer:function(_){return y.nodebuffer.uint8array(_).buffer},uint8array:function(_){return g(_,new Uint8Array(_.length))},nodebuffer:h},e.transformTo=function(_,w){if(w=w||"",!_)return w;e.checkSupport(_);var A=e.getTypeOf(w);return y[A][_](w)},e.resolve=function(_){for(var w=_.split("/"),A=[],k=0;k<w.length;k++){var R=w[k];R==="."||R===""&&k!==0&&k!==w.length-1||(R===".."?A.pop():A.push(R))}return A.join("/")},e.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":n.nodebuffer&&s.isBuffer(_)?"nodebuffer":n.uint8array&&_ instanceof Uint8Array?"uint8array":n.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(_){if(!n[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(_){var w,A,k="";for(A=0;A<(_||"").length;A++)k+="\\x"+((w=_.charCodeAt(A))<16?"0":"")+w.toString(16).toUpperCase();return k},e.delay=function(_,w,A){setImmediate(function(){_.apply(A||null,w||[])})},e.inherits=function(_,w){function A(){}A.prototype=w.prototype,_.prototype=new A},e.extend=function(){var _,w,A={};for(_=0;_<arguments.length;_++)for(w in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],w)&&A[w]===void 0&&(A[w]=arguments[_][w]);return A},e.prepareContent=function(_,w,A,k,R){return l.Promise.resolve(w).then(function(q){return n.blob&&(q instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(q))!==-1)&&typeof FileReader<"u"?new l.Promise(function(X,ie){var ae=new FileReader;ae.onload=function(be){X(be.target.result)},ae.onerror=function(be){ie(be.target.error)},ae.readAsArrayBuffer(q)}):q}).then(function(q){var X=e.getTypeOf(q);return X?(X==="arraybuffer"?q=e.transformTo("uint8array",q):X==="string"&&(R?q=o.decode(q):A&&k!==!0&&(q=function(ie){return p(ie,n.uint8array?new Uint8Array(ie.length):new Array(ie.length))}(q))),q):l.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,i,e){"use strict";var n=r("./reader/readerFor"),o=r("./utils"),s=r("./signature"),l=r("./zipEntry"),h=r("./support");function p(m){this.files=[],this.loadOptions=m}p.prototype={checkSignature:function(m){if(!this.reader.readAndCheckSignature(m)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(f)+", expected "+o.pretty(m)+")")}},isSignature:function(m,f){var g=this.reader.index;this.reader.setIndex(m);var y=this.reader.readString(4)===f;return this.reader.setIndex(g),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var m=this.reader.readData(this.zipCommentLength),f=h.uint8array?"uint8array":"array",g=o.transformTo(f,m);this.zipComment=this.loadOptions.decodeFileName(g)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var m,f,g,y=this.zip64EndOfCentralSize-44;0<y;)m=this.reader.readInt(2),f=this.reader.readInt(4),g=this.reader.readData(f),this.zip64ExtensibleData[m]={id:m,length:f,value:g}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var m,f;for(m=0;m<this.files.length;m++)f=this.files[m],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var m;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(m=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(m);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var m=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(m<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(m);var f=m;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(m=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(m),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var g=this.centralDirOffset+this.centralDirSize;this.zip64&&(g+=20,g+=12+this.zip64EndOfCentralSize);var y=f-g;if(0<y)this.isSignature(f,s.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(m){this.reader=n(m)},load:function(m){this.prepareReader(m),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,i,e){"use strict";var n=r("./reader/readerFor"),o=r("./utils"),s=r("./compressedObject"),l=r("./crc32"),h=r("./utf8"),p=r("./compressions"),m=r("./support");function f(g,y){this.options=g,this.loadOptions=y}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(g){var y,_;if(g.skip(22),this.fileNameLength=g.readInt(2),_=g.readInt(2),this.fileName=g.readData(this.fileNameLength),g.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(w){for(var A in p)if(Object.prototype.hasOwnProperty.call(p,A)&&p[A].magic===w)return p[A];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,y,g.readData(this.compressedSize))},readCentralPart:function(g){this.versionMadeBy=g.readInt(2),g.skip(2),this.bitFlag=g.readInt(2),this.compressionMethod=g.readString(2),this.date=g.readDate(),this.crc32=g.readInt(4),this.compressedSize=g.readInt(4),this.uncompressedSize=g.readInt(4);var y=g.readInt(2);if(this.extraFieldsLength=g.readInt(2),this.fileCommentLength=g.readInt(2),this.diskNumberStart=g.readInt(2),this.internalFileAttributes=g.readInt(2),this.externalFileAttributes=g.readInt(4),this.localHeaderOffset=g.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");g.skip(y),this.readExtraFields(g),this.parseZIP64ExtraField(g),this.fileComment=g.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var g=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),g==0&&(this.dosPermissions=63&this.externalFileAttributes),g==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var g=n(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=g.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=g.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=g.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=g.readInt(4))}},readExtraFields:function(g){var y,_,w,A=g.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});g.index+4<A;)y=g.readInt(2),_=g.readInt(2),w=g.readData(_),this.extraFields[y]={id:y,length:_,value:w};g.setIndex(A)},handleUTF8:function(){var g=m.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var _=o.transformTo(g,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var w=this.findExtraFieldUnicodeComment();if(w!==null)this.fileCommentStr=w;else{var A=o.transformTo(g,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(A)}}},findExtraFieldUnicodePath:function(){var g=this.extraFields[28789];if(g){var y=n(g.value);return y.readInt(1)!==1||l(this.fileName)!==y.readInt(4)?null:h.utf8decode(y.readData(g.length-5))}return null},findExtraFieldUnicodeComment:function(){var g=this.extraFields[25461];if(g){var y=n(g.value);return y.readInt(1)!==1||l(this.fileComment)!==y.readInt(4)?null:h.utf8decode(y.readData(g.length-5))}return null}},i.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,i,e){"use strict";function n(y,_,w){this.name=y,this.dir=w.dir,this.date=w.date,this.comment=w.comment,this.unixPermissions=w.unixPermissions,this.dosPermissions=w.dosPermissions,this._data=_,this._dataBinary=w.binary,this.options={compression:w.compression,compressionOptions:w.compressionOptions}}var o=r("./stream/StreamHelper"),s=r("./stream/DataWorker"),l=r("./utf8"),h=r("./compressedObject"),p=r("./stream/GenericWorker");n.prototype={internalStream:function(y){var _=null,w="string";try{if(!y)throw new Error("No output type specified.");var A=(w=y.toLowerCase())==="string"||w==="text";w!=="binarystring"&&w!=="text"||(w="string"),_=this._decompressWorker();var k=!this._dataBinary;k&&!A&&(_=_.pipe(new l.Utf8EncodeWorker)),!k&&A&&(_=_.pipe(new l.Utf8DecodeWorker))}catch(R){(_=new p("error")).error(R)}return new o(_,w,"")},async:function(y,_){return this.internalStream(y).accumulate(_)},nodeStream:function(y,_){return this.internalStream(y||"nodebuffer").toNodejsStream(_)},_compressWorker:function(y,_){if(this._data instanceof h&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var w=this._decompressWorker();return this._dataBinary||(w=w.pipe(new l.Utf8EncodeWorker)),h.createWorkerFrom(w,y,_)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof p?this._data:new s(this._data)}};for(var m=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},g=0;g<m.length;g++)n.prototype[m[g]]=f;i.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,i,e){(function(n){"use strict";var o,s,l=n.MutationObserver||n.WebKitMutationObserver;if(l){var h=0,p=new l(y),m=n.document.createTextNode("");p.observe(m,{characterData:!0}),o=function(){m.data=h=++h%2}}else if(n.setImmediate||n.MessageChannel===void 0)o="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var _=n.document.createElement("script");_.onreadystatechange=function(){y(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},n.document.documentElement.appendChild(_)}:function(){setTimeout(y,0)};else{var f=new n.MessageChannel;f.port1.onmessage=y,o=function(){f.port2.postMessage(0)}}var g=[];function y(){var _,w;s=!0;for(var A=g.length;A;){for(w=g,g=[],_=-1;++_<A;)w[_]();A=g.length}s=!1}i.exports=function(_){g.push(_)!==1||s||o()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,i,e){"use strict";var n=r("immediate");function o(){}var s={},l=["REJECTED"],h=["FULFILLED"],p=["PENDING"];function m(A){if(typeof A!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,A!==o&&_(this,A)}function f(A,k,R){this.promise=A,typeof k=="function"&&(this.onFulfilled=k,this.callFulfilled=this.otherCallFulfilled),typeof R=="function"&&(this.onRejected=R,this.callRejected=this.otherCallRejected)}function g(A,k,R){n(function(){var q;try{q=k(R)}catch(X){return s.reject(A,X)}q===A?s.reject(A,new TypeError("Cannot resolve promise with itself")):s.resolve(A,q)})}function y(A){var k=A&&A.then;if(A&&(typeof A=="object"||typeof A=="function")&&typeof k=="function")return function(){k.apply(A,arguments)}}function _(A,k){var R=!1;function q(ae){R||(R=!0,s.reject(A,ae))}function X(ae){R||(R=!0,s.resolve(A,ae))}var ie=w(function(){k(X,q)});ie.status==="error"&&q(ie.value)}function w(A,k){var R={};try{R.value=A(k),R.status="success"}catch(q){R.status="error",R.value=q}return R}(i.exports=m).prototype.finally=function(A){if(typeof A!="function")return this;var k=this.constructor;return this.then(function(R){return k.resolve(A()).then(function(){return R})},function(R){return k.resolve(A()).then(function(){throw R})})},m.prototype.catch=function(A){return this.then(null,A)},m.prototype.then=function(A,k){if(typeof A!="function"&&this.state===h||typeof k!="function"&&this.state===l)return this;var R=new this.constructor(o);return this.state!==p?g(R,this.state===h?A:k,this.outcome):this.queue.push(new f(R,A,k)),R},f.prototype.callFulfilled=function(A){s.resolve(this.promise,A)},f.prototype.otherCallFulfilled=function(A){g(this.promise,this.onFulfilled,A)},f.prototype.callRejected=function(A){s.reject(this.promise,A)},f.prototype.otherCallRejected=function(A){g(this.promise,this.onRejected,A)},s.resolve=function(A,k){var R=w(y,k);if(R.status==="error")return s.reject(A,R.value);var q=R.value;if(q)_(A,q);else{A.state=h,A.outcome=k;for(var X=-1,ie=A.queue.length;++X<ie;)A.queue[X].callFulfilled(k)}return A},s.reject=function(A,k){A.state=l,A.outcome=k;for(var R=-1,q=A.queue.length;++R<q;)A.queue[R].callRejected(k);return A},m.resolve=function(A){return A instanceof this?A:s.resolve(new this(o),A)},m.reject=function(A){var k=new this(o);return s.reject(k,A)},m.all=function(A){var k=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,q=!1;if(!R)return this.resolve([]);for(var X=new Array(R),ie=0,ae=-1,be=new this(o);++ae<R;)me(A[ae],ae);return be;function me(fe,ge){k.resolve(fe).then(function(ue){X[ge]=ue,++ie!==R||q||(q=!0,s.resolve(be,X))},function(ue){q||(q=!0,s.reject(be,ue))})}},m.race=function(A){var k=this;if(Object.prototype.toString.call(A)!=="[object Array]")return this.reject(new TypeError("must be an array"));var R=A.length,q=!1;if(!R)return this.resolve([]);for(var X=-1,ie=new this(o);++X<R;)ae=A[X],k.resolve(ae).then(function(be){q||(q=!0,s.resolve(ie,be))},function(be){q||(q=!0,s.reject(ie,be))});var ae;return ie}},{immediate:36}],38:[function(r,i,e){"use strict";var n={};(0,r("./lib/utils/common").assign)(n,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),i.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,i,e){"use strict";var n=r("./zlib/deflate"),o=r("./utils/common"),s=r("./utils/strings"),l=r("./zlib/messages"),h=r("./zlib/zstream"),p=Object.prototype.toString,m=0,f=-1,g=0,y=8;function _(A){if(!(this instanceof _))return new _(A);this.options=o.assign({level:f,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},A||{});var k=this.options;k.raw&&0<k.windowBits?k.windowBits=-k.windowBits:k.gzip&&0<k.windowBits&&k.windowBits<16&&(k.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var R=n.deflateInit2(this.strm,k.level,k.method,k.windowBits,k.memLevel,k.strategy);if(R!==m)throw new Error(l[R]);if(k.header&&n.deflateSetHeader(this.strm,k.header),k.dictionary){var q;if(q=typeof k.dictionary=="string"?s.string2buf(k.dictionary):p.call(k.dictionary)==="[object ArrayBuffer]"?new Uint8Array(k.dictionary):k.dictionary,(R=n.deflateSetDictionary(this.strm,q))!==m)throw new Error(l[R]);this._dict_set=!0}}function w(A,k){var R=new _(k);if(R.push(A,!0),R.err)throw R.msg||l[R.err];return R.result}_.prototype.push=function(A,k){var R,q,X=this.strm,ie=this.options.chunkSize;if(this.ended)return!1;q=k===~~k?k:k===!0?4:0,typeof A=="string"?X.input=s.string2buf(A):p.call(A)==="[object ArrayBuffer]"?X.input=new Uint8Array(A):X.input=A,X.next_in=0,X.avail_in=X.input.length;do{if(X.avail_out===0&&(X.output=new o.Buf8(ie),X.next_out=0,X.avail_out=ie),(R=n.deflate(X,q))!==1&&R!==m)return this.onEnd(R),!(this.ended=!0);X.avail_out!==0&&(X.avail_in!==0||q!==4&&q!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(o.shrinkBuf(X.output,X.next_out))):this.onData(o.shrinkBuf(X.output,X.next_out)))}while((0<X.avail_in||X.avail_out===0)&&R!==1);return q===4?(R=n.deflateEnd(this.strm),this.onEnd(R),this.ended=!0,R===m):q!==2||(this.onEnd(m),!(X.avail_out=0))},_.prototype.onData=function(A){this.chunks.push(A)},_.prototype.onEnd=function(A){A===m&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=A,this.msg=this.strm.msg},e.Deflate=_,e.deflate=w,e.deflateRaw=function(A,k){return(k=k||{}).raw=!0,w(A,k)},e.gzip=function(A,k){return(k=k||{}).gzip=!0,w(A,k)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,i,e){"use strict";var n=r("./zlib/inflate"),o=r("./utils/common"),s=r("./utils/strings"),l=r("./zlib/constants"),h=r("./zlib/messages"),p=r("./zlib/zstream"),m=r("./zlib/gzheader"),f=Object.prototype.toString;function g(_){if(!(this instanceof g))return new g(_);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},_||{});var w=this.options;w.raw&&0<=w.windowBits&&w.windowBits<16&&(w.windowBits=-w.windowBits,w.windowBits===0&&(w.windowBits=-15)),!(0<=w.windowBits&&w.windowBits<16)||_&&_.windowBits||(w.windowBits+=32),15<w.windowBits&&w.windowBits<48&&!(15&w.windowBits)&&(w.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var A=n.inflateInit2(this.strm,w.windowBits);if(A!==l.Z_OK)throw new Error(h[A]);this.header=new m,n.inflateGetHeader(this.strm,this.header)}function y(_,w){var A=new g(w);if(A.push(_,!0),A.err)throw A.msg||h[A.err];return A.result}g.prototype.push=function(_,w){var A,k,R,q,X,ie,ae=this.strm,be=this.options.chunkSize,me=this.options.dictionary,fe=!1;if(this.ended)return!1;k=w===~~w?w:w===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof _=="string"?ae.input=s.binstring2buf(_):f.call(_)==="[object ArrayBuffer]"?ae.input=new Uint8Array(_):ae.input=_,ae.next_in=0,ae.avail_in=ae.input.length;do{if(ae.avail_out===0&&(ae.output=new o.Buf8(be),ae.next_out=0,ae.avail_out=be),(A=n.inflate(ae,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&me&&(ie=typeof me=="string"?s.string2buf(me):f.call(me)==="[object ArrayBuffer]"?new Uint8Array(me):me,A=n.inflateSetDictionary(this.strm,ie)),A===l.Z_BUF_ERROR&&fe===!0&&(A=l.Z_OK,fe=!1),A!==l.Z_STREAM_END&&A!==l.Z_OK)return this.onEnd(A),!(this.ended=!0);ae.next_out&&(ae.avail_out!==0&&A!==l.Z_STREAM_END&&(ae.avail_in!==0||k!==l.Z_FINISH&&k!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(R=s.utf8border(ae.output,ae.next_out),q=ae.next_out-R,X=s.buf2string(ae.output,R),ae.next_out=q,ae.avail_out=be-q,q&&o.arraySet(ae.output,ae.output,R,q,0),this.onData(X)):this.onData(o.shrinkBuf(ae.output,ae.next_out)))),ae.avail_in===0&&ae.avail_out===0&&(fe=!0)}while((0<ae.avail_in||ae.avail_out===0)&&A!==l.Z_STREAM_END);return A===l.Z_STREAM_END&&(k=l.Z_FINISH),k===l.Z_FINISH?(A=n.inflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===l.Z_OK):k!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(ae.avail_out=0))},g.prototype.onData=function(_){this.chunks.push(_)},g.prototype.onEnd=function(_){_===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},e.Inflate=g,e.inflate=y,e.inflateRaw=function(_,w){return(w=w||{}).raw=!0,y(_,w)},e.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,i,e){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";e.assign=function(l){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var p=h.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var m in p)p.hasOwnProperty(m)&&(l[m]=p[m])}}return l},e.shrinkBuf=function(l,h){return l.length===h?l:l.subarray?l.subarray(0,h):(l.length=h,l)};var o={arraySet:function(l,h,p,m,f){if(h.subarray&&l.subarray)l.set(h.subarray(p,p+m),f);else for(var g=0;g<m;g++)l[f+g]=h[p+g]},flattenChunks:function(l){var h,p,m,f,g,y;for(h=m=0,p=l.length;h<p;h++)m+=l[h].length;for(y=new Uint8Array(m),h=f=0,p=l.length;h<p;h++)g=l[h],y.set(g,f),f+=g.length;return y}},s={arraySet:function(l,h,p,m,f){for(var g=0;g<m;g++)l[f+g]=h[p+g]},flattenChunks:function(l){return[].concat.apply([],l)}};e.setTyped=function(l){l?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,o)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(n)},{}],42:[function(r,i,e){"use strict";var n=r("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var l=new n.Buf8(256),h=0;h<256;h++)l[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function p(m,f){if(f<65537&&(m.subarray&&s||!m.subarray&&o))return String.fromCharCode.apply(null,n.shrinkBuf(m,f));for(var g="",y=0;y<f;y++)g+=String.fromCharCode(m[y]);return g}l[254]=l[254]=1,e.string2buf=function(m){var f,g,y,_,w,A=m.length,k=0;for(_=0;_<A;_++)(64512&(g=m.charCodeAt(_)))==55296&&_+1<A&&(64512&(y=m.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),_++),k+=g<128?1:g<2048?2:g<65536?3:4;for(f=new n.Buf8(k),_=w=0;w<k;_++)(64512&(g=m.charCodeAt(_)))==55296&&_+1<A&&(64512&(y=m.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(y-56320),_++),g<128?f[w++]=g:(g<2048?f[w++]=192|g>>>6:(g<65536?f[w++]=224|g>>>12:(f[w++]=240|g>>>18,f[w++]=128|g>>>12&63),f[w++]=128|g>>>6&63),f[w++]=128|63&g);return f},e.buf2binstring=function(m){return p(m,m.length)},e.binstring2buf=function(m){for(var f=new n.Buf8(m.length),g=0,y=f.length;g<y;g++)f[g]=m.charCodeAt(g);return f},e.buf2string=function(m,f){var g,y,_,w,A=f||m.length,k=new Array(2*A);for(g=y=0;g<A;)if((_=m[g++])<128)k[y++]=_;else if(4<(w=l[_]))k[y++]=65533,g+=w-1;else{for(_&=w===2?31:w===3?15:7;1<w&&g<A;)_=_<<6|63&m[g++],w--;1<w?k[y++]=65533:_<65536?k[y++]=_:(_-=65536,k[y++]=55296|_>>10&1023,k[y++]=56320|1023&_)}return p(k,y)},e.utf8border=function(m,f){var g;for((f=f||m.length)>m.length&&(f=m.length),g=f-1;0<=g&&(192&m[g])==128;)g--;return g<0||g===0?f:g+l[m[g]]>f?g:f}},{"./common":41}],43:[function(r,i,e){"use strict";i.exports=function(n,o,s,l){for(var h=65535&n|0,p=n>>>16&65535|0,m=0;s!==0;){for(s-=m=2e3<s?2e3:s;p=p+(h=h+o[l++]|0)|0,--m;);h%=65521,p%=65521}return h|p<<16|0}},{}],44:[function(r,i,e){"use strict";i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,i,e){"use strict";var n=function(){for(var o,s=[],l=0;l<256;l++){o=l;for(var h=0;h<8;h++)o=1&o?3988292384^o>>>1:o>>>1;s[l]=o}return s}();i.exports=function(o,s,l,h){var p=n,m=h+l;o^=-1;for(var f=h;f<m;f++)o=o>>>8^p[255&(o^s[f])];return-1^o}},{}],46:[function(r,i,e){"use strict";var n,o=r("../utils/common"),s=r("./trees"),l=r("./adler32"),h=r("./crc32"),p=r("./messages"),m=0,f=4,g=0,y=-2,_=-1,w=4,A=2,k=8,R=9,q=286,X=30,ie=19,ae=2*q+1,be=15,me=3,fe=258,ge=fe+me+1,ue=42,se=113,te=1,Se=2,Te=3,Ee=4;function je(he,st){return he.msg=p[st],st}function Ne(he){return(he<<1)-(4<he?9:0)}function ze(he){for(var st=he.length;0<=--st;)he[st]=0}function Re(he){var st=he.state,Je=st.pending;Je>he.avail_out&&(Je=he.avail_out),Je!==0&&(o.arraySet(he.output,st.pending_buf,st.pending_out,Je,he.next_out),he.next_out+=Je,st.pending_out+=Je,he.total_out+=Je,he.avail_out-=Je,st.pending-=Je,st.pending===0&&(st.pending_out=0))}function Ge(he,st){s._tr_flush_block(he,0<=he.block_start?he.block_start:-1,he.strstart-he.block_start,st),he.block_start=he.strstart,Re(he.strm)}function He(he,st){he.pending_buf[he.pending++]=st}function ye(he,st){he.pending_buf[he.pending++]=st>>>8&255,he.pending_buf[he.pending++]=255&st}function Ae(he,st){var Je,de,ke=he.max_chain_length,Ze=he.strstart,vt=he.prev_length,tt=he.nice_match,ot=he.strstart>he.w_size-ge?he.strstart-(he.w_size-ge):0,wt=he.window,Mt=he.w_mask,St=he.prev,ei=he.strstart+fe,Jt=wt[Ze+vt-1],Ut=wt[Ze+vt];he.prev_length>=he.good_match&&(ke>>=2),tt>he.lookahead&&(tt=he.lookahead);do if(wt[(Je=st)+vt]===Ut&&wt[Je+vt-1]===Jt&&wt[Je]===wt[Ze]&&wt[++Je]===wt[Ze+1]){Ze+=2,Je++;do;while(wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&wt[++Ze]===wt[++Je]&&Ze<ei);if(de=fe-(ei-Ze),Ze=ei-fe,vt<de){if(he.match_start=st,tt<=(vt=de))break;Jt=wt[Ze+vt-1],Ut=wt[Ze+vt]}}while((st=St[st&Mt])>ot&&--ke!=0);return vt<=he.lookahead?vt:he.lookahead}function Le(he){var st,Je,de,ke,Ze,vt,tt,ot,wt,Mt,St=he.w_size;do{if(ke=he.window_size-he.lookahead-he.strstart,he.strstart>=St+(St-ge)){for(o.arraySet(he.window,he.window,St,St,0),he.match_start-=St,he.strstart-=St,he.block_start-=St,st=Je=he.hash_size;de=he.head[--st],he.head[st]=St<=de?de-St:0,--Je;);for(st=Je=St;de=he.prev[--st],he.prev[st]=St<=de?de-St:0,--Je;);ke+=St}if(he.strm.avail_in===0)break;if(vt=he.strm,tt=he.window,ot=he.strstart+he.lookahead,wt=ke,Mt=void 0,Mt=vt.avail_in,wt<Mt&&(Mt=wt),Je=Mt===0?0:(vt.avail_in-=Mt,o.arraySet(tt,vt.input,vt.next_in,Mt,ot),vt.state.wrap===1?vt.adler=l(vt.adler,tt,Mt,ot):vt.state.wrap===2&&(vt.adler=h(vt.adler,tt,Mt,ot)),vt.next_in+=Mt,vt.total_in+=Mt,Mt),he.lookahead+=Je,he.lookahead+he.insert>=me)for(Ze=he.strstart-he.insert,he.ins_h=he.window[Ze],he.ins_h=(he.ins_h<<he.hash_shift^he.window[Ze+1])&he.hash_mask;he.insert&&(he.ins_h=(he.ins_h<<he.hash_shift^he.window[Ze+me-1])&he.hash_mask,he.prev[Ze&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=Ze,Ze++,he.insert--,!(he.lookahead+he.insert<me)););}while(he.lookahead<ge&&he.strm.avail_in!==0)}function Ye(he,st){for(var Je,de;;){if(he.lookahead<ge){if(Le(he),he.lookahead<ge&&st===m)return te;if(he.lookahead===0)break}if(Je=0,he.lookahead>=me&&(he.ins_h=(he.ins_h<<he.hash_shift^he.window[he.strstart+me-1])&he.hash_mask,Je=he.prev[he.strstart&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=he.strstart),Je!==0&&he.strstart-Je<=he.w_size-ge&&(he.match_length=Ae(he,Je)),he.match_length>=me)if(de=s._tr_tally(he,he.strstart-he.match_start,he.match_length-me),he.lookahead-=he.match_length,he.match_length<=he.max_lazy_match&&he.lookahead>=me){for(he.match_length--;he.strstart++,he.ins_h=(he.ins_h<<he.hash_shift^he.window[he.strstart+me-1])&he.hash_mask,Je=he.prev[he.strstart&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=he.strstart,--he.match_length!=0;);he.strstart++}else he.strstart+=he.match_length,he.match_length=0,he.ins_h=he.window[he.strstart],he.ins_h=(he.ins_h<<he.hash_shift^he.window[he.strstart+1])&he.hash_mask;else de=s._tr_tally(he,0,he.window[he.strstart]),he.lookahead--,he.strstart++;if(de&&(Ge(he,!1),he.strm.avail_out===0))return te}return he.insert=he.strstart<me-1?he.strstart:me-1,st===f?(Ge(he,!0),he.strm.avail_out===0?Te:Ee):he.last_lit&&(Ge(he,!1),he.strm.avail_out===0)?te:Se}function qe(he,st){for(var Je,de,ke;;){if(he.lookahead<ge){if(Le(he),he.lookahead<ge&&st===m)return te;if(he.lookahead===0)break}if(Je=0,he.lookahead>=me&&(he.ins_h=(he.ins_h<<he.hash_shift^he.window[he.strstart+me-1])&he.hash_mask,Je=he.prev[he.strstart&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=he.strstart),he.prev_length=he.match_length,he.prev_match=he.match_start,he.match_length=me-1,Je!==0&&he.prev_length<he.max_lazy_match&&he.strstart-Je<=he.w_size-ge&&(he.match_length=Ae(he,Je),he.match_length<=5&&(he.strategy===1||he.match_length===me&&4096<he.strstart-he.match_start)&&(he.match_length=me-1)),he.prev_length>=me&&he.match_length<=he.prev_length){for(ke=he.strstart+he.lookahead-me,de=s._tr_tally(he,he.strstart-1-he.prev_match,he.prev_length-me),he.lookahead-=he.prev_length-1,he.prev_length-=2;++he.strstart<=ke&&(he.ins_h=(he.ins_h<<he.hash_shift^he.window[he.strstart+me-1])&he.hash_mask,Je=he.prev[he.strstart&he.w_mask]=he.head[he.ins_h],he.head[he.ins_h]=he.strstart),--he.prev_length!=0;);if(he.match_available=0,he.match_length=me-1,he.strstart++,de&&(Ge(he,!1),he.strm.avail_out===0))return te}else if(he.match_available){if((de=s._tr_tally(he,0,he.window[he.strstart-1]))&&Ge(he,!1),he.strstart++,he.lookahead--,he.strm.avail_out===0)return te}else he.match_available=1,he.strstart++,he.lookahead--}return he.match_available&&(de=s._tr_tally(he,0,he.window[he.strstart-1]),he.match_available=0),he.insert=he.strstart<me-1?he.strstart:me-1,st===f?(Ge(he,!0),he.strm.avail_out===0?Te:Ee):he.last_lit&&(Ge(he,!1),he.strm.avail_out===0)?te:Se}function et(he,st,Je,de,ke){this.good_length=he,this.max_lazy=st,this.nice_length=Je,this.max_chain=de,this.func=ke}function ft(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*ae),this.dyn_dtree=new o.Buf16(2*(2*X+1)),this.bl_tree=new o.Buf16(2*(2*ie+1)),ze(this.dyn_ltree),ze(this.dyn_dtree),ze(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(be+1),this.heap=new o.Buf16(2*q+1),ze(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*q+1),ze(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function mt(he){var st;return he&&he.state?(he.total_in=he.total_out=0,he.data_type=A,(st=he.state).pending=0,st.pending_out=0,st.wrap<0&&(st.wrap=-st.wrap),st.status=st.wrap?ue:se,he.adler=st.wrap===2?0:1,st.last_flush=m,s._tr_init(st),g):je(he,y)}function At(he){var st=mt(he);return st===g&&function(Je){Je.window_size=2*Je.w_size,ze(Je.head),Je.max_lazy_match=n[Je.level].max_lazy,Je.good_match=n[Je.level].good_length,Je.nice_match=n[Je.level].nice_length,Je.max_chain_length=n[Je.level].max_chain,Je.strstart=0,Je.block_start=0,Je.lookahead=0,Je.insert=0,Je.match_length=Je.prev_length=me-1,Je.match_available=0,Je.ins_h=0}(he.state),st}function ht(he,st,Je,de,ke,Ze){if(!he)return y;var vt=1;if(st===_&&(st=6),de<0?(vt=0,de=-de):15<de&&(vt=2,de-=16),ke<1||R<ke||Je!==k||de<8||15<de||st<0||9<st||Ze<0||w<Ze)return je(he,y);de===8&&(de=9);var tt=new ft;return(he.state=tt).strm=he,tt.wrap=vt,tt.gzhead=null,tt.w_bits=de,tt.w_size=1<<tt.w_bits,tt.w_mask=tt.w_size-1,tt.hash_bits=ke+7,tt.hash_size=1<<tt.hash_bits,tt.hash_mask=tt.hash_size-1,tt.hash_shift=~~((tt.hash_bits+me-1)/me),tt.window=new o.Buf8(2*tt.w_size),tt.head=new o.Buf16(tt.hash_size),tt.prev=new o.Buf16(tt.w_size),tt.lit_bufsize=1<<ke+6,tt.pending_buf_size=4*tt.lit_bufsize,tt.pending_buf=new o.Buf8(tt.pending_buf_size),tt.d_buf=1*tt.lit_bufsize,tt.l_buf=3*tt.lit_bufsize,tt.level=st,tt.strategy=Ze,tt.method=Je,At(he)}n=[new et(0,0,0,0,function(he,st){var Je=65535;for(Je>he.pending_buf_size-5&&(Je=he.pending_buf_size-5);;){if(he.lookahead<=1){if(Le(he),he.lookahead===0&&st===m)return te;if(he.lookahead===0)break}he.strstart+=he.lookahead,he.lookahead=0;var de=he.block_start+Je;if((he.strstart===0||he.strstart>=de)&&(he.lookahead=he.strstart-de,he.strstart=de,Ge(he,!1),he.strm.avail_out===0)||he.strstart-he.block_start>=he.w_size-ge&&(Ge(he,!1),he.strm.avail_out===0))return te}return he.insert=0,st===f?(Ge(he,!0),he.strm.avail_out===0?Te:Ee):(he.strstart>he.block_start&&(Ge(he,!1),he.strm.avail_out),te)}),new et(4,4,8,4,Ye),new et(4,5,16,8,Ye),new et(4,6,32,32,Ye),new et(4,4,16,16,qe),new et(8,16,32,32,qe),new et(8,16,128,128,qe),new et(8,32,128,256,qe),new et(32,128,258,1024,qe),new et(32,258,258,4096,qe)],e.deflateInit=function(he,st){return ht(he,st,k,15,8,0)},e.deflateInit2=ht,e.deflateReset=At,e.deflateResetKeep=mt,e.deflateSetHeader=function(he,st){return he&&he.state?he.state.wrap!==2?y:(he.state.gzhead=st,g):y},e.deflate=function(he,st){var Je,de,ke,Ze;if(!he||!he.state||5<st||st<0)return he?je(he,y):y;if(de=he.state,!he.output||!he.input&&he.avail_in!==0||de.status===666&&st!==f)return je(he,he.avail_out===0?-5:y);if(de.strm=he,Je=de.last_flush,de.last_flush=st,de.status===ue)if(de.wrap===2)he.adler=0,He(de,31),He(de,139),He(de,8),de.gzhead?(He(de,(de.gzhead.text?1:0)+(de.gzhead.hcrc?2:0)+(de.gzhead.extra?4:0)+(de.gzhead.name?8:0)+(de.gzhead.comment?16:0)),He(de,255&de.gzhead.time),He(de,de.gzhead.time>>8&255),He(de,de.gzhead.time>>16&255),He(de,de.gzhead.time>>24&255),He(de,de.level===9?2:2<=de.strategy||de.level<2?4:0),He(de,255&de.gzhead.os),de.gzhead.extra&&de.gzhead.extra.length&&(He(de,255&de.gzhead.extra.length),He(de,de.gzhead.extra.length>>8&255)),de.gzhead.hcrc&&(he.adler=h(he.adler,de.pending_buf,de.pending,0)),de.gzindex=0,de.status=69):(He(de,0),He(de,0),He(de,0),He(de,0),He(de,0),He(de,de.level===9?2:2<=de.strategy||de.level<2?4:0),He(de,3),de.status=se);else{var vt=k+(de.w_bits-8<<4)<<8;vt|=(2<=de.strategy||de.level<2?0:de.level<6?1:de.level===6?2:3)<<6,de.strstart!==0&&(vt|=32),vt+=31-vt%31,de.status=se,ye(de,vt),de.strstart!==0&&(ye(de,he.adler>>>16),ye(de,65535&he.adler)),he.adler=1}if(de.status===69)if(de.gzhead.extra){for(ke=de.pending;de.gzindex<(65535&de.gzhead.extra.length)&&(de.pending!==de.pending_buf_size||(de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),Re(he),ke=de.pending,de.pending!==de.pending_buf_size));)He(de,255&de.gzhead.extra[de.gzindex]),de.gzindex++;de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),de.gzindex===de.gzhead.extra.length&&(de.gzindex=0,de.status=73)}else de.status=73;if(de.status===73)if(de.gzhead.name){ke=de.pending;do{if(de.pending===de.pending_buf_size&&(de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),Re(he),ke=de.pending,de.pending===de.pending_buf_size)){Ze=1;break}Ze=de.gzindex<de.gzhead.name.length?255&de.gzhead.name.charCodeAt(de.gzindex++):0,He(de,Ze)}while(Ze!==0);de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),Ze===0&&(de.gzindex=0,de.status=91)}else de.status=91;if(de.status===91)if(de.gzhead.comment){ke=de.pending;do{if(de.pending===de.pending_buf_size&&(de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),Re(he),ke=de.pending,de.pending===de.pending_buf_size)){Ze=1;break}Ze=de.gzindex<de.gzhead.comment.length?255&de.gzhead.comment.charCodeAt(de.gzindex++):0,He(de,Ze)}while(Ze!==0);de.gzhead.hcrc&&de.pending>ke&&(he.adler=h(he.adler,de.pending_buf,de.pending-ke,ke)),Ze===0&&(de.status=103)}else de.status=103;if(de.status===103&&(de.gzhead.hcrc?(de.pending+2>de.pending_buf_size&&Re(he),de.pending+2<=de.pending_buf_size&&(He(de,255&he.adler),He(de,he.adler>>8&255),he.adler=0,de.status=se)):de.status=se),de.pending!==0){if(Re(he),he.avail_out===0)return de.last_flush=-1,g}else if(he.avail_in===0&&Ne(st)<=Ne(Je)&&st!==f)return je(he,-5);if(de.status===666&&he.avail_in!==0)return je(he,-5);if(he.avail_in!==0||de.lookahead!==0||st!==m&&de.status!==666){var tt=de.strategy===2?function(ot,wt){for(var Mt;;){if(ot.lookahead===0&&(Le(ot),ot.lookahead===0)){if(wt===m)return te;break}if(ot.match_length=0,Mt=s._tr_tally(ot,0,ot.window[ot.strstart]),ot.lookahead--,ot.strstart++,Mt&&(Ge(ot,!1),ot.strm.avail_out===0))return te}return ot.insert=0,wt===f?(Ge(ot,!0),ot.strm.avail_out===0?Te:Ee):ot.last_lit&&(Ge(ot,!1),ot.strm.avail_out===0)?te:Se}(de,st):de.strategy===3?function(ot,wt){for(var Mt,St,ei,Jt,Ut=ot.window;;){if(ot.lookahead<=fe){if(Le(ot),ot.lookahead<=fe&&wt===m)return te;if(ot.lookahead===0)break}if(ot.match_length=0,ot.lookahead>=me&&0<ot.strstart&&(St=Ut[ei=ot.strstart-1])===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]){Jt=ot.strstart+fe;do;while(St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&St===Ut[++ei]&&ei<Jt);ot.match_length=fe-(Jt-ei),ot.match_length>ot.lookahead&&(ot.match_length=ot.lookahead)}if(ot.match_length>=me?(Mt=s._tr_tally(ot,1,ot.match_length-me),ot.lookahead-=ot.match_length,ot.strstart+=ot.match_length,ot.match_length=0):(Mt=s._tr_tally(ot,0,ot.window[ot.strstart]),ot.lookahead--,ot.strstart++),Mt&&(Ge(ot,!1),ot.strm.avail_out===0))return te}return ot.insert=0,wt===f?(Ge(ot,!0),ot.strm.avail_out===0?Te:Ee):ot.last_lit&&(Ge(ot,!1),ot.strm.avail_out===0)?te:Se}(de,st):n[de.level].func(de,st);if(tt!==Te&&tt!==Ee||(de.status=666),tt===te||tt===Te)return he.avail_out===0&&(de.last_flush=-1),g;if(tt===Se&&(st===1?s._tr_align(de):st!==5&&(s._tr_stored_block(de,0,0,!1),st===3&&(ze(de.head),de.lookahead===0&&(de.strstart=0,de.block_start=0,de.insert=0))),Re(he),he.avail_out===0))return de.last_flush=-1,g}return st!==f?g:de.wrap<=0?1:(de.wrap===2?(He(de,255&he.adler),He(de,he.adler>>8&255),He(de,he.adler>>16&255),He(de,he.adler>>24&255),He(de,255&he.total_in),He(de,he.total_in>>8&255),He(de,he.total_in>>16&255),He(de,he.total_in>>24&255)):(ye(de,he.adler>>>16),ye(de,65535&he.adler)),Re(he),0<de.wrap&&(de.wrap=-de.wrap),de.pending!==0?g:1)},e.deflateEnd=function(he){var st;return he&&he.state?(st=he.state.status)!==ue&&st!==69&&st!==73&&st!==91&&st!==103&&st!==se&&st!==666?je(he,y):(he.state=null,st===se?je(he,-3):g):y},e.deflateSetDictionary=function(he,st){var Je,de,ke,Ze,vt,tt,ot,wt,Mt=st.length;if(!he||!he.state||(Ze=(Je=he.state).wrap)===2||Ze===1&&Je.status!==ue||Je.lookahead)return y;for(Ze===1&&(he.adler=l(he.adler,st,Mt,0)),Je.wrap=0,Mt>=Je.w_size&&(Ze===0&&(ze(Je.head),Je.strstart=0,Je.block_start=0,Je.insert=0),wt=new o.Buf8(Je.w_size),o.arraySet(wt,st,Mt-Je.w_size,Je.w_size,0),st=wt,Mt=Je.w_size),vt=he.avail_in,tt=he.next_in,ot=he.input,he.avail_in=Mt,he.next_in=0,he.input=st,Le(Je);Je.lookahead>=me;){for(de=Je.strstart,ke=Je.lookahead-(me-1);Je.ins_h=(Je.ins_h<<Je.hash_shift^Je.window[de+me-1])&Je.hash_mask,Je.prev[de&Je.w_mask]=Je.head[Je.ins_h],Je.head[Je.ins_h]=de,de++,--ke;);Je.strstart=de,Je.lookahead=me-1,Le(Je)}return Je.strstart+=Je.lookahead,Je.block_start=Je.strstart,Je.insert=Je.lookahead,Je.lookahead=0,Je.match_length=Je.prev_length=me-1,Je.match_available=0,he.next_in=tt,he.input=ot,he.avail_in=vt,Je.wrap=Ze,g},e.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,i,e){"use strict";i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,i,e){"use strict";i.exports=function(n,o){var s,l,h,p,m,f,g,y,_,w,A,k,R,q,X,ie,ae,be,me,fe,ge,ue,se,te,Se;s=n.state,l=n.next_in,te=n.input,h=l+(n.avail_in-5),p=n.next_out,Se=n.output,m=p-(o-n.avail_out),f=p+(n.avail_out-257),g=s.dmax,y=s.wsize,_=s.whave,w=s.wnext,A=s.window,k=s.hold,R=s.bits,q=s.lencode,X=s.distcode,ie=(1<<s.lenbits)-1,ae=(1<<s.distbits)-1;e:do{R<15&&(k+=te[l++]<<R,R+=8,k+=te[l++]<<R,R+=8),be=q[k&ie];t:for(;;){if(k>>>=me=be>>>24,R-=me,(me=be>>>16&255)===0)Se[p++]=65535&be;else{if(!(16&me)){if(!(64&me)){be=q[(65535&be)+(k&(1<<me)-1)];continue t}if(32&me){s.mode=12;break e}n.msg="invalid literal/length code",s.mode=30;break e}fe=65535&be,(me&=15)&&(R<me&&(k+=te[l++]<<R,R+=8),fe+=k&(1<<me)-1,k>>>=me,R-=me),R<15&&(k+=te[l++]<<R,R+=8,k+=te[l++]<<R,R+=8),be=X[k&ae];i:for(;;){if(k>>>=me=be>>>24,R-=me,!(16&(me=be>>>16&255))){if(!(64&me)){be=X[(65535&be)+(k&(1<<me)-1)];continue i}n.msg="invalid distance code",s.mode=30;break e}if(ge=65535&be,R<(me&=15)&&(k+=te[l++]<<R,(R+=8)<me&&(k+=te[l++]<<R,R+=8)),g<(ge+=k&(1<<me)-1)){n.msg="invalid distance too far back",s.mode=30;break e}if(k>>>=me,R-=me,(me=p-m)<ge){if(_<(me=ge-me)&&s.sane){n.msg="invalid distance too far back",s.mode=30;break e}if(se=A,(ue=0)===w){if(ue+=y-me,me<fe){for(fe-=me;Se[p++]=A[ue++],--me;);ue=p-ge,se=Se}}else if(w<me){if(ue+=y+w-me,(me-=w)<fe){for(fe-=me;Se[p++]=A[ue++],--me;);if(ue=0,w<fe){for(fe-=me=w;Se[p++]=A[ue++],--me;);ue=p-ge,se=Se}}}else if(ue+=w-me,me<fe){for(fe-=me;Se[p++]=A[ue++],--me;);ue=p-ge,se=Se}for(;2<fe;)Se[p++]=se[ue++],Se[p++]=se[ue++],Se[p++]=se[ue++],fe-=3;fe&&(Se[p++]=se[ue++],1<fe&&(Se[p++]=se[ue++]))}else{for(ue=p-ge;Se[p++]=Se[ue++],Se[p++]=Se[ue++],Se[p++]=Se[ue++],2<(fe-=3););fe&&(Se[p++]=Se[ue++],1<fe&&(Se[p++]=Se[ue++]))}break}}break}}while(l<h&&p<f);l-=fe=R>>3,k&=(1<<(R-=fe<<3))-1,n.next_in=l,n.next_out=p,n.avail_in=l<h?h-l+5:5-(l-h),n.avail_out=p<f?f-p+257:257-(p-f),s.hold=k,s.bits=R}},{}],49:[function(r,i,e){"use strict";var n=r("../utils/common"),o=r("./adler32"),s=r("./crc32"),l=r("./inffast"),h=r("./inftrees"),p=1,m=2,f=0,g=-2,y=1,_=852,w=592;function A(ue){return(ue>>>24&255)+(ue>>>8&65280)+((65280&ue)<<8)+((255&ue)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function R(ue){var se;return ue&&ue.state?(se=ue.state,ue.total_in=ue.total_out=se.total=0,ue.msg="",se.wrap&&(ue.adler=1&se.wrap),se.mode=y,se.last=0,se.havedict=0,se.dmax=32768,se.head=null,se.hold=0,se.bits=0,se.lencode=se.lendyn=new n.Buf32(_),se.distcode=se.distdyn=new n.Buf32(w),se.sane=1,se.back=-1,f):g}function q(ue){var se;return ue&&ue.state?((se=ue.state).wsize=0,se.whave=0,se.wnext=0,R(ue)):g}function X(ue,se){var te,Se;return ue&&ue.state?(Se=ue.state,se<0?(te=0,se=-se):(te=1+(se>>4),se<48&&(se&=15)),se&&(se<8||15<se)?g:(Se.window!==null&&Se.wbits!==se&&(Se.window=null),Se.wrap=te,Se.wbits=se,q(ue))):g}function ie(ue,se){var te,Se;return ue?(Se=new k,(ue.state=Se).window=null,(te=X(ue,se))!==f&&(ue.state=null),te):g}var ae,be,me=!0;function fe(ue){if(me){var se;for(ae=new n.Buf32(512),be=new n.Buf32(32),se=0;se<144;)ue.lens[se++]=8;for(;se<256;)ue.lens[se++]=9;for(;se<280;)ue.lens[se++]=7;for(;se<288;)ue.lens[se++]=8;for(h(p,ue.lens,0,288,ae,0,ue.work,{bits:9}),se=0;se<32;)ue.lens[se++]=5;h(m,ue.lens,0,32,be,0,ue.work,{bits:5}),me=!1}ue.lencode=ae,ue.lenbits=9,ue.distcode=be,ue.distbits=5}function ge(ue,se,te,Se){var Te,Ee=ue.state;return Ee.window===null&&(Ee.wsize=1<<Ee.wbits,Ee.wnext=0,Ee.whave=0,Ee.window=new n.Buf8(Ee.wsize)),Se>=Ee.wsize?(n.arraySet(Ee.window,se,te-Ee.wsize,Ee.wsize,0),Ee.wnext=0,Ee.whave=Ee.wsize):(Se<(Te=Ee.wsize-Ee.wnext)&&(Te=Se),n.arraySet(Ee.window,se,te-Se,Te,Ee.wnext),(Se-=Te)?(n.arraySet(Ee.window,se,te-Se,Se,0),Ee.wnext=Se,Ee.whave=Ee.wsize):(Ee.wnext+=Te,Ee.wnext===Ee.wsize&&(Ee.wnext=0),Ee.whave<Ee.wsize&&(Ee.whave+=Te))),0}e.inflateReset=q,e.inflateReset2=X,e.inflateResetKeep=R,e.inflateInit=function(ue){return ie(ue,15)},e.inflateInit2=ie,e.inflate=function(ue,se){var te,Se,Te,Ee,je,Ne,ze,Re,Ge,He,ye,Ae,Le,Ye,qe,et,ft,mt,At,ht,he,st,Je,de,ke=0,Ze=new n.Buf8(4),vt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ue||!ue.state||!ue.output||!ue.input&&ue.avail_in!==0)return g;(te=ue.state).mode===12&&(te.mode=13),je=ue.next_out,Te=ue.output,ze=ue.avail_out,Ee=ue.next_in,Se=ue.input,Ne=ue.avail_in,Re=te.hold,Ge=te.bits,He=Ne,ye=ze,st=f;e:for(;;)switch(te.mode){case y:if(te.wrap===0){te.mode=13;break}for(;Ge<16;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(2&te.wrap&&Re===35615){Ze[te.check=0]=255&Re,Ze[1]=Re>>>8&255,te.check=s(te.check,Ze,2,0),Ge=Re=0,te.mode=2;break}if(te.flags=0,te.head&&(te.head.done=!1),!(1&te.wrap)||(((255&Re)<<8)+(Re>>8))%31){ue.msg="incorrect header check",te.mode=30;break}if((15&Re)!=8){ue.msg="unknown compression method",te.mode=30;break}if(Ge-=4,he=8+(15&(Re>>>=4)),te.wbits===0)te.wbits=he;else if(he>te.wbits){ue.msg="invalid window size",te.mode=30;break}te.dmax=1<<he,ue.adler=te.check=1,te.mode=512&Re?10:12,Ge=Re=0;break;case 2:for(;Ge<16;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(te.flags=Re,(255&te.flags)!=8){ue.msg="unknown compression method",te.mode=30;break}if(57344&te.flags){ue.msg="unknown header flags set",te.mode=30;break}te.head&&(te.head.text=Re>>8&1),512&te.flags&&(Ze[0]=255&Re,Ze[1]=Re>>>8&255,te.check=s(te.check,Ze,2,0)),Ge=Re=0,te.mode=3;case 3:for(;Ge<32;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.head&&(te.head.time=Re),512&te.flags&&(Ze[0]=255&Re,Ze[1]=Re>>>8&255,Ze[2]=Re>>>16&255,Ze[3]=Re>>>24&255,te.check=s(te.check,Ze,4,0)),Ge=Re=0,te.mode=4;case 4:for(;Ge<16;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.head&&(te.head.xflags=255&Re,te.head.os=Re>>8),512&te.flags&&(Ze[0]=255&Re,Ze[1]=Re>>>8&255,te.check=s(te.check,Ze,2,0)),Ge=Re=0,te.mode=5;case 5:if(1024&te.flags){for(;Ge<16;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.length=Re,te.head&&(te.head.extra_len=Re),512&te.flags&&(Ze[0]=255&Re,Ze[1]=Re>>>8&255,te.check=s(te.check,Ze,2,0)),Ge=Re=0}else te.head&&(te.head.extra=null);te.mode=6;case 6:if(1024&te.flags&&(Ne<(Ae=te.length)&&(Ae=Ne),Ae&&(te.head&&(he=te.head.extra_len-te.length,te.head.extra||(te.head.extra=new Array(te.head.extra_len)),n.arraySet(te.head.extra,Se,Ee,Ae,he)),512&te.flags&&(te.check=s(te.check,Se,Ae,Ee)),Ne-=Ae,Ee+=Ae,te.length-=Ae),te.length))break e;te.length=0,te.mode=7;case 7:if(2048&te.flags){if(Ne===0)break e;for(Ae=0;he=Se[Ee+Ae++],te.head&&he&&te.length<65536&&(te.head.name+=String.fromCharCode(he)),he&&Ae<Ne;);if(512&te.flags&&(te.check=s(te.check,Se,Ae,Ee)),Ne-=Ae,Ee+=Ae,he)break e}else te.head&&(te.head.name=null);te.length=0,te.mode=8;case 8:if(4096&te.flags){if(Ne===0)break e;for(Ae=0;he=Se[Ee+Ae++],te.head&&he&&te.length<65536&&(te.head.comment+=String.fromCharCode(he)),he&&Ae<Ne;);if(512&te.flags&&(te.check=s(te.check,Se,Ae,Ee)),Ne-=Ae,Ee+=Ae,he)break e}else te.head&&(te.head.comment=null);te.mode=9;case 9:if(512&te.flags){for(;Ge<16;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(Re!==(65535&te.check)){ue.msg="header crc mismatch",te.mode=30;break}Ge=Re=0}te.head&&(te.head.hcrc=te.flags>>9&1,te.head.done=!0),ue.adler=te.check=0,te.mode=12;break;case 10:for(;Ge<32;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}ue.adler=te.check=A(Re),Ge=Re=0,te.mode=11;case 11:if(te.havedict===0)return ue.next_out=je,ue.avail_out=ze,ue.next_in=Ee,ue.avail_in=Ne,te.hold=Re,te.bits=Ge,2;ue.adler=te.check=1,te.mode=12;case 12:if(se===5||se===6)break e;case 13:if(te.last){Re>>>=7&Ge,Ge-=7&Ge,te.mode=27;break}for(;Ge<3;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}switch(te.last=1&Re,Ge-=1,3&(Re>>>=1)){case 0:te.mode=14;break;case 1:if(fe(te),te.mode=20,se!==6)break;Re>>>=2,Ge-=2;break e;case 2:te.mode=17;break;case 3:ue.msg="invalid block type",te.mode=30}Re>>>=2,Ge-=2;break;case 14:for(Re>>>=7&Ge,Ge-=7&Ge;Ge<32;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if((65535&Re)!=(Re>>>16^65535)){ue.msg="invalid stored block lengths",te.mode=30;break}if(te.length=65535&Re,Ge=Re=0,te.mode=15,se===6)break e;case 15:te.mode=16;case 16:if(Ae=te.length){if(Ne<Ae&&(Ae=Ne),ze<Ae&&(Ae=ze),Ae===0)break e;n.arraySet(Te,Se,Ee,Ae,je),Ne-=Ae,Ee+=Ae,ze-=Ae,je+=Ae,te.length-=Ae;break}te.mode=12;break;case 17:for(;Ge<14;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(te.nlen=257+(31&Re),Re>>>=5,Ge-=5,te.ndist=1+(31&Re),Re>>>=5,Ge-=5,te.ncode=4+(15&Re),Re>>>=4,Ge-=4,286<te.nlen||30<te.ndist){ue.msg="too many length or distance symbols",te.mode=30;break}te.have=0,te.mode=18;case 18:for(;te.have<te.ncode;){for(;Ge<3;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.lens[vt[te.have++]]=7&Re,Re>>>=3,Ge-=3}for(;te.have<19;)te.lens[vt[te.have++]]=0;if(te.lencode=te.lendyn,te.lenbits=7,Je={bits:te.lenbits},st=h(0,te.lens,0,19,te.lencode,0,te.work,Je),te.lenbits=Je.bits,st){ue.msg="invalid code lengths set",te.mode=30;break}te.have=0,te.mode=19;case 19:for(;te.have<te.nlen+te.ndist;){for(;et=(ke=te.lencode[Re&(1<<te.lenbits)-1])>>>16&255,ft=65535&ke,!((qe=ke>>>24)<=Ge);){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(ft<16)Re>>>=qe,Ge-=qe,te.lens[te.have++]=ft;else{if(ft===16){for(de=qe+2;Ge<de;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(Re>>>=qe,Ge-=qe,te.have===0){ue.msg="invalid bit length repeat",te.mode=30;break}he=te.lens[te.have-1],Ae=3+(3&Re),Re>>>=2,Ge-=2}else if(ft===17){for(de=qe+3;Ge<de;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}Ge-=qe,he=0,Ae=3+(7&(Re>>>=qe)),Re>>>=3,Ge-=3}else{for(de=qe+7;Ge<de;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}Ge-=qe,he=0,Ae=11+(127&(Re>>>=qe)),Re>>>=7,Ge-=7}if(te.have+Ae>te.nlen+te.ndist){ue.msg="invalid bit length repeat",te.mode=30;break}for(;Ae--;)te.lens[te.have++]=he}}if(te.mode===30)break;if(te.lens[256]===0){ue.msg="invalid code -- missing end-of-block",te.mode=30;break}if(te.lenbits=9,Je={bits:te.lenbits},st=h(p,te.lens,0,te.nlen,te.lencode,0,te.work,Je),te.lenbits=Je.bits,st){ue.msg="invalid literal/lengths set",te.mode=30;break}if(te.distbits=6,te.distcode=te.distdyn,Je={bits:te.distbits},st=h(m,te.lens,te.nlen,te.ndist,te.distcode,0,te.work,Je),te.distbits=Je.bits,st){ue.msg="invalid distances set",te.mode=30;break}if(te.mode=20,se===6)break e;case 20:te.mode=21;case 21:if(6<=Ne&&258<=ze){ue.next_out=je,ue.avail_out=ze,ue.next_in=Ee,ue.avail_in=Ne,te.hold=Re,te.bits=Ge,l(ue,ye),je=ue.next_out,Te=ue.output,ze=ue.avail_out,Ee=ue.next_in,Se=ue.input,Ne=ue.avail_in,Re=te.hold,Ge=te.bits,te.mode===12&&(te.back=-1);break}for(te.back=0;et=(ke=te.lencode[Re&(1<<te.lenbits)-1])>>>16&255,ft=65535&ke,!((qe=ke>>>24)<=Ge);){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(et&&!(240&et)){for(mt=qe,At=et,ht=ft;et=(ke=te.lencode[ht+((Re&(1<<mt+At)-1)>>mt)])>>>16&255,ft=65535&ke,!(mt+(qe=ke>>>24)<=Ge);){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}Re>>>=mt,Ge-=mt,te.back+=mt}if(Re>>>=qe,Ge-=qe,te.back+=qe,te.length=ft,et===0){te.mode=26;break}if(32&et){te.back=-1,te.mode=12;break}if(64&et){ue.msg="invalid literal/length code",te.mode=30;break}te.extra=15&et,te.mode=22;case 22:if(te.extra){for(de=te.extra;Ge<de;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.length+=Re&(1<<te.extra)-1,Re>>>=te.extra,Ge-=te.extra,te.back+=te.extra}te.was=te.length,te.mode=23;case 23:for(;et=(ke=te.distcode[Re&(1<<te.distbits)-1])>>>16&255,ft=65535&ke,!((qe=ke>>>24)<=Ge);){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(!(240&et)){for(mt=qe,At=et,ht=ft;et=(ke=te.distcode[ht+((Re&(1<<mt+At)-1)>>mt)])>>>16&255,ft=65535&ke,!(mt+(qe=ke>>>24)<=Ge);){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}Re>>>=mt,Ge-=mt,te.back+=mt}if(Re>>>=qe,Ge-=qe,te.back+=qe,64&et){ue.msg="invalid distance code",te.mode=30;break}te.offset=ft,te.extra=15&et,te.mode=24;case 24:if(te.extra){for(de=te.extra;Ge<de;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}te.offset+=Re&(1<<te.extra)-1,Re>>>=te.extra,Ge-=te.extra,te.back+=te.extra}if(te.offset>te.dmax){ue.msg="invalid distance too far back",te.mode=30;break}te.mode=25;case 25:if(ze===0)break e;if(Ae=ye-ze,te.offset>Ae){if((Ae=te.offset-Ae)>te.whave&&te.sane){ue.msg="invalid distance too far back",te.mode=30;break}Le=Ae>te.wnext?(Ae-=te.wnext,te.wsize-Ae):te.wnext-Ae,Ae>te.length&&(Ae=te.length),Ye=te.window}else Ye=Te,Le=je-te.offset,Ae=te.length;for(ze<Ae&&(Ae=ze),ze-=Ae,te.length-=Ae;Te[je++]=Ye[Le++],--Ae;);te.length===0&&(te.mode=21);break;case 26:if(ze===0)break e;Te[je++]=te.length,ze--,te.mode=21;break;case 27:if(te.wrap){for(;Ge<32;){if(Ne===0)break e;Ne--,Re|=Se[Ee++]<<Ge,Ge+=8}if(ye-=ze,ue.total_out+=ye,te.total+=ye,ye&&(ue.adler=te.check=te.flags?s(te.check,Te,ye,je-ye):o(te.check,Te,ye,je-ye)),ye=ze,(te.flags?Re:A(Re))!==te.check){ue.msg="incorrect data check",te.mode=30;break}Ge=Re=0}te.mode=28;case 28:if(te.wrap&&te.flags){for(;Ge<32;){if(Ne===0)break e;Ne--,Re+=Se[Ee++]<<Ge,Ge+=8}if(Re!==(4294967295&te.total)){ue.msg="incorrect length check",te.mode=30;break}Ge=Re=0}te.mode=29;case 29:st=1;break e;case 30:st=-3;break e;case 31:return-4;case 32:default:return g}return ue.next_out=je,ue.avail_out=ze,ue.next_in=Ee,ue.avail_in=Ne,te.hold=Re,te.bits=Ge,(te.wsize||ye!==ue.avail_out&&te.mode<30&&(te.mode<27||se!==4))&&ge(ue,ue.output,ue.next_out,ye-ue.avail_out)?(te.mode=31,-4):(He-=ue.avail_in,ye-=ue.avail_out,ue.total_in+=He,ue.total_out+=ye,te.total+=ye,te.wrap&&ye&&(ue.adler=te.check=te.flags?s(te.check,Te,ye,ue.next_out-ye):o(te.check,Te,ye,ue.next_out-ye)),ue.data_type=te.bits+(te.last?64:0)+(te.mode===12?128:0)+(te.mode===20||te.mode===15?256:0),(He==0&&ye===0||se===4)&&st===f&&(st=-5),st)},e.inflateEnd=function(ue){if(!ue||!ue.state)return g;var se=ue.state;return se.window&&(se.window=null),ue.state=null,f},e.inflateGetHeader=function(ue,se){var te;return ue&&ue.state&&2&(te=ue.state).wrap?((te.head=se).done=!1,f):g},e.inflateSetDictionary=function(ue,se){var te,Se=se.length;return ue&&ue.state?(te=ue.state).wrap!==0&&te.mode!==11?g:te.mode===11&&o(1,se,Se,0)!==te.check?-3:ge(ue,se,Se,Se)?(te.mode=31,-4):(te.havedict=1,f):g},e.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,i,e){"use strict";var n=r("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(p,m,f,g,y,_,w,A){var k,R,q,X,ie,ae,be,me,fe,ge=A.bits,ue=0,se=0,te=0,Se=0,Te=0,Ee=0,je=0,Ne=0,ze=0,Re=0,Ge=null,He=0,ye=new n.Buf16(16),Ae=new n.Buf16(16),Le=null,Ye=0;for(ue=0;ue<=15;ue++)ye[ue]=0;for(se=0;se<g;se++)ye[m[f+se]]++;for(Te=ge,Se=15;1<=Se&&ye[Se]===0;Se--);if(Se<Te&&(Te=Se),Se===0)return y[_++]=20971520,y[_++]=20971520,A.bits=1,0;for(te=1;te<Se&&ye[te]===0;te++);for(Te<te&&(Te=te),ue=Ne=1;ue<=15;ue++)if(Ne<<=1,(Ne-=ye[ue])<0)return-1;if(0<Ne&&(p===0||Se!==1))return-1;for(Ae[1]=0,ue=1;ue<15;ue++)Ae[ue+1]=Ae[ue]+ye[ue];for(se=0;se<g;se++)m[f+se]!==0&&(w[Ae[m[f+se]]++]=se);if(ae=p===0?(Ge=Le=w,19):p===1?(Ge=o,He-=257,Le=s,Ye-=257,256):(Ge=l,Le=h,-1),ue=te,ie=_,je=se=Re=0,q=-1,X=(ze=1<<(Ee=Te))-1,p===1&&852<ze||p===2&&592<ze)return 1;for(;;){for(be=ue-je,fe=w[se]<ae?(me=0,w[se]):w[se]>ae?(me=Le[Ye+w[se]],Ge[He+w[se]]):(me=96,0),k=1<<ue-je,te=R=1<<Ee;y[ie+(Re>>je)+(R-=k)]=be<<24|me<<16|fe|0,R!==0;);for(k=1<<ue-1;Re&k;)k>>=1;if(k!==0?(Re&=k-1,Re+=k):Re=0,se++,--ye[ue]==0){if(ue===Se)break;ue=m[f+w[se]]}if(Te<ue&&(Re&X)!==q){for(je===0&&(je=Te),ie+=te,Ne=1<<(Ee=ue-je);Ee+je<Se&&!((Ne-=ye[Ee+je])<=0);)Ee++,Ne<<=1;if(ze+=1<<Ee,p===1&&852<ze||p===2&&592<ze)return 1;y[q=Re&X]=Te<<24|Ee<<16|ie-_|0}}return Re!==0&&(y[ie+Re]=ue-je<<24|64<<16|0),A.bits=Te,0}},{"../utils/common":41}],51:[function(r,i,e){"use strict";i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,i,e){"use strict";var n=r("../utils/common"),o=0,s=1;function l(ke){for(var Ze=ke.length;0<=--Ze;)ke[Ze]=0}var h=0,p=29,m=256,f=m+1+p,g=30,y=19,_=2*f+1,w=15,A=16,k=7,R=256,q=16,X=17,ie=18,ae=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],be=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],me=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ge=new Array(2*(f+2));l(ge);var ue=new Array(2*g);l(ue);var se=new Array(512);l(se);var te=new Array(256);l(te);var Se=new Array(p);l(Se);var Te,Ee,je,Ne=new Array(g);function ze(ke,Ze,vt,tt,ot){this.static_tree=ke,this.extra_bits=Ze,this.extra_base=vt,this.elems=tt,this.max_length=ot,this.has_stree=ke&&ke.length}function Re(ke,Ze){this.dyn_tree=ke,this.max_code=0,this.stat_desc=Ze}function Ge(ke){return ke<256?se[ke]:se[256+(ke>>>7)]}function He(ke,Ze){ke.pending_buf[ke.pending++]=255&Ze,ke.pending_buf[ke.pending++]=Ze>>>8&255}function ye(ke,Ze,vt){ke.bi_valid>A-vt?(ke.bi_buf|=Ze<<ke.bi_valid&65535,He(ke,ke.bi_buf),ke.bi_buf=Ze>>A-ke.bi_valid,ke.bi_valid+=vt-A):(ke.bi_buf|=Ze<<ke.bi_valid&65535,ke.bi_valid+=vt)}function Ae(ke,Ze,vt){ye(ke,vt[2*Ze],vt[2*Ze+1])}function Le(ke,Ze){for(var vt=0;vt|=1&ke,ke>>>=1,vt<<=1,0<--Ze;);return vt>>>1}function Ye(ke,Ze,vt){var tt,ot,wt=new Array(w+1),Mt=0;for(tt=1;tt<=w;tt++)wt[tt]=Mt=Mt+vt[tt-1]<<1;for(ot=0;ot<=Ze;ot++){var St=ke[2*ot+1];St!==0&&(ke[2*ot]=Le(wt[St]++,St))}}function qe(ke){var Ze;for(Ze=0;Ze<f;Ze++)ke.dyn_ltree[2*Ze]=0;for(Ze=0;Ze<g;Ze++)ke.dyn_dtree[2*Ze]=0;for(Ze=0;Ze<y;Ze++)ke.bl_tree[2*Ze]=0;ke.dyn_ltree[2*R]=1,ke.opt_len=ke.static_len=0,ke.last_lit=ke.matches=0}function et(ke){8<ke.bi_valid?He(ke,ke.bi_buf):0<ke.bi_valid&&(ke.pending_buf[ke.pending++]=ke.bi_buf),ke.bi_buf=0,ke.bi_valid=0}function ft(ke,Ze,vt,tt){var ot=2*Ze,wt=2*vt;return ke[ot]<ke[wt]||ke[ot]===ke[wt]&&tt[Ze]<=tt[vt]}function mt(ke,Ze,vt){for(var tt=ke.heap[vt],ot=vt<<1;ot<=ke.heap_len&&(ot<ke.heap_len&&ft(Ze,ke.heap[ot+1],ke.heap[ot],ke.depth)&&ot++,!ft(Ze,tt,ke.heap[ot],ke.depth));)ke.heap[vt]=ke.heap[ot],vt=ot,ot<<=1;ke.heap[vt]=tt}function At(ke,Ze,vt){var tt,ot,wt,Mt,St=0;if(ke.last_lit!==0)for(;tt=ke.pending_buf[ke.d_buf+2*St]<<8|ke.pending_buf[ke.d_buf+2*St+1],ot=ke.pending_buf[ke.l_buf+St],St++,tt===0?Ae(ke,ot,Ze):(Ae(ke,(wt=te[ot])+m+1,Ze),(Mt=ae[wt])!==0&&ye(ke,ot-=Se[wt],Mt),Ae(ke,wt=Ge(--tt),vt),(Mt=be[wt])!==0&&ye(ke,tt-=Ne[wt],Mt)),St<ke.last_lit;);Ae(ke,R,Ze)}function ht(ke,Ze){var vt,tt,ot,wt=Ze.dyn_tree,Mt=Ze.stat_desc.static_tree,St=Ze.stat_desc.has_stree,ei=Ze.stat_desc.elems,Jt=-1;for(ke.heap_len=0,ke.heap_max=_,vt=0;vt<ei;vt++)wt[2*vt]!==0?(ke.heap[++ke.heap_len]=Jt=vt,ke.depth[vt]=0):wt[2*vt+1]=0;for(;ke.heap_len<2;)wt[2*(ot=ke.heap[++ke.heap_len]=Jt<2?++Jt:0)]=1,ke.depth[ot]=0,ke.opt_len--,St&&(ke.static_len-=Mt[2*ot+1]);for(Ze.max_code=Jt,vt=ke.heap_len>>1;1<=vt;vt--)mt(ke,wt,vt);for(ot=ei;vt=ke.heap[1],ke.heap[1]=ke.heap[ke.heap_len--],mt(ke,wt,1),tt=ke.heap[1],ke.heap[--ke.heap_max]=vt,ke.heap[--ke.heap_max]=tt,wt[2*ot]=wt[2*vt]+wt[2*tt],ke.depth[ot]=(ke.depth[vt]>=ke.depth[tt]?ke.depth[vt]:ke.depth[tt])+1,wt[2*vt+1]=wt[2*tt+1]=ot,ke.heap[1]=ot++,mt(ke,wt,1),2<=ke.heap_len;);ke.heap[--ke.heap_max]=ke.heap[1],function(Ut,pi){var yi,Kt,li,Ft,Nr,Qi,ji=pi.dyn_tree,cr=pi.max_code,Yr=pi.stat_desc.static_tree,Ci=pi.stat_desc.has_stree,pr=pi.stat_desc.extra_bits,Ai=pi.stat_desc.extra_base,Pi=pi.stat_desc.max_length,er=0;for(Ft=0;Ft<=w;Ft++)Ut.bl_count[Ft]=0;for(ji[2*Ut.heap[Ut.heap_max]+1]=0,yi=Ut.heap_max+1;yi<_;yi++)Pi<(Ft=ji[2*ji[2*(Kt=Ut.heap[yi])+1]+1]+1)&&(Ft=Pi,er++),ji[2*Kt+1]=Ft,cr<Kt||(Ut.bl_count[Ft]++,Nr=0,Ai<=Kt&&(Nr=pr[Kt-Ai]),Qi=ji[2*Kt],Ut.opt_len+=Qi*(Ft+Nr),Ci&&(Ut.static_len+=Qi*(Yr[2*Kt+1]+Nr)));if(er!==0){do{for(Ft=Pi-1;Ut.bl_count[Ft]===0;)Ft--;Ut.bl_count[Ft]--,Ut.bl_count[Ft+1]+=2,Ut.bl_count[Pi]--,er-=2}while(0<er);for(Ft=Pi;Ft!==0;Ft--)for(Kt=Ut.bl_count[Ft];Kt!==0;)cr<(li=Ut.heap[--yi])||(ji[2*li+1]!==Ft&&(Ut.opt_len+=(Ft-ji[2*li+1])*ji[2*li],ji[2*li+1]=Ft),Kt--)}}(ke,Ze),Ye(wt,Jt,ke.bl_count)}function he(ke,Ze,vt){var tt,ot,wt=-1,Mt=Ze[1],St=0,ei=7,Jt=4;for(Mt===0&&(ei=138,Jt=3),Ze[2*(vt+1)+1]=65535,tt=0;tt<=vt;tt++)ot=Mt,Mt=Ze[2*(tt+1)+1],++St<ei&&ot===Mt||(St<Jt?ke.bl_tree[2*ot]+=St:ot!==0?(ot!==wt&&ke.bl_tree[2*ot]++,ke.bl_tree[2*q]++):St<=10?ke.bl_tree[2*X]++:ke.bl_tree[2*ie]++,wt=ot,Jt=(St=0)===Mt?(ei=138,3):ot===Mt?(ei=6,3):(ei=7,4))}function st(ke,Ze,vt){var tt,ot,wt=-1,Mt=Ze[1],St=0,ei=7,Jt=4;for(Mt===0&&(ei=138,Jt=3),tt=0;tt<=vt;tt++)if(ot=Mt,Mt=Ze[2*(tt+1)+1],!(++St<ei&&ot===Mt)){if(St<Jt)for(;Ae(ke,ot,ke.bl_tree),--St!=0;);else ot!==0?(ot!==wt&&(Ae(ke,ot,ke.bl_tree),St--),Ae(ke,q,ke.bl_tree),ye(ke,St-3,2)):St<=10?(Ae(ke,X,ke.bl_tree),ye(ke,St-3,3)):(Ae(ke,ie,ke.bl_tree),ye(ke,St-11,7));wt=ot,Jt=(St=0)===Mt?(ei=138,3):ot===Mt?(ei=6,3):(ei=7,4)}}l(Ne);var Je=!1;function de(ke,Ze,vt,tt){ye(ke,(h<<1)+(tt?1:0),3),function(ot,wt,Mt,St){et(ot),St&&(He(ot,Mt),He(ot,~Mt)),n.arraySet(ot.pending_buf,ot.window,wt,Mt,ot.pending),ot.pending+=Mt}(ke,Ze,vt,!0)}e._tr_init=function(ke){Je||(function(){var Ze,vt,tt,ot,wt,Mt=new Array(w+1);for(ot=tt=0;ot<p-1;ot++)for(Se[ot]=tt,Ze=0;Ze<1<<ae[ot];Ze++)te[tt++]=ot;for(te[tt-1]=ot,ot=wt=0;ot<16;ot++)for(Ne[ot]=wt,Ze=0;Ze<1<<be[ot];Ze++)se[wt++]=ot;for(wt>>=7;ot<g;ot++)for(Ne[ot]=wt<<7,Ze=0;Ze<1<<be[ot]-7;Ze++)se[256+wt++]=ot;for(vt=0;vt<=w;vt++)Mt[vt]=0;for(Ze=0;Ze<=143;)ge[2*Ze+1]=8,Ze++,Mt[8]++;for(;Ze<=255;)ge[2*Ze+1]=9,Ze++,Mt[9]++;for(;Ze<=279;)ge[2*Ze+1]=7,Ze++,Mt[7]++;for(;Ze<=287;)ge[2*Ze+1]=8,Ze++,Mt[8]++;for(Ye(ge,f+1,Mt),Ze=0;Ze<g;Ze++)ue[2*Ze+1]=5,ue[2*Ze]=Le(Ze,5);Te=new ze(ge,ae,m+1,f,w),Ee=new ze(ue,be,0,g,w),je=new ze(new Array(0),me,0,y,k)}(),Je=!0),ke.l_desc=new Re(ke.dyn_ltree,Te),ke.d_desc=new Re(ke.dyn_dtree,Ee),ke.bl_desc=new Re(ke.bl_tree,je),ke.bi_buf=0,ke.bi_valid=0,qe(ke)},e._tr_stored_block=de,e._tr_flush_block=function(ke,Ze,vt,tt){var ot,wt,Mt=0;0<ke.level?(ke.strm.data_type===2&&(ke.strm.data_type=function(St){var ei,Jt=4093624447;for(ei=0;ei<=31;ei++,Jt>>>=1)if(1&Jt&&St.dyn_ltree[2*ei]!==0)return o;if(St.dyn_ltree[18]!==0||St.dyn_ltree[20]!==0||St.dyn_ltree[26]!==0)return s;for(ei=32;ei<m;ei++)if(St.dyn_ltree[2*ei]!==0)return s;return o}(ke)),ht(ke,ke.l_desc),ht(ke,ke.d_desc),Mt=function(St){var ei;for(he(St,St.dyn_ltree,St.l_desc.max_code),he(St,St.dyn_dtree,St.d_desc.max_code),ht(St,St.bl_desc),ei=y-1;3<=ei&&St.bl_tree[2*fe[ei]+1]===0;ei--);return St.opt_len+=3*(ei+1)+5+5+4,ei}(ke),ot=ke.opt_len+3+7>>>3,(wt=ke.static_len+3+7>>>3)<=ot&&(ot=wt)):ot=wt=vt+5,vt+4<=ot&&Ze!==-1?de(ke,Ze,vt,tt):ke.strategy===4||wt===ot?(ye(ke,2+(tt?1:0),3),At(ke,ge,ue)):(ye(ke,4+(tt?1:0),3),function(St,ei,Jt,Ut){var pi;for(ye(St,ei-257,5),ye(St,Jt-1,5),ye(St,Ut-4,4),pi=0;pi<Ut;pi++)ye(St,St.bl_tree[2*fe[pi]+1],3);st(St,St.dyn_ltree,ei-1),st(St,St.dyn_dtree,Jt-1)}(ke,ke.l_desc.max_code+1,ke.d_desc.max_code+1,Mt+1),At(ke,ke.dyn_ltree,ke.dyn_dtree)),qe(ke),tt&&et(ke)},e._tr_tally=function(ke,Ze,vt){return ke.pending_buf[ke.d_buf+2*ke.last_lit]=Ze>>>8&255,ke.pending_buf[ke.d_buf+2*ke.last_lit+1]=255&Ze,ke.pending_buf[ke.l_buf+ke.last_lit]=255&vt,ke.last_lit++,Ze===0?ke.dyn_ltree[2*vt]++:(ke.matches++,Ze--,ke.dyn_ltree[2*(te[vt]+m+1)]++,ke.dyn_dtree[2*Ge(Ze)]++),ke.last_lit===ke.lit_bufsize-1},e._tr_align=function(ke){ye(ke,2,3),Ae(ke,R,ge),function(Ze){Ze.bi_valid===16?(He(Ze,Ze.bi_buf),Ze.bi_buf=0,Ze.bi_valid=0):8<=Ze.bi_valid&&(Ze.pending_buf[Ze.pending++]=255&Ze.bi_buf,Ze.bi_buf>>=8,Ze.bi_valid-=8)}(ke)}},{"../utils/common":41}],53:[function(r,i,e){"use strict";i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,i,e){(function(n){(function(o,s){"use strict";if(!o.setImmediate){var l,h,p,m,f=1,g={},y=!1,_=o.document,w=Object.getPrototypeOf&&Object.getPrototypeOf(o);w=w&&w.setTimeout?w:o,l={}.toString.call(o.process)==="[object process]"?function(q){process.nextTick(function(){k(q)})}:function(){if(o.postMessage&&!o.importScripts){var q=!0,X=o.onmessage;return o.onmessage=function(){q=!1},o.postMessage("","*"),o.onmessage=X,q}}()?(m="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",R,!1):o.attachEvent("onmessage",R),function(q){o.postMessage(m+q,"*")}):o.MessageChannel?((p=new MessageChannel).port1.onmessage=function(q){k(q.data)},function(q){p.port2.postMessage(q)}):_&&"onreadystatechange"in _.createElement("script")?(h=_.documentElement,function(q){var X=_.createElement("script");X.onreadystatechange=function(){k(q),X.onreadystatechange=null,h.removeChild(X),X=null},h.appendChild(X)}):function(q){setTimeout(k,0,q)},w.setImmediate=function(q){typeof q!="function"&&(q=new Function(""+q));for(var X=new Array(arguments.length-1),ie=0;ie<X.length;ie++)X[ie]=arguments[ie+1];var ae={callback:q,args:X};return g[f]=ae,l(f),f++},w.clearImmediate=A}function A(q){delete g[q]}function k(q){if(y)setTimeout(k,0,q);else{var X=g[q];if(X){y=!0;try{(function(ie){var ae=ie.callback,be=ie.args;switch(be.length){case 0:ae();break;case 1:ae(be[0]);break;case 2:ae(be[0],be[1]);break;case 3:ae(be[0],be[1],be[2]);break;default:ae.apply(s,be)}})(X)}finally{A(q),y=!1}}}}function R(q){q.source===o&&typeof q.data=="string"&&q.data.indexOf(m)===0&&k(+q.data.slice(m.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var UU=Bd((UL,zL)=>{(function(r,i){typeof define=="function"&&define.amd?define([],i):typeof UL<"u"?i():(i(),r.FileSaver={})})(UL,function(){"use strict";function r(h,p){return typeof p>"u"?p={autoBom:!1}:typeof p!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),p={autoBom:!p}),p.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(h.type)?new Blob(["\uFEFF",h],{type:h.type}):h}function i(h,p,m){var f=new XMLHttpRequest;f.open("GET",h),f.responseType="blob",f.onload=function(){l(f.response,p,m)},f.onerror=function(){console.error("could not download file")},f.send()}function e(h){var p=new XMLHttpRequest;p.open("HEAD",h,!1);try{p.send()}catch{}return 200<=p.status&&299>=p.status}function n(h){try{h.dispatchEvent(new MouseEvent("click"))}catch{var p=document.createEvent("MouseEvents");p.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),h.dispatchEvent(p)}}var o=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||(typeof window!="object"||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(h,p,m){var f=o.URL||o.webkitURL,g=document.createElement("a");p=p||h.name||"download",g.download=p,g.rel="noopener",typeof h=="string"?(g.href=h,g.origin===location.origin?n(g):e(g.href)?i(h,p,m):n(g,g.target="_blank")):(g.href=f.createObjectURL(h),setTimeout(function(){f.revokeObjectURL(g.href)},4e4),setTimeout(function(){n(g)},0))}:"msSaveOrOpenBlob"in navigator?function(h,p,m){if(p=p||h.name||"download",typeof h!="string")navigator.msSaveOrOpenBlob(r(h,m),p);else if(e(h))i(h,p,m);else{var f=document.createElement("a");f.href=h,f.target="_blank",setTimeout(function(){n(f)})}}:function(h,p,m,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof h=="string")return i(h,p,m);var g=h.type==="application/octet-stream",y=/constructor/i.test(o.HTMLElement)||o.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||g&&y||s)&&typeof FileReader<"u"){var w=new FileReader;w.onloadend=function(){var R=w.result;R=_?R:R.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=R:location=R,f=null},w.readAsDataURL(h)}else{var A=o.URL||o.webkitURL,k=A.createObjectURL(h);f?f.location=k:location.href=k,f=null,setTimeout(function(){A.revokeObjectURL(k)},4e4)}});o.saveAs=l.saveAs=l,typeof zL<"u"&&(zL.exports=l)})});var P$=Bd(bO=>{bO.read=function(r,i,e,n,o){var s,l,h=o*8-n-1,p=(1<<h)-1,m=p>>1,f=-7,g=e?o-1:0,y=e?-1:1,_=r[i+g];for(g+=y,s=_&(1<<-f)-1,_>>=-f,f+=h;f>0;s=s*256+r[i+g],g+=y,f-=8);for(l=s&(1<<-f)-1,s>>=-f,f+=n;f>0;l=l*256+r[i+g],g+=y,f-=8);if(s===0)s=1-m;else{if(s===p)return l?NaN:(_?-1:1)*(1/0);l=l+Math.pow(2,n),s=s-m}return(_?-1:1)*l*Math.pow(2,s-n)};bO.write=function(r,i,e,n,o,s){var l,h,p,m=s*8-o-1,f=(1<<m)-1,g=f>>1,y=o===23?Math.pow(2,-24)-Math.pow(2,-77):0,_=n?0:s-1,w=n?1:-1,A=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(h=isNaN(i)?1:0,l=f):(l=Math.floor(Math.log(i)/Math.LN2),i*(p=Math.pow(2,-l))<1&&(l--,p*=2),l+g>=1?i+=y/p:i+=y*Math.pow(2,1-g),i*p>=2&&(l++,p/=2),l+g>=f?(h=0,l=f):l+g>=1?(h=(i*p-1)*Math.pow(2,o),l=l+g):(h=i*Math.pow(2,g-1)*Math.pow(2,o),l=0));o>=8;r[e+_]=h&255,_+=w,h/=256,o-=8);for(l=l<<o|h,m+=o;m>0;r[e+_]=l&255,_+=w,l/=256,m-=8);r[e+_-w]|=A*128}});var N$=Bd((s7e,R$)=>{"use strict";R$.exports=vo;var NI=P$();function vo(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}vo.Varint=0;vo.Fixed64=1;vo.Bytes=2;vo.Fixed32=5;var wO=65536*65536,L$=1/wO,wde=12,D$=typeof TextDecoder>"u"?null:new TextDecoder("utf8");vo.prototype={destroy:function(){this.buf=null},readFields:function(r,i,e){for(e=e||this.length;this.pos<e;){var n=this.readVarint(),o=n>>3,s=this.pos;this.type=n&7,r(o,i,this),this.pos===s&&this.skip(n)}return i},readMessage:function(r,i){return this.readFields(r,i,this.readVarint()+this.pos)},readFixed32:function(){var r=BI(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=O$(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=BI(this.buf,this.pos)+BI(this.buf,this.pos+4)*wO;return this.pos+=8,r},readSFixed64:function(){var r=BI(this.buf,this.pos)+O$(this.buf,this.pos+4)*wO;return this.pos+=8,r},readFloat:function(){var r=NI.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=NI.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var i=this.buf,e,n;return n=i[this.pos++],e=n&127,n<128||(n=i[this.pos++],e|=(n&127)<<7,n<128)||(n=i[this.pos++],e|=(n&127)<<14,n<128)||(n=i[this.pos++],e|=(n&127)<<21,n<128)?e:(n=i[this.pos],e|=(n&15)<<28,xde(e,r,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2===1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,i=this.pos;return this.pos=r,r-i>=wde&&D$?Rde(this.buf,i,r):Dde(this.buf,i,r)},readBytes:function(){var r=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,r);return this.pos=r,i},readPackedVarint:function(r,i){if(this.type!==vo.Bytes)return r.push(this.readVarint(i));var e=ug(this);for(r=r||[];this.pos<e;)r.push(this.readVarint(i));return r},readPackedSVarint:function(r){if(this.type!==vo.Bytes)return r.push(this.readSVarint());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==vo.Bytes)return r.push(this.readBoolean());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==vo.Bytes)return r.push(this.readFloat());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==vo.Bytes)return r.push(this.readDouble());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==vo.Bytes)return r.push(this.readFixed32());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==vo.Bytes)return r.push(this.readSFixed32());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==vo.Bytes)return r.push(this.readFixed64());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==vo.Bytes)return r.push(this.readSFixed64());var i=ug(this);for(r=r||[];this.pos<i;)r.push(this.readSFixed64());return r},skip:function(r){var i=r&7;if(i===vo.Varint)for(;this.buf[this.pos++]>127;);else if(i===vo.Bytes)this.pos=this.readVarint()+this.pos;else if(i===vo.Fixed32)this.pos+=4;else if(i===vo.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+i)},writeTag:function(r,i){this.writeVarint(r<<3|i)},realloc:function(r){for(var i=this.length||16;i<this.pos+r;)i*=2;if(i!==this.length){var e=new Uint8Array(i);e.set(this.buf),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Vv(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Vv(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Vv(this.buf,r&-1,this.pos),Vv(this.buf,Math.floor(r*L$),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Vv(this.buf,r&-1,this.pos),Vv(this.buf,Math.floor(r*L$),this.pos+4),this.pos+=8},writeVarint:function(r){if(r=+r||0,r>268435455||r<0){Sde(r,this);return}this.realloc(4),this.buf[this.pos++]=r&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=(r>>>=7)&127|(r>127?128:0),!(r<=127)&&(this.buf[this.pos++]=r>>>7&127)))},writeSVarint:function(r){this.writeVarint(r<0?-r*2-1:r*2)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(r.length*4),this.pos++;var i=this.pos;this.pos=Nde(this.buf,r,this.pos);var e=this.pos-i;e>=128&&k$(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeFloat:function(r){this.realloc(4),NI.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),NI.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var i=r.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=r[e]},writeRawMessage:function(r,i){this.pos++;var e=this.pos;r(i,this);var n=this.pos-e;n>=128&&k$(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,i,e){this.writeTag(r,vo.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(r,i){i.length&&this.writeMessage(r,Mde,i)},writePackedSVarint:function(r,i){i.length&&this.writeMessage(r,Ide,i)},writePackedBoolean:function(r,i){i.length&&this.writeMessage(r,Fde,i)},writePackedFloat:function(r,i){i.length&&this.writeMessage(r,Ede,i)},writePackedDouble:function(r,i){i.length&&this.writeMessage(r,Tde,i)},writePackedFixed32:function(r,i){i.length&&this.writeMessage(r,Pde,i)},writePackedSFixed32:function(r,i){i.length&&this.writeMessage(r,Lde,i)},writePackedFixed64:function(r,i){i.length&&this.writeMessage(r,kde,i)},writePackedSFixed64:function(r,i){i.length&&this.writeMessage(r,Ode,i)},writeBytesField:function(r,i){this.writeTag(r,vo.Bytes),this.writeBytes(i)},writeFixed32Field:function(r,i){this.writeTag(r,vo.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(r,i){this.writeTag(r,vo.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(r,i){this.writeTag(r,vo.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(r,i){this.writeTag(r,vo.Fixed64),this.writeSFixed64(i)},writeVarintField:function(r,i){this.writeTag(r,vo.Varint),this.writeVarint(i)},writeSVarintField:function(r,i){this.writeTag(r,vo.Varint),this.writeSVarint(i)},writeStringField:function(r,i){this.writeTag(r,vo.Bytes),this.writeString(i)},writeFloatField:function(r,i){this.writeTag(r,vo.Fixed32),this.writeFloat(i)},writeDoubleField:function(r,i){this.writeTag(r,vo.Fixed64),this.writeDouble(i)},writeBooleanField:function(r,i){this.writeVarintField(r,!!i)}};function xde(r,i,e){var n=e.buf,o,s;if(s=n[e.pos++],o=(s&112)>>4,s<128||(s=n[e.pos++],o|=(s&127)<<3,s<128)||(s=n[e.pos++],o|=(s&127)<<10,s<128)||(s=n[e.pos++],o|=(s&127)<<17,s<128)||(s=n[e.pos++],o|=(s&127)<<24,s<128)||(s=n[e.pos++],o|=(s&1)<<31,s<128))return jv(r,o,i);throw new Error("Expected varint not more than 10 bytes")}function ug(r){return r.type===vo.Bytes?r.readVarint()+r.pos:r.pos+1}function jv(r,i,e){return e?i*4294967296+(r>>>0):(i>>>0)*4294967296+(r>>>0)}function Sde(r,i){var e,n;if(r>=0?(e=r%4294967296|0,n=r/4294967296|0):(e=~(-r%4294967296),n=~(-r/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),Cde(e,n,i),Ade(n,i)}function Cde(r,i,e){e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos++]=r&127|128,r>>>=7,e.buf[e.pos]=r&127}function Ade(r,i){var e=(r&7)<<4;i.buf[i.pos++]|=e|((r>>>=3)?128:0),r&&(i.buf[i.pos++]=r&127|((r>>>=7)?128:0),r&&(i.buf[i.pos++]=r&127|((r>>>=7)?128:0),r&&(i.buf[i.pos++]=r&127|((r>>>=7)?128:0),r&&(i.buf[i.pos++]=r&127|((r>>>=7)?128:0),r&&(i.buf[i.pos++]=r&127)))))}function k$(r,i,e){var n=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(Math.LN2*7));e.realloc(n);for(var o=e.pos-1;o>=r;o--)e.buf[o+n]=e.buf[o]}function Mde(r,i){for(var e=0;e<r.length;e++)i.writeVarint(r[e])}function Ide(r,i){for(var e=0;e<r.length;e++)i.writeSVarint(r[e])}function Ede(r,i){for(var e=0;e<r.length;e++)i.writeFloat(r[e])}function Tde(r,i){for(var e=0;e<r.length;e++)i.writeDouble(r[e])}function Fde(r,i){for(var e=0;e<r.length;e++)i.writeBoolean(r[e])}function Pde(r,i){for(var e=0;e<r.length;e++)i.writeFixed32(r[e])}function Lde(r,i){for(var e=0;e<r.length;e++)i.writeSFixed32(r[e])}function kde(r,i){for(var e=0;e<r.length;e++)i.writeFixed64(r[e])}function Ode(r,i){for(var e=0;e<r.length;e++)i.writeSFixed64(r[e])}function BI(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+r[i+3]*16777216}function Vv(r,i,e){r[e]=i,r[e+1]=i>>>8,r[e+2]=i>>>16,r[e+3]=i>>>24}function O$(r,i){return(r[i]|r[i+1]<<8|r[i+2]<<16)+(r[i+3]<<24)}function Dde(r,i,e){for(var n="",o=i;o<e;){var s=r[o],l=null,h=s>239?4:s>223?3:s>191?2:1;if(o+h>e)break;var p,m,f;h===1?s<128&&(l=s):h===2?(p=r[o+1],(p&192)===128&&(l=(s&31)<<6|p&63,l<=127&&(l=null))):h===3?(p=r[o+1],m=r[o+2],(p&192)===128&&(m&192)===128&&(l=(s&15)<<12|(p&63)<<6|m&63,(l<=2047||l>=55296&&l<=57343)&&(l=null))):h===4&&(p=r[o+1],m=r[o+2],f=r[o+3],(p&192)===128&&(m&192)===128&&(f&192)===128&&(l=(s&15)<<18|(p&63)<<12|(m&63)<<6|f&63,(l<=65535||l>=1114112)&&(l=null))),l===null?(l=65533,h=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|l&1023),n+=String.fromCharCode(l),o+=h}return n}function Rde(r,i,e){return D$.decode(r.subarray(i,e))}function Nde(r,i,e){for(var n=0,o,s;n<i.length;n++){if(o=i.charCodeAt(n),o>55295&&o<57344)if(s)if(o<56320){r[e++]=239,r[e++]=191,r[e++]=189,s=o;continue}else o=s-55296<<10|o-56320|65536,s=null;else{o>56319||n+1===i.length?(r[e++]=239,r[e++]=191,r[e++]=189):s=o;continue}else s&&(r[e++]=239,r[e++]=191,r[e++]=189,s=null);o<128?r[e++]=o:(o<2048?r[e++]=o>>6|192:(o<65536?r[e++]=o>>12|224:(r[e++]=o>>18|240,r[e++]=o>>12&63|128),r[e++]=o>>6&63|128),r[e++]=o&63|128)}return e}});var QI=Bd((gD,_D)=>{(function(r,i){typeof gD=="object"&&typeof _D<"u"?_D.exports=i():typeof define=="function"&&define.amd?define(i):(r=r||self).RBush=i()})(gD,function(){"use strict";function r(k,R,q,X,ie){(function ae(be,me,fe,ge,ue){for(;ge>fe;){if(ge-fe>600){var se=ge-fe+1,te=me-fe+1,Se=Math.log(se),Te=.5*Math.exp(2*Se/3),Ee=.5*Math.sqrt(Se*Te*(se-Te)/se)*(te-se/2<0?-1:1),je=Math.max(fe,Math.floor(me-te*Te/se+Ee)),Ne=Math.min(ge,Math.floor(me+(se-te)*Te/se+Ee));ae(be,me,je,Ne,ue)}var ze=be[me],Re=fe,Ge=ge;for(i(be,fe,me),ue(be[ge],ze)>0&&i(be,fe,ge);Re<Ge;){for(i(be,Re,Ge),Re++,Ge--;ue(be[Re],ze)<0;)Re++;for(;ue(be[Ge],ze)>0;)Ge--}ue(be[fe],ze)===0?i(be,fe,Ge):i(be,++Ge,ge),Ge<=me&&(fe=Ge+1),me<=Ge&&(ge=Ge-1)}})(k,R,q||0,X||k.length-1,ie||e)}function i(k,R,q){var X=k[R];k[R]=k[q],k[q]=X}function e(k,R){return k<R?-1:k>R?1:0}var n=function(k){k===void 0&&(k=9),this._maxEntries=Math.max(4,k),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(k,R,q){if(!q)return R.indexOf(k);for(var X=0;X<R.length;X++)if(q(k,R[X]))return X;return-1}function s(k,R){l(k,0,k.children.length,R,k)}function l(k,R,q,X,ie){ie||(ie=w(null)),ie.minX=1/0,ie.minY=1/0,ie.maxX=-1/0,ie.maxY=-1/0;for(var ae=R;ae<q;ae++){var be=k.children[ae];h(ie,k.leaf?X(be):be)}return ie}function h(k,R){return k.minX=Math.min(k.minX,R.minX),k.minY=Math.min(k.minY,R.minY),k.maxX=Math.max(k.maxX,R.maxX),k.maxY=Math.max(k.maxY,R.maxY),k}function p(k,R){return k.minX-R.minX}function m(k,R){return k.minY-R.minY}function f(k){return(k.maxX-k.minX)*(k.maxY-k.minY)}function g(k){return k.maxX-k.minX+(k.maxY-k.minY)}function y(k,R){return k.minX<=R.minX&&k.minY<=R.minY&&R.maxX<=k.maxX&&R.maxY<=k.maxY}function _(k,R){return R.minX<=k.maxX&&R.minY<=k.maxY&&R.maxX>=k.minX&&R.maxY>=k.minY}function w(k){return{children:k,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function A(k,R,q,X,ie){for(var ae=[R,q];ae.length;)if(!((q=ae.pop())-(R=ae.pop())<=X)){var be=R+Math.ceil((q-R)/X/2)*X;r(k,be,R,q,ie),ae.push(R,be,be,q)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(k){var R=this.data,q=[];if(!_(k,R))return q;for(var X=this.toBBox,ie=[];R;){for(var ae=0;ae<R.children.length;ae++){var be=R.children[ae],me=R.leaf?X(be):be;_(k,me)&&(R.leaf?q.push(be):y(k,me)?this._all(be,q):ie.push(be))}R=ie.pop()}return q},n.prototype.collides=function(k){var R=this.data;if(!_(k,R))return!1;for(var q=[];R;){for(var X=0;X<R.children.length;X++){var ie=R.children[X],ae=R.leaf?this.toBBox(ie):ie;if(_(k,ae)){if(R.leaf||y(k,ae))return!0;q.push(ie)}}R=q.pop()}return!1},n.prototype.load=function(k){if(!k||!k.length)return this;if(k.length<this._minEntries){for(var R=0;R<k.length;R++)this.insert(k[R]);return this}var q=this._build(k.slice(),0,k.length-1,0);if(this.data.children.length)if(this.data.height===q.height)this._splitRoot(this.data,q);else{if(this.data.height<q.height){var X=this.data;this.data=q,q=X}this._insert(q,this.data.height-q.height-1,!0)}else this.data=q;return this},n.prototype.insert=function(k){return k&&this._insert(k,this.data.height-1),this},n.prototype.clear=function(){return this.data=w([]),this},n.prototype.remove=function(k,R){if(!k)return this;for(var q,X,ie,ae=this.data,be=this.toBBox(k),me=[],fe=[];ae||me.length;){if(ae||(ae=me.pop(),X=me[me.length-1],q=fe.pop(),ie=!0),ae.leaf){var ge=o(k,ae.children,R);if(ge!==-1)return ae.children.splice(ge,1),me.push(ae),this._condense(me),this}ie||ae.leaf||!y(ae,be)?X?(q++,ae=X.children[q],ie=!1):ae=null:(me.push(ae),fe.push(q),q=0,X=ae,ae=ae.children[0])}return this},n.prototype.toBBox=function(k){return k},n.prototype.compareMinX=function(k,R){return k.minX-R.minX},n.prototype.compareMinY=function(k,R){return k.minY-R.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(k){return this.data=k,this},n.prototype._all=function(k,R){for(var q=[];k;)k.leaf?R.push.apply(R,k.children):q.push.apply(q,k.children),k=q.pop();return R},n.prototype._build=function(k,R,q,X){var ie,ae=q-R+1,be=this._maxEntries;if(ae<=be)return s(ie=w(k.slice(R,q+1)),this.toBBox),ie;X||(X=Math.ceil(Math.log(ae)/Math.log(be)),be=Math.ceil(ae/Math.pow(be,X-1))),(ie=w([])).leaf=!1,ie.height=X;var me=Math.ceil(ae/be),fe=me*Math.ceil(Math.sqrt(be));A(k,R,q,fe,this.compareMinX);for(var ge=R;ge<=q;ge+=fe){var ue=Math.min(ge+fe-1,q);A(k,ge,ue,me,this.compareMinY);for(var se=ge;se<=ue;se+=me){var te=Math.min(se+me-1,ue);ie.children.push(this._build(k,se,te,X-1))}}return s(ie,this.toBBox),ie},n.prototype._chooseSubtree=function(k,R,q,X){for(;X.push(R),!R.leaf&&X.length-1!==q;){for(var ie=1/0,ae=1/0,be=void 0,me=0;me<R.children.length;me++){var fe=R.children[me],ge=f(fe),ue=(se=k,te=fe,(Math.max(te.maxX,se.maxX)-Math.min(te.minX,se.minX))*(Math.max(te.maxY,se.maxY)-Math.min(te.minY,se.minY))-ge);ue<ae?(ae=ue,ie=ge<ie?ge:ie,be=fe):ue===ae&&ge<ie&&(ie=ge,be=fe)}R=be||R.children[0]}var se,te;return R},n.prototype._insert=function(k,R,q){var X=q?k:this.toBBox(k),ie=[],ae=this._chooseSubtree(X,this.data,R,ie);for(ae.children.push(k),h(ae,X);R>=0&&ie[R].children.length>this._maxEntries;)this._split(ie,R),R--;this._adjustParentBBoxes(X,ie,R)},n.prototype._split=function(k,R){var q=k[R],X=q.children.length,ie=this._minEntries;this._chooseSplitAxis(q,ie,X);var ae=this._chooseSplitIndex(q,ie,X),be=w(q.children.splice(ae,q.children.length-ae));be.height=q.height,be.leaf=q.leaf,s(q,this.toBBox),s(be,this.toBBox),R?k[R-1].children.push(be):this._splitRoot(q,be)},n.prototype._splitRoot=function(k,R){this.data=w([k,R]),this.data.height=k.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(k,R,q){for(var X,ie,ae,be,me,fe,ge,ue=1/0,se=1/0,te=R;te<=q-R;te++){var Se=l(k,0,te,this.toBBox),Te=l(k,te,q,this.toBBox),Ee=(ie=Se,ae=Te,be=void 0,me=void 0,fe=void 0,ge=void 0,be=Math.max(ie.minX,ae.minX),me=Math.max(ie.minY,ae.minY),fe=Math.min(ie.maxX,ae.maxX),ge=Math.min(ie.maxY,ae.maxY),Math.max(0,fe-be)*Math.max(0,ge-me)),je=f(Se)+f(Te);Ee<ue?(ue=Ee,X=te,se=je<se?je:se):Ee===ue&&je<se&&(se=je,X=te)}return X||q-R},n.prototype._chooseSplitAxis=function(k,R,q){var X=k.leaf?this.compareMinX:p,ie=k.leaf?this.compareMinY:m;this._allDistMargin(k,R,q,X)<this._allDistMargin(k,R,q,ie)&&k.children.sort(X)},n.prototype._allDistMargin=function(k,R,q,X){k.children.sort(X);for(var ie=this.toBBox,ae=l(k,0,R,ie),be=l(k,q-R,q,ie),me=g(ae)+g(be),fe=R;fe<q-R;fe++){var ge=k.children[fe];h(ae,k.leaf?ie(ge):ge),me+=g(ae)}for(var ue=q-R-1;ue>=R;ue--){var se=k.children[ue];h(be,k.leaf?ie(se):se),me+=g(be)}return me},n.prototype._adjustParentBBoxes=function(k,R,q){for(var X=q;X>=0;X--)h(R[X],k)},n.prototype._condense=function(k){for(var R=k.length-1,q=void 0;R>=0;R--)k[R].children.length===0?R>0?(q=k[R-1].children).splice(q.indexOf(k[R]),1):this.clear():s(k[R],this.toBBox)},n})});var fJ=Bd((iIt,mJ)=>{mJ.exports={webm:"data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4EEQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsghV17AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU1LjMzLjEwMFdBjUxhdmY1NS4zMy4xMDBzpJBlrrXf3DCDVB8KcgbMpcr+RImIQJBgAAAAAAAWVK5rAQAAAAAAD++uAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDiDgQEj44OEAmJaAOABAAAAAAAABrCBsLqBkK4BAAAAAAAPq9eBAnPFgQKcgQAitZyDdW5khohBX1ZPUkJJU4OBAuEBAAAAAAAAEZ+BArWIQOdwAAAAAABiZIEgY6JPbwIeVgF2b3JiaXMAAAAAAoC7AAAAAAAAgLUBAAAAAAC4AQN2b3JiaXMtAAAAWGlwaC5PcmcgbGliVm9yYmlzIEkgMjAxMDExMDEgKFNjaGF1ZmVudWdnZXQpAQAAABUAAABlbmNvZGVyPUxhdmM1NS41Mi4xMDIBBXZvcmJpcyVCQ1YBAEAAACRzGCpGpXMWhBAaQlAZ4xxCzmvsGUJMEYIcMkxbyyVzkCGkoEKIWyiB0JBVAABAAACHQXgUhIpBCCGEJT1YkoMnPQghhIg5eBSEaUEIIYQQQgghhBBCCCGERTlokoMnQQgdhOMwOAyD5Tj4HIRFOVgQgydB6CCED0K4moOsOQghhCQ1SFCDBjnoHITCLCiKgsQwuBaEBDUojILkMMjUgwtCiJqDSTX4GoRnQXgWhGlBCCGEJEFIkIMGQcgYhEZBWJKDBjm4FITLQagahCo5CB+EIDRkFQCQAACgoiiKoigKEBqyCgDIAAAQQFEUx3EcyZEcybEcCwgNWQUAAAEACAAAoEiKpEiO5EiSJFmSJVmSJVmS5omqLMuyLMuyLMsyEBqyCgBIAABQUQxFcRQHCA1ZBQBkAAAIoDiKpViKpWiK54iOCISGrAIAgAAABAAAEDRDUzxHlETPVFXXtm3btm3btm3btm3btm1blmUZCA1ZBQBAAAAQ0mlmqQaIMAMZBkJDVgEACAAAgBGKMMSA0JBVAABAAACAGEoOogmtOd+c46BZDppKsTkdnEi1eZKbirk555xzzsnmnDHOOeecopxZDJoJrTnnnMSgWQqaCa0555wnsXnQmiqtOeeccc7pYJwRxjnnnCateZCajbU555wFrWmOmkuxOeecSLl5UptLtTnnnHPOOeecc84555zqxekcnBPOOeecqL25lpvQxTnnnE/G6d6cEM4555xzzjnnnHPOOeecIDRkFQAABABAEIaNYdwpCNLnaCBGEWIaMulB9+gwCRqDnELq0ehopJQ6CCWVcVJKJwgNWQUAAAIAQAghhRRSSCGFFFJIIYUUYoghhhhyyimnoIJKKqmooowyyyyzzDLLLLPMOuyssw47DDHEEEMrrcRSU2011lhr7jnnmoO0VlprrbVSSimllFIKQkNWAQAgAAAEQgYZZJBRSCGFFGKIKaeccgoqqIDQkFUAACAAgAAAAABP8hzRER3RER3RER3RER3R8RzPESVREiVREi3TMjXTU0VVdWXXlnVZt31b2IVd933d933d+HVhWJZlWZZlWZZlWZZlWZZlWZYgNGQVAAACAAAghBBCSCGFFFJIKcYYc8w56CSUEAgNWQUAAAIACAAAAHAUR3EcyZEcSbIkS9IkzdIsT/M0TxM9URRF0zRV0RVdUTdtUTZl0zVdUzZdVVZtV5ZtW7Z125dl2/d93/d93/d93/d93/d9XQdCQ1YBABIAADqSIymSIimS4ziOJElAaMgqAEAGAEAAAIriKI7jOJIkSZIlaZJneZaomZrpmZ4qqkBoyCoAABAAQAAAAAAAAIqmeIqpeIqoeI7oiJJomZaoqZoryqbsuq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq7ruq4LhIasAgAkAAB0JEdyJEdSJEVSJEdygNCQVQCADACAAAAcwzEkRXIsy9I0T/M0TxM90RM901NFV3SB0JBVAAAgAIAAAAAAAAAMybAUy9EcTRIl1VItVVMt1VJF1VNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVN0zRNEwgNWQkAkAEAkBBTLS3GmgmLJGLSaqugYwxS7KWxSCpntbfKMYUYtV4ah5RREHupJGOKQcwtpNApJq3WVEKFFKSYYyoVUg5SIDRkhQAQmgHgcBxAsixAsiwAAAAAAAAAkDQN0DwPsDQPAAAAAAAAACRNAyxPAzTPAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAA0DwP8DwR8EQRAAAAAAAAACzPAzTRAzxRBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABA0jRA8zxA8zwAAAAAAAAAsDwP8EQR0DwRAAAAAAAAACzPAzxRBDzRAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAEOAAABBgIRQasiIAiBMAcEgSJAmSBM0DSJYFTYOmwTQBkmVB06BpME0AAAAAAAAAAAAAJE2DpkHTIIoASdOgadA0iCIAAAAAAAAAAAAAkqZB06BpEEWApGnQNGgaRBEAAAAAAAAAAAAAzzQhihBFmCbAM02IIkQRpgkAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAGHAAAAgwoQwUGrIiAIgTAHA4imUBAIDjOJYFAACO41gWAABYliWKAABgWZooAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAYcAAACDChDBQashIAiAIAcCiKZQHHsSzgOJYFJMmyAJYF0DyApgFEEQAIAAAocAAACLBBU2JxgEJDVgIAUQAABsWxLE0TRZKkaZoniiRJ0zxPFGma53meacLzPM80IYqiaJoQRVE0TZimaaoqME1VFQAAUOAAABBgg6bE4gCFhqwEAEICAByKYlma5nmeJ4qmqZokSdM8TxRF0TRNU1VJkqZ5niiKommapqqyLE3zPFEURdNUVVWFpnmeKIqiaaqq6sLzPE8URdE0VdV14XmeJ4qiaJqq6roQRVE0TdNUTVV1XSCKpmmaqqqqrgtETxRNU1Vd13WB54miaaqqq7ouEE3TVFVVdV1ZBpimaaqq68oyQFVV1XVdV5YBqqqqruu6sgxQVdd1XVmWZQCu67qyLMsCAAAOHAAAAoygk4wqi7DRhAsPQKEhKwKAKAAAwBimFFPKMCYhpBAaxiSEFEImJaXSUqogpFJSKRWEVEoqJaOUUmopVRBSKamUCkIqJZVSAADYgQMA2IGFUGjISgAgDwCAMEYpxhhzTiKkFGPOOScRUoox55yTSjHmnHPOSSkZc8w556SUzjnnnHNSSuacc845KaVzzjnnnJRSSuecc05KKSWEzkEnpZTSOeecEwAAVOAAABBgo8jmBCNBhYasBABSAQAMjmNZmuZ5omialiRpmud5niiapiZJmuZ5nieKqsnzPE8URdE0VZXneZ4oiqJpqirXFUXTNE1VVV2yLIqmaZqq6rowTdNUVdd1XZimaaqq67oubFtVVdV1ZRm2raqq6rqyDFzXdWXZloEsu67s2rIAAPAEBwCgAhtWRzgpGgssNGQlAJABAEAYg5BCCCFlEEIKIYSUUggJAAAYcAAACDChDBQashIASAUAAIyx1lprrbXWQGettdZaa62AzFprrbXWWmuttdZaa6211lJrrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmuttdZaa6211lprrbXWWmstpZRSSimllFJKKaWUUkoppZRSSgUA+lU4APg/2LA6wknRWGChISsBgHAAAMAYpRhzDEIppVQIMeacdFRai7FCiDHnJKTUWmzFc85BKCGV1mIsnnMOQikpxVZjUSmEUlJKLbZYi0qho5JSSq3VWIwxqaTWWoutxmKMSSm01FqLMRYjbE2ptdhqq7EYY2sqLbQYY4zFCF9kbC2m2moNxggjWywt1VprMMYY3VuLpbaaizE++NpSLDHWXAAAd4MDAESCjTOsJJ0VjgYXGrISAAgJACAQUooxxhhzzjnnpFKMOeaccw5CCKFUijHGnHMOQgghlIwx5pxzEEIIIYRSSsaccxBCCCGEkFLqnHMQQgghhBBKKZ1zDkIIIYQQQimlgxBCCCGEEEoopaQUQgghhBBCCKmklEIIIYRSQighlZRSCCGEEEIpJaSUUgohhFJCCKGElFJKKYUQQgillJJSSimlEkoJJYQSUikppRRKCCGUUkpKKaVUSgmhhBJKKSWllFJKIYQQSikFAAAcOAAABBhBJxlVFmGjCRcegEJDVgIAZAAAkKKUUiktRYIipRikGEtGFXNQWoqocgxSzalSziDmJJaIMYSUk1Qy5hRCDELqHHVMKQYtlRhCxhik2HJLoXMOAAAAQQCAgJAAAAMEBTMAwOAA4XMQdAIERxsAgCBEZohEw0JweFAJEBFTAUBigkIuAFRYXKRdXECXAS7o4q4DIQQhCEEsDqCABByccMMTb3jCDU7QKSp1IAAAAAAADADwAACQXAAREdHMYWRobHB0eHyAhIiMkAgAAAAAABcAfAAAJCVAREQ0cxgZGhscHR4fICEiIyQBAIAAAgAAAAAggAAEBAQAAAAAAAIAAAAEBB9DtnUBAAAAAAAEPueBAKOFggAAgACjzoEAA4BwBwCdASqwAJAAAEcIhYWIhYSIAgIABhwJ7kPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99YAD+/6tQgKOFggADgAqjhYIAD4AOo4WCACSADqOZgQArADECAAEQEAAYABhYL/QACIBDmAYAAKOFggA6gA6jhYIAT4AOo5mBAFMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAGSADqOFggB6gA6jmYEAewAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAj4AOo5mBAKMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAKSADqOFggC6gA6jmYEAywAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIAz4AOo4WCAOSADqOZgQDzADECAAEQEAAYABhYL/QACIBDmAYAAKOFggD6gA6jhYIBD4AOo5iBARsAEQIAARAQFGAAYWC/0AAiAQ5gGACjhYIBJIAOo4WCATqADqOZgQFDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggFPgA6jhYIBZIAOo5mBAWsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAXqADqOFggGPgA6jmYEBkwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIBpIAOo4WCAbqADqOZgQG7ADECAAEQEAAYABhYL/QACIBDmAYAAKOFggHPgA6jmYEB4wAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIB5IAOo4WCAfqADqOZgQILADECAAEQEAAYABhYL/QACIBDmAYAAKOFggIPgA6jhYICJIAOo5mBAjMAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAjqADqOFggJPgA6jmYECWwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYICZIAOo4WCAnqADqOZgQKDADECAAEQEAAYABhYL/QACIBDmAYAAKOFggKPgA6jhYICpIAOo5mBAqsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCArqADqOFggLPgA6jmIEC0wARAgABEBAUYABhYL/QACIBDmAYAKOFggLkgA6jhYIC+oAOo5mBAvsAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCAw+ADqOZgQMjADECAAEQEAAYABhYL/QACIBDmAYAAKOFggMkgA6jhYIDOoAOo5mBA0sAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA0+ADqOFggNkgA6jmYEDcwAxAgABEBAAGAAYWC/0AAiAQ5gGAACjhYIDeoAOo4WCA4+ADqOZgQObADECAAEQEAAYABhYL/QACIBDmAYAAKOFggOkgA6jhYIDuoAOo5mBA8MAMQIAARAQABgAGFgv9AAIgEOYBgAAo4WCA8+ADqOFggPkgA6jhYID+oAOo4WCBA+ADhxTu2sBAAAAAAAAEbuPs4EDt4r3gQHxghEr8IEK",mp4:"data:video/mp4;base64,AAAAHGZ0eXBNNFYgAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXTeBAAAbGliZmFhYyAxLjI4AABCAJMgBDIARwAAArEGBf//rdxF6b3m2Ui3lizYINkj7u94MjY0IC0gY29yZSAxNDIgcjIgOTU2YzhkOCAtIEguMjY0L01QRUctNCBBVkMgY29kZWMgLSBDb3B5bGVmdCAyMDAzLTIwMTQgLSBodHRwOi8vd3d3LnZpZGVvbGFuLm9yZy94MjY0Lmh0bWwgLSBvcHRpb25zOiBjYWJhYz0wIHJlZj0zIGRlYmxvY2s9MTowOjAgYW5hbHlzZT0weDE6MHgxMTEgbWU9aGV4IHN1Ym1lPTcgcHN5PTEgcHN5X3JkPTEuMDA6MC4wMCBtaXhlZF9yZWY9MSBtZV9yYW5nZT0xNiBjaHJvbWFfbWU9MSB0cmVsbGlzPTEgOHg4ZGN0PTAgY3FtPTAgZGVhZHpvbmU9MjEsMTEgZmFzdF9wc2tpcD0xIGNocm9tYV9xcF9vZmZzZXQ9LTIgdGhyZWFkcz02IGxvb2thaGVhZF90aHJlYWRzPTEgc2xpY2VkX3RocmVhZHM9MCBucj0wIGRlY2ltYXRlPTEgaW50ZXJsYWNlZD0wIGJsdXJheV9jb21wYXQ9MCBjb25zdHJhaW5lZF9pbnRyYT0wIGJmcmFtZXM9MCB3ZWlnaHRwPTAga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCB2YnZfbWF4cmF0ZT03NjggdmJ2X2J1ZnNpemU9MzAwMCBjcmZfbWF4PTAuMCBuYWxfaHJkPW5vbmUgZmlsbGVyPTAgaXBfcmF0aW89MS40MCBhcT0xOjEuMDAAgAAAAFZliIQL8mKAAKvMnJycnJycnJycnXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXiEASZACGQAjgCEASZACGQAjgAAAAAdBmjgX4GSAIQBJkAIZACOAAAAAB0GaVAX4GSAhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGagC/AySEASZACGQAjgAAAAAZBmqAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZrAL8DJIQBJkAIZACOAAAAABkGa4C/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmwAvwMkhAEmQAhkAI4AAAAAGQZsgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGbQC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm2AvwMkhAEmQAhkAI4AAAAAGQZuAL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGboC/AySEASZACGQAjgAAAAAZBm8AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZvgL8DJIQBJkAIZACOAAAAABkGaAC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmiAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZpAL8DJIQBJkAIZACOAAAAABkGaYC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBmoAvwMkhAEmQAhkAI4AAAAAGQZqgL8DJIQBJkAIZACOAIQBJkAIZACOAAAAABkGawC/AySEASZACGQAjgAAAAAZBmuAvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZsAL8DJIQBJkAIZACOAAAAABkGbIC/AySEASZACGQAjgCEASZACGQAjgAAAAAZBm0AvwMkhAEmQAhkAI4AhAEmQAhkAI4AAAAAGQZtgL8DJIQBJkAIZACOAAAAABkGbgCvAySEASZACGQAjgCEASZACGQAjgAAAAAZBm6AnwMkhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AhAEmQAhkAI4AAAAhubW9vdgAAAGxtdmhkAAAAAAAAAAAAAAAAAAAD6AAABDcAAQAAAQAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAzB0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAABAAAAAAAAA+kAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAALAAAACQAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAPpAAAAAAABAAAAAAKobWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAB1MAAAdU5VxAAAAAAALWhkbHIAAAAAAAAAAHZpZGUAAAAAAAAAAAAAAABWaWRlb0hhbmRsZXIAAAACU21pbmYAAAAUdm1oZAAAAAEAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAhNzdGJsAAAAr3N0c2QAAAAAAAAAAQAAAJ9hdmMxAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAALAAkABIAAAASAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGP//AAAALWF2Y0MBQsAN/+EAFWdCwA3ZAsTsBEAAAPpAADqYA8UKkgEABWjLg8sgAAAAHHV1aWRraEDyXyRPxbo5pRvPAyPzAAAAAAAAABhzdHRzAAAAAAAAAAEAAAAeAAAD6QAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAAIxzdHN6AAAAAAAAAAAAAAAeAAADDwAAAAsAAAALAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAACgAAAAoAAAAKAAAAiHN0Y28AAAAAAAAAHgAAAEYAAANnAAADewAAA5gAAAO0AAADxwAAA+MAAAP2AAAEEgAABCUAAARBAAAEXQAABHAAAASMAAAEnwAABLsAAATOAAAE6gAABQYAAAUZAAAFNQAABUgAAAVkAAAFdwAABZMAAAWmAAAFwgAABd4AAAXxAAAGDQAABGh0cmFrAAAAXHRraGQAAAADAAAAAAAAAAAAAAACAAAAAAAABDcAAAAAAAAAAAAAAAEBAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAkZWR0cwAAABxlbHN0AAAAAAAAAAEAAAQkAAADcAABAAAAAAPgbWRpYQAAACBtZGhkAAAAAAAAAAAAAAAAAAC7gAAAykBVxAAAAAAALWhkbHIAAAAAAAAAAHNvdW4AAAAAAAAAAAAAAABTb3VuZEhhbmRsZXIAAAADi21pbmYAAAAQc21oZAAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAADT3N0YmwAAABnc3RzZAAAAAAAAAABAAAAV21wNGEAAAAAAAAAAQAAAAAAAAAAAAIAEAAAAAC7gAAAAAAAM2VzZHMAAAAAA4CAgCIAAgAEgICAFEAVBbjYAAu4AAAADcoFgICAAhGQBoCAgAECAAAAIHN0dHMAAAAAAAAAAgAAADIAAAQAAAAAAQAAAkAAAAFUc3RzYwAAAAAAAAAbAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAEAAAABAAAABAAAAAIAAAABAAAABgAAAAEAAAABAAAABwAAAAIAAAABAAAACAAAAAEAAAABAAAACQAAAAIAAAABAAAACgAAAAEAAAABAAAACwAAAAIAAAABAAAADQAAAAEAAAABAAAADgAAAAIAAAABAAAADwAAAAEAAAABAAAAEAAAAAIAAAABAAAAEQAAAAEAAAABAAAAEgAAAAIAAAABAAAAFAAAAAEAAAABAAAAFQAAAAIAAAABAAAAFgAAAAEAAAABAAAAFwAAAAIAAAABAAAAGAAAAAEAAAABAAAAGQAAAAIAAAABAAAAGgAAAAEAAAABAAAAGwAAAAIAAAABAAAAHQAAAAEAAAABAAAAHgAAAAIAAAABAAAAHwAAAAQAAAABAAAA4HN0c3oAAAAAAAAAAAAAADMAAAAaAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAAAJAAAACQAAAAkAAACMc3RjbwAAAAAAAAAfAAAALAAAA1UAAANyAAADhgAAA6IAAAO+AAAD0QAAA+0AAAQAAAAEHAAABC8AAARLAAAEZwAABHoAAASWAAAEqQAABMUAAATYAAAE9AAABRAAAAUjAAAFPwAABVIAAAVuAAAFgQAABZ0AAAWwAAAFzAAABegAAAX7AAAGFwAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTUuMzMuMTAw"}});var _J=Bd((rIt,gJ)=>{var{webm:dSe,mp4:hSe}=fJ(),e8=()=>typeof navigator<"u"&&parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))<10&&!window.MSStream,t8=()=>"wakeLock"in navigator,i8=class{constructor(){if(this.enabled=!1,t8()){this._wakeLock=null;let i=()=>{this._wakeLock!==null&&document.visibilityState==="visible"&&this.enable()};document.addEventListener("visibilitychange",i),document.addEventListener("fullscreenchange",i)}else e8()?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("title","No Sleep"),this.noSleepVideo.setAttribute("playsinline",""),this._addSourceToVideo(this.noSleepVideo,"webm",dSe),this._addSourceToVideo(this.noSleepVideo,"mp4",hSe),this.noSleepVideo.addEventListener("loadedmetadata",()=>{this.noSleepVideo.duration<=1?this.noSleepVideo.setAttribute("loop",""):this.noSleepVideo.addEventListener("timeupdate",()=>{this.noSleepVideo.currentTime>.5&&(this.noSleepVideo.currentTime=Math.random())})}))}_addSourceToVideo(i,e,n){var o=document.createElement("source");o.src=n,o.type=`video/${e}`,i.appendChild(o)}get isEnabled(){return this.enabled}enable(){return t8()?navigator.wakeLock.request("screen").then(i=>{this._wakeLock=i,this.enabled=!0,console.log("Wake Lock active."),this._wakeLock.addEventListener("release",()=>{console.log("Wake Lock released.")})}).catch(i=>{throw this.enabled=!1,console.error(`${i.name}, ${i.message}`),i}):e8()?(this.disable(),console.warn(`
        NoSleep enabled for older iOS devices. This can interrupt
        active or long-running network requests from completing successfully.
        See https://github.com/richtr/NoSleep.js/issues/15 for more details.
      `),this.noSleepTimer=window.setInterval(()=>{document.hidden||(window.location.href=window.location.href.split("#")[0],window.setTimeout(window.stop,0))},15e3),this.enabled=!0,Promise.resolve()):this.noSleepVideo.play().then(e=>(this.enabled=!0,e)).catch(e=>{throw this.enabled=!1,e})}disable(){t8()?(this._wakeLock&&this._wakeLock.release(),this._wakeLock=null):e8()?this.noSleepTimer&&(console.warn(`
          NoSleep now disabled for older iOS devices.
        `),window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause(),this.enabled=!1}};gJ.exports=i8});var CJ=Bd((SJ,YT)=>{"use strict";(function(r){if(typeof i!="function"){var i=function(_){return _};i.nonNative=!0}let e=i("plaintext"),n=i("html"),o=i("comment"),s=/<(\w*)>/g,l=/<\/?([^\s\/>]+)/;function h(_,w,A){_=_||"",w=w||[],A=A||"";let k=m(w,A);return f(_,k)}function p(_,w){_=_||[],w=w||"";let A=m(_,w);return function(R){return f(R||"",A)}}h.init_streaming_mode=p;function m(_,w){return _=g(_),{allowable_tags:_,tag_replacement:w,state:e,tag_buffer:"",depth:0,in_quote_char:""}}function f(_,w){if(typeof _!="string")throw new TypeError("'html' parameter must be a string");let A=w.allowable_tags,k=w.tag_replacement,R=w.state,q=w.tag_buffer,X=w.depth,ie=w.in_quote_char,ae="";for(let be=0,me=_.length;be<me;be++){let fe=_[be];if(R===e)switch(fe){case"<":R=n,q+=fe;break;default:ae+=fe;break}else if(R===n)switch(fe){case"<":if(ie)break;X++;break;case">":if(ie)break;if(X){X--;break}ie="",R=e,q+=">",A.has(y(q))?ae+=q:ae+=k,q="";break;case'"':case"'":fe===ie?ie="":ie=ie||fe,q+=fe;break;case"-":q==="<!-"&&(R=o),q+=fe;break;case" ":case`
`:if(q==="<"){R=e,ae+="< ",q="";break}q+=fe;break;default:q+=fe;break}else if(R===o)switch(fe){case">":q.slice(-2)=="--"&&(R=e),q="";break;default:q+=fe;break}}return w.state=R,w.tag_buffer=q,w.depth=X,w.in_quote_char=ie,ae}function g(_){let w=new Set;if(typeof _=="string"){let A;for(;A=s.exec(_);)w.add(A[1])}else!i.nonNative&&typeof _[i.iterator]=="function"?w=new Set(_):typeof _.forEach=="function"&&_.forEach(w.add,w);return w}function y(_){let w=l.exec(_);return w?w[1].toLowerCase():null}typeof define=="function"&&define.amd?define(function(){return h}):typeof YT=="object"&&YT.exports?YT.exports=h:r.striptags=h})(SJ)});var QJ=Bd((exports,module)=>{(function _f(self){"use strict";try{module&&(self=module)}catch(r){}self._factory=_f;var t;function u(r){return typeof r<"u"?r:!0}function aa(r){let i=Array(r);for(let e=0;e<r;e++)i[e]=v();return i}function v(){return Object.create(null)}function ba(r,i){return i.length-r.length}function x(r){return typeof r=="string"}function C(r){return typeof r=="object"}function D(r){return typeof r=="function"}function ca(r,i){var e=da;if(r&&(i&&(r=E(r,i)),this.H&&(r=E(r,this.H)),this.J&&1<r.length&&(r=E(r,this.J)),e||e==="")){if(r=r.split(e),this.filter){i=this.filter,e=r.length;let n=[];for(let o=0,s=0;o<e;o++){let l=r[o];l&&!i[l]&&(n[s++]=l)}r=n}return r}return r}let da=/[\p{Z}\p{S}\p{P}\p{C}]+/u,ea=/[\u0300-\u036f]/g;function fa(r,i){let e=Object.keys(r),n=e.length,o=[],s="",l=0;for(let h=0,p,m;h<n;h++)p=e[h],(m=r[p])?(o[l++]=F(i?"(?!\\b)"+p+"(\\b|_)":p),o[l++]=m):s+=(s?"|":"")+p;return s&&(o[l++]=F(i?"(?!\\b)("+s+")(\\b|_)":"("+s+")"),o[l]=""),o}function E(r,i){for(let e=0,n=i.length;e<n&&(r=r.replace(i[e],i[e+1]),r);e+=2);return r}function F(r){return new RegExp(r,"g")}function ha(r){let i="",e="";for(let n=0,o=r.length,s;n<o;n++)(s=r[n])!==e&&(i+=e=s);return i}var ja={encode:ia,F:!1,G:""};function ia(r){return ca.call(this,(""+r).toLowerCase(),!1)}let ka={},G={};function la(r){I(r,"add"),I(r,"append"),I(r,"search"),I(r,"update"),I(r,"remove")}function I(r,i){r[i+"Async"]=function(){let e=this,n=arguments;var o=n[n.length-1];let s;return D(o)&&(s=o,delete n[n.length-1]),o=new Promise(function(l){setTimeout(function(){e.async=!0;let h=e[i].apply(e,n);e.async=!1,l(h)})}),s?(o.then(s),this):o}}function ma(r,i,e,n){let o=r.length,s=[],l,h,p=0;n&&(n=[]);for(let m=o-1;0<=m;m--){let f=r[m],g=f.length,y=v(),_=!l;for(let w=0;w<g;w++){let A=f[w],k=A.length;if(k)for(let R=0,q,X;R<k;R++)if(X=A[R],l){if(l[X]){if(!m){if(e)e--;else if(s[p++]=X,p===i)return s}(m||n)&&(y[X]=1),_=!0}if(n&&(h[X]=(q=h[X])?++q:q=1,q<o)){let ie=n[q-2]||(n[q-2]=[]);ie[ie.length]=X}}else y[X]=1}if(n)l||(h=y);else if(!_)return[];l=y}if(n)for(let m=n.length-1,f,g;0<=m;m--){f=n[m],g=f.length;for(let y=0,_;y<g;y++)if(_=f[y],!l[_]){if(e)e--;else if(s[p++]=_,p===i)return s;l[_]=1}}return s}function na(r,i){let e=v(),n=v(),o=[];for(let s=0;s<r.length;s++)e[r[s]]=1;for(let s=0,l;s<i.length;s++){l=i[s];for(let h=0,p;h<l.length;h++)p=l[h],e[p]&&!n[p]&&(n[p]=1,o[o.length]=p)}return o}function J(r){this.l=r!==!0&&r,this.cache=v(),this.h=[]}function oa(r,i,e){C(r)&&(r=r.query);let n=this.cache.get(r);return n||(n=this.search(r,i,e),this.cache.set(r,n)),n}J.prototype.set=function(r,i){if(!this.cache[r]){var e=this.h.length;for(e===this.l?delete this.cache[this.h[e-1]]:e++,--e;0<e;e--)this.h[e]=this.h[e-1];this.h[0]=r}this.cache[r]=i},J.prototype.get=function(r){let i=this.cache[r];if(this.l&&i&&(r=this.h.indexOf(r))){let e=this.h[r-1];this.h[r-1]=this.h[r],this.h[r]=e}return i};let qa={memory:{charset:"latin:extra",D:3,B:4,m:!1},performance:{D:3,B:3,s:!1,context:{depth:2,D:1}},match:{charset:"latin:extra",G:"reverse"},score:{charset:"latin:advanced",D:20,B:3,context:{depth:3,D:9}},default:{}};function ra(r,i,e,n,o,s){setTimeout(function(){let l=r(e,JSON.stringify(s));l&&l.then?l.then(function(){i.export(r,i,e,n,o+1)}):i.export(r,i,e,n,o+1)})}function K(r,i){if(!(this instanceof K))return new K(r);var e;if(r){x(r)?r=qa[r]:(e=r.preset)&&(r=Object.assign({},e[e],r)),e=r.charset;var n=r.lang;x(e)&&(e.indexOf(":")===-1&&(e+=":default"),e=G[e]),x(n)&&(n=ka[n])}else r={};let o,s,l=r.context||{};if(this.encode=r.encode||e&&e.encode||ia,this.register=i||v(),this.D=o=r.resolution||9,this.G=i=e&&e.G||r.tokenize||"strict",this.depth=i==="strict"&&l.depth,this.l=u(l.bidirectional),this.s=s=u(r.optimize),this.m=u(r.fastupdate),this.B=r.minlength||1,this.C=r.boost,this.map=s?aa(o):v(),this.A=o=l.resolution||1,this.h=s?aa(o):v(),this.F=e&&e.F||r.rtl,this.H=(i=r.matcher||n&&n.H)&&fa(i,!1),this.J=(i=r.stemmer||n&&n.J)&&fa(i,!0),e=i=r.filter||n&&n.filter){e=i,n=v();for(let h=0,p=e.length;h<p;h++)n[e[h]]=1;e=n}this.filter=e,this.cache=(i=r.cache)&&new J(i)}t=K.prototype,t.append=function(r,i){return this.add(r,i,!0)},t.add=function(r,i,e,n){if(i&&(r||r===0)){if(!n&&!e&&this.register[r])return this.update(r,i);if(i=this.encode(i),n=i.length){let m=v(),f=v(),g=this.depth,y=this.D;for(let _=0;_<n;_++){let w=i[this.F?n-1-_:_];var o=w.length;if(w&&o>=this.B&&(g||!f[w])){var s=L(y,n,_),l="";switch(this.G){case"full":if(3<o){for(s=0;s<o;s++)for(var h=o;h>s;h--)if(h-s>=this.B){var p=L(y,n,_,o,s);l=w.substring(s,h),M(this,f,l,p,r,e)}break}case"reverse":if(2<o){for(h=o-1;0<h;h--)l=w[h]+l,l.length>=this.B&&M(this,f,l,L(y,n,_,o,h),r,e);l=""}case"forward":if(1<o){for(h=0;h<o;h++)l+=w[h],l.length>=this.B&&M(this,f,l,s,r,e);break}default:if(this.C&&(s=Math.min(s/this.C(i,w,_)|0,y-1)),M(this,f,w,s,r,e),g&&1<n&&_<n-1){for(o=v(),l=this.A,s=w,h=Math.min(g+1,n-_),o[s]=1,p=1;p<h;p++)if((w=i[this.F?n-1-_-p:_+p])&&w.length>=this.B&&!o[w]){o[w]=1;let A=this.l&&w>s;M(this,m,A?s:w,L(l+(n/2>l?0:1),n,_,h-1,p-1),r,e,A?w:s)}}}}}this.m||(this.register[r]=1)}}return this};function L(r,i,e,n,o){return e&&1<r?i+(n||0)<=r?e+(o||0):(r-1)/(i+(n||0))*(e+(o||0))+1|0:0}function M(r,i,e,n,o,s,l){let h=l?r.h:r.map;(!i[e]||l&&!i[e][l])&&(r.s&&(h=h[n]),l?(i=i[e]||(i[e]=v()),i[l]=1,h=h[l]||(h[l]=v())):i[e]=1,h=h[e]||(h[e]=[]),r.s||(h=h[n]||(h[n]=[])),s&&h.indexOf(o)!==-1||(h[h.length]=o,r.m&&(r=r.register[o]||(r.register[o]=[]),r[r.length]=h)))}t.search=function(r,i,e){e||(!i&&C(r)?(e=r,r=e.query):C(i)&&(e=i));let n=[],o,s,l=0;if(e){i=e.limit,l=e.offset||0;var h=e.context;s=e.suggest}if(r&&(r=this.encode(r),o=r.length,1<o)){e=v();var p=[];for(let f=0,g=0,y;f<o;f++)if((y=r[f])&&y.length>=this.B&&!e[y])if(this.s||s||this.map[y])p[g++]=y,e[y]=1;else return n;r=p,o=r.length}if(!o)return n;i||(i=100),h=this.depth&&1<o&&h!==!1,e=0;let m;h?(m=r[0],e=1):1<o&&r.sort(ba);for(let f,g;e<o;e++){if(g=r[e],h?(f=sa(this,n,s,i,l,o===2,g,m),s&&f===!1&&n.length||(m=g)):f=sa(this,n,s,i,l,o===1,g),f)return f;if(s&&e===o-1){if(p=n.length,!p){if(h){h=0,e=-1;continue}return n}if(p===1)return ta(n[0],i,l)}}return ma(n,i,l,s)};function sa(r,i,e,n,o,s,l,h){let p=[],m=h?r.h:r.map;if(r.s||(m=ua(m,l,h,r.l)),m){let f=0,g=Math.min(m.length,h?r.A:r.D);for(let y=0,_=0,w,A;y<g&&!((w=m[y])&&(r.s&&(w=ua(w,l,h,r.l)),o&&w&&s&&(A=w.length,A<=o?(o-=A,w=null):(w=w.slice(o),o=0)),w&&(p[f++]=w,s&&(_+=w.length,_>=n))));y++);if(f){if(s)return ta(p,n,0);i[i.length]=p;return}}return!e&&p}function ta(r,i,e){return r=r.length===1?r[0]:[].concat.apply([],r),e||r.length>i?r.slice(e,e+i):r}function ua(r,i,e,n){return e?(n=n&&i>e,r=(r=r[n?i:e])&&r[n?e:i]):r=r[i],r}t.contain=function(r){return!!this.register[r]},t.update=function(r,i){return this.remove(r).add(r,i)},t.remove=function(r,i){let e=this.register[r];if(e){if(this.m)for(let n=0,o;n<e.length;n++)o=e[n],o.splice(o.indexOf(r),1);else N(this.map,r,this.D,this.s),this.depth&&N(this.h,r,this.A,this.s);if(i||delete this.register[r],this.cache){i=this.cache;for(let n=0,o,s;n<i.h.length;n++)s=i.h[n],o=i.cache[s],o.indexOf(r)!==-1&&(i.h.splice(n--,1),delete i.cache[s])}}return this};function N(r,i,e,n,o){let s=0;if(r.constructor===Array)if(o)i=r.indexOf(i),i!==-1?1<r.length&&(r.splice(i,1),s++):s++;else{o=Math.min(r.length,e);for(let l=0,h;l<o;l++)(h=r[l])&&(s=N(h,i,e,n,o),n||s||delete r[l])}else for(let l in r)(s=N(r[l],i,e,n,o))||delete r[l];return s}t.searchCache=oa,t.export=function(r,i,e,n,o){let s,l;switch(o||(o=0)){case 0:if(s="reg",this.m){l=v();for(let h in this.register)l[h]=1}else l=this.register;break;case 1:s="cfg",l={doc:0,opt:this.s?1:0};break;case 2:s="map",l=this.map;break;case 3:s="ctx",l=this.h;break;default:return}return ra(r,i||this,e?e+"."+s:s,n,o,l),!0},t.import=function(r,i){if(i)switch(x(i)&&(i=JSON.parse(i)),r){case"cfg":this.s=!!i.opt;break;case"reg":this.m=!1,this.register=i;break;case"map":this.map=i;break;case"ctx":this.h=i}},la(K.prototype);function va(r){r=r.data;var i=self._index;let e=r.args;var n=r.task;switch(n){case"init":n=r.options||{},r=r.factory,i=n.encode,n.cache=!1,i&&i.indexOf("function")===0&&(n.encode=Function("return "+i)()),r?(Function("return "+r)()(self),self._index=new self.FlexSearch.Index(n),delete self.FlexSearch):self._index=new K(n);break;default:r=r.id,i=i[n].apply(i,e),postMessage(n==="search"?{id:r,msg:i}:{id:r})}}let wa=0;function O(r){if(!(this instanceof O))return new O(r);var i;r?D(i=r.encode)&&(r.encode=i.toString()):r={},(i=(self||window)._factory)&&(i=i.toString());let e=self.exports,n=this;this.o=xa(i,e,r.worker),this.h=v(),this.o&&(e?this.o.on("message",function(o){n.h[o.id](o.msg),delete n.h[o.id]}):this.o.onmessage=function(o){o=o.data,n.h[o.id](o.msg),delete n.h[o.id]},this.o.postMessage({task:"init",factory:i,options:r}))}P("add"),P("append"),P("search"),P("update"),P("remove");function P(r){O.prototype[r]=O.prototype[r+"Async"]=function(){let i=this,e=[].slice.call(arguments);var n=e[e.length-1];let o;return D(n)&&(o=n,e.splice(e.length-1,1)),n=new Promise(function(s){setTimeout(function(){i.h[++wa]=s,i.o.postMessage({task:r,id:wa,args:e})})}),o?(n.then(o),this):n}}function xa(a,b,c){let d;try{d=b?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):a?new Worker(URL.createObjectURL(new Blob(["onmessage="+va.toString()],{type:"text/javascript"}))):new Worker(x(c)?c:"worker/worker.js",{type:"module"})}catch(r){}return d}function Q(r){if(!(this instanceof Q))return new Q(r);var i=r.document||r.doc||r,e;this.K=[],this.h=[],this.A=[],this.register=v(),this.key=(e=i.key||i.id)&&S(e,this.A)||"id",this.m=u(r.fastupdate),this.C=(e=i.store)&&e!==!0&&[],this.store=e&&v(),this.I=(e=i.tag)&&S(e,this.A),this.l=e&&v(),this.cache=(e=r.cache)&&new J(e),r.cache=!1,this.o=r.worker,this.async=!1,e=v();let n=i.index||i.field||i;x(n)&&(n=[n]);for(let o=0,s,l;o<n.length;o++)s=n[o],x(s)||(l=s,s=s.field),l=C(l)?Object.assign({},r,l):r,this.o&&(e[s]=new O(l),e[s].o||(this.o=!1)),this.o||(e[s]=new K(l,this.register)),this.K[o]=S(s,this.A),this.h[o]=s;if(this.C)for(r=i.store,x(r)&&(r=[r]),i=0;i<r.length;i++)this.C[i]=S(r[i],this.A);this.index=e}function S(r,i){let e=r.split(":"),n=0;for(let o=0;o<e.length;o++)r=e[o],0<=r.indexOf("[]")&&(r=r.substring(0,r.length-2))&&(i[n]=!0),r&&(e[n++]=r);return n<e.length&&(e.length=n),1<n?e:e[0]}function T(r,i){if(x(i))r=r[i];else for(let e=0;r&&e<i.length;e++)r=r[i[e]];return r}function U(r,i,e,n,o){if(r=r[o],n===e.length-1)i[o]=r;else if(r)if(r.constructor===Array)for(i=i[o]=Array(r.length),o=0;o<r.length;o++)U(r,i,e,n,o);else i=i[o]||(i[o]=v()),o=e[++n],U(r,i,e,n,o)}function V(r,i,e,n,o,s,l,h){if(r=r[l])if(n===i.length-1){if(r.constructor===Array){if(e[n]){for(i=0;i<r.length;i++)o.add(s,r[i],!0,!0);return}r=r.join(" ")}o.add(s,r,h,!0)}else if(r.constructor===Array)for(l=0;l<r.length;l++)V(r,i,e,n,o,s,l,h);else l=i[++n],V(r,i,e,n,o,s,l,h)}t=Q.prototype,t.add=function(r,i,e){if(C(r)&&(i=r,r=T(i,this.key)),i&&(r||r===0)){if(!e&&this.register[r])return this.update(r,i);for(let n=0,o,s;n<this.h.length;n++)s=this.h[n],o=this.K[n],x(o)&&(o=[o]),V(i,o,this.A,0,this.index[s],r,o[0],e);if(this.I){let n=T(i,this.I),o=v();x(n)&&(n=[n]);for(let s=0,l,h;s<n.length;s++)if(l=n[s],!o[l]&&(o[l]=1,h=this.l[l]||(this.l[l]=[]),!e||h.indexOf(r)===-1)&&(h[h.length]=r,this.m)){let p=this.register[r]||(this.register[r]=[]);p[p.length]=h}}if(this.store&&(!e||!this.store[r])){let n;if(this.C){n=v();for(let o=0,s;o<this.C.length;o++)s=this.C[o],x(s)?n[s]=i[s]:U(i,n,s,0,s[0])}this.store[r]=n||i}}return this},t.append=function(r,i){return this.add(r,i,!0)},t.update=function(r,i){return this.remove(r).add(r,i)},t.remove=function(r){if(C(r)&&(r=T(r,this.key)),this.register[r]){for(var i=0;i<this.h.length&&(this.index[this.h[i]].remove(r,!this.o),!this.m);i++);if(this.I&&!this.m)for(let e in this.l){i=this.l[e];let n=i.indexOf(r);n!==-1&&(1<i.length?i.splice(n,1):delete this.l[e])}this.store&&delete this.store[r],delete this.register[r]}return this},t.search=function(r,i,e,n){e||(!i&&C(r)?(e=r,r=e.query):C(i)&&(e=i,i=0));let o=[],s=[],l,h,p,m,f,g,y=0;if(e)if(e.constructor===Array)p=e,e=null;else{if(p=(l=e.pluck)||e.index||e.field,m=e.tag,h=this.store&&e.enrich,f=e.bool==="and",i=e.limit||100,g=e.offset||0,m&&(x(m)&&(m=[m]),!r)){for(let w=0,A;w<m.length;w++)(A=ya.call(this,m[w],i,g,h))&&(o[o.length]=A,y++);return y?o:[]}x(p)&&(p=[p])}p||(p=this.h),f=f&&(1<p.length||m&&1<m.length);let _=!n&&(this.o||this.async)&&[];for(let w=0,A,k,R;w<p.length;w++){let q;if(k=p[w],x(k)||(q=k,k=k.field),_)_[w]=this.index[k].searchAsync(r,i,q||e);else{if(n?A=n[w]:A=this.index[k].search(r,i,q||e),R=A&&A.length,m&&R){let X=[],ie=0;f&&(X[0]=[A]);for(let ae=0,be,me;ae<m.length;ae++)be=m[ae],(R=(me=this.l[be])&&me.length)&&(ie++,X[X.length]=f?[me]:me);ie&&(A=f?ma(X,i||100,g||0):na(A,X),R=A.length)}if(R)s[y]=k,o[y++]=A;else if(f)return[]}}if(_){let w=this;return new Promise(function(A){Promise.all(_).then(function(k){A(w.search(r,i,e,k))})})}if(!y)return[];if(l&&(!h||!this.store))return o[0];for(let w=0,A;w<s.length;w++){if(A=o[w],A.length&&h&&(A=za.call(this,A)),l)return A;o[w]={field:s[w],result:A}}return o};function ya(r,i,e,n){let o=this.l[r],s=o&&o.length-e;if(s&&0<s)return(s>i||e)&&(o=o.slice(e,e+i)),n&&(o=za.call(this,o)),{tag:r,result:o}}function za(r){let i=Array(r.length);for(let e=0,n;e<r.length;e++)n=r[e],i[e]={id:n,doc:this.store[n]};return i}t.contain=function(r){return!!this.register[r]},t.get=function(r){return this.store[r]},t.set=function(r,i){return this.store[r]=i,this},t.searchCache=oa,t.export=function(r,i,e,n,o){if(o||(o=0),n||(n=0),n<this.h.length){let s=this.h[n],l=this.index[s];i=this,setTimeout(function(){l.export(r,i,o?s.replace(":","-"):"",n,o++)||(n++,o=1,i.export(r,i,s,n,o))})}else{let s;switch(o){case 1:e="tag",s=this.l;break;case 2:e="store",s=this.store;break;default:return}ra(r,this,e,n,o,s)}},t.import=function(r,i){if(i)switch(x(i)&&(i=JSON.parse(i)),r){case"tag":this.l=i;break;case"reg":this.m=!1,this.register=i;for(let n=0,o;n<this.h.length;n++)o=this.index[this.h[n]],o.register=i,o.m=!1;break;case"store":this.store=i;break;default:r=r.split(".");let e=r[0];r=r[1],e&&r&&this.index[e].import(r,i)}},la(Q.prototype);var Ba={encode:Aa,F:!1,G:""};let Ca=[F("[\xE0\xE1\xE2\xE3\xE4\xE5]"),"a",F("[\xE8\xE9\xEA\xEB]"),"e",F("[\xEC\xED\xEE\xEF]"),"i",F("[\xF2\xF3\xF4\xF5\xF6\u0151]"),"o",F("[\xF9\xFA\xFB\xFC\u0171]"),"u",F("[\xFD\u0177\xFF]"),"y",F("\xF1"),"n",F("[\xE7c]"),"k",F("\xDF"),"s",F(" & ")," and "];function Aa(r){var i=r;return i.normalize&&(i=i.normalize("NFD").replace(ea,"")),ca.call(this,i.toLowerCase(),!r.normalize&&Ca)}var Ea={encode:Da,F:!1,G:"strict"};let Fa=/[^a-z0-9]+/,Ga={b:"p",v:"f",w:"f",z:"s",x:"s",\u00DF:"s",d:"t",n:"m",c:"k",g:"k",j:"k",q:"k",i:"e",y:"e",u:"o"};function Da(r){r=Aa.call(this,r).join(" ");let i=[];if(r){let e=r.split(Fa),n=e.length;for(let o=0,s,l=0;o<n;o++)if((r=e[o])&&(!this.filter||!this.filter[r])){s=r[0];let h=Ga[s]||s,p=h;for(let m=1;m<r.length;m++){s=r[m];let f=Ga[s]||s;f&&f!==p&&(h+=f,p=f)}i[l++]=h}}return i}var Ia={encode:Ha,F:!1,G:""};let Ja=[F("ae"),"a",F("oe"),"o",F("sh"),"s",F("th"),"t",F("ph"),"f",F("pf"),"f",F("(?![aeo])h(?![aeo])"),"",F("(?!^[aeo])h(?!^[aeo])"),""];function Ha(r,i){return r&&(r=Da.call(this,r).join(" "),2<r.length&&(r=E(r,Ja)),i||(1<r.length&&(r=ha(r)),r&&(r=r.split(" ")))),r}var La={encode:Ka,F:!1,G:""};let Ma=F("(?!\\b)[aeo]");function Ka(r){return r&&(r=Ha.call(this,r,!0),1<r.length&&(r=r.replace(Ma,"")),1<r.length&&(r=ha(r)),r&&(r=r.split(" "))),r}G["latin:default"]=ja,G["latin:simple"]=Ba,G["latin:balance"]=Ea,G["latin:advanced"]=Ia,G["latin:extra"]=La;let W=self,Y,Z={Index:K,Document:Q,Worker:O,registerCharset:function(r,i){G[r]=i},registerLanguage:function(r,i){ka[r]=i}};(Y=W.define)&&Y.amd?Y([],function(){return Z}):W.exports?W.exports=Z:W.FlexSearch=Z})(exports)});var w8=Bd(Lr=>{"use strict";Object.defineProperty(Lr,"__esModule",{value:!0});Lr.earthRadius=63710088e-1;Lr.factors={centimeters:Lr.earthRadius*100,centimetres:Lr.earthRadius*100,degrees:Lr.earthRadius/111325,feet:Lr.earthRadius*3.28084,inches:Lr.earthRadius*39.37,kilometers:Lr.earthRadius/1e3,kilometres:Lr.earthRadius/1e3,meters:Lr.earthRadius,metres:Lr.earthRadius,miles:Lr.earthRadius/1609.344,millimeters:Lr.earthRadius*1e3,millimetres:Lr.earthRadius*1e3,nauticalmiles:Lr.earthRadius/1852,radians:1,yards:Lr.earthRadius*1.0936};Lr.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Lr.earthRadius,yards:1.0936133};Lr.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function A_(r,i,e){e===void 0&&(e={});var n={type:"Feature"};return(e.id===0||e.id)&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.properties=i||{},n.geometry=r,n}Lr.feature=A_;function xAe(r,i,e){switch(e===void 0&&(e={}),r){case"Point":return _8(i).geometry;case"LineString":return v8(i).geometry;case"Polygon":return y8(i).geometry;case"MultiPoint":return nee(i).geometry;case"MultiLineString":return ree(i).geometry;case"MultiPolygon":return oee(i).geometry;default:throw new Error(r+" is invalid")}}Lr.geometry=xAe;function _8(r,i,e){if(e===void 0&&(e={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!l3(r[0])||!l3(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return A_(n,i,e)}Lr.point=_8;function SAe(r,i,e){return e===void 0&&(e={}),c3(r.map(function(n){return _8(n,i)}),e)}Lr.points=SAe;function y8(r,i,e){e===void 0&&(e={});for(var n=0,o=r;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<s[s.length-1].length;l++)if(s[s.length-1][l]!==s[0][l])throw new Error("First and last Position are not equivalent.")}var h={type:"Polygon",coordinates:r};return A_(h,i,e)}Lr.polygon=y8;function CAe(r,i,e){return e===void 0&&(e={}),c3(r.map(function(n){return y8(n,i)}),e)}Lr.polygons=CAe;function v8(r,i,e){if(e===void 0&&(e={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return A_(n,i,e)}Lr.lineString=v8;function AAe(r,i,e){return e===void 0&&(e={}),c3(r.map(function(n){return v8(n,i)}),e)}Lr.lineStrings=AAe;function c3(r,i){i===void 0&&(i={});var e={type:"FeatureCollection"};return i.id&&(e.id=i.id),i.bbox&&(e.bbox=i.bbox),e.features=r,e}Lr.featureCollection=c3;function ree(r,i,e){e===void 0&&(e={});var n={type:"MultiLineString",coordinates:r};return A_(n,i,e)}Lr.multiLineString=ree;function nee(r,i,e){e===void 0&&(e={});var n={type:"MultiPoint",coordinates:r};return A_(n,i,e)}Lr.multiPoint=nee;function oee(r,i,e){e===void 0&&(e={});var n={type:"MultiPolygon",coordinates:r};return A_(n,i,e)}Lr.multiPolygon=oee;function MAe(r,i,e){e===void 0&&(e={});var n={type:"GeometryCollection",geometries:r};return A_(n,i,e)}Lr.geometryCollection=MAe;function IAe(r,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var e=Math.pow(10,i||0);return Math.round(r*e)/e}Lr.round=IAe;function aee(r,i){i===void 0&&(i="kilometers");var e=Lr.factors[i];if(!e)throw new Error(i+" units is invalid");return r*e}Lr.radiansToLength=aee;function b8(r,i){i===void 0&&(i="kilometers");var e=Lr.factors[i];if(!e)throw new Error(i+" units is invalid");return r/e}Lr.lengthToRadians=b8;function EAe(r,i){return see(b8(r,i))}Lr.lengthToDegrees=EAe;function TAe(r){var i=r%360;return i<0&&(i+=360),i}Lr.bearingToAzimuth=TAe;function see(r){var i=r%(2*Math.PI);return i*180/Math.PI}Lr.radiansToDegrees=see;function FAe(r){var i=r%360;return i*Math.PI/180}Lr.degreesToRadians=FAe;function PAe(r,i,e){if(i===void 0&&(i="kilometers"),e===void 0&&(e="kilometers"),!(r>=0))throw new Error("length must be a positive number");return aee(b8(r,i),e)}Lr.convertLength=PAe;function LAe(r,i,e){if(i===void 0&&(i="meters"),e===void 0&&(e="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Lr.areaFactors[i];if(!n)throw new Error("invalid original units");var o=Lr.areaFactors[e];if(!o)throw new Error("invalid final units");return r/n*o}Lr.convertArea=LAe;function l3(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}Lr.isNumber=l3;function kAe(r){return!!r&&r.constructor===Object}Lr.isObject=kAe;function OAe(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(i){if(!l3(i))throw new Error("bbox must only contain numbers")})}Lr.validateBBox=OAe;function DAe(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}Lr.validateId=DAe});var S8=Bd(Kl=>{"use strict";Object.defineProperty(Kl,"__esModule",{value:!0});var fu=w8();function wC(r,i,e){if(r!==null)for(var n,o,s,l,h,p,m,f=0,g=0,y,_=r.type,w=_==="FeatureCollection",A=_==="Feature",k=w?r.features.length:1,R=0;R<k;R++){m=w?r.features[R].geometry:A?r.geometry:r,y=m?m.type==="GeometryCollection":!1,h=y?m.geometries.length:1;for(var q=0;q<h;q++){var X=0,ie=0;if(l=y?m.geometries[q]:m,l!==null){p=l.coordinates;var ae=l.type;switch(f=e&&(ae==="Polygon"||ae==="MultiPolygon")?1:0,ae){case null:break;case"Point":if(i(p,g,R,X,ie)===!1)return!1;g++,X++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],g,R,X,ie)===!1)return!1;g++,ae==="MultiPoint"&&X++}ae==="LineString"&&X++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(o=0;o<p[n].length-f;o++){if(i(p[n][o],g,R,X,ie)===!1)return!1;g++}ae==="MultiLineString"&&X++,ae==="Polygon"&&ie++}ae==="Polygon"&&X++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(ie=0,o=0;o<p[n].length;o++){for(s=0;s<p[n][o].length-f;s++){if(i(p[n][o][s],g,R,X,ie)===!1)return!1;g++}ie++}X++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(wC(l.geometries[n],i,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function RAe(r,i,e,n){var o=e;return wC(r,function(s,l,h,p,m){l===0&&e===void 0?o=s:o=i(o,s,l,h,p,m)},n),o}function lee(r,i){var e;switch(r.type){case"FeatureCollection":for(e=0;e<r.features.length&&i(r.features[e].properties,e)!==!1;e++);break;case"Feature":i(r.properties,0);break}}function NAe(r,i,e){var n=e;return lee(r,function(o,s){s===0&&e===void 0?n=o:n=i(n,o,s)}),n}function cee(r,i){if(r.type==="Feature")i(r,0);else if(r.type==="FeatureCollection")for(var e=0;e<r.features.length&&i(r.features[e],e)!==!1;e++);}function BAe(r,i,e){var n=e;return cee(r,function(o,s){s===0&&e===void 0?n=o:n=i(n,o,s)}),n}function GAe(r){var i=[];return wC(r,function(e){i.push(e)}),i}function x8(r,i){var e,n,o,s,l,h,p,m,f,g,y=0,_=r.type==="FeatureCollection",w=r.type==="Feature",A=_?r.features.length:1;for(e=0;e<A;e++){for(h=_?r.features[e].geometry:w?r.geometry:r,m=_?r.features[e].properties:w?r.properties:{},f=_?r.features[e].bbox:w?r.bbox:void 0,g=_?r.features[e].id:w?r.id:void 0,p=h?h.type==="GeometryCollection":!1,l=p?h.geometries.length:1,o=0;o<l;o++){if(s=p?h.geometries[o]:h,s===null){if(i(null,y,m,f,g)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,y,m,f,g)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],y,m,f,g)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}y++}}function jAe(r,i,e){var n=e;return x8(r,function(o,s,l,h,p){s===0&&e===void 0?n=o:n=i(n,o,s,l,h,p)}),n}function u3(r,i){x8(r,function(e,n,o,s,l){var h=e===null?null:e.type;switch(h){case null:case"Point":case"LineString":case"Polygon":return i(fu.feature(e,o,{bbox:s,id:l}),n,0)===!1?!1:void 0}var p;switch(h){case"MultiPoint":p="Point";break;case"MultiLineString":p="LineString";break;case"MultiPolygon":p="Polygon";break}for(var m=0;m<e.coordinates.length;m++){var f=e.coordinates[m],g={type:p,coordinates:f};if(i(fu.feature(g,o),n,m)===!1)return!1}})}function VAe(r,i,e){var n=e;return u3(r,function(o,s,l){s===0&&l===0&&e===void 0?n=o:n=i(n,o,s,l)}),n}function uee(r,i){u3(r,function(e,n,o){var s=0;if(e.geometry){var l=e.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var h,p=0,m=0,f=0;if(wC(e,function(g,y,_,w,A){if(h===void 0||n>p||w>m||A>f){h=g,p=n,m=w,f=A,s=0;return}var k=fu.lineString([h,g],e.properties);if(i(k,n,o,A,s)===!1)return!1;s++,h=g})===!1)return!1}}})}function UAe(r,i,e){var n=e,o=!1;return uee(r,function(s,l,h,p,m){o===!1&&e===void 0?n=s:n=i(n,s,l,h,p,m),o=!0}),n}function dee(r,i){if(!r)throw new Error("geojson is required");u3(r,function(e,n,o){if(e.geometry!==null){var s=e.geometry.type,l=e.geometry.coordinates;switch(s){case"LineString":if(i(e,n,o,0,0)===!1)return!1;break;case"Polygon":for(var h=0;h<l.length;h++)if(i(fu.lineString(l[h],e.properties),n,o,h)===!1)return!1;break}}})}function zAe(r,i,e){var n=e;return dee(r,function(o,s,l,h){s===0&&e===void 0?n=o:n=i(n,o,s,l,h)}),n}function $Ae(r,i){if(i=i||{},!fu.isObject(i))throw new Error("options is invalid");var e=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,s=i.segmentIndex||0,l=i.properties,h;switch(r.type){case"FeatureCollection":e<0&&(e=r.features.length+e),l=l||r.features[e].properties,h=r.features[e].geometry;break;case"Feature":l=l||r.properties,h=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=r;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var p=h.coordinates;switch(h.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=p.length+s-1),fu.lineString([p[s],p[s+1]],l,i);case"Polygon":return o<0&&(o=p.length+o),s<0&&(s=p[o].length+s-1),fu.lineString([p[o][s],p[o][s+1]],l,i);case"MultiLineString":return n<0&&(n=p.length+n),s<0&&(s=p[n].length+s-1),fu.lineString([p[n][s],p[n][s+1]],l,i);case"MultiPolygon":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),s<0&&(s=p[n][o].length-s-1),fu.lineString([p[n][o][s],p[n][o][s+1]],l,i)}throw new Error("geojson is invalid")}function WAe(r,i){if(i=i||{},!fu.isObject(i))throw new Error("options is invalid");var e=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,s=i.coordIndex||0,l=i.properties,h;switch(r.type){case"FeatureCollection":e<0&&(e=r.features.length+e),l=l||r.features[e].properties,h=r.features[e].geometry;break;case"Feature":l=l||r.properties,h=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":h=r;break;default:throw new Error("geojson is invalid")}if(h===null)return null;var p=h.coordinates;switch(h.type){case"Point":return fu.point(p,l,i);case"MultiPoint":return n<0&&(n=p.length+n),fu.point(p[n],l,i);case"LineString":return s<0&&(s=p.length+s),fu.point(p[s],l,i);case"Polygon":return o<0&&(o=p.length+o),s<0&&(s=p[o].length+s),fu.point(p[o][s],l,i);case"MultiLineString":return n<0&&(n=p.length+n),s<0&&(s=p[n].length+s),fu.point(p[n][s],l,i);case"MultiPolygon":return n<0&&(n=p.length+n),o<0&&(o=p[n].length+o),s<0&&(s=p[n][o].length-s),fu.point(p[n][o][s],l,i)}throw new Error("geojson is invalid")}Kl.coordAll=GAe;Kl.coordEach=wC;Kl.coordReduce=RAe;Kl.featureEach=cee;Kl.featureReduce=BAe;Kl.findPoint=WAe;Kl.findSegment=$Ae;Kl.flattenEach=u3;Kl.flattenReduce=VAe;Kl.geomEach=x8;Kl.geomReduce=jAe;Kl.lineEach=dee;Kl.lineReduce=zAe;Kl.propEach=lee;Kl.propReduce=NAe;Kl.segmentEach=uee;Kl.segmentReduce=UAe});var hee=Bd(A8=>{"use strict";Object.defineProperty(A8,"__esModule",{value:!0});var HAe=S8();function C8(r){var i=[1/0,1/0,-1/0,-1/0];return HAe.coordEach(r,function(e){i[0]>e[0]&&(i[0]=e[0]),i[1]>e[1]&&(i[1]=e[1]),i[2]<e[0]&&(i[2]=e[0]),i[3]<e[1]&&(i[3]=e[1])}),i}C8.default=C8;A8.default=C8});var _ee=Bd((qOt,M8)=>{var ff=QI(),mee=w8(),fee=S8(),bw=hee().default,qAe=fee.featureEach,WOt=fee.coordEach,HOt=mee.polygon,pee=mee.featureCollection;function gee(r){var i=new ff(r);return i.insert=function(e){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:bw(e),ff.prototype.insert.call(this,e)},i.load=function(e){var n=[];return Array.isArray(e)?e.forEach(function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:bw(o),n.push(o)}):qAe(e,function(o){if(o.type!=="Feature")throw new Error("invalid features");o.bbox=o.bbox?o.bbox:bw(o),n.push(o)}),ff.prototype.load.call(this,n)},i.remove=function(e,n){if(e.type!=="Feature")throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:bw(e),ff.prototype.remove.call(this,e,n)},i.clear=function(){return ff.prototype.clear.call(this)},i.search=function(e){var n=ff.prototype.search.call(this,this.toBBox(e));return pee(n)},i.collides=function(e){return ff.prototype.collides.call(this,this.toBBox(e))},i.all=function(){var e=ff.prototype.all.call(this);return pee(e)},i.toJSON=function(){return ff.prototype.toJSON.call(this)},i.fromJSON=function(e){return ff.prototype.fromJSON.call(this,e)},i.toBBox=function(e){var n;if(e.bbox)n=e.bbox;else if(Array.isArray(e)&&e.length===4)n=e;else if(Array.isArray(e)&&e.length===6)n=[e[0],e[1],e[3],e[4]];else if(e.type==="Feature")n=bw(e);else if(e.type==="FeatureCollection")n=bw(e);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},i}M8.exports=gee;M8.exports.default=gee});var p0=function(r){return r.System="system",r.User="user",r}(p0||{});var rP=(r,i)=>i.some(e=>r instanceof e),l9,c9;function Die(){return l9||(l9=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Rie(){return c9||(c9=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var nP=new WeakMap,tP=new WeakMap,HA=new WeakMap;function Nie(r){let i=new Promise((e,n)=>{let o=()=>{r.removeEventListener("success",s),r.removeEventListener("error",l)},s=()=>{e(ey(r.result)),o()},l=()=>{n(r.error),o()};r.addEventListener("success",s),r.addEventListener("error",l)});return HA.set(i,r),i}function Bie(r){if(nP.has(r))return;let i=new Promise((e,n)=>{let o=()=>{r.removeEventListener("complete",s),r.removeEventListener("error",l),r.removeEventListener("abort",l)},s=()=>{e(),o()},l=()=>{n(r.error||new DOMException("AbortError","AbortError")),o()};r.addEventListener("complete",s),r.addEventListener("error",l),r.addEventListener("abort",l)});nP.set(r,i)}var oP={get(r,i,e){if(r instanceof IDBTransaction){if(i==="done")return nP.get(r);if(i==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ey(r[i])},set(r,i,e){return r[i]=e,!0},has(r,i){return r instanceof IDBTransaction&&(i==="done"||i==="store")?!0:i in r}};function p9(r){oP=r(oP)}function Gie(r){return Rie().includes(r)?function(...i){return r.apply(aP(this),i),ey(this.request)}:function(...i){return ey(r.apply(aP(this),i))}}function jie(r){return typeof r=="function"?Gie(r):(r instanceof IDBTransaction&&Bie(r),rP(r,Die())?new Proxy(r,oP):r)}function ey(r){if(r instanceof IDBRequest)return Nie(r);if(tP.has(r))return tP.get(r);let i=jie(r);return i!==r&&(tP.set(r,i),HA.set(i,r)),i}var aP=r=>HA.get(r);function m9(r,i,{blocked:e,upgrade:n,blocking:o,terminated:s}={}){let l=indexedDB.open(r,i),h=ey(l);return n&&l.addEventListener("upgradeneeded",p=>{n(ey(l.result),p.oldVersion,p.newVersion,ey(l.transaction),p)}),e&&l.addEventListener("blocked",p=>e(p.oldVersion,p.newVersion,p)),h.then(p=>{s&&p.addEventListener("close",()=>s()),o&&p.addEventListener("versionchange",m=>o(m.oldVersion,m.newVersion,m))}).catch(()=>{}),h}var Vie=["get","getKey","getAll","getAllKeys","count"],Uie=["put","add","delete","clear"],iP=new Map;function u9(r,i){if(!(r instanceof IDBDatabase&&!(i in r)&&typeof i=="string"))return;if(iP.get(i))return iP.get(i);let e=i.replace(/FromIndex$/,""),n=i!==e,o=Uie.includes(e);if(!(e in(n?IDBIndex:IDBObjectStore).prototype)||!(o||Vie.includes(e)))return;let s=function(l,...h){return un(this,null,function*(){let p=this.transaction(l,o?"readwrite":"readonly"),m=p.store;return n&&(m=m.index(h.shift())),(yield Promise.all([m[e](...h),o&&p.done]))[0]})};return iP.set(i,s),s}p9(r=>En(ur({},r),{get:(i,e,n)=>u9(i,e)||r.get(i,e,n),has:(i,e)=>!!u9(i,e)||r.has(i,e)}));var zie=["continue","continuePrimaryKey","advance"],d9={},sP=new WeakMap,f9=new WeakMap,$ie={get(r,i){if(!zie.includes(i))return r[i];let e=d9[i];return e||(e=d9[i]=function(...n){sP.set(this,f9.get(this)[i](...n))}),e}};function Wie(...r){return f7(this,null,function*(){let i=this;if(i instanceof IDBCursor||(i=yield new NF(i.openCursor(...r))),!i)return;i=i;let e=new Proxy(i,$ie);for(f9.set(e,i),HA.set(e,aP(i));i;)yield e,i=yield new NF(sP.get(e)||i.continue()),sP.delete(e)})}function h9(r,i){return i===Symbol.asyncIterator&&rP(r,[IDBIndex,IDBObjectStore,IDBCursor])||i==="iterate"&&rP(r,[IDBIndex,IDBObjectStore])}p9(r=>En(ur({},r),{get(i,e,n){return h9(i,e)?Wie:r.get(i,e,n)},has(i,e){return h9(i,e)||r.has(i,e)}}));function U1(){return Gc(m9("igo2DB",3,{upgrade(r){r.createObjectStore("geoData",{keyPath:"url",autoIncrement:!1}).createIndex("regionID-idx","regionID",{unique:!1}),r.createObjectStore("layerData",{keyPath:"layerId",autoIncrement:!1})}}))}var zd=class{db$;compression=new _G;collisionsMap=new Map;_newData=0;revertObservablesSubscription;constructor(){this.db$=U1()}update(i,e,n,o,s){let l=n instanceof Blob?this.compression.compressBlob(n):ai(n),h=n instanceof Blob,p;return this.db$.pipe(Xn(f=>l.pipe(Ps(),Xn(g=>(p={url:i,regionID:e,object:g,compressed:h,insertSource:o,insertEvent:s},this.getGeoDBData(i))),qs(g=>{if(g){let y=g.regionID;if(y!==e){let _=this.collisionsMap.get(y);_!==void 0?(_.push(g.url),this.collisionsMap.set(y,_)):this.collisionsMap.set(y,[g.url])}return this.customUpdate(p)}else return this._newData++,Gc(f.add("geoData",p)).pipe(Nt(()=>p))}))))}customUpdate(i){return this.delete(i.url).pipe(kf(()=>this.add(i)))}add(i){return this.db$.pipe(Xn(e=>Gc(e?.add("geoData",i)).pipe(Nt(()=>i))))}put(i){return this.db$.pipe(Xn(e=>Gc(e?.put("geoData",i)).pipe(Nt(()=>i))))}getGeoDBData(i){return this.db$.pipe(Xn(e=>Gc(e?.get("geoData",i))))}get(i){return this.getGeoDBData(i).pipe(kf(e=>{let n=e?.compressed?this.compression.decompressBlob(e?.object):e?.object;return ai(n)}))}delete(i){return this.db$.pipe(Xn(e=>Gc(e?.delete("geoData",i))),Nt(()=>({key:i})))}deleteByKey(i){return this.delete(i)}getRegionCountByID(i){return this.getRegionByID(i).pipe(Xn(e=>ai(e.length)))}getRegionByID(i){if(!i)return;let e=IDBKeyRange.only(i);return this.db$.pipe(Xn(n=>Gc(n?.getAllFromIndex("geoData","regionID-idx",e))))}deleteByRegionID(i){if(i)return this.db$.pipe(Xn(e=>{let n=e.transaction("geoData","readwrite");return ai(n)}),kf(e=>this.getRegionByID(i).pipe(qs(n=>{let o=n.map(s=>e.store.delete(s.url));return o.push(e.done),Gc(Promise.all(o))}))))}resetCounters(){this.resetCollisionsMap(),this._newData=0}resetCollisionsMap(){this.collisionsMap=new Map}revertCollisions(){this.revertObservablesSubscription&&this.revertObservablesSubscription.unsubscribe();let i=[];for(let[e,n]of this.collisionsMap)for(let o of n)i.push(this.getGeoDBData(o).pipe(Ps(),qs(s=>{let l=s;return l.regionID=e,this.customUpdate(l)})));this.revertObservablesSubscription=Sh(...i).subscribe()}get newData(){return this._newData}};var _9=Jl(cP());var y9=(()=>{class r{http;messageService;constructor(e,n){this.http=e,this.messageService=n}load(e){let n=new zd,o;this.http.get(e).pipe(qr(s=>{throw this.messageService.error(`GeoData file ${e} could not be read`),s.error.caught=!0,s}),qs(s=>{let l=[],h=!0;if(s?.geoDatas){let p=new Date;s?.geoDatas.forEach(m=>{if(typeof m.triggerDate=="string"&&(m.triggerDate=new Date(Date.parse(m.triggerDate))),p>=m.triggerDate)if(m.action==="update"){let f=`${m.source||p0.System} (${m.triggerDate})`;m.urls.forEach(g=>{l.push(n.getGeoDBData(g).pipe(qs(y=>{if(y?.insertEvent!==f){h&&(o=this.messageService.info("igo.geo.indexedDb.data-download-start",void 0,{disableTimeOut:!0,progressBar:!1,closeButton:!0,tapToDismiss:!1}),h=!1);let _="json",w=this.isZip(g);return w&&(_="arraybuffer"),this.http.get(g,{responseType:_}).pipe(qr(A=>{throw this.messageService.remove(o.toastId),this.messageService.error("igo.geo.indexedDb.data-download-failed",void 0,{timeOut:4e4}),A.error.caught=!0,A}),qs(A=>{if(w){let k=[n.update(g,g,{},p0.System,f)];return _9.default.loadAsync(A).then(R=>{R.forEach(q=>{q.toLocaleLowerCase().endsWith(".geojson")&&R.file(q).async("text").then(X=>{let ie=JSON.parse(X),ae=m.zippedBaseUrl||"",be=ae+(ae.endsWith("/")?"":"/")+q;k.push(n.update(be,g,ie,p0.System,f))})})}),Sh(k)}return n.update(g,g,A,p0.System,f)}))}else return ai(!1)})))})}else m.action==="delete"&&m.urls.forEach(f=>{l.push(n.delete(f))})})}return Sh(...l)})).subscribe(()=>{o&&setTimeout(()=>{this.messageService.remove(o.toastId),this.messageService.success("igo.geo.indexedDb.data-download-completed",void 0,{timeOut:4e4})},2500)})}isZip(e){return typeof e=="string"&&/(zip)$/.test(e.toLowerCase())}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Gn))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var xm=class{db$;constructor(){this.db$=U1()}update(i){return this.db$.pipe(Xn(e=>this.getByID(i.layerId).pipe(Ps(),qs(n=>n?this.customUpdate(i):Gc(e.add("layerData",i)).pipe(Nt(()=>i))))))}customUpdate(i){return this.delete(i.layerId).pipe(kf(()=>this.add(i)))}add(i){return this.db$.pipe(Xn(e=>Gc(e?.add("layerData",i)).pipe(Nt(()=>i))))}getByID(i){return this.db$.pipe(Xn(e=>Gc(e?.get("layerData",i))))}delete(i){return this.db$.pipe(Xn(e=>Gc(e?.delete("layerData",i))),Nt(()=>({key:i})))}deleteByKey(i){return this.delete(i)}getAll(){return this.db$.pipe(Xn(i=>Gc(i?.getAll("layerData"))))}};var jf=(()=>{class r{messageService;injector;stateChangeEventEmitter=new Ke;onlineSubscription;offlineSubscription;previousMessageId;state={connection:window.navigator.onLine};constructor(e,n){this.messageService=e,this.injector=n,this.checkNetworkState()}checkNetworkState(){this.onlineSubscription=jo(window,"online").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);let e=this.messageService.info("igo.core.network.online.message","igo.core.network.online.title");this.previousMessageId=e.toastId,this.state.connection=!0,this.emitEvent()}),this.offlineSubscription=jo(window,"offline").subscribe(()=>{this.previousMessageId&&this.messageService.remove(this.previousMessageId);let e=this.messageService.info("igo.core.network.offline.message","igo.core.network.offline.title");this.previousMessageId=e.toastId,this.state.connection=!1,this.emitEvent()})}emitEvent(){this.stateChangeEventEmitter.emit(this.state)}ngOnDestroy(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe()}catch{}}currentState(e=!0){return e?this.stateChangeEventEmitter.pipe(Br(300),ec(this.state)):this.stateChangeEventEmitter.pipe(Br(300))}static \u0275fac=function(n){return new(n||r)(pt(Gn),pt(jd))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var qA=(()=>{class r{http;networkService;networkOnline=!0;constructor(e,n){this.http=e,this.networkService=n,this.networkService.currentState().subscribe(o=>{this.networkOnline=o.connection})}get(e,n){return window.navigator.onLine&&this.networkOnline?this.getOnline(e,n):this.getOffline(e)}getOnline(e,n){let o;switch(n.responseType){case"arraybuffer":o=this.http.get(e,{responseType:"arraybuffer",withCredentials:n.withCredentials});break;case"text":o=this.http.get(e,{responseType:"text",withCredentials:n.withCredentials});break;case"json":o=this.http.get(e,{responseType:"json",withCredentials:n.withCredentials});break;default:o=this.http.get(e,{responseType:"blob",withCredentials:n.withCredentials});break}return o}getOffline(e){return new zd()?.get(e)}isOnline(){return this.networkOnline&&window.navigator.onLine}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(jf))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function NPe(r){return w7(r?.enable?[{provide:$F,useFactory:qie,multi:!0,deps:[zd,xm]},zd,xm,qA,y9]:[])}function qie(){return()=>U1()}var Yie=new Ln("routeServiceOptions");var v9=(()=>{class r{router;route;options;constructor(e,n,o){this.router=e,this.route=n;let s={centerKey:"center",zoomKey:"zoom",projectionKey:"projection",contextKey:"context",searchKey:"search",visibleOnLayersKey:"visiblelayers",visibleOffLayersKey:"invisiblelayers",directionsCoordKey:"routing",directionsOptionsKey:"routingOptions",toolKey:"tool",wmsUrlKey:"wmsUrl",wmsLayersKey:"wmsLayers",wmtsUrlKey:"wmtsUrl",wmtsLayersKey:"wmtsLayers",arcgisUrlKey:"arcgisUrl",arcgisLayersKey:"arcgisLayers",iarcgisUrlKey:"iarcgisUrl",iarcgisLayersKey:"iarcgisLayers",tarcgisUrlKey:"tarcgisUrl",tarcgisLayersKey:"tarcgisLayers",vectorKey:"vector"};this.options=Object.assign({},s,o)}get queryParams(){let e=decodeURIComponent(location.search);if(e.includes("\xA2er=")){e=e.replace("\xA2er","&center");let n=e.slice(1).split("&").map(o=>o.split("=")).reduce((o,s)=>{let[l,h]=s.map(decodeURIComponent);return o[l]=h,o},{});this.router.navigate([],{queryParams:n})}return this.route.queryParams}static \u0275fac=function(n){return new(n||r)(pt(fG),pt(mG),pt(Yie,8))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var m0=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",b9=m0.includes("firefox"),Xie=m0.includes("safari")&&!m0.includes("chrom"),qPe=Xie&&(m0.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(m0)),w9=m0.includes("webkit")&&!m0.includes("edge"),Tx=m0.includes("macintosh"),YA=typeof devicePixelRatio<"u"?devicePixelRatio:1,ZA=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,XA=typeof Image<"u"&&Image.prototype.decode,x9=typeof createImageBitmap=="function",KA=function(){let r=!1;try{let i=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,i),window.removeEventListener("_",null,i)}catch{}return r}();var Cu={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var uP=class{constructor(i){this.code_=i.code,this.units_=i.units,this.extent_=i.extent!==void 0?i.extent:null,this.worldExtent_=i.worldExtent!==void 0?i.worldExtent:null,this.axisOrientation_=i.axisOrientation!==void 0?i.axisOrientation:"enu",this.global_=i.global!==void 0?i.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=i.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=i.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||Cu[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(i){this.global_=i,this.canWrapX_=!!(i&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(i){this.defaultTileGrid_=i}setExtent(i){this.extent_=i,this.canWrapX_=!!(this.global_&&i)}setWorldExtent(i){this.worldExtent_=i}setGetPointResolution(i){this.getPointResolutionFunc_=i}getPointResolutionFunc(){return this.getPointResolutionFunc_}},lc=uP;var Fx=6378137,z1=Math.PI*Fx,Kie=[-z1,-z1,z1,z1],Qie=[-180,-85,180,85],QA=Fx*Math.log(Math.tan(Math.PI/2)),f0=class extends lc{constructor(i){super({code:i,units:"m",extent:Kie,global:!0,worldExtent:Qie,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Fx)}})}},dP=[new f0("EPSG:3857"),new f0("EPSG:102100"),new f0("EPSG:102113"),new f0("EPSG:900913"),new f0("http://www.opengis.net/def/crs/EPSG/0/3857"),new f0("http://www.opengis.net/gml/srs/epsg.xml#3857")];function S9(r,i,e){let n=r.length;e=e>1?e:2,i===void 0&&(e>2?i=r.slice():i=new Array(n));for(let o=0;o<n;o+=e){i[o]=z1*r[o]/180;let s=Fx*Math.log(Math.tan(Math.PI*(+r[o+1]+90)/360));s>QA?s=QA:s<-QA&&(s=-QA),i[o+1]=s}return i}function C9(r,i,e){let n=r.length;e=e>1?e:2,i===void 0&&(e>2?i=r.slice():i=new Array(n));for(let o=0;o<n;o+=e)i[o]=180*r[o]/z1,i[o+1]=360*Math.atan(Math.exp(r[o+1]/Fx))/Math.PI-90;return i}var Jie=6378137,A9=[-180,-90,180,90],ere=Math.PI*Jie/180,Vf=class extends lc{constructor(i,e){super({code:i,units:"degrees",extent:A9,axisOrientation:e,global:!0,metersPerUnit:ere,worldExtent:A9})}},hP=[new Vf("CRS:84"),new Vf("EPSG:4326","neu"),new Vf("urn:ogc:def:crs:OGC:1.3:CRS84"),new Vf("urn:ogc:def:crs:OGC:2:84"),new Vf("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Vf("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Vf("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var pP={};function M9(r){return pP[r]||pP[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function I9(r,i){pP[r]=i}function Dh(r){for(let i in r)delete r[i]}function Bl(r){let i;for(i in r)return!1;return!i}var $1={};function ty(r,i,e){let n=r.getCode(),o=i.getCode();n in $1||($1[n]={}),$1[n][o]=e}function JA(r,i){let e;return r in $1&&i in $1[r]&&(e=$1[r][i]),e}var ml={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Ds(r){let i=Wn();for(let e=0,n=r.length;e<n;++e)iy(i,r[e]);return i}function tre(r,i,e){let n=Math.min.apply(null,r),o=Math.min.apply(null,i),s=Math.max.apply(null,r),l=Math.max.apply(null,i);return jl(n,o,s,l,e)}function Gl(r,i,e){return e?(e[0]=r[0]-i,e[1]=r[1]-i,e[2]=r[2]+i,e[3]=r[3]+i,e):[r[0]-i,r[1]-i,r[2]+i,r[3]+i]}function tM(r,i){return i?(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i):r.slice()}function rd(r,i,e){let n,o;return i<r[0]?n=r[0]-i:r[2]<i?n=i-r[2]:n=0,e<r[1]?o=r[1]-e:r[3]<e?o=e-r[3]:o=0,n*n+o*o}function $d(r,i){return Px(r,i[0],i[1])}function Pa(r,i){return r[0]<=i[0]&&i[2]<=r[2]&&r[1]<=i[1]&&i[3]<=r[3]}function Px(r,i,e){return r[0]<=i&&i<=r[2]&&r[1]<=e&&e<=r[3]}function eM(r,i){let e=r[0],n=r[1],o=r[2],s=r[3],l=i[0],h=i[1],p=ml.UNKNOWN;return l<e?p=p|ml.LEFT:l>o&&(p=p|ml.RIGHT),h<n?p=p|ml.BELOW:h>s&&(p=p|ml.ABOVE),p===ml.UNKNOWN&&(p=ml.INTERSECTING),p}function Wn(){return[1/0,1/0,-1/0,-1/0]}function jl(r,i,e,n,o){return o?(o[0]=r,o[1]=i,o[2]=e,o[3]=n,o):[r,i,e,n]}function Uf(r){return jl(1/0,1/0,-1/0,-1/0,r)}function Sm(r,i){let e=r[0],n=r[1];return jl(e,n,e,n,i)}function W1(r,i,e,n,o){let s=Uf(o);return mP(s,r,i,e,n)}function Wd(r,i){return r[0]==i[0]&&r[2]==i[2]&&r[1]==i[1]&&r[3]==i[3]}function Hd(r,i){return i[0]<r[0]&&(r[0]=i[0]),i[2]>r[2]&&(r[2]=i[2]),i[1]<r[1]&&(r[1]=i[1]),i[3]>r[3]&&(r[3]=i[3]),r}function iy(r,i){i[0]<r[0]&&(r[0]=i[0]),i[0]>r[2]&&(r[2]=i[0]),i[1]<r[1]&&(r[1]=i[1]),i[1]>r[3]&&(r[3]=i[1])}function mP(r,i,e,n,o){for(;e<n;e+=o)ire(r,i[e],i[e+1]);return r}function ire(r,i,e){r[0]=Math.min(r[0],i),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],i),r[3]=Math.max(r[3],e)}function H1(r,i){let e;return e=i(ry(r)),e||(e=i(ny(r)),e)||(e=i(oy(r)),e)||(e=i(Mc(r)),e)?e:!1}function g0(r){let i=0;return nd(r)||(i=mr(r)*Hn(r)),i}function ry(r){return[r[0],r[1]]}function ny(r){return[r[2],r[1]]}function as(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function E9(r,i){let e;if(i==="bottom-left")e=ry(r);else if(i==="bottom-right")e=ny(r);else if(i==="top-left")e=Mc(r);else if(i==="top-right")e=oy(r);else throw new Error("Invalid corner");return e}function _p(r,i,e,n,o){let[s,l,h,p,m,f,g,y]=iM(r,i,e,n);return jl(Math.min(s,h,m,g),Math.min(l,p,f,y),Math.max(s,h,m,g),Math.max(l,p,f,y),o)}function iM(r,i,e,n){let o=i*n[0]/2,s=i*n[1]/2,l=Math.cos(e),h=Math.sin(e),p=o*l,m=o*h,f=s*l,g=s*h,y=r[0],_=r[1];return[y-p+g,_-m-f,y-p-g,_-m+f,y+p-g,_+m+f,y+p+g,_+m-f,y-p+g,_-m-f]}function Hn(r){return r[3]-r[1]}function Xc(r,i,e){let n=e||Wn();return On(r,i)?(r[0]>i[0]?n[0]=r[0]:n[0]=i[0],r[1]>i[1]?n[1]=r[1]:n[1]=i[1],r[2]<i[2]?n[2]=r[2]:n[2]=i[2],r[3]<i[3]?n[3]=r[3]:n[3]=i[3]):Uf(n),n}function T9(r){return[r[2]-r[0],r[3]-r[1]]}function Mc(r){return[r[0],r[3]]}function oy(r){return[r[2],r[3]]}function mr(r){return r[2]-r[0]}function On(r,i){return r[0]<=i[2]&&r[2]>=i[0]&&r[1]<=i[3]&&r[3]>=i[1]}function nd(r){return r[2]<r[0]||r[3]<r[1]}function F9(r,i){return i?(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i):r}function P9(r,i,e){let n=!1,o=eM(r,i),s=eM(r,e);if(o===ml.INTERSECTING||s===ml.INTERSECTING)n=!0;else{let l=r[0],h=r[1],p=r[2],m=r[3],f=i[0],g=i[1],y=e[0],_=e[1],w=(_-g)/(y-f),A,k;s&ml.ABOVE&&!(o&ml.ABOVE)&&(A=y-(_-m)/w,n=A>=l&&A<=p),!n&&s&ml.RIGHT&&!(o&ml.RIGHT)&&(k=_-(y-p)*w,n=k>=h&&k<=m),!n&&s&ml.BELOW&&!(o&ml.BELOW)&&(A=y-(_-h)/w,n=A>=l&&A<=p),!n&&s&ml.LEFT&&!(o&ml.LEFT)&&(k=_-(y-l)*w,n=k>=h&&k<=m)}return n}function L9(r,i,e,n){if(nd(r))return Uf(e);let o=[];if(n>1){let h=r[2]-r[0],p=r[3]-r[1];for(let m=0;m<n;++m)o.push(r[0]+h*m/n,r[1],r[2],r[1]+p*m/n,r[2]-h*m/n,r[3],r[0],r[3]-p*m/n)}else o=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]];i(o,o,2);let s=[],l=[];for(let h=0,p=o.length;h<p;h+=2)s.push(o[h]),l.push(o[h+1]);return tre(s,l,e)}function fP(r,i){let e=i.getExtent(),n=as(r);if(i.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){let o=mr(e),l=Math.floor((n[0]-e[0])/o)*o;r[0]-=l,r[2]-=l}return r}function k9(r,i){if(i.canWrapX()){let e=i.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];fP(r,i);let n=mr(e);if(mr(r)>n)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+n,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-n,r[3]]]}return[r]}function to(r,i,e){return Math.min(Math.max(r,i),e)}function O9(r,i,e,n,o,s){let l=o-e,h=s-n;if(l!==0||h!==0){let p=((r-e)*l+(i-n)*h)/(l*l+h*h);p>1?(e=o,n=s):p>0&&(e+=l*p,n+=h*p)}return od(r,i,e,n)}function od(r,i,e,n){let o=e-r,s=n-i;return o*o+s*s}function D9(r){let i=r.length;for(let n=0;n<i;n++){let o=n,s=Math.abs(r[n][n]);for(let h=n+1;h<i;h++){let p=Math.abs(r[h][n]);p>s&&(s=p,o=h)}if(s===0)return null;let l=r[o];r[o]=r[n],r[n]=l;for(let h=n+1;h<i;h++){let p=-r[h][n]/r[n][n];for(let m=n;m<i+1;m++)n==m?r[h][m]=0:r[h][m]+=p*r[n][m]}}let e=new Array(i);for(let n=i-1;n>=0;n--){e[n]=r[n][i]/r[n][n];for(let o=n-1;o>=0;o--)r[o][i]-=r[o][n]*e[n]}return e}function gP(r){return r*180/Math.PI}function Au(r){return r*Math.PI/180}function ad(r,i){let e=r%i;return e*i<0?e+i:e}function Ic(r,i,e){return r+e*(i-r)}function ay(r,i){let e=Math.pow(10,i);return Math.round(r*e)/e}function q1(r,i){return Math.round(ay(r,i))}function _0(r,i){return Math.floor(ay(r,i))}function Cm(r,i){return Math.ceil(ay(r,i))}function Y1(r,i,e){let n=e!==void 0?r.toFixed(e):""+r,o=n.indexOf(".");return o=o===-1?n.length:o,o>i?n:new Array(1+i-o).join("0")+n}function _P(r,i){let e=(""+r).split("."),n=(""+i).split(".");for(let o=0;o<Math.max(e.length,n.length);o++){let s=parseInt(e[o]||"0",10),l=parseInt(n[o]||"0",10);if(s>l)return 1;if(l>s)return-1}return 0}function rM(r,i){return r[0]+=+i[0],r[1]+=+i[1],r}function yP(r,i){let e=r[0],n=r[1],o=i[0],s=i[1],l=o[0],h=o[1],p=s[0],m=s[1],f=p-l,g=m-h,y=f===0&&g===0?0:(f*(e-l)+g*(n-h))/(f*f+g*g||0),_,w;return y<=0?(_=l,w=h):y>=1?(_=p,w=m):(_=l+y*f,w=h+y*g),[_,w]}function Mu(r,i){let e=!0;for(let n=r.length-1;n>=0;--n)if(r[n]!=i[n]){e=!1;break}return e}function Z1(r,i){let e=Math.cos(i),n=Math.sin(i),o=r[0]*e-r[1]*n,s=r[1]*e+r[0]*n;return r[0]=o,r[1]=s,r}function nM(r,i){return r[0]*=i,r[1]*=i,r}function y0(r,i){let e=r[0]-i[0],n=r[1]-i[1];return e*e+n*n}function v0(r,i){return Math.sqrt(y0(r,i))}function R9(r,i){return y0(r,yP(r,i))}function X1(r,i){if(i.canWrapX()){let e=mr(i.getExtent()),n=vP(r,i,e);n&&(r[0]-=n*e)}return r}function vP(r,i,e){let n=i.getExtent(),o=0;return i.canWrapX()&&(r[0]<n[0]||r[0]>n[2])&&(e=e||mr(n),o=Math.floor((r[0]-n[0])/e)),o}var aM=63710088e-1;function b0(r,i,e){e=e||aM;let n=Au(r[1]),o=Au(i[1]),s=(o-n)/2,l=Au(i[0]-r[0])/2,h=Math.sin(s)*Math.sin(s)+Math.sin(l)*Math.sin(l)*Math.cos(n)*Math.cos(o);return 2*e*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}function bP(r,i){let e=0;for(let n=0,o=r.length;n<o-1;++n)e+=b0(r[n],r[n+1],i);return e}function sy(r,i){i=i||{};let e=i.radius||aM,n=i.projection||"EPSG:3857",o=r.getType();o!=="GeometryCollection"&&(r=r.clone().transform(n,"EPSG:4326"));let s=0,l,h,p,m,f,g;switch(o){case"Point":case"MultiPoint":break;case"LineString":case"LinearRing":{l=r.getCoordinates(),s=bP(l,e);break}case"MultiLineString":case"Polygon":{for(l=r.getCoordinates(),p=0,m=l.length;p<m;++p)s+=bP(l[p],e);break}case"MultiPolygon":{for(l=r.getCoordinates(),p=0,m=l.length;p<m;++p)for(h=l[p],f=0,g=h.length;f<g;++f)s+=bP(h[f],e);break}case"GeometryCollection":{let y=r.getGeometries();for(p=0,m=y.length;p<m;++p)s+=sy(y[p],i);break}default:throw new Error("Unsupported geometry type: "+o)}return s}function oM(r,i){let e=0,n=r.length,o=r[n-1][0],s=r[n-1][1];for(let l=0;l<n;l++){let h=r[l][0],p=r[l][1];e+=Au(h-o)*(2+Math.sin(Au(s))+Math.sin(Au(p))),o=h,s=p}return e*i*i/2}function wP(r,i){i=i||{};let e=i.radius||aM,n=i.projection||"EPSG:3857",o=r.getType();o!=="GeometryCollection"&&(r=r.clone().transform(n,"EPSG:4326"));let s=0,l,h,p,m,f,g;switch(o){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"LinearRing":break;case"Polygon":{for(l=r.getCoordinates(),s=Math.abs(oM(l[0],e)),p=1,m=l.length;p<m;++p)s-=Math.abs(oM(l[p],e));break}case"MultiPolygon":{for(l=r.getCoordinates(),p=0,m=l.length;p<m;++p)for(h=l[p],s+=Math.abs(oM(h[0],e)),f=1,g=h.length;f<g;++f)s-=Math.abs(oM(h[f],e));break}case"GeometryCollection":{let y=r.getGeometries();for(p=0,m=y.length;p<m;++p)s+=wP(y[p],i);break}default:throw new Error("Unsupported geometry type: "+o)}return s}function N9(r,i,e,n){n=n||aM;let o=Au(r[1]),s=Au(r[0]),l=i/n,h=Math.asin(Math.sin(o)*Math.cos(l)+Math.cos(o)*Math.sin(l)*Math.cos(e)),p=s+Math.atan2(Math.sin(e)*Math.sin(l)*Math.cos(o),Math.cos(l)-Math.sin(o)*Math.sin(h));return[gP(p),gP(h)]}var B9={info:1,warn:2,error:3,none:4},nre=B9.info;function sM(...r){nre>B9.warn||console.warn(...r)}var xP=!0;function SP(r){xP=!(r===void 0?!0:r)}function CP(r,i){if(i!==void 0){for(let e=0,n=r.length;e<n;++e)i[e]=r[e];i=i}else i=r.slice();return i}function cM(r,i){if(i!==void 0&&r!==i){for(let e=0,n=r.length;e<n;++e)i[e]=r[e];r=i}return r}function AP(r){I9(r.getCode(),r),ty(r,r,CP)}function ore(r){r.forEach(AP)}function ni(r){return typeof r=="string"?M9(r):r||null}function ly(r,i,e,n){r=ni(r);let o,s=r.getPointResolutionFunc();if(s){if(o=s(i,e),n&&n!==r.getUnits()){let l=r.getMetersPerUnit();l&&(o=o*l/Cu[n])}}else{let l=r.getUnits();if(l=="degrees"&&!n||n=="degrees")o=i;else{let h=vp(r,ni("EPSG:4326"));if(h===cM&&l!=="degrees")o=i*r.getMetersPerUnit();else{let m=[e[0]-i/2,e[1],e[0]+i/2,e[1],e[0],e[1]-i/2,e[0],e[1]+i/2];m=h(m,m,2);let f=b0(m.slice(0,2),m.slice(2,4)),g=b0(m.slice(4,6),m.slice(6,8));o=(f+g)/2}let p=n?Cu[n]:r.getMetersPerUnit();p!==void 0&&(o/=p)}}return o}function lM(r){ore(r),r.forEach(function(i){r.forEach(function(e){i!==e&&ty(i,e,CP)})})}function are(r,i,e,n){r.forEach(function(o){i.forEach(function(s){ty(o,s,e),ty(s,o,n)})})}function uM(r,i){return r?typeof r=="string"?ni(r):r:ni(i)}function G9(r){return function(i,e,n){let o=i.length;n=n!==void 0?n:2,e=e!==void 0?e:new Array(o);for(let s=0;s<o;s+=n){let l=r(i.slice(s,s+n)),h=l.length;for(let p=0,m=n;p<m;++p)e[s+p]=p>=h?i[s+p]:l[p]}return e}}function j9(r,i,e,n){let o=ni(r),s=ni(i);ty(o,s,G9(e)),ty(s,o,G9(n))}function kx(r,i){return SP(),Sr(r,"EPSG:4326",i!==void 0?i:"EPSG:3857")}function cc(r,i){if(r===i)return!0;let e=r.getUnits()===i.getUnits();return(r.getCode()===i.getCode()||vp(r,i)===CP)&&e}function vp(r,i){let e=r.getCode(),n=i.getCode(),o=JA(e,n);return o||(o=cM),o}function zf(r,i){let e=ni(r),n=ni(i);return vp(e,n)}function Sr(r,i,e){return zf(i,e)(r,void 0,r.length)}function Zs(r,i,e,n){let o=zf(i,e);return L9(r,o,void 0,n)}var yp=null;function fl(){return yp}function $f(r,i){return yp?Sr(r,i,yp):r}function zo(r,i){return yp?Sr(r,yp,i):(xP&&!Mu(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(xP=!1,sM("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r)}function Am(r,i){return yp?Zs(r,i,yp):r}function Kc(r,i){return yp?Zs(r,yp,i):r}function V9(r,i){if(!yp)return r;let e=ni(i).getMetersPerUnit(),n=yp.getMetersPerUnit();return e&&n?r*e/n:r}function MP(r,i,e){return function(n){let o,s;if(r.canWrapX()){let l=r.getExtent(),h=mr(l);n=n.slice(0),s=vP(n,r,h),s&&(n[0]=n[0]-s*h),n[0]=to(n[0],l[0],l[2]),n[1]=to(n[1],l[1],l[3]),o=e(n)}else o=e(n);return s&&i.canWrapX()&&(o[0]+=s*mr(i.getExtent())),o}}function sre(){lM(dP),lM(hP),are(hP,dP,S9,C9)}sre();function dM(r,i,e={}){let n,o,s,l,h,p,m,f,g,y,_,w,A,k,R,q,X,ie,ae,be="(\\s*;\\s*[\\d]{4,6})",me="4326",fe,ge=new RegExp(be,"g"),ue="([-+])?([\\d]{1,3})([,.](\\d+))?\xB0?",se=`${ue}[\\s,]+${ue}`,te=new RegExp(`^${se}$`,"g"),Se=`([0-9]{1,2})[:|\xB0]?\\s*([0-9]{1,2})?[:|'|\u2032|\u2019]?\\s*([0-9]{1,2}(?:.[0-9]+){0,1})?\\s*["|\u2033|\u201D]?\\s*`,Te=`${Se}([N|S|E|W|O]),?\\s*${Se}([N|S|E|W|O])`,Ee=new RegExp(`^${Te}$`,"gi"),je="(UTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Ne=new RegExp(`^${je}`,"gi"),ze="(MTM)-?(\\d{1,2})[\\s,]*(\\d+[.,]?\\d+)[\\s,]+(\\d+[.,]?\\d+)",Re=new RegExp(`^${ze}`,"gi"),Ge="([-+])?(\\d{1,3})[,.](\\d+)",He=`${Ge}\\s*[,]?\\s*${Ge}`,ye=new RegExp(`^${He}`,"g"),Ae="([-+])?(\\d{1,3})[\\s,.]{1}(\\d{1,2})[\\s,.]{1}(\\d{1,2})[.,]?(\\d{1,5})?",Le=`${Ae}\\s*[,.]?\\s*${Ae}`,Ye=new RegExp(`^${Le}`,"g"),qe="LAT\\s*[\\s:]*\\s*([-+])?(\\d{1,2})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*LONG\\s*[\\s:]*\\s*([-+])?(\\d{1,3})[\\s.,]?(\\d+)?[\\s.,]?\\s*(\\d{1,2}([.,]\\d+)?)?\\s*(N|S|E|W)?\\s*UNC\\s*[\\s:]?\\s*(\\d+)\\s*CONF\\s*[\\s:]?\\s*(\\d{1,3})",et=new RegExp(`^${qe}?`,"gi"),ft="([-+]?\\d+)[,.]?(\\d+)?",mt=`${ft}[\\s,]+${ft}`,At=new RegExp(`^${mt}$`,"g"),ht=!1;if(r=r.toLocaleUpperCase().trim(),ge.test(r)?[o,fe]=r.split(";").map(he=>he.trim()):o=r,te.test(o))[,s,ie,,f,g,ae,,k]=o.match(se),ie=parseFloat((s||"")+ie+"."+f),ae=parseFloat((g||"")+ae+"."+k);else if(Ee.test(o))[,l,h,p,m,y,_,w,A]=o.match(Te),(m==="S"||m==="N")&&(l=[y,y=l][0],h=[_,_=h][0],p=[w,w=p][0],m=[A,A=m][0]),ie=w0(parseFloat(l),parseFloat(h),parseFloat(p),m),ae=w0(parseFloat(y),parseFloat(_),parseFloat(w),A);else if(Ne.test(o)){ht=!0,[,,R,ie,ae]=o.match(je);let he=Number(R)<10?`EPSG:3260${R}`:`EPSG:326${R}`;[ie,ae]=Sr([parseFloat(ie),parseFloat(ae)],he,"EPSG:4326")}else if(Re.test(o)){ht=!0,[,,R,ie,ae]=o.match(ze);let he=Number(R)<10?`EPSG:3218${R}`:`EPSG:321${80+Number(R)}`;[ie,ae]=Sr([parseFloat(ie),parseFloat(ae)],he,"EPSG:4326")}else if(Ye.test(o))[,s,l,h,p,f,g,y,_,w,k]=o.match(Le),ie=w0(parseFloat((s||"")+l),parseFloat(h),parseFloat(p),m),ae=w0(parseFloat((g||"")+y),parseFloat(_),parseFloat(w),A);else if(ye.test(o))[,s,l,f,g,y,k]=o.match(He),ie=w0(parseFloat((s||"")+l),parseFloat(h),parseFloat(p),m),ae=w0(parseFloat((g||"")+y),parseFloat(_),parseFloat(w),A);else if(et.test(o))[,g,y,_,w,,A,s,l,h,p,,m,q,X]=o.match(qe),m||(m="W"),h&&h.length>2?ie=parseFloat((s||"")+l+"."+h):ie=w0(parseFloat(l),parseFloat(h),parseFloat(p),m),_&&_.length>2?ae=parseFloat((g||"")+y+"."+_):ae=w0(parseFloat(y),parseFloat(_),parseFloat(w),A);else if(At.test(o))ht=!0,[,ie,f,ae,k]=o.match(mt),f&&(ie=parseFloat(ie+"."+f)),k&&(ae=parseFloat(ae+"."+k));else return{lonLat:void 0,message:"",radius:void 0,conf:void 0};if(e.forceNA&&!ht&&(ie>0&&ae>0&&(ie>ae?ie=-ie:ae=-ae),ie>ae&&(ie=[ae,ae=ie][0])),n=[Number(ie),Number(ae)],fe!==void 0&&fe!==me||n[0]>180||n[0]<-180||n[1]>90||n[1]<-90){let he=fe?"EPSG:"+fe:i,st="EPSG:"+me;try{n=Sr(n,he,st)}catch{return{lonLat:void 0,message:"Projection "+he+" not supported",radius:void 0,conf:void 0}}}return Math.abs(n[0])<=180&&Math.abs(n[1])<=90?{lonLat:n,message:"",radius:q?parseInt(q,10):void 0,conf:X?parseInt(X,10):void 0}:{lonLat:void 0,message:"Coordinate out of Longitude/Latitude bounds",radius:void 0,conf:void 0}}function w0(r,i,e,n){i=i||0,e=e||0;let o=r<0,s=Math.abs(r)+i/60+e/3600;return(o||n==="S"||n==="W")&&(s=-s),s}function hM(r,i=3){let e=[];return r.forEach(n=>{let o=n<0?Math.ceil(n):Math.floor(n),s=n<0?(o-n)*60:(n-o)*60,l=Math.floor(s),h=((s-l)*60).toFixed(i);e.push(`${o}\xB0 ${l}' ${h}"`)}),e}function U9(r,i){if(r===void 0||i===void 0)return!1;let e=1/1e4;return r.zoom===i.zoom&&Math.trunc(r.center[0]/e)===Math.trunc(i.center[0]/e)&&Math.trunc(r.center[1]/e)===Math.trunc(i.center[1]/e)}function IP(r){return r=Math.round(r),r<1e4?r+"":(r=Math.round(r/1e3),r<1e3?r+"K":(r=Math.round(r/1e3),r+"M"))}function Oa(r,i=96){return r/(39.3701*i)}function z9(r,i="m",e=96){return r*Cu[i]*39.3701*e}function K1(r){let i=r.originalEvent;return!i.altKey&&(Tx?i.metaKey:i.ctrlKey)&&!i.shiftKey}function uc(r,i=3){return[Ax.roundToNDecimal(r[0],i),Ax.roundToNDecimal(r[1],i)]}function Rh(r,i=3){return uc(r,i).map(e=>e.toString()+"\xB0")}function $9(r,i){let e=Sr(r,"EPSG:4326","EPSG:3857"),n=[{code:"EPSG:3857",alias:"Web Mercator",coord:e,igo2CoordFormat:`${uc(e).join(", ")} ; 3857`}],o=lre(r),s=o<10?`EPSG:3260${o}`:`EPSG:326${o}`,l=`UTM-${o}`,h=Sr(r,"EPSG:4326",s);n.push({code:s,alias:"UTM",coord:h,igo2CoordFormat:`${l} ${uc(h).join(", ")}`});let p=cre(r);if(p){let m=p<10?`EPSG:3218${p}`:`EPSG:321${80+p}`,f=`MTM-${p}`,g=Sr(r,"EPSG:4326",m);n.push({code:m,alias:"MTM",coord:g,igo2CoordFormat:`${f} ${uc(g).join(", ")}`})}return i.forEach(m=>{let f=Sr(r,"EPSG:4326",m.code),g=m.code.split(":")[1];n.push({code:m.code,alias:m.alias||m.code,coord:f,igo2CoordFormat:`${uc(f).join(", ")} ; ${g}`})}),n}function lre(r){return Math.ceil((r[0]+180)/6)}function cre(r){let i=r[0],e;return i<-51&&i>-54&&(e=1),i<-54&&i>-57&&(e=2),i<-57&&i>-60&&(e=3),i<-60&&i>-63&&(e=4),i<-63&&i>-66&&(e=5),i<-66&&i>-69&&(e=6),i<-69&&i>-72&&(e=7),i<-72&&i>-75&&(e=8),i<-75&&i>-78&&(e=9),i<-78&&i>-81&&(e=10),e}var Wf=(()=>{class r{counter$=new ut(0);ids=[];register(){let e=rn();return this.ids.push(e),this.counter$.next(this.ids.length),e}unregister(e){let n=this.ids.indexOf(e);n!==-1&&(this.ids.splice(n,1),this.counter$.next(this.ids.length))}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var W9=(()=>{class r{activityService;constructor(e){this.activityService=e}intercept(e,n){let o=e.headers.get("activityInterceptor");if(o){let l=e.clone({headers:e.headers.delete("activityInterceptor")});if(o==="false")return n.handle(l)}let s=this.activityService.register();return n.handle(e).pipe(v7(()=>{this.activityService.unregister(s)}))}static \u0275fac=function(n){return new(n||r)(pt(Wf))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var RLe=(()=>{class r{static forRoot(){return{ngModule:r,providers:[{provide:k7,useClass:W9,multi:!0}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({})}return r})();var Kq=Jl(PG());function Eo(r){"@babel/helpers - typeof";return Eo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},Eo(r)}var bp=Uint8Array,qd=Uint16Array,LP=Int32Array,kP=new bp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),OP=new bp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),H9=new bp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),X9=function(r,i){for(var e=new qd(31),n=0;n<31;++n)e[n]=i+=1<<r[n-1];for(var o=new LP(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)o[s]=s-e[n]<<5|n;return{b:e,r:o}},K9=X9(kP,2),dre=K9.b,TP=K9.r;dre[28]=258,TP[258]=28;var Q9=X9(OP,0),ULe=Q9.b,q9=Q9.r,FP=new qd(32768);for(go=0;go<32768;++go)Hf=(go&43690)>>1|(go&21845)<<1,Hf=(Hf&52428)>>2|(Hf&13107)<<2,Hf=(Hf&61680)>>4|(Hf&3855)<<4,FP[go]=((Hf&65280)>>8|(Hf&255)<<8)>>1;var Hf,go,Rx=function(r,i,e){for(var n=r.length,o=0,s=new qd(i);o<n;++o)r[o]&&++s[r[o]-1];var l=new qd(i);for(o=1;o<i;++o)l[o]=l[o-1]+s[o-1]<<1;var h;if(e){h=new qd(1<<i);var p=15-i;for(o=0;o<n;++o)if(r[o])for(var m=o<<4|r[o],f=i-r[o],g=l[r[o]-1]++<<f,y=g|(1<<f)-1;g<=y;++g)h[FP[g]>>p]=m}else for(h=new qd(n),o=0;o<n;++o)r[o]&&(h[o]=FP[l[r[o]-1]++]>>15-r[o]);return h},cy=new bp(288);for(go=0;go<144;++go)cy[go]=8;var go;for(go=144;go<256;++go)cy[go]=9;var go;for(go=256;go<280;++go)cy[go]=7;var go;for(go=280;go<288;++go)cy[go]=8;var go,mM=new bp(32);for(go=0;go<32;++go)mM[go]=5;var go,hre=Rx(cy,9,0);var pre=Rx(mM,5,0);var J9=function(r){return(r+7)/8|0},mre=function(r,i,e){return(i==null||i<0)&&(i=0),(e==null||e>r.length)&&(e=r.length),new bp(r.subarray(i,e))};var qf=function(r,i,e){e<<=i&7;var n=i/8|0;r[n]|=e,r[n+1]|=e>>8},Ox=function(r,i,e){e<<=i&7;var n=i/8|0;r[n]|=e,r[n+1]|=e>>8,r[n+2]|=e>>16},EP=function(r,i){for(var e=[],n=0;n<r.length;++n)r[n]&&e.push({s:n,f:r[n]});var o=e.length,s=e.slice();if(!o)return{t:tj,l:0};if(o==1){var l=new bp(e[0].s+1);return l[e[0].s]=1,{t:l,l:1}}e.sort(function(ae,be){return ae.f-be.f}),e.push({s:-1,f:25001});var h=e[0],p=e[1],m=0,f=1,g=2;for(e[0]={s:-1,f:h.f+p.f,l:h,r:p};f!=o-1;)h=e[e[m].f<e[g].f?m++:g++],p=e[m!=f&&e[m].f<e[g].f?m++:g++],e[f++]={s:-1,f:h.f+p.f,l:h,r:p};for(var y=s[0].s,n=1;n<o;++n)s[n].s>y&&(y=s[n].s);var _=new qd(y+1),w=PP(e[f-1],_,0);if(w>i){var n=0,A=0,k=w-i,R=1<<k;for(s.sort(function(be,me){return _[me.s]-_[be.s]||be.f-me.f});n<o;++n){var q=s[n].s;if(_[q]>i)A+=R-(1<<w-_[q]),_[q]=i;else break}for(A>>=k;A>0;){var X=s[n].s;_[X]<i?A-=1<<i-_[X]++-1:++n}for(;n>=0&&A;--n){var ie=s[n].s;_[ie]==i&&(--_[ie],++A)}w=i}return{t:new bp(_),l:w}},PP=function(r,i,e){return r.s==-1?Math.max(PP(r.l,i,e+1),PP(r.r,i,e+1)):i[r.s]=e},Y9=function(r){for(var i=r.length;i&&!r[--i];);for(var e=new qd(++i),n=0,o=r[0],s=1,l=function(p){e[n++]=p},h=1;h<=i;++h)if(r[h]==o&&h!=i)++s;else{if(!o&&s>2){for(;s>138;s-=138)l(32754);s>2&&(l(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(l(o),--s;s>6;s-=6)l(8304);s>2&&(l(s-3<<5|8208),s=0)}for(;s--;)l(o);s=1,o=r[h]}return{c:e.subarray(0,n),n:i}},Dx=function(r,i){for(var e=0,n=0;n<i.length;++n)e+=r[n]*i[n];return e},ej=function(r,i,e){var n=e.length,o=J9(i+2);r[o]=n&255,r[o+1]=n>>8,r[o+2]=r[o]^255,r[o+3]=r[o+1]^255;for(var s=0;s<n;++s)r[o+s+4]=e[s];return(o+4+n)*8},Z9=function(r,i,e,n,o,s,l,h,p,m,f){qf(i,f++,e),++o[256];for(var g=EP(o,15),y=g.t,_=g.l,w=EP(s,15),A=w.t,k=w.l,R=Y9(y),q=R.c,X=R.n,ie=Y9(A),ae=ie.c,be=ie.n,me=new qd(19),fe=0;fe<q.length;++fe)++me[q[fe]&31];for(var fe=0;fe<ae.length;++fe)++me[ae[fe]&31];for(var ge=EP(me,7),ue=ge.t,se=ge.l,te=19;te>4&&!ue[H9[te-1]];--te);var Se=m+5<<3,Te=Dx(o,cy)+Dx(s,mM)+l,Ee=Dx(o,y)+Dx(s,A)+l+14+3*te+Dx(me,ue)+2*me[16]+3*me[17]+7*me[18];if(p>=0&&Se<=Te&&Se<=Ee)return ej(i,f,r.subarray(p,p+m));var je,Ne,ze,Re;if(qf(i,f,1+(Ee<Te)),f+=2,Ee<Te){je=Rx(y,_,0),Ne=y,ze=Rx(A,k,0),Re=A;var Ge=Rx(ue,se,0);qf(i,f,X-257),qf(i,f+5,be-1),qf(i,f+10,te-4),f+=14;for(var fe=0;fe<te;++fe)qf(i,f+3*fe,ue[H9[fe]]);f+=3*te;for(var He=[q,ae],ye=0;ye<2;++ye)for(var Ae=He[ye],fe=0;fe<Ae.length;++fe){var Le=Ae[fe]&31;qf(i,f,Ge[Le]),f+=ue[Le],Le>15&&(qf(i,f,Ae[fe]>>5&127),f+=Ae[fe]>>12)}}else je=hre,Ne=cy,ze=pre,Re=mM;for(var fe=0;fe<h;++fe){var Ye=n[fe];if(Ye>255){var Le=Ye>>18&31;Ox(i,f,je[Le+257]),f+=Ne[Le+257],Le>7&&(qf(i,f,Ye>>23&31),f+=kP[Le]);var qe=Ye&31;Ox(i,f,ze[qe]),f+=Re[qe],qe>3&&(Ox(i,f,Ye>>5&8191),f+=OP[qe])}else Ox(i,f,je[Ye]),f+=Ne[Ye]}return Ox(i,f,je[256]),f+Ne[256]},fre=new LP([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),tj=new bp(0),gre=function(r,i,e,n,o,s){var l=s.z||r.length,h=new bp(n+l+5*(1+Math.ceil(l/7e3))+o),p=h.subarray(n,h.length-o),m=s.l,f=(s.r||0)&7;if(i){f&&(p[0]=s.r>>3);for(var g=fre[i-1],y=g>>13,_=g&8191,w=(1<<e)-1,A=s.p||new qd(32768),k=s.h||new qd(w+1),R=Math.ceil(e/3),q=2*R,X=function(Je){return(r[Je]^r[Je+1]<<R^r[Je+2]<<q)&w},ie=new LP(25e3),ae=new qd(288),be=new qd(32),me=0,fe=0,ge=s.i||0,ue=0,se=s.w||0,te=0;ge+2<l;++ge){var Se=X(ge),Te=ge&32767,Ee=k[Se];if(A[Te]=Ee,k[Se]=Te,se<=ge){var je=l-ge;if((me>7e3||ue>24576)&&(je>423||!m)){f=Z9(r,p,0,ie,ae,be,fe,ue,te,ge-te,f),ue=me=fe=0,te=ge;for(var Ne=0;Ne<286;++Ne)ae[Ne]=0;for(var Ne=0;Ne<30;++Ne)be[Ne]=0}var ze=2,Re=0,Ge=_,He=Te-Ee&32767;if(je>2&&Se==X(ge-He))for(var ye=Math.min(y,je)-1,Ae=Math.min(32767,ge),Le=Math.min(258,je);He<=Ae&&--Ge&&Te!=Ee;){if(r[ge+ze]==r[ge+ze-He]){for(var Ye=0;Ye<Le&&r[ge+Ye]==r[ge+Ye-He];++Ye);if(Ye>ze){if(ze=Ye,Re=He,Ye>ye)break;for(var qe=Math.min(He,Ye-2),et=0,Ne=0;Ne<qe;++Ne){var ft=ge-He+Ne&32767,mt=A[ft],At=ft-mt&32767;At>et&&(et=At,Ee=ft)}}}Te=Ee,Ee=A[Te],He+=Te-Ee&32767}if(Re){ie[ue++]=268435456|TP[ze]<<18|q9[Re];var ht=TP[ze]&31,he=q9[Re]&31;fe+=kP[ht]+OP[he],++ae[257+ht],++be[he],se=ge+ze,++me}else ie[ue++]=r[ge],++ae[r[ge]]}}for(ge=Math.max(ge,se);ge<l;++ge)ie[ue++]=r[ge],++ae[r[ge]];f=Z9(r,p,m,ie,ae,be,fe,ue,te,ge-te,f),m||(s.r=f&7|p[f/8|0]<<3,f-=7,s.h=k,s.p=A,s.i=ge,s.w=se)}else{for(var ge=s.w||0;ge<l+m;ge+=65535){var st=ge+65535;st>=l&&(p[f/8|0]=m,st=l),f=ej(p,f+1,r.subarray(ge,st))}s.i=l}return mre(h,0,n+J9(f)+o)};var ij=function(){var r=1,i=0;return{p:function(e){for(var n=r,o=i,s=e.length|0,l=0;l!=s;){for(var h=Math.min(l+2655,s);l<h;++l)o+=n+=e[l];n=(n&65535)+15*(n>>16),o=(o&65535)+15*(o>>16)}r=n,i=o},d:function(){return r%=65521,i%=65521,(r&255)<<24|(r&65280)<<8|(i&255)<<8|i>>8}}},_re=function(r,i,e,n,o){if(!o&&(o={l:1},i.dictionary)){var s=i.dictionary.subarray(-32768),l=new bp(s.length+r.length);l.set(s),l.set(r,s.length),r=l,o.w=s.length}return gre(r,i.level==null?6:i.level,i.mem==null?o.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+i.mem,e,n,o)};var rj=function(r,i,e){for(;e;++i)r[i]=e,e>>>=8};var yre=function(r,i){var e=i.level,n=e==0?0:e<6?1:e==9?3:2;if(r[0]=120,r[1]=n<<6|(i.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,i.dictionary){var o=ij();o.p(i.dictionary),rj(r,2,o.d())}};function fM(r,i){i||(i={});var e=ij();e.p(r);var n=_re(r,i,i.dictionary?6:2,4);return yre(n,i),rj(n,n.length-4,e.d()),n}var vre=typeof TextDecoder<"u"&&new TextDecoder,bre=0;try{vre.decode(tj,{stream:!0}),bre=1}catch{}function nj(r){if(Array.isArray(r))return r}function oj(r,i){var e=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(e!=null){var n,o,s,l,h=[],p=!0,m=!1;try{if(s=(e=e.call(r)).next,i===0){if(Object(e)!==e)return;p=!1}else for(;!(p=(n=s.call(e)).done)&&(h.push(n.value),h.length!==i);p=!0);}catch(f){m=!0,o=f}finally{try{if(!p&&e.return!=null&&(l=e.return(),Object(l)!==l))return}finally{if(m)throw o}}return h}}function DP(r,i){(i==null||i>r.length)&&(i=r.length);for(var e=0,n=Array(i);e<i;e++)n[e]=r[e];return n}function aj(r,i){if(r){if(typeof r=="string")return DP(r,i);var e={}.toString.call(r).slice(8,-1);return e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set"?Array.from(r):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?DP(r,i):void 0}}function sj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RP(r,i){return nj(r)||oj(r,i)||aj(r,i)||sj()}function NP(r,i="utf8"){return new TextDecoder(i).decode(r)}var wre=new TextEncoder;function lj(r){return wre.encode(r)}var xre=1024*8,Sre=(()=>{let r=new Uint8Array(4),i=new Uint32Array(r.buffer);return!((i[0]=1)&r[0])})(),BP={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array},Nx=class r{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(i=xre,e={}){let n=!1;typeof i=="number"?i=new ArrayBuffer(i):(n=!0,this.lastWrittenByte=i.byteLength);let o=e.offset?e.offset>>>0:0,s=i.byteLength-o,l=o;(ArrayBuffer.isView(i)||i instanceof r)&&(i.byteLength!==i.buffer.byteLength&&(l=i.byteOffset+o),i=i.buffer),n?this.lastWrittenByte=s:this.lastWrittenByte=0,this.buffer=i,this.length=s,this.byteLength=s,this.byteOffset=l,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,l,s),this._mark=0,this._marks=[]}available(i=1){return this.offset+i<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(i=1){return this.offset+=i,this}back(i=1){return this.offset-=i,this}seek(i){return this.offset=i,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){let i=this._marks.pop();if(i===void 0)throw new Error("Mark stack empty");return this.seek(i),this}rewind(){return this.offset=0,this}ensureAvailable(i=1){if(!this.available(i)){let n=(this.offset+i)*2,o=new Uint8Array(n);o.set(new Uint8Array(this.buffer)),this.buffer=o.buffer,this.length=n,this.byteLength=n,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(i=1){return this.readArray(i,"uint8")}readArray(i,e){let n=BP[e].BYTES_PER_ELEMENT*i,o=this.byteOffset+this.offset,s=this.buffer.slice(o,o+n);if(this.littleEndian===Sre&&e!=="uint8"&&e!=="int8"){let h=new Uint8Array(this.buffer.slice(o,o+n));h.reverse();let p=new BP[e](h.buffer);return this.offset+=n,p.reverse(),p}let l=new BP[e](s);return this.offset+=n,l}readInt16(){let i=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,i}readUint16(){let i=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,i}readInt32(){let i=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,i}readUint32(){let i=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,i}readFloat32(){let i=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,i}readFloat64(){let i=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,i}readBigInt64(){let i=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,i}readBigUint64(){let i=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,i}readChar(){return String.fromCharCode(this.readInt8())}readChars(i=1){let e="";for(let n=0;n<i;n++)e+=this.readChar();return e}readUtf8(i=1){return NP(this.readBytes(i))}decodeText(i=1,e="utf8"){return NP(this.readBytes(i),e)}writeBoolean(i){return this.writeUint8(i?255:0),this}writeInt8(i){return this.ensureAvailable(1),this._data.setInt8(this.offset++,i),this._updateLastWrittenByte(),this}writeUint8(i){return this.ensureAvailable(1),this._data.setUint8(this.offset++,i),this._updateLastWrittenByte(),this}writeByte(i){return this.writeUint8(i)}writeBytes(i){this.ensureAvailable(i.length);for(let e=0;e<i.length;e++)this._data.setUint8(this.offset++,i[e]);return this._updateLastWrittenByte(),this}writeInt16(i){return this.ensureAvailable(2),this._data.setInt16(this.offset,i,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(i){return this.ensureAvailable(2),this._data.setUint16(this.offset,i,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(i){return this.ensureAvailable(4),this._data.setInt32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(i){return this.ensureAvailable(4),this._data.setUint32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(i){return this.ensureAvailable(4),this._data.setFloat32(this.offset,i,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(i){return this.ensureAvailable(8),this._data.setFloat64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(i){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(i){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,i,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(i){return this.writeUint8(i.charCodeAt(0))}writeChars(i){for(let e=0;e<i.length;e++)this.writeUint8(i.charCodeAt(e));return this}writeUtf8(i){return this.writeBytes(lj(i))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}};function rv(r){let i=r.length;for(;--i>=0;)r[i]=0}var Cre=0,qj=1,Are=2,Mre=3,Ire=258,lL=29,Qx=256,$x=Qx+1+lL,ev=30,cL=19,Yj=2*$x+1,uy=15,GP=16,Ere=7,uL=256,Zj=16,Xj=17,Kj=18,JP=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),wM=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Tre=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Qj=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fre=512,Zf=new Array(($x+2)*2);rv(Zf);var Vx=new Array(ev*2);rv(Vx);var Wx=new Array(Fre);rv(Wx);var Hx=new Array(Ire-Mre+1);rv(Hx);var dL=new Array(lL);rv(dL);var xM=new Array(ev);rv(xM);function jP(r,i,e,n,o){this.static_tree=r,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=o,this.has_stree=r&&r.length}var Jj,eV,tV;function VP(r,i){this.dyn_tree=r,this.max_code=0,this.stat_desc=i}var iV=r=>r<256?Wx[r]:Wx[256+(r>>>7)],qx=(r,i)=>{r.pending_buf[r.pending++]=i&255,r.pending_buf[r.pending++]=i>>>8&255},sd=(r,i,e)=>{r.bi_valid>GP-e?(r.bi_buf|=i<<r.bi_valid&65535,qx(r,r.bi_buf),r.bi_buf=i>>GP-r.bi_valid,r.bi_valid+=e-GP):(r.bi_buf|=i<<r.bi_valid&65535,r.bi_valid+=e)},Im=(r,i,e)=>{sd(r,e[i*2],e[i*2+1])},rV=(r,i)=>{let e=0;do e|=r&1,r>>>=1,e<<=1;while(--i>0);return e>>>1},Pre=r=>{r.bi_valid===16?(qx(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=r.bi_buf&255,r.bi_buf>>=8,r.bi_valid-=8)},Lre=(r,i)=>{let e=i.dyn_tree,n=i.max_code,o=i.stat_desc.static_tree,s=i.stat_desc.has_stree,l=i.stat_desc.extra_bits,h=i.stat_desc.extra_base,p=i.stat_desc.max_length,m,f,g,y,_,w,A=0;for(y=0;y<=uy;y++)r.bl_count[y]=0;for(e[r.heap[r.heap_max]*2+1]=0,m=r.heap_max+1;m<Yj;m++)f=r.heap[m],y=e[e[f*2+1]*2+1]+1,y>p&&(y=p,A++),e[f*2+1]=y,!(f>n)&&(r.bl_count[y]++,_=0,f>=h&&(_=l[f-h]),w=e[f*2],r.opt_len+=w*(y+_),s&&(r.static_len+=w*(o[f*2+1]+_)));if(A!==0){do{for(y=p-1;r.bl_count[y]===0;)y--;r.bl_count[y]--,r.bl_count[y+1]+=2,r.bl_count[p]--,A-=2}while(A>0);for(y=p;y!==0;y--)for(f=r.bl_count[y];f!==0;)g=r.heap[--m],!(g>n)&&(e[g*2+1]!==y&&(r.opt_len+=(y-e[g*2+1])*e[g*2],e[g*2+1]=y),f--)}},nV=(r,i,e)=>{let n=new Array(uy+1),o=0,s,l;for(s=1;s<=uy;s++)o=o+e[s-1]<<1,n[s]=o;for(l=0;l<=i;l++){let h=r[l*2+1];h!==0&&(r[l*2]=rV(n[h]++,h))}},kre=()=>{let r,i,e,n,o,s=new Array(uy+1);for(e=0,n=0;n<lL-1;n++)for(dL[n]=e,r=0;r<1<<JP[n];r++)Hx[e++]=n;for(Hx[e-1]=n,o=0,n=0;n<16;n++)for(xM[n]=o,r=0;r<1<<wM[n];r++)Wx[o++]=n;for(o>>=7;n<ev;n++)for(xM[n]=o<<7,r=0;r<1<<wM[n]-7;r++)Wx[256+o++]=n;for(i=0;i<=uy;i++)s[i]=0;for(r=0;r<=143;)Zf[r*2+1]=8,r++,s[8]++;for(;r<=255;)Zf[r*2+1]=9,r++,s[9]++;for(;r<=279;)Zf[r*2+1]=7,r++,s[7]++;for(;r<=287;)Zf[r*2+1]=8,r++,s[8]++;for(nV(Zf,$x+1,s),r=0;r<ev;r++)Vx[r*2+1]=5,Vx[r*2]=rV(r,5);Jj=new jP(Zf,JP,Qx+1,$x,uy),eV=new jP(Vx,wM,0,ev,uy),tV=new jP(new Array(0),Tre,0,cL,Ere)},oV=r=>{let i;for(i=0;i<$x;i++)r.dyn_ltree[i*2]=0;for(i=0;i<ev;i++)r.dyn_dtree[i*2]=0;for(i=0;i<cL;i++)r.bl_tree[i*2]=0;r.dyn_ltree[uL*2]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},aV=r=>{r.bi_valid>8?qx(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},cj=(r,i,e,n)=>{let o=i*2,s=e*2;return r[o]<r[s]||r[o]===r[s]&&n[i]<=n[e]},UP=(r,i,e)=>{let n=r.heap[e],o=e<<1;for(;o<=r.heap_len&&(o<r.heap_len&&cj(i,r.heap[o+1],r.heap[o],r.depth)&&o++,!cj(i,n,r.heap[o],r.depth));)r.heap[e]=r.heap[o],e=o,o<<=1;r.heap[e]=n},uj=(r,i,e)=>{let n,o,s=0,l,h;if(r.sym_next!==0)do n=r.pending_buf[r.sym_buf+s++]&255,n+=(r.pending_buf[r.sym_buf+s++]&255)<<8,o=r.pending_buf[r.sym_buf+s++],n===0?Im(r,o,i):(l=Hx[o],Im(r,l+Qx+1,i),h=JP[l],h!==0&&(o-=dL[l],sd(r,o,h)),n--,l=iV(n),Im(r,l,e),h=wM[l],h!==0&&(n-=xM[l],sd(r,n,h)));while(s<r.sym_next);Im(r,uL,i)},eL=(r,i)=>{let e=i.dyn_tree,n=i.stat_desc.static_tree,o=i.stat_desc.has_stree,s=i.stat_desc.elems,l,h,p=-1,m;for(r.heap_len=0,r.heap_max=Yj,l=0;l<s;l++)e[l*2]!==0?(r.heap[++r.heap_len]=p=l,r.depth[l]=0):e[l*2+1]=0;for(;r.heap_len<2;)m=r.heap[++r.heap_len]=p<2?++p:0,e[m*2]=1,r.depth[m]=0,r.opt_len--,o&&(r.static_len-=n[m*2+1]);for(i.max_code=p,l=r.heap_len>>1;l>=1;l--)UP(r,e,l);m=s;do l=r.heap[1],r.heap[1]=r.heap[r.heap_len--],UP(r,e,1),h=r.heap[1],r.heap[--r.heap_max]=l,r.heap[--r.heap_max]=h,e[m*2]=e[l*2]+e[h*2],r.depth[m]=(r.depth[l]>=r.depth[h]?r.depth[l]:r.depth[h])+1,e[l*2+1]=e[h*2+1]=m,r.heap[1]=m++,UP(r,e,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],Lre(r,i),nV(e,p,r.bl_count)},dj=(r,i,e)=>{let n,o=-1,s,l=i[0*2+1],h=0,p=7,m=4;for(l===0&&(p=138,m=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)s=l,l=i[(n+1)*2+1],!(++h<p&&s===l)&&(h<m?r.bl_tree[s*2]+=h:s!==0?(s!==o&&r.bl_tree[s*2]++,r.bl_tree[Zj*2]++):h<=10?r.bl_tree[Xj*2]++:r.bl_tree[Kj*2]++,h=0,o=s,l===0?(p=138,m=3):s===l?(p=6,m=3):(p=7,m=4))},hj=(r,i,e)=>{let n,o=-1,s,l=i[0*2+1],h=0,p=7,m=4;for(l===0&&(p=138,m=3),n=0;n<=e;n++)if(s=l,l=i[(n+1)*2+1],!(++h<p&&s===l)){if(h<m)do Im(r,s,r.bl_tree);while(--h!==0);else s!==0?(s!==o&&(Im(r,s,r.bl_tree),h--),Im(r,Zj,r.bl_tree),sd(r,h-3,2)):h<=10?(Im(r,Xj,r.bl_tree),sd(r,h-3,3)):(Im(r,Kj,r.bl_tree),sd(r,h-11,7));h=0,o=s,l===0?(p=138,m=3):s===l?(p=6,m=3):(p=7,m=4)}},Ore=r=>{let i;for(dj(r,r.dyn_ltree,r.l_desc.max_code),dj(r,r.dyn_dtree,r.d_desc.max_code),eL(r,r.bl_desc),i=cL-1;i>=3&&r.bl_tree[Qj[i]*2+1]===0;i--);return r.opt_len+=3*(i+1)+5+5+4,i},Dre=(r,i,e,n)=>{let o;for(sd(r,i-257,5),sd(r,e-1,5),sd(r,n-4,4),o=0;o<n;o++)sd(r,r.bl_tree[Qj[o]*2+1],3);hj(r,r.dyn_ltree,i-1),hj(r,r.dyn_dtree,e-1)},Rre=r=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&r.dyn_ltree[e*2]!==0)return 0;if(r.dyn_ltree[9*2]!==0||r.dyn_ltree[10*2]!==0||r.dyn_ltree[13*2]!==0)return 1;for(e=32;e<Qx;e++)if(r.dyn_ltree[e*2]!==0)return 1;return 0},pj=!1,Nre=r=>{pj||(kre(),pj=!0),r.l_desc=new VP(r.dyn_ltree,Jj),r.d_desc=new VP(r.dyn_dtree,eV),r.bl_desc=new VP(r.bl_tree,tV),r.bi_buf=0,r.bi_valid=0,oV(r)},sV=(r,i,e,n)=>{sd(r,(Cre<<1)+(n?1:0),3),aV(r),qx(r,e),qx(r,~e),e&&r.pending_buf.set(r.window.subarray(i,i+e),r.pending),r.pending+=e},Bre=r=>{sd(r,qj<<1,3),Im(r,uL,Zf),Pre(r)},Gre=(r,i,e,n)=>{let o,s,l=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=Rre(r)),eL(r,r.l_desc),eL(r,r.d_desc),l=Ore(r),o=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=o&&(o=s)):o=s=e+5,e+4<=o&&i!==-1?sV(r,i,e,n):r.strategy===4||s===o?(sd(r,(qj<<1)+(n?1:0),3),uj(r,Zf,Vx)):(sd(r,(Are<<1)+(n?1:0),3),Dre(r,r.l_desc.max_code+1,r.d_desc.max_code+1,l+1),uj(r,r.dyn_ltree,r.dyn_dtree)),oV(r),n&&aV(r)},jre=(r,i,e)=>(r.pending_buf[r.sym_buf+r.sym_next++]=i,r.pending_buf[r.sym_buf+r.sym_next++]=i>>8,r.pending_buf[r.sym_buf+r.sym_next++]=e,i===0?r.dyn_ltree[e*2]++:(r.matches++,i--,r.dyn_ltree[(Hx[e]+Qx+1)*2]++,r.dyn_dtree[iV(i)*2]++),r.sym_next===r.sym_end),Vre=Nre,Ure=sV,zre=Gre,$re=jre,Wre=Bre,Hre={_tr_init:Vre,_tr_stored_block:Ure,_tr_flush_block:zre,_tr_tally:$re,_tr_align:Wre},qre=(r,i,e,n)=>{let o=r&65535|0,s=r>>>16&65535|0,l=0;for(;e!==0;){l=e>2e3?2e3:e,e-=l;do o=o+i[n++]|0,s=s+o|0;while(--l);o%=65521,s%=65521}return o|s<<16|0},Yx=qre,Yre=()=>{let r,i=[];for(var e=0;e<256;e++){r=e;for(var n=0;n<8;n++)r=r&1?3988292384^r>>>1:r>>>1;i[e]=r}return i},Zre=new Uint32Array(Yre()),Xre=(r,i,e,n)=>{let o=Zre,s=n+e;r^=-1;for(let l=n;l<s;l++)r=r>>>8^o[(r^i[l])&255];return r^-1},dc=Xre,py={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nv={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Kre,_tr_stored_block:tL,_tr_flush_block:Qre,_tr_tally:C0,_tr_align:Jre}=Hre,{Z_NO_FLUSH:A0,Z_PARTIAL_FLUSH:ene,Z_FULL_FLUSH:tne,Z_FINISH:Nh,Z_BLOCK:mj,Z_OK:Ec,Z_STREAM_END:fj,Z_STREAM_ERROR:Em,Z_DATA_ERROR:ine,Z_BUF_ERROR:zP,Z_DEFAULT_COMPRESSION:rne,Z_FILTERED:nne,Z_HUFFMAN_ONLY:gM,Z_RLE:one,Z_FIXED:ane,Z_DEFAULT_STRATEGY:sne,Z_UNKNOWN:lne,Z_DEFLATED:AM}=nv,cne=9,une=15,dne=8,hne=29,pne=256,iL=pne+1+hne,mne=30,fne=19,gne=2*iL+1,_ne=15,qn=3,S0=258,Tm=S0+qn+1,yne=32,tv=42,hL=57,rL=69,nL=73,oL=91,aL=103,dy=113,Gx=666,Iu=1,ov=2,my=3,av=4,vne=3,hy=(r,i)=>(r.msg=py[i],i),gj=r=>r*2-(r>4?9:0),x0=r=>{let i=r.length;for(;--i>=0;)r[i]=0},bne=r=>{let i,e,n,o=r.w_size;i=r.hash_size,n=i;do e=r.head[--n],r.head[n]=e>=o?e-o:0;while(--i);i=o,n=i;do e=r.prev[--n],r.prev[n]=e>=o?e-o:0;while(--i)},wne=(r,i,e)=>(i<<r.hash_shift^e)&r.hash_mask,M0=wne,Yd=r=>{let i=r.state,e=i.pending;e>r.avail_out&&(e=r.avail_out),e!==0&&(r.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),r.next_out),r.next_out+=e,i.pending_out+=e,r.total_out+=e,r.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},Zd=(r,i)=>{Qre(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,i),r.block_start=r.strstart,Yd(r.strm)},_o=(r,i)=>{r.pending_buf[r.pending++]=i},Bx=(r,i)=>{r.pending_buf[r.pending++]=i>>>8&255,r.pending_buf[r.pending++]=i&255},sL=(r,i,e,n)=>{let o=r.avail_in;return o>n&&(o=n),o===0?0:(r.avail_in-=o,i.set(r.input.subarray(r.next_in,r.next_in+o),e),r.state.wrap===1?r.adler=Yx(r.adler,i,o,e):r.state.wrap===2&&(r.adler=dc(r.adler,i,o,e)),r.next_in+=o,r.total_in+=o,o)},lV=(r,i)=>{let e=r.max_chain_length,n=r.strstart,o,s,l=r.prev_length,h=r.nice_match,p=r.strstart>r.w_size-Tm?r.strstart-(r.w_size-Tm):0,m=r.window,f=r.w_mask,g=r.prev,y=r.strstart+S0,_=m[n+l-1],w=m[n+l];r.prev_length>=r.good_match&&(e>>=2),h>r.lookahead&&(h=r.lookahead);do if(o=i,!(m[o+l]!==w||m[o+l-1]!==_||m[o]!==m[n]||m[++o]!==m[n+1])){n+=2,o++;do;while(m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&m[++n]===m[++o]&&n<y);if(s=S0-(y-n),n=y-S0,s>l){if(r.match_start=i,l=s,s>=h)break;_=m[n+l-1],w=m[n+l]}}while((i=g[i&f])>p&&--e!==0);return l<=r.lookahead?l:r.lookahead},iv=r=>{let i=r.w_size,e,n,o;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=i+(i-Tm)&&(r.window.set(r.window.subarray(i,i+i-n),0),r.match_start-=i,r.strstart-=i,r.block_start-=i,r.insert>r.strstart&&(r.insert=r.strstart),bne(r),n+=i),r.strm.avail_in===0)break;if(e=sL(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=e,r.lookahead+r.insert>=qn)for(o=r.strstart-r.insert,r.ins_h=r.window[o],r.ins_h=M0(r,r.ins_h,r.window[o+1]);r.insert&&(r.ins_h=M0(r,r.ins_h,r.window[o+qn-1]),r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++,r.insert--,!(r.lookahead+r.insert<qn)););}while(r.lookahead<Tm&&r.strm.avail_in!==0)},cV=(r,i)=>{let e=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,n,o,s,l=0,h=r.strm.avail_in;do{if(n=65535,s=r.bi_valid+42>>3,r.strm.avail_out<s||(s=r.strm.avail_out-s,o=r.strstart-r.block_start,n>o+r.strm.avail_in&&(n=o+r.strm.avail_in),n>s&&(n=s),n<e&&(n===0&&i!==Nh||i===A0||n!==o+r.strm.avail_in)))break;l=i===Nh&&n===o+r.strm.avail_in?1:0,tL(r,0,0,l),r.pending_buf[r.pending-4]=n,r.pending_buf[r.pending-3]=n>>8,r.pending_buf[r.pending-2]=~n,r.pending_buf[r.pending-1]=~n>>8,Yd(r.strm),o&&(o>n&&(o=n),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+o),r.strm.next_out),r.strm.next_out+=o,r.strm.avail_out-=o,r.strm.total_out+=o,r.block_start+=o,n-=o),n&&(sL(r.strm,r.strm.output,r.strm.next_out,n),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n)}while(l===0);return h-=r.strm.avail_in,h&&(h>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=h&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-h,r.strm.next_in),r.strstart),r.strstart+=h,r.insert+=h>r.w_size-r.insert?r.w_size-r.insert:h),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),l?av:i!==A0&&i!==Nh&&r.strm.avail_in===0&&r.strstart===r.block_start?ov:(s=r.window_size-r.strstart,r.strm.avail_in>s&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,s+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),s>r.strm.avail_in&&(s=r.strm.avail_in),s&&(sL(r.strm,r.window,r.strstart,s),r.strstart+=s,r.insert+=s>r.w_size-r.insert?r.w_size-r.insert:s),r.high_water<r.strstart&&(r.high_water=r.strstart),s=r.bi_valid+42>>3,s=r.pending_buf_size-s>65535?65535:r.pending_buf_size-s,e=s>r.w_size?r.w_size:s,o=r.strstart-r.block_start,(o>=e||(o||i===Nh)&&i!==A0&&r.strm.avail_in===0&&o<=s)&&(n=o>s?s:o,l=i===Nh&&r.strm.avail_in===0&&n===o?1:0,tL(r,r.block_start,n,l),r.block_start+=n,Yd(r.strm)),l?my:Iu)},$P=(r,i)=>{let e,n;for(;;){if(r.lookahead<Tm){if(iv(r),r.lookahead<Tm&&i===A0)return Iu;if(r.lookahead===0)break}if(e=0,r.lookahead>=qn&&(r.ins_h=M0(r,r.ins_h,r.window[r.strstart+qn-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),e!==0&&r.strstart-e<=r.w_size-Tm&&(r.match_length=lV(r,e)),r.match_length>=qn)if(n=C0(r,r.strstart-r.match_start,r.match_length-qn),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=qn){r.match_length--;do r.strstart++,r.ins_h=M0(r,r.ins_h,r.window[r.strstart+qn-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!==0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=M0(r,r.ins_h,r.window[r.strstart+1]);else n=C0(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(Zd(r,!1),r.strm.avail_out===0))return Iu}return r.insert=r.strstart<qn-1?r.strstart:qn-1,i===Nh?(Zd(r,!0),r.strm.avail_out===0?my:av):r.sym_next&&(Zd(r,!1),r.strm.avail_out===0)?Iu:ov},Q1=(r,i)=>{let e,n,o;for(;;){if(r.lookahead<Tm){if(iv(r),r.lookahead<Tm&&i===A0)return Iu;if(r.lookahead===0)break}if(e=0,r.lookahead>=qn&&(r.ins_h=M0(r,r.ins_h,r.window[r.strstart+qn-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=qn-1,e!==0&&r.prev_length<r.max_lazy_match&&r.strstart-e<=r.w_size-Tm&&(r.match_length=lV(r,e),r.match_length<=5&&(r.strategy===nne||r.match_length===qn&&r.strstart-r.match_start>4096)&&(r.match_length=qn-1)),r.prev_length>=qn&&r.match_length<=r.prev_length){o=r.strstart+r.lookahead-qn,n=C0(r,r.strstart-1-r.prev_match,r.prev_length-qn),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=o&&(r.ins_h=M0(r,r.ins_h,r.window[r.strstart+qn-1]),e=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!==0);if(r.match_available=0,r.match_length=qn-1,r.strstart++,n&&(Zd(r,!1),r.strm.avail_out===0))return Iu}else if(r.match_available){if(n=C0(r,0,r.window[r.strstart-1]),n&&Zd(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return Iu}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=C0(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<qn-1?r.strstart:qn-1,i===Nh?(Zd(r,!0),r.strm.avail_out===0?my:av):r.sym_next&&(Zd(r,!1),r.strm.avail_out===0)?Iu:ov},xne=(r,i)=>{let e,n,o,s,l=r.window;for(;;){if(r.lookahead<=S0){if(iv(r),r.lookahead<=S0&&i===A0)return Iu;if(r.lookahead===0)break}if(r.match_length=0,r.lookahead>=qn&&r.strstart>0&&(o=r.strstart-1,n=l[o],n===l[++o]&&n===l[++o]&&n===l[++o])){s=r.strstart+S0;do;while(n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&n===l[++o]&&o<s);r.match_length=S0-(s-o),r.match_length>r.lookahead&&(r.match_length=r.lookahead)}if(r.match_length>=qn?(e=C0(r,1,r.match_length-qn),r.lookahead-=r.match_length,r.strstart+=r.match_length,r.match_length=0):(e=C0(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++),e&&(Zd(r,!1),r.strm.avail_out===0))return Iu}return r.insert=0,i===Nh?(Zd(r,!0),r.strm.avail_out===0?my:av):r.sym_next&&(Zd(r,!1),r.strm.avail_out===0)?Iu:ov},Sne=(r,i)=>{let e;for(;;){if(r.lookahead===0&&(iv(r),r.lookahead===0)){if(i===A0)return Iu;break}if(r.match_length=0,e=C0(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++,e&&(Zd(r,!1),r.strm.avail_out===0))return Iu}return r.insert=0,i===Nh?(Zd(r,!0),r.strm.avail_out===0?my:av):r.sym_next&&(Zd(r,!1),r.strm.avail_out===0)?Iu:ov};function Mm(r,i,e,n,o){this.good_length=r,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=o}var jx=[new Mm(0,0,0,0,cV),new Mm(4,4,8,4,$P),new Mm(4,5,16,8,$P),new Mm(4,6,32,32,$P),new Mm(4,4,16,16,Q1),new Mm(8,16,32,32,Q1),new Mm(8,16,128,128,Q1),new Mm(8,32,128,256,Q1),new Mm(32,128,258,1024,Q1),new Mm(32,258,258,4096,Q1)],Cne=r=>{r.window_size=2*r.w_size,x0(r.head),r.max_lazy_match=jx[r.level].max_lazy,r.good_match=jx[r.level].good_length,r.nice_match=jx[r.level].nice_length,r.max_chain_length=jx[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=qn-1,r.match_available=0,r.ins_h=0};function Ane(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=AM,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(gne*2),this.dyn_dtree=new Uint16Array((2*mne+1)*2),this.bl_tree=new Uint16Array((2*fne+1)*2),x0(this.dyn_ltree),x0(this.dyn_dtree),x0(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(_ne+1),this.heap=new Uint16Array(2*iL+1),x0(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*iL+1),x0(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Jx=r=>{if(!r)return 1;let i=r.state;return!i||i.strm!==r||i.status!==tv&&i.status!==hL&&i.status!==rL&&i.status!==nL&&i.status!==oL&&i.status!==aL&&i.status!==dy&&i.status!==Gx?1:0},uV=r=>{if(Jx(r))return hy(r,Em);r.total_in=r.total_out=0,r.data_type=lne;let i=r.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?hL:i.wrap?tv:dy,r.adler=i.wrap===2?0:1,i.last_flush=-2,Kre(i),Ec},dV=r=>{let i=uV(r);return i===Ec&&Cne(r.state),i},Mne=(r,i)=>Jx(r)||r.state.wrap!==2?Em:(r.state.gzhead=i,Ec),hV=(r,i,e,n,o,s)=>{if(!r)return Em;let l=1;if(i===rne&&(i=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),o<1||o>cne||e!==AM||n<8||n>15||i<0||i>9||s<0||s>ane||n===8&&l!==1)return hy(r,Em);n===8&&(n=9);let h=new Ane;return r.state=h,h.strm=r,h.status=tv,h.wrap=l,h.gzhead=null,h.w_bits=n,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+qn-1)/qn),h.window=new Uint8Array(h.w_size*2),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=h.lit_bufsize*4,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=(h.lit_bufsize-1)*3,h.level=i,h.strategy=s,h.method=e,dV(r)},Ine=(r,i)=>hV(r,i,AM,une,dne,sne),Ene=(r,i)=>{if(Jx(r)||i>mj||i<0)return r?hy(r,Em):Em;let e=r.state;if(!r.output||r.avail_in!==0&&!r.input||e.status===Gx&&i!==Nh)return hy(r,r.avail_out===0?zP:Em);let n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(Yd(r),r.avail_out===0)return e.last_flush=-1,Ec}else if(r.avail_in===0&&gj(i)<=gj(n)&&i!==Nh)return hy(r,zP);if(e.status===Gx&&r.avail_in!==0)return hy(r,zP);if(e.status===tv&&e.wrap===0&&(e.status=dy),e.status===tv){let o=AM+(e.w_bits-8<<4)<<8,s=-1;if(e.strategy>=gM||e.level<2?s=0:e.level<6?s=1:e.level===6?s=2:s=3,o|=s<<6,e.strstart!==0&&(o|=yne),o+=31-o%31,Bx(e,o),e.strstart!==0&&(Bx(e,r.adler>>>16),Bx(e,r.adler&65535)),r.adler=1,e.status=dy,Yd(r),e.pending!==0)return e.last_flush=-1,Ec}if(e.status===hL){if(r.adler=0,_o(e,31),_o(e,139),_o(e,8),e.gzhead)_o(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),_o(e,e.gzhead.time&255),_o(e,e.gzhead.time>>8&255),_o(e,e.gzhead.time>>16&255),_o(e,e.gzhead.time>>24&255),_o(e,e.level===9?2:e.strategy>=gM||e.level<2?4:0),_o(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(_o(e,e.gzhead.extra.length&255),_o(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(r.adler=dc(r.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=rL;else if(_o(e,0),_o(e,0),_o(e,0),_o(e,0),_o(e,0),_o(e,e.level===9?2:e.strategy>=gM||e.level<2?4:0),_o(e,vne),e.status=dy,Yd(r),e.pending!==0)return e.last_flush=-1,Ec}if(e.status===rL){if(e.gzhead.extra){let o=e.pending,s=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+s>e.pending_buf_size;){let h=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+h),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o)),e.gzindex+=h,Yd(r),e.pending!==0)return e.last_flush=-1,Ec;o=0,s-=h}let l=new Uint8Array(e.gzhead.extra);e.pending_buf.set(l.subarray(e.gzindex,e.gzindex+s),e.pending),e.pending+=s,e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=nL}if(e.status===nL){if(e.gzhead.name){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o)),Yd(r),e.pending!==0)return e.last_flush=-1,Ec;o=0}e.gzindex<e.gzhead.name.length?s=e.gzhead.name.charCodeAt(e.gzindex++)&255:s=0,_o(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o)),e.gzindex=0}e.status=oL}if(e.status===oL){if(e.gzhead.comment){let o=e.pending,s;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o)),Yd(r),e.pending!==0)return e.last_flush=-1,Ec;o=0}e.gzindex<e.gzhead.comment.length?s=e.gzhead.comment.charCodeAt(e.gzindex++)&255:s=0,_o(e,s)}while(s!==0);e.gzhead.hcrc&&e.pending>o&&(r.adler=dc(r.adler,e.pending_buf,e.pending-o,o))}e.status=aL}if(e.status===aL){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(Yd(r),e.pending!==0))return e.last_flush=-1,Ec;_o(e,r.adler&255),_o(e,r.adler>>8&255),r.adler=0}if(e.status=dy,Yd(r),e.pending!==0)return e.last_flush=-1,Ec}if(r.avail_in!==0||e.lookahead!==0||i!==A0&&e.status!==Gx){let o=e.level===0?cV(e,i):e.strategy===gM?Sne(e,i):e.strategy===one?xne(e,i):jx[e.level].func(e,i);if((o===my||o===av)&&(e.status=Gx),o===Iu||o===my)return r.avail_out===0&&(e.last_flush=-1),Ec;if(o===ov&&(i===ene?Jre(e):i!==mj&&(tL(e,0,0,!1),i===tne&&(x0(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),Yd(r),r.avail_out===0))return e.last_flush=-1,Ec}return i!==Nh?Ec:e.wrap<=0?fj:(e.wrap===2?(_o(e,r.adler&255),_o(e,r.adler>>8&255),_o(e,r.adler>>16&255),_o(e,r.adler>>24&255),_o(e,r.total_in&255),_o(e,r.total_in>>8&255),_o(e,r.total_in>>16&255),_o(e,r.total_in>>24&255)):(Bx(e,r.adler>>>16),Bx(e,r.adler&65535)),Yd(r),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?Ec:fj)},Tne=r=>{if(Jx(r))return Em;let i=r.state.status;return r.state=null,i===dy?hy(r,ine):Ec},Fne=(r,i)=>{let e=i.length;if(Jx(r))return Em;let n=r.state,o=n.wrap;if(o===2||o===1&&n.status!==tv||n.lookahead)return Em;if(o===1&&(r.adler=Yx(r.adler,i,e,0)),n.wrap=0,e>=n.w_size){o===0&&(x0(n.head),n.strstart=0,n.block_start=0,n.insert=0);let p=new Uint8Array(n.w_size);p.set(i.subarray(e-n.w_size,e),0),i=p,e=n.w_size}let s=r.avail_in,l=r.next_in,h=r.input;for(r.avail_in=e,r.next_in=0,r.input=i,iv(n);n.lookahead>=qn;){let p=n.strstart,m=n.lookahead-(qn-1);do n.ins_h=M0(n,n.ins_h,n.window[p+qn-1]),n.prev[p&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=p,p++;while(--m);n.strstart=p,n.lookahead=qn-1,iv(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=qn-1,n.match_available=0,r.next_in=l,r.input=h,r.avail_in=s,n.wrap=o,Ec},Pne=Ine,Lne=hV,kne=dV,One=uV,Dne=Mne,Rne=Ene,Nne=Tne,Bne=Fne,Gne="pako deflate (from Nodeca project)",Ux={deflateInit:Pne,deflateInit2:Lne,deflateReset:kne,deflateResetKeep:One,deflateSetHeader:Dne,deflate:Rne,deflateEnd:Nne,deflateSetDictionary:Bne,deflateInfo:Gne},jne=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),Vne=function(r){let i=Array.prototype.slice.call(arguments,1);for(;i.length;){let e=i.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(let n in e)jne(e,n)&&(r[n]=e[n])}}return r},Une=r=>{let i=0;for(let n=0,o=r.length;n<o;n++)i+=r[n].length;let e=new Uint8Array(i);for(let n=0,o=0,s=r.length;n<s;n++){let l=r[n];e.set(l,o),o+=l.length}return e},MM={assign:Vne,flattenChunks:Une},pV=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{pV=!1}var Zx=new Uint8Array(256);for(let r=0;r<256;r++)Zx[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;Zx[254]=Zx[254]=1;var zne=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let i,e,n,o,s,l=r.length,h=0;for(o=0;o<l;o++)e=r.charCodeAt(o),(e&64512)===55296&&o+1<l&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),h+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(h),s=0,o=0;s<h;o++)e=r.charCodeAt(o),(e&64512)===55296&&o+1<l&&(n=r.charCodeAt(o+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),o++)),e<128?i[s++]=e:e<2048?(i[s++]=192|e>>>6,i[s++]=128|e&63):e<65536?(i[s++]=224|e>>>12,i[s++]=128|e>>>6&63,i[s++]=128|e&63):(i[s++]=240|e>>>18,i[s++]=128|e>>>12&63,i[s++]=128|e>>>6&63,i[s++]=128|e&63);return i},$ne=(r,i)=>{if(i<65534&&r.subarray&&pV)return String.fromCharCode.apply(null,r.length===i?r:r.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(r[n]);return e},Wne=(r,i)=>{let e=i||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,i));let n,o,s=new Array(e*2);for(o=0,n=0;n<e;){let l=r[n++];if(l<128){s[o++]=l;continue}let h=Zx[l];if(h>4){s[o++]=65533,n+=h-1;continue}for(l&=h===2?31:h===3?15:7;h>1&&n<e;)l=l<<6|r[n++]&63,h--;if(h>1){s[o++]=65533;continue}l<65536?s[o++]=l:(l-=65536,s[o++]=55296|l>>10&1023,s[o++]=56320|l&1023)}return $ne(s,o)},Hne=(r,i)=>{i=i||r.length,i>r.length&&(i=r.length);let e=i-1;for(;e>=0&&(r[e]&192)===128;)e--;return e<0||e===0?i:e+Zx[r[e]]>i?e:i},Xx={string2buf:zne,buf2string:Wne,utf8border:Hne};function qne(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var mV=qne,fV=Object.prototype.toString,{Z_NO_FLUSH:Yne,Z_SYNC_FLUSH:Zne,Z_FULL_FLUSH:Xne,Z_FINISH:Kne,Z_OK:SM,Z_STREAM_END:Qne,Z_DEFAULT_COMPRESSION:Jne,Z_DEFAULT_STRATEGY:eoe,Z_DEFLATED:toe}=nv;function eS(r){this.options=MM.assign({level:Jne,method:toe,chunkSize:16384,windowBits:15,memLevel:8,strategy:eoe},r||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mV,this.strm.avail_out=0;let e=Ux.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==SM)throw new Error(py[e]);if(i.header&&Ux.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=Xx.string2buf(i.dictionary):fV.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=Ux.deflateSetDictionary(this.strm,n),e!==SM)throw new Error(py[e]);this._dict_set=!0}}eS.prototype.push=function(r,i){let e=this.strm,n=this.options.chunkSize,o,s;if(this.ended)return!1;for(i===~~i?s=i:s=i===!0?Kne:Yne,typeof r=="string"?e.input=Xx.string2buf(r):fV.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(s===Zne||s===Xne)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(o=Ux.deflate(e,s),o===Qne)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),o=Ux.deflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===SM;if(e.avail_out===0){this.onData(e.output);continue}if(s>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};eS.prototype.onData=function(r){this.chunks.push(r)};eS.prototype.onEnd=function(r){r===SM&&(this.result=MM.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function pL(r,i){let e=new eS(i);if(e.push(r,!0),e.err)throw e.msg||py[e.err];return e.result}function ioe(r,i){return i=i||{},i.raw=!0,pL(r,i)}function roe(r,i){return i=i||{},i.gzip=!0,pL(r,i)}var noe=eS,ooe=pL,aoe=ioe,soe=roe,loe=nv,coe={Deflate:noe,deflate:ooe,deflateRaw:aoe,gzip:soe,constants:loe},_M=16209,uoe=16191,doe=function(i,e){let n,o,s,l,h,p,m,f,g,y,_,w,A,k,R,q,X,ie,ae,be,me,fe,ge,ue,se=i.state;n=i.next_in,ge=i.input,o=n+(i.avail_in-5),s=i.next_out,ue=i.output,l=s-(e-i.avail_out),h=s+(i.avail_out-257),p=se.dmax,m=se.wsize,f=se.whave,g=se.wnext,y=se.window,_=se.hold,w=se.bits,A=se.lencode,k=se.distcode,R=(1<<se.lenbits)-1,q=(1<<se.distbits)-1;e:do{w<15&&(_+=ge[n++]<<w,w+=8,_+=ge[n++]<<w,w+=8),X=A[_&R];t:for(;;){if(ie=X>>>24,_>>>=ie,w-=ie,ie=X>>>16&255,ie===0)ue[s++]=X&65535;else if(ie&16){ae=X&65535,ie&=15,ie&&(w<ie&&(_+=ge[n++]<<w,w+=8),ae+=_&(1<<ie)-1,_>>>=ie,w-=ie),w<15&&(_+=ge[n++]<<w,w+=8,_+=ge[n++]<<w,w+=8),X=k[_&q];i:for(;;){if(ie=X>>>24,_>>>=ie,w-=ie,ie=X>>>16&255,ie&16){if(be=X&65535,ie&=15,w<ie&&(_+=ge[n++]<<w,w+=8,w<ie&&(_+=ge[n++]<<w,w+=8)),be+=_&(1<<ie)-1,be>p){i.msg="invalid distance too far back",se.mode=_M;break e}if(_>>>=ie,w-=ie,ie=s-l,be>ie){if(ie=be-ie,ie>f&&se.sane){i.msg="invalid distance too far back",se.mode=_M;break e}if(me=0,fe=y,g===0){if(me+=m-ie,ie<ae){ae-=ie;do ue[s++]=y[me++];while(--ie);me=s-be,fe=ue}}else if(g<ie){if(me+=m+g-ie,ie-=g,ie<ae){ae-=ie;do ue[s++]=y[me++];while(--ie);if(me=0,g<ae){ie=g,ae-=ie;do ue[s++]=y[me++];while(--ie);me=s-be,fe=ue}}}else if(me+=g-ie,ie<ae){ae-=ie;do ue[s++]=y[me++];while(--ie);me=s-be,fe=ue}for(;ae>2;)ue[s++]=fe[me++],ue[s++]=fe[me++],ue[s++]=fe[me++],ae-=3;ae&&(ue[s++]=fe[me++],ae>1&&(ue[s++]=fe[me++]))}else{me=s-be;do ue[s++]=ue[me++],ue[s++]=ue[me++],ue[s++]=ue[me++],ae-=3;while(ae>2);ae&&(ue[s++]=ue[me++],ae>1&&(ue[s++]=ue[me++]))}}else if(ie&64){i.msg="invalid distance code",se.mode=_M;break e}else{X=k[(X&65535)+(_&(1<<ie)-1)];continue i}break}}else if(ie&64)if(ie&32){se.mode=uoe;break e}else{i.msg="invalid literal/length code",se.mode=_M;break e}else{X=A[(X&65535)+(_&(1<<ie)-1)];continue t}break}}while(n<o&&s<h);ae=w>>3,n-=ae,w-=ae<<3,_&=(1<<w)-1,i.next_in=n,i.next_out=s,i.avail_in=n<o?5+(o-n):5-(n-o),i.avail_out=s<h?257+(h-s):257-(s-h),se.hold=_,se.bits=w},J1=15,_j=852,yj=592,vj=0,WP=1,bj=2,hoe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),poe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),moe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),foe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),goe=(r,i,e,n,o,s,l,h)=>{let p=h.bits,m=0,f=0,g=0,y=0,_=0,w=0,A=0,k=0,R=0,q=0,X,ie,ae,be,me,fe=null,ge,ue=new Uint16Array(J1+1),se=new Uint16Array(J1+1),te=null,Se,Te,Ee;for(m=0;m<=J1;m++)ue[m]=0;for(f=0;f<n;f++)ue[i[e+f]]++;for(_=p,y=J1;y>=1&&ue[y]===0;y--);if(_>y&&(_=y),y===0)return o[s++]=1<<24|64<<16|0,o[s++]=1<<24|64<<16|0,h.bits=1,0;for(g=1;g<y&&ue[g]===0;g++);for(_<g&&(_=g),k=1,m=1;m<=J1;m++)if(k<<=1,k-=ue[m],k<0)return-1;if(k>0&&(r===vj||y!==1))return-1;for(se[1]=0,m=1;m<J1;m++)se[m+1]=se[m]+ue[m];for(f=0;f<n;f++)i[e+f]!==0&&(l[se[i[e+f]]++]=f);if(r===vj?(fe=te=l,ge=20):r===WP?(fe=hoe,te=poe,ge=257):(fe=moe,te=foe,ge=0),q=0,f=0,m=g,me=s,w=_,A=0,ae=-1,R=1<<_,be=R-1,r===WP&&R>_j||r===bj&&R>yj)return 1;for(;;){Se=m-A,l[f]+1<ge?(Te=0,Ee=l[f]):l[f]>=ge?(Te=te[l[f]-ge],Ee=fe[l[f]-ge]):(Te=96,Ee=0),X=1<<m-A,ie=1<<w,g=ie;do ie-=X,o[me+(q>>A)+ie]=Se<<24|Te<<16|Ee|0;while(ie!==0);for(X=1<<m-1;q&X;)X>>=1;if(X!==0?(q&=X-1,q+=X):q=0,f++,--ue[m]===0){if(m===y)break;m=i[e+l[f]]}if(m>_&&(q&be)!==ae){for(A===0&&(A=_),me+=g,w=m-A,k=1<<w;w+A<y&&(k-=ue[w+A],!(k<=0));)w++,k<<=1;if(R+=1<<w,r===WP&&R>_j||r===bj&&R>yj)return 1;ae=q&be,o[ae]=_<<24|w<<16|me-s|0}}return q!==0&&(o[me+q]=m-A<<24|64<<16|0),h.bits=_,0},zx=goe,_oe=0,gV=1,_V=2,{Z_FINISH:wj,Z_BLOCK:yoe,Z_TREES:yM,Z_OK:fy,Z_STREAM_END:voe,Z_NEED_DICT:boe,Z_STREAM_ERROR:Bh,Z_DATA_ERROR:yV,Z_MEM_ERROR:vV,Z_BUF_ERROR:woe,Z_DEFLATED:xj}=nv,IM=16180,Sj=16181,Cj=16182,Aj=16183,Mj=16184,Ij=16185,Ej=16186,Tj=16187,Fj=16188,Pj=16189,CM=16190,Yf=16191,HP=16192,Lj=16193,qP=16194,kj=16195,Oj=16196,Dj=16197,Rj=16198,vM=16199,bM=16200,Nj=16201,Bj=16202,Gj=16203,jj=16204,Vj=16205,YP=16206,Uj=16207,zj=16208,ss=16209,bV=16210,wV=16211,xoe=852,Soe=592,Coe=15,Aoe=Coe,$j=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function Moe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var gy=r=>{if(!r)return 1;let i=r.state;return!i||i.strm!==r||i.mode<IM||i.mode>wV?1:0},xV=r=>{if(gy(r))return Bh;let i=r.state;return r.total_in=r.total_out=i.total=0,r.msg="",i.wrap&&(r.adler=i.wrap&1),i.mode=IM,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(xoe),i.distcode=i.distdyn=new Int32Array(Soe),i.sane=1,i.back=-1,fy},SV=r=>{if(gy(r))return Bh;let i=r.state;return i.wsize=0,i.whave=0,i.wnext=0,xV(r)},CV=(r,i)=>{let e;if(gy(r))return Bh;let n=r.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?Bh:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,SV(r))},AV=(r,i)=>{if(!r)return Bh;let e=new Moe;r.state=e,e.strm=r,e.window=null,e.mode=IM;let n=CV(r,i);return n!==fy&&(r.state=null),n},Ioe=r=>AV(r,Aoe),Wj=!0,ZP,XP,Eoe=r=>{if(Wj){ZP=new Int32Array(512),XP=new Int32Array(32);let i=0;for(;i<144;)r.lens[i++]=8;for(;i<256;)r.lens[i++]=9;for(;i<280;)r.lens[i++]=7;for(;i<288;)r.lens[i++]=8;for(zx(gV,r.lens,0,288,ZP,0,r.work,{bits:9}),i=0;i<32;)r.lens[i++]=5;zx(_V,r.lens,0,32,XP,0,r.work,{bits:5}),Wj=!1}r.lencode=ZP,r.lenbits=9,r.distcode=XP,r.distbits=5},MV=(r,i,e,n)=>{let o,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(i.subarray(e-s.wsize,e),0),s.wnext=0,s.whave=s.wsize):(o=s.wsize-s.wnext,o>n&&(o=n),s.window.set(i.subarray(e-n,e-n+o),s.wnext),n-=o,n?(s.window.set(i.subarray(e-n,e),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0},Toe=(r,i)=>{let e,n,o,s,l,h,p,m,f,g,y,_,w,A,k=0,R,q,X,ie,ae,be,me,fe,ge=new Uint8Array(4),ue,se,te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(gy(r)||!r.output||!r.input&&r.avail_in!==0)return Bh;e=r.state,e.mode===Yf&&(e.mode=HP),l=r.next_out,o=r.output,p=r.avail_out,s=r.next_in,n=r.input,h=r.avail_in,m=e.hold,f=e.bits,g=h,y=p,fe=fy;e:for(;;)switch(e.mode){case IM:if(e.wrap===0){e.mode=HP;break}for(;f<16;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(e.wrap&2&&m===35615){e.wbits===0&&(e.wbits=15),e.check=0,ge[0]=m&255,ge[1]=m>>>8&255,e.check=dc(e.check,ge,2,0),m=0,f=0,e.mode=Sj;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((m&255)<<8)+(m>>8))%31){r.msg="incorrect header check",e.mode=ss;break}if((m&15)!==xj){r.msg="unknown compression method",e.mode=ss;break}if(m>>>=4,f-=4,me=(m&15)+8,e.wbits===0&&(e.wbits=me),me>15||me>e.wbits){r.msg="invalid window size",e.mode=ss;break}e.dmax=1<<e.wbits,e.flags=0,r.adler=e.check=1,e.mode=m&512?Pj:Yf,m=0,f=0;break;case Sj:for(;f<16;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(e.flags=m,(e.flags&255)!==xj){r.msg="unknown compression method",e.mode=ss;break}if(e.flags&57344){r.msg="unknown header flags set",e.mode=ss;break}e.head&&(e.head.text=m>>8&1),e.flags&512&&e.wrap&4&&(ge[0]=m&255,ge[1]=m>>>8&255,e.check=dc(e.check,ge,2,0)),m=0,f=0,e.mode=Cj;case Cj:for(;f<32;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.head&&(e.head.time=m),e.flags&512&&e.wrap&4&&(ge[0]=m&255,ge[1]=m>>>8&255,ge[2]=m>>>16&255,ge[3]=m>>>24&255,e.check=dc(e.check,ge,4,0)),m=0,f=0,e.mode=Aj;case Aj:for(;f<16;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.head&&(e.head.xflags=m&255,e.head.os=m>>8),e.flags&512&&e.wrap&4&&(ge[0]=m&255,ge[1]=m>>>8&255,e.check=dc(e.check,ge,2,0)),m=0,f=0,e.mode=Mj;case Mj:if(e.flags&1024){for(;f<16;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.length=m,e.head&&(e.head.extra_len=m),e.flags&512&&e.wrap&4&&(ge[0]=m&255,ge[1]=m>>>8&255,e.check=dc(e.check,ge,2,0)),m=0,f=0}else e.head&&(e.head.extra=null);e.mode=Ij;case Ij:if(e.flags&1024&&(_=e.length,_>h&&(_=h),_&&(e.head&&(me=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(s,s+_),me)),e.flags&512&&e.wrap&4&&(e.check=dc(e.check,n,_,s)),h-=_,s+=_,e.length-=_),e.length))break e;e.length=0,e.mode=Ej;case Ej:if(e.flags&2048){if(h===0)break e;_=0;do me=n[s+_++],e.head&&me&&e.length<65536&&(e.head.name+=String.fromCharCode(me));while(me&&_<h);if(e.flags&512&&e.wrap&4&&(e.check=dc(e.check,n,_,s)),h-=_,s+=_,me)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=Tj;case Tj:if(e.flags&4096){if(h===0)break e;_=0;do me=n[s+_++],e.head&&me&&e.length<65536&&(e.head.comment+=String.fromCharCode(me));while(me&&_<h);if(e.flags&512&&e.wrap&4&&(e.check=dc(e.check,n,_,s)),h-=_,s+=_,me)break e}else e.head&&(e.head.comment=null);e.mode=Fj;case Fj:if(e.flags&512){for(;f<16;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(e.wrap&4&&m!==(e.check&65535)){r.msg="header crc mismatch",e.mode=ss;break}m=0,f=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),r.adler=e.check=0,e.mode=Yf;break;case Pj:for(;f<32;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}r.adler=e.check=$j(m),m=0,f=0,e.mode=CM;case CM:if(e.havedict===0)return r.next_out=l,r.avail_out=p,r.next_in=s,r.avail_in=h,e.hold=m,e.bits=f,boe;r.adler=e.check=1,e.mode=Yf;case Yf:if(i===yoe||i===yM)break e;case HP:if(e.last){m>>>=f&7,f-=f&7,e.mode=YP;break}for(;f<3;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}switch(e.last=m&1,m>>>=1,f-=1,m&3){case 0:e.mode=Lj;break;case 1:if(Eoe(e),e.mode=vM,i===yM){m>>>=2,f-=2;break e}break;case 2:e.mode=Oj;break;case 3:r.msg="invalid block type",e.mode=ss}m>>>=2,f-=2;break;case Lj:for(m>>>=f&7,f-=f&7;f<32;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if((m&65535)!==(m>>>16^65535)){r.msg="invalid stored block lengths",e.mode=ss;break}if(e.length=m&65535,m=0,f=0,e.mode=qP,i===yM)break e;case qP:e.mode=kj;case kj:if(_=e.length,_){if(_>h&&(_=h),_>p&&(_=p),_===0)break e;o.set(n.subarray(s,s+_),l),h-=_,s+=_,p-=_,l+=_,e.length-=_;break}e.mode=Yf;break;case Oj:for(;f<14;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(e.nlen=(m&31)+257,m>>>=5,f-=5,e.ndist=(m&31)+1,m>>>=5,f-=5,e.ncode=(m&15)+4,m>>>=4,f-=4,e.nlen>286||e.ndist>30){r.msg="too many length or distance symbols",e.mode=ss;break}e.have=0,e.mode=Dj;case Dj:for(;e.have<e.ncode;){for(;f<3;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.lens[te[e.have++]]=m&7,m>>>=3,f-=3}for(;e.have<19;)e.lens[te[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,ue={bits:e.lenbits},fe=zx(_oe,e.lens,0,19,e.lencode,0,e.work,ue),e.lenbits=ue.bits,fe){r.msg="invalid code lengths set",e.mode=ss;break}e.have=0,e.mode=Rj;case Rj:for(;e.have<e.nlen+e.ndist;){for(;k=e.lencode[m&(1<<e.lenbits)-1],R=k>>>24,q=k>>>16&255,X=k&65535,!(R<=f);){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(X<16)m>>>=R,f-=R,e.lens[e.have++]=X;else{if(X===16){for(se=R+2;f<se;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(m>>>=R,f-=R,e.have===0){r.msg="invalid bit length repeat",e.mode=ss;break}me=e.lens[e.have-1],_=3+(m&3),m>>>=2,f-=2}else if(X===17){for(se=R+3;f<se;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}m>>>=R,f-=R,me=0,_=3+(m&7),m>>>=3,f-=3}else{for(se=R+7;f<se;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}m>>>=R,f-=R,me=0,_=11+(m&127),m>>>=7,f-=7}if(e.have+_>e.nlen+e.ndist){r.msg="invalid bit length repeat",e.mode=ss;break}for(;_--;)e.lens[e.have++]=me}}if(e.mode===ss)break;if(e.lens[256]===0){r.msg="invalid code -- missing end-of-block",e.mode=ss;break}if(e.lenbits=9,ue={bits:e.lenbits},fe=zx(gV,e.lens,0,e.nlen,e.lencode,0,e.work,ue),e.lenbits=ue.bits,fe){r.msg="invalid literal/lengths set",e.mode=ss;break}if(e.distbits=6,e.distcode=e.distdyn,ue={bits:e.distbits},fe=zx(_V,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,ue),e.distbits=ue.bits,fe){r.msg="invalid distances set",e.mode=ss;break}if(e.mode=vM,i===yM)break e;case vM:e.mode=bM;case bM:if(h>=6&&p>=258){r.next_out=l,r.avail_out=p,r.next_in=s,r.avail_in=h,e.hold=m,e.bits=f,doe(r,y),l=r.next_out,o=r.output,p=r.avail_out,s=r.next_in,n=r.input,h=r.avail_in,m=e.hold,f=e.bits,e.mode===Yf&&(e.back=-1);break}for(e.back=0;k=e.lencode[m&(1<<e.lenbits)-1],R=k>>>24,q=k>>>16&255,X=k&65535,!(R<=f);){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(q&&!(q&240)){for(ie=R,ae=q,be=X;k=e.lencode[be+((m&(1<<ie+ae)-1)>>ie)],R=k>>>24,q=k>>>16&255,X=k&65535,!(ie+R<=f);){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}m>>>=ie,f-=ie,e.back+=ie}if(m>>>=R,f-=R,e.back+=R,e.length=X,q===0){e.mode=Vj;break}if(q&32){e.back=-1,e.mode=Yf;break}if(q&64){r.msg="invalid literal/length code",e.mode=ss;break}e.extra=q&15,e.mode=Nj;case Nj:if(e.extra){for(se=e.extra;f<se;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.length+=m&(1<<e.extra)-1,m>>>=e.extra,f-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=Bj;case Bj:for(;k=e.distcode[m&(1<<e.distbits)-1],R=k>>>24,q=k>>>16&255,X=k&65535,!(R<=f);){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(!(q&240)){for(ie=R,ae=q,be=X;k=e.distcode[be+((m&(1<<ie+ae)-1)>>ie)],R=k>>>24,q=k>>>16&255,X=k&65535,!(ie+R<=f);){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}m>>>=ie,f-=ie,e.back+=ie}if(m>>>=R,f-=R,e.back+=R,q&64){r.msg="invalid distance code",e.mode=ss;break}e.offset=X,e.extra=q&15,e.mode=Gj;case Gj:if(e.extra){for(se=e.extra;f<se;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}e.offset+=m&(1<<e.extra)-1,m>>>=e.extra,f-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){r.msg="invalid distance too far back",e.mode=ss;break}e.mode=jj;case jj:if(p===0)break e;if(_=y-p,e.offset>_){if(_=e.offset-_,_>e.whave&&e.sane){r.msg="invalid distance too far back",e.mode=ss;break}_>e.wnext?(_-=e.wnext,w=e.wsize-_):w=e.wnext-_,_>e.length&&(_=e.length),A=e.window}else A=o,w=l-e.offset,_=e.length;_>p&&(_=p),p-=_,e.length-=_;do o[l++]=A[w++];while(--_);e.length===0&&(e.mode=bM);break;case Vj:if(p===0)break e;o[l++]=e.length,p--,e.mode=bM;break;case YP:if(e.wrap){for(;f<32;){if(h===0)break e;h--,m|=n[s++]<<f,f+=8}if(y-=p,r.total_out+=y,e.total+=y,e.wrap&4&&y&&(r.adler=e.check=e.flags?dc(e.check,o,y,l-y):Yx(e.check,o,y,l-y)),y=p,e.wrap&4&&(e.flags?m:$j(m))!==e.check){r.msg="incorrect data check",e.mode=ss;break}m=0,f=0}e.mode=Uj;case Uj:if(e.wrap&&e.flags){for(;f<32;){if(h===0)break e;h--,m+=n[s++]<<f,f+=8}if(e.wrap&4&&m!==(e.total&4294967295)){r.msg="incorrect length check",e.mode=ss;break}m=0,f=0}e.mode=zj;case zj:fe=voe;break e;case ss:fe=yV;break e;case bV:return vV;case wV:default:return Bh}return r.next_out=l,r.avail_out=p,r.next_in=s,r.avail_in=h,e.hold=m,e.bits=f,(e.wsize||y!==r.avail_out&&e.mode<ss&&(e.mode<YP||i!==wj))&&MV(r,r.output,r.next_out,y-r.avail_out),g-=r.avail_in,y-=r.avail_out,r.total_in+=g,r.total_out+=y,e.total+=y,e.wrap&4&&y&&(r.adler=e.check=e.flags?dc(e.check,o,y,r.next_out-y):Yx(e.check,o,y,r.next_out-y)),r.data_type=e.bits+(e.last?64:0)+(e.mode===Yf?128:0)+(e.mode===vM||e.mode===qP?256:0),(g===0&&y===0||i===wj)&&fe===fy&&(fe=woe),fe},Foe=r=>{if(gy(r))return Bh;let i=r.state;return i.window&&(i.window=null),r.state=null,fy},Poe=(r,i)=>{if(gy(r))return Bh;let e=r.state;return e.wrap&2?(e.head=i,i.done=!1,fy):Bh},Loe=(r,i)=>{let e=i.length,n,o,s;return gy(r)||(n=r.state,n.wrap!==0&&n.mode!==CM)?Bh:n.mode===CM&&(o=1,o=Yx(o,i,e,0),o!==n.check)?yV:(s=MV(r,i,e,e),s?(n.mode=bV,vV):(n.havedict=1,fy))},koe=SV,Ooe=CV,Doe=xV,Roe=Ioe,Noe=AV,Boe=Toe,Goe=Foe,joe=Poe,Voe=Loe,Uoe="pako inflate (from Nodeca project)",Xf={inflateReset:koe,inflateReset2:Ooe,inflateResetKeep:Doe,inflateInit:Roe,inflateInit2:Noe,inflate:Boe,inflateEnd:Goe,inflateGetHeader:joe,inflateSetDictionary:Voe,inflateInfo:Uoe};function zoe(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var $oe=zoe,IV=Object.prototype.toString,{Z_NO_FLUSH:Woe,Z_FINISH:Hoe,Z_OK:Kx,Z_STREAM_END:KP,Z_NEED_DICT:QP,Z_STREAM_ERROR:qoe,Z_DATA_ERROR:Hj,Z_MEM_ERROR:Yoe}=nv;function tS(r){this.options=MM.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});let i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(r&&r.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15||(i.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mV,this.strm.avail_out=0;let e=Xf.inflateInit2(this.strm,i.windowBits);if(e!==Kx)throw new Error(py[e]);if(this.header=new $oe,Xf.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Xx.string2buf(i.dictionary):IV.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=Xf.inflateSetDictionary(this.strm,i.dictionary),e!==Kx)))throw new Error(py[e])}tS.prototype.push=function(r,i){let e=this.strm,n=this.options.chunkSize,o=this.options.dictionary,s,l,h;if(this.ended)return!1;for(i===~~i?l=i:l=i===!0?Hoe:Woe,IV.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),s=Xf.inflate(e,l),s===QP&&o&&(s=Xf.inflateSetDictionary(e,o),s===Kx?s=Xf.inflate(e,l):s===Hj&&(s=QP));e.avail_in>0&&s===KP&&e.state.wrap>0&&r[e.next_in]!==0;)Xf.inflateReset(e),s=Xf.inflate(e,l);switch(s){case qoe:case Hj:case QP:case Yoe:return this.onEnd(s),this.ended=!0,!1}if(h=e.avail_out,e.next_out&&(e.avail_out===0||s===KP))if(this.options.to==="string"){let p=Xx.utf8border(e.output,e.next_out),m=e.next_out-p,f=Xx.buf2string(e.output,p);e.next_out=m,e.avail_out=n-m,m&&e.output.set(e.output.subarray(p,p+m),0),this.onData(f)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(s===Kx&&h===0)){if(s===KP)return s=Xf.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};tS.prototype.onData=function(r){this.chunks.push(r)};tS.prototype.onEnd=function(r){r===Kx&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=MM.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function mL(r,i){let e=new tS(i);if(e.push(r),e.err)throw e.msg||py[e.err];return e.result}function Zoe(r,i){return i=i||{},i.raw=!0,mL(r,i)}var Xoe=tS,Koe=mL,Qoe=Zoe,Joe=mL,eae=nv,tae={Inflate:Xoe,inflate:Koe,inflateRaw:Qoe,ungzip:Joe,constants:eae},{Deflate:nke,deflate:oke,deflateRaw:ake,gzip:ske}=coe,{Inflate:iae,inflate:rae,inflateRaw:lke,ungzip:cke}=tae;var fL=iae,EV=rae;var FV=[];for(let r=0;r<256;r++){let i=r;for(let e=0;e<8;e++)i&1?i=3988292384^i>>>1:i=i>>>1;FV[r]=i}var TV=4294967295;function nae(r,i,e){let n=r;for(let o=0;o<e;o++)n=FV[(n^i[o])&255]^n>>>8;return n}function oae(r,i){return(nae(TV,r,i)^TV)>>>0}function gL(r,i,e){let n=r.readUint32(),o=oae(new Uint8Array(r.buffer,r.byteOffset+r.offset-i-4,i),i);if(o!==n)throw new Error(`CRC mismatch for chunk ${e}. Expected ${n}, found ${o}`)}function EM(r,i,e){for(let n=0;n<e;n++)i[n]=r[n]}function TM(r,i,e,n){let o=0;for(;o<n;o++)i[o]=r[o];for(;o<e;o++)i[o]=r[o]+i[o-n]&255}function FM(r,i,e,n){let o=0;if(e.length===0)for(;o<n;o++)i[o]=r[o];else for(;o<n;o++)i[o]=r[o]+e[o]&255}function PM(r,i,e,n,o){let s=0;if(e.length===0){for(;s<o;s++)i[s]=r[s];for(;s<n;s++)i[s]=r[s]+(i[s-o]>>1)&255}else{for(;s<o;s++)i[s]=r[s]+(e[s]>>1)&255;for(;s<n;s++)i[s]=r[s]+(i[s-o]+e[s]>>1)&255}}function LM(r,i,e,n,o){let s=0;if(e.length===0){for(;s<o;s++)i[s]=r[s];for(;s<n;s++)i[s]=r[s]+i[s-o]&255}else{for(;s<o;s++)i[s]=r[s]+e[s]&255;for(;s<n;s++)i[s]=r[s]+aae(i[s-o],e[s],e[s-o])&255}}function aae(r,i,e){let n=r+i-e,o=Math.abs(n-r),s=Math.abs(n-i),l=Math.abs(n-e);return o<=s&&o<=l?r:s<=l?i:e}function PV(r,i,e,n,o,s){switch(r){case 0:EM(i,e,o);break;case 1:TM(i,e,o,s);break;case 2:FM(i,e,n,o);break;case 3:PM(i,e,n,o,s);break;case 4:LM(i,e,n,o,s);break;default:throw new Error(`Unsupported filter: ${r}`)}}var sae=new Uint16Array([255]),lae=new Uint8Array(sae.buffer),cae=lae[0]===255;function LV(r){let{data:i,width:e,height:n,channels:o,depth:s}=r,l=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],h=Math.ceil(s/8)*o,p=new Uint8Array(n*e*h),m=0;for(let f=0;f<7;f++){let g=l[f],y=Math.ceil((e-g.x)/g.xStep),_=Math.ceil((n-g.y)/g.yStep);if(y<=0||_<=0)continue;let w=y*h,A=new Uint8Array(w);for(let k=0;k<_;k++){let R=i[m++],q=i.subarray(m,m+w);m+=w;let X=new Uint8Array(w);PV(R,q,X,A,w,h),A.set(X);for(let ie=0;ie<y;ie++){let ae=g.x+ie*g.xStep,be=g.y+k*g.yStep;if(!(ae>=e||be>=n))for(let me=0;me<h;me++)p[(be*e+ae)*h+me]=X[ie*h+me]}}}if(s===16){let f=new Uint16Array(p.buffer);if(cae)for(let g=0;g<f.length;g++)f[g]=uae(f[g]);return f}else return p}function uae(r){return(r&255)<<8|r>>8&255}var dae=new Uint16Array([255]),hae=new Uint8Array(dae.buffer),pae=hae[0]===255,mae=new Uint8Array(0);function _L(r){let{data:i,width:e,height:n,channels:o,depth:s}=r,l=Math.ceil(s/8)*o,h=Math.ceil(s/8*o*e),p=new Uint8Array(n*h),m=mae,f=0,g,y;for(let _=0;_<n;_++){switch(g=i.subarray(f+1,f+1+h),y=p.subarray(_*h,(_+1)*h),i[f]){case 0:EM(g,y,h);break;case 1:TM(g,y,h,l);break;case 2:FM(g,y,m,h);break;case 3:PM(g,y,m,h,l);break;case 4:LM(g,y,m,h,l);break;default:throw new Error(`Unsupported filter: ${i[f]}`)}m=y,f+=h+1}if(s===16){let _=new Uint16Array(p.buffer);if(pae)for(let w=0;w<_.length;w++)_[w]=fae(_[w]);return _}else return p}function fae(r){return(r&255)<<8|r>>8&255}var kM=Uint8Array.of(137,80,78,71,13,10,26,10);function yL(r){if(!kV(r.readBytes(kM.length)))throw new Error("wrong PNG signature")}function kV(r){if(r.length<kM.length)return!1;for(let i=0;i<kM.length;i++)if(r[i]!==kM[i])return!1;return!0}var OV="tEXt",_ae=0,DV=new TextDecoder("latin1");function yae(r){if(bae(r),r.length===0||r.length>79)throw new Error("keyword length must be between 1 and 79")}var vae=/^[\u0000-\u00FF]*$/;function bae(r){if(!vae.test(r))throw new Error("invalid latin1 text")}function RV(r,i,e){let n=vL(i);r[n]=wae(i,e-n.length-1)}function vL(r){for(r.mark();r.readByte()!==_ae;);let i=r.offset;r.reset();let e=DV.decode(r.readBytes(i-r.offset-1));return r.skip(1),yae(e),e}function wae(r,i){return DV.decode(r.readBytes(i))}var Eu={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},iS={UNKNOWN:-1,DEFLATE:0},OM={UNKNOWN:-1,ADAPTIVE:0},rS={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},nS={NONE:0,BACKGROUND:1,PREVIOUS:2},DM={SOURCE:0,OVER:1};var RM=class extends Nx{_checkCrc;_inflator;_png;_apng;_end;_hasPalette;_palette;_hasTransparency;_transparency;_compressionMethod;_filterMethod;_interlaceMethod;_colorType;_isAnimated;_numberOfFrames;_numberOfPlays;_frames;_writingDataChunks;constructor(i,e={}){super(i);let{checkCrc:n=!1}=e;this._checkCrc=n,this._inflator=new fL,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=iS.UNKNOWN,this._filterMethod=OM.UNKNOWN,this._interlaceMethod=rS.UNKNOWN,this._colorType=Eu.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(yL(this);!this._end;){let i=this.readUint32(),e=this.readChars(4);this.decodeChunk(i,e)}return this.decodeImage(),this._png}decodeApng(){for(yL(this);!this._end;){let i=this.readUint32(),e=this.readChars(4);this.decodeApngChunk(i,e)}return this.decodeApngImage(),this._apng}decodeChunk(i,e){let n=this.offset;switch(e){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(i);break;case"IDAT":this.decodeIDAT(i);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(i);break;case"iCCP":this.decodeiCCP(i);break;case OV:RV(this._png.text,this,i);break;case"pHYs":this.decodepHYs();break;default:this.skip(i);break}if(this.offset-n!==i)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?gL(this,i+4,e):this.skip(4)}decodeApngChunk(i,e){let n=this.offset;switch(e!=="fdAT"&&e!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),e){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(i);break;default:this.decodeChunk(i,e),this.offset=n+i;break}if(this.offset-n!==i)throw new Error(`Length mismatch while decoding chunk ${e}`);this._checkCrc?gL(this,i+4,e):this.skip(4)}decodeIHDR(){let i=this._png;i.width=this.readUint32(),i.height=this.readUint32(),i.depth=xae(this.readUint8());let e=this.readUint8();this._colorType=e;let n;switch(e){case Eu.GREYSCALE:n=1;break;case Eu.TRUECOLOUR:n=3;break;case Eu.INDEXED_COLOUR:n=1;break;case Eu.GREYSCALE_ALPHA:n=2;break;case Eu.TRUECOLOUR_ALPHA:n=4;break;case Eu.UNKNOWN:default:throw new Error(`Unknown color type: ${e}`)}if(this._png.channels=n,this._compressionMethod=this.readUint8(),this._compressionMethod!==iS.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){let i={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(i)}decodePLTE(i){if(i%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${i}`);let e=i/3;this._hasPalette=!0;let n=[];this._palette=n;for(let o=0;o<e;o++)n.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(i){this._writingDataChunks=!0;let e=i,n=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(i)}decodeFDAT(i){this._writingDataChunks=!0;let e=i,n=this.offset+this.byteOffset;if(n+=4,e-=4,this._inflator.push(new Uint8Array(this.buffer,n,e)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(i)}decodetRNS(i){switch(this._colorType){case Eu.GREYSCALE:case Eu.TRUECOLOUR:{if(i%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${i}`);if(i/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${i/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(i/2);for(let e=0;e<i/2;e++)this._transparency[e]=this.readUint16();break}case Eu.INDEXED_COLOUR:{if(i>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${i} vs ${this._palette.length})`);let e=0;for(;e<i;e++){let n=this.readByte();this._palette[e].push(n)}for(;e<this._palette.length;e++)this._palette[e].push(255);break}case Eu.UNKNOWN:case Eu.GREYSCALE_ALPHA:case Eu.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(i){let e=vL(this),n=this.readUint8();if(n!==iS.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${n}`);let o=this.readBytes(i-e.length-2);this._png.iccEmbeddedProfile={name:e,profile:EV(o)}}decodepHYs(){let i=this.readUint32(),e=this.readUint32(),n=this.readByte();this._png.resolution={x:i,y:e,unit:n}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let i=0;i<this._numberOfFrames;i++){let e={sequenceNumber:this._frames[i].sequenceNumber,delayNumber:this._frames[i].delayNumber,delayDenominator:this._frames[i].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},n=this._frames.at(i);if(n){if(n.data=_L({data:n.data,width:n.width,height:n.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),i===0||n.xOffset===0&&n.yOffset===0&&n.width===this._png.width&&n.height===this._png.height)e.data=n.data;else{let o=this._apng.frames.at(i-1);this.disposeFrame(n,o,e),this.addFrameDataToCanvas(e,n)}this._apng.frames.push(e)}}return this._apng}disposeFrame(i,e,n){switch(i.disposeOp){case nS.NONE:break;case nS.BACKGROUND:for(let o=0;o<this._png.height;o++)for(let s=0;s<this._png.width;s++){let l=(o*i.width+s)*this._png.channels;for(let h=0;h<this._png.channels;h++)n.data[l+h]=0}break;case nS.PREVIOUS:n.data.set(e.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(i,e){let n=1<<this._png.depth,o=(s,l)=>{let h=((s+e.yOffset)*this._png.width+e.xOffset+l)*this._png.channels,p=(s*e.width+l)*this._png.channels;return{index:h,frameIndex:p}};switch(e.blendOp){case DM.SOURCE:for(let s=0;s<e.height;s++)for(let l=0;l<e.width;l++){let{index:h,frameIndex:p}=o(s,l);for(let m=0;m<this._png.channels;m++)i.data[h+m]=e.data[p+m]}break;case DM.OVER:for(let s=0;s<e.height;s++)for(let l=0;l<e.width;l++){let{index:h,frameIndex:p}=o(s,l);for(let m=0;m<this._png.channels;m++){let f=e.data[p+this._png.channels-1]/n,g=m%(this._png.channels-1)===0?1:e.data[p+m],y=Math.floor(f*g+(1-f)*i.data[h+m]);i.data[h+m]+=y}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);let i=this._isAnimated?(this._frames?.at(0)).data:this._inflator.result;if(this._filterMethod!==OM.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===rS.NO_INTERLACE)this._png.data=_L({data:i,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===rS.ADAM7)this._png.data=LV({data:i,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){let i=this._inflator.result,e=this._frames.at(-1);e?e.data=i:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:nS.NONE,blendOp:DM.SOURCE,data:i}),this._inflator=new fL,this._writingDataChunks=!1}};function xae(r){if(r!==1&&r!==2&&r!==4&&r!==8&&r!==16)throw new Error(`invalid bit depth: ${r}`);return r}function NV(r,i){return new RM(r,i).decode()}var Wr=function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this}();function bL(){Wr.console&&typeof Wr.console.log=="function"&&Wr.console.log.apply(Wr.console,arguments)}var Xo={log:bL,warn:function(r){Wr.console&&(typeof Wr.console.warn=="function"?Wr.console.warn.apply(Wr.console,arguments):bL.call(null,arguments))},error:function(r){Wr.console&&(typeof Wr.console.error=="function"?Wr.console.error.apply(Wr.console,arguments):bL(r))}};function wL(r,i,e){var n=new XMLHttpRequest;n.open("GET",r),n.responseType="blob",n.onload=function(){_y(n.response,i,e)},n.onerror=function(){Xo.error("could not download file")},n.send()}function BV(r){var i=new XMLHttpRequest;i.open("HEAD",r,!1);try{i.send()}catch{}return i.status>=200&&i.status<=299}function NM(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(i)}}var _y=Wr.saveAs||((typeof window>"u"?"undefined":Eo(window))!=="object"||window!==Wr?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,i,e){var n=Wr.URL||Wr.webkitURL,o=document.createElement("a");i=i||r.name||"download",o.download=i,o.rel="noopener",typeof r=="string"?(o.href=r,o.origin!==location.origin?BV(o.href)?wL(r,i,e):NM(o,o.target="_blank"):NM(o)):(o.href=n.createObjectURL(r),setTimeout(function(){n.revokeObjectURL(o.href)},4e4),setTimeout(function(){NM(o)},0))}:"msSaveOrOpenBlob"in navigator?function(r,i,e){if(i=i||r.name||"download",typeof r=="string")if(BV(r))wL(r,i,e);else{var n=document.createElement("a");n.href=r,n.target="_blank",setTimeout(function(){NM(n)})}else navigator.msSaveOrOpenBlob(function(o,s){return s===void 0?s={autoBom:!1}:Eo(s)!=="object"&&(Xo.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}(r,e),i)}:function(r,i,e,n){if((n=n||open("","_blank"))&&(n.document.title=n.document.body.innerText="downloading..."),typeof r=="string")return wL(r,i,e);var o=r.type==="application/octet-stream",s=/constructor/i.test(Wr.HTMLElement)||Wr.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&s)&&(typeof FileReader>"u"?"undefined":Eo(FileReader))==="object"){var h=new FileReader;h.onloadend=function(){var f=h.result;f=l?f:f.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=f:location=f,n=null},h.readAsDataURL(r)}else{var p=Wr.URL||Wr.webkitURL,m=p.createObjectURL(r);n?n.location=m:location.href=m,n=null,setTimeout(function(){p.revokeObjectURL(m)},4e4)}});function lU(r){var i;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(h){return[parseInt(h[1]),parseInt(h[2]),parseInt(h[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(h){return[parseInt(h[1],16),parseInt(h[2],16),parseInt(h[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(h){return[parseInt(h[1]+h[1],16),parseInt(h[2]+h[2],16),parseInt(h[3]+h[3],16)]}}],n=0;n<e.length;n++){var o=e[n].re,s=e[n].process,l=o.exec(r);l&&(i=s(l),this.r=i[0],this.g=i[1],this.b=i[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var h=this.r.toString(16),p=this.g.toString(16),m=this.b.toString(16);return h.length==1&&(h="0"+h),p.length==1&&(p="0"+p),m.length==1&&(m="0"+m),"#"+h+p+m}}var VM=Wr.atob.bind(Wr),GV=Wr.btoa.bind(Wr);function xL(r,i){var e=r[0],n=r[1],o=r[2],s=r[3];e=Qc(e,n,o,s,i[0],7,-680876936),s=Qc(s,e,n,o,i[1],12,-389564586),o=Qc(o,s,e,n,i[2],17,606105819),n=Qc(n,o,s,e,i[3],22,-1044525330),e=Qc(e,n,o,s,i[4],7,-176418897),s=Qc(s,e,n,o,i[5],12,1200080426),o=Qc(o,s,e,n,i[6],17,-1473231341),n=Qc(n,o,s,e,i[7],22,-45705983),e=Qc(e,n,o,s,i[8],7,1770035416),s=Qc(s,e,n,o,i[9],12,-1958414417),o=Qc(o,s,e,n,i[10],17,-42063),n=Qc(n,o,s,e,i[11],22,-1990404162),e=Qc(e,n,o,s,i[12],7,1804603682),s=Qc(s,e,n,o,i[13],12,-40341101),o=Qc(o,s,e,n,i[14],17,-1502002290),e=Jc(e,n=Qc(n,o,s,e,i[15],22,1236535329),o,s,i[1],5,-165796510),s=Jc(s,e,n,o,i[6],9,-1069501632),o=Jc(o,s,e,n,i[11],14,643717713),n=Jc(n,o,s,e,i[0],20,-373897302),e=Jc(e,n,o,s,i[5],5,-701558691),s=Jc(s,e,n,o,i[10],9,38016083),o=Jc(o,s,e,n,i[15],14,-660478335),n=Jc(n,o,s,e,i[4],20,-405537848),e=Jc(e,n,o,s,i[9],5,568446438),s=Jc(s,e,n,o,i[14],9,-1019803690),o=Jc(o,s,e,n,i[3],14,-187363961),n=Jc(n,o,s,e,i[8],20,1163531501),e=Jc(e,n,o,s,i[13],5,-1444681467),s=Jc(s,e,n,o,i[2],9,-51403784),o=Jc(o,s,e,n,i[7],14,1735328473),e=eu(e,n=Jc(n,o,s,e,i[12],20,-1926607734),o,s,i[5],4,-378558),s=eu(s,e,n,o,i[8],11,-2022574463),o=eu(o,s,e,n,i[11],16,1839030562),n=eu(n,o,s,e,i[14],23,-35309556),e=eu(e,n,o,s,i[1],4,-1530992060),s=eu(s,e,n,o,i[4],11,1272893353),o=eu(o,s,e,n,i[7],16,-155497632),n=eu(n,o,s,e,i[10],23,-1094730640),e=eu(e,n,o,s,i[13],4,681279174),s=eu(s,e,n,o,i[0],11,-358537222),o=eu(o,s,e,n,i[3],16,-722521979),n=eu(n,o,s,e,i[6],23,76029189),e=eu(e,n,o,s,i[9],4,-640364487),s=eu(s,e,n,o,i[12],11,-421815835),o=eu(o,s,e,n,i[15],16,530742520),e=tu(e,n=eu(n,o,s,e,i[2],23,-995338651),o,s,i[0],6,-198630844),s=tu(s,e,n,o,i[7],10,1126891415),o=tu(o,s,e,n,i[14],15,-1416354905),n=tu(n,o,s,e,i[5],21,-57434055),e=tu(e,n,o,s,i[12],6,1700485571),s=tu(s,e,n,o,i[3],10,-1894986606),o=tu(o,s,e,n,i[10],15,-1051523),n=tu(n,o,s,e,i[1],21,-2054922799),e=tu(e,n,o,s,i[8],6,1873313359),s=tu(s,e,n,o,i[15],10,-30611744),o=tu(o,s,e,n,i[6],15,-1560198380),n=tu(n,o,s,e,i[13],21,1309151649),e=tu(e,n,o,s,i[4],6,-145523070),s=tu(s,e,n,o,i[11],10,-1120210379),o=tu(o,s,e,n,i[2],15,718787259),n=tu(n,o,s,e,i[9],21,-343485551),r[0]=E0(e,r[0]),r[1]=E0(n,r[1]),r[2]=E0(o,r[2]),r[3]=E0(s,r[3])}function YM(r,i,e,n,o,s){return i=E0(E0(i,r),E0(n,s)),E0(i<<o|i>>>32-o,e)}function Qc(r,i,e,n,o,s,l){return YM(i&e|~i&n,r,i,o,s,l)}function Jc(r,i,e,n,o,s,l){return YM(i&n|e&~n,r,i,o,s,l)}function eu(r,i,e,n,o,s,l){return YM(i^e^n,r,i,o,s,l)}function tu(r,i,e,n,o,s,l){return YM(e^(i|~n),r,i,o,s,l)}function cU(r){var i,e=r.length,n=[1732584193,-271733879,-1732584194,271733878];for(i=64;i<=r.length;i+=64)xL(n,Sae(r.substring(i-64,i)));r=r.substring(i-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<r.length;i++)o[i>>2]|=r.charCodeAt(i)<<(i%4<<3);if(o[i>>2]|=128<<(i%4<<3),i>55)for(xL(n,o),i=0;i<16;i++)o[i]=0;return o[14]=8*e,xL(n,o),n}function Sae(r){var i,e=[];for(i=0;i<64;i+=4)e[i>>2]=r.charCodeAt(i)+(r.charCodeAt(i+1)<<8)+(r.charCodeAt(i+2)<<16)+(r.charCodeAt(i+3)<<24);return e}var jV="0123456789abcdef".split("");function Cae(r){for(var i="",e=0;e<4;e++)i+=jV[r>>8*e+4&15]+jV[r>>8*e&15];return i}function Aae(r){return String.fromCharCode(255&r,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function EL(r){return cU(r).map(Aae).join("")}var Mae=function(r){for(var i=0;i<r.length;i++)r[i]=Cae(r[i]);return r.join("")}(cU("hello"))!="5d41402abc4b2a76b9719d911017c592";function E0(r,i){if(Mae){var e=(65535&r)+(65535&i);return(r>>16)+(i>>16)+(e>>16)<<16|65535&e}return r+i&4294967295}function TL(r,i){var e,n,o,s;if(r!==e){for(var l=(o=r,s=1+(256/r.length|0),new Array(s+1).join(o)),h=[],p=0;p<256;p++)h[p]=p;var m=0;for(p=0;p<256;p++){var f=h[p];m=(m+f+l.charCodeAt(p))%256,h[p]=h[m],h[m]=f}e=r,n=h}else h=n;var g=i.length,y=0,_=0,w="";for(p=0;p<g;p++)_=(_+(f=h[y=(y+1)%256]))%256,h[y]=h[_],h[_]=f,l=h[(h[y]+h[_])%256],w+=String.fromCharCode(i.charCodeAt(p)^l);return w}var VV={print:4,modify:8,copy:16,"annot-forms":32};function cv(r,i,e,n){this.v=1,this.r=2;var o=192;r.forEach(function(h){if(VV.perm!==void 0)throw new Error("Invalid permission: "+h);o+=VV[h]}),this.padding="(\xBFN^Nu\x8AAd\0NV\xFF\xFA\b..\0\xB6\xD0h>\x80/\f\xA9\xFEdSiz";var s=(i+this.padding).substr(0,32),l=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(s,l),this.P=-(1+(255^o)),this.encryptionKey=EL(s+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(n)).substr(0,5),this.U=TL(this.encryptionKey,this.padding)}function uv(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var i="",e=r.length,n=0;n<e;n++){var o=r.charCodeAt(n);i+=o<33||o===35||o===37||o===40||o===41||o===47||o===60||o===62||o===91||o===93||o===123||o===125||o>126?"#"+("0"+o.toString(16)).slice(-2):r[n]}return i}function UV(r){if(Eo(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var i={};this.subscribe=function(e,n,o){if(o=o||!1,typeof e!="string"||typeof n!="function"||typeof o!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");i.hasOwnProperty(e)||(i[e]={});var s=Math.random().toString(35);return i[e][s]=[n,!!o],s},this.unsubscribe=function(e){for(var n in i)if(i[n][e])return delete i[n][e],Object.keys(i[n]).length===0&&delete i[n],!0;return!1},this.publish=function(e){if(i.hasOwnProperty(e)){var n=Array.prototype.slice.call(arguments,1),o=[];for(var s in i[e]){var l=i[e][s];try{l[0].apply(r,n)}catch(h){Wr.console&&Xo.error("jsPDF PubSub Error",h.message,h)}l[1]&&o.push(s)}o.length&&o.forEach(this.unsubscribe)}},this.getTopics=function(){return i}}function HM(r){if(!(this instanceof HM))return new HM(r);var i="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&i.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function uU(r,i){this.gState=r,this.matrix=i,this.id="",this.objectNumber=-1}function yy(r,i,e,n,o){if(!(this instanceof yy))return new yy(r,i,e,n,o);this.type=r==="axial"?2:3,this.coords=i,this.colors=e,uU.call(this,n,o)}function dv(r,i,e,n,o){if(!(this instanceof dv))return new dv(r,i,e,n,o);this.boundingBox=r,this.xStep=i,this.yStep=e,this.stream="",this.cloneIndex=0,uU.call(this,n,o)}function Ui(r){var i,e=typeof arguments[0]=="string"?arguments[0]:"p",n=arguments[1],o=arguments[2],s=arguments[3],l=[],h=1,p=16,m="S",f=null;Eo(r=r||{})==="object"&&(e=r.orientation,n=r.unit||n,o=r.format||o,s=r.compress||r.compressPdf||s,(f=r.encryption||null)!==null&&(f.userPassword=f.userPassword||"",f.ownerPassword=f.ownerPassword||"",f.userPermissions=f.userPermissions||[]),h=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(i=r.precision),r.floatPrecision!==void 0&&(p=r.floatPrecision),m=r.defaultPathOperation||"S"),l=r.filters||(s===!0?["FlateEncode"]:l),n=n||"mm",e=(""+(e||"P")).toLowerCase();var g=r.putOnlyUsedFonts||!1,y={},_={internal:{},__private__:{}};_.__private__.PubSub=UV;var w="1.3",A=_.__private__.getPdfVersion=function(){return w};_.__private__.setPdfVersion=function(re){w=re};var k={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};_.__private__.getPageFormats=function(){return k};var R=_.__private__.getPageFormat=function(re){return k[re]};o=o||"a4";var q="compat",X="advanced",ie=q;function ae(){this.saveGraphicsState(),de(new zi(li,0,0,-li,0,j_()*li).toString()+" cm"),this.setFontSize(this.getFontSize()/li),m="n",ie=X}function be(){this.restoreGraphicsState(),m="S",ie=q}var me=_.__private__.combineFontStyleAndFontWeight=function(re,Ce){if(re=="bold"&&Ce=="normal"||re=="bold"&&Ce==400||re=="normal"&&Ce=="italic"||re=="bold"&&Ce=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return Ce&&(re=Ce==400||Ce==="normal"?re==="italic"?"italic":"normal":Ce!=700&&Ce!=="bold"||re!=="normal"?(Ce==700?"bold":Ce)+""+re:"bold"),re};_.advancedAPI=function(re){var Ce=ie===q;return Ce&&ae.call(this),typeof re!="function"||(re(this),Ce&&be.call(this)),this},_.compatAPI=function(re){var Ce=ie===X;return Ce&&be.call(this),typeof re!="function"||(re(this),Ce&&ae.call(this)),this},_.isAdvancedAPI=function(){return ie===X};var fe,ge=function(re){if(ie!==X)throw new Error(re+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},ue=_.roundToPrecision=_.__private__.roundToPrecision=function(re,Ce){var $e=i||Ce;if(isNaN(re)||isNaN($e))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return re.toFixed($e).replace(/0+$/,"")};fe=_.hpf=_.__private__.hpf=typeof p=="number"?function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(re,p)}:p==="smart"?function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(re,re>-1&&re<1?16:5)}:function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.hpf");return ue(re,16)};var se=_.f2=_.__private__.f2=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.f2");return ue(re,2)},te=_.__private__.f3=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.f3");return ue(re,3)},Se=_.scale=_.__private__.scale=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.scale");return ie===q?re*li:ie===X?re:void 0},Te=function(re){return Se(function(Ce){return ie===q?j_()-Ce:ie===X?Ce:void 0}(re))};_.__private__.setPrecision=_.setPrecision=function(re){typeof parseInt(re,10)=="number"&&(i=parseInt(re,10))};var Ee,je="00000000000000000000000000000000",Ne=_.__private__.getFileId=function(){return je},ze=_.__private__.setFileId=function(re){return je=re!==void 0&&/^[a-fA-F0-9]{32}$/.test(re)?re.toUpperCase():je.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),f!==null&&(El=new cv(f.userPermissions,f.userPassword,f.ownerPassword,je)),je};_.setFileId=function(re){return ze(re),this},_.getFileId=function(){return Ne()};var Re=_.__private__.convertDateToPDFDate=function(re){var Ce=re.getTimezoneOffset(),$e=Ce<0?"+":"-",rt=Math.floor(Math.abs(Ce/60)),gt=Math.abs(Ce%60),Dt=[$e,Le(rt),"'",Le(gt),"'"].join("");return["D:",re.getFullYear(),Le(re.getMonth()+1),Le(re.getDate()),Le(re.getHours()),Le(re.getMinutes()),Le(re.getSeconds()),Dt].join("")},Ge=_.__private__.convertPDFDateToDate=function(re){var Ce=parseInt(re.substr(2,4),10),$e=parseInt(re.substr(6,2),10)-1,rt=parseInt(re.substr(8,2),10),gt=parseInt(re.substr(10,2),10),Dt=parseInt(re.substr(12,2),10),Wt=parseInt(re.substr(14,2),10);return new Date(Ce,$e,rt,gt,Dt,Wt,0)},He=_.__private__.setCreationDate=function(re){var Ce;if(re===void 0&&(re=new Date),re instanceof Date)Ce=Re(re);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(re))throw new Error("Invalid argument passed to jsPDF.setCreationDate");Ce=re}return Ee=Ce},ye=_.__private__.getCreationDate=function(re){var Ce=Ee;return re==="jsDate"&&(Ce=Ge(Ee)),Ce};_.setCreationDate=function(re){return He(re),this},_.getCreationDate=function(re){return ye(re)};var Ae,Le=_.__private__.padd2=function(re){return("0"+parseInt(re)).slice(-2)},Ye=_.__private__.padd2Hex=function(re){return("00"+(re=re.toString())).substr(re.length)},qe=0,et=[],ft=[],mt=0,At=[],ht=[],he=!1,st=ft;_.__private__.setCustomOutputDestination=function(re){he=!0,st=re};var Je=function(re){he||(st=re)};_.__private__.resetCustomOutputDestination=function(){he=!1,st=ft};var de=_.__private__.out=function(re){return re=re.toString(),mt+=re.length+1,st.push(re),st},ke=_.__private__.write=function(re){return de(arguments.length===1?re.toString():Array.prototype.join.call(arguments," "))},Ze=_.__private__.getArrayBuffer=function(re){for(var Ce=re.length,$e=new ArrayBuffer(Ce),rt=new Uint8Array($e);Ce--;)rt[Ce]=re.charCodeAt(Ce);return $e},vt=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];_.__private__.getStandardFonts=function(){return vt};var tt=r.fontSize||16;_.__private__.setFontSize=_.setFontSize=function(re){return tt=ie===X?re/li:re,this};var ot,wt=_.__private__.getFontSize=_.getFontSize=function(){return ie===q?tt:tt*li},Mt=r.R2L||!1;_.__private__.setR2L=_.setR2L=function(re){return Mt=re,this},_.__private__.getR2L=_.getR2L=function(){return Mt};var St,ei=_.__private__.setZoomMode=function(re){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(re))ot=re;else if(isNaN(re)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(re)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+re+'" is not recognized.');ot=re}else ot=parseInt(re,10)};_.__private__.getZoomMode=function(){return ot};var Jt,Ut=_.__private__.setPageMode=function(re){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(re)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+re+'" is not recognized.');St=re};_.__private__.getPageMode=function(){return St};var pi=_.__private__.setLayoutMode=function(re){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(re)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+re+'" is not recognized.');Jt=re};_.__private__.getLayoutMode=function(){return Jt},_.__private__.setDisplayMode=_.setDisplayMode=function(re,Ce,$e){return ei(re),pi(Ce),Ut($e),this};var yi={title:"",subject:"",author:"",keywords:"",creator:""};_.__private__.getDocumentProperty=function(re){if(Object.keys(yi).indexOf(re)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return yi[re]},_.__private__.getDocumentProperties=function(){return yi},_.__private__.setDocumentProperties=_.setProperties=_.setDocumentProperties=function(re){for(var Ce in yi)yi.hasOwnProperty(Ce)&&re[Ce]&&(yi[Ce]=re[Ce]);return this},_.__private__.setDocumentProperty=function(re,Ce){if(Object.keys(yi).indexOf(re)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return yi[re]=Ce};var Kt,li,Ft,Nr,Qi,ji={},cr={},Yr=[],Ci={},pr={},Ai={},Pi={},er=null,xr=0,tr=[],Vn=new UV(_),Vu=r.hotfixes||[],mo={},Al={},ps=[],zi=function re(Ce,$e,rt,gt,Dt,Wt){if(!(this instanceof re))return new re(Ce,$e,rt,gt,Dt,Wt);isNaN(Ce)&&(Ce=1),isNaN($e)&&($e=0),isNaN(rt)&&(rt=0),isNaN(gt)&&(gt=1),isNaN(Dt)&&(Dt=0),isNaN(Wt)&&(Wt=0),this._matrix=[Ce,$e,rt,gt,Dt,Wt]};Object.defineProperty(zi.prototype,"sx",{get:function(){return this._matrix[0]},set:function(re){this._matrix[0]=re}}),Object.defineProperty(zi.prototype,"shy",{get:function(){return this._matrix[1]},set:function(re){this._matrix[1]=re}}),Object.defineProperty(zi.prototype,"shx",{get:function(){return this._matrix[2]},set:function(re){this._matrix[2]=re}}),Object.defineProperty(zi.prototype,"sy",{get:function(){return this._matrix[3]},set:function(re){this._matrix[3]=re}}),Object.defineProperty(zi.prototype,"tx",{get:function(){return this._matrix[4]},set:function(re){this._matrix[4]=re}}),Object.defineProperty(zi.prototype,"ty",{get:function(){return this._matrix[5]},set:function(re){this._matrix[5]=re}}),Object.defineProperty(zi.prototype,"a",{get:function(){return this._matrix[0]},set:function(re){this._matrix[0]=re}}),Object.defineProperty(zi.prototype,"b",{get:function(){return this._matrix[1]},set:function(re){this._matrix[1]=re}}),Object.defineProperty(zi.prototype,"c",{get:function(){return this._matrix[2]},set:function(re){this._matrix[2]=re}}),Object.defineProperty(zi.prototype,"d",{get:function(){return this._matrix[3]},set:function(re){this._matrix[3]=re}}),Object.defineProperty(zi.prototype,"e",{get:function(){return this._matrix[4]},set:function(re){this._matrix[4]=re}}),Object.defineProperty(zi.prototype,"f",{get:function(){return this._matrix[5]},set:function(re){this._matrix[5]=re}}),Object.defineProperty(zi.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(zi.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(zi.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(zi.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),zi.prototype.join=function(re){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(fe).join(re)},zi.prototype.multiply=function(re){var Ce=re.sx*this.sx+re.shy*this.shx,$e=re.sx*this.shy+re.shy*this.sy,rt=re.shx*this.sx+re.sy*this.shx,gt=re.shx*this.shy+re.sy*this.sy,Dt=re.tx*this.sx+re.ty*this.shx+this.tx,Wt=re.tx*this.shy+re.ty*this.sy+this.ty;return new zi(Ce,$e,rt,gt,Dt,Wt)},zi.prototype.decompose=function(){var re=this.sx,Ce=this.shy,$e=this.shx,rt=this.sy,gt=this.tx,Dt=this.ty,Wt=Math.sqrt(re*re+Ce*Ce),Ni=(re/=Wt)*$e+(Ce/=Wt)*rt;$e-=re*Ni,rt-=Ce*Ni;var Ji=Math.sqrt($e*$e+rt*rt);return Ni/=Ji,re*(rt/=Ji)<Ce*($e/=Ji)&&(re=-re,Ce=-Ce,Ni=-Ni,Wt=-Wt),{scale:new zi(Wt,0,0,Ji,0,0),translate:new zi(1,0,0,1,gt,Dt),rotate:new zi(re,Ce,-Ce,re,0,0),skew:new zi(1,0,Ni,1,0,0)}},zi.prototype.toString=function(re){return this.join(" ")},zi.prototype.inversed=function(){var re=this.sx,Ce=this.shy,$e=this.shx,rt=this.sy,gt=this.tx,Dt=this.ty,Wt=1/(re*rt-Ce*$e),Ni=rt*Wt,Ji=-Ce*Wt,Hr=-$e*Wt,mn=re*Wt;return new zi(Ni,Ji,Hr,mn,-Ni*gt-Hr*Dt,-Ji*gt-mn*Dt)},zi.prototype.applyToPoint=function(re){var Ce=re.x*this.sx+re.y*this.shx+this.tx,$e=re.x*this.shy+re.y*this.sy+this.ty;return new xf(Ce,$e)},zi.prototype.applyToRectangle=function(re){var Ce=this.applyToPoint(re),$e=this.applyToPoint(new xf(re.x+re.w,re.y+re.h));return new $w(Ce.x,Ce.y,$e.x-Ce.x,$e.y-Ce.y)},zi.prototype.clone=function(){var re=this.sx,Ce=this.shy,$e=this.shx,rt=this.sy,gt=this.tx,Dt=this.ty;return new zi(re,Ce,$e,rt,gt,Dt)},_.Matrix=zi;var Cs=_.matrixMult=function(re,Ce){return Ce.multiply(re)},Ml=new zi(1,0,0,1,0,0);_.unitMatrix=_.identityMatrix=Ml;var As=function(re,Ce){if(!pr[re]){var $e=(Ce instanceof yy?"Sh":"P")+(Object.keys(Ci).length+1).toString(10);Ce.id=$e,pr[re]=$e,Ci[$e]=Ce,Vn.publish("addPattern",Ce)}};_.ShadingPattern=yy,_.TilingPattern=dv,_.addShadingPattern=function(re,Ce){return ge("addShadingPattern()"),As(re,Ce),this},_.beginTilingPattern=function(re){ge("beginTilingPattern()"),Ww(re.boundingBox[0],re.boundingBox[1],re.boundingBox[2]-re.boundingBox[0],re.boundingBox[3]-re.boundingBox[1],re.matrix)},_.endTilingPattern=function(re,Ce){ge("endTilingPattern()"),Ce.stream=ht[Ae].join(`
`),As(re,Ce),Vn.publish("endTilingPattern",Ce),ps.pop().restore()};var Un,Pn=_.__private__.newObject=function(){var re=Go();return Il(re,!0),re},Go=_.__private__.newObjectDeferred=function(){return qe++,et[qe]=function(){return mt},qe},Il=function(re,Ce){return Ce=typeof Ce=="boolean"&&Ce,et[re]=mt,Ce&&de(re+" 0 obj"),re},k_=_.__private__.newAdditionalObject=function(){var re={objId:Go(),content:""};return At.push(re),re},zg=Go(),ap=Go(),rm=_.__private__.decodeColorString=function(re){var Ce=re.split(" ");if(Ce.length!==2||Ce[1]!=="g"&&Ce[1]!=="G")Ce.length!==5||Ce[4]!=="k"&&Ce[4]!=="K"||(Ce=[(1-Ce[0])*(1-Ce[3]),(1-Ce[1])*(1-Ce[3]),(1-Ce[2])*(1-Ce[3]),"r"]);else{var $e=parseFloat(Ce[0]);Ce=[$e,$e,$e,"r"]}for(var rt="#",gt=0;gt<3;gt++)rt+=("0"+Math.floor(255*parseFloat(Ce[gt])).toString(16)).slice(-2);return rt},sp=_.__private__.encodeColorString=function(re){var Ce;typeof re=="string"&&(re={ch1:re});var $e=re.ch1,rt=re.ch2,gt=re.ch3,Dt=re.ch4,Wt=re.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof $e=="string"&&$e.charAt(0)!=="#"){var Ni=new lU($e);if(Ni.ok)$e=Ni.toHex();else if(!/^\d*\.?\d*$/.test($e))throw new Error('Invalid color "'+$e+'" passed to jsPDF.encodeColorString.')}if(typeof $e=="string"&&/^#[0-9A-Fa-f]{3}$/.test($e)&&($e="#"+$e[1]+$e[1]+$e[2]+$e[2]+$e[3]+$e[3]),typeof $e=="string"&&/^#[0-9A-Fa-f]{6}$/.test($e)){var Ji=parseInt($e.substr(1),16);$e=Ji>>16&255,rt=Ji>>8&255,gt=255&Ji}if(rt===void 0||Dt===void 0&&$e===rt&&rt===gt)Ce=typeof $e=="string"?$e+" "+Wt[0]:re.precision===2?se($e/255)+" "+Wt[0]:te($e/255)+" "+Wt[0];else if(Dt===void 0||Eo(Dt)==="object"){if(Dt&&!isNaN(Dt.a)&&Dt.a===0)return["1.","1.","1.",Wt[1]].join(" ");Ce=typeof $e=="string"?[$e,rt,gt,Wt[1]].join(" "):re.precision===2?[se($e/255),se(rt/255),se(gt/255),Wt[1]].join(" "):[te($e/255),te(rt/255),te(gt/255),Wt[1]].join(" ")}else Ce=typeof $e=="string"?[$e,rt,gt,Dt,Wt[2]].join(" "):re.precision===2?[se($e),se(rt),se(gt),se(Dt),Wt[2]].join(" "):[te($e),te(rt),te(gt),te(Dt),Wt[2]].join(" ");return Ce},lp=_.__private__.getFilters=function(){return l},gh=_.__private__.putStream=function(re){var Ce=(re=re||{}).data||"",$e=re.filters||lp(),rt=re.alreadyAppliedFilters||[],gt=re.addLength1||!1,Dt=Ce.length,Wt=re.objectId,Ni=function(Tl){return Tl};if(f!==null&&Wt===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");f!==null&&(Ni=El.encryptor(Wt,0));var Ji={};$e===!0&&($e=["FlateEncode"]);var Hr=re.additionalKeyValues||[],mn=(Ji=Ui.API.processDataByFilters!==void 0?Ui.API.processDataByFilters(Ce,$e):{data:Ce,reverseChain:[]}).reverseChain+(Array.isArray(rt)?rt.join(" "):rt.toString());if(Ji.data.length!==0&&(Hr.push({key:"Length",value:Ji.data.length}),gt===!0&&Hr.push({key:"Length1",value:Dt})),mn.length!=0)if(mn.split("/").length-1==1)Hr.push({key:"Filter",value:mn});else{Hr.push({key:"Filter",value:"["+mn+"]"});for(var oo=0;oo<Hr.length;oo+=1)if(Hr[oo].key==="DecodeParms"){for(var ms=[],al=0;al<Ji.reverseChain.split("/").length-1;al+=1)ms.push("null");ms.push(Hr[oo].value),Hr[oo].value="["+ms.join(" ")+"]"}}de("<<");for(var Jo=0;Jo<Hr.length;Jo++)de("/"+Hr[Jo].key+" "+Hr[Jo].value);de(">>"),Ji.data.length!==0&&(de("stream"),de(Ni(Ji.data)),de("endstream"))},O_=_.__private__.putPage=function(re){var Ce=re.number,$e=re.data,rt=re.objId,gt=re.contentsObjId;Il(rt,!0),de("<</Type /Page"),de("/Parent "+re.rootDictionaryObjId+" 0 R"),de("/Resources "+re.resourceDictionaryObjId+" 0 R"),de("/MediaBox ["+parseFloat(fe(re.mediaBox.bottomLeftX))+" "+parseFloat(fe(re.mediaBox.bottomLeftY))+" "+fe(re.mediaBox.topRightX)+" "+fe(re.mediaBox.topRightY)+"]"),re.cropBox!==null&&de("/CropBox ["+fe(re.cropBox.bottomLeftX)+" "+fe(re.cropBox.bottomLeftY)+" "+fe(re.cropBox.topRightX)+" "+fe(re.cropBox.topRightY)+"]"),re.bleedBox!==null&&de("/BleedBox ["+fe(re.bleedBox.bottomLeftX)+" "+fe(re.bleedBox.bottomLeftY)+" "+fe(re.bleedBox.topRightX)+" "+fe(re.bleedBox.topRightY)+"]"),re.trimBox!==null&&de("/TrimBox ["+fe(re.trimBox.bottomLeftX)+" "+fe(re.trimBox.bottomLeftY)+" "+fe(re.trimBox.topRightX)+" "+fe(re.trimBox.topRightY)+"]"),re.artBox!==null&&de("/ArtBox ["+fe(re.artBox.bottomLeftX)+" "+fe(re.artBox.bottomLeftY)+" "+fe(re.artBox.topRightX)+" "+fe(re.artBox.topRightY)+"]"),typeof re.userUnit=="number"&&re.userUnit!==1&&de("/UserUnit "+re.userUnit),Vn.publish("putPage",{objId:rt,pageContext:tr[Ce],pageNumber:Ce,page:$e}),de("/Contents "+gt+" 0 R"),de(">>"),de("endobj");var Dt=$e.join(`
`);return ie===X&&(Dt+=`
Q`),Il(gt,!0),gh({data:Dt,filters:lp(),objectId:gt}),de("endobj"),rt},nm=_.__private__.putPages=function(){var re,Ce,$e=[];for(re=1;re<=xr;re++)tr[re].objId=Go(),tr[re].contentsObjId=Go();for(re=1;re<=xr;re++)$e.push(O_({number:re,data:ht[re],objId:tr[re].objId,contentsObjId:tr[re].contentsObjId,mediaBox:tr[re].mediaBox,cropBox:tr[re].cropBox,bleedBox:tr[re].bleedBox,trimBox:tr[re].trimBox,artBox:tr[re].artBox,userUnit:tr[re].userUnit,rootDictionaryObjId:zg,resourceDictionaryObjId:ap}));Il(zg,!0),de("<</Type /Pages");var rt="/Kids [";for(Ce=0;Ce<xr;Ce++)rt+=$e[Ce]+" 0 R ";de(rt+"]"),de("/Count "+xr),de(">>"),de("endobj"),Vn.publish("postPutPages")},D_=function(re){Vn.publish("putFont",{font:re,out:de,newObject:Pn,putStream:gh}),re.isAlreadyPutted!==!0&&(re.objectNumber=Pn(),de("<<"),de("/Type /Font"),de("/BaseFont /"+uv(re.postScriptName)),de("/Subtype /Type1"),typeof re.encoding=="string"&&de("/Encoding /"+re.encoding),de("/FirstChar 32"),de("/LastChar 255"),de(">>"),de("endobj"))},h1=function(re){re.objectNumber=Pn();var Ce=[];Ce.push({key:"Type",value:"/XObject"}),Ce.push({key:"Subtype",value:"/Form"}),Ce.push({key:"BBox",value:"["+[fe(re.x),fe(re.y),fe(re.x+re.width),fe(re.y+re.height)].join(" ")+"]"}),Ce.push({key:"Matrix",value:"["+re.matrix.toString()+"]"});var $e=re.pages[1].join(`
`);gh({data:$e,additionalKeyValues:Ce,objectId:re.objectNumber}),de("endobj")},p1=function(re,Ce){Ce||(Ce=21);var $e=Pn(),rt=function(Wt,Ni){var Ji,Hr=[],mn=1/(Ni-1);for(Ji=0;Ji<1;Ji+=mn)Hr.push(Ji);if(Hr.push(1),Wt[0].offset!=0){var oo={offset:0,color:Wt[0].color};Wt.unshift(oo)}if(Wt[Wt.length-1].offset!=1){var ms={offset:1,color:Wt[Wt.length-1].color};Wt.push(ms)}for(var al="",Jo=0,Tl=0;Tl<Hr.length;Tl++){for(Ji=Hr[Tl];Ji>Wt[Jo+1].offset;)Jo++;var sl=Wt[Jo].offset,bc=(Ji-sl)/(Wt[Jo+1].offset-sl),Af=Wt[Jo].color,up=Wt[Jo+1].color;al+=Ye(Math.round((1-bc)*Af[0]+bc*up[0]).toString(16))+Ye(Math.round((1-bc)*Af[1]+bc*up[1]).toString(16))+Ye(Math.round((1-bc)*Af[2]+bc*up[2]).toString(16))}return al.trim()}(re.colors,Ce),gt=[];gt.push({key:"FunctionType",value:"0"}),gt.push({key:"Domain",value:"[0.0 1.0]"}),gt.push({key:"Size",value:"["+Ce+"]"}),gt.push({key:"BitsPerSample",value:"8"}),gt.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),gt.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),gh({data:rt,additionalKeyValues:gt,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:$e}),de("endobj"),re.objectNumber=Pn(),de("<< /ShadingType "+re.type),de("/ColorSpace /DeviceRGB");var Dt="/Coords ["+fe(parseFloat(re.coords[0]))+" "+fe(parseFloat(re.coords[1]))+" ";re.type===2?Dt+=fe(parseFloat(re.coords[2]))+" "+fe(parseFloat(re.coords[3])):Dt+=fe(parseFloat(re.coords[2]))+" "+fe(parseFloat(re.coords[3]))+" "+fe(parseFloat(re.coords[4]))+" "+fe(parseFloat(re.coords[5])),de(Dt+="]"),re.matrix&&de("/Matrix ["+re.matrix.toString()+"]"),de("/Function "+$e+" 0 R"),de("/Extend [true true]"),de(">>"),de("endobj")},m1=function(re,Ce){var $e=Go(),rt=Pn();Ce.push({resourcesOid:$e,objectOid:rt}),re.objectNumber=rt;var gt=[];gt.push({key:"Type",value:"/Pattern"}),gt.push({key:"PatternType",value:"1"}),gt.push({key:"PaintType",value:"1"}),gt.push({key:"TilingType",value:"1"}),gt.push({key:"BBox",value:"["+re.boundingBox.map(fe).join(" ")+"]"}),gt.push({key:"XStep",value:fe(re.xStep)}),gt.push({key:"YStep",value:fe(re.yStep)}),gt.push({key:"Resources",value:$e+" 0 R"}),re.matrix&&gt.push({key:"Matrix",value:"["+re.matrix.toString()+"]"}),gh({data:re.stream,additionalKeyValues:gt,objectId:re.objectNumber}),de("endobj")},oF=function(re){for(var Ce in re.objectNumber=Pn(),de("<<"),re)switch(Ce){case"opacity":de("/ca "+se(re[Ce]));break;case"stroke-opacity":de("/CA "+se(re[Ce]))}de(">>"),de("endobj")},Rw=function(re){Il(re.resourcesOid,!0),de("<<"),de("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),function(){for(var Ce in de("/Font <<"),ji)ji.hasOwnProperty(Ce)&&(g===!1||g===!0&&y.hasOwnProperty(Ce))&&de("/"+Ce+" "+ji[Ce].objectNumber+" 0 R");de(">>")}(),function(){if(Object.keys(Ci).length>0){for(var Ce in de("/Shading <<"),Ci)Ci.hasOwnProperty(Ce)&&Ci[Ce]instanceof yy&&Ci[Ce].objectNumber>=0&&de("/"+Ce+" "+Ci[Ce].objectNumber+" 0 R");Vn.publish("putShadingPatternDict"),de(">>")}}(),function(Ce){if(Object.keys(Ci).length>0){for(var $e in de("/Pattern <<"),Ci)Ci.hasOwnProperty($e)&&Ci[$e]instanceof _.TilingPattern&&Ci[$e].objectNumber>=0&&Ci[$e].objectNumber<Ce&&de("/"+$e+" "+Ci[$e].objectNumber+" 0 R");Vn.publish("putTilingPatternDict"),de(">>")}}(re.objectOid),function(){if(Object.keys(Ai).length>0){var Ce;for(Ce in de("/ExtGState <<"),Ai)Ai.hasOwnProperty(Ce)&&Ai[Ce].objectNumber>=0&&de("/"+Ce+" "+Ai[Ce].objectNumber+" 0 R");Vn.publish("putGStateDict"),de(">>")}}(),function(){for(var Ce in de("/XObject <<"),mo)mo.hasOwnProperty(Ce)&&mo[Ce].objectNumber>=0&&de("/"+Ce+" "+mo[Ce].objectNumber+" 0 R");Vn.publish("putXobjectDict"),de(">>")}(),de(">>"),de("endobj")},jC=function(re){cr[re.fontName]=cr[re.fontName]||{},cr[re.fontName][re.fontStyle]=re.id},VC=function(re,Ce,$e,rt,gt){var Dt={id:"F"+(Object.keys(ji).length+1).toString(10),postScriptName:re,fontName:Ce,fontStyle:$e,encoding:rt,isStandardFont:gt||!1,metadata:{}};return Vn.publish("addFont",{font:Dt,instance:this}),ji[Dt.id]=Dt,jC(Dt),Dt.id},_h=_.__private__.pdfEscape=_.pdfEscape=function(re,Ce){return function($e,rt){var gt,Dt,Wt,Ni,Ji,Hr,mn,oo,ms;if(Wt=(rt=rt||{}).sourceEncoding||"Unicode",Ji=rt.outputEncoding,(rt.autoencode||Ji)&&ji[Kt].metadata&&ji[Kt].metadata[Wt]&&ji[Kt].metadata[Wt].encoding&&(Ni=ji[Kt].metadata[Wt].encoding,!Ji&&ji[Kt].encoding&&(Ji=ji[Kt].encoding),!Ji&&Ni.codePages&&(Ji=Ni.codePages[0]),typeof Ji=="string"&&(Ji=Ni[Ji]),Ji)){for(mn=!1,Hr=[],gt=0,Dt=$e.length;gt<Dt;gt++)(oo=Ji[$e.charCodeAt(gt)])?Hr.push(String.fromCharCode(oo)):Hr.push($e[gt]),Hr[gt].charCodeAt(0)>>8&&(mn=!0);$e=Hr.join("")}for(gt=$e.length;mn===void 0&&gt!==0;)$e.charCodeAt(gt-1)>>8&&(mn=!0),gt--;if(!mn)return $e;for(Hr=rt.noBOM?[]:[254,255],gt=0,Dt=$e.length;gt<Dt;gt++){if((ms=(oo=$e.charCodeAt(gt))>>8)>>8)throw new Error("Character at position "+gt+" of string '"+$e+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");Hr.push(ms),Hr.push(oo-(ms<<8))}return String.fromCharCode.apply(void 0,Hr)}(re,Ce).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Nw=_.__private__.beginPage=function(re){ht[++xr]=[],tr[xr]={objId:0,contentsObjId:0,userUnit:Number(h),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(re[0]),topRightY:Number(re[1])}},zC(xr),Je(ht[Ae])},UC=function(re,Ce){var $e,rt,gt;switch(e=Ce||e,typeof re=="string"&&($e=R(re.toLowerCase()),Array.isArray($e)&&(rt=$e[0],gt=$e[1])),Array.isArray(re)&&(rt=re[0]*li,gt=re[1]*li),isNaN(rt)&&(rt=o[0],gt=o[1]),(rt>14400||gt>14400)&&(Xo.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),rt=Math.min(14400,rt),gt=Math.min(14400,gt)),o=[rt,gt],e.substr(0,1)){case"l":gt>rt&&(o=[gt,rt]);break;case"p":rt>gt&&(o=[gt,rt])}Nw(o),Zr(jw),de(y1),Uw!==0&&de(Uw+" J"),zw!==0&&de(zw+" j"),Vn.publish("addPage",{pageNumber:xr})},Bw=function(re){re>0&&re<=xr&&(ht.splice(re,1),tr.splice(re,1),xr--,Ae>xr&&(Ae=xr),this.setPage(Ae))},zC=function(re){re>0&&re<=xr&&(Ae=re)},$C=_.__private__.getNumberOfPages=_.getNumberOfPages=function(){return ht.length-1},WC=function(re,Ce,$e){var rt,gt=void 0;return $e=$e||{},re=re!==void 0?re:ji[Kt].fontName,Ce=Ce!==void 0?Ce:ji[Kt].fontStyle,rt=re.toLowerCase(),cr[rt]!==void 0&&cr[rt][Ce]!==void 0?gt=cr[rt][Ce]:cr[re]!==void 0&&cr[re][Ce]!==void 0?gt=cr[re][Ce]:$e.disableWarning===!1&&Xo.warn("Unable to look up font label for font '"+re+"', '"+Ce+"'. Refer to getFontList() for available fonts."),gt||$e.noFallback||(gt=cr.times[Ce])==null&&(gt=cr.times.normal),gt},om=_.__private__.putInfo=function(){var re=Pn(),Ce=function(rt){return rt};for(var $e in f!==null&&(Ce=El.encryptor(re,0)),de("<<"),de("/Producer ("+_h(Ce("jsPDF "+Ui.version))+")"),yi)yi.hasOwnProperty($e)&&yi[$e]&&de("/"+$e.substr(0,1).toUpperCase()+$e.substr(1)+" ("+_h(Ce(yi[$e]))+")");de("/CreationDate ("+_h(Ce(Ee))+")"),de(">>"),de("endobj")},f1=_.__private__.putCatalog=function(re){var Ce=(re=re||{}).rootDictionaryObjId||zg;switch(Pn(),de("<<"),de("/Type /Catalog"),de("/Pages "+Ce+" 0 R"),ot||(ot="fullwidth"),ot){case"fullwidth":de("/OpenAction [3 0 R /FitH null]");break;case"fullheight":de("/OpenAction [3 0 R /FitV null]");break;case"fullpage":de("/OpenAction [3 0 R /Fit]");break;case"original":de("/OpenAction [3 0 R /XYZ null null 1]");break;default:var $e=""+ot;$e.substr($e.length-1)==="%"&&(ot=parseInt(ot)/100),typeof ot=="number"&&de("/OpenAction [3 0 R /XYZ null null "+se(ot)+"]")}switch(Jt||(Jt="continuous"),Jt){case"continuous":de("/PageLayout /OneColumn");break;case"single":de("/PageLayout /SinglePage");break;case"two":case"twoleft":de("/PageLayout /TwoColumnLeft");break;case"tworight":de("/PageLayout /TwoColumnRight")}St&&de("/PageMode /"+St),Vn.publish("putCatalog"),de(">>"),de("endobj")},aF=_.__private__.putTrailer=function(){de("trailer"),de("<<"),de("/Size "+(qe+1)),de("/Root "+qe+" 0 R"),de("/Info "+(qe-1)+" 0 R"),f!==null&&de("/Encrypt "+El.oid+" 0 R"),de("/ID [ <"+je+"> <"+je+"> ]"),de(">>")},ol=_.__private__.putHeader=function(){de("%PDF-"+w),de("%\xBA\xDF\xAC\xE0")},HC=_.__private__.putXRef=function(){var re="0000000000";de("xref"),de("0 "+(qe+1)),de("0000000000 65535 f ");for(var Ce=1;Ce<=qe;Ce++)typeof et[Ce]=="function"?de((re+et[Ce]()).slice(-10)+" 00000 n "):et[Ce]!==void 0?de((re+et[Ce]).slice(-10)+" 00000 n "):de("0000000000 00000 n ")},am=_.__private__.buildDocument=function(){var re;qe=0,mt=0,ft=[],et=[],At=[],zg=Go(),ap=Go(),Je(ft),Vn.publish("buildDocument"),ol(),nm(),function(){Vn.publish("putAdditionalObjects");for(var $e=0;$e<At.length;$e++){var rt=At[$e];Il(rt.objId,!0),de(rt.content),de("endobj")}Vn.publish("postPutAdditionalObjects")}(),re=[],function(){for(var $e in ji)ji.hasOwnProperty($e)&&(g===!1||g===!0&&y.hasOwnProperty($e))&&D_(ji[$e])}(),function(){var $e;for($e in Ai)Ai.hasOwnProperty($e)&&oF(Ai[$e])}(),function(){for(var $e in mo)mo.hasOwnProperty($e)&&h1(mo[$e])}(),function($e){var rt;for(rt in Ci)Ci.hasOwnProperty(rt)&&(Ci[rt]instanceof yy?p1(Ci[rt]):Ci[rt]instanceof dv&&m1(Ci[rt],$e))}(re),Vn.publish("putResources"),re.forEach(Rw),Rw({resourcesOid:ap,objectOid:Number.MAX_SAFE_INTEGER}),Vn.publish("postPutResources"),f!==null&&(El.oid=Pn(),de("<<"),de("/Filter /Standard"),de("/V "+El.v),de("/R "+El.r),de("/U <"+El.toHexString(El.U)+">"),de("/O <"+El.toHexString(El.O)+">"),de("/P "+El.P),de(">>"),de("endobj")),om(),f1();var Ce=mt;return HC(),aF(),de("startxref"),de(""+Ce),de("%%EOF"),Je(ht[Ae]),ft.join(`
`)},g1=_.__private__.getBlob=function(re){return new Blob([Ze(re)],{type:"application/pdf"})},qC=_.output=_.__private__.output=(Un=function(re,Ce){switch(typeof(Ce=Ce||{})=="string"?Ce={filename:Ce}:Ce.filename=Ce.filename||"generated.pdf",re){case void 0:return am();case"save":_.save(Ce.filename);break;case"arraybuffer":return Ze(am());case"blob":return g1(am());case"bloburi":case"bloburl":if(Wr.URL!==void 0&&typeof Wr.URL.createObjectURL=="function")return Wr.URL&&Wr.URL.createObjectURL(g1(am()))||void 0;Xo.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var $e="",rt=am();try{$e=GV(rt)}catch{$e=GV(unescape(encodeURIComponent(rt)))}return"data:application/pdf;filename="+Ce.filename+";base64,"+$e;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Wr)==="[object Window]"){var gt="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Dt=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';Ce.pdfObjectUrl&&(gt=Ce.pdfObjectUrl,Dt="");var Wt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+gt+'"'+Dt+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(Ce)+");<\/script></body></html>",Ni=Wr.open();return Ni!==null&&Ni.document.write(Wt),Ni}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Wr)==="[object Window]"){var Ji='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(Ce.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+Ce.filename+'" width="500px" height="400px" /></body></html>',Hr=Wr.open();if(Hr!==null){Hr.document.write(Ji);var mn=this;Hr.document.documentElement.querySelector("#pdfViewer").onload=function(){Hr.document.title=Ce.filename,Hr.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(mn.output("bloburl"))}}return Hr}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Wr)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var oo='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",Ce)+'"></iframe></body></html>',ms=Wr.open();if(ms!==null&&(ms.document.write(oo),ms.document.title=Ce.filename),ms||typeof safari>"u")return ms;break;case"datauri":case"dataurl":return Wr.document.location.href=this.output("datauristring",Ce);default:return null}},Un.foo=function(){try{return Un.apply(this,arguments)}catch($e){var re=$e.stack||"";~re.indexOf(" at ")&&(re=re.split(" at ")[1]);var Ce="Error in function "+re.split(`
`)[0].split("<")[0]+": "+$e.message;if(!Wr.console)throw new Error(Ce);Wr.console.error(Ce,$e),Wr.alert&&alert(Ce)}},Un.foo.bar=Un,Un.foo),yh=function(re){return Array.isArray(Vu)===!0&&Vu.indexOf(re)>-1};switch(n){case"pt":li=1;break;case"mm":li=72/25.4;break;case"cm":li=72/2.54;break;case"in":li=72;break;case"px":li=yh("px_scaling")==1?.75:96/72;break;case"pc":case"em":li=12;break;case"ex":li=6;break;default:if(typeof n!="number")throw new Error("Invalid unit: "+n);li=n}var El=null;He(),ze();var yf=_.__private__.getPageInfo=_.getPageInfo=function(re){if(isNaN(re)||re%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:tr[re].objId,pageNumber:re,pageContext:tr[re]}},YC=_.__private__.getPageInfoByObjId=function(re){if(isNaN(re)||re%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var Ce in tr)if(tr[Ce].objId===re)break;return yf(Ce)},sF=_.__private__.getCurrentPageInfo=_.getCurrentPageInfo=function(){return{objId:tr[Ae].objId,pageNumber:Ae,pageContext:tr[Ae]}};_.addPage=function(){return UC.apply(this,arguments),this},_.setPage=function(){return zC.apply(this,arguments),Je.call(this,ht[Ae]),this},_.insertPage=function(re){return this.addPage(),this.movePage(Ae,re),this},_.movePage=function(re,Ce){var $e,rt;if(re>Ce){$e=ht[re],rt=tr[re];for(var gt=re;gt>Ce;gt--)ht[gt]=ht[gt-1],tr[gt]=tr[gt-1];ht[Ce]=$e,tr[Ce]=rt,this.setPage(Ce)}else if(re<Ce){$e=ht[re],rt=tr[re];for(var Dt=re;Dt<Ce;Dt++)ht[Dt]=ht[Dt+1],tr[Dt]=tr[Dt+1];ht[Ce]=$e,tr[Ce]=rt,this.setPage(Ce)}return this},_.deletePage=function(){return Bw.apply(this,arguments),this},_.__private__.text=_.text=function(re,Ce,$e,rt,gt){var Dt,Wt,Ni,Ji,Hr,mn,oo,ms,al,Jo=(rt=rt||{}).scope||this;if(typeof re=="number"&&typeof Ce=="number"&&(typeof $e=="string"||Array.isArray($e))){var Tl=$e;$e=Ce,Ce=re,re=Tl}if(arguments[3]instanceof zi==0?(Ni=arguments[4],Ji=arguments[5],Eo(oo=arguments[3])==="object"&&oo!==null||(typeof Ni=="string"&&(Ji=Ni,Ni=null),typeof oo=="string"&&(Ji=oo,oo=null),typeof oo=="number"&&(Ni=oo,oo=null),rt={flags:oo,angle:Ni,align:Ji})):(ge("The transform parameter of text() with a Matrix value"),al=gt),isNaN(Ce)||isNaN($e)||re==null)throw new Error("Invalid arguments passed to jsPDF.text");if(re.length===0)return Jo;var sl,bc="",Af=typeof rt.lineHeightFactor=="number"?rt.lineHeightFactor:N_,up=Jo.internal.scaleFactor;function Mf(Co){return Co=Co.split("	").join(Array(rt.TabLen||9).join(" ")),_h(Co,oo)}function qw(Co){for(var Yo,zs=Co.concat(),Fl=[],Tf=zs.length;Tf--;)typeof(Yo=zs.shift())=="string"?Fl.push(Yo):Array.isArray(Co)&&(Yo.length===1||Yo[1]===void 0&&Yo[2]===void 0)?Fl.push(Yo[0]):Fl.push([Yo[0],Yo[1],Yo[2]]);return Fl}function b1(Co,Yo){var zs;if(typeof Co=="string")zs=Yo(Co)[0];else if(Array.isArray(Co)){for(var Fl,Tf,rx=Co.concat(),S1=[],oA=rx.length;oA--;)typeof(Fl=rx.shift())=="string"?S1.push(Yo(Fl)[0]):Array.isArray(Fl)&&typeof Fl[0]=="string"&&(Tf=Yo(Fl[0],Fl[1],Fl[2]),S1.push([Tf[0],Tf[1],Tf[2]]));zs=S1}return zs}var $g=!1,V_=!0;if(typeof re=="string")$g=!0;else if(Array.isArray(re)){var U_=re.concat();Wt=[];for(var Wg,wc=U_.length;wc--;)(typeof(Wg=U_.shift())!="string"||Array.isArray(Wg)&&typeof Wg[0]!="string")&&(V_=!1);$g=V_}if($g===!1)throw new Error('Type of text must be string or Array. "'+re+'" is not recognized.');typeof re=="string"&&(re=re.match(/[\r?\n]/)?re.split(/\r\n|\r|\n/g):[re]);var z_=tt/Jo.internal.scaleFactor,$_=z_*(Af-1);switch(rt.baseline){case"bottom":$e-=$_;break;case"top":$e+=z_-$_;break;case"hanging":$e+=z_-2*$_;break;case"middle":$e+=z_/2-$_}if((mn=rt.maxWidth||0)>0&&(typeof re=="string"?re=Jo.splitTextToSize(re,mn):Object.prototype.toString.call(re)==="[object Array]"&&(re=re.reduce(function(Co,Yo){return Co.concat(Jo.splitTextToSize(Yo,mn))},[]))),Dt={text:re,x:Ce,y:$e,options:rt,mutex:{pdfEscape:_h,activeFontKey:Kt,fonts:ji,activeFontSize:tt}},Vn.publish("preProcessText",Dt),re=Dt.text,Ni=(rt=Dt.options).angle,al instanceof zi==0&&Ni&&typeof Ni=="number"){Ni*=Math.PI/180,rt.rotationDirection===0&&(Ni=-Ni),ie===X&&(Ni=-Ni);var Yw=Math.cos(Ni),Zw=Math.sin(Ni);al=new zi(Yw,Zw,-Zw,Yw,0,0)}else Ni&&Ni instanceof zi&&(al=Ni);ie!==X||al||(al=Ml),(Hr=rt.charSpace||wf)!==void 0&&(bc+=fe(Se(Hr))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(ms=rt.horizontalScale)!==void 0&&(bc+=fe(100*ms)+` Tz
`),rt.lang;var gu=-1,If=rt.renderingMode!==void 0?rt.renderingMode:rt.stroke,w1=Jo.internal.getCurrentPageInfo().pageContext;switch(If){case 0:case!1:case"fill":gu=0;break;case 1:case!0:case"stroke":gu=1;break;case 2:case"fillThenStroke":gu=2;break;case 3:case"invisible":gu=3;break;case 4:case"fillAndAddForClipping":gu=4;break;case 5:case"strokeAndAddPathForClipping":gu=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":gu=6;break;case 7:case"addToPathForClipping":gu=7}var rA=w1.usedRenderingMode!==void 0?w1.usedRenderingMode:-1;gu!==-1?bc+=gu+` Tr
`:rA!==-1&&(bc+=`0 Tr
`),gu!==-1&&(w1.usedRenderingMode=gu),Ji=rt.align||"left";var vh,W_=tt*Af,Xw=Jo.internal.pageSize.getWidth(),Kw=ji[Kt];Hr=rt.charSpace||wf,mn=rt.maxWidth||0,oo=Object.assign({autoencode:!0,noBOM:!0},rt.flags);var Hg=[],H_=function(Co){return Jo.getStringUnitWidth(Co,{font:Kw,charSpace:Hr,fontSize:tt,doKerning:!1})*tt/up};if(Object.prototype.toString.call(re)==="[object Array]"){var Fd;Wt=qw(re),Ji!=="left"&&(vh=Wt.map(H_));var Pd,qg=0;if(Ji==="right"){Ce-=vh[0],re=[],wc=Wt.length;for(var Ef=0;Ef<wc;Ef++)Ef===0?(Pd=vf(Ce),Fd=bf($e)):(Pd=Se(qg-vh[Ef]),Fd=-W_),re.push([Wt[Ef],Pd,Fd]),qg=vh[Ef]}else if(Ji==="center"){Ce-=vh[0]/2,re=[],wc=Wt.length;for(var Yg=0;Yg<wc;Yg++)Yg===0?(Pd=vf(Ce),Fd=bf($e)):(Pd=Se((qg-vh[Yg])/2),Fd=-W_),re.push([Wt[Yg],Pd,Fd]),qg=vh[Yg]}else if(Ji==="left"){re=[],wc=Wt.length;for(var Qw=0;Qw<wc;Qw++)re.push(Wt[Qw])}else if(Ji==="justify"&&Kw.encoding==="Identity-H"){re=[],wc=Wt.length,mn=mn!==0?mn:Xw;for(var x1=0,Us=0;Us<wc;Us++)if(Fd=Us===0?bf($e):-W_,Pd=Us===0?vf(Ce):x1,Us<wc-1){var nA=Se((mn-vh[Us])/(Wt[Us].split(" ").length-1)),lm=Wt[Us].split(" ");re.push([lm[0]+" ",Pd,Fd]),x1=0;for(var cm=1;cm<lm.length;cm++){var Jw=(H_(lm[cm-1]+" "+lm[cm])-H_(lm[cm]))*up+nA;cm==lm.length-1?re.push([lm[cm],Jw,0]):re.push([lm[cm]+" ",Jw,0]),x1-=Jw}}else re.push([Wt[Us],Pd,Fd]);re.push(["",x1,0])}else{if(Ji!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(re=[],wc=Wt.length,mn=mn!==0?mn:Xw,Us=0;Us<wc;Us++){Fd=Us===0?bf($e):-W_,Pd=Us===0?vf(Ce):0;var ex=Wt[Us].split(" ").length-1,tx=ex>0?(mn-vh[Us])/ex:0;Us<wc-1?Hg.push(fe(Se(tx))):Hg.push(0),re.push([Wt[Us],Pd,Fd])}}}(typeof rt.R2L=="boolean"?rt.R2L:Mt)===!0&&(re=b1(re,function(Co,Yo,zs){return[Co.split("").reverse().join(""),Yo,zs]})),Dt={text:re,x:Ce,y:$e,options:rt,mutex:{pdfEscape:_h,activeFontKey:Kt,fonts:ji,activeFontSize:tt}},Vn.publish("postProcessText",Dt),re=Dt.text,sl=Dt.mutex.isHex||!1;var ix=ji[Kt].encoding;ix!=="WinAnsiEncoding"&&ix!=="StandardEncoding"||(re=b1(re,function(Co,Yo,zs){return[Mf(Co),Yo,zs]})),Wt=qw(re),re=[];for(var Zg,Xg,Kg,q_=Array.isArray(Wt[0])?1:0,Qg="",Y_=function(Co,Yo,zs){var Fl="";return zs instanceof zi?(zs=typeof rt.angle=="number"?Cs(zs,new zi(1,0,0,1,Co,Yo)):Cs(new zi(1,0,0,1,Co,Yo),zs),ie===X&&(zs=Cs(new zi(1,0,0,-1,0,0),zs)),Fl=zs.join(" ")+` Tm
`):Fl=fe(Co)+" "+fe(Yo)+` Td
`,Fl},bh=0;bh<Wt.length;bh++){switch(Qg="",q_){case 1:Kg=(sl?"<":"(")+Wt[bh][0]+(sl?">":")"),Zg=parseFloat(Wt[bh][1]),Xg=parseFloat(Wt[bh][2]);break;case 0:Kg=(sl?"<":"(")+Wt[bh]+(sl?">":")"),Zg=vf(Ce),Xg=bf($e)}Hg!==void 0&&Hg[bh]!==void 0&&(Qg=Hg[bh]+` Tw
`),bh===0?re.push(Qg+Y_(Zg,Xg,al)+Kg):q_===0?re.push(Qg+Kg):q_===1&&re.push(Qg+Y_(Zg,Xg,al)+Kg)}re=q_===0?re.join(` Tj
T* `):re.join(` Tj
`),re+=` Tj
`;var um=`BT
/`;return um+=Kt+" "+tt+` Tf
`,um+=fe(tt*Af)+` TL
`,um+=B_+`
`,um+=bc,um+=re,de(um+="ET"),y[Kt]=!0,Jo};var lF=_.__private__.clip=_.clip=function(re){return de(re==="evenodd"?"W*":"W"),this};_.clipEvenOdd=function(){return lF("evenodd")},_.__private__.discardPath=_.discardPath=function(){return de("n"),this};var sm=_.__private__.isValidStyle=function(re){var Ce=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(re)!==-1&&(Ce=!0),Ce};_.__private__.setDefaultPathOperation=_.setDefaultPathOperation=function(re){return sm(re)&&(m=re),this};var ZC=_.__private__.getStyle=_.getStyle=function(re){var Ce=m;switch(re){case"D":case"S":Ce="S";break;case"F":Ce="f";break;case"FD":case"DF":Ce="B";break;case"f":case"f*":case"B":case"B*":Ce=re}return Ce},XC=_.close=function(){return de("h"),this};_.stroke=function(){return de("S"),this},_.fill=function(re){return _1("f",re),this},_.fillEvenOdd=function(re){return _1("f*",re),this},_.fillStroke=function(re){return _1("B",re),this},_.fillStrokeEvenOdd=function(re){return _1("B*",re),this};var _1=function(re,Ce){Eo(Ce)==="object"?uF(Ce,re):de(re)},R_=function(re){re===null||ie===X&&re===void 0||(re=ZC(re),de(re))};function cF(re,Ce,$e,rt,gt){var Dt=new dv(Ce||this.boundingBox,$e||this.xStep,rt||this.yStep,this.gState,gt||this.matrix);Dt.stream=this.stream;var Wt=re+"$$"+this.cloneIndex+++"$$";return As(Wt,Dt),Dt}var uF=function(re,Ce){var $e=pr[re.key],rt=Ci[$e];if(rt instanceof yy)de("q"),de(dF(Ce)),rt.gState&&_.setGState(rt.gState),de(re.matrix.toString()+" cm"),de("/"+$e+" sh"),de("Q");else if(rt instanceof dv){var gt=new zi(1,0,0,-1,0,j_());re.matrix&&(gt=gt.multiply(re.matrix||Ml),$e=cF.call(rt,re.key,re.boundingBox,re.xStep,re.yStep,gt).id),de("q"),de("/Pattern cs"),de("/"+$e+" scn"),rt.gState&&_.setGState(rt.gState),de(Ce),de("Q")}},dF=function(re){switch(re){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},Gw=_.moveTo=function(re,Ce){return de(fe(Se(re))+" "+fe(Te(Ce))+" m"),this},KC=_.lineTo=function(re,Ce){return de(fe(Se(re))+" "+fe(Te(Ce))+" l"),this},cp=_.curveTo=function(re,Ce,$e,rt,gt,Dt){return de([fe(Se(re)),fe(Te(Ce)),fe(Se($e)),fe(Te(rt)),fe(Se(gt)),fe(Te(Dt)),"c"].join(" ")),this};_.__private__.line=_.line=function(re,Ce,$e,rt,gt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||isNaN(rt)||!sm(gt))throw new Error("Invalid arguments passed to jsPDF.line");return ie===q?this.lines([[$e-re,rt-Ce]],re,Ce,[1,1],gt||"S"):this.lines([[$e-re,rt-Ce]],re,Ce,[1,1]).stroke()},_.__private__.lines=_.lines=function(re,Ce,$e,rt,gt,Dt){var Wt,Ni,Ji,Hr,mn,oo,ms,al,Jo,Tl,sl,bc;if(typeof re=="number"&&(bc=$e,$e=Ce,Ce=re,re=bc),rt=rt||[1,1],Dt=Dt||!1,isNaN(Ce)||isNaN($e)||!Array.isArray(re)||!Array.isArray(rt)||!sm(gt)||typeof Dt!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(Gw(Ce,$e),Wt=rt[0],Ni=rt[1],Hr=re.length,Tl=Ce,sl=$e,Ji=0;Ji<Hr;Ji++)(mn=re[Ji]).length===2?(Tl=mn[0]*Wt+Tl,sl=mn[1]*Ni+sl,KC(Tl,sl)):(oo=mn[0]*Wt+Tl,ms=mn[1]*Ni+sl,al=mn[2]*Wt+Tl,Jo=mn[3]*Ni+sl,Tl=mn[4]*Wt+Tl,sl=mn[5]*Ni+sl,cp(oo,ms,al,Jo,Tl,sl));return Dt&&XC(),R_(gt),this},_.path=function(re){for(var Ce=0;Ce<re.length;Ce++){var $e=re[Ce],rt=$e.c;switch($e.op){case"m":Gw(rt[0],rt[1]);break;case"l":KC(rt[0],rt[1]);break;case"c":cp.apply(this,rt);break;case"h":XC()}}return this},_.__private__.rect=_.rect=function(re,Ce,$e,rt,gt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||isNaN(rt)||!sm(gt))throw new Error("Invalid arguments passed to jsPDF.rect");return ie===q&&(rt=-rt),de([fe(Se(re)),fe(Te(Ce)),fe(Se($e)),fe(Se(rt)),"re"].join(" ")),R_(gt),this},_.__private__.triangle=_.triangle=function(re,Ce,$e,rt,gt,Dt,Wt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||isNaN(rt)||isNaN(gt)||isNaN(Dt)||!sm(Wt))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[$e-re,rt-Ce],[gt-$e,Dt-rt],[re-gt,Ce-Dt]],re,Ce,[1,1],Wt,!0),this},_.__private__.roundedRect=_.roundedRect=function(re,Ce,$e,rt,gt,Dt,Wt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||isNaN(rt)||isNaN(gt)||isNaN(Dt)||!sm(Wt))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Ni=4/3*(Math.SQRT2-1);return gt=Math.min(gt,.5*$e),Dt=Math.min(Dt,.5*rt),this.lines([[$e-2*gt,0],[gt*Ni,0,gt,Dt-Dt*Ni,gt,Dt],[0,rt-2*Dt],[0,Dt*Ni,-gt*Ni,Dt,-gt,Dt],[2*gt-$e,0],[-gt*Ni,0,-gt,-Dt*Ni,-gt,-Dt],[0,2*Dt-rt],[0,-Dt*Ni,gt*Ni,-Dt,gt,-Dt]],re+gt,Ce,[1,1],Wt,!0),this},_.__private__.ellipse=_.ellipse=function(re,Ce,$e,rt,gt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||isNaN(rt)||!sm(gt))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Dt=4/3*(Math.SQRT2-1)*$e,Wt=4/3*(Math.SQRT2-1)*rt;return Gw(re+$e,Ce),cp(re+$e,Ce-Wt,re+Dt,Ce-rt,re,Ce-rt),cp(re-Dt,Ce-rt,re-$e,Ce-Wt,re-$e,Ce),cp(re-$e,Ce+Wt,re-Dt,Ce+rt,re,Ce+rt),cp(re+Dt,Ce+rt,re+$e,Ce+Wt,re+$e,Ce),R_(gt),this},_.__private__.circle=_.circle=function(re,Ce,$e,rt){if(isNaN(re)||isNaN(Ce)||isNaN($e)||!sm(rt))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(re,Ce,$e,$e,rt)},_.setFont=function(re,Ce,$e){return $e&&(Ce=me(Ce,$e)),Kt=WC(re,Ce,{disableWarning:!1}),this};var hF=_.__private__.getFont=_.getFont=function(){return ji[WC.apply(_,arguments)]};_.__private__.getFontList=_.getFontList=function(){var re,Ce,$e={};for(re in cr)if(cr.hasOwnProperty(re))for(Ce in $e[re]=[],cr[re])cr[re].hasOwnProperty(Ce)&&$e[re].push(Ce);return $e},_.addFont=function(re,Ce,$e,rt,gt){var Dt=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Dt.indexOf(arguments[3])!==-1?gt=arguments[3]:arguments[3]&&Dt.indexOf(arguments[3])==-1&&($e=me($e,rt)),VC.call(this,re,Ce,$e,gt=gt||"Identity-H")};var N_,jw=r.lineWidth||.200025,pF=_.__private__.getLineWidth=_.getLineWidth=function(){return jw},Zr=_.__private__.setLineWidth=_.setLineWidth=function(re){return jw=re,de(fe(Se(re))+" w"),this};_.__private__.setLineDash=Ui.API.setLineDash=Ui.API.setLineDashPattern=function(re,Ce){if(re=re||[],Ce=Ce||0,isNaN(Ce)||!Array.isArray(re))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return re=re.map(function($e){return fe(Se($e))}).join(" "),Ce=fe(Se(Ce)),de("["+re+"] "+Ce+" d"),this};var mF=_.__private__.getLineHeight=_.getLineHeight=function(){return tt*N_};_.__private__.getLineHeight=_.getLineHeight=function(){return tt*N_};var fF=_.__private__.setLineHeightFactor=_.setLineHeightFactor=function(re){return typeof(re=re||1.15)=="number"&&(N_=re),this},gF=_.__private__.getLineHeightFactor=_.getLineHeightFactor=function(){return N_};fF(r.lineHeight);var vf=_.__private__.getHorizontalCoordinate=function(re){return Se(re)},bf=_.__private__.getVerticalCoordinate=function(re){return ie===X?re:tr[Ae].mediaBox.topRightY-tr[Ae].mediaBox.bottomLeftY-Se(re)},_F=_.__private__.getHorizontalCoordinateString=_.getHorizontalCoordinateString=function(re){return fe(vf(re))},yF=_.__private__.getVerticalCoordinateString=_.getVerticalCoordinateString=function(re){return fe(bf(re))},y1=r.strokeColor||"0 G";_.__private__.getStrokeColor=_.getDrawColor=function(){return rm(y1)},_.__private__.setStrokeColor=_.setDrawColor=function(re,Ce,$e,rt){return y1=sp({ch1:re,ch2:Ce,ch3:$e,ch4:rt,pdfColorType:"draw",precision:2}),de(y1),this};var Vw=r.fillColor||"0 g";_.__private__.getFillColor=_.getFillColor=function(){return rm(Vw)},_.__private__.setFillColor=_.setFillColor=function(re,Ce,$e,rt){return Vw=sp({ch1:re,ch2:Ce,ch3:$e,ch4:rt,pdfColorType:"fill",precision:2}),de(Vw),this};var B_=r.textColor||"0 g",vF=_.__private__.getTextColor=_.getTextColor=function(){return rm(B_)};_.__private__.setTextColor=_.setTextColor=function(re,Ce,$e,rt){return B_=sp({ch1:re,ch2:Ce,ch3:$e,ch4:rt,pdfColorType:"text",precision:3}),this};var wf=r.charSpace,bF=_.__private__.getCharSpace=_.getCharSpace=function(){return parseFloat(wf||0)};_.__private__.setCharSpace=_.setCharSpace=function(re){if(isNaN(re))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return wf=re,this};var Uw=0;_.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},_.__private__.setLineCap=_.setLineCap=function(re){var Ce=_.CapJoinStyles[re];if(Ce===void 0)throw new Error("Line cap style of '"+re+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Uw=Ce,de(Ce+" J"),this};var zw=0;_.__private__.setLineJoin=_.setLineJoin=function(re){var Ce=_.CapJoinStyles[re];if(Ce===void 0)throw new Error("Line join style of '"+re+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return zw=Ce,de(Ce+" j"),this},_.__private__.setLineMiterLimit=_.__private__.setMiterLimit=_.setLineMiterLimit=_.setMiterLimit=function(re){if(re=re||0,isNaN(re))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return de(fe(Se(re))+" M"),this},_.GState=HM,_.setGState=function(re){(re=typeof re=="string"?Ai[Pi[re]]:QC(null,re)).equals(er)||(de("/"+re.id+" gs"),er=re)};var QC=function(re,Ce){if(!re||!Pi[re]){var $e=!1;for(var rt in Ai)if(Ai.hasOwnProperty(rt)&&Ai[rt].equals(Ce)){$e=!0;break}if($e)Ce=Ai[rt];else{var gt="GS"+(Object.keys(Ai).length+1).toString(10);Ai[gt]=Ce,Ce.id=gt}return re&&(Pi[re]=Ce.id),Vn.publish("addGState",Ce),Ce}};_.addGState=function(re,Ce){return QC(re,Ce),this},_.saveGraphicsState=function(){return de("q"),Yr.push({key:Kt,size:tt,color:B_}),this},_.restoreGraphicsState=function(){de("Q");var re=Yr.pop();return Kt=re.key,tt=re.size,B_=re.color,er=null,this},_.setCurrentTransformationMatrix=function(re){return de(re.toString()+" cm"),this},_.comment=function(re){return de("#"+re),this};var xf=function(re,Ce){var $e=re||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return $e},set:function(Dt){isNaN(Dt)||($e=parseFloat(Dt))}});var rt=Ce||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return rt},set:function(Dt){isNaN(Dt)||(rt=parseFloat(Dt))}});var gt="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return gt},set:function(Dt){gt=Dt.toString()}}),this},$w=function(re,Ce,$e,rt){xf.call(this,re,Ce),this.type="rect";var gt=$e||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return gt},set:function(Wt){isNaN(Wt)||(gt=parseFloat(Wt))}});var Dt=rt||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Dt},set:function(Wt){isNaN(Wt)||(Dt=parseFloat(Wt))}}),this},v1=function(){this.page=xr,this.currentPage=Ae,this.pages=ht.slice(0),this.pagesContext=tr.slice(0),this.x=Ft,this.y=Nr,this.matrix=Qi,this.width=Hw(Ae),this.height=eA(Ae),this.outputDestination=st,this.id="",this.objectNumber=-1};v1.prototype.restore=function(){xr=this.page,Ae=this.currentPage,tr=this.pagesContext,ht=this.pages,Ft=this.x,Nr=this.y,Qi=this.matrix,JC(Ae,this.width),Sf(Ae,this.height),st=this.outputDestination};var Ww=function(re,Ce,$e,rt,gt){ps.push(new v1),xr=Ae=0,ht=[],Ft=re,Nr=Ce,Qi=gt,Nw([$e,rt])};for(var G_ in _.beginFormObject=function(re,Ce,$e,rt,gt){return Ww(re,Ce,$e,rt,gt),this},_.endFormObject=function(re){return function(Ce){if(Al[Ce])ps.pop().restore();else{var $e=new v1,rt="Xo"+(Object.keys(mo).length+1).toString(10);$e.id=rt,Al[Ce]=rt,mo[rt]=$e,Vn.publish("addFormObject",$e),ps.pop().restore()}}(re),this},_.doFormObject=function(re,Ce){var $e=mo[Al[re]];return de("q"),de(Ce.toString()+" cm"),de("/"+$e.id+" Do"),de("Q"),this},_.getFormObject=function(re){var Ce=mo[Al[re]];return{x:Ce.x,y:Ce.y,width:Ce.width,height:Ce.height,matrix:Ce.matrix}},_.save=function(re,Ce){return re=re||"generated.pdf",(Ce=Ce||{}).returnPromise=Ce.returnPromise||!1,Ce.returnPromise===!1?(_y(g1(am()),re),typeof _y.unload=="function"&&Wr.setTimeout&&setTimeout(_y.unload,911),this):new Promise(function($e,rt){try{var gt=_y(g1(am()),re);typeof _y.unload=="function"&&Wr.setTimeout&&setTimeout(_y.unload,911),$e(gt)}catch(Dt){rt(Dt.message)}})},Ui.API)Ui.API.hasOwnProperty(G_)&&(G_==="events"&&Ui.API.events.length?function(re,Ce){var $e,rt,gt;for(gt=Ce.length-1;gt!==-1;gt--)$e=Ce[gt][0],rt=Ce[gt][1],re.subscribe.apply(re,[$e].concat(typeof rt=="function"?[rt]:rt))}(Vn,Ui.API.events):_[G_]=Ui.API[G_]);function Hw(re){return tr[re].mediaBox.topRightX-tr[re].mediaBox.bottomLeftX}function JC(re,Ce){tr[re].mediaBox.topRightX=Ce+tr[re].mediaBox.bottomLeftX}function eA(re){return tr[re].mediaBox.topRightY-tr[re].mediaBox.bottomLeftY}function Sf(re,Ce){tr[re].mediaBox.topRightY=Ce+tr[re].mediaBox.bottomLeftY}var Cf=_.getPageWidth=function(re){return Hw(re=re||Ae)/li},tA=_.setPageWidth=function(re,Ce){JC(re,Ce*li)},j_=_.getPageHeight=function(re){return eA(re=re||Ae)/li},iA=_.setPageHeight=function(re,Ce){Sf(re,Ce*li)};return _.internal={pdfEscape:_h,getStyle:ZC,getFont:hF,getFontSize:wt,getCharSpace:bF,getTextColor:vF,getLineHeight:mF,getLineHeightFactor:gF,getLineWidth:pF,write:ke,getHorizontalCoordinate:vf,getVerticalCoordinate:bf,getCoordinateString:_F,getVerticalCoordinateString:yF,collections:{},newObject:Pn,newAdditionalObject:k_,newObjectDeferred:Go,newObjectDeferredBegin:Il,getFilters:lp,putStream:gh,events:Vn,scaleFactor:li,pageSize:{getWidth:function(){return Cf(Ae)},setWidth:function(re){tA(Ae,re)},getHeight:function(){return j_(Ae)},setHeight:function(re){iA(Ae,re)}},encryptionOptions:f,encryption:El,getEncryptor:function(re){return f!==null?El.encryptor(re,0):function(Ce){return Ce}},output:qC,getNumberOfPages:$C,get pages(){return ht},out:de,f2:se,f3:te,getPageInfo:yf,getPageInfoByObjId:YC,getCurrentPageInfo:sF,getPDFVersion:A,Point:xf,Rectangle:$w,Matrix:zi,hasHotfix:yh},Object.defineProperty(_.internal.pageSize,"width",{get:function(){return Cf(Ae)},set:function(re){tA(Ae,re)},enumerable:!0,configurable:!0}),Object.defineProperty(_.internal.pageSize,"height",{get:function(){return j_(Ae)},set:function(re){iA(Ae,re)},enumerable:!0,configurable:!0}),function(re){for(var Ce=0,$e=vt.length;Ce<$e;Ce++){var rt=VC.call(this,re[Ce][0],re[Ce][1],re[Ce][2],vt[Ce][3],!0);g===!1&&(y[rt]=!0);var gt=re[Ce][0].split("-");jC({id:rt,fontName:gt[0],fontStyle:gt[1]||""})}Vn.publish("addFonts",{fonts:ji,dictionary:cr})}.call(_,vt),Kt="F1",UC(o,e),Vn.publish("initialized"),_}cv.prototype.lsbFirstWord=function(r){return String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255)},cv.prototype.toHexString=function(r){return r.split("").map(function(i){return("0"+(255&i.charCodeAt(0)).toString(16)).slice(-2)}).join("")},cv.prototype.hexToBytes=function(r){for(var i=[],e=0;e<r.length;e+=2)i.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return i.join("")},cv.prototype.processOwnerPassword=function(r,i){return TL(EL(i).substr(0,5),r)},cv.prototype.encryptor=function(r,i){var e=EL(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&i,i>>8&255)).substr(0,10);return function(n){return TL(e,n)}},HM.prototype.equals=function(r){var i,e="id,objectNumber,equals";if(!r||Eo(r)!==Eo(this))return!1;var n=0;for(i in this)if(!(e.indexOf(i)>=0)){if(this.hasOwnProperty(i)&&!r.hasOwnProperty(i)||this[i]!==r[i])return!1;n++}for(i in r)r.hasOwnProperty(i)&&e.indexOf(i)<0&&n--;return n===0},Ui.API={events:[]},Ui.version="3.0.4";var Rs=Ui.API,LL=1,by=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},sv=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},nn=function(r){return r.toFixed(2)},I0=function(r){return r.toFixed(5)};Rs.__acroform__={};var ld=function(r,i){r.prototype=Object.create(i.prototype),r.prototype.constructor=r},zV=function(r){return r*LL},Fm=function(r){var i=new hU,e=Ri.internal.getHeight(r)||0,n=Ri.internal.getWidth(r)||0;return i.BBox=[0,0,Number(nn(n)),Number(nn(e))],i},Iae=Rs.__acroform__.setBit=function(r,i){if(r=r||0,i=i||0,isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|1<<i},Eae=Rs.__acroform__.clearBit=function(r,i){if(r=r||0,i=i||0,isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&~(1<<i)},Tae=Rs.__acroform__.getBit=function(r,i){if(isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<i?1:0},Ks=Rs.__acroform__.getBitForPdf=function(r,i){if(isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return Tae(r,i-1)},Qs=Rs.__acroform__.setBitForPdf=function(r,i){if(isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Iae(r,i-1)},Js=Rs.__acroform__.clearBitForPdf=function(r,i){if(isNaN(r)||isNaN(i))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return Eae(r,i-1)},Fae=Rs.__acroform__.calculateCoordinates=function(r,i){var e=i.internal.getHorizontalCoordinate,n=i.internal.getVerticalCoordinate,o=r[0],s=r[1],l=r[2],h=r[3],p={};return p.lowerLeft_X=e(o)||0,p.lowerLeft_Y=n(s+h)||0,p.upperRight_X=e(o+l)||0,p.upperRight_Y=n(s)||0,[Number(nn(p.lowerLeft_X)),Number(nn(p.lowerLeft_Y)),Number(nn(p.upperRight_X)),Number(nn(p.upperRight_Y))]},Pae=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var i=[],e=r._V||r.DV,n=FL(r,e),o=r.scope.internal.getFont(r.fontName,r.fontStyle).id;i.push("/Tx BMC"),i.push("q"),i.push("BT"),i.push(r.scope.__private__.encodeColorString(r.color)),i.push("/"+o+" "+nn(n.fontSize)+" Tf"),i.push("1 0 0 1 0 0 Tm"),i.push(n.text),i.push("ET"),i.push("Q"),i.push("EMC");var s=Fm(r);return s.scope=r.scope,s.stream=i.join(`
`),s}},FL=function(r,i){var e=r.fontSize===0?r.maxFontSize:r.fontSize,n={text:"",fontSize:""},o=(i=(i=i.substr(0,1)=="("?i.substr(1):i).substr(i.length-1)==")"?i.substr(0,i.length-1):i).split(" ");o=r.multiline?o.map(function(se){return se.split(`
`)}):o.map(function(se){return[se]});var s=e,l=Ri.internal.getHeight(r)||0;l=l<0?-l:l;var h=Ri.internal.getWidth(r)||0;h=h<0?-h:h;var p=function(se,te,Se){if(se+1<o.length){var Te=te+" "+o[se+1][0];return BM(Te,r,Se).width<=h-4}return!1};s++;e:for(;s>0;){i="",s--;var m,f,g=BM("3",r,s).height,y=r.multiline?l-s:(l-g)/2,_=y+=2,w=0,A=0,k=0;if(s<=0){i=`(...) Tj
`,i+="% Width of Text: "+BM(i,r,s=12).width+", FieldWidth:"+h+`
`;break}for(var R="",q=0,X=0;X<o.length;X++)if(o.hasOwnProperty(X)){var ie=!1;if(o[X].length!==1&&k!==o[X].length-1){if((g+2)*(q+2)+2>l)continue e;R+=o[X][k],ie=!0,A=X,X--}else{R=(R+=o[X][k]+" ").substr(R.length-1)==" "?R.substr(0,R.length-1):R;var ae=parseInt(X),be=p(ae,R,s),me=X>=o.length-1;if(be&&!me){R+=" ",k=0;continue}if(be||me){if(me)A=ae;else if(r.multiline&&(g+2)*(q+2)+2>l)continue e}else{if(!r.multiline||(g+2)*(q+2)+2>l)continue e;A=ae}}for(var fe="",ge=w;ge<=A;ge++){var ue=o[ge];if(r.multiline){if(ge===A){fe+=ue[k]+" ",k=(k+1)%ue.length;continue}if(ge===w){fe+=ue[ue.length-1]+" ";continue}}fe+=ue[0]+" "}switch(fe=fe.substr(fe.length-1)==" "?fe.substr(0,fe.length-1):fe,f=BM(fe,r,s).width,r.textAlign){case"right":m=h-f-2;break;case"center":m=(h-f)/2;break;default:m=2}i+=nn(m)+" "+nn(_)+` Td
`,i+="("+by(fe)+`) Tj
`,i+=-nn(m)+` 0 Td
`,_=-(s+2),f=0,w=ie?A:A+1,q++,R=""}break}return n.text=i,n.fontSize=s,n},BM=function(r,i,e){var n=i.scope.internal.getFont(i.fontName,i.fontStyle),o=i.scope.getStringUnitWidth(r,{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:i.scope.getStringUnitWidth("3",{font:n,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:o}},Lae={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},kae=function(r,i){var e={type:"reference",object:r};i.internal.getPageInfo(r.page).pageContext.annotations.find(function(n){return n.type===e.type&&n.object===e.object})===void 0&&i.internal.getPageInfo(r.page).pageContext.annotations.push(e)},Oae=function(r,i){if(i.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(xp.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(Lae)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");LL=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new pU,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var n=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];s.objId=void 0,s.hasAnnotation&&kae(s,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(n,o){var s=!n;for(var l in n||(o.internal.newObjectDeferredBegin(o.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),o.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),n=n||o.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(n.hasOwnProperty(l)){var h=n[l],p=[],m=h.Rect;if(h.Rect&&(h.Rect=Fae(h.Rect,o)),o.internal.newObjectDeferredBegin(h.objId,!0),h.DA=Ri.createDefaultAppearanceStream(h),Eo(h)==="object"&&typeof h.getKeyValueListForStream=="function"&&(p=h.getKeyValueListForStream()),h.Rect=m,h.hasAppearanceStream&&!h.appearanceStreamContent){var f=Pae(h);p.push({key:"AP",value:"<</N "+f+">>"}),o.internal.acroformPlugin.xForms.push(f)}if(h.appearanceStreamContent){var g="";for(var y in h.appearanceStreamContent)if(h.appearanceStreamContent.hasOwnProperty(y)){var _=h.appearanceStreamContent[y];if(g+="/"+y+" ",g+="<<",Object.keys(_).length>=1||Array.isArray(_)){for(var l in _)if(_.hasOwnProperty(l)){var w=_[l];typeof w=="function"&&(w=w.call(o,h)),g+="/"+l+" "+w+" ",o.internal.acroformPlugin.xForms.indexOf(w)>=0||o.internal.acroformPlugin.xForms.push(w)}}else typeof(w=_)=="function"&&(w=w.call(o,h)),g+="/"+l+" "+w,o.internal.acroformPlugin.xForms.indexOf(w)>=0||o.internal.acroformPlugin.xForms.push(w);g+=">>"}p.push({key:"AP",value:`<<
`+g+">>"})}o.internal.putStream({additionalKeyValues:p,objectId:h.objId}),o.internal.out("endobj")}s&&function(A,k){for(var R in A)if(A.hasOwnProperty(R)){var q=R,X=A[R];k.internal.newObjectDeferredBegin(X.objId,!0),Eo(X)==="object"&&typeof X.putStream=="function"&&X.putStream(),delete A[q]}}(o.internal.acroformPlugin.xForms,o)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},dU=Rs.__acroform__.arrayToPdfArray=function(r,i,e){var n=function(l){return l};if(Array.isArray(r)){for(var o="[",s=0;s<r.length;s++)switch(s!==0&&(o+=" "),Eo(r[s])){case"boolean":case"number":case"object":o+=r[s].toString();break;case"string":r[s].substr(0,1)!=="/"?(i!==void 0&&e&&(n=e.internal.getEncryptor(i)),o+="("+by(n(r[s].toString()))+")"):o+=r[s].toString()}return o+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},SL=function(r,i,e){var n=function(o){return o};return i!==void 0&&e&&(n=e.internal.getEncryptor(i)),(r=r||"").toString(),"("+by(n(r))+")"},Pm=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Pm.prototype.toString=function(){return this.objId+" 0 R"},Pm.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},Pm.prototype.getKeyValueListForStream=function(){var r=[],i=Object.getOwnPropertyNames(this).filter(function(s){return s!="content"&&s!="appearanceStreamContent"&&s!="scope"&&s!="objId"&&s.substring(0,1)!="_"});for(var e in i)if(Object.getOwnPropertyDescriptor(this,i[e]).configurable===!1){var n=i[e],o=this[n];o&&(Array.isArray(o)?r.push({key:n,value:dU(o,this.objId,this.scope)}):o instanceof Pm?(o.scope=this.scope,r.push({key:n,value:o.objId+" 0 R"})):typeof o!="function"&&r.push({key:n,value:o}))}return r};var hU=function(){Pm.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,i=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return i},set:function(e){i=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};ld(hU,Pm);var pU=function(){Pm.call(this);var r,i=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return i.length>0?i:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return i}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(n){return n};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+by(e(r))+")"}},set:function(e){r=e}})};ld(pU,Pm);var xp=function r(){Pm.call(this);var i=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return i},set:function(R){if(isNaN(R))throw new Error('Invalid value "'+R+'" for attribute F supplied.');i=R}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!Ks(i,3)},set:function(R){R?this.F=Qs(i,3):this.F=Js(i,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(R){if(isNaN(R))throw new Error('Invalid value "'+R+'" for attribute Ff supplied.');e=R}});var n=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(n.length!==0)return n},set:function(R){n=R!==void 0?R:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[0])?0:n[0]},set:function(R){n[0]=R}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[1])?0:n[1]},set:function(R){n[1]=R}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[2])?0:n[2]},set:function(R){n[2]=R}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!n||isNaN(n[3])?0:n[3]},set:function(R){n[3]=R}});var o="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return o},set:function(R){switch(R){case"/Btn":case"/Tx":case"/Ch":case"/Sig":o=R;break;default:throw new Error('Invalid value "'+R+'" for attribute FT supplied.')}}});var s=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!s||s.length<1){if(this instanceof qM)return;s="FieldObject"+r.FieldNum++}var R=function(q){return q};return this.scope&&(R=this.scope.internal.getEncryptor(this.objId)),"("+by(R(s))+")"},set:function(R){s=R.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return s},set:function(R){s=R}});var l="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return l},set:function(R){l=R}});var h="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return h},set:function(R){h=R}});var p=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return p},set:function(R){p=R}});var m=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return m===void 0?50/LL:m},set:function(R){m=R}});var f="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return f},set:function(R){f=R}});var g="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!g||this instanceof qM||this instanceof vy))return SL(g,this.objId,this.scope)},set:function(R){R=R.toString(),g=R}});var y=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(y)return this instanceof hc==0?SL(y,this.objId,this.scope):y},set:function(R){R=R.toString(),y=this instanceof hc==0?R.substr(0,1)==="("?sv(R.substr(1,R.length-2)):sv(R):R}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof hc==1?sv(y.substr(1,y.length-1)):y},set:function(R){R=R.toString(),y=this instanceof hc==1?"/"+R:R}});var _=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(_)return _},set:function(R){this.V=R}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(_)return this instanceof hc==0?SL(_,this.objId,this.scope):_},set:function(R){R=R.toString(),_=this instanceof hc==0?R.substr(0,1)==="("?sv(R.substr(1,R.length-2)):sv(R):R}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof hc==1?sv(_.substr(1,_.length-1)):_},set:function(R){R=R.toString(),_=this instanceof hc==1?"/"+R:R}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var w,A=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return A},set:function(R){R=!!R,A=R}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(w)return w},set:function(R){w=R}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,1)},set:function(R){R?this.Ff=Qs(this.Ff,1):this.Ff=Js(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,2)},set:function(R){R?this.Ff=Qs(this.Ff,2):this.Ff=Js(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,3)},set:function(R){R?this.Ff=Qs(this.Ff,3):this.Ff=Js(this.Ff,3)}});var k=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(k!==null)return k},set:function(R){if([0,1,2].indexOf(R)===-1)throw new Error('Invalid value "'+R+'" for attribute Q supplied.');k=R}}),Object.defineProperty(this,"textAlign",{get:function(){var R;switch(k){case 0:default:R="left";break;case 1:R="center";break;case 2:R="right"}return R},configurable:!0,enumerable:!0,set:function(R){switch(R){case"right":case 2:k=2;break;case"center":case 1:k=1;break;default:k=0}}})};ld(xp,Pm);var hv=function(){xp.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var i=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return dU(i,this.objId,this.scope)},set:function(e){var n,o;o=[],typeof(n=e)=="string"&&(o=function(s,l,h){h||(h=1);for(var p,m=[];p=l.exec(s);)m.push(p[h]);return m}(n,/\((.*?)\)/g)),i=o}}),this.getOptions=function(){return i},this.setOptions=function(e){i=e,this.sort&&i.sort()},this.addOption=function(e){e=(e=e||"").toString(),i.push(e),this.sort&&i.sort()},this.removeOption=function(e,n){for(n=n||!1,e=(e=e||"").toString();i.indexOf(e)!==-1&&(i.splice(i.indexOf(e),1),n!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,18)},set:function(e){e?this.Ff=Qs(this.Ff,18):this.Ff=Js(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=Qs(this.Ff,19):this.Ff=Js(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,20)},set:function(e){e?(this.Ff=Qs(this.Ff,20),i.sort()):this.Ff=Js(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,22)},set:function(e){e?this.Ff=Qs(this.Ff,22):this.Ff=Js(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,23)},set:function(e){e?this.Ff=Qs(this.Ff,23):this.Ff=Js(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,27)},set:function(e){e?this.Ff=Qs(this.Ff,27):this.Ff=Js(this.Ff,27)}}),this.hasAppearanceStream=!1};ld(hv,xp);var pv=function(){hv.call(this),this.fontName="helvetica",this.combo=!1};ld(pv,hv);var mv=function(){pv.call(this),this.combo=!0};ld(mv,pv);var UM=function(){mv.call(this),this.edit=!0};ld(UM,mv);var hc=function(){xp.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,15)},set:function(e){e?this.Ff=Qs(this.Ff,15):this.Ff=Js(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,16)},set:function(e){e?this.Ff=Qs(this.Ff,16):this.Ff=Js(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,17)},set:function(e){e?this.Ff=Qs(this.Ff,17):this.Ff=Js(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,26)},set:function(e){e?this.Ff=Qs(this.Ff,26):this.Ff=Js(this.Ff,26)}});var r,i={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(s){return s};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(i).length!==0){var n,o=[];for(n in o.push("<<"),i)o.push("/"+n+" ("+by(e(i[n]))+")");return o.push(">>"),o.join(`
`)}},set:function(e){Eo(e)==="object"&&(i=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return i.CA||""},set:function(e){typeof e=="string"&&(i.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};ld(hc,xp);var zM=function(){hc.call(this),this.pushButton=!0};ld(zM,hc);var fv=function(){hc.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(i){r=i!==void 0?i:[]}})};ld(fv,hc);var qM=function(){var r,i;xp.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(o){r=o}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return i},set:function(o){i=o}});var e,n={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var o=function(h){return h};this.scope&&(o=this.scope.internal.getEncryptor(this.objId));var s,l=[];for(s in l.push("<<"),n)l.push("/"+s+" ("+by(o(n[s]))+")");return l.push(">>"),l.join(`
`)},set:function(o){Eo(o)==="object"&&(n=o)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return n.CA||""},set:function(o){typeof o=="string"&&(n.CA=o)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(o){e=o}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(o){e="/"+o}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Ri.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ld(qM,xp),fv.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var i in this.Kids)if(this.Kids.hasOwnProperty(i)){var e=this.Kids[i];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},fv.prototype.createOption=function(r){var i=new qM;return i.Parent=this,i.optionName=r,this.Kids.push(i),Dae.call(this.scope,i),i};var $M=function(){hc.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Ri.CheckBox.createAppearanceStream()};ld($M,hc);var vy=function(){xp.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,13)},set:function(i){i?this.Ff=Qs(this.Ff,13):this.Ff=Js(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,21)},set:function(i){i?this.Ff=Qs(this.Ff,21):this.Ff=Js(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,23)},set:function(i){i?this.Ff=Qs(this.Ff,23):this.Ff=Js(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,24)},set:function(i){i?this.Ff=Qs(this.Ff,24):this.Ff=Js(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,25)},set:function(i){i?this.Ff=Qs(this.Ff,25):this.Ff=Js(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,26)},set:function(i){i?this.Ff=Qs(this.Ff,26):this.Ff=Js(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(i){Number.isInteger(i)&&(r=i)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ld(vy,xp);var WM=function(){vy.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!Ks(this.Ff,14)},set:function(r){r?this.Ff=Qs(this.Ff,14):this.Ff=Js(this.Ff,14)}}),this.password=!0};ld(WM,vy);var Ri={CheckBox:{createAppearanceStream:function(){return{N:{On:Ri.CheckBox.YesNormal},D:{On:Ri.CheckBox.YesPushDown,Off:Ri.CheckBox.OffPushDown}}},YesPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=[],n=r.scope.internal.getFont(r.fontName,r.fontStyle).id,o=r.scope.__private__.encodeColorString(r.color),s=FL(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+nn(Ri.internal.getWidth(r))+" "+nn(Ri.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+n+" "+nn(s.fontSize)+" Tf "+o),e.push("BT"),e.push(s.text),e.push("ET"),e.push("Q"),e.push("EMC"),i.stream=e.join(`
`),i},YesNormal:function(r){var i=Fm(r);i.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,n=r.scope.__private__.encodeColorString(r.color),o=[],s=Ri.internal.getHeight(r),l=Ri.internal.getWidth(r),h=FL(r,r.caption);return o.push("1 g"),o.push("0 0 "+nn(l)+" "+nn(s)+" re"),o.push("f"),o.push("q"),o.push("0 0 1 rg"),o.push("0 0 "+nn(l-1)+" "+nn(s-1)+" re"),o.push("W"),o.push("n"),o.push("0 g"),o.push("BT"),o.push("/"+e+" "+nn(h.fontSize)+" Tf "+n),o.push(h.text),o.push("ET"),o.push("Q"),i.stream=o.join(`
`),i},OffPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+nn(Ri.internal.getWidth(r))+" "+nn(Ri.internal.getHeight(r))+" re"),e.push("f"),i.stream=e.join(`
`),i}},RadioButton:{Circle:{createAppearanceStream:function(r){var i={D:{Off:Ri.RadioButton.Circle.OffPushDown},N:{}};return i.N[r]=Ri.RadioButton.Circle.YesNormal,i.D[r]=Ri.RadioButton.Circle.YesPushDown,i},getCA:function(){return"l"},YesNormal:function(r){var i=Fm(r);i.scope=r.scope;var e=[],n=Ri.internal.getWidth(r)<=Ri.internal.getHeight(r)?Ri.internal.getWidth(r)/4:Ri.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var o=Ri.internal.Bezier_C,s=Number((n*o).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+I0(Ri.internal.getWidth(r)/2)+" "+I0(Ri.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+s+" "+s+" "+n+" 0 "+n+" c"),e.push("-"+s+" "+n+" -"+n+" "+s+" -"+n+" 0 c"),e.push("-"+n+" -"+s+" -"+s+" -"+n+" 0 -"+n+" c"),e.push(s+" -"+n+" "+n+" -"+s+" "+n+" 0 c"),e.push("f"),e.push("Q"),i.stream=e.join(`
`),i},YesPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=[],n=Ri.internal.getWidth(r)<=Ri.internal.getHeight(r)?Ri.internal.getWidth(r)/4:Ri.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var o=Number((2*n).toFixed(5)),s=Number((o*Ri.internal.Bezier_C).toFixed(5)),l=Number((n*Ri.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+I0(Ri.internal.getWidth(r)/2)+" "+I0(Ri.internal.getHeight(r)/2)+" cm"),e.push(o+" 0 m"),e.push(o+" "+s+" "+s+" "+o+" 0 "+o+" c"),e.push("-"+s+" "+o+" -"+o+" "+s+" -"+o+" 0 c"),e.push("-"+o+" -"+s+" -"+s+" -"+o+" 0 -"+o+" c"),e.push(s+" -"+o+" "+o+" -"+s+" "+o+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+I0(Ri.internal.getWidth(r)/2)+" "+I0(Ri.internal.getHeight(r)/2)+" cm"),e.push(n+" 0 m"),e.push(n+" "+l+" "+l+" "+n+" 0 "+n+" c"),e.push("-"+l+" "+n+" -"+n+" "+l+" -"+n+" 0 c"),e.push("-"+n+" -"+l+" -"+l+" -"+n+" 0 -"+n+" c"),e.push(l+" -"+n+" "+n+" -"+l+" "+n+" 0 c"),e.push("f"),e.push("Q"),i.stream=e.join(`
`),i},OffPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=[],n=Ri.internal.getWidth(r)<=Ri.internal.getHeight(r)?Ri.internal.getWidth(r)/4:Ri.internal.getHeight(r)/4;n=Number((.9*n).toFixed(5));var o=Number((2*n).toFixed(5)),s=Number((o*Ri.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+I0(Ri.internal.getWidth(r)/2)+" "+I0(Ri.internal.getHeight(r)/2)+" cm"),e.push(o+" 0 m"),e.push(o+" "+s+" "+s+" "+o+" 0 "+o+" c"),e.push("-"+s+" "+o+" -"+o+" "+s+" -"+o+" 0 c"),e.push("-"+o+" -"+s+" -"+s+" -"+o+" 0 -"+o+" c"),e.push(s+" -"+o+" "+o+" -"+s+" "+o+" 0 c"),e.push("f"),e.push("Q"),i.stream=e.join(`
`),i}},Cross:{createAppearanceStream:function(r){var i={D:{Off:Ri.RadioButton.Cross.OffPushDown},N:{}};return i.N[r]=Ri.RadioButton.Cross.YesNormal,i.D[r]=Ri.RadioButton.Cross.YesPushDown,i},getCA:function(){return"8"},YesNormal:function(r){var i=Fm(r);i.scope=r.scope;var e=[],n=Ri.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+nn(Ri.internal.getWidth(r)-2)+" "+nn(Ri.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(nn(n.x1.x)+" "+nn(n.x1.y)+" m"),e.push(nn(n.x2.x)+" "+nn(n.x2.y)+" l"),e.push(nn(n.x4.x)+" "+nn(n.x4.y)+" m"),e.push(nn(n.x3.x)+" "+nn(n.x3.y)+" l"),e.push("s"),e.push("Q"),i.stream=e.join(`
`),i},YesPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=Ri.internal.calculateCross(r),n=[];return n.push("0.749023 g"),n.push("0 0 "+nn(Ri.internal.getWidth(r))+" "+nn(Ri.internal.getHeight(r))+" re"),n.push("f"),n.push("q"),n.push("1 1 "+nn(Ri.internal.getWidth(r)-2)+" "+nn(Ri.internal.getHeight(r)-2)+" re"),n.push("W"),n.push("n"),n.push(nn(e.x1.x)+" "+nn(e.x1.y)+" m"),n.push(nn(e.x2.x)+" "+nn(e.x2.y)+" l"),n.push(nn(e.x4.x)+" "+nn(e.x4.y)+" m"),n.push(nn(e.x3.x)+" "+nn(e.x3.y)+" l"),n.push("s"),n.push("Q"),i.stream=n.join(`
`),i},OffPushDown:function(r){var i=Fm(r);i.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+nn(Ri.internal.getWidth(r))+" "+nn(Ri.internal.getHeight(r))+" re"),e.push("f"),i.stream=e.join(`
`),i}}},createDefaultAppearanceStream:function(r){var i=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+i+" "+r.fontSize+" Tf "+e}};Ri.internal={Bezier_C:.551915024494,calculateCross:function(r){var i=Ri.internal.getWidth(r),e=Ri.internal.getHeight(r),n=Math.min(i,e);return{x1:{x:(i-n)/2,y:(e-n)/2+n},x2:{x:(i-n)/2+n,y:(e-n)/2},x3:{x:(i-n)/2,y:(e-n)/2},x4:{x:(i-n)/2+n,y:(e-n)/2+n}}}},Ri.internal.getWidth=function(r){var i=0;return Eo(r)==="object"&&(i=zV(r.Rect[2])),i},Ri.internal.getHeight=function(r){var i=0;return Eo(r)==="object"&&(i=zV(r.Rect[3])),i};var Dae=Rs.addField=function(r){if(Oae(this,r),!(r instanceof xp))throw new Error("Invalid argument passed to jsPDF.addField.");var i;return(i=r).scope.internal.acroformPlugin.printedOut&&(i.scope.internal.acroformPlugin.printedOut=!1,i.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),i.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(i),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};Rs.AcroFormChoiceField=hv,Rs.AcroFormListBox=pv,Rs.AcroFormComboBox=mv,Rs.AcroFormEditBox=UM,Rs.AcroFormButton=hc,Rs.AcroFormPushButton=zM,Rs.AcroFormRadioButton=fv,Rs.AcroFormCheckBox=$M,Rs.AcroFormTextField=vy,Rs.AcroFormPasswordField=WM,Rs.AcroFormAppearance=Ri,Rs.AcroForm={ChoiceField:hv,ListBox:pv,ComboBox:mv,EditBox:UM,Button:hc,PushButton:zM,RadioButton:fv,CheckBox:$M,TextField:vy,PasswordField:WM,Appearance:Ri},Ui.AcroForm={ChoiceField:hv,ListBox:pv,ComboBox:mv,EditBox:UM,Button:hc,PushButton:zM,RadioButton:fv,CheckBox:$M,TextField:vy,PasswordField:WM,Appearance:Ri};var rOe=Ui.AcroForm;function mU(r){return r.reduce(function(i,e,n){return i[e]=n,i},{})}(function(r){var i="addImage_";r.__addimage__={};var e="UNKNOWN",n={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},o=r.__addimage__.getImageFileTypeByImageData=function(se,te){var Se,Te,Ee,je,Ne,ze=e;if((te=te||e)==="RGBA"||se.data!==void 0&&se.data instanceof Uint8ClampedArray&&"height"in se&&"width"in se)return"RGBA";if(be(se))for(Ne in n)for(Ee=n[Ne],Se=0;Se<Ee.length;Se+=1){for(je=!0,Te=0;Te<Ee[Se].length;Te+=1)if(Ee[Se][Te]!==void 0&&Ee[Se][Te]!==se[Te]){je=!1;break}if(je===!0){ze=Ne;break}}else for(Ne in n)for(Ee=n[Ne],Se=0;Se<Ee.length;Se+=1){for(je=!0,Te=0;Te<Ee[Se].length;Te+=1)if(Ee[Se][Te]!==void 0&&Ee[Se][Te]!==se.charCodeAt(Te)){je=!1;break}if(je===!0){ze=Ne;break}}return ze===e&&te!==e&&(ze=te),ze},s=function se(te){for(var Se=this.internal.write,Te=this.internal.putStream,Ee=(0,this.internal.getFilters)();Ee.indexOf("FlateEncode")!==-1;)Ee.splice(Ee.indexOf("FlateEncode"),1);te.objectId=this.internal.newObject();var je=[];if(je.push({key:"Type",value:"/XObject"}),je.push({key:"Subtype",value:"/Image"}),je.push({key:"Width",value:te.width}),je.push({key:"Height",value:te.height}),te.colorSpace===R.INDEXED?je.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(te.palette.length/3-1)+" "+("sMask"in te&&te.sMask!==void 0?te.objectId+2:te.objectId+1)+" 0 R]"}):(je.push({key:"ColorSpace",value:"/"+te.colorSpace}),te.colorSpace===R.DEVICE_CMYK&&je.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),je.push({key:"BitsPerComponent",value:te.bitsPerComponent}),"decodeParameters"in te&&te.decodeParameters!==void 0&&je.push({key:"DecodeParms",value:"<<"+te.decodeParameters+">>"}),"transparency"in te&&Array.isArray(te.transparency)&&te.transparency.length>0){for(var Ne="",ze=0,Re=te.transparency.length;ze<Re;ze++)Ne+=te.transparency[ze]+" "+te.transparency[ze]+" ";je.push({key:"Mask",value:"["+Ne+"]"})}te.sMask!==void 0&&je.push({key:"SMask",value:te.objectId+1+" 0 R"});var Ge=te.filter!==void 0?["/"+te.filter]:void 0;if(Te({data:te.data,additionalKeyValues:je,alreadyAppliedFilters:Ge,objectId:te.objectId}),Se("endobj"),"sMask"in te&&te.sMask!==void 0){var He,ye=(He=te.sMaskBitsPerComponent)!==null&&He!==void 0?He:te.bitsPerComponent,Ae={width:te.width,height:te.height,colorSpace:"DeviceGray",bitsPerComponent:ye,data:te.sMask};"filter"in te&&(Ae.decodeParameters="/Predictor ".concat(te.predictor," /Colors 1 /BitsPerComponent ").concat(ye," /Columns ").concat(te.width),Ae.filter=te.filter),se.call(this,Ae)}if(te.colorSpace===R.INDEXED){var Le=this.internal.newObject();Te({data:fe(new Uint8Array(te.palette)),objectId:Le}),Se("endobj")}},l=function(){var se=this.internal.collections[i+"images"];for(var te in se)s.call(this,se[te])},h=function(){var se,te=this.internal.collections[i+"images"],Se=this.internal.write;for(var Te in te)Se("/I"+(se=te[Te]).index,se.objectId,"0","R")},p=function(){this.internal.collections[i+"images"]||(this.internal.collections[i+"images"]={},this.internal.events.subscribe("putResources",l),this.internal.events.subscribe("putXobjectDict",h))},m=function(){var se=this.internal.collections[i+"images"];return p.call(this),se},f=function(){return Object.keys(this.internal.collections[i+"images"]).length},g=function(se){return typeof r["process"+se.toUpperCase()]=="function"},y=function(se){return Eo(se)==="object"&&se.nodeType===1},_=function(se,te){if(se.nodeName==="IMG"&&se.hasAttribute("src")){var Se=""+se.getAttribute("src");if(Se.indexOf("data:image/")===0)return VM(unescape(Se).split("base64,").pop());var Te=r.loadFile(Se,!0);if(Te!==void 0)return Te}if(se.nodeName==="CANVAS"){if(se.width===0||se.height===0)throw new Error("Given canvas must have data. Canvas width: "+se.width+", height: "+se.height);var Ee;switch(te){case"PNG":Ee="image/png";break;case"WEBP":Ee="image/webp";break;default:Ee="image/jpeg"}return VM(se.toDataURL(Ee,1).split("base64,").pop())}},w=function(se){var te=this.internal.collections[i+"images"];if(te){for(var Se in te)if(se===te[Se].alias)return te[Se]}},A=function(se,te,Se){return se||te||(se=-96,te=-96),se<0&&(se=-1*Se.width*72/se/this.internal.scaleFactor),te<0&&(te=-1*Se.height*72/te/this.internal.scaleFactor),se===0&&(se=te*Se.width/Se.height),te===0&&(te=se*Se.height/Se.width),[se,te]},k=function(se,te,Se,Te,Ee,je){var Ne=A.call(this,Se,Te,Ee),ze=this.internal.getCoordinateString,Re=this.internal.getVerticalCoordinateString,Ge=m.call(this);if(Se=Ne[0],Te=Ne[1],Ge[Ee.index]=Ee,je){je*=Math.PI/180;var He=Math.cos(je),ye=Math.sin(je),Ae=function(Ye){return Ye.toFixed(4)},Le=[Ae(He),Ae(ye),Ae(-1*ye),Ae(He),0,0,"cm"]}this.internal.write("q"),je?(this.internal.write([1,"0","0",1,ze(se),Re(te+Te),"cm"].join(" ")),this.internal.write(Le.join(" ")),this.internal.write([ze(Se),"0","0",ze(Te),"0","0","cm"].join(" "))):this.internal.write([ze(Se),"0","0",ze(Te),ze(se),Re(te+Te),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+Ee.index+" Do"),this.internal.write("Q")},R=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var q=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},X=r.__addimage__.sHashCode=function(se){var te,Se,Te=0;if(typeof se=="string")for(Se=se.length,te=0;te<Se;te++)Te=(Te<<5)-Te+se.charCodeAt(te),Te|=0;else if(be(se))for(Se=se.byteLength/2,te=0;te<Se;te++)Te=(Te<<5)-Te+se[te],Te|=0;return Te},ie=r.__addimage__.validateStringAsBase64=function(se){(se=se||"").toString().trim();var te=!0;return se.length===0&&(te=!1),se.length%4!=0&&(te=!1),/^[A-Za-z0-9+/]+$/.test(se.substr(0,se.length-2))===!1&&(te=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(se.substr(-2))===!1&&(te=!1),te},ae=r.__addimage__.extractImageFromDataUrl=function(se){if(se==null||!(se=se.trim()).startsWith("data:"))return null;var te=se.indexOf(",");return te<0?null:se.substring(0,te).trim().endsWith("base64")?se.substring(te+1):null};r.__addimage__.isArrayBuffer=function(se){return se instanceof ArrayBuffer};var be=r.__addimage__.isArrayBufferView=function(se){return se instanceof Int8Array||se instanceof Uint8Array||se instanceof Uint8ClampedArray||se instanceof Int16Array||se instanceof Uint16Array||se instanceof Int32Array||se instanceof Uint32Array||se instanceof Float32Array||se instanceof Float64Array},me=r.__addimage__.binaryStringToUint8Array=function(se){for(var te=se.length,Se=new Uint8Array(te),Te=0;Te<te;Te++)Se[Te]=se.charCodeAt(Te);return Se},fe=r.__addimage__.arrayBufferToBinaryString=function(se){for(var te="",Se=be(se)?se:new Uint8Array(se),Te=0;Te<Se.length;Te+=8192)te+=String.fromCharCode.apply(null,Se.subarray(Te,Te+8192));return te};r.addImage=function(){var se,te,Se,Te,Ee,je,Ne,ze,Re;if(typeof arguments[1]=="number"?(te=e,Se=arguments[1],Te=arguments[2],Ee=arguments[3],je=arguments[4],Ne=arguments[5],ze=arguments[6],Re=arguments[7]):(te=arguments[1],Se=arguments[2],Te=arguments[3],Ee=arguments[4],je=arguments[5],Ne=arguments[6],ze=arguments[7],Re=arguments[8]),Eo(se=arguments[0])==="object"&&!y(se)&&"imageData"in se){var Ge=se;se=Ge.imageData,te=Ge.format||te||e,Se=Ge.x||Se||0,Te=Ge.y||Te||0,Ee=Ge.w||Ge.width||Ee,je=Ge.h||Ge.height||je,Ne=Ge.alias||Ne,ze=Ge.compression||ze,Re=Ge.rotation||Ge.angle||Re}var He=this.internal.getFilters();if(ze===void 0&&He.indexOf("FlateEncode")!==-1&&(ze="SLOW"),isNaN(Se)||isNaN(Te))throw new Error("Invalid coordinates passed to jsPDF.addImage");p.call(this);var ye=ge.call(this,se,te,Ne,ze);return k.call(this,Se,Te,Ee,je,ye,Re),this};var ge=function(se,te,Se,Te){var Ee,je,Ne;if(typeof se=="string"&&o(se)===e){se=unescape(se);var ze=ue(se,!1);(ze!==""||(ze=r.loadFile(se,!0))!==void 0)&&(se=ze)}if(y(se)&&(se=_(se,te)),te=o(se,te),!g(te))throw new Error("addImage does not support files of type '"+te+"', please ensure that a plugin for '"+te+"' support is added.");if(((Ne=Se)==null||Ne.length===0)&&(Se=function(Re){return typeof Re=="string"||be(Re)?X(Re):be(Re.data)?X(Re.data):null}(se)),(Ee=w.call(this,Se))||(se instanceof Uint8Array||te==="RGBA"||(je=se,se=me(se)),Ee=this["process"+te.toUpperCase()](se,f.call(this),Se,function(Re){return Re&&typeof Re=="string"&&(Re=Re.toUpperCase()),Re in r.image_compression?Re:q.NONE}(Te),je)),!Ee)throw new Error("An unknown error occurred whilst processing the image.");return Ee},ue=r.__addimage__.convertBase64ToBinaryString=function(se,te){te=typeof te!="boolean"||te;var Se,Te="";if(typeof se=="string"){var Ee;Se=(Ee=ae(se))!==null&&Ee!==void 0?Ee:se;try{Te=VM(Se)}catch(je){if(te)throw ie(Se)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+je.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return Te};r.getImageProperties=function(se){var te,Se,Te="";if(y(se)&&(se=_(se)),typeof se=="string"&&o(se)===e&&((Te=ue(se,!1))===""&&(Te=r.loadFile(se)||""),se=Te),Se=o(se),!g(Se))throw new Error("addImage does not support files of type '"+Se+"', please ensure that a plugin for '"+Se+"' support is added.");if(se instanceof Uint8Array||(se=me(se)),!(te=this["process"+Se.toUpperCase()](se)))throw new Error("An unknown error occurred whilst processing the image");return te.fileType=Se,te}})(Ui.API),function(r){var i=function(e){if(e!==void 0&&e!="")return!0};Ui.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var n,o,s,l=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString,p=this.internal.getPageInfoByObjId(e.objId),m=e.pageContext.annotations,f=!1,g=0;g<m.length&&!f;g++)switch((n=m[g]).type){case"link":(i(n.options.url)||i(n.options.pageNumber))&&(f=!0);break;case"reference":case"text":case"freetext":f=!0}if(f!=0){this.internal.write("/Annots [");for(var y=0;y<m.length;y++){n=m[y];var _=this.internal.pdfEscape,w=this.internal.getEncryptor(e.objId);switch(n.type){case"reference":this.internal.write(" "+n.object.objId+" 0 R ");break;case"text":var A=this.internal.newAdditionalObject(),k=this.internal.newAdditionalObject(),R=this.internal.getEncryptor(A.objId),q=n.title||"Note";s="<</Type /Annot /Subtype /Text "+(o="/Rect ["+l(n.bounds.x)+" "+h(n.bounds.y+n.bounds.h)+" "+l(n.bounds.x+n.bounds.w)+" "+h(n.bounds.y)+"] ")+"/Contents ("+_(R(n.contents))+")",s+=" /Popup "+k.objId+" 0 R",s+=" /P "+p.objId+" 0 R",s+=" /T ("+_(R(q))+") >>",A.content=s;var X=A.objId+" 0 R";s="<</Type /Annot /Subtype /Popup "+(o="/Rect ["+l(n.bounds.x+30)+" "+h(n.bounds.y+n.bounds.h)+" "+l(n.bounds.x+n.bounds.w+30)+" "+h(n.bounds.y)+"] ")+" /Parent "+X,n.open&&(s+=" /Open true"),s+=" >>",k.content=s,this.internal.write(A.objId,"0 R",k.objId,"0 R");break;case"freetext":o="/Rect ["+l(n.bounds.x)+" "+h(n.bounds.y)+" "+l(n.bounds.x+n.bounds.w)+" "+h(n.bounds.y+n.bounds.h)+"] ";var ie=n.color||"#000000";s="<</Type /Annot /Subtype /FreeText "+o+"/Contents ("+_(w(n.contents))+")",s+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+ie+")",s+=" /Border [0 0 0]",s+=" >>",this.internal.write(s);break;case"link":if(n.options.name){var ae=this.annotations._nameMap[n.options.name];n.options.pageNumber=ae.page,n.options.top=ae.y}else n.options.top||(n.options.top=0);if(o="/Rect ["+n.finalBounds.x+" "+n.finalBounds.y+" "+n.finalBounds.w+" "+n.finalBounds.h+"] ",s="",n.options.url)s="<</Type /Annot /Subtype /Link "+o+"/Border [0 0 0] /A <</S /URI /URI ("+_(w(n.options.url))+") >>";else if(n.options.pageNumber)switch(s="<</Type /Annot /Subtype /Link "+o+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(n.options.pageNumber).objId+" 0 R",n.options.magFactor=n.options.magFactor||"XYZ",n.options.magFactor){case"Fit":s+=" /Fit]";break;case"FitH":s+=" /FitH "+n.options.top+"]";break;case"FitV":n.options.left=n.options.left||0,s+=" /FitV "+n.options.left+"]";break;default:var be=h(n.options.top);n.options.left=n.options.left||0,n.options.zoom===void 0&&(n.options.zoom=0),s+=" /XYZ "+n.options.left+" "+be+" "+n.options.zoom+"]"}s!=""&&(s+=" >>",this.internal.write(s))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var n=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":n.pageContext.annotations.push(e)}},r.link=function(e,n,o,s,l){var h=this.internal.getCurrentPageInfo(),p=this.internal.getCoordinateString,m=this.internal.getVerticalCoordinateString;h.pageContext.annotations.push({finalBounds:{x:p(e),y:m(n),w:p(e+o),h:m(n+s)},options:l,type:"link"})},r.textWithLink=function(e,n,o,s){var l,h,p=this.getTextWidth(e),m=this.internal.getLineHeight()/this.internal.scaleFactor;if(s.maxWidth!==void 0){h=s.maxWidth;var f=this.splitTextToSize(e,h).length;l=Math.ceil(m*f)}else h=p,l=m;return this.text(e,n,o,s),o+=.2*m,s.align==="center"&&(n-=p/2),s.align==="right"&&(n-=p),this.link(n,o-m,h,l,s),p},r.getTextWidth=function(e){var n=this.internal.getFontSize();return this.getStringUnitWidth(e)*n/this.internal.scaleFactor}}(Ui.API),function(r){var i={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},n={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},o=[1570,1571,1573,1575];r.__arabicParser__={};var s=r.__arabicParser__.isInArabicSubstitutionA=function(A){return i[A.charCodeAt(0)]!==void 0},l=r.__arabicParser__.isArabicLetter=function(A){return typeof A=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(A)},h=r.__arabicParser__.isArabicEndLetter=function(A){return l(A)&&s(A)&&i[A.charCodeAt(0)].length<=2},p=r.__arabicParser__.isArabicAlfLetter=function(A){return l(A)&&o.indexOf(A.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(A){return l(A)&&s(A)&&i[A.charCodeAt(0)].length>=1};var m=r.__arabicParser__.arabicLetterHasFinalForm=function(A){return l(A)&&s(A)&&i[A.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(A){return l(A)&&s(A)&&i[A.charCodeAt(0)].length>=3};var f=r.__arabicParser__.arabicLetterHasMedialForm=function(A){return l(A)&&s(A)&&i[A.charCodeAt(0)].length==4},g=r.__arabicParser__.resolveLigatures=function(A){var k=0,R=e,q="",X=0;for(k=0;k<A.length;k+=1)R[A.charCodeAt(k)]!==void 0?(X++,typeof(R=R[A.charCodeAt(k)])=="number"&&(q+=String.fromCharCode(R),R=e,X=0),k===A.length-1&&(R=e,q+=A.charAt(k-(X-1)),k-=X-1,X=0)):(R=e,q+=A.charAt(k-X),k-=X,X=0);return q};r.__arabicParser__.isArabicDiacritic=function(A){return A!==void 0&&n[A.charCodeAt(0)]!==void 0};var y=r.__arabicParser__.getCorrectForm=function(A,k,R){return l(A)?s(A)===!1?-1:!m(A)||!l(k)&&!l(R)||!l(R)&&h(k)||h(A)&&!l(k)||h(A)&&p(k)||h(A)&&h(k)?0:f(A)&&l(k)&&!h(k)&&l(R)&&m(R)?3:h(A)||!l(R)?1:2:-1},_=function(A){var k=0,R=0,q=0,X="",ie="",ae="",be=(A=A||"").split("\\s+"),me=[];for(k=0;k<be.length;k+=1){for(me.push(""),R=0;R<be[k].length;R+=1)X=be[k][R],ie=be[k][R-1],ae=be[k][R+1],l(X)?(q=y(X,ie,ae),me[k]+=q!==-1?String.fromCharCode(i[X.charCodeAt(0)][q]):X):me[k]+=X;me[k]=g(me[k])}return me.join(" ")},w=r.__arabicParser__.processArabic=r.processArabic=function(){var A,k=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,R=[];if(Array.isArray(k)){var q=0;for(R=[],q=0;q<k.length;q+=1)Array.isArray(k[q])?R.push([_(k[q][0]),k[q][1],k[q][2]]):R.push([_(k[q])]);A=R}else A=_(k);return typeof arguments[0]=="string"?A:(arguments[0].text=A,arguments[0])};r.events.push(["preProcessText",w])}(Ui.API),Ui.API.autoPrint=function(r){var i;return(r=r||{}).variant=r.variant||"non-conform",r.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){i=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+i+" 0 R")})),this},function(r){var i=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(h){e=h}});var n=150;Object.defineProperty(this,"width",{get:function(){return n},set:function(h){n=isNaN(h)||Number.isInteger(h)===!1||h<0?150:h,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=n+1)}});var o=300;Object.defineProperty(this,"height",{get:function(){return o},set:function(h){o=isNaN(h)||Number.isInteger(h)===!1||h<0?300:h,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=o+1)}});var s=[];Object.defineProperty(this,"childNodes",{get:function(){return s},set:function(h){s=h}});var l={};Object.defineProperty(this,"style",{get:function(){return l},set:function(h){l=h}}),Object.defineProperty(this,"parentNode",{})};i.prototype.getContext=function(e,n){var o;if((e=e||"2d")!=="2d")return null;for(o in n)this.pdf.context2d.hasOwnProperty(o)&&(this.pdf.context2d[o]=n[o]);return this.pdf.context2d._canvas=this,this.pdf.context2d},i.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new i,this.canvas.pdf=this}])}(Ui.API),function(r){var i={left:0,top:0,bottom:0,right:0},e=!1,n=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},i),this.internal.__cell__.margins.width=this.getPageWidth(),o.call(this))},o=function(){this.internal.__cell__.lastCell=new s,this.internal.__cell__.pages=1},s=function(){var p=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return p},set:function(A){p=A}});var m=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return m},set:function(A){m=A}});var f=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return f},set:function(A){f=A}});var g=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return g},set:function(A){g=A}});var y=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return y},set:function(A){y=A}});var _=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return _},set:function(A){_=A}});var w=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return w},set:function(A){w=A}}),this};s.prototype.clone=function(){return new s(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},s.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(p){return n.call(this),this.internal.__cell__.headerFunction=typeof p=="function"?p:void 0,this},r.getTextDimensions=function(p,m){n.call(this);var f=(m=m||{}).fontSize||this.getFontSize(),g=m.font||this.getFont(),y=m.scaleFactor||this.internal.scaleFactor,_=0,w=0,A=0,k=this;if(!Array.isArray(p)&&typeof p!="string"){if(typeof p!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");p=String(p)}var R=m.maxWidth;R>0?typeof p=="string"?p=this.splitTextToSize(p,R):Object.prototype.toString.call(p)==="[object Array]"&&(p=p.reduce(function(X,ie){return X.concat(k.splitTextToSize(ie,R))},[])):p=Array.isArray(p)?p:[p];for(var q=0;q<p.length;q++)_<(A=this.getStringUnitWidth(p[q],{font:g})*f)&&(_=A);return _!==0&&(w=p.length),{w:_/=y,h:Math.max((w*f*this.getLineHeightFactor()-f*(this.getLineHeightFactor()-1))/y,0)}},r.cellAddPage=function(){n.call(this),this.addPage();var p=this.internal.__cell__.margins||i;return this.internal.__cell__.lastCell=new s(p.left,p.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var l=r.cell=function(){var p;p=arguments[0]instanceof s?arguments[0]:new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),n.call(this);var m=this.internal.__cell__.lastCell,f=this.internal.__cell__.padding,g=this.internal.__cell__.margins||i,y=this.internal.__cell__.tableHeaderRow,_=this.internal.__cell__.printHeaders;return m.lineNumber!==void 0&&(m.lineNumber===p.lineNumber?(p.x=(m.x||0)+(m.width||0),p.y=m.y||0):m.y+m.height+p.height+g.bottom>this.getPageHeight()?(this.cellAddPage(),p.y=g.top,_&&y&&(this.printHeaderRow(p.lineNumber,!0),p.y+=y[0].height)):p.y=m.y+m.height||p.y),p.text[0]!==void 0&&(this.rect(p.x,p.y,p.width,p.height,e===!0?"FD":void 0),p.align==="right"?this.text(p.text,p.x+p.width-f,p.y+f,{align:"right",baseline:"top"}):p.align==="center"?this.text(p.text,p.x+p.width/2,p.y+f,{align:"center",baseline:"top",maxWidth:p.width-f-f}):this.text(p.text,p.x+f,p.y+f,{align:"left",baseline:"top",maxWidth:p.width-f-f})),this.internal.__cell__.lastCell=p,this};r.table=function(p,m,f,g,y){if(n.call(this),!f)throw new Error("No data for PDF table.");var _,w,A,k,R=[],q=[],X=[],ie={},ae={},be=[],me=[],fe=(y=y||{}).autoSize||!1,ge=y.printHeaders!==!1,ue=y.css&&y.css["font-size"]!==void 0?16*y.css["font-size"]:y.fontSize||12,se=y.margins||Object.assign({width:this.getPageWidth()},i),te=typeof y.padding=="number"?y.padding:3,Se=y.headerBackgroundColor||"#c8c8c8",Te=y.headerTextColor||"#000";if(o.call(this),this.internal.__cell__.printHeaders=ge,this.internal.__cell__.margins=se,this.internal.__cell__.table_font_size=ue,this.internal.__cell__.padding=te,this.internal.__cell__.headerBackgroundColor=Se,this.internal.__cell__.headerTextColor=Te,this.setFontSize(ue),g==null)q=R=Object.keys(f[0]),X=R.map(function(){return"left"});else if(Array.isArray(g)&&Eo(g[0])==="object")for(R=g.map(function(Ge){return Ge.name}),q=g.map(function(Ge){return Ge.prompt||Ge.name||""}),X=g.map(function(Ge){return Ge.align||"left"}),_=0;_<g.length;_+=1)ae[g[_].name]=.7499990551181103*g[_].width;else Array.isArray(g)&&typeof g[0]=="string"&&(q=R=g,X=R.map(function(){return"left"}));if(fe||Array.isArray(g)&&typeof g[0]=="string")for(_=0;_<R.length;_+=1){for(ie[k=R[_]]=f.map(function(Ge){return Ge[k]}),this.setFont(void 0,"bold"),be.push(this.getTextDimensions(q[_],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),w=ie[k],this.setFont(void 0,"normal"),A=0;A<w.length;A+=1)be.push(this.getTextDimensions(w[A],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);ae[k]=Math.max.apply(null,be)+te+te,be=[]}if(ge){var Ee={};for(_=0;_<R.length;_+=1)Ee[R[_]]={},Ee[R[_]].text=q[_],Ee[R[_]].align=X[_];var je=h.call(this,Ee,ae);me=R.map(function(Ge){return new s(p,m,ae[Ge],je,Ee[Ge].text,void 0,Ee[Ge].align)}),this.setTableHeaderRow(me),this.printHeaderRow(1,!1)}var Ne=g.reduce(function(Ge,He){return Ge[He.name]=He.align,Ge},{});for(_=0;_<f.length;_+=1){"rowStart"in y&&y.rowStart instanceof Function&&y.rowStart({row:_,data:f[_]},this);var ze=h.call(this,f[_],ae);for(A=0;A<R.length;A+=1){var Re=f[_][R[A]];"cellStart"in y&&y.cellStart instanceof Function&&y.cellStart({row:_,col:A,data:Re},this),l.call(this,new s(p,m,ae[R[A]],ze,Re,_+2,Ne[R[A]]))}}return this.internal.__cell__.table_x=p,this.internal.__cell__.table_y=m,this};var h=function(p,m){var f=this.internal.__cell__.padding,g=this.internal.__cell__.table_font_size,y=this.internal.scaleFactor;return Object.keys(p).map(function(_){var w=p[_];return this.splitTextToSize(w.hasOwnProperty("text")?w.text:w,m[_]-f-f)},this).map(function(_){return this.getLineHeightFactor()*_.length*g/y+f+f},this).reduce(function(_,w){return Math.max(_,w)},0)};r.setTableHeaderRow=function(p){n.call(this),this.internal.__cell__.tableHeaderRow=p},r.printHeaderRow=function(p,m){if(n.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var f;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var g=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new s(g[0],g[1],g[2],g[3],void 0,-1)}this.setFont(void 0,"bold");for(var y=[],_=0;_<this.internal.__cell__.tableHeaderRow.length;_+=1){f=this.internal.__cell__.tableHeaderRow[_].clone(),m&&(f.y=this.internal.__cell__.margins.top||0,y.push(f)),f.lineNumber=p;var w=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),l.call(this,f),this.setTextColor(w)}y.length>0&&this.setTableHeaderRow(y),this.setFont(void 0,"normal"),e=!1}}(Ui.API);var fU={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},gU=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],PL=mU(gU),_U=[100,200,300,400,500,600,700,800,900],Rae=mU(_U);function CL(r){var i=r.family.replace(/"|'/g,"").toLowerCase(),e=function(s){return fU[s=s||"normal"]?s:"normal"}(r.style),n=function(s){return s?typeof s=="number"?s>=100&&s<=900&&s%100==0?s:400:/^\d00$/.test(s)?parseInt(s):s==="bold"?700:400:400}(r.weight),o=function(s){return typeof PL[s=s||"normal"]=="number"?s:"normal"}(r.stretch);return{family:i,style:e,weight:n,stretch:o,src:r.src||[],ref:r.ref||{name:i,style:[o,e,n].join(" ")}}}function $V(r,i,e,n){var o;for(o=e;o>=0&&o<i.length;o+=n)if(r[i[o]])return r[i[o]];for(o=e;o>=0&&o<i.length;o-=n)if(r[i[o]])return r[i[o]]}var Nae={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},WV={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function HV(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function qV(r){return r.trimLeft()}function Bae(r,i){for(var e=0;e<r.length;){if(r.charAt(e)===i)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function Gae(r){var i=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return i===null?null:[i[0],r.substring(i[0].length)]}var GM,YV,ZV,lv,jM,XV,KV,QV,AL=["times"];function JV(r,i,e,n,o){var s=4,l=tU;switch(o){case Ui.API.image_compression.FAST:s=1,l=eU;break;case Ui.API.image_compression.MEDIUM:s=6,l=iU;break;case Ui.API.image_compression.SLOW:s=9,l=rU}r=function(p,m,f,g){for(var y,_=p.length/m,w=new Uint8Array(p.length+_),A=[jae,eU,tU,iU,rU],k=0;k<_;k+=1){var R=k*m,q=p.subarray(R,R+m);if(g)w.set(g(q,f,y),R+k);else{for(var X=A.length,ie=[],ae=0;ae<X;ae+=1)ie[ae]=A[ae](q,f,y);var be=Uae(ie.concat());w.set(ie[be],R+k)}y=q}return w}(r,i,Math.ceil(e*n/8),l);var h=fM(r,{level:s});return Ui.API.__addimage__.arrayBufferToBinaryString(h)}function jae(r){var i=Array.apply([],r);return i.unshift(0),i}function eU(r,i){var e=r.length,n=[];n[0]=1;for(var o=0;o<e;o+=1){var s=r[o-i]||0;n[o+1]=r[o]-s+256&255}return n}function tU(r,i,e){var n=r.length,o=[];o[0]=2;for(var s=0;s<n;s+=1){var l=e&&e[s]||0;o[s+1]=r[s]-l+256&255}return o}function iU(r,i,e){var n=r.length,o=[];o[0]=3;for(var s=0;s<n;s+=1){var l=r[s-i]||0,h=e&&e[s]||0;o[s+1]=r[s]+256-(l+h>>>1)&255}return o}function rU(r,i,e){var n=r.length,o=[];o[0]=4;for(var s=0;s<n;s+=1){var l=Vae(r[s-i]||0,e&&e[s]||0,e&&e[s-i]||0);o[s+1]=r[s]-l+256&255}return o}function Vae(r,i,e){if(r===i&&i===e)return r;var n=Math.abs(i-e),o=Math.abs(r-e),s=Math.abs(r+i-e-e);return n<=o&&n<=s?r:o<=s?i:e}function Uae(r){var i=r.map(function(e){return e.reduce(function(n,o){return n+Math.abs(o)},0)});return i.indexOf(Math.min.apply(null,i))}function ML(r,i,e){var n=i*e,o=Math.floor(n/8),s=16-(n-8*o+e),l=(1<<e)-1;return yU(r,o)>>s&l}function nU(r,i,e,n){var o=e*n,s=Math.floor(o/8),l=16-(o-8*s+n),h=(1<<n)-1,p=(i&h)<<l;(function(m,f,g){if(f+1<m.byteLength)m.setUint16(f,g,!1);else{var y=g>>8&255;m.setUint8(f,y)}})(r,s,yU(r,s)&~(h<<l)&65535|p)}function yU(r,i){return i+1<r.byteLength?r.getUint16(i,!1):r.getUint8(i)<<8}function zae(r){var i=0;if(r[i++]!==71||r[i++]!==73||r[i++]!==70||r[i++]!==56||(r[i++]+1&253)!=56||r[i++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[i++]|r[i++]<<8,n=r[i++]|r[i++]<<8,o=r[i++],s=o>>7,l=1<<1+(7&o);r[i++],r[i++];var h=null,p=null;s&&(h=i,p=l,i+=3*l);var m=!0,f=[],g=0,y=null,_=0,w=null;for(this.width=e,this.height=n;m&&i<r.length;)switch(r[i++]){case 33:switch(r[i++]){case 255:if(r[i]!==11||r[i+1]==78&&r[i+2]==69&&r[i+3]==84&&r[i+4]==83&&r[i+5]==67&&r[i+6]==65&&r[i+7]==80&&r[i+8]==69&&r[i+9]==50&&r[i+10]==46&&r[i+11]==48&&r[i+12]==3&&r[i+13]==1&&r[i+16]==0)i+=14,w=r[i++]|r[i++]<<8,i++;else for(i+=12;;){if(!((se=r[i++])>=0))throw Error("Invalid block size");if(se===0)break;i+=se}break;case 249:if(r[i++]!==4||r[i+4]!==0)throw new Error("Invalid graphics extension block.");var A=r[i++];g=r[i++]|r[i++]<<8,y=r[i++],1&A||(y=null),_=A>>2&7,i++;break;case 254:for(;;){if(!((se=r[i++])>=0))throw Error("Invalid block size");if(se===0)break;i+=se}break;default:throw new Error("Unknown graphic control label: 0x"+r[i-1].toString(16))}break;case 44:var k=r[i++]|r[i++]<<8,R=r[i++]|r[i++]<<8,q=r[i++]|r[i++]<<8,X=r[i++]|r[i++]<<8,ie=r[i++],ae=ie>>6&1,be=1<<1+(7&ie),me=h,fe=p,ge=!1;ie>>7&&(ge=!0,me=i,fe=be,i+=3*be);var ue=i;for(i++;;){var se;if(!((se=r[i++])>=0))throw Error("Invalid block size");if(se===0)break;i+=se}f.push({x:k,y:R,width:q,height:X,has_local_palette:ge,palette_offset:me,palette_size:fe,data_offset:ue,data_length:i-ue,transparent_index:y,interlaced:!!ae,delay:g,disposal:_});break;case 59:m=!1;break;default:throw new Error("Unknown gif block: 0x"+r[i-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return w},this.frameInfo=function(te){if(te<0||te>=f.length)throw new Error("Frame index out of range.");return f[te]},this.decodeAndBlitFrameBGRA=function(te,Se){var Te=this.frameInfo(te),Ee=Te.width*Te.height,je=new Uint8Array(Ee);oU(r,Te.data_offset,je,Ee);var Ne=Te.palette_offset,ze=Te.transparent_index;ze===null&&(ze=256);var Re=Te.width,Ge=e-Re,He=Re,ye=4*(Te.y*e+Te.x),Ae=4*((Te.y+Te.height)*e+Te.x),Le=ye,Ye=4*Ge;Te.interlaced===!0&&(Ye+=4*e*7);for(var qe=8,et=0,ft=je.length;et<ft;++et){var mt=je[et];if(He===0&&(He=Re,(Le+=Ye)>=Ae&&(Ye=4*Ge+4*e*(qe-1),Le=ye+(Re+Ge)*(qe<<1),qe>>=1)),mt===ze)Le+=4;else{var At=r[Ne+3*mt],ht=r[Ne+3*mt+1],he=r[Ne+3*mt+2];Se[Le++]=he,Se[Le++]=ht,Se[Le++]=At,Se[Le++]=255}--He}},this.decodeAndBlitFrameRGBA=function(te,Se){var Te=this.frameInfo(te),Ee=Te.width*Te.height,je=new Uint8Array(Ee);oU(r,Te.data_offset,je,Ee);var Ne=Te.palette_offset,ze=Te.transparent_index;ze===null&&(ze=256);var Re=Te.width,Ge=e-Re,He=Re,ye=4*(Te.y*e+Te.x),Ae=4*((Te.y+Te.height)*e+Te.x),Le=ye,Ye=4*Ge;Te.interlaced===!0&&(Ye+=4*e*7);for(var qe=8,et=0,ft=je.length;et<ft;++et){var mt=je[et];if(He===0&&(He=Re,(Le+=Ye)>=Ae&&(Ye=4*Ge+4*e*(qe-1),Le=ye+(Re+Ge)*(qe<<1),qe>>=1)),mt===ze)Le+=4;else{var At=r[Ne+3*mt],ht=r[Ne+3*mt+1],he=r[Ne+3*mt+2];Se[Le++]=At,Se[Le++]=ht,Se[Le++]=he,Se[Le++]=255}--He}}}function oU(r,i,e,n){for(var o=r[i++],s=1<<o,l=s+1,h=l+1,p=o+1,m=(1<<p)-1,f=0,g=0,y=0,_=r[i++],w=new Int32Array(4096),A=null;;){for(;f<16&&_!==0;)g|=r[i++]<<f,f+=8,_===1?_=r[i++]:--_;if(f<p)break;var k=g&m;if(g>>=p,f-=p,k!==s){if(k===l)break;for(var R=k<h?k:A,q=0,X=R;X>s;)X=w[X]>>8,++q;var ie=X;if(y+q+(R!==k?1:0)>n)return void Xo.log("Warning, gif stream longer than expected.");e[y++]=ie;var ae=y+=q;for(R!==k&&(e[y++]=ie),X=R;q--;)X=w[X],e[--ae]=255&X,X>>=8;A!==null&&h<4096&&(w[h++]=A<<8|ie,h>=m+1&&p<12&&(++p,m=m<<1|1)),A=k}else h=l+1,m=(1<<(p=o+1))-1,A=null}return y!==n&&Xo.log("Warning, gif stream shorter than expected."),e}function IL(r){var i,e,n,o,s,l=Math.floor,h=new Array(64),p=new Array(64),m=new Array(64),f=new Array(64),g=new Array(65535),y=new Array(65535),_=new Array(64),w=new Array(64),A=[],k=0,R=7,q=new Array(64),X=new Array(64),ie=new Array(64),ae=new Array(256),be=new Array(2048),me=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],fe=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],ge=[0,1,2,3,4,5,6,7,8,9,10,11],ue=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],se=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],te=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],Se=[0,1,2,3,4,5,6,7,8,9,10,11],Te=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Ee=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function je(ye,Ae){for(var Le=0,Ye=0,qe=new Array,et=1;et<=16;et++){for(var ft=1;ft<=ye[et];ft++)qe[Ae[Ye]]=[],qe[Ae[Ye]][0]=Le,qe[Ae[Ye]][1]=et,Ye++,Le++;Le*=2}return qe}function Ne(ye){for(var Ae=ye[0],Le=ye[1]-1;Le>=0;)Ae&1<<Le&&(k|=1<<R),Le--,--R<0&&(k==255?(ze(255),ze(0)):ze(k),R=7,k=0)}function ze(ye){A.push(ye)}function Re(ye){ze(ye>>8&255),ze(255&ye)}function Ge(ye,Ae,Le,Ye,qe){for(var et,ft=qe[0],mt=qe[240],At=function(tt,ot){var wt,Mt,St,ei,Jt,Ut,pi,yi,Kt,li,Ft=0;for(Kt=0;Kt<8;++Kt){wt=tt[Ft],Mt=tt[Ft+1],St=tt[Ft+2],ei=tt[Ft+3],Jt=tt[Ft+4],Ut=tt[Ft+5],pi=tt[Ft+6];var Nr=wt+(yi=tt[Ft+7]),Qi=wt-yi,ji=Mt+pi,cr=Mt-pi,Yr=St+Ut,Ci=St-Ut,pr=ei+Jt,Ai=ei-Jt,Pi=Nr+pr,er=Nr-pr,xr=ji+Yr,tr=ji-Yr;tt[Ft]=Pi+xr,tt[Ft+4]=Pi-xr;var Vn=.707106781*(tr+er);tt[Ft+2]=er+Vn,tt[Ft+6]=er-Vn;var Vu=.382683433*((Pi=Ai+Ci)-(tr=cr+Qi)),mo=.5411961*Pi+Vu,Al=1.306562965*tr+Vu,ps=.707106781*(xr=Ci+cr),zi=Qi+ps,Cs=Qi-ps;tt[Ft+5]=Cs+mo,tt[Ft+3]=Cs-mo,tt[Ft+1]=zi+Al,tt[Ft+7]=zi-Al,Ft+=8}for(Ft=0,Kt=0;Kt<8;++Kt){wt=tt[Ft],Mt=tt[Ft+8],St=tt[Ft+16],ei=tt[Ft+24],Jt=tt[Ft+32],Ut=tt[Ft+40],pi=tt[Ft+48];var Ml=wt+(yi=tt[Ft+56]),As=wt-yi,Un=Mt+pi,Pn=Mt-pi,Go=St+Ut,Il=St-Ut,k_=ei+Jt,zg=ei-Jt,ap=Ml+k_,rm=Ml-k_,sp=Un+Go,lp=Un-Go;tt[Ft]=ap+sp,tt[Ft+32]=ap-sp;var gh=.707106781*(lp+rm);tt[Ft+16]=rm+gh,tt[Ft+48]=rm-gh;var O_=.382683433*((ap=zg+Il)-(lp=Pn+As)),nm=.5411961*ap+O_,D_=1.306562965*lp+O_,h1=.707106781*(sp=Il+Pn),p1=As+h1,m1=As-h1;tt[Ft+40]=m1+nm,tt[Ft+24]=m1-nm,tt[Ft+8]=p1+D_,tt[Ft+56]=p1-D_,Ft++}for(Kt=0;Kt<64;++Kt)li=tt[Kt]*ot[Kt],_[Kt]=li>0?li+.5|0:li-.5|0;return _}(ye,Ae),ht=0;ht<64;++ht)w[me[ht]]=At[ht];var he=w[0]-Le;Le=w[0],he==0?Ne(Ye[0]):(Ne(Ye[y[et=32767+he]]),Ne(g[et]));for(var st=63;st>0&&w[st]==0;)st--;if(st==0)return Ne(ft),Le;for(var Je,de=1;de<=st;){for(var ke=de;w[de]==0&&de<=st;)++de;var Ze=de-ke;if(Ze>=16){Je=Ze>>4;for(var vt=1;vt<=Je;++vt)Ne(mt);Ze&=15}et=32767+w[de],Ne(qe[(Ze<<4)+y[et]]),Ne(g[et]),de++}return st!=63&&Ne(ft),Le}function He(ye){ye=Math.min(Math.max(ye,1),100),s!=ye&&(function(Ae){for(var Le=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],Ye=0;Ye<64;Ye++){var qe=l((Le[Ye]*Ae+50)/100);qe=Math.min(Math.max(qe,1),255),h[me[Ye]]=qe}for(var et=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ft=0;ft<64;ft++){var mt=l((et[ft]*Ae+50)/100);mt=Math.min(Math.max(mt,1),255),p[me[ft]]=mt}for(var At=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],ht=0,he=0;he<8;he++)for(var st=0;st<8;st++)m[ht]=1/(h[me[ht]]*At[he]*At[st]*8),f[ht]=1/(p[me[ht]]*At[he]*At[st]*8),ht++}(ye<50?Math.floor(5e3/ye):Math.floor(200-2*ye)),s=ye)}this.encode=function(ye,Ae){Ae&&He(Ae),A=new Array,k=0,R=7,Re(65496),Re(65504),Re(16),ze(74),ze(70),ze(73),ze(70),ze(0),ze(1),ze(1),ze(0),Re(1),Re(1),ze(0),ze(0),function(){Re(65499),Re(132),ze(0);for(var Mt=0;Mt<64;Mt++)ze(h[Mt]);ze(1);for(var St=0;St<64;St++)ze(p[St])}(),function(Mt,St){Re(65472),Re(17),ze(8),Re(St),Re(Mt),ze(3),ze(1),ze(17),ze(0),ze(2),ze(17),ze(1),ze(3),ze(17),ze(1)}(ye.width,ye.height),function(){Re(65476),Re(418),ze(0);for(var Mt=0;Mt<16;Mt++)ze(fe[Mt+1]);for(var St=0;St<=11;St++)ze(ge[St]);ze(16);for(var ei=0;ei<16;ei++)ze(ue[ei+1]);for(var Jt=0;Jt<=161;Jt++)ze(se[Jt]);ze(1);for(var Ut=0;Ut<16;Ut++)ze(te[Ut+1]);for(var pi=0;pi<=11;pi++)ze(Se[pi]);ze(17);for(var yi=0;yi<16;yi++)ze(Te[yi+1]);for(var Kt=0;Kt<=161;Kt++)ze(Ee[Kt])}(),Re(65498),Re(12),ze(3),ze(1),ze(0),ze(2),ze(17),ze(3),ze(17),ze(0),ze(63),ze(0);var Le=0,Ye=0,qe=0;k=0,R=7,this.encode.displayName="_encode_";for(var et,ft,mt,At,ht,he,st,Je,de,ke=ye.data,Ze=ye.width,vt=ye.height,tt=4*Ze,ot=0;ot<vt;){for(et=0;et<tt;){for(ht=tt*ot+et,st=-1,Je=0,de=0;de<64;de++)he=ht+(Je=de>>3)*tt+(st=4*(7&de)),ot+Je>=vt&&(he-=tt*(ot+1+Je-vt)),et+st>=tt&&(he-=et+st-tt+4),ft=ke[he++],mt=ke[he++],At=ke[he++],q[de]=(be[ft]+be[mt+256|0]+be[At+512|0]>>16)-128,X[de]=(be[ft+768|0]+be[mt+1024|0]+be[At+1280|0]>>16)-128,ie[de]=(be[ft+1280|0]+be[mt+1536|0]+be[At+1792|0]>>16)-128;Le=Ge(q,m,Le,i,n),Ye=Ge(X,f,Ye,e,o),qe=Ge(ie,f,qe,e,o),et+=32}ot+=8}if(R>=0){var wt=[];wt[1]=R+1,wt[0]=(1<<R+1)-1,Ne(wt)}return Re(65497),new Uint8Array(A)},r=r||50,function(){for(var ye=String.fromCharCode,Ae=0;Ae<256;Ae++)ae[Ae]=ye(Ae)}(),i=je(fe,ge),e=je(te,Se),n=je(ue,se),o=je(Te,Ee),function(){for(var ye=1,Ae=2,Le=1;Le<=15;Le++){for(var Ye=ye;Ye<Ae;Ye++)y[32767+Ye]=Le,g[32767+Ye]=[],g[32767+Ye][1]=Le,g[32767+Ye][0]=Ye;for(var qe=-(Ae-1);qe<=-ye;qe++)y[32767+qe]=Le,g[32767+qe]=[],g[32767+qe][1]=Le,g[32767+qe][0]=Ae-1+qe;ye<<=1,Ae<<=1}}(),function(){for(var ye=0;ye<256;ye++)be[ye]=19595*ye,be[ye+256|0]=38470*ye,be[ye+512|0]=7471*ye+32768,be[ye+768|0]=-11059*ye,be[ye+1024|0]=-21709*ye,be[ye+1280|0]=32768*ye+8421375,be[ye+1536|0]=-27439*ye,be[ye+1792|0]=-5329*ye}(),He(r)}function wp(r,i){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!i,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function aU(r){function i(ge){if(!ge)throw Error("assert :P")}function e(ge,ue,se){for(var te=0;4>te;te++)if(ge[ue+te]!=se.charCodeAt(te))return!0;return!1}function n(ge,ue,se,te,Se){for(var Te=0;Te<Se;Te++)ge[ue+Te]=se[te+Te]}function o(ge,ue,se,te){for(var Se=0;Se<te;Se++)ge[ue+Se]=se}function s(ge){return new Int32Array(ge)}function l(ge,ue){for(var se=[],te=0;te<ge;te++)se.push(new ue);return se}function h(ge,ue){var se=[];return function te(Se,Te,Ee){for(var je=Ee[Te],Ne=0;Ne<je&&(Se.push(Ee.length>Te+1?[]:new ue),!(Ee.length<Te+1));Ne++)te(Se[Ne],Te+1,Ee)}(se,0,ge),se}var p=function(){var ge=this;function ue(B,H){for(var oe=1<<H-1>>>0;B&oe;)oe>>>=1;return oe?(B&oe-1)+oe:B}function se(B,H,oe,pe,Me){i(!(pe%oe));do B[H+(pe-=oe)]=Me;while(0<pe)}function te(B,H,oe,pe,Me){if(i(2328>=Me),512>=Me)var Fe=s(512);else if((Fe=s(Me))==null)return 0;return function(Oe,De,Be,Ve,at,Ct){var Ue,dt,yt=De,Pt=1<<Be,xt=s(16),kt=s(16);for(i(at!=0),i(Ve!=null),i(Oe!=null),i(0<Be),dt=0;dt<at;++dt){if(15<Ve[dt])return 0;++xt[Ve[dt]]}if(xt[0]==at)return 0;for(kt[1]=0,Ue=1;15>Ue;++Ue){if(xt[Ue]>1<<Ue)return 0;kt[Ue+1]=kt[Ue]+xt[Ue]}for(dt=0;dt<at;++dt)Ue=Ve[dt],0<Ve[dt]&&(Ct[kt[Ue]++]=dt);if(kt[15]==1)return(Ve=new Se).g=0,Ve.value=Ct[0],se(Oe,yt,1,Pt,Ve),Pt;var Rt,ii=-1,Ht=Pt-1,ir=0,ki=1,vn=1,$i=1<<Be;for(dt=0,Ue=1,at=2;Ue<=Be;++Ue,at<<=1){if(ki+=vn<<=1,0>(vn-=xt[Ue]))return 0;for(;0<xt[Ue];--xt[Ue])(Ve=new Se).g=Ue,Ve.value=Ct[dt++],se(Oe,yt+ir,at,$i,Ve),ir=ue(ir,Ue)}for(Ue=Be+1,at=2;15>=Ue;++Ue,at<<=1){if(ki+=vn<<=1,0>(vn-=xt[Ue]))return 0;for(;0<xt[Ue];--xt[Ue]){if(Ve=new Se,(ir&Ht)!=ii){for(yt+=$i,Rt=1<<(ii=Ue)-Be;15>ii&&!(0>=(Rt-=xt[ii]));)++ii,Rt<<=1;Pt+=$i=1<<(Rt=ii-Be),Oe[De+(ii=ir&Ht)].g=Rt+Be,Oe[De+ii].value=yt-De-ii}Ve.g=Ue-Be,Ve.value=Ct[dt++],se(Oe,yt+(ir>>Be),at,$i,Ve),ir=ue(ir,Ue)}}return ki!=2*kt[15]-1?0:Pt}(B,H,oe,pe,Me,Fe)}function Se(){this.value=this.g=0}function Te(){this.value=this.g=0}function Ee(){this.G=l(5,Se),this.H=s(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=l(H_,Te)}function je(B,H,oe,pe){i(B!=null),i(H!=null),i(2147483648>pe),B.Ca=254,B.I=0,B.b=-8,B.Ka=0,B.oa=H,B.pa=oe,B.Jd=H,B.Yc=oe+pe,B.Zc=4<=pe?oe+pe-4+1:oe,ft(B)}function Ne(B,H){for(var oe=0;0<H--;)oe|=At(B,128)<<H;return oe}function ze(B,H){var oe=Ne(B,H);return mt(B)?-oe:oe}function Re(B,H,oe,pe){var Me,Fe=0;for(i(B!=null),i(H!=null),i(4294967288>pe),B.Sb=pe,B.Ra=0,B.u=0,B.h=0,4<pe&&(pe=4),Me=0;Me<pe;++Me)Fe+=H[oe+Me]<<8*Me;B.Ra=Fe,B.bb=pe,B.oa=H,B.pa=oe}function Ge(B){for(;8<=B.u&&B.bb<B.Sb;)B.Ra>>>=8,B.Ra+=B.oa[B.pa+B.bb]<<qg-8>>>0,++B.bb,B.u-=8;Ye(B)&&(B.h=1,B.u=0)}function He(B,H){if(i(0<=H),!B.h&&H<=Pd){var oe=Le(B)&Fd[H];return B.u+=H,Ge(B),oe}return B.h=1,B.u=0}function ye(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function Ae(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Le(B){return B.Ra>>>(B.u&qg-1)>>>0}function Ye(B){return i(B.bb<=B.Sb),B.h||B.bb==B.Sb&&B.u>qg}function qe(B,H){B.u=H,B.h=Ye(B)}function et(B){B.u>=Ef&&(i(B.u>=Ef),Ge(B))}function ft(B){i(B!=null&&B.oa!=null),B.pa<B.Zc?(B.I=(B.oa[B.pa++]|B.I<<8)>>>0,B.b+=8):(i(B!=null&&B.oa!=null),B.pa<B.Yc?(B.b+=8,B.I=B.oa[B.pa++]|B.I<<8):B.Ka?B.b=0:(B.I<<=8,B.b+=8,B.Ka=1))}function mt(B){return Ne(B,1)}function At(B,H){var oe=B.Ca;0>B.b&&ft(B);var pe=B.b,Me=oe*H>>>8,Fe=(B.I>>>pe>Me)+0;for(Fe?(oe-=Me,B.I-=Me+1<<pe>>>0):oe=Me+1,pe=oe,Me=0;256<=pe;)Me+=8,pe>>=8;return pe=7^Me+Yg[pe],B.b-=pe,B.Ca=(oe<<pe)-1,Fe}function ht(B,H,oe){B[H+0]=oe>>24&255,B[H+1]=oe>>16&255,B[H+2]=oe>>8&255,B[H+3]=255&oe}function he(B,H){return B[H+0]|B[H+1]<<8}function st(B,H){return he(B,H)|B[H+2]<<16}function Je(B,H){return he(B,H)|he(B,H+2)<<16}function de(B,H){var oe=1<<H;return i(B!=null),i(0<H),B.X=s(oe),B.X==null?0:(B.Mb=32-H,B.Xa=H,1)}function ke(B,H){i(B!=null),i(H!=null),i(B.Xa==H.Xa),n(H.X,0,B.X,0,1<<H.Xa)}function Ze(){this.X=[],this.Xa=this.Mb=0}function vt(B,H,oe,pe){i(oe!=null),i(pe!=null);var Me=oe[0],Fe=pe[0];return Me==0&&(Me=(B*Fe+H/2)/H),Fe==0&&(Fe=(H*Me+B/2)/B),0>=Me||0>=Fe?0:(oe[0]=Me,pe[0]=Fe,1)}function tt(B,H){return B+(1<<H)-1>>>H}function ot(B,H){return((4278255360&B)+(4278255360&H)>>>0&4278255360)+((16711935&B)+(16711935&H)>>>0&16711935)>>>0}function wt(B,H){ge[H]=function(oe,pe,Me,Fe,Oe,De,Be){var Ve;for(Ve=0;Ve<Oe;++Ve){var at=ge[B](De[Be+Ve-1],Me,Fe+Ve);De[Be+Ve]=ot(oe[pe+Ve],at)}}}function Mt(){this.ud=this.hd=this.jd=0}function St(B,H){return((4278124286&(B^H))>>>1)+(B&H)>>>0}function ei(B){return 0<=B&&256>B?B:0>B?0:255<B?255:void 0}function Jt(B,H){return ei(B+(B-H+.5>>1))}function Ut(B,H,oe){return Math.abs(H-oe)-Math.abs(B-oe)}function pi(B,H,oe,pe,Me,Fe,Oe){for(pe=Fe[Oe-1],oe=0;oe<Me;++oe)Fe[Oe+oe]=pe=ot(B[H+oe],pe)}function yi(B,H,oe,pe,Me){var Fe;for(Fe=0;Fe<oe;++Fe){var Oe=B[H+Fe],De=Oe>>8&255,Be=16711935&(Be=(Be=16711935&Oe)+((De<<16)+De));pe[Me+Fe]=(4278255360&Oe)+Be>>>0}}function Kt(B,H){H.jd=255&B,H.hd=B>>8&255,H.ud=B>>16&255}function li(B,H,oe,pe,Me,Fe){var Oe;for(Oe=0;Oe<pe;++Oe){var De=H[oe+Oe],Be=De>>>8,Ve=De,at=255&(at=(at=De>>>16)+((B.jd<<24>>24)*(Be<<24>>24)>>>5));Ve=255&(Ve=(Ve+=(B.hd<<24>>24)*(Be<<24>>24)>>>5)+((B.ud<<24>>24)*(at<<24>>24)>>>5)),Me[Fe+Oe]=(4278255360&De)+(at<<16)+Ve}}function Ft(B,H,oe,pe,Me){ge[H]=function(Fe,Oe,De,Be,Ve,at,Ct,Ue,dt){for(Be=Ct;Be<Ue;++Be)for(Ct=0;Ct<dt;++Ct)Ve[at++]=Me(De[pe(Fe[Oe++])])},ge[B]=function(Fe,Oe,De,Be,Ve,at,Ct){var Ue=8>>Fe.b,dt=Fe.Ea,yt=Fe.K[0],Pt=Fe.w;if(8>Ue)for(Fe=(1<<Fe.b)-1,Pt=(1<<Ue)-1;Oe<De;++Oe){var xt,kt=0;for(xt=0;xt<dt;++xt)xt&Fe||(kt=pe(Be[Ve++])),at[Ct++]=Me(yt[kt&Pt]),kt>>=Ue}else ge["VP8LMapColor"+oe](Be,Ve,yt,Pt,at,Ct,Oe,De,dt)}}function Nr(B,H,oe,pe,Me){for(oe=H+oe;H<oe;){var Fe=B[H++];pe[Me++]=Fe>>16&255,pe[Me++]=Fe>>8&255,pe[Me++]=255&Fe}}function Qi(B,H,oe,pe,Me){for(oe=H+oe;H<oe;){var Fe=B[H++];pe[Me++]=Fe>>16&255,pe[Me++]=Fe>>8&255,pe[Me++]=255&Fe,pe[Me++]=Fe>>24&255}}function ji(B,H,oe,pe,Me){for(oe=H+oe;H<oe;){var Fe=(Oe=B[H++])>>16&240|Oe>>12&15,Oe=240&Oe|Oe>>28&15;pe[Me++]=Fe,pe[Me++]=Oe}}function cr(B,H,oe,pe,Me){for(oe=H+oe;H<oe;){var Fe=(Oe=B[H++])>>16&248|Oe>>13&7,Oe=Oe>>5&224|Oe>>3&31;pe[Me++]=Fe,pe[Me++]=Oe}}function Yr(B,H,oe,pe,Me){for(oe=H+oe;H<oe;){var Fe=B[H++];pe[Me++]=255&Fe,pe[Me++]=Fe>>8&255,pe[Me++]=Fe>>16&255}}function Ci(B,H,oe,pe,Me,Fe){if(Fe==0)for(oe=H+oe;H<oe;)ht(pe,((Fe=B[H++])[0]>>24|Fe[1]>>8&65280|Fe[2]<<8&16711680|Fe[3]<<24)>>>0),Me+=32;else n(pe,Me,B,H,oe)}function pr(B,H){ge[H][0]=ge[B+"0"],ge[H][1]=ge[B+"1"],ge[H][2]=ge[B+"2"],ge[H][3]=ge[B+"3"],ge[H][4]=ge[B+"4"],ge[H][5]=ge[B+"5"],ge[H][6]=ge[B+"6"],ge[H][7]=ge[B+"7"],ge[H][8]=ge[B+"8"],ge[H][9]=ge[B+"9"],ge[H][10]=ge[B+"10"],ge[H][11]=ge[B+"11"],ge[H][12]=ge[B+"12"],ge[H][13]=ge[B+"13"],ge[H][14]=ge[B+"0"],ge[H][15]=ge[B+"0"]}function Ai(B){return B==SF||B==CF||B==dA||B==AF}function Pi(){this.eb=[],this.size=this.A=this.fb=0}function er(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function xr(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Pi,this.f.kb=new er,this.sd=null}function tr(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Vn(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function Vu(B){return alert("todo:WebPSamplerProcessPlane"),B.T}function mo(B,H){var oe=B.T,pe=H.ba.f.RGBA,Me=pe.eb,Fe=pe.fb+B.ka*pe.A,Oe=xh[H.ba.S],De=B.y,Be=B.O,Ve=B.f,at=B.N,Ct=B.ea,Ue=B.W,dt=H.cc,yt=H.dc,Pt=H.Mc,xt=H.Nc,kt=B.ka,Rt=B.ka+B.T,ii=B.U,Ht=ii+1>>1;for(kt==0?Oe(De,Be,null,null,Ve,at,Ct,Ue,Ve,at,Ct,Ue,Me,Fe,null,null,ii):(Oe(H.ec,H.fc,De,Be,dt,yt,Pt,xt,Ve,at,Ct,Ue,Me,Fe-pe.A,Me,Fe,ii),++oe);kt+2<Rt;kt+=2)dt=Ve,yt=at,Pt=Ct,xt=Ue,at+=B.Rc,Ue+=B.Rc,Fe+=2*pe.A,Oe(De,(Be+=2*B.fa)-B.fa,De,Be,dt,yt,Pt,xt,Ve,at,Ct,Ue,Me,Fe-pe.A,Me,Fe,ii);return Be+=B.fa,B.j+Rt<B.o?(n(H.ec,H.fc,De,Be,ii),n(H.cc,H.dc,Ve,at,Ht),n(H.Mc,H.Nc,Ct,Ue,Ht),oe--):1&Rt||Oe(De,Be,null,null,Ve,at,Ct,Ue,Ve,at,Ct,Ue,Me,Fe+pe.A,null,null,ii),oe}function Al(B,H,oe){var pe=B.F,Me=[B.J];if(pe!=null){var Fe=B.U,Oe=H.ba.S,De=Oe==uA||Oe==dA;H=H.ba.f.RGBA;var Be=[0],Ve=B.ka;Be[0]=B.T,B.Kb&&(Ve==0?--Be[0]:(--Ve,Me[0]-=B.width),B.j+B.ka+B.T==B.o&&(Be[0]=B.o-B.j-Ve));var at=H.eb;Ve=H.fb+Ve*H.A,B=NB(pe,Me[0],B.width,Fe,Be,at,Ve+(De?0:3),H.A),i(oe==Be),B&&Ai(Oe)&&nx(at,Ve,De,Fe,Be,H.A)}return 0}function ps(B){var H=B.ma,oe=H.ba.S,pe=11>oe,Me=oe==lA||oe==cA||oe==uA||oe==xF||oe==12||Ai(oe);if(H.memory=null,H.Ib=null,H.Jb=null,H.Nd=null,!Xw(H.Oa,B,Me?11:12))return 0;if(Me&&Ai(oe)&&qw(),B.da)alert("todo:use_scaling");else{if(pe){if(H.Ib=Vu,B.Kb){if(oe=B.U+1>>1,H.memory=s(B.U+2*oe),H.memory==null)return 0;H.ec=H.memory,H.fc=0,H.cc=H.ec,H.dc=H.fc+B.U,H.Mc=H.cc,H.Nc=H.dc+oe,H.Ib=mo,qw()}}else alert("todo:EmitYUV");Me&&(H.Jb=Al,pe&&up())}if(pe&&!e7){for(B=0;256>B;++B)gie[B]=89858*(B-128)+pA>>hA,vie[B]=-22014*(B-128)+pA,yie[B]=-45773*(B-128),_ie[B]=113618*(B-128)+pA>>hA;for(B=ax;B<EF;++B)H=76283*(B-16)+pA>>hA,bie[B-ax]=om(H,255),wie[B-ax]=om(H+8>>4,15);e7=1}return 1}function zi(B){var H=B.ma,oe=B.U,pe=B.T;return i(!(1&B.ka)),0>=oe||0>=pe?0:(oe=H.Ib(B,H),H.Jb!=null&&H.Jb(B,H,oe),H.Dc+=oe,1)}function Cs(B){B.ma.memory=null}function Ml(B,H,oe,pe){return He(B,8)!=47?0:(H[0]=He(B,14)+1,oe[0]=He(B,14)+1,pe[0]=He(B,1),He(B,3)!=0?0:!B.h)}function As(B,H){if(4>B)return B+1;var oe=B-2>>1;return(2+(1&B)<<oe)+He(H,oe)+1}function Un(B,H){return 120<H?H-120:1<=(oe=((oe=iie[H-1])>>4)*B+(8-(15&oe)))?oe:1;var oe}function Pn(B,H,oe){var pe=Le(oe),Me=B[H+=255&pe].g-8;return 0<Me&&(qe(oe,oe.u+8),pe=Le(oe),H+=B[H].value,H+=pe&(1<<Me)-1),qe(oe,oe.u+B[H].g),B[H].value}function Go(B,H,oe){return oe.g+=B.g,oe.value+=B.value<<H>>>0,i(8>=oe.g),B.g}function Il(B,H,oe){var pe=B.xc;return i((H=pe==0?0:B.vc[B.md*(oe>>pe)+(H>>pe)])<B.Wb),B.Ya[H]}function k_(B,H,oe,pe){var Me=B.ab,Fe=B.c*H,Oe=B.C;H=Oe+H;var De=oe,Be=pe;for(pe=B.Ta,oe=B.Ua;0<Me--;){var Ve=B.gc[Me],at=Oe,Ct=H,Ue=De,dt=Be,yt=(Be=pe,De=oe,Ve.Ea);switch(i(at<Ct),i(Ct<=Ve.nc),Ve.hc){case 2:Us(Ue,dt,(Ct-at)*yt,Be,De);break;case 0:var Pt=at,xt=Ct,kt=Be,Rt=De,ii=($i=Ve).Ea;Pt==0&&(Qw(Ue,dt,null,null,1,kt,Rt),pi(Ue,dt+1,0,0,ii-1,kt,Rt+1),dt+=ii,Rt+=ii,++Pt);for(var Ht=1<<$i.b,ir=Ht-1,ki=tt(ii,$i.b),vn=$i.K,$i=$i.w+(Pt>>$i.b)*ki;Pt<xt;){var zn=vn,Pl=$i,bn=1;for(x1(Ue,dt,kt,Rt-ii,1,kt,Rt);bn<ii;){var Wi=(bn&~ir)+Ht;Wi>ii&&(Wi=ii),(0,ex[zn[Pl++]>>8&15])(Ue,dt+ +bn,kt,Rt+bn-ii,Wi-bn,kt,Rt+bn),bn=Wi}dt+=ii,Rt+=ii,++Pt&ir||($i+=ki)}Ct!=Ve.nc&&n(Be,De-yt,Be,De+(Ct-at-1)*yt,yt);break;case 1:for(yt=Ue,xt=dt,ii=(Ue=Ve.Ea)-(Rt=Ue&~(kt=(dt=1<<Ve.b)-1)),Pt=tt(Ue,Ve.b),Ht=Ve.K,Ve=Ve.w+(at>>Ve.b)*Pt;at<Ct;){for(ir=Ht,ki=Ve,vn=new Mt,$i=xt+Rt,zn=xt+Ue;xt<$i;)Kt(ir[ki++],vn),tx(vn,yt,xt,dt,Be,De),xt+=dt,De+=dt;xt<zn&&(Kt(ir[ki++],vn),tx(vn,yt,xt,ii,Be,De),xt+=ii,De+=ii),++at&kt||(Ve+=Pt)}break;case 3:if(Ue==Be&&dt==De&&0<Ve.b){for(xt=Be,Ue=yt=De+(Ct-at)*yt-(Rt=(Ct-at)*tt(Ve.Ea,Ve.b)),dt=Be,kt=De,Pt=[],Rt=(ii=Rt)-1;0<=Rt;--Rt)Pt[Rt]=dt[kt+Rt];for(Rt=ii-1;0<=Rt;--Rt)xt[Ue+Rt]=Pt[Rt];nA(Ve,at,Ct,Be,yt,Be,De)}else nA(Ve,at,Ct,Ue,dt,Be,De)}De=pe,Be=oe}Be!=oe&&n(pe,oe,De,Be,Fe)}function zg(B,H){var oe=B.V,pe=B.Ba+B.c*B.C,Me=H-B.C;if(i(H<=B.l.o),i(16>=Me),0<Me){var Fe=B.l,Oe=B.Ta,De=B.Ua,Be=Fe.width;if(k_(B,Me,oe,pe),Me=De=[De],i((oe=B.C)<(pe=H)),i(Fe.v<Fe.va),pe>Fe.o&&(pe=Fe.o),oe<Fe.j){var Ve=Fe.j-oe;oe=Fe.j,Me[0]+=Ve*Be}if(oe>=pe?oe=0:(Me[0]+=4*Fe.v,Fe.ka=oe-Fe.j,Fe.U=Fe.va-Fe.v,Fe.T=pe-oe,oe=1),oe){if(De=De[0],11>(oe=B.ca).S){var at=oe.f.RGBA,Ct=(pe=oe.S,Me=Fe.U,Fe=Fe.T,Ve=at.eb,at.A),Ue=Fe;for(at=at.fb+B.Ma*at.A;0<Ue--;){var dt=Oe,yt=De,Pt=Me,xt=Ve,kt=at;switch(pe){case sA:ix(dt,yt,Pt,xt,kt);break;case lA:Zg(dt,yt,Pt,xt,kt);break;case SF:Zg(dt,yt,Pt,xt,kt),nx(xt,kt,0,Pt,1,0);break;case $B:q_(dt,yt,Pt,xt,kt);break;case cA:Ci(dt,yt,Pt,xt,kt,1);break;case CF:Ci(dt,yt,Pt,xt,kt,1),nx(xt,kt,0,Pt,1,0);break;case uA:Ci(dt,yt,Pt,xt,kt,0);break;case dA:Ci(dt,yt,Pt,xt,kt,0),nx(xt,kt,1,Pt,1,0);break;case xF:Xg(dt,yt,Pt,xt,kt);break;case AF:Xg(dt,yt,Pt,xt,kt),RB(xt,kt,Pt,1,0);break;case WB:Kg(dt,yt,Pt,xt,kt);break;default:i(0)}De+=Be,at+=Ct}B.Ma+=Fe}else alert("todo:EmitRescaledRowsYUVA");i(B.Ma<=oe.height)}}B.C=H,i(B.C<=B.i)}function ap(B){var H;if(0<B.ua)return 0;for(H=0;H<B.Wb;++H){var oe=B.Ya[H].G,pe=B.Ya[H].H;if(0<oe[1][pe[1]+0].g||0<oe[2][pe[2]+0].g||0<oe[3][pe[3]+0].g)return 0}return 1}function rm(B,H,oe,pe,Me,Fe){if(B.Z!=0){var Oe=B.qd,De=B.rd;for(i(e0[B.Z]!=null);H<oe;++H)e0[B.Z](Oe,De,pe,Me,pe,Me,Fe),Oe=pe,De=Me,Me+=Fe;B.qd=Oe,B.rd=De}}function sp(B,H){var oe=B.l.ma,pe=oe.Z==0||oe.Z==1?B.l.j:B.C;if(pe=B.C<pe?pe:B.C,i(H<=B.l.o),H>pe){var Me=B.l.width,Fe=oe.ca,Oe=oe.tb+Me*pe,De=B.V,Be=B.Ba+B.c*pe,Ve=B.gc;i(B.ab==1),i(Ve[0].hc==3),cm(Ve[0],pe,H,De,Be,Fe,Oe),rm(oe,pe,H,Fe,Oe,Me)}B.C=B.Ma=H}function lp(B,H,oe,pe,Me,Fe,Oe){var De=B.$/pe,Be=B.$%pe,Ve=B.m,at=B.s,Ct=oe+B.$,Ue=Ct;Me=oe+pe*Me;var dt=oe+pe*Fe,yt=280+at.ua,Pt=B.Pb?De:16777216,xt=0<at.ua?at.Wa:null,kt=at.wc,Rt=Ct<dt?Il(at,Be,De):null;i(B.C<Fe),i(dt<=Me);var ii=!1;e:for(;;){for(;ii||Ct<dt;){var Ht=0;if(De>=Pt){var ir=Ct-oe;i((Pt=B).Pb),Pt.wd=Pt.m,Pt.xd=ir,0<Pt.s.ua&&ke(Pt.s.Wa,Pt.s.vb),Pt=De+nie}if(Be&kt||(Rt=Il(at,Be,De)),i(Rt!=null),Rt.Qb&&(H[Ct]=Rt.qb,ii=!0),!ii)if(et(Ve),Rt.jc){Ht=Ve,ir=H;var ki=Ct,vn=Rt.pd[Le(Ht)&H_-1];i(Rt.jc),256>vn.g?(qe(Ht,Ht.u+vn.g),ir[ki]=vn.value,Ht=0):(qe(Ht,Ht.u+vn.g-256),i(256<=vn.value),Ht=vn.value),Ht==0&&(ii=!0)}else Ht=Pn(Rt.G[0],Rt.H[0],Ve);if(Ve.h)break;if(ii||256>Ht){if(!ii)if(Rt.nd)H[Ct]=(Rt.qb|Ht<<8)>>>0;else{if(et(Ve),ii=Pn(Rt.G[1],Rt.H[1],Ve),et(Ve),ir=Pn(Rt.G[2],Rt.H[2],Ve),ki=Pn(Rt.G[3],Rt.H[3],Ve),Ve.h)break;H[Ct]=(ki<<24|ii<<16|Ht<<8|ir)>>>0}if(ii=!1,++Ct,++Be>=pe&&(Be=0,++De,Oe!=null&&De<=Fe&&!(De%16)&&Oe(B,De),xt!=null))for(;Ue<Ct;)Ht=H[Ue++],xt.X[(506832829*Ht&4294967295)>>>xt.Mb]=Ht}else if(280>Ht){if(Ht=As(Ht-256,Ve),ir=Pn(Rt.G[4],Rt.H[4],Ve),et(Ve),ir=Un(pe,ir=As(ir,Ve)),Ve.h)break;if(Ct-oe<ir||Me-Ct<Ht)break e;for(ki=0;ki<Ht;++ki)H[Ct+ki]=H[Ct+ki-ir];for(Ct+=Ht,Be+=Ht;Be>=pe;)Be-=pe,++De,Oe!=null&&De<=Fe&&!(De%16)&&Oe(B,De);if(i(Ct<=Me),Be&kt&&(Rt=Il(at,Be,De)),xt!=null)for(;Ue<Ct;)Ht=H[Ue++],xt.X[(506832829*Ht&4294967295)>>>xt.Mb]=Ht}else{if(!(Ht<yt))break e;for(ii=Ht-280,i(xt!=null);Ue<Ct;)Ht=H[Ue++],xt.X[(506832829*Ht&4294967295)>>>xt.Mb]=Ht;Ht=Ct,i(!(ii>>>(ir=xt).Xa)),H[Ht]=ir.X[ii],ii=!0}ii||i(Ve.h==Ye(Ve))}if(B.Pb&&Ve.h&&Ct<Me)i(B.m.h),B.a=5,B.m=B.wd,B.$=B.xd,0<B.s.ua&&ke(B.s.vb,B.s.Wa);else{if(Ve.h)break e;Oe?.(B,De>Fe?Fe:De),B.a=0,B.$=Ct-oe}return 1}return B.a=3,0}function gh(B){i(B!=null),B.vc=null,B.yc=null,B.Ya=null;var H=B.Wa;H!=null&&(H.X=null),B.vb=null,i(B!=null)}function O_(){var B=new Hr;return B==null?null:(B.a=0,B.xb=YB,pr("Predictor","VP8LPredictors"),pr("Predictor","VP8LPredictors_C"),pr("PredictorAdd","VP8LPredictorsAdd"),pr("PredictorAdd","VP8LPredictorsAdd_C"),Us=yi,tx=li,ix=Nr,Zg=Qi,Xg=ji,Kg=cr,q_=Yr,ge.VP8LMapColor32b=lm,ge.VP8LMapColor8b=Jw,B)}function nm(B,H,oe,pe,Me){var Fe=1,Oe=[B],De=[H],Be=pe.m,Ve=pe.s,at=null,Ct=0;e:for(;;){if(oe)for(;Fe&&He(Be,1);){var Ue=Oe,dt=De,yt=pe,Pt=1,xt=yt.m,kt=yt.gc[yt.ab],Rt=He(xt,2);if(yt.Oc&1<<Rt)Fe=0;else{switch(yt.Oc|=1<<Rt,kt.hc=Rt,kt.Ea=Ue[0],kt.nc=dt[0],kt.K=[null],++yt.ab,i(4>=yt.ab),Rt){case 0:case 1:kt.b=He(xt,3)+2,Pt=nm(tt(kt.Ea,kt.b),tt(kt.nc,kt.b),0,yt,kt.K),kt.K=kt.K[0];break;case 3:var ii,Ht=He(xt,8)+1,ir=16<Ht?0:4<Ht?1:2<Ht?2:3;if(Ue[0]=tt(kt.Ea,ir),kt.b=ir,ii=Pt=nm(Ht,1,0,yt,kt.K)){var ki,vn=Ht,$i=kt,zn=1<<(8>>$i.b),Pl=s(zn);if(Pl==null)ii=0;else{var bn=$i.K[0],Wi=$i.w;for(Pl[0]=$i.K[0][0],ki=1;ki<1*vn;++ki)Pl[ki]=ot(bn[Wi+ki],Pl[ki-1]);for(;ki<4*zn;++ki)Pl[ki]=0;$i.K[0]=null,$i.K[0]=Pl,ii=1}}Pt=ii;break;case 2:break;default:i(0)}Fe=Pt}}if(Oe=Oe[0],De=De[0],Fe&&He(Be,1)&&!(Fe=1<=(Ct=He(Be,4))&&11>=Ct)){pe.a=3;break e}var vi;if(vi=Fe)t:{var $s,cn,Zn,Xa=pe,xc=Oe,_u=De,Ms=Ct,Bc=oe,yu=Xa.m,Ll=Xa.s,ao=[null],ko=1,Is=0,Oo=rie[Ms];i:for(;;){if(Bc&&He(yu,1)){var Sc=He(yu,3)+2,hp=tt(xc,Sc),Ws=tt(_u,Sc),Uu=hp*Ws;if(!nm(hp,Ws,0,Xa,ao))break i;for(ao=ao[0],Ll.xc=Sc,$s=0;$s<Uu;++$s){var Zo=ao[$s]>>8&65535;ao[$s]=Zo,Zo>=ko&&(ko=Zo+1)}}if(yu.h)break i;for(cn=0;5>cn;++cn){var kl=HB[cn];!cn&&0<Ms&&(kl+=1<<Ms),Is<kl&&(Is=kl)}var kd=l(ko*Oo,Se),vu=ko,Od=l(vu,Ee);if(Od==null)var Dd=null;else i(65536>=vu),Dd=Od;var zu=s(Is);if(Dd==null||zu==null||kd==null){Xa.a=1;break i}var Rd=kd;for($s=Zn=0;$s<ko;++$s){var pa=Dd[$s],Nd=pa.G,pp=pa.H,Z_=0,Pf=1,Cc=0;for(cn=0;5>cn;++cn){kl=HB[cn],Nd[cn]=Rd,pp[cn]=Zn,!cn&&0<Ms&&(kl+=1<<Ms);n:{var fA,TF=kl,gA=Xa,sx=zu,Cie=Rd,Aie=Zn,FF=0,t0=gA.m,Mie=He(t0,1);if(o(sx,0,0,TF),Mie){var Iie=He(t0,1)+1,Eie=He(t0,1),r7=He(t0,Eie==0?1:8);sx[r7]=1,Iie==2&&(sx[r7=He(t0,8)]=1);var _A=1}else{var n7=s(19),o7=He(t0,4)+4;if(19<o7){gA.a=3;var yA=0;break n}for(fA=0;fA<o7;++fA)n7[tie[fA]]=He(t0,3);var PF=void 0,lx=void 0,a7=gA,Tie=n7,vA=TF,s7=sx,LF=0,i0=a7.m,l7=8,c7=l(128,Se);r:for(;te(c7,0,7,Tie,19);){if(He(i0,1)){var Fie=2+2*He(i0,3);if((PF=2+He(i0,Fie))>vA)break r}else PF=vA;for(lx=0;lx<vA&&PF--;){et(i0);var u7=c7[0+(127&Le(i0))];qe(i0,i0.u+u7.g);var C1=u7.value;if(16>C1)s7[lx++]=C1,C1!=0&&(l7=C1);else{var Pie=C1==16,d7=C1-16,Lie=Jte[d7],h7=He(i0,Qte[d7])+Lie;if(lx+h7>vA)break r;for(var kie=Pie?l7:0;0<h7--;)s7[lx++]=kie}}LF=1;break r}LF||(a7.a=3),_A=LF}(_A=_A&&!t0.h)&&(FF=te(Cie,Aie,8,sx,TF)),_A&&FF!=0?yA=FF:(gA.a=3,yA=0)}if(yA==0)break i;if(Pf&&eie[cn]==1&&(Pf=Rd[Zn].g==0),Z_+=Rd[Zn].g,Zn+=yA,3>=cn){var cx,kF=zu[0];for(cx=1;cx<kl;++cx)zu[cx]>kF&&(kF=zu[cx]);Cc+=kF}}if(pa.nd=Pf,pa.Qb=0,Pf&&(pa.qb=(Nd[3][pp[3]+0].value<<24|Nd[1][pp[1]+0].value<<16|Nd[2][pp[2]+0].value)>>>0,Z_==0&&256>Nd[0][pp[0]+0].value&&(pa.Qb=1,pa.qb+=Nd[0][pp[0]+0].value<<8)),pa.jc=!pa.Qb&&6>Cc,pa.jc){var bA,Lf=pa;for(bA=0;bA<H_;++bA){var r0=bA,n0=Lf.pd[r0],wA=Lf.G[0][Lf.H[0]+r0];256<=wA.value?(n0.g=wA.g+256,n0.value=wA.value):(n0.g=0,n0.value=0,r0>>=Go(wA,8,n0),r0>>=Go(Lf.G[1][Lf.H[1]+r0],16,n0),r0>>=Go(Lf.G[2][Lf.H[2]+r0],0,n0),Go(Lf.G[3][Lf.H[3]+r0],24,n0))}}}Ll.vc=ao,Ll.Wb=ko,Ll.Ya=Dd,Ll.yc=kd,vi=1;break t}vi=0}if(!(Fe=vi)){pe.a=3;break e}if(0<Ct){if(Ve.ua=1<<Ct,!de(Ve.Wa,Ct)){pe.a=1,Fe=0;break e}}else Ve.ua=0;var OF=pe,p7=Oe,Oie=De,DF=OF.s,RF=DF.xc;if(OF.c=p7,OF.i=Oie,DF.md=tt(p7,RF),DF.wc=RF==0?-1:(1<<RF)-1,oe){pe.xb=die;break e}if((at=s(Oe*De))==null){pe.a=1,Fe=0;break e}Fe=(Fe=lp(pe,at,0,Oe,De,De,null))&&!Be.h;break e}return Fe?(Me!=null?Me[0]=at:(i(at==null),i(oe)),pe.$=0,oe||gh(Ve)):gh(Ve),Fe}function D_(B,H){var oe=B.c*B.i,pe=oe+H+16*H;return i(B.c<=H),B.V=s(pe),B.V==null?(B.Ta=null,B.Ua=0,B.a=1,0):(B.Ta=B.V,B.Ua=B.Ba+oe+H,1)}function h1(B,H){var oe=B.C,pe=H-oe,Me=B.V,Fe=B.Ba+B.c*oe;for(i(H<=B.l.o);0<pe;){var Oe=16<pe?16:pe,De=B.l.ma,Be=B.l.width,Ve=Be*Oe,at=De.ca,Ct=De.tb+Be*oe,Ue=B.Ta,dt=B.Ua;k_(B,Oe,Me,Fe),BB(Ue,dt,at,Ct,Ve),rm(De,oe,oe+Oe,at,Ct,Be),pe-=Oe,Me+=Oe*B.c,oe+=Oe}i(oe==H),B.C=B.Ma=H}function p1(){this.ub=this.yd=this.td=this.Rb=0}function m1(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function oF(){this.Fb=this.Bb=this.Cb=0,this.Zb=s(4),this.Lb=s(4)}function Rw(){this.Yb=function(){var B=[];return function H(oe,pe,Me){for(var Fe=Me[pe],Oe=0;Oe<Fe&&(oe.push(Me.length>pe+1?[]:0),!(Me.length<pe+1));Oe++)H(oe[Oe],pe+1,Me)}(B,0,[3,11]),B}()}function jC(){this.jb=s(3),this.Wc=h([4,8],Rw),this.Xc=h([4,17],Rw)}function VC(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new s(4),this.od=new s(4)}function _h(){this.ld=this.La=this.dd=this.tc=0}function Nw(){this.Na=this.la=0}function UC(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Bw(){this.ad=s(384),this.Za=0,this.Ob=s(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function zC(){this.uc=this.M=this.Nb=0,this.wa=Array(new _h),this.Y=0,this.ya=Array(new Bw),this.aa=0,this.l=new f1}function $C(){this.y=s(16),this.f=s(8),this.ea=s(8)}function WC(){this.cb=this.a=0,this.sc="",this.m=new ye,this.Od=new p1,this.Kc=new m1,this.ed=new VC,this.Qa=new oF,this.Ic=this.$c=this.Aa=0,this.D=new zC,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=l(8,ye),this.ia=0,this.pb=l(4,UC),this.Pa=new jC,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new $C),this.Hd=0,this.rb=Array(new Nw),this.sb=0,this.wa=Array(new _h),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Bw),this.L=this.aa=0,this.gd=h([4,2],_h),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function om(B,H){return 0>B?0:B>H?H:B}function f1(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function aF(){var B=new WC;return B!=null&&(B.a=0,B.sc="OK",B.cb=0,B.Xb=0,ox||(ox=g1)),B}function ol(B,H,oe){return B.a==0&&(B.a=H,B.sc=oe,B.cb=0),0}function HC(B,H,oe){return 3<=oe&&B[H+0]==157&&B[H+1]==1&&B[H+2]==42}function am(B,H){if(B==null)return 0;if(B.a=0,B.sc="OK",H==null)return ol(B,2,"null VP8Io passed to VP8GetHeaders()");var oe=H.data,pe=H.w,Me=H.ha;if(4>Me)return ol(B,7,"Truncated header.");var Fe=oe[pe+0]|oe[pe+1]<<8|oe[pe+2]<<16,Oe=B.Od;if(Oe.Rb=!(1&Fe),Oe.td=Fe>>1&7,Oe.yd=Fe>>4&1,Oe.ub=Fe>>5,3<Oe.td)return ol(B,3,"Incorrect keyframe parameters.");if(!Oe.yd)return ol(B,4,"Frame not displayable.");pe+=3,Me-=3;var De=B.Kc;if(Oe.Rb){if(7>Me)return ol(B,7,"cannot parse picture header");if(!HC(oe,pe,Me))return ol(B,3,"Bad code word");De.c=16383&(oe[pe+4]<<8|oe[pe+3]),De.Td=oe[pe+4]>>6,De.i=16383&(oe[pe+6]<<8|oe[pe+5]),De.Ud=oe[pe+6]>>6,pe+=7,Me-=7,B.za=De.c+15>>4,B.Ub=De.i+15>>4,H.width=De.c,H.height=De.i,H.Da=0,H.j=0,H.v=0,H.va=H.width,H.o=H.height,H.da=0,H.ib=H.width,H.hb=H.height,H.U=H.width,H.T=H.height,o((Fe=B.Pa).jb,0,255,Fe.jb.length),i((Fe=B.Qa)!=null),Fe.Cb=0,Fe.Bb=0,Fe.Fb=1,o(Fe.Zb,0,0,Fe.Zb.length),o(Fe.Lb,0,0,Fe.Lb)}if(Oe.ub>Me)return ol(B,7,"bad partition length");je(Fe=B.m,oe,pe,Oe.ub),pe+=Oe.ub,Me-=Oe.ub,Oe.Rb&&(De.Ld=mt(Fe),De.Kd=mt(Fe)),De=B.Qa;var Be,Ve=B.Pa;if(i(Fe!=null),i(De!=null),De.Cb=mt(Fe),De.Cb){if(De.Bb=mt(Fe),mt(Fe)){for(De.Fb=mt(Fe),Be=0;4>Be;++Be)De.Zb[Be]=mt(Fe)?ze(Fe,7):0;for(Be=0;4>Be;++Be)De.Lb[Be]=mt(Fe)?ze(Fe,6):0}if(De.Bb)for(Be=0;3>Be;++Be)Ve.jb[Be]=mt(Fe)?Ne(Fe,8):255}else De.Bb=0;if(Fe.Ka)return ol(B,3,"cannot parse segment header");if((De=B.ed).zd=mt(Fe),De.Tb=Ne(Fe,6),De.wb=Ne(Fe,3),De.Pc=mt(Fe),De.Pc&&mt(Fe)){for(Ve=0;4>Ve;++Ve)mt(Fe)&&(De.vd[Ve]=ze(Fe,6));for(Ve=0;4>Ve;++Ve)mt(Fe)&&(De.od[Ve]=ze(Fe,6))}if(B.L=De.Tb==0?0:De.zd?1:2,Fe.Ka)return ol(B,3,"cannot parse filter header");var at=Me;if(Me=Be=pe,pe=Be+at,De=at,B.Xb=(1<<Ne(B.m,2))-1,at<3*(Ve=B.Xb))oe=7;else{for(Be+=3*Ve,De-=3*Ve,at=0;at<Ve;++at){var Ct=oe[Me+0]|oe[Me+1]<<8|oe[Me+2]<<16;Ct>De&&(Ct=De),je(B.Jc[+at],oe,Be,Ct),Be+=Ct,De-=Ct,Me+=3}je(B.Jc[+Ve],oe,Be,De),oe=Be<pe?0:5}if(oe!=0)return ol(B,oe,"cannot parse partitions");for(oe=Ne(Be=B.m,7),Me=mt(Be)?ze(Be,4):0,pe=mt(Be)?ze(Be,4):0,De=mt(Be)?ze(Be,4):0,Ve=mt(Be)?ze(Be,4):0,Be=mt(Be)?ze(Be,4):0,at=B.Qa,Ct=0;4>Ct;++Ct){if(at.Cb){var Ue=at.Zb[Ct];at.Fb||(Ue+=oe)}else{if(0<Ct){B.pb[Ct]=B.pb[0];continue}Ue=oe}var dt=B.pb[Ct];dt.Sc[0]=MF[om(Ue+Me,127)],dt.Sc[1]=IF[om(Ue+0,127)],dt.Eb[0]=2*MF[om(Ue+pe,127)],dt.Eb[1]=101581*IF[om(Ue+De,127)]>>16,8>dt.Eb[1]&&(dt.Eb[1]=8),dt.Qc[0]=MF[om(Ue+Ve,117)],dt.Qc[1]=IF[om(Ue+Be,127)],dt.lc=Ue+Be}if(!Oe.Rb)return ol(B,4,"Not a key frame.");for(mt(Fe),Oe=B.Pa,oe=0;4>oe;++oe){for(Me=0;8>Me;++Me)for(pe=0;3>pe;++pe)for(De=0;11>De;++De)Ve=At(Fe,cie[oe][Me][pe][De])?Ne(Fe,8):sie[oe][Me][pe][De],Oe.Wc[oe][Me].Yb[pe][De]=Ve;for(Me=0;17>Me;++Me)Oe.Xc[oe][Me]=Oe.Wc[oe][uie[Me]]}return B.kc=mt(Fe),B.kc&&(B.Bd=Ne(Fe,8)),B.cb=1}function g1(B,H,oe,pe,Me,Fe,Oe){var De=H[Me].Yb[oe];for(oe=0;16>Me;++Me){if(!At(B,De[oe+0]))return Me;for(;!At(B,De[oe+1]);)if(De=H[++Me].Yb[0],oe=0,Me==16)return 16;var Be=H[Me+1].Yb;if(At(B,De[oe+2])){var Ve=B,at=0;if(At(Ve,(Ue=De)[(Ct=oe)+3]))if(At(Ve,Ue[Ct+6])){for(De=0,Ct=2*(at=At(Ve,Ue[Ct+8]))+(Ue=At(Ve,Ue[Ct+9+at])),at=0,Ue=oie[Ct];Ue[De];++De)at+=at+At(Ve,Ue[De]);at+=3+(8<<Ct)}else At(Ve,Ue[Ct+7])?(at=7+2*At(Ve,165),at+=At(Ve,145)):at=5+At(Ve,159);else at=At(Ve,Ue[Ct+4])?3+At(Ve,Ue[Ct+5]):2;De=Be[2]}else at=1,De=Be[1];Be=Oe+aie[Me],0>(Ve=B).b&&ft(Ve);var Ct,Ue=Ve.b,dt=(Ct=Ve.Ca>>1)-(Ve.I>>Ue)>>31;--Ve.b,Ve.Ca+=dt,Ve.Ca|=1,Ve.I-=(Ct+1&dt)<<Ue,Fe[Be]=((at^dt)-dt)*pe[(0<Me)+0]}return 16}function qC(B){var H=B.rb[B.sb-1];H.la=0,H.Na=0,o(B.zc,0,0,B.zc.length),B.ja=0}function yh(B,H,oe,pe,Me){Me=B[H+oe+32*pe]+(Me>>3),B[H+oe+32*pe]=-256&Me?0>Me?0:255:Me}function El(B,H,oe,pe,Me,Fe){yh(B,H,0,oe,pe+Me),yh(B,H,1,oe,pe+Fe),yh(B,H,2,oe,pe-Fe),yh(B,H,3,oe,pe-Me)}function yf(B){return(20091*B>>16)+B}function YC(B,H,oe,pe){var Me,Fe=0,Oe=s(16);for(Me=0;4>Me;++Me){var De=B[H+0]+B[H+8],Be=B[H+0]-B[H+8],Ve=(35468*B[H+4]>>16)-yf(B[H+12]),at=yf(B[H+4])+(35468*B[H+12]>>16);Oe[Fe+0]=De+at,Oe[Fe+1]=Be+Ve,Oe[Fe+2]=Be-Ve,Oe[Fe+3]=De-at,Fe+=4,H++}for(Me=Fe=0;4>Me;++Me)De=(B=Oe[Fe+0]+4)+Oe[Fe+8],Be=B-Oe[Fe+8],Ve=(35468*Oe[Fe+4]>>16)-yf(Oe[Fe+12]),yh(oe,pe,0,0,De+(at=yf(Oe[Fe+4])+(35468*Oe[Fe+12]>>16))),yh(oe,pe,1,0,Be+Ve),yh(oe,pe,2,0,Be-Ve),yh(oe,pe,3,0,De-at),Fe++,pe+=32}function sF(B,H,oe,pe){var Me=B[H+0]+4,Fe=35468*B[H+4]>>16,Oe=yf(B[H+4]),De=35468*B[H+1]>>16;El(oe,pe,0,Me+Oe,B=yf(B[H+1]),De),El(oe,pe,1,Me+Fe,B,De),El(oe,pe,2,Me-Fe,B,De),El(oe,pe,3,Me-Oe,B,De)}function lF(B,H,oe,pe,Me){YC(B,H,oe,pe),Me&&YC(B,H+16,oe,pe+4)}function sm(B,H,oe,pe){Y_(B,H+0,oe,pe,1),Y_(B,H+32,oe,pe+128,1)}function ZC(B,H,oe,pe){var Me;for(B=B[H+0]+4,Me=0;4>Me;++Me)for(H=0;4>H;++H)yh(oe,pe,H,Me,B)}function XC(B,H,oe,pe){B[H+0]&&Co(B,H+0,oe,pe),B[H+16]&&Co(B,H+16,oe,pe+4),B[H+32]&&Co(B,H+32,oe,pe+128),B[H+48]&&Co(B,H+48,oe,pe+128+4)}function _1(B,H,oe,pe){var Me,Fe=s(16);for(Me=0;4>Me;++Me){var Oe=B[H+0+Me]+B[H+12+Me],De=B[H+4+Me]+B[H+8+Me],Be=B[H+4+Me]-B[H+8+Me],Ve=B[H+0+Me]-B[H+12+Me];Fe[0+Me]=Oe+De,Fe[8+Me]=Oe-De,Fe[4+Me]=Ve+Be,Fe[12+Me]=Ve-Be}for(Me=0;4>Me;++Me)Oe=(B=Fe[0+4*Me]+3)+Fe[3+4*Me],De=Fe[1+4*Me]+Fe[2+4*Me],Be=Fe[1+4*Me]-Fe[2+4*Me],Ve=B-Fe[3+4*Me],oe[pe+0]=Oe+De>>3,oe[pe+16]=Ve+Be>>3,oe[pe+32]=Oe-De>>3,oe[pe+48]=Ve-Be>>3,pe+=64}function R_(B,H,oe){var pe,Me=H-32,Fe=Ld,Oe=255-B[Me-1];for(pe=0;pe<oe;++pe){var De,Be=Fe,Ve=Oe+B[H-1];for(De=0;De<oe;++De)B[H+De]=Be[Ve+B[Me+De]];H+=32}}function cF(B,H){R_(B,H,4)}function uF(B,H){R_(B,H,8)}function dF(B,H){R_(B,H,16)}function Gw(B,H){var oe;for(oe=0;16>oe;++oe)n(B,H+32*oe,B,H-32,16)}function KC(B,H){var oe;for(oe=16;0<oe;--oe)o(B,H,B[H-1],16),H+=32}function cp(B,H,oe){var pe;for(pe=0;16>pe;++pe)o(H,oe+32*pe,B,16)}function hF(B,H){var oe,pe=16;for(oe=0;16>oe;++oe)pe+=B[H-1+32*oe]+B[H+oe-32];cp(pe>>5,B,H)}function N_(B,H){var oe,pe=8;for(oe=0;16>oe;++oe)pe+=B[H-1+32*oe];cp(pe>>4,B,H)}function jw(B,H){var oe,pe=8;for(oe=0;16>oe;++oe)pe+=B[H+oe-32];cp(pe>>4,B,H)}function pF(B,H){cp(128,B,H)}function Zr(B,H,oe){return B+2*H+oe+2>>2}function mF(B,H){var oe,pe=H-32;for(pe=new Uint8Array([Zr(B[pe-1],B[pe+0],B[pe+1]),Zr(B[pe+0],B[pe+1],B[pe+2]),Zr(B[pe+1],B[pe+2],B[pe+3]),Zr(B[pe+2],B[pe+3],B[pe+4])]),oe=0;4>oe;++oe)n(B,H+32*oe,pe,0,pe.length)}function fF(B,H){var oe=B[H-1],pe=B[H-1+32],Me=B[H-1+64],Fe=B[H-1+96];ht(B,H+0,16843009*Zr(B[H-1-32],oe,pe)),ht(B,H+32,16843009*Zr(oe,pe,Me)),ht(B,H+64,16843009*Zr(pe,Me,Fe)),ht(B,H+96,16843009*Zr(Me,Fe,Fe))}function gF(B,H){var oe,pe=4;for(oe=0;4>oe;++oe)pe+=B[H+oe-32]+B[H-1+32*oe];for(pe>>=3,oe=0;4>oe;++oe)o(B,H+32*oe,pe,4)}function vf(B,H){var oe=B[H-1+0],pe=B[H-1+32],Me=B[H-1+64],Fe=B[H-1-32],Oe=B[H+0-32],De=B[H+1-32],Be=B[H+2-32],Ve=B[H+3-32];B[H+0+96]=Zr(pe,Me,B[H-1+96]),B[H+1+96]=B[H+0+64]=Zr(oe,pe,Me),B[H+2+96]=B[H+1+64]=B[H+0+32]=Zr(Fe,oe,pe),B[H+3+96]=B[H+2+64]=B[H+1+32]=B[H+0+0]=Zr(Oe,Fe,oe),B[H+3+64]=B[H+2+32]=B[H+1+0]=Zr(De,Oe,Fe),B[H+3+32]=B[H+2+0]=Zr(Be,De,Oe),B[H+3+0]=Zr(Ve,Be,De)}function bf(B,H){var oe=B[H+1-32],pe=B[H+2-32],Me=B[H+3-32],Fe=B[H+4-32],Oe=B[H+5-32],De=B[H+6-32],Be=B[H+7-32];B[H+0+0]=Zr(B[H+0-32],oe,pe),B[H+1+0]=B[H+0+32]=Zr(oe,pe,Me),B[H+2+0]=B[H+1+32]=B[H+0+64]=Zr(pe,Me,Fe),B[H+3+0]=B[H+2+32]=B[H+1+64]=B[H+0+96]=Zr(Me,Fe,Oe),B[H+3+32]=B[H+2+64]=B[H+1+96]=Zr(Fe,Oe,De),B[H+3+64]=B[H+2+96]=Zr(Oe,De,Be),B[H+3+96]=Zr(De,Be,Be)}function _F(B,H){var oe=B[H-1+0],pe=B[H-1+32],Me=B[H-1+64],Fe=B[H-1-32],Oe=B[H+0-32],De=B[H+1-32],Be=B[H+2-32],Ve=B[H+3-32];B[H+0+0]=B[H+1+64]=Fe+Oe+1>>1,B[H+1+0]=B[H+2+64]=Oe+De+1>>1,B[H+2+0]=B[H+3+64]=De+Be+1>>1,B[H+3+0]=Be+Ve+1>>1,B[H+0+96]=Zr(Me,pe,oe),B[H+0+64]=Zr(pe,oe,Fe),B[H+0+32]=B[H+1+96]=Zr(oe,Fe,Oe),B[H+1+32]=B[H+2+96]=Zr(Fe,Oe,De),B[H+2+32]=B[H+3+96]=Zr(Oe,De,Be),B[H+3+32]=Zr(De,Be,Ve)}function yF(B,H){var oe=B[H+0-32],pe=B[H+1-32],Me=B[H+2-32],Fe=B[H+3-32],Oe=B[H+4-32],De=B[H+5-32],Be=B[H+6-32],Ve=B[H+7-32];B[H+0+0]=oe+pe+1>>1,B[H+1+0]=B[H+0+64]=pe+Me+1>>1,B[H+2+0]=B[H+1+64]=Me+Fe+1>>1,B[H+3+0]=B[H+2+64]=Fe+Oe+1>>1,B[H+0+32]=Zr(oe,pe,Me),B[H+1+32]=B[H+0+96]=Zr(pe,Me,Fe),B[H+2+32]=B[H+1+96]=Zr(Me,Fe,Oe),B[H+3+32]=B[H+2+96]=Zr(Fe,Oe,De),B[H+3+64]=Zr(Oe,De,Be),B[H+3+96]=Zr(De,Be,Ve)}function y1(B,H){var oe=B[H-1+0],pe=B[H-1+32],Me=B[H-1+64],Fe=B[H-1+96];B[H+0+0]=oe+pe+1>>1,B[H+2+0]=B[H+0+32]=pe+Me+1>>1,B[H+2+32]=B[H+0+64]=Me+Fe+1>>1,B[H+1+0]=Zr(oe,pe,Me),B[H+3+0]=B[H+1+32]=Zr(pe,Me,Fe),B[H+3+32]=B[H+1+64]=Zr(Me,Fe,Fe),B[H+3+64]=B[H+2+64]=B[H+0+96]=B[H+1+96]=B[H+2+96]=B[H+3+96]=Fe}function Vw(B,H){var oe=B[H-1+0],pe=B[H-1+32],Me=B[H-1+64],Fe=B[H-1+96],Oe=B[H-1-32],De=B[H+0-32],Be=B[H+1-32],Ve=B[H+2-32];B[H+0+0]=B[H+2+32]=oe+Oe+1>>1,B[H+0+32]=B[H+2+64]=pe+oe+1>>1,B[H+0+64]=B[H+2+96]=Me+pe+1>>1,B[H+0+96]=Fe+Me+1>>1,B[H+3+0]=Zr(De,Be,Ve),B[H+2+0]=Zr(Oe,De,Be),B[H+1+0]=B[H+3+32]=Zr(oe,Oe,De),B[H+1+32]=B[H+3+64]=Zr(pe,oe,Oe),B[H+1+64]=B[H+3+96]=Zr(Me,pe,oe),B[H+1+96]=Zr(Fe,Me,pe)}function B_(B,H){var oe;for(oe=0;8>oe;++oe)n(B,H+32*oe,B,H-32,8)}function vF(B,H){var oe;for(oe=0;8>oe;++oe)o(B,H,B[H-1],8),H+=32}function wf(B,H,oe){var pe;for(pe=0;8>pe;++pe)o(H,oe+32*pe,B,8)}function bF(B,H){var oe,pe=8;for(oe=0;8>oe;++oe)pe+=B[H+oe-32]+B[H-1+32*oe];wf(pe>>4,B,H)}function Uw(B,H){var oe,pe=4;for(oe=0;8>oe;++oe)pe+=B[H+oe-32];wf(pe>>3,B,H)}function zw(B,H){var oe,pe=4;for(oe=0;8>oe;++oe)pe+=B[H-1+32*oe];wf(pe>>3,B,H)}function QC(B,H){wf(128,B,H)}function xf(B,H,oe){var pe=B[H-oe],Me=B[H+0],Fe=3*(Me-pe)+wF[1020+B[H-2*oe]-B[H+oe]],Oe=aA[112+(Fe+4>>3)];B[H-oe]=Ld[255+pe+aA[112+(Fe+3>>3)]],B[H+0]=Ld[255+Me-Oe]}function $w(B,H,oe,pe){var Me=B[H+0],Fe=B[H+oe];return wh[255+B[H-2*oe]-B[H-oe]]>pe||wh[255+Fe-Me]>pe}function v1(B,H,oe,pe){return 4*wh[255+B[H-oe]-B[H+0]]+wh[255+B[H-2*oe]-B[H+oe]]<=pe}function Ww(B,H,oe,pe,Me){var Fe=B[H-3*oe],Oe=B[H-2*oe],De=B[H-oe],Be=B[H+0],Ve=B[H+oe],at=B[H+2*oe],Ct=B[H+3*oe];return 4*wh[255+De-Be]+wh[255+Oe-Ve]>pe?0:wh[255+B[H-4*oe]-Fe]<=Me&&wh[255+Fe-Oe]<=Me&&wh[255+Oe-De]<=Me&&wh[255+Ct-at]<=Me&&wh[255+at-Ve]<=Me&&wh[255+Ve-Be]<=Me}function G_(B,H,oe,pe){var Me=2*pe+1;for(pe=0;16>pe;++pe)v1(B,H+pe,oe,Me)&&xf(B,H+pe,oe)}function Hw(B,H,oe,pe){var Me=2*pe+1;for(pe=0;16>pe;++pe)v1(B,H+pe*oe,1,Me)&&xf(B,H+pe*oe,1)}function JC(B,H,oe,pe){var Me;for(Me=3;0<Me;--Me)G_(B,H+=4*oe,oe,pe)}function eA(B,H,oe,pe){var Me;for(Me=3;0<Me;--Me)Hw(B,H+=4,oe,pe)}function Sf(B,H,oe,pe,Me,Fe,Oe,De){for(Fe=2*Fe+1;0<Me--;){if(Ww(B,H,oe,Fe,Oe))if($w(B,H,oe,De))xf(B,H,oe);else{var Be=B,Ve=H,at=oe,Ct=Be[Ve-2*at],Ue=Be[Ve-at],dt=Be[Ve+0],yt=Be[Ve+at],Pt=Be[Ve+2*at],xt=27*(Rt=wF[1020+3*(dt-Ue)+wF[1020+Ct-yt]])+63>>7,kt=18*Rt+63>>7,Rt=9*Rt+63>>7;Be[Ve-3*at]=Ld[255+Be[Ve-3*at]+Rt],Be[Ve-2*at]=Ld[255+Ct+kt],Be[Ve-at]=Ld[255+Ue+xt],Be[Ve+0]=Ld[255+dt-xt],Be[Ve+at]=Ld[255+yt-kt],Be[Ve+2*at]=Ld[255+Pt-Rt]}H+=pe}}function Cf(B,H,oe,pe,Me,Fe,Oe,De){for(Fe=2*Fe+1;0<Me--;){if(Ww(B,H,oe,Fe,Oe))if($w(B,H,oe,De))xf(B,H,oe);else{var Be=B,Ve=H,at=oe,Ct=Be[Ve-at],Ue=Be[Ve+0],dt=Be[Ve+at],yt=aA[112+(4+(Pt=3*(Ue-Ct))>>3)],Pt=aA[112+(Pt+3>>3)],xt=yt+1>>1;Be[Ve-2*at]=Ld[255+Be[Ve-2*at]+xt],Be[Ve-at]=Ld[255+Ct+Pt],Be[Ve+0]=Ld[255+Ue-yt],Be[Ve+at]=Ld[255+dt-xt]}H+=pe}}function tA(B,H,oe,pe,Me,Fe){Sf(B,H,oe,1,16,pe,Me,Fe)}function j_(B,H,oe,pe,Me,Fe){Sf(B,H,1,oe,16,pe,Me,Fe)}function iA(B,H,oe,pe,Me,Fe){var Oe;for(Oe=3;0<Oe;--Oe)Cf(B,H+=4*oe,oe,1,16,pe,Me,Fe)}function re(B,H,oe,pe,Me,Fe){var Oe;for(Oe=3;0<Oe;--Oe)Cf(B,H+=4,1,oe,16,pe,Me,Fe)}function Ce(B,H,oe,pe,Me,Fe,Oe,De){Sf(B,H,Me,1,8,Fe,Oe,De),Sf(oe,pe,Me,1,8,Fe,Oe,De)}function $e(B,H,oe,pe,Me,Fe,Oe,De){Sf(B,H,1,Me,8,Fe,Oe,De),Sf(oe,pe,1,Me,8,Fe,Oe,De)}function rt(B,H,oe,pe,Me,Fe,Oe,De){Cf(B,H+4*Me,Me,1,8,Fe,Oe,De),Cf(oe,pe+4*Me,Me,1,8,Fe,Oe,De)}function gt(B,H,oe,pe,Me,Fe,Oe,De){Cf(B,H+4,1,Me,8,Fe,Oe,De),Cf(oe,pe+4,1,Me,8,Fe,Oe,De)}function Dt(){this.ba=new xr,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Vn,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Wt(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Ni(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Ji(){this.ua=0,this.Wa=new Ze,this.vb=new Ze,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new Ee,this.yc=new Se}function Hr(){this.xb=this.a=0,this.l=new f1,this.ca=new xr,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new Ae,this.Pb=0,this.wd=new Ae,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Ji,this.ab=0,this.gc=l(4,Ni),this.Oc=0}function mn(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new f1,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function oo(B,H,oe,pe,Me,Fe,Oe){for(B=B==null?0:B[H+0],H=0;H<Oe;++H)Me[Fe+H]=B+oe[pe+H]&255,B=Me[Fe+H]}function ms(B,H,oe,pe,Me,Fe,Oe){var De;if(B==null)oo(null,null,oe,pe,Me,Fe,Oe);else for(De=0;De<Oe;++De)Me[Fe+De]=B[H+De]+oe[pe+De]&255}function al(B,H,oe,pe,Me,Fe,Oe){if(B==null)oo(null,null,oe,pe,Me,Fe,Oe);else{var De,Be=B[H+0],Ve=Be,at=Be;for(De=0;De<Oe;++De)Ve=at+(Be=B[H+De])-Ve,at=oe[pe+De]+(-256&Ve?0>Ve?0:255:Ve)&255,Ve=Be,Me[Fe+De]=at}}function Jo(B,H,oe,pe){var Me=H.width,Fe=H.o;if(i(B!=null&&H!=null),0>oe||0>=pe||oe+pe>Fe)return null;if(!B.Cc){if(B.ga==null){var Oe;if(B.ga=new mn,(Oe=B.ga==null)||(Oe=H.width*H.o,i(B.Gb.length==0),B.Gb=s(Oe),B.Uc=0,B.Gb==null?Oe=0:(B.mb=B.Gb,B.nb=B.Uc,B.rc=null,Oe=1),Oe=!Oe),!Oe){Oe=B.ga;var De=B.Fa,Be=B.P,Ve=B.qc,at=B.mb,Ct=B.nb,Ue=Be+1,dt=Ve-1,yt=Oe.l;if(i(De!=null&&at!=null&&H!=null),e0[0]=null,e0[1]=oo,e0[2]=ms,e0[3]=al,Oe.ca=at,Oe.tb=Ct,Oe.c=H.width,Oe.i=H.height,i(0<Oe.c&&0<Oe.i),1>=Ve)H=0;else if(Oe.$a=3&De[Be+0],Oe.Z=De[Be+0]>>2&3,Oe.Lc=De[Be+0]>>4&3,Be=De[Be+0]>>6&3,0>Oe.$a||1<Oe.$a||4<=Oe.Z||1<Oe.Lc||Be)H=0;else if(yt.put=zi,yt.ac=ps,yt.bc=Cs,yt.ma=Oe,yt.width=H.width,yt.height=H.height,yt.Da=H.Da,yt.v=H.v,yt.va=H.va,yt.j=H.j,yt.o=H.o,Oe.$a)e:{i(Oe.$a==1),H=O_();t:for(;;){if(H==null){H=0;break e}if(i(Oe!=null),Oe.mc=H,H.c=Oe.c,H.i=Oe.i,H.l=Oe.l,H.l.ma=Oe,H.l.width=Oe.c,H.l.height=Oe.i,H.a=0,Re(H.m,De,Ue,dt),!nm(Oe.c,Oe.i,1,H,null)||(H.ab==1&&H.gc[0].hc==3&&ap(H.s)?(Oe.ic=1,De=H.c*H.i,H.Ta=null,H.Ua=0,H.V=s(De),H.Ba=0,H.V==null?(H.a=1,H=0):H=1):(Oe.ic=0,H=D_(H,Oe.c)),!H))break t;H=1;break e}Oe.mc=null,H=0}else H=dt>=Oe.c*Oe.i;Oe=!H}if(Oe)return null;B.ga.Lc!=1?B.Ga=0:pe=Fe-oe}i(B.ga!=null),i(oe+pe<=Fe);e:{if(H=(De=B.ga).c,Fe=De.l.o,De.$a==0){if(Ue=B.rc,dt=B.Vc,yt=B.Fa,Be=B.P+1+oe*H,Ve=B.mb,at=B.nb+oe*H,i(Be<=B.P+B.qc),De.Z!=0)for(i(e0[De.Z]!=null),Oe=0;Oe<pe;++Oe)e0[De.Z](Ue,dt,yt,Be,Ve,at,H),Ue=Ve,dt=at,at+=H,Be+=H;else for(Oe=0;Oe<pe;++Oe)n(Ve,at,yt,Be,H),Ue=Ve,dt=at,at+=H,Be+=H;B.rc=Ue,B.Vc=dt}else{if(i(De.mc!=null),H=oe+pe,i((Oe=De.mc)!=null),i(H<=Oe.i),Oe.C>=H)H=1;else if(De.ic||up(),De.ic){De=Oe.V,Ue=Oe.Ba,dt=Oe.c;var Pt=Oe.i,xt=(yt=1,Be=Oe.$/dt,Ve=Oe.$%dt,at=Oe.m,Ct=Oe.s,Oe.$),kt=dt*Pt,Rt=dt*H,ii=Ct.wc,Ht=xt<Rt?Il(Ct,Ve,Be):null;i(xt<=kt),i(H<=Pt),i(ap(Ct));t:for(;;){for(;!at.h&&xt<Rt;){if(Ve&ii||(Ht=Il(Ct,Ve,Be)),i(Ht!=null),et(at),256>(Pt=Pn(Ht.G[0],Ht.H[0],at)))De[Ue+xt]=Pt,++xt,++Ve>=dt&&(Ve=0,++Be<=H&&!(Be%16)&&sp(Oe,Be));else{if(!(280>Pt)){yt=0;break t}Pt=As(Pt-256,at);var ir,ki=Pn(Ht.G[4],Ht.H[4],at);if(et(at),!(xt>=(ki=Un(dt,ki=As(ki,at)))&&kt-xt>=Pt)){yt=0;break t}for(ir=0;ir<Pt;++ir)De[Ue+xt+ir]=De[Ue+xt+ir-ki];for(xt+=Pt,Ve+=Pt;Ve>=dt;)Ve-=dt,++Be<=H&&!(Be%16)&&sp(Oe,Be);xt<Rt&&Ve&ii&&(Ht=Il(Ct,Ve,Be))}i(at.h==Ye(at))}sp(Oe,Be>H?H:Be);break t}!yt||at.h&&xt<kt?(yt=0,Oe.a=at.h?5:3):Oe.$=xt,H=yt}else H=lp(Oe,Oe.V,Oe.Ba,Oe.c,Oe.i,H,h1);if(!H){pe=0;break e}}oe+pe>=Fe&&(B.Cc=1),pe=1}if(!pe)return null;if(B.Cc&&((pe=B.ga)!=null&&(pe.mc=null),B.ga=null,0<B.Ga))return alert("todo:WebPDequantizeLevels"),null}return B.nb+oe*Me}function Tl(B,H,oe,pe,Me,Fe){for(;0<Me--;){var Oe,De=B,Be=H+(oe?1:0),Ve=B,at=H+(oe?0:3);for(Oe=0;Oe<pe;++Oe){var Ct=Ve[at+4*Oe];Ct!=255&&(Ct*=32897,De[Be+4*Oe+0]=De[Be+4*Oe+0]*Ct>>23,De[Be+4*Oe+1]=De[Be+4*Oe+1]*Ct>>23,De[Be+4*Oe+2]=De[Be+4*Oe+2]*Ct>>23)}H+=Fe}}function sl(B,H,oe,pe,Me){for(;0<pe--;){var Fe;for(Fe=0;Fe<oe;++Fe){var Oe=B[H+2*Fe+0],De=15&(Ve=B[H+2*Fe+1]),Be=4369*De,Ve=(240&Ve|Ve>>4)*Be>>16;B[H+2*Fe+0]=(240&Oe|Oe>>4)*Be>>16&240|(15&Oe|Oe<<4)*Be>>16>>4&15,B[H+2*Fe+1]=240&Ve|De}H+=Me}}function bc(B,H,oe,pe,Me,Fe,Oe,De){var Be,Ve,at=255;for(Ve=0;Ve<Me;++Ve){for(Be=0;Be<pe;++Be){var Ct=B[H+Be];Fe[Oe+4*Be]=Ct,at&=Ct}H+=oe,Oe+=De}return at!=255}function Af(B,H,oe,pe,Me){var Fe;for(Fe=0;Fe<Me;++Fe)oe[pe+Fe]=B[H+Fe]>>8}function up(){nx=Tl,RB=sl,NB=bc,BB=Af}function Mf(B,H,oe){ge[B]=function(pe,Me,Fe,Oe,De,Be,Ve,at,Ct,Ue,dt,yt,Pt,xt,kt,Rt,ii){var Ht,ir=ii-1>>1,ki=De[Be+0]|Ve[at+0]<<16,vn=Ct[Ue+0]|dt[yt+0]<<16;i(pe!=null);var $i=3*ki+vn+131074>>2;for(H(pe[Me+0],255&$i,$i>>16,Pt,xt),Fe!=null&&($i=3*vn+ki+131074>>2,H(Fe[Oe+0],255&$i,$i>>16,kt,Rt)),Ht=1;Ht<=ir;++Ht){var zn=De[Be+Ht]|Ve[at+Ht]<<16,Pl=Ct[Ue+Ht]|dt[yt+Ht]<<16,bn=ki+zn+vn+Pl+524296,Wi=bn+2*(zn+vn)>>3;$i=Wi+ki>>1,ki=(bn=bn+2*(ki+Pl)>>3)+zn>>1,H(pe[Me+2*Ht-1],255&$i,$i>>16,Pt,xt+(2*Ht-1)*oe),H(pe[Me+2*Ht-0],255&ki,ki>>16,Pt,xt+(2*Ht-0)*oe),Fe!=null&&($i=bn+vn>>1,ki=Wi+Pl>>1,H(Fe[Oe+2*Ht-1],255&$i,$i>>16,kt,Rt+(2*Ht-1)*oe),H(Fe[Oe+2*Ht+0],255&ki,ki>>16,kt,Rt+(2*Ht+0)*oe)),ki=zn,vn=Pl}1&ii||($i=3*ki+vn+131074>>2,H(pe[Me+ii-1],255&$i,$i>>16,Pt,xt+(ii-1)*oe),Fe!=null&&($i=3*vn+ki+131074>>2,H(Fe[Oe+ii-1],255&$i,$i>>16,kt,Rt+(ii-1)*oe)))}}function qw(){xh[sA]=hie,xh[lA]=ZB,xh[$B]=pie,xh[cA]=XB,xh[uA]=KB,xh[xF]=QB,xh[WB]=mie,xh[SF]=ZB,xh[CF]=XB,xh[dA]=KB,xh[AF]=QB}function b1(B){return B&~fie?0>B?0:255:B>>JB}function $g(B,H){return b1((19077*B>>8)+(26149*H>>8)-14234)}function V_(B,H,oe){return b1((19077*B>>8)-(6419*H>>8)-(13320*oe>>8)+8708)}function U_(B,H){return b1((19077*B>>8)+(33050*H>>8)-17685)}function Wg(B,H,oe,pe,Me){pe[Me+0]=$g(B,oe),pe[Me+1]=V_(B,H,oe),pe[Me+2]=U_(B,H)}function wc(B,H,oe,pe,Me){pe[Me+0]=U_(B,H),pe[Me+1]=V_(B,H,oe),pe[Me+2]=$g(B,oe)}function z_(B,H,oe,pe,Me){var Fe=V_(B,H,oe);H=Fe<<3&224|U_(B,H)>>3,pe[Me+0]=248&$g(B,oe)|Fe>>5,pe[Me+1]=H}function $_(B,H,oe,pe,Me){var Fe=240&U_(B,H)|15;pe[Me+0]=240&$g(B,oe)|V_(B,H,oe)>>4,pe[Me+1]=Fe}function Yw(B,H,oe,pe,Me){pe[Me+0]=255,Wg(B,H,oe,pe,Me+1)}function Zw(B,H,oe,pe,Me){wc(B,H,oe,pe,Me),pe[Me+3]=255}function gu(B,H,oe,pe,Me){Wg(B,H,oe,pe,Me),pe[Me+3]=255}function If(B,H,oe){ge[B]=function(pe,Me,Fe,Oe,De,Be,Ve,at,Ct){for(var Ue=at+(-2&Ct)*oe;at!=Ue;)H(pe[Me+0],Fe[Oe+0],De[Be+0],Ve,at),H(pe[Me+1],Fe[Oe+0],De[Be+0],Ve,at+oe),Me+=2,++Oe,++Be,at+=2*oe;1&Ct&&H(pe[Me+0],Fe[Oe+0],De[Be+0],Ve,at)}}function w1(B,H,oe){return oe==0?B==0?H==0?6:5:H==0?4:0:oe}function rA(B,H,oe,pe,Me){switch(B>>>30){case 3:Y_(H,oe,pe,Me,0);break;case 2:bh(H,oe,pe,Me);break;case 1:Co(H,oe,pe,Me)}}function vh(B,H){var oe,pe,Me=H.M,Fe=H.Nb,Oe=B.oc,De=B.pc+40,Be=B.oc,Ve=B.pc+584,at=B.oc,Ct=B.pc+600;for(oe=0;16>oe;++oe)Oe[De+32*oe-1]=129;for(oe=0;8>oe;++oe)Be[Ve+32*oe-1]=129,at[Ct+32*oe-1]=129;for(0<Me?Oe[De-1-32]=Be[Ve-1-32]=at[Ct-1-32]=129:(o(Oe,De-32-1,127,21),o(Be,Ve-32-1,127,9),o(at,Ct-32-1,127,9)),pe=0;pe<B.za;++pe){var Ue=H.ya[H.aa+pe];if(0<pe){for(oe=-1;16>oe;++oe)n(Oe,De+32*oe-4,Oe,De+32*oe+12,4);for(oe=-1;8>oe;++oe)n(Be,Ve+32*oe-4,Be,Ve+32*oe+4,4),n(at,Ct+32*oe-4,at,Ct+32*oe+4,4)}var dt=B.Gd,yt=B.Hd+pe,Pt=Ue.ad,xt=Ue.Hc;if(0<Me&&(n(Oe,De-32,dt[yt].y,0,16),n(Be,Ve-32,dt[yt].f,0,8),n(at,Ct-32,dt[yt].ea,0,8)),Ue.Za){var kt=Oe,Rt=De-32+16;for(0<Me&&(pe>=B.za-1?o(kt,Rt,dt[yt].y[15],4):n(kt,Rt,dt[yt+1].y,0,4)),oe=0;4>oe;oe++)kt[Rt+128+oe]=kt[Rt+256+oe]=kt[Rt+384+oe]=kt[Rt+0+oe];for(oe=0;16>oe;++oe,xt<<=2)kt=Oe,Rt=De+t7[oe],dp[Ue.Ob[oe]](kt,Rt),rA(xt,Pt,16*+oe,kt,Rt)}else if(kt=w1(pe,Me,Ue.Ob[0]),Jg[kt](Oe,De),xt!=0)for(oe=0;16>oe;++oe,xt<<=2)rA(xt,Pt,16*+oe,Oe,De+t7[oe]);for(oe=Ue.Gc,kt=w1(pe,Me,Ue.Dd),Ff[kt](Be,Ve),Ff[kt](at,Ct),xt=Pt,kt=Be,Rt=Ve,255&(Ue=0|oe)&&(170&Ue?um(xt,256,kt,Rt):Yo(xt,256,kt,Rt)),Ue=at,xt=Ct,255&(oe>>=8)&&(170&oe?um(Pt,320,Ue,xt):Yo(Pt,320,Ue,xt)),Me<B.Ub-1&&(n(dt[yt].y,0,Oe,De+480,16),n(dt[yt].f,0,Be,Ve+224,8),n(dt[yt].ea,0,at,Ct+224,8)),oe=8*Fe*B.B,dt=B.sa,yt=B.ta+16*pe+16*Fe*B.R,Pt=B.qa,Ue=B.ra+8*pe+oe,xt=B.Ha,kt=B.Ia+8*pe+oe,oe=0;16>oe;++oe)n(dt,yt+oe*B.R,Oe,De+32*oe,16);for(oe=0;8>oe;++oe)n(Pt,Ue+oe*B.B,Be,Ve+32*oe,8),n(xt,kt+oe*B.B,at,Ct+32*oe,8)}}function W_(B,H,oe,pe,Me,Fe,Oe,De,Be){var Ve=[0],at=[0],Ct=0,Ue=Be!=null?Be.kd:0,dt=Be??new Wt;if(B==null||12>oe)return 7;dt.data=B,dt.w=H,dt.ha=oe,H=[H],oe=[oe],dt.gb=[dt.gb];e:{var yt=H,Pt=oe,xt=dt.gb;if(i(B!=null),i(Pt!=null),i(xt!=null),xt[0]=0,12<=Pt[0]&&!e(B,yt[0],"RIFF")){if(e(B,yt[0]+8,"WEBP")){xt=3;break e}var kt=Je(B,yt[0]+4);if(12>kt||4294967286<kt){xt=3;break e}if(Ue&&kt>Pt[0]-8){xt=7;break e}xt[0]=kt,yt[0]+=12,Pt[0]-=12}xt=0}if(xt!=0)return xt;for(kt=0<dt.gb[0],oe=oe[0];;){e:{var Rt=B;Pt=H,xt=oe;var ii=Ve,Ht=at,ir=yt=[0];if(($i=Ct=[Ct])[0]=0,8>xt[0])xt=7;else{if(!e(Rt,Pt[0],"VP8X")){if(Je(Rt,Pt[0]+4)!=10){xt=3;break e}if(18>xt[0]){xt=7;break e}var ki=Je(Rt,Pt[0]+8),vn=1+st(Rt,Pt[0]+12);if(2147483648<=vn*(Rt=1+st(Rt,Pt[0]+15))){xt=3;break e}ir!=null&&(ir[0]=ki),ii!=null&&(ii[0]=vn),Ht!=null&&(Ht[0]=Rt),Pt[0]+=18,xt[0]-=18,$i[0]=1}xt=0}}if(Ct=Ct[0],yt=yt[0],xt!=0)return xt;if(Pt=!!(2&yt),!kt&&Ct)return 3;if(Fe!=null&&(Fe[0]=!!(16&yt)),Oe!=null&&(Oe[0]=Pt),De!=null&&(De[0]=0),Oe=Ve[0],yt=at[0],Ct&&Pt&&Be==null){xt=0;break}if(4>oe){xt=7;break}if(kt&&Ct||!kt&&!Ct&&!e(B,H[0],"ALPH")){oe=[oe],dt.na=[dt.na],dt.P=[dt.P],dt.Sa=[dt.Sa];e:{ki=B,xt=H,kt=oe;var $i=dt.gb;ii=dt.na,Ht=dt.P,ir=dt.Sa,vn=22,i(ki!=null),i(kt!=null),Rt=xt[0];var zn=kt[0];for(i(ii!=null),i(ir!=null),ii[0]=null,Ht[0]=null,ir[0]=0;;){if(xt[0]=Rt,kt[0]=zn,8>zn){xt=7;break e}var Pl=Je(ki,Rt+4);if(4294967286<Pl){xt=3;break e}var bn=8+Pl+1&-2;if(vn+=bn,0<$i&&vn>$i){xt=3;break e}if(!e(ki,Rt,"VP8 ")||!e(ki,Rt,"VP8L")){xt=0;break e}if(zn[0]<bn){xt=7;break e}e(ki,Rt,"ALPH")||(ii[0]=ki,Ht[0]=Rt+8,ir[0]=Pl),Rt+=bn,zn-=bn}}if(oe=oe[0],dt.na=dt.na[0],dt.P=dt.P[0],dt.Sa=dt.Sa[0],xt!=0)break}oe=[oe],dt.Ja=[dt.Ja],dt.xa=[dt.xa];e:if($i=B,xt=H,kt=oe,ii=dt.gb[0],Ht=dt.Ja,ir=dt.xa,ki=xt[0],Rt=!e($i,ki,"VP8 "),vn=!e($i,ki,"VP8L"),i($i!=null),i(kt!=null),i(Ht!=null),i(ir!=null),8>kt[0])xt=7;else{if(Rt||vn){if($i=Je($i,ki+4),12<=ii&&$i>ii-12){xt=3;break e}if(Ue&&$i>kt[0]-8){xt=7;break e}Ht[0]=$i,xt[0]+=8,kt[0]-=8,ir[0]=vn}else ir[0]=5<=kt[0]&&$i[ki+0]==47&&!($i[ki+4]>>5),Ht[0]=kt[0];xt=0}if(oe=oe[0],dt.Ja=dt.Ja[0],dt.xa=dt.xa[0],H=H[0],xt!=0)break;if(4294967286<dt.Ja)return 3;if(De==null||Pt||(De[0]=dt.xa?2:1),Oe=[Oe],yt=[yt],dt.xa){if(5>oe){xt=7;break}De=Oe,Ue=yt,Pt=Fe,B==null||5>oe?B=0:5<=oe&&B[H+0]==47&&!(B[H+4]>>5)?(kt=[0],$i=[0],ii=[0],Re(Ht=new Ae,B,H,oe),Ml(Ht,kt,$i,ii)?(De!=null&&(De[0]=kt[0]),Ue!=null&&(Ue[0]=$i[0]),Pt!=null&&(Pt[0]=ii[0]),B=1):B=0):B=0}else{if(10>oe){xt=7;break}De=yt,B==null||10>oe||!HC(B,H+3,oe-3)?B=0:(Ue=B[H+0]|B[H+1]<<8|B[H+2]<<16,Pt=16383&(B[H+7]<<8|B[H+6]),B=16383&(B[H+9]<<8|B[H+8]),1&Ue||3<(Ue>>1&7)||!(Ue>>4&1)||Ue>>5>=dt.Ja||!Pt||!B?B=0:(Oe&&(Oe[0]=Pt),De&&(De[0]=B),B=1))}if(!B||(Oe=Oe[0],yt=yt[0],Ct&&(Ve[0]!=Oe||at[0]!=yt)))return 3;Be!=null&&(Be[0]=dt,Be.offset=H-Be.w,i(4294967286>H-Be.w),i(Be.offset==Be.ha-oe));break}return xt==0||xt==7&&Ct&&Be==null?(Fe!=null&&(Fe[0]|=dt.na!=null&&0<dt.na.length),pe!=null&&(pe[0]=Oe),Me!=null&&(Me[0]=yt),0):xt}function Xw(B,H,oe){var pe=H.width,Me=H.height,Fe=0,Oe=0,De=pe,Be=Me;if(H.Da=B!=null&&0<B.Da,H.Da&&(De=B.cd,Be=B.bd,Fe=B.v,Oe=B.j,11>oe||(Fe&=-2,Oe&=-2),0>Fe||0>Oe||0>=De||0>=Be||Fe+De>pe||Oe+Be>Me))return 0;if(H.v=Fe,H.j=Oe,H.va=Fe+De,H.o=Oe+Be,H.U=De,H.T=Be,H.da=B!=null&&0<B.da,H.da){if(!vt(De,Be,oe=[B.ib],Fe=[B.hb]))return 0;H.ib=oe[0],H.hb=Fe[0]}return H.ob=B!=null&&B.ob,H.Kb=B==null||!B.Sd,H.da&&(H.ob=H.ib<3*pe/4&&H.hb<3*Me/4,H.Kb=0),1}function Kw(B){if(B==null)return 2;if(11>B.S){var H=B.f.RGBA;H.fb+=(B.height-1)*H.A,H.A=-H.A}else H=B.f.kb,B=B.height,H.O+=(B-1)*H.fa,H.fa=-H.fa,H.N+=(B-1>>1)*H.Ab,H.Ab=-H.Ab,H.W+=(B-1>>1)*H.Db,H.Db=-H.Db,H.F!=null&&(H.J+=(B-1)*H.lb,H.lb=-H.lb);return 0}function Hg(B,H,oe,pe){if(pe==null||0>=B||0>=H)return 2;if(oe!=null){if(oe.Da){var Me=oe.cd,Fe=oe.bd,Oe=-2&oe.v,De=-2&oe.j;if(0>Oe||0>De||0>=Me||0>=Fe||Oe+Me>B||De+Fe>H)return 2;B=Me,H=Fe}if(oe.da){if(!vt(B,H,Me=[oe.ib],Fe=[oe.hb]))return 2;B=Me[0],H=Fe[0]}}pe.width=B,pe.height=H;e:{var Be=pe.width,Ve=pe.height;if(B=pe.S,0>=Be||0>=Ve||!(B>=sA&&13>B))B=2;else{if(0>=pe.Rd&&pe.sd==null){Oe=Fe=Me=H=0;var at=(De=Be*i7[B])*Ve;if(11>B||(Fe=(Ve+1)/2*(H=(Be+1)/2),B==12&&(Oe=(Me=Be)*Ve)),(Ve=s(at+2*Fe+Oe))==null){B=1;break e}pe.sd=Ve,11>B?((Be=pe.f.RGBA).eb=Ve,Be.fb=0,Be.A=De,Be.size=at):((Be=pe.f.kb).y=Ve,Be.O=0,Be.fa=De,Be.Fd=at,Be.f=Ve,Be.N=0+at,Be.Ab=H,Be.Cd=Fe,Be.ea=Ve,Be.W=0+at+Fe,Be.Db=H,Be.Ed=Fe,B==12&&(Be.F=Ve,Be.J=0+at+2*Fe),Be.Tc=Oe,Be.lb=Me)}if(H=1,Me=pe.S,Fe=pe.width,Oe=pe.height,Me>=sA&&13>Me)if(11>Me)B=pe.f.RGBA,H&=(De=Math.abs(B.A))*(Oe-1)+Fe<=B.size,H&=De>=Fe*i7[Me],H&=B.eb!=null;else{B=pe.f.kb,De=(Fe+1)/2,at=(Oe+1)/2,Be=Math.abs(B.fa),Ve=Math.abs(B.Ab);var Ct=Math.abs(B.Db),Ue=Math.abs(B.lb),dt=Ue*(Oe-1)+Fe;H&=Be*(Oe-1)+Fe<=B.Fd,H&=Ve*(at-1)+De<=B.Cd,H=(H&=Ct*(at-1)+De<=B.Ed)&Be>=Fe&Ve>=De&Ct>=De,H&=B.y!=null,H&=B.f!=null,H&=B.ea!=null,Me==12&&(H&=Ue>=Fe,H&=dt<=B.Tc,H&=B.F!=null)}else H=0;B=H?0:2}}return B!=0||oe!=null&&oe.fd&&(B=Kw(pe)),B}var H_=64,Fd=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],Pd=24,qg=32,Ef=8,Yg=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];wt("Predictor0","PredictorAdd0"),ge.Predictor0=function(){return 4278190080},ge.Predictor1=function(B){return B},ge.Predictor2=function(B,H,oe){return H[oe+0]},ge.Predictor3=function(B,H,oe){return H[oe+1]},ge.Predictor4=function(B,H,oe){return H[oe-1]},ge.Predictor5=function(B,H,oe){return St(St(B,H[oe+1]),H[oe+0])},ge.Predictor6=function(B,H,oe){return St(B,H[oe-1])},ge.Predictor7=function(B,H,oe){return St(B,H[oe+0])},ge.Predictor8=function(B,H,oe){return St(H[oe-1],H[oe+0])},ge.Predictor9=function(B,H,oe){return St(H[oe+0],H[oe+1])},ge.Predictor10=function(B,H,oe){return St(St(B,H[oe-1]),St(H[oe+0],H[oe+1]))},ge.Predictor11=function(B,H,oe){var pe=H[oe+0];return 0>=Ut(pe>>24&255,B>>24&255,(H=H[oe-1])>>24&255)+Ut(pe>>16&255,B>>16&255,H>>16&255)+Ut(pe>>8&255,B>>8&255,H>>8&255)+Ut(255&pe,255&B,255&H)?pe:B},ge.Predictor12=function(B,H,oe){var pe=H[oe+0];return(ei((B>>24&255)+(pe>>24&255)-((H=H[oe-1])>>24&255))<<24|ei((B>>16&255)+(pe>>16&255)-(H>>16&255))<<16|ei((B>>8&255)+(pe>>8&255)-(H>>8&255))<<8|ei((255&B)+(255&pe)-(255&H)))>>>0},ge.Predictor13=function(B,H,oe){var pe=H[oe-1];return(Jt((B=St(B,H[oe+0]))>>24&255,pe>>24&255)<<24|Jt(B>>16&255,pe>>16&255)<<16|Jt(B>>8&255,pe>>8&255)<<8|Jt(255&B,255&pe))>>>0};var Qw=ge.PredictorAdd0;ge.PredictorAdd1=pi,wt("Predictor2","PredictorAdd2"),wt("Predictor3","PredictorAdd3"),wt("Predictor4","PredictorAdd4"),wt("Predictor5","PredictorAdd5"),wt("Predictor6","PredictorAdd6"),wt("Predictor7","PredictorAdd7"),wt("Predictor8","PredictorAdd8"),wt("Predictor9","PredictorAdd9"),wt("Predictor10","PredictorAdd10"),wt("Predictor11","PredictorAdd11"),wt("Predictor12","PredictorAdd12"),wt("Predictor13","PredictorAdd13");var x1=ge.PredictorAdd2;Ft("ColorIndexInverseTransform","MapARGB","32b",function(B){return B>>8&255},function(B){return B}),Ft("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(B){return B},function(B){return B>>8&255});var Us,nA=ge.ColorIndexInverseTransform,lm=ge.MapARGB,cm=ge.VP8LColorIndexInverseTransformAlpha,Jw=ge.MapAlpha,ex=ge.VP8LPredictorsAdd=[];ex.length=16,(ge.VP8LPredictors=[]).length=16,(ge.VP8LPredictorsAdd_C=[]).length=16,(ge.VP8LPredictors_C=[]).length=16;var tx,ix,Zg,Xg,Kg,q_,Qg,Y_,bh,um,Co,Yo,zs,Fl,Tf,rx,S1,oA,FB,PB,LB,kB,OB,DB,nx,RB,NB,BB,GB=s(511),jB=s(2041),VB=s(225),UB=s(767),zB=0,wF=jB,aA=VB,Ld=UB,wh=GB,sA=0,lA=1,$B=2,cA=3,uA=4,xF=5,WB=6,SF=7,CF=8,dA=9,AF=10,Qte=[2,3,7],Jte=[3,3,11],HB=[280,256,256,256,40],eie=[0,1,1,1,0],tie=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],iie=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],rie=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],nie=8,MF=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],IF=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ox=null,oie=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],aie=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],qB=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],sie=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],lie=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],cie=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],uie=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Jg=[],dp=[],Ff=[],die=1,YB=2,e0=[],xh=[];Mf("UpsampleRgbLinePair",Wg,3),Mf("UpsampleBgrLinePair",wc,3),Mf("UpsampleRgbaLinePair",gu,4),Mf("UpsampleBgraLinePair",Zw,4),Mf("UpsampleArgbLinePair",Yw,4),Mf("UpsampleRgba4444LinePair",$_,2),Mf("UpsampleRgb565LinePair",z_,2);var hie=ge.UpsampleRgbLinePair,pie=ge.UpsampleBgrLinePair,ZB=ge.UpsampleRgbaLinePair,XB=ge.UpsampleBgraLinePair,KB=ge.UpsampleArgbLinePair,QB=ge.UpsampleRgba4444LinePair,mie=ge.UpsampleRgb565LinePair,hA=16,pA=1<<hA-1,ax=-227,EF=482,JB=6,fie=(256<<JB)-1,e7=0,gie=s(256),_ie=s(256),yie=s(256),vie=s(256),bie=s(EF-ax),wie=s(EF-ax);If("YuvToRgbRow",Wg,3),If("YuvToBgrRow",wc,3),If("YuvToRgbaRow",gu,4),If("YuvToBgraRow",Zw,4),If("YuvToArgbRow",Yw,4),If("YuvToRgba4444Row",$_,2),If("YuvToRgb565Row",z_,2);var t7=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],mA=[0,2,8],xie=[8,7,6,4,4,2,2,2,1,1,1,1],Sie=1;this.WebPDecodeRGBA=function(B,H,oe,pe,Me){var Fe=lA,Oe=new Dt,De=new xr;Oe.ba=De,De.S=Fe,De.width=[De.width],De.height=[De.height];var Be=De.width,Ve=De.height,at=new tr;if(at==null||B==null)var Ct=2;else i(at!=null),Ct=W_(B,H,oe,at.width,at.height,at.Pd,at.Qd,at.format,null);if(Ct!=0?Be=0:(Be!=null&&(Be[0]=at.width[0]),Ve!=null&&(Ve[0]=at.height[0]),Be=1),Be){De.width=De.width[0],De.height=De.height[0],pe!=null&&(pe[0]=De.width),Me!=null&&(Me[0]=De.height);e:{if(pe=new f1,(Me=new Wt).data=B,Me.w=H,Me.ha=oe,Me.kd=1,H=[0],i(Me!=null),((B=W_(Me.data,Me.w,Me.ha,null,null,null,H,null,Me))==0||B==7)&&H[0]&&(B=4),(H=B)==0){if(i(Oe!=null),pe.data=Me.data,pe.w=Me.w+Me.offset,pe.ha=Me.ha-Me.offset,pe.put=zi,pe.ac=ps,pe.bc=Cs,pe.ma=Oe,Me.xa){if((B=O_())==null){Oe=1;break e}if(function(Ue,dt){var yt=[0],Pt=[0],xt=[0];t:for(;;){if(Ue==null)return 0;if(dt==null)return Ue.a=2,0;if(Ue.l=dt,Ue.a=0,Re(Ue.m,dt.data,dt.w,dt.ha),!Ml(Ue.m,yt,Pt,xt)){Ue.a=3;break t}if(Ue.xb=YB,dt.width=yt[0],dt.height=Pt[0],!nm(yt[0],Pt[0],1,Ue,null))break t;return 1}return i(Ue.a!=0),0}(B,pe)){if(pe=(H=Hg(pe.width,pe.height,Oe.Oa,Oe.ba))==0){t:{pe=B;i:for(;;){if(pe==null){pe=0;break t}if(i(pe.s.yc!=null),i(pe.s.Ya!=null),i(0<pe.s.Wb),i((oe=pe.l)!=null),i((Me=oe.ma)!=null),pe.xb!=0){if(pe.ca=Me.ba,pe.tb=Me.tb,i(pe.ca!=null),!Xw(Me.Oa,oe,cA)){pe.a=2;break i}if(!D_(pe,oe.width)||oe.da)break i;if((oe.da||Ai(pe.ca.S))&&up(),11>pe.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),pe.ca.f.kb.F!=null&&up()),pe.Pb&&0<pe.s.ua&&pe.s.vb.X==null&&!de(pe.s.vb,pe.s.Wa.Xa)){pe.a=1;break i}pe.xb=0}if(!lp(pe,pe.V,pe.Ba,pe.c,pe.i,oe.o,zg))break i;Me.Dc=pe.Ma,pe=1;break t}i(pe.a!=0),pe=0}pe=!pe}pe&&(H=B.a)}else H=B.a}else{if((B=new aF)==null){Oe=1;break e}if(B.Fa=Me.na,B.P=Me.P,B.qc=Me.Sa,am(B,pe)){if((H=Hg(pe.width,pe.height,Oe.Oa,Oe.ba))==0){if(B.Aa=0,oe=Oe.Oa,i((Me=B)!=null),oe!=null){if(0<(Be=0>(Be=oe.Md)?0:100<Be?255:255*Be/100)){for(Ve=at=0;4>Ve;++Ve)12>(Ct=Me.pb[Ve]).lc&&(Ct.ia=Be*xie[0>Ct.lc?0:Ct.lc]>>3),at|=Ct.ia;at&&(alert("todo:VP8InitRandom"),Me.ia=1)}Me.Ga=oe.Id,100<Me.Ga?Me.Ga=100:0>Me.Ga&&(Me.Ga=0)}(function(Ue,dt){if(Ue==null)return 0;if(dt==null)return ol(Ue,2,"NULL VP8Io parameter in VP8Decode().");if(!Ue.cb&&!am(Ue,dt))return 0;if(i(Ue.cb),dt.ac==null||dt.ac(dt)){dt.ob&&(Ue.L=0);var yt=mA[Ue.L];if(Ue.L==2?(Ue.yb=0,Ue.zb=0):(Ue.yb=dt.v-yt>>4,Ue.zb=dt.j-yt>>4,0>Ue.yb&&(Ue.yb=0),0>Ue.zb&&(Ue.zb=0)),Ue.Va=dt.o+15+yt>>4,Ue.Hb=dt.va+15+yt>>4,Ue.Hb>Ue.za&&(Ue.Hb=Ue.za),Ue.Va>Ue.Ub&&(Ue.Va=Ue.Ub),0<Ue.L){var Pt=Ue.ed;for(yt=0;4>yt;++yt){var xt;if(Ue.Qa.Cb){var kt=Ue.Qa.Lb[yt];Ue.Qa.Fb||(kt+=Pt.Tb)}else kt=Pt.Tb;for(xt=0;1>=xt;++xt){var Rt=Ue.gd[yt][xt],ii=kt;if(Pt.Pc&&(ii+=Pt.vd[0],xt&&(ii+=Pt.od[0])),0<(ii=0>ii?0:63<ii?63:ii)){var Ht=ii;0<Pt.wb&&(Ht=4<Pt.wb?Ht>>2:Ht>>1)>9-Pt.wb&&(Ht=9-Pt.wb),1>Ht&&(Ht=1),Rt.dd=Ht,Rt.tc=2*ii+Ht,Rt.ld=40<=ii?2:15<=ii?1:0}else Rt.tc=0;Rt.La=xt}}}yt=0}else ol(Ue,6,"Frame setup failed"),yt=Ue.a;if(yt=yt==0){if(yt){Ue.$c=0,0<Ue.Aa||(Ue.Ic=Sie);t:{yt=Ue.Ic,Pt=4*(Ht=Ue.za);var ir=32*Ht,ki=Ht+1,vn=0<Ue.L?Ht*(0<Ue.Aa?2:1):0,$i=(Ue.Aa==2?2:1)*Ht;if((Rt=Pt+832+(xt=3*(16*yt+mA[Ue.L])/2*ir)+(kt=Ue.Fa!=null&&0<Ue.Fa.length?Ue.Kc.c*Ue.Kc.i:0))!=Rt)yt=0;else{if(Rt>Ue.Vb){if(Ue.Vb=0,Ue.Ec=s(Rt),Ue.Fc=0,Ue.Ec==null){yt=ol(Ue,1,"no memory during frame initialization.");break t}Ue.Vb=Rt}Rt=Ue.Ec,ii=Ue.Fc,Ue.Ac=Rt,Ue.Bc=ii,ii+=Pt,Ue.Gd=l(ir,$C),Ue.Hd=0,Ue.rb=l(ki+1,Nw),Ue.sb=1,Ue.wa=vn?l(vn,_h):null,Ue.Y=0,Ue.D.Nb=0,Ue.D.wa=Ue.wa,Ue.D.Y=Ue.Y,0<Ue.Aa&&(Ue.D.Y+=Ht),i(!0),Ue.oc=Rt,Ue.pc=ii,ii+=832,Ue.ya=l($i,Bw),Ue.aa=0,Ue.D.ya=Ue.ya,Ue.D.aa=Ue.aa,Ue.Aa==2&&(Ue.D.aa+=Ht),Ue.R=16*Ht,Ue.B=8*Ht,Ht=(ir=mA[Ue.L])*Ue.R,ir=ir/2*Ue.B,Ue.sa=Rt,Ue.ta=ii+Ht,Ue.qa=Ue.sa,Ue.ra=Ue.ta+16*yt*Ue.R+ir,Ue.Ha=Ue.qa,Ue.Ia=Ue.ra+8*yt*Ue.B+ir,Ue.$c=0,ii+=xt,Ue.mb=kt?Rt:null,Ue.nb=kt?ii:null,i(ii+kt<=Ue.Fc+Ue.Vb),qC(Ue),o(Ue.Ac,Ue.Bc,0,Pt),yt=1}}if(yt){if(dt.ka=0,dt.y=Ue.sa,dt.O=Ue.ta,dt.f=Ue.qa,dt.N=Ue.ra,dt.ea=Ue.Ha,dt.Vd=Ue.Ia,dt.fa=Ue.R,dt.Rc=Ue.B,dt.F=null,dt.J=0,!zB){for(yt=-255;255>=yt;++yt)GB[255+yt]=0>yt?-yt:yt;for(yt=-1020;1020>=yt;++yt)jB[1020+yt]=-128>yt?-128:127<yt?127:yt;for(yt=-112;112>=yt;++yt)VB[112+yt]=-16>yt?-16:15<yt?15:yt;for(yt=-255;510>=yt;++yt)UB[255+yt]=0>yt?0:255<yt?255:yt;zB=1}Qg=_1,Y_=lF,um=sm,Co=ZC,Yo=XC,bh=sF,zs=tA,Fl=j_,Tf=Ce,rx=$e,S1=iA,oA=re,FB=rt,PB=gt,LB=G_,kB=Hw,OB=JC,DB=eA,dp[0]=gF,dp[1]=cF,dp[2]=mF,dp[3]=fF,dp[4]=vf,dp[5]=_F,dp[6]=bf,dp[7]=yF,dp[8]=Vw,dp[9]=y1,Jg[0]=hF,Jg[1]=dF,Jg[2]=Gw,Jg[3]=KC,Jg[4]=N_,Jg[5]=jw,Jg[6]=pF,Ff[0]=bF,Ff[1]=uF,Ff[2]=B_,Ff[3]=vF,Ff[4]=zw,Ff[5]=Uw,Ff[6]=QC,yt=1}else yt=0}yt&&(yt=function(zn,Pl){for(zn.M=0;zn.M<zn.Va;++zn.M){var bn,Wi=zn.Jc[zn.M&zn.Xb],vi=zn.m,$s=zn;for(bn=0;bn<$s.za;++bn){var cn=vi,Zn=$s,Xa=Zn.Ac,xc=Zn.Bc+4*bn,_u=Zn.zc,Ms=Zn.ya[Zn.aa+bn];if(Zn.Qa.Bb?Ms.$b=At(cn,Zn.Pa.jb[0])?2+At(cn,Zn.Pa.jb[2]):At(cn,Zn.Pa.jb[1]):Ms.$b=0,Zn.kc&&(Ms.Ad=At(cn,Zn.Bd)),Ms.Za=!At(cn,145)+0,Ms.Za){var Bc=Ms.Ob,yu=0;for(Zn=0;4>Zn;++Zn){var Ll,ao=_u[0+Zn];for(Ll=0;4>Ll;++Ll){ao=lie[Xa[xc+Ll]][ao];for(var ko=qB[At(cn,ao[0])];0<ko;)ko=qB[2*ko+At(cn,ao[ko])];ao=-ko,Xa[xc+Ll]=ao}n(Bc,yu,Xa,xc,4),yu+=4,_u[0+Zn]=ao}}else ao=At(cn,156)?At(cn,128)?1:3:At(cn,163)?2:0,Ms.Ob[0]=ao,o(Xa,xc,ao,4),o(_u,0,ao,4);Ms.Dd=At(cn,142)?At(cn,114)?At(cn,183)?1:3:2:0}if($s.m.Ka)return ol(zn,7,"Premature end-of-partition0 encountered.");for(;zn.ja<zn.za;++zn.ja){if($s=Wi,cn=(vi=zn).rb[vi.sb-1],Xa=vi.rb[vi.sb+vi.ja],bn=vi.ya[vi.aa+vi.ja],xc=vi.kc?bn.Ad:0)cn.la=Xa.la=0,bn.Za||(cn.Na=Xa.Na=0),bn.Hc=0,bn.Gc=0,bn.ia=0;else{var Is,Oo;if(cn=Xa,Xa=$s,xc=vi.Pa.Xc,_u=vi.ya[vi.aa+vi.ja],Ms=vi.pb[_u.$b],Zn=_u.ad,Bc=0,yu=vi.rb[vi.sb-1],ao=Ll=0,o(Zn,Bc,0,384),_u.Za)var Sc=0,hp=xc[3];else{ko=s(16);var Ws=cn.Na+yu.Na;if(Ws=ox(Xa,xc[1],Ws,Ms.Eb,0,ko,0),cn.Na=yu.Na=(0<Ws)+0,1<Ws)Qg(ko,0,Zn,Bc);else{var Uu=ko[0]+3>>3;for(ko=0;256>ko;ko+=16)Zn[Bc+ko]=Uu}Sc=1,hp=xc[0]}var Zo=15&cn.la,kl=15&yu.la;for(ko=0;4>ko;++ko){var kd=1&kl;for(Uu=Oo=0;4>Uu;++Uu)Zo=Zo>>1|(kd=(Ws=ox(Xa,hp,Ws=kd+(1&Zo),Ms.Sc,Sc,Zn,Bc))>Sc)<<7,Oo=Oo<<2|(3<Ws?3:1<Ws?2:Zn[Bc+0]!=0),Bc+=16;Zo>>=4,kl=kl>>1|kd<<7,Ll=(Ll<<8|Oo)>>>0}for(hp=Zo,Sc=kl>>4,Is=0;4>Is;Is+=2){for(Oo=0,Zo=cn.la>>4+Is,kl=yu.la>>4+Is,ko=0;2>ko;++ko){for(kd=1&kl,Uu=0;2>Uu;++Uu)Ws=kd+(1&Zo),Zo=Zo>>1|(kd=0<(Ws=ox(Xa,xc[2],Ws,Ms.Qc,0,Zn,Bc)))<<3,Oo=Oo<<2|(3<Ws?3:1<Ws?2:Zn[Bc+0]!=0),Bc+=16;Zo>>=2,kl=kl>>1|kd<<5}ao|=Oo<<4*Is,hp|=Zo<<4<<Is,Sc|=(240&kl)<<Is}cn.la=hp,yu.la=Sc,_u.Hc=Ll,_u.Gc=ao,_u.ia=43690&ao?0:Ms.ia,xc=!(Ll|ao)}if(0<vi.L&&(vi.wa[vi.Y+vi.ja]=vi.gd[bn.$b][bn.Za],vi.wa[vi.Y+vi.ja].La|=!xc),$s.Ka)return ol(zn,7,"Premature end-of-file encountered.")}if(qC(zn),vi=Pl,$s=1,bn=(Wi=zn).D,cn=0<Wi.L&&Wi.M>=Wi.zb&&Wi.M<=Wi.Va,Wi.Aa==0)t:{if(bn.M=Wi.M,bn.uc=cn,vh(Wi,bn),$s=1,bn=(Oo=Wi.D).Nb,cn=(ao=mA[Wi.L])*Wi.R,Xa=ao/2*Wi.B,ko=16*bn*Wi.R,Uu=8*bn*Wi.B,xc=Wi.sa,_u=Wi.ta-cn+ko,Ms=Wi.qa,Zn=Wi.ra-Xa+Uu,Bc=Wi.Ha,yu=Wi.Ia-Xa+Uu,kl=(Zo=Oo.M)==0,Ll=Zo>=Wi.Va-1,Wi.Aa==2&&vh(Wi,Oo),Oo.uc)for(kd=(Ws=Wi).D.M,i(Ws.D.uc),Oo=Ws.yb;Oo<Ws.Hb;++Oo){Sc=Oo,hp=kd;var vu=(Od=(Cc=Ws).D).Nb;Is=Cc.R;var Od=Od.wa[Od.Y+Sc],Dd=Cc.sa,zu=Cc.ta+16*vu*Is+16*Sc,Rd=Od.dd,pa=Od.tc;if(pa!=0)if(i(3<=pa),Cc.L==1)0<Sc&&kB(Dd,zu,Is,pa+4),Od.La&&DB(Dd,zu,Is,pa),0<hp&&LB(Dd,zu,Is,pa+4),Od.La&&OB(Dd,zu,Is,pa);else{var Nd=Cc.B,pp=Cc.qa,Z_=Cc.ra+8*vu*Nd+8*Sc,Pf=Cc.Ha,Cc=Cc.Ia+8*vu*Nd+8*Sc;vu=Od.ld,0<Sc&&(Fl(Dd,zu,Is,pa+4,Rd,vu),rx(pp,Z_,Pf,Cc,Nd,pa+4,Rd,vu)),Od.La&&(oA(Dd,zu,Is,pa,Rd,vu),PB(pp,Z_,Pf,Cc,Nd,pa,Rd,vu)),0<hp&&(zs(Dd,zu,Is,pa+4,Rd,vu),Tf(pp,Z_,Pf,Cc,Nd,pa+4,Rd,vu)),Od.La&&(S1(Dd,zu,Is,pa,Rd,vu),FB(pp,Z_,Pf,Cc,Nd,pa,Rd,vu))}}if(Wi.ia&&alert("todo:DitherRow"),vi.put!=null){if(Oo=16*Zo,Zo=16*(Zo+1),kl?(vi.y=Wi.sa,vi.O=Wi.ta+ko,vi.f=Wi.qa,vi.N=Wi.ra+Uu,vi.ea=Wi.Ha,vi.W=Wi.Ia+Uu):(Oo-=ao,vi.y=xc,vi.O=_u,vi.f=Ms,vi.N=Zn,vi.ea=Bc,vi.W=yu),Ll||(Zo-=ao),Zo>vi.o&&(Zo=vi.o),vi.F=null,vi.J=null,Wi.Fa!=null&&0<Wi.Fa.length&&Oo<Zo&&(vi.J=Jo(Wi,vi,Oo,Zo-Oo),vi.F=Wi.mb,vi.F==null&&vi.F.length==0)){$s=ol(Wi,3,"Could not decode alpha data.");break t}Oo<vi.j&&(ao=vi.j-Oo,Oo=vi.j,i(!(1&ao)),vi.O+=Wi.R*ao,vi.N+=Wi.B*(ao>>1),vi.W+=Wi.B*(ao>>1),vi.F!=null&&(vi.J+=vi.width*ao)),Oo<Zo&&(vi.O+=vi.v,vi.N+=vi.v>>1,vi.W+=vi.v>>1,vi.F!=null&&(vi.J+=vi.v),vi.ka=Oo-vi.j,vi.U=vi.va-vi.v,vi.T=Zo-Oo,$s=vi.put(vi))}bn+1!=Wi.Ic||Ll||(n(Wi.sa,Wi.ta-cn,xc,_u+16*Wi.R,cn),n(Wi.qa,Wi.ra-Xa,Ms,Zn+8*Wi.B,Xa),n(Wi.Ha,Wi.Ia-Xa,Bc,yu+8*Wi.B,Xa))}if(!$s)return ol(zn,6,"Output aborted.")}return 1}(Ue,dt)),dt.bc!=null&&dt.bc(dt),yt&=1}return yt?(Ue.cb=0,yt):0})(B,pe)||(H=B.a)}}else H=B.a}H==0&&Oe.Oa!=null&&Oe.Oa.fd&&(H=Kw(Oe.ba))}Oe=H}Fe=Oe!=0?null:11>Fe?De.f.RGBA.eb:De.f.kb.y}else Fe=null;return Fe};var i7=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function m(ge,ue){for(var se="",te=0;te<4;te++)se+=String.fromCharCode(ge[ue++]);return se}function f(ge,ue){return ge[ue+0]|ge[ue+1]<<8}function g(ge,ue){return(ge[ue+0]|ge[ue+1]<<8|ge[ue+2]<<16)>>>0}function y(ge,ue){return(ge[ue+0]|ge[ue+1]<<8|ge[ue+2]<<16|ge[ue+3]<<24)>>>0}new p;var _=[0],w=[0],A=[],k=new p,R=r,q=function(ge,ue){var se={},te=0,Se=!1,Te=0,Ee=0;if(se.frames=[],!function(ye,Ae){for(var Le=0;Le<4;Le++)if(ye[Ae+Le]!="RIFF".charCodeAt(Le))return!0;return!1}(ge,ue)){for(y(ge,ue+=4),ue+=8;ue<ge.length;){var je=m(ge,ue),Ne=y(ge,ue+=4);ue+=4;var ze=Ne+(1&Ne);switch(je){case"VP8 ":case"VP8L":se.frames[te]===void 0&&(se.frames[te]={}),(He=se.frames[te]).src_off=Se?Ee:ue-8,He.src_size=Te+Ne+8,te++,Se&&(Se=!1,Te=0,Ee=0);break;case"VP8X":(He=se.header={}).feature_flags=ge[ue];var Re=ue+4;He.canvas_width=1+g(ge,Re),Re+=3,He.canvas_height=1+g(ge,Re),Re+=3;break;case"ALPH":Se=!0,Te=ze+8,Ee=ue-8;break;case"ANIM":(He=se.header).bgcolor=y(ge,ue),Re=ue+4,He.loop_count=f(ge,Re),Re+=2;break;case"ANMF":var Ge,He;(He=se.frames[te]={}).offset_x=2*g(ge,ue),ue+=3,He.offset_y=2*g(ge,ue),ue+=3,He.width=1+g(ge,ue),ue+=3,He.height=1+g(ge,ue),ue+=3,He.duration=g(ge,ue),ue+=3,Ge=ge[ue++],He.dispose=1&Ge,He.blend=Ge>>1&1}je!="ANMF"&&(ue+=ze)}return se}}(R,0);q.response=R,q.rgbaoutput=!0,q.dataurl=!1;var X=q.header?q.header:null,ie=q.frames?q.frames:null;if(X){X.loop_counter=X.loop_count,_=[X.canvas_height],w=[X.canvas_width];for(var ae=0;ae<ie.length&&ie[ae].blend!=0;ae++);}var be=ie[0],me=k.WebPDecodeRGBA(R,be.src_off,be.src_size,w,_);be.rgba=me,be.imgwidth=w[0],be.imgheight=_[0];for(var fe=0;fe<w[0]*_[0]*4;fe++)A[fe]=me[fe];return this.width=w,this.height=_,this.data=A,this}(function(r){var i,e,n,o,s,l,h,p,m,f=function(ye){return ye=ye||{},this.isStrokeTransparent=ye.isStrokeTransparent||!1,this.strokeOpacity=ye.strokeOpacity||1,this.strokeStyle=ye.strokeStyle||"#000000",this.fillStyle=ye.fillStyle||"#000000",this.isFillTransparent=ye.isFillTransparent||!1,this.fillOpacity=ye.fillOpacity||1,this.font=ye.font||"10px sans-serif",this.textBaseline=ye.textBaseline||"alphabetic",this.textAlign=ye.textAlign||"left",this.lineWidth=ye.lineWidth||1,this.lineJoin=ye.lineJoin||"miter",this.lineCap=ye.lineCap||"butt",this.path=ye.path||[],this.transform=ye.transform!==void 0?ye.transform.clone():new p,this.globalCompositeOperation=ye.globalCompositeOperation||"normal",this.globalAlpha=ye.globalAlpha||1,this.clip_path=ye.clip_path||[],this.currentPoint=ye.currentPoint||new l,this.miterLimit=ye.miterLimit||10,this.lastPoint=ye.lastPoint||new l,this.lineDashOffset=ye.lineDashOffset||0,this.lineDash=ye.lineDash||[],this.margin=ye.margin||[0,0,0,0],this.prevPageLastElemOffset=ye.prevPageLastElemOffset||0,this.ignoreClearRect=typeof ye.ignoreClearRect!="boolean"||ye.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new g(this),i=this.internal.f2,e=this.internal.getCoordinateString,n=this.internal.getVerticalCoordinateString,o=this.internal.getHorizontalCoordinate,s=this.internal.getVerticalCoordinate,l=this.internal.Point,h=this.internal.Rectangle,p=this.internal.Matrix,m=new f}]);var g=function(ye){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var Ae=ye;Object.defineProperty(this,"pdf",{get:function(){return Ae}});var Le=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Le},set:function(de){Le=!!de}});var Ye=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return Ye},set:function(de){Ye=!!de}});var qe=0;Object.defineProperty(this,"posX",{get:function(){return qe},set:function(de){isNaN(de)||(qe=de)}});var et=0;Object.defineProperty(this,"posY",{get:function(){return et},set:function(de){isNaN(de)||(et=de)}}),Object.defineProperty(this,"margin",{get:function(){return m.margin},set:function(de){var ke;typeof de=="number"?ke=[de,de,de,de]:((ke=new Array(4))[0]=de[0],ke[1]=de.length>=2?de[1]:ke[0],ke[2]=de.length>=3?de[2]:ke[0],ke[3]=de.length>=4?de[3]:ke[1]),m.margin=ke}});var ft=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ft},set:function(de){ft=de}});var mt=0;Object.defineProperty(this,"lastBreak",{get:function(){return mt},set:function(de){mt=de}});var At=[];Object.defineProperty(this,"pageBreaks",{get:function(){return At},set:function(de){At=de}}),Object.defineProperty(this,"ctx",{get:function(){return m},set:function(de){de instanceof f&&(m=de)}}),Object.defineProperty(this,"path",{get:function(){return m.path},set:function(de){m.path=de}});var ht=[];Object.defineProperty(this,"ctxStack",{get:function(){return ht},set:function(de){ht=de}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(de){var ke;ke=y(de),this.ctx.fillStyle=ke.style,this.ctx.isFillTransparent=ke.a===0,this.ctx.fillOpacity=ke.a,this.pdf.setFillColor(ke.r,ke.g,ke.b,{a:ke.a}),this.pdf.setTextColor(ke.r,ke.g,ke.b,{a:ke.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(de){var ke=y(de);this.ctx.strokeStyle=ke.style,this.ctx.isStrokeTransparent=ke.a===0,this.ctx.strokeOpacity=ke.a,ke.a===0?this.pdf.setDrawColor(255,255,255):(ke.a,this.pdf.setDrawColor(ke.r,ke.g,ke.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(de){["butt","round","square"].indexOf(de)!==-1&&(this.ctx.lineCap=de,this.pdf.setLineCap(de))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(de){isNaN(de)||(this.ctx.lineWidth=de,this.pdf.setLineWidth(de))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(de){["bevel","round","miter"].indexOf(de)!==-1&&(this.ctx.lineJoin=de,this.pdf.setLineJoin(de))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(de){isNaN(de)||(this.ctx.miterLimit=de,this.pdf.setMiterLimit(de))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(de){this.ctx.textBaseline=de}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(de){["right","end","center","left","start"].indexOf(de)!==-1&&(this.ctx.textAlign=de)}});var he=null,st=null,Je=null;Object.defineProperty(this,"fontFaces",{get:function(){return Je},set:function(de){he=null,st=null,Je=de}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(de){var ke;if(this.ctx.font=de,(ke=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(de))!==null){var Ze=ke[1];ke[2];var vt=ke[3],tt=ke[4];ke[5];var ot=ke[6],wt=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(tt)[2];tt=Math.floor(wt==="px"?parseFloat(tt)*this.pdf.internal.scaleFactor:wt==="em"?parseFloat(tt)*this.pdf.getFontSize():parseFloat(tt)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(tt);var Mt=function(Ft){var Nr,Qi,ji=[],cr=Ft.trim();if(cr==="")return AL;if(cr in WV)return[WV[cr]];for(;cr!=="";){switch(Qi=null,Nr=(cr=qV(cr)).charAt(0)){case'"':case"'":Qi=Bae(cr.substring(1),Nr);break;default:Qi=Gae(cr)}if(Qi===null||(ji.push(Qi[0]),(cr=qV(Qi[1]))!==""&&cr.charAt(0)!==","))return AL;cr=cr.replace(/^,/,"")}return ji}(ot);if(this.fontFaces){var St=function(Ft,Nr){var Qi=Ft.getFontList(),ji=JSON.stringify(Qi);if(he===null||st!==ji){var cr=function(Yr){var Ci=[];return Object.keys(Yr).forEach(function(pr){Yr[pr].forEach(function(Ai){var Pi=null;switch(Ai){case"bold":Pi={family:pr,weight:"bold"};break;case"italic":Pi={family:pr,style:"italic"};break;case"bolditalic":Pi={family:pr,weight:"bold",style:"italic"};break;case"":case"normal":Pi={family:pr}}Pi!==null&&(Pi.ref={name:pr,style:Ai},Ci.push(Pi))})}),Ci}(Qi);he=function(Yr){for(var Ci={},pr=0;pr<Yr.length;++pr){var Ai=CL(Yr[pr]),Pi=Ai.family,er=Ai.stretch,xr=Ai.style,tr=Ai.weight;Ci[Pi]=Ci[Pi]||{},Ci[Pi][er]=Ci[Pi][er]||{},Ci[Pi][er][xr]=Ci[Pi][er][xr]||{},Ci[Pi][er][xr][tr]=Ai}return Ci}(cr.concat(Nr)),st=ji}return he}(this.pdf,this.fontFaces),ei=Mt.map(function(Ft){return{family:Ft,stretch:"normal",weight:vt,style:Ze}}),Jt=function(Ft,Nr,Qi){for(var ji=(Qi=Qi||{}).defaultFontFamily||"times",cr=Object.assign({},Nae,Qi.genericFontFamilies||{}),Yr=null,Ci=null,pr=0;pr<Nr.length;++pr)if(cr[(Yr=CL(Nr[pr])).family]&&(Yr.family=cr[Yr.family]),Ft.hasOwnProperty(Yr.family)){Ci=Ft[Yr.family];break}if(!(Ci=Ci||Ft[ji]))throw new Error("Could not find a font-family for the rule '"+HV(Yr)+"' and default family '"+ji+"'.");if(Ci=function(Ai,Pi){if(Pi[Ai])return Pi[Ai];var er=PL[Ai],xr=er<=PL.normal?-1:1,tr=$V(Pi,gU,er,xr);if(!tr)throw new Error("Could not find a matching font-stretch value for "+Ai);return tr}(Yr.stretch,Ci),Ci=function(Ai,Pi){if(Pi[Ai])return Pi[Ai];for(var er=fU[Ai],xr=0;xr<er.length;++xr)if(Pi[er[xr]])return Pi[er[xr]];throw new Error("Could not find a matching font-style for "+Ai)}(Yr.style,Ci),!(Ci=function(Ai,Pi){if(Pi[Ai])return Pi[Ai];if(Ai===400&&Pi[500])return Pi[500];if(Ai===500&&Pi[400])return Pi[400];var er=Rae[Ai],xr=$V(Pi,_U,er,Ai<400?-1:1);if(!xr)throw new Error("Could not find a matching font-weight for value "+Ai);return xr}(Yr.weight,Ci)))throw new Error("Failed to resolve a font for the rule '"+HV(Yr)+"'.");return Ci}(St,ei);this.pdf.setFont(Jt.ref.name,Jt.ref.style)}else{var Ut="";(vt==="bold"||parseInt(vt,10)>=700||Ze==="bold")&&(Ut="bold"),Ze==="italic"&&(Ut+="italic"),Ut.length===0&&(Ut="normal");for(var pi="",yi={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},Kt=0;Kt<Mt.length;Kt++){if(this.pdf.internal.getFont(Mt[Kt],Ut,{noFallback:!0,disableWarning:!0})!==void 0){pi=Mt[Kt];break}if(Ut==="bolditalic"&&this.pdf.internal.getFont(Mt[Kt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)pi=Mt[Kt],Ut="bold";else if(this.pdf.internal.getFont(Mt[Kt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){pi=Mt[Kt],Ut="normal";break}}if(pi===""){for(var li=0;li<Mt.length;li++)if(yi[Mt[li]]){pi=yi[Mt[li]];break}}pi=pi===""?"Times":pi,this.pdf.setFont(pi,Ut)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(de){this.ctx.globalCompositeOperation=de}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(de){this.ctx.globalAlpha=de}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(de){this.ctx.lineDashOffset=de,He.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(de){this.ctx.lineDash=de,He.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(de){this.ctx.ignoreClearRect=!!de}})};g.prototype.setLineDash=function(ye){this.lineDash=ye},g.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},g.prototype.fill=function(){ie.call(this,"fill",!1)},g.prototype.stroke=function(){ie.call(this,"stroke",!1)},g.prototype.beginPath=function(){this.path=[{type:"begin"}]},g.prototype.moveTo=function(ye,Ae){if(isNaN(ye)||isNaN(Ae))throw Xo.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Le=this.ctx.transform.applyToPoint(new l(ye,Ae));this.path.push({type:"mt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new l(ye,Ae)},g.prototype.closePath=function(){var ye=new l(0,0),Ae=0;for(Ae=this.path.length-1;Ae!==-1;Ae--)if(this.path[Ae].type==="begin"&&Eo(this.path[Ae+1])==="object"&&typeof this.path[Ae+1].x=="number"){ye=new l(this.path[Ae+1].x,this.path[Ae+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new l(ye.x,ye.y)},g.prototype.lineTo=function(ye,Ae){if(isNaN(ye)||isNaN(Ae))throw Xo.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Le=this.ctx.transform.applyToPoint(new l(ye,Ae));this.path.push({type:"lt",x:Le.x,y:Le.y}),this.ctx.lastPoint=new l(Le.x,Le.y)},g.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),ie.call(this,null,!0)},g.prototype.quadraticCurveTo=function(ye,Ae,Le,Ye){if(isNaN(Le)||isNaN(Ye)||isNaN(ye)||isNaN(Ae))throw Xo.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var qe=this.ctx.transform.applyToPoint(new l(Le,Ye)),et=this.ctx.transform.applyToPoint(new l(ye,Ae));this.path.push({type:"qct",x1:et.x,y1:et.y,x:qe.x,y:qe.y}),this.ctx.lastPoint=new l(qe.x,qe.y)},g.prototype.bezierCurveTo=function(ye,Ae,Le,Ye,qe,et){if(isNaN(qe)||isNaN(et)||isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye))throw Xo.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ft=this.ctx.transform.applyToPoint(new l(qe,et)),mt=this.ctx.transform.applyToPoint(new l(ye,Ae)),At=this.ctx.transform.applyToPoint(new l(Le,Ye));this.path.push({type:"bct",x1:mt.x,y1:mt.y,x2:At.x,y2:At.y,x:ft.x,y:ft.y}),this.ctx.lastPoint=new l(ft.x,ft.y)},g.prototype.arc=function(ye,Ae,Le,Ye,qe,et){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye)||isNaN(qe))throw Xo.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(et=!!et,!this.ctx.transform.isIdentity){var ft=this.ctx.transform.applyToPoint(new l(ye,Ae));ye=ft.x,Ae=ft.y;var mt=this.ctx.transform.applyToPoint(new l(0,Le)),At=this.ctx.transform.applyToPoint(new l(0,0));Le=Math.sqrt(Math.pow(mt.x-At.x,2)+Math.pow(mt.y-At.y,2))}Math.abs(qe-Ye)>=2*Math.PI&&(Ye=0,qe=2*Math.PI),this.path.push({type:"arc",x:ye,y:Ae,radius:Le,startAngle:Ye,endAngle:qe,counterclockwise:et})},g.prototype.arcTo=function(ye,Ae,Le,Ye,qe){throw new Error("arcTo not implemented.")},g.prototype.rect=function(ye,Ae,Le,Ye){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye))throw Xo.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(ye,Ae),this.lineTo(ye+Le,Ae),this.lineTo(ye+Le,Ae+Ye),this.lineTo(ye,Ae+Ye),this.lineTo(ye,Ae),this.lineTo(ye+Le,Ae),this.lineTo(ye,Ae)},g.prototype.fillRect=function(ye,Ae,Le,Ye){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye))throw Xo.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!_.call(this)){var qe={};this.lineCap!=="butt"&&(qe.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(qe.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(ye,Ae,Le,Ye),this.fill(),qe.hasOwnProperty("lineCap")&&(this.lineCap=qe.lineCap),qe.hasOwnProperty("lineJoin")&&(this.lineJoin=qe.lineJoin)}},g.prototype.strokeRect=function(ye,Ae,Le,Ye){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye))throw Xo.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");w.call(this)||(this.beginPath(),this.rect(ye,Ae,Le,Ye),this.stroke())},g.prototype.clearRect=function(ye,Ae,Le,Ye){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye))throw Xo.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(ye,Ae,Le,Ye))},g.prototype.save=function(ye){ye=typeof ye!="boolean"||ye;for(var Ae=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("q");if(this.pdf.setPage(Ae),ye){this.ctx.fontSize=this.pdf.internal.getFontSize();var Ye=new f(this.ctx);this.ctxStack.push(this.ctx),this.ctx=Ye}},g.prototype.restore=function(ye){ye=typeof ye!="boolean"||ye;for(var Ae=this.pdf.internal.getCurrentPageInfo().pageNumber,Le=0;Le<this.pdf.internal.getNumberOfPages();Le++)this.pdf.setPage(Le+1),this.pdf.internal.out("Q");this.pdf.setPage(Ae),ye&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},g.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var y=function(ye){var Ae,Le,Ye,qe;if(ye.isCanvasGradient===!0&&(ye=ye.getColor()),!ye)return{r:0,g:0,b:0,a:0,style:ye};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(ye))Ae=0,Le=0,Ye=0,qe=0;else{var et=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(ye);if(et!==null)Ae=parseInt(et[1]),Le=parseInt(et[2]),Ye=parseInt(et[3]),qe=1;else if((et=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(ye))!==null)Ae=parseInt(et[1]),Le=parseInt(et[2]),Ye=parseInt(et[3]),qe=parseFloat(et[4]);else{if(qe=1,typeof ye=="string"&&ye.charAt(0)!=="#"){var ft=new lU(ye);ye=ft.ok?ft.toHex():"#000000"}ye.length===4?(Ae=ye.substring(1,2),Ae+=Ae,Le=ye.substring(2,3),Le+=Le,Ye=ye.substring(3,4),Ye+=Ye):(Ae=ye.substring(1,3),Le=ye.substring(3,5),Ye=ye.substring(5,7)),Ae=parseInt(Ae,16),Le=parseInt(Le,16),Ye=parseInt(Ye,16)}}return{r:Ae,g:Le,b:Ye,a:qe,style:ye}},_=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},w=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};g.prototype.fillText=function(ye,Ae,Le,Ye){if(isNaN(Ae)||isNaN(Le)||typeof ye!="string")throw Xo.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(Ye=isNaN(Ye)?void 0:Ye,!_.call(this)){var qe=ze(this.ctx.transform.rotation),et=this.ctx.transform.scaleX;te.call(this,{text:ye,x:Ae,y:Le,scale:et,angle:qe,align:this.textAlign,maxWidth:Ye})}},g.prototype.strokeText=function(ye,Ae,Le,Ye){if(isNaN(Ae)||isNaN(Le)||typeof ye!="string")throw Xo.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!w.call(this)){Ye=isNaN(Ye)?void 0:Ye;var qe=ze(this.ctx.transform.rotation),et=this.ctx.transform.scaleX;te.call(this,{text:ye,x:Ae,y:Le,scale:et,renderingMode:"stroke",angle:qe,align:this.textAlign,maxWidth:Ye})}},g.prototype.measureText=function(ye){if(typeof ye!="string")throw Xo.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var Ae=this.pdf,Le=this.pdf.internal.scaleFactor,Ye=Ae.internal.getFontSize(),qe=Ae.getStringUnitWidth(ye)*Ye/Ae.internal.scaleFactor;return new function(et){var ft=(et=et||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ft}}),this}({width:qe*=Math.round(96*Le/72*1e4)/1e4})},g.prototype.scale=function(ye,Ae){if(isNaN(ye)||isNaN(Ae))throw Xo.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Le=new p(ye,0,0,Ae,0,0);this.ctx.transform=this.ctx.transform.multiply(Le)},g.prototype.rotate=function(ye){if(isNaN(ye))throw Xo.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var Ae=new p(Math.cos(ye),Math.sin(ye),-Math.sin(ye),Math.cos(ye),0,0);this.ctx.transform=this.ctx.transform.multiply(Ae)},g.prototype.translate=function(ye,Ae){if(isNaN(ye)||isNaN(Ae))throw Xo.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Le=new p(1,0,0,1,ye,Ae);this.ctx.transform=this.ctx.transform.multiply(Le)},g.prototype.transform=function(ye,Ae,Le,Ye,qe,et){if(isNaN(ye)||isNaN(Ae)||isNaN(Le)||isNaN(Ye)||isNaN(qe)||isNaN(et))throw Xo.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ft=new p(ye,Ae,Le,Ye,qe,et);this.ctx.transform=this.ctx.transform.multiply(ft)},g.prototype.setTransform=function(ye,Ae,Le,Ye,qe,et){ye=isNaN(ye)?1:ye,Ae=isNaN(Ae)?0:Ae,Le=isNaN(Le)?0:Le,Ye=isNaN(Ye)?1:Ye,qe=isNaN(qe)?0:qe,et=isNaN(et)?0:et,this.ctx.transform=new p(ye,Ae,Le,Ye,qe,et)};var A=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};g.prototype.drawImage=function(ye,Ae,Le,Ye,qe,et,ft,mt,At){var ht=this.pdf.getImageProperties(ye),he=1,st=1,Je=1,de=1;Ye!==void 0&&mt!==void 0&&(Je=mt/Ye,de=At/qe,he=ht.width/Ye*mt/Ye,st=ht.height/qe*At/qe),et===void 0&&(et=Ae,ft=Le,Ae=0,Le=0),Ye!==void 0&&mt===void 0&&(mt=Ye,At=qe),Ye===void 0&&mt===void 0&&(mt=ht.width,At=ht.height);var ke=this.ctx.transform.decompose(),Ze=ze(ke.rotate.shx),vt=new p,tt=(vt=(vt=(vt=vt.multiply(ke.translate)).multiply(ke.skew)).multiply(ke.scale)).applyToRectangle(new h(et-Ae*Je,ft-Le*de,Ye*he,qe*st));if(this.autoPaging){for(var ot,wt=k.call(this,tt),Mt=[],St=0;St<wt.length;St+=1)Mt.indexOf(wt[St])===-1&&Mt.push(wt[St]);X(Mt);for(var ei=Mt[0],Jt=Mt[Mt.length-1],Ut=ei;Ut<Jt+1;Ut++){this.pdf.setPage(Ut);var pi=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],yi=Ut===1?this.posY+this.margin[0]:this.margin[0],Kt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],li=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ft=Ut===1?0:Kt+(Ut-2)*li;if(this.ctx.clip_path.length!==0){var Nr=this.path;ot=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(ot,this.posX+this.margin[3],-Ft+yi+this.ctx.prevPageLastElemOffset),ae.call(this,"fill",!0),this.path=Nr}var Qi=JSON.parse(JSON.stringify(tt));Qi=q([Qi],this.posX+this.margin[3],-Ft+yi+this.ctx.prevPageLastElemOffset)[0];var ji=(Ut>ei||Ut<Jt)&&A.call(this);ji&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],pi,li,null).clip().discardPath()),this.pdf.addImage(ye,"JPEG",Qi.x,Qi.y,Qi.w,Qi.h,null,null,Ze),ji&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(ye,"JPEG",tt.x,tt.y,tt.w,tt.h,null,null,Ze)};var k=function(ye,Ae,Le){var Ye=[];Ae=Ae||this.pdf.internal.pageSize.width,Le=Le||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var qe=this.posY+this.ctx.prevPageLastElemOffset;switch(ye.type){default:case"mt":case"lt":Ye.push(Math.floor((ye.y+qe)/Le)+1);break;case"arc":Ye.push(Math.floor((ye.y+qe-ye.radius)/Le)+1),Ye.push(Math.floor((ye.y+qe+ye.radius)/Le)+1);break;case"qct":var et=Re(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ye.x1,ye.y1,ye.x,ye.y);Ye.push(Math.floor((et.y+qe)/Le)+1),Ye.push(Math.floor((et.y+et.h+qe)/Le)+1);break;case"bct":var ft=Ge(this.ctx.lastPoint.x,this.ctx.lastPoint.y,ye.x1,ye.y1,ye.x2,ye.y2,ye.x,ye.y);Ye.push(Math.floor((ft.y+qe)/Le)+1),Ye.push(Math.floor((ft.y+ft.h+qe)/Le)+1);break;case"rect":Ye.push(Math.floor((ye.y+qe)/Le)+1),Ye.push(Math.floor((ye.y+ye.h+qe)/Le)+1)}for(var mt=0;mt<Ye.length;mt+=1)for(;this.pdf.internal.getNumberOfPages()<Ye[mt];)R.call(this);return Ye},R=function(){var ye=this.fillStyle,Ae=this.strokeStyle,Le=this.font,Ye=this.lineCap,qe=this.lineWidth,et=this.lineJoin;this.pdf.addPage(),this.fillStyle=ye,this.strokeStyle=Ae,this.font=Le,this.lineCap=Ye,this.lineWidth=qe,this.lineJoin=et},q=function(ye,Ae,Le){for(var Ye=0;Ye<ye.length;Ye++)switch(ye[Ye].type){case"bct":ye[Ye].x2+=Ae,ye[Ye].y2+=Le;case"qct":ye[Ye].x1+=Ae,ye[Ye].y1+=Le;default:ye[Ye].x+=Ae,ye[Ye].y+=Le}return ye},X=function(ye){return ye.sort(function(Ae,Le){return Ae-Le})},ie=function(ye,Ae){var Le=this.fillStyle,Ye=this.strokeStyle,qe=this.lineCap,et=this.lineWidth,ft=Math.abs(et*this.ctx.transform.scaleX),mt=this.lineJoin;if(this.autoPaging){for(var At,ht,he=JSON.parse(JSON.stringify(this.path)),st=JSON.parse(JSON.stringify(this.path)),Je=[],de=0;de<st.length;de++)if(st[de].x!==void 0)for(var ke=k.call(this,st[de]),Ze=0;Ze<ke.length;Ze+=1)Je.indexOf(ke[Ze])===-1&&Je.push(ke[Ze]);for(var vt=0;vt<Je.length;vt++)for(;this.pdf.internal.getNumberOfPages()<Je[vt];)R.call(this);X(Je);for(var tt=Je[0],ot=Je[Je.length-1],wt=tt;wt<ot+1;wt++){this.pdf.setPage(wt),this.fillStyle=Le,this.strokeStyle=Ye,this.lineCap=qe,this.lineWidth=ft,this.lineJoin=mt;var Mt=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],St=wt===1?this.posY+this.margin[0]:this.margin[0],ei=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Jt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ut=wt===1?0:ei+(wt-2)*Jt;if(this.ctx.clip_path.length!==0){var pi=this.path;At=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(At,this.posX+this.margin[3],-Ut+St+this.ctx.prevPageLastElemOffset),ae.call(this,ye,!0),this.path=pi}if(ht=JSON.parse(JSON.stringify(he)),this.path=q(ht,this.posX+this.margin[3],-Ut+St+this.ctx.prevPageLastElemOffset),Ae===!1||wt===0){var yi=(wt>tt||wt<ot)&&A.call(this);yi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Mt,Jt,null).clip().discardPath()),ae.call(this,ye,Ae),yi&&this.pdf.restoreGraphicsState()}this.lineWidth=et}this.path=he}else this.lineWidth=ft,ae.call(this,ye,Ae),this.lineWidth=et},ae=function(ye,Ae){if((ye!=="stroke"||Ae||!w.call(this))&&(ye==="stroke"||Ae||!_.call(this))){for(var Le,Ye,qe=[],et=this.path,ft=0;ft<et.length;ft++){var mt=et[ft];switch(mt.type){case"begin":qe.push({begin:!0});break;case"close":qe.push({close:!0});break;case"mt":qe.push({start:mt,deltas:[],abs:[]});break;case"lt":var At=qe.length;if(et[ft-1]&&!isNaN(et[ft-1].x)&&(Le=[mt.x-et[ft-1].x,mt.y-et[ft-1].y],At>0)){for(;At>=0;At--)if(qe[At-1].close!==!0&&qe[At-1].begin!==!0){qe[At-1].deltas.push(Le),qe[At-1].abs.push(mt);break}}break;case"bct":Le=[mt.x1-et[ft-1].x,mt.y1-et[ft-1].y,mt.x2-et[ft-1].x,mt.y2-et[ft-1].y,mt.x-et[ft-1].x,mt.y-et[ft-1].y],qe[qe.length-1].deltas.push(Le);break;case"qct":var ht=et[ft-1].x+2/3*(mt.x1-et[ft-1].x),he=et[ft-1].y+2/3*(mt.y1-et[ft-1].y),st=mt.x+2/3*(mt.x1-mt.x),Je=mt.y+2/3*(mt.y1-mt.y),de=mt.x,ke=mt.y;Le=[ht-et[ft-1].x,he-et[ft-1].y,st-et[ft-1].x,Je-et[ft-1].y,de-et[ft-1].x,ke-et[ft-1].y],qe[qe.length-1].deltas.push(Le);break;case"arc":qe.push({deltas:[],abs:[],arc:!0}),Array.isArray(qe[qe.length-1].abs)&&qe[qe.length-1].abs.push(mt)}}Ye=Ae?null:ye==="stroke"?"stroke":"fill";for(var Ze=!1,vt=0;vt<qe.length;vt++)if(qe[vt].arc)for(var tt=qe[vt].abs,ot=0;ot<tt.length;ot++){var wt=tt[ot];wt.type==="arc"?fe.call(this,wt.x,wt.y,wt.radius,wt.startAngle,wt.endAngle,wt.counterclockwise,void 0,Ae,!Ze):Se.call(this,wt.x,wt.y),Ze=!0}else if(qe[vt].close===!0)this.pdf.internal.out("h"),Ze=!1;else if(qe[vt].begin!==!0){var Mt=qe[vt].start.x,St=qe[vt].start.y;Te.call(this,qe[vt].deltas,Mt,St),Ze=!0}Ye&&ge.call(this,Ye),Ae&&ue.call(this)}},be=function(ye){var Ae=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Le=Ae*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return ye-Le;case"top":return ye+Ae-Le;case"hanging":return ye+Ae-2*Le;case"middle":return ye+Ae/2-Le;default:return ye}},me=function(ye){return ye+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};g.prototype.createLinearGradient=function(){var ye=function(){};return ye.colorStops=[],ye.addColorStop=function(Ae,Le){this.colorStops.push([Ae,Le])},ye.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},ye.isCanvasGradient=!0,ye},g.prototype.createPattern=function(){return this.createLinearGradient()},g.prototype.createRadialGradient=function(){return this.createLinearGradient()};var fe=function(ye,Ae,Le,Ye,qe,et,ft,mt,At){for(var ht=je.call(this,Le,Ye,qe,et),he=0;he<ht.length;he++){var st=ht[he];he===0&&(At?se.call(this,st.x1+ye,st.y1+Ae):Se.call(this,st.x1+ye,st.y1+Ae)),Ee.call(this,ye,Ae,st.x2,st.y2,st.x3,st.y3,st.x4,st.y4)}mt?ue.call(this):ge.call(this,ft)},ge=function(ye){switch(ye){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},ue=function(){this.pdf.clip(),this.pdf.discardPath()},se=function(ye,Ae){this.pdf.internal.out(e(ye)+" "+n(Ae)+" m")},te=function(ye){var Ae;switch(ye.align){case"right":case"end":Ae="right";break;case"center":Ae="center";break;default:Ae="left"}var Le,Ye,qe,et=this.pdf.getTextDimensions(ye.text),ft=be.call(this,ye.y),mt=me.call(this,ft)-et.h,At=this.ctx.transform.applyToPoint(new l(ye.x,ft));if(this.autoPaging){var ht=this.ctx.transform.decompose(),he=new p;he=(he=(he=he.multiply(ht.translate)).multiply(ht.skew)).multiply(ht.scale);for(var st=this.ctx.transform.applyToRectangle(new h(ye.x,ft,et.w,et.h)),Je=he.applyToRectangle(new h(ye.x,mt,et.w,et.h)),de=k.call(this,Je),ke=[],Ze=0;Ze<de.length;Ze+=1)ke.indexOf(de[Ze])===-1&&ke.push(de[Ze]);X(ke);for(var vt=ke[0],tt=ke[ke.length-1],ot=vt;ot<tt+1;ot++){this.pdf.setPage(ot);var wt=ot===1?this.posY+this.margin[0]:this.margin[0],Mt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],St=this.pdf.internal.pageSize.height-this.margin[2],ei=St-this.margin[0],Jt=this.pdf.internal.pageSize.width-this.margin[1],Ut=Jt-this.margin[3],pi=ot===1?0:Mt+(ot-2)*ei;if(this.ctx.clip_path.length!==0){var yi=this.path;Le=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=q(Le,this.posX+this.margin[3],-1*pi+wt),ae.call(this,"fill",!0),this.path=yi}var Kt=q([JSON.parse(JSON.stringify(Je))],this.posX+this.margin[3],-pi+wt+this.ctx.prevPageLastElemOffset)[0];ye.scale>=.01&&(Ye=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ye*ye.scale),qe=this.lineWidth,this.lineWidth=qe*ye.scale);var li=this.autoPaging!=="text";if(li||Kt.y+Kt.h<=St){if(li||Kt.y>=wt&&Kt.x<=Jt){var Ft=li?ye.text:this.pdf.splitTextToSize(ye.text,ye.maxWidth||Jt-Kt.x)[0],Nr=q([JSON.parse(JSON.stringify(st))],this.posX+this.margin[3],-pi+wt+this.ctx.prevPageLastElemOffset)[0],Qi=li&&(ot>vt||ot<tt)&&A.call(this);Qi&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ut,ei,null).clip().discardPath()),this.pdf.text(Ft,Nr.x,Nr.y,{angle:ye.angle,align:Ae,renderingMode:ye.renderingMode}),Qi&&this.pdf.restoreGraphicsState()}}else Kt.y<St&&(this.ctx.prevPageLastElemOffset+=St-Kt.y);ye.scale>=.01&&(this.pdf.setFontSize(Ye),this.lineWidth=qe)}}else ye.scale>=.01&&(Ye=this.pdf.internal.getFontSize(),this.pdf.setFontSize(Ye*ye.scale),qe=this.lineWidth,this.lineWidth=qe*ye.scale),this.pdf.text(ye.text,At.x+this.posX,At.y+this.posY,{angle:ye.angle,align:Ae,renderingMode:ye.renderingMode,maxWidth:ye.maxWidth}),ye.scale>=.01&&(this.pdf.setFontSize(Ye),this.lineWidth=qe)},Se=function(ye,Ae,Le,Ye){Le=Le||0,Ye=Ye||0,this.pdf.internal.out(e(ye+Le)+" "+n(Ae+Ye)+" l")},Te=function(ye,Ae,Le){return this.pdf.lines(ye,Ae,Le,null,null)},Ee=function(ye,Ae,Le,Ye,qe,et,ft,mt){this.pdf.internal.out([i(o(Le+ye)),i(s(Ye+Ae)),i(o(qe+ye)),i(s(et+Ae)),i(o(ft+ye)),i(s(mt+Ae)),"c"].join(" "))},je=function(ye,Ae,Le,Ye){for(var qe=2*Math.PI,et=Math.PI/2;Ae>Le;)Ae-=qe;var ft=Math.abs(Le-Ae);ft<qe&&Ye&&(ft=qe-ft);for(var mt=[],At=Ye?-1:1,ht=Ae;ft>1e-5;){var he=ht+At*Math.min(ft,et);mt.push(Ne.call(this,ye,ht,he)),ft-=Math.abs(he-ht),ht=he}return mt},Ne=function(ye,Ae,Le){var Ye=(Le-Ae)/2,qe=ye*Math.cos(Ye),et=ye*Math.sin(Ye),ft=qe,mt=-et,At=ft*ft+mt*mt,ht=At+ft*qe+mt*et,he=4/3*(Math.sqrt(2*At*ht)-ht)/(ft*et-mt*qe),st=ft-he*mt,Je=mt+he*ft,de=st,ke=-Je,Ze=Ye+Ae,vt=Math.cos(Ze),tt=Math.sin(Ze);return{x1:ye*Math.cos(Ae),y1:ye*Math.sin(Ae),x2:st*vt-Je*tt,y2:st*tt+Je*vt,x3:de*vt-ke*tt,y3:de*tt+ke*vt,x4:ye*Math.cos(Le),y4:ye*Math.sin(Le)}},ze=function(ye){return 180*ye/Math.PI},Re=function(ye,Ae,Le,Ye,qe,et){var ft=ye+.5*(Le-ye),mt=Ae+.5*(Ye-Ae),At=qe+.5*(Le-qe),ht=et+.5*(Ye-et),he=Math.min(ye,qe,ft,At),st=Math.max(ye,qe,ft,At),Je=Math.min(Ae,et,mt,ht),de=Math.max(Ae,et,mt,ht);return new h(he,Je,st-he,de-Je)},Ge=function(ye,Ae,Le,Ye,qe,et,ft,mt){var At,ht,he,st,Je,de,ke,Ze,vt,tt,ot,wt,Mt,St,ei=Le-ye,Jt=Ye-Ae,Ut=qe-Le,pi=et-Ye,yi=ft-qe,Kt=mt-et;for(ht=0;ht<41;ht++)vt=(ke=(he=ye+(At=ht/40)*ei)+At*((Je=Le+At*Ut)-he))+At*(Je+At*(qe+At*yi-Je)-ke),tt=(Ze=(st=Ae+At*Jt)+At*((de=Ye+At*pi)-st))+At*(de+At*(et+At*Kt-de)-Ze),ht==0?(ot=vt,wt=tt,Mt=vt,St=tt):(ot=Math.min(ot,vt),wt=Math.min(wt,tt),Mt=Math.max(Mt,vt),St=Math.max(St,tt));return new h(Math.round(ot),Math.round(wt),Math.round(Mt-ot),Math.round(St-wt))},He=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var ye,Ae,Le=(ye=this.ctx.lineDash,Ae=this.ctx.lineDashOffset,JSON.stringify({lineDash:ye,lineDashOffset:Ae}));this.prevLineDash!==Le&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Le)}}})(Ui.API),function(r){var i=function(l){var h,p,m,f,g,y,_,w,A,k;for(/[^\x00-\xFF]/.test(l),p=[],m=0,f=(l+=h="\0\0\0\0".slice(l.length%4||4)).length;f>m;m+=4)(g=(l.charCodeAt(m)<<24)+(l.charCodeAt(m+1)<<16)+(l.charCodeAt(m+2)<<8)+l.charCodeAt(m+3))!==0?(y=(g=((g=((g=((g=(g-(k=g%85))/85)-(A=g%85))/85)-(w=g%85))/85)-(_=g%85))/85)%85,p.push(y+33,_+33,w+33,A+33,k+33)):p.push(122);return function(R,q){for(var X=q;X>0;X--)R.pop()}(p,h.length),String.fromCharCode.apply(String,p)+"~>"},e=function(l){var h,p,m,f,g,y=String,_="length",w=255,A="charCodeAt",k="slice",R="replace";for(l[k](-2),l=l[k](0,-2)[R](/\s/g,"")[R]("z","!!!!!"),m=[],f=0,g=(l+=h="uuuuu"[k](l[_]%5||5))[_];g>f;f+=5)p=52200625*(l[A](f)-33)+614125*(l[A](f+1)-33)+7225*(l[A](f+2)-33)+85*(l[A](f+3)-33)+(l[A](f+4)-33),m.push(w&p>>24,w&p>>16,w&p>>8,w&p);return function(q,X){for(var ie=X;ie>0;ie--)q.pop()}(m,h[_]),y.fromCharCode.apply(y,m)},n=function(l){return l.split("").map(function(h){return("0"+h.charCodeAt().toString(16)).slice(-2)}).join("")+">"},o=function(l){var h=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((l=l.replace(/\s/g,"")).indexOf(">")!==-1&&(l=l.substr(0,l.indexOf(">"))),l.length%2&&(l+="0"),h.test(l)===!1)return"";for(var p="",m=0;m<l.length;m+=2)p+=String.fromCharCode("0x"+(l[m]+l[m+1]));return p},s=function(l){for(var h=new Uint8Array(l.length),p=l.length;p--;)h[p]=l.charCodeAt(p);return(h=fM(h)).reduce(function(m,f){return m+String.fromCharCode(f)},"")};r.processDataByFilters=function(l,h){var p=0,m=l||"",f=[];for(typeof(h=h||[])=="string"&&(h=[h]),p=0;p<h.length;p+=1)switch(h[p]){case"ASCII85Decode":case"/ASCII85Decode":m=e(m),f.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":m=i(m),f.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":m=o(m),f.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":m=n(m),f.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":m=s(m),f.push("/FlateDecode");break;default:throw new Error('The filter: "'+h[p]+'" is not implemented')}return{data:m,reverseChain:f.reverse().join(" ")}}}(Ui.API),function(r){r.loadFile=function(i,e,n){return function(o,s,l){s=s!==!1,l=typeof l=="function"?l:function(){};var h=void 0;try{h=function(p,m,f){var g=new XMLHttpRequest,y=0,_=function(w){var A=w.length,k=[],R=String.fromCharCode;for(y=0;y<A;y+=1)k.push(R(255&w.charCodeAt(y)));return k.join("")};if(g.open("GET",p,!m),g.overrideMimeType("text/plain; charset=x-user-defined"),m===!1&&(g.onload=function(){g.status===200?f(_(this.responseText)):f(void 0)}),g.send(null),m&&g.status===200)return _(g.responseText)}(o,s,l)}catch{}return h}(i,e,n)},r.loadImageFile=r.loadFile}(Ui.API),function(r){function i(){return(Wr.html2canvas?Promise.resolve(Wr.html2canvas):import("./chunk-3EKDZYTU.js")).catch(function(h){return Promise.reject(new Error("Could not load html2canvas: "+h))}).then(function(h){return h.default?h.default:h})}function e(){return(Wr.DOMPurify?Promise.resolve(Wr.DOMPurify):import("./chunk-6JLJWFXC.js")).catch(function(h){return Promise.reject(new Error("Could not load dompurify: "+h))}).then(function(h){return h.default?h.default:h})}var n=function(h){var p=Eo(h);return p==="undefined"?"undefined":p==="string"||h instanceof String?"string":p==="number"||h instanceof Number?"number":p==="function"||h instanceof Function?"function":h&&h.constructor===Array?"array":h&&h.nodeType===1?"element":p==="object"?"object":"unknown"},o=function(h,p){var m=document.createElement(h);for(var f in p.className&&(m.className=p.className),p.innerHTML&&p.dompurify&&(m.innerHTML=p.dompurify.sanitize(p.innerHTML)),p.style)m.style[f]=p.style[f];return m},s=function h(p,m){for(var f=p.nodeType===3?document.createTextNode(p.nodeValue):p.cloneNode(!1),g=p.firstChild;g;g=g.nextSibling)m!==!0&&g.nodeType===1&&g.nodeName==="SCRIPT"||f.appendChild(h(g,m));return p.nodeType===1&&(p.nodeName==="CANVAS"?(f.width=p.width,f.height=p.height,f.getContext("2d").drawImage(p,0,0)):p.nodeName!=="TEXTAREA"&&p.nodeName!=="SELECT"||(f.value=p.value),f.addEventListener("load",function(){f.scrollTop=p.scrollTop,f.scrollLeft=p.scrollLeft},!0)),f},l=function h(p){var m=Object.assign(h.convert(Promise.resolve()),JSON.parse(JSON.stringify(h.template))),f=h.convert(Promise.resolve(),m);return(f=f.setProgress(1,h,1,[h])).set(p)};(l.prototype=Object.create(Promise.prototype)).constructor=l,l.convert=function(h,p){return h.__proto__=p||l.prototype,h},l.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},l.prototype.from=function(h,p){return this.then(function(){switch(p=p||function(m){switch(n(m)){case"string":return"string";case"element":return m.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}}(h),p){case"string":return this.then(e).then(function(m){return this.set({src:o("div",{innerHTML:h,dompurify:m})})});case"element":return this.set({src:h});case"canvas":return this.set({canvas:h});case"img":return this.set({img:h});default:return this.error("Unknown source type.")}})},l.prototype.to=function(h){switch(h){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},l.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var h={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},p=s(this.prop.src,this.opt.html2canvas.javascriptEnabled);p.tagName==="BODY"&&(h.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=o("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=o("div",{className:"html2pdf__container",style:h}),this.prop.container.appendChild(p),this.prop.container.firstChild.appendChild(o("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},l.prototype.toCanvas=function(){var h=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(h).then(i).then(function(p){var m=Object.assign({},this.opt.html2canvas);return delete m.onrendered,p(this.prop.container,m)}).then(function(p){(this.opt.html2canvas.onrendered||function(){})(p),this.prop.canvas=p,document.body.removeChild(this.prop.overlay)})},l.prototype.toContext2d=function(){var h=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(h).then(i).then(function(p){var m=this.opt.jsPDF,f=this.opt.fontFaces,g=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,y=Object.assign({async:!0,allowTaint:!0,scale:g,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete y.onrendered,m.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,m.context2d.posX=this.opt.x,m.context2d.posY=this.opt.y,m.context2d.margin=this.opt.margin,m.context2d.fontFaces=f,f)for(var _=0;_<f.length;++_){var w=f[_],A=w.src.find(function(k){return k.format==="truetype"});A&&m.addFont(A.url,w.ref.name,w.ref.style)}return y.windowHeight=y.windowHeight||0,y.windowHeight=y.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):y.windowHeight,m.context2d.save(!0),p(this.prop.container,y)}).then(function(p){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(p),this.prop.canvas=p,document.body.removeChild(this.prop.overlay)})},l.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var h=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=h})},l.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},l.prototype.output=function(h,p,m){return(m=m||"pdf").toLowerCase()==="img"||m.toLowerCase()==="image"?this.outputImg(h,p):this.outputPdf(h,p)},l.prototype.outputPdf=function(h,p){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(h,p)})},l.prototype.outputImg=function(h){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(h){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+h+'" is not supported.'}})},l.prototype.save=function(h){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(h?{filename:h}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},l.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},l.prototype.set=function(h){if(n(h)!=="object")return this;var p=Object.keys(h||{}).map(function(m){if(m in l.template.prop)return function(){this.prop[m]=h[m]};switch(m){case"margin":return this.setMargin.bind(this,h.margin);case"jsPDF":return function(){return this.opt.jsPDF=h.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,h.pageSize);default:return function(){this.opt[m]=h[m]}}},this);return this.then(function(){return this.thenList(p)})},l.prototype.get=function(h,p){return this.then(function(){var m=h in l.template.prop?this.prop[h]:this.opt[h];return p?p(m):m})},l.prototype.setMargin=function(h){return this.then(function(){switch(n(h)){case"number":h=[h,h,h,h];case"array":if(h.length===2&&(h=[h[0],h[1],h[0],h[1]]),h.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=h}).then(this.setPageSize)},l.prototype.setPageSize=function(h){function p(m,f){return Math.floor(m*f/72*96)}return this.then(function(){(h=h||Ui.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(h.inner={width:h.width-this.opt.margin[1]-this.opt.margin[3],height:h.height-this.opt.margin[0]-this.opt.margin[2]},h.inner.px={width:p(h.inner.width,h.k),height:p(h.inner.height,h.k)},h.inner.ratio=h.inner.height/h.inner.width),this.prop.pageSize=h})},l.prototype.setProgress=function(h,p,m,f){return h!=null&&(this.progress.val=h),p!=null&&(this.progress.state=p),m!=null&&(this.progress.n=m),f!=null&&(this.progress.stack=f),this.progress.ratio=this.progress.val/this.progress.state,this},l.prototype.updateProgress=function(h,p,m,f){return this.setProgress(h?this.progress.val+h:null,p||null,m?this.progress.n+m:null,f?this.progress.stack.concat(f):null)},l.prototype.then=function(h,p){var m=this;return this.thenCore(h,p,function(f,g){return m.updateProgress(null,null,1,[f]),Promise.prototype.then.call(this,function(y){return m.updateProgress(null,f),y}).then(f,g).then(function(y){return m.updateProgress(1),y})})},l.prototype.thenCore=function(h,p,m){m=m||Promise.prototype.then;var f=this;h&&(h=h.bind(f)),p&&(p=p.bind(f));var g=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?f:l.convert(Object.assign({},f),Promise.prototype),y=m.call(g,h,p);return l.convert(y,f.__proto__)},l.prototype.thenExternal=function(h,p){return Promise.prototype.then.call(this,h,p)},l.prototype.thenList=function(h){var p=this;return h.forEach(function(m){p=p.thenCore(m)}),p},l.prototype.catch=function(h){h&&(h=h.bind(this));var p=Promise.prototype.catch.call(this,h);return l.convert(p,this)},l.prototype.catchExternal=function(h){return Promise.prototype.catch.call(this,h)},l.prototype.error=function(h){return this.then(function(){throw new Error(h)})},l.prototype.using=l.prototype.set,l.prototype.saveAs=l.prototype.save,l.prototype.export=l.prototype.output,l.prototype.run=l.prototype.then,Ui.getPageSize=function(h,p,m){if(Eo(h)==="object"){var f=h;h=f.orientation,p=f.unit||p,m=f.format||m}p=p||"mm",m=m||"a4",h=(""+(h||"P")).toLowerCase();var g,y=(""+m).toLowerCase(),_={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(p){case"pt":g=1;break;case"mm":g=72/25.4;break;case"cm":g=72/2.54;break;case"in":g=72;break;case"px":g=.75;break;case"pc":case"em":g=12;break;case"ex":g=6;break;default:throw"Invalid unit: "+p}var w,A=0,k=0;if(_.hasOwnProperty(y))A=_[y][1]/g,k=_[y][0]/g;else try{A=m[1],k=m[0]}catch{throw new Error("Invalid format: "+m)}if(h==="p"||h==="portrait")h="p",k>A&&(w=k,k=A,A=w);else{if(h!=="l"&&h!=="landscape")throw"Invalid orientation: "+h;h="l",A>k&&(w=k,k=A,A=w)}return{width:k,height:A,unit:p,k:g,orientation:h}},r.html=function(h,p){(p=p||{}).callback=p.callback||function(){},p.html2canvas=p.html2canvas||{},p.html2canvas.canvas=p.html2canvas.canvas||this.canvas,p.jsPDF=p.jsPDF||this,p.fontFaces=p.fontFaces?p.fontFaces.map(CL):null;var m=new l(p);return p.worker?m:m.from(h).doCallback()}}(Ui.API),Ui.API.addJS=function(r){return ZV=r,this.internal.events.subscribe("postPutResources",function(){GM=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(GM+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),YV=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+ZV+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){GM!==void 0&&YV!==void 0&&this.internal.out("/Names <</JavaScript "+GM+" 0 R>>")}),this},function(r){var i;r.events.push(["postPutResources",function(){var e=this,n=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var o=e.outline.render().split(/\r\n/),s=0;s<o.length;s++){var l=o[s],h=n.exec(l);if(h!=null){var p=h[1];e.internal.newObjectDeferredBegin(p,!1)}e.internal.write(l)}if(this.outline.createNamedDestinations){var m=this.internal.pages.length,f=[];for(s=0;s<m;s++){var g=e.internal.newObject();f.push(g);var y=e.internal.getPageInfo(s+1);e.internal.write("<< /D["+y.objId+" 0 R /XYZ null null null]>> endobj")}var _=e.internal.newObject();for(e.internal.write("<< /Names [ "),s=0;s<f.length;s++)e.internal.write("(page_"+(s+1)+")"+f[s]+" 0 R");e.internal.write(" ] >>","endobj"),i=e.internal.newObject(),e.internal.write("<< /Dests "+_+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+i+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(n,o,s){var l={title:o,options:s,children:[]};return n==null&&(n=this.root),n.children.push(l),l},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(n){n.id=e.internal.newObjectDeferred();for(var o=0;o<n.children.length;o++)this.genIds_r(n.children[o])},e.outline.renderRoot=function(n){this.objStart(n),this.line("/Type /Outlines"),n.children.length>0&&(this.line("/First "+this.makeRef(n.children[0])),this.line("/Last "+this.makeRef(n.children[n.children.length-1]))),this.line("/Count "+this.count_r({count:0},n)),this.objEnd()},e.outline.renderItems=function(n){for(var o=this.ctx.pdf.internal.getVerticalCoordinateString,s=0;s<n.children.length;s++){var l=n.children[s];this.objStart(l),this.line("/Title "+this.makeString(l.title)),this.line("/Parent "+this.makeRef(n)),s>0&&this.line("/Prev "+this.makeRef(n.children[s-1])),s<n.children.length-1&&this.line("/Next "+this.makeRef(n.children[s+1])),l.children.length>0&&(this.line("/First "+this.makeRef(l.children[0])),this.line("/Last "+this.makeRef(l.children[l.children.length-1])));var h=this.count=this.count_r({count:0},l);if(h>0&&this.line("/Count "+h),l.options&&l.options.pageNumber){var p=e.internal.getPageInfo(l.options.pageNumber);this.line("/Dest ["+p.objId+" 0 R /XYZ 0 "+o(0)+" 0]")}this.objEnd()}for(var m=0;m<n.children.length;m++)this.renderItems(n.children[m])},e.outline.line=function(n){this.ctx.val+=n+`\r
`},e.outline.makeRef=function(n){return n.id+" 0 R"},e.outline.makeString=function(n){return"("+e.internal.pdfEscape(n)+")"},e.outline.objStart=function(n){this.ctx.val+=`\r
`+n.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(n,o){for(var s=0;s<o.children.length;s++)n.count++,this.count_r(n,o.children[s]);return n.count}}])}(Ui.API),function(r){var i=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,n,o,s,l,h){var p,m=this.decode.DCT_DECODE,f=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=l||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,p=function(g){for(var y,_=256*g.charCodeAt(4)+g.charCodeAt(5),w=g.length,A={width:0,height:0,numcomponents:1},k=4;k<w;k+=2){if(k+=_,i.indexOf(g.charCodeAt(k+1))!==-1){y=256*g.charCodeAt(k+5)+g.charCodeAt(k+6),A={width:256*g.charCodeAt(k+7)+g.charCodeAt(k+8),height:y,numcomponents:g.charCodeAt(k+9)};break}_=256*g.charCodeAt(k+2)+g.charCodeAt(k+3)}return A}(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),p.numcomponents){case 1:h=this.color_spaces.DEVICE_GRAY;break;case 4:h=this.color_spaces.DEVICE_CMYK;break;case 3:h=this.color_spaces.DEVICE_RGB}f={data:e,width:p.width,height:p.height,colorSpace:h,bitsPerComponent:8,filter:m,index:n,alias:o}}return f}}(Ui.API),Ui.API.processPNG=function(r,i,e,n){if(this.__addimage__.isArrayBuffer(r)&&(r=new Uint8Array(r)),this.__addimage__.isArrayBufferView(r)){var o,s=NV(r,{checkCrc:!0}),l=s.width,h=s.height,p=s.channels,m=s.palette,f=s.depth;o=m&&p===1?function(fe){for(var ge=fe.width,ue=fe.height,se=fe.data,te=fe.palette,Se=fe.depth,Te=!1,Ee=[],je=[],Ne=void 0,ze=!1,Re=0,Ge=0;Ge<te.length;Ge++){var He=RP(te[Ge],4),ye=He[0],Ae=He[1],Le=He[2],Ye=He[3];Ee.push(ye,Ae,Le),Ye!=null&&(Ye===0?(Re++,je.length<1&&je.push(Ge)):Ye<255&&(ze=!0))}if(ze||Re>1){Te=!0,je=void 0;var qe=ge*ue;Ne=new Uint8Array(qe);for(var et=new DataView(se.buffer),ft=0;ft<qe;ft++){var mt=ML(et,ft,Se),At=RP(te[mt],4)[3];Ne[ft]=At}}else Re===0&&(je=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:Te?8:void 0,colorBytes:se,alphaBytes:Ne,needSMask:Te,palette:Ee,mask:je}}(s):p===2||p===4?function(fe){for(var ge=fe.data,ue=fe.width,se=fe.height,te=fe.channels,Se=fe.depth,Te=te===2?"DeviceGray":"DeviceRGB",Ee=te-1,je=ue*se,Ne=Ee,ze=je*Ne,Re=1*je,Ge=Math.ceil(ze*Se/8),He=Math.ceil(Re*Se/8),ye=new Uint8Array(Ge),Ae=new Uint8Array(He),Le=new DataView(ge.buffer),Ye=new DataView(ye.buffer),qe=new DataView(Ae.buffer),et=!1,ft=0;ft<je;ft++){for(var mt=ft*te,At=0;At<Ne;At++)nU(Ye,ML(Le,mt+At,Se),ft*Ne+At,Se);var ht=ML(Le,mt+Ne,Se);ht<(1<<Se)-1&&(et=!0),nU(qe,ht,1*ft,Se)}return{colorSpace:Te,colorsPerPixel:Ee,sMaskBitsPerComponent:et?Se:void 0,colorBytes:ye,alphaBytes:Ae,needSMask:et}}(s):function(fe){var ge=fe.data,ue=fe.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:ue,colorsPerPixel:ue==="DeviceGray"?1:3,colorBytes:ge instanceof Uint16Array?function(se){for(var te=se.length,Se=new Uint8Array(2*te),Te=new DataView(Se.buffer,Se.byteOffset,Se.byteLength),Ee=0;Ee<te;Ee++)Te.setUint16(2*Ee,se[Ee],!1);return Se}(ge):ge,needSMask:!1}}(s);var g,y,_,w=o,A=w.colorSpace,k=w.colorsPerPixel,R=w.sMaskBitsPerComponent,q=w.colorBytes,X=w.alphaBytes,ie=w.needSMask,ae=w.palette,be=w.mask,me=null;return n!==Ui.API.image_compression.NONE&&typeof fM=="function"?(me=function(fe){var ge;switch(fe){case Ui.API.image_compression.FAST:ge=11;break;case Ui.API.image_compression.MEDIUM:ge=13;break;case Ui.API.image_compression.SLOW:ge=14;break;default:ge=12}return ge}(n),g=this.decode.FLATE_DECODE,y="/Predictor ".concat(me," /Colors ").concat(k," /BitsPerComponent ").concat(f," /Columns ").concat(l),r=JV(q,Math.ceil(l*k*f/8),k,f,n),ie&&(_=JV(X,Math.ceil(l*R/8),1,R,n))):(g=void 0,y=void 0,r=q,ie&&(_=X)),(this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r))&&(r=this.__addimage__.arrayBufferToBinaryString(r)),(_&&this.__addimage__.isArrayBuffer(_)||this.__addimage__.isArrayBufferView(_))&&(_=this.__addimage__.arrayBufferToBinaryString(_)),{alias:e,data:r,index:i,filter:g,decodeParameters:y,transparency:be,palette:ae,sMask:_,predictor:me,width:l,height:h,bitsPerComponent:f,sMaskBitsPerComponent:R,colorSpace:A}}},function(r){r.processGIF89A=function(i,e,n,o){var s=new zae(i),l=s.width,h=s.height,p=[];s.decodeAndBlitFrameRGBA(0,p);var m={data:p,width:l,height:h},f=new IL(100).encode(m,100);return r.processJPEG.call(this,f,e,n,o)},r.processGIF87A=r.processGIF89A}(Ui.API),wp.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var i=0;i<r;i++){var e=this.datav.getUint8(this.pos++,!0),n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0);this.palette[i]={red:o,green:n,blue:e,quad:s}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},wp.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,i=this.width*this.height*4;this.data=new Uint8Array(i),this[r]()}catch(e){Xo.log("bit decode error:"+e)}},wp.prototype.bit1=function(){var r,i=Math.ceil(this.width/8),e=i%4;for(r=this.height-1;r>=0;r--){for(var n=this.bottom_up?r:this.height-1-r,o=0;o<i;o++)for(var s=this.datav.getUint8(this.pos++,!0),l=n*this.width*4+8*o*4,h=0;h<8&&8*o+h<this.width;h++){var p=this.palette[s>>7-h&1];this.data[l+4*h]=p.blue,this.data[l+4*h+1]=p.green,this.data[l+4*h+2]=p.red,this.data[l+4*h+3]=255}e!==0&&(this.pos+=4-e)}},wp.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),i=r%4,e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,o=0;o<r;o++){var s=this.datav.getUint8(this.pos++,!0),l=n*this.width*4+2*o*4,h=s>>4,p=15&s,m=this.palette[h];if(this.data[l]=m.blue,this.data[l+1]=m.green,this.data[l+2]=m.red,this.data[l+3]=255,2*o+1>=this.width)break;m=this.palette[p],this.data[l+4]=m.blue,this.data[l+4+1]=m.green,this.data[l+4+2]=m.red,this.data[l+4+3]=255}i!==0&&(this.pos+=4-i)}},wp.prototype.bit8=function(){for(var r=this.width%4,i=this.height-1;i>=0;i--){for(var e=this.bottom_up?i:this.height-1-i,n=0;n<this.width;n++){var o=this.datav.getUint8(this.pos++,!0),s=e*this.width*4+4*n;if(o<this.palette.length){var l=this.palette[o];this.data[s]=l.red,this.data[s+1]=l.green,this.data[s+2]=l.blue,this.data[s+3]=255}else this.data[s]=255,this.data[s+1]=255,this.data[s+2]=255,this.data[s+3]=255}r!==0&&(this.pos+=4-r)}},wp.prototype.bit15=function(){for(var r=this.width%3,i=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var n=this.bottom_up?e:this.height-1-e,o=0;o<this.width;o++){var s=this.datav.getUint16(this.pos,!0);this.pos+=2;var l=(s&i)/i*255|0,h=(s>>5&i)/i*255|0,p=(s>>10&i)/i*255|0,m=s>>15?255:0,f=n*this.width*4+4*o;this.data[f]=p,this.data[f+1]=h,this.data[f+2]=l,this.data[f+3]=m}this.pos+=r}},wp.prototype.bit16=function(){for(var r=this.width%3,i=parseInt("11111",2),e=parseInt("111111",2),n=this.height-1;n>=0;n--){for(var o=this.bottom_up?n:this.height-1-n,s=0;s<this.width;s++){var l=this.datav.getUint16(this.pos,!0);this.pos+=2;var h=(l&i)/i*255|0,p=(l>>5&e)/e*255|0,m=(l>>11)/i*255|0,f=o*this.width*4+4*s;this.data[f]=m,this.data[f+1]=p,this.data[f+2]=h,this.data[f+3]=255}this.pos+=r}},wp.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var i=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=i*this.width*4+4*e;this.data[l]=s,this.data[l+1]=o,this.data[l+2]=n,this.data[l+3]=255}this.pos+=this.width%4}},wp.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var i=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var n=this.datav.getUint8(this.pos++,!0),o=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),l=this.datav.getUint8(this.pos++,!0),h=i*this.width*4+4*e;this.data[h]=s,this.data[h+1]=o,this.data[h+2]=n,this.data[h+3]=l}},wp.prototype.getData=function(){return this.data},function(r){r.processBMP=function(i,e,n,o){var s=new wp(i,!1),l=s.width,h=s.height,p={data:s.getData(),width:l,height:h},m=new IL(100).encode(p,100);return r.processJPEG.call(this,m,e,n,o)}}(Ui.API),aU.prototype.getData=function(){return this.data},function(r){r.processWEBP=function(i,e,n,o){var s=new aU(i),l=s.width,h=s.height,p={data:s.getData(),width:l,height:h},m=new IL(100).encode(p,100);return r.processJPEG.call(this,m,e,n,o)}}(Ui.API),Ui.API.processRGBA=function(r,i,e){for(var n=r.data,o=n.length,s=new Uint8Array(o/4*3),l=new Uint8Array(o/4),h=0,p=0,m=0;m<o;m+=4){var f=n[m],g=n[m+1],y=n[m+2],_=n[m+3];s[h++]=f,s[h++]=g,s[h++]=y,l[p++]=_}var w=this.__addimage__.arrayBufferToBinaryString(s);return{alpha:this.__addimage__.arrayBufferToBinaryString(l),data:w,index:i,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},Ui.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},lv=Ui.API,jM=lv.getCharWidthsArray=function(r,i){var e,n,o=(i=i||{}).font||this.internal.getFont(),s=i.fontSize||this.internal.getFontSize(),l=i.charSpace||this.internal.getCharSpace(),h=i.widths?i.widths:o.metadata.Unicode.widths,p=h.fof?h.fof:1,m=i.kerning?i.kerning:o.metadata.Unicode.kerning,f=m.fof?m.fof:1,g=i.doKerning!==!1,y=0,_=r.length,w=0,A=h[0]||p,k=[];for(e=0;e<_;e++)n=r.charCodeAt(e),typeof o.metadata.widthOfString=="function"?k.push((o.metadata.widthOfGlyph(o.metadata.characterToGlyph(n))+l*(1e3/s)||0)/1e3):(y=g&&Eo(m[n])==="object"&&!isNaN(parseInt(m[n][w],10))?m[n][w]/f:0,k.push((h[n]||A)/p+y)),w=n;return k},XV=lv.getStringUnitWidth=function(r,i){var e=(i=i||{}).fontSize||this.internal.getFontSize(),n=i.font||this.internal.getFont(),o=i.charSpace||this.internal.getCharSpace();return lv.processArabic&&(r=lv.processArabic(r)),typeof n.metadata.widthOfString=="function"?n.metadata.widthOfString(r,e,o)/e:jM.apply(this,arguments).reduce(function(s,l){return s+l},0)},KV=function(r,i,e,n){for(var o=[],s=0,l=r.length,h=0;s!==l&&h+i[s]<e;)h+=i[s],s++;o.push(r.slice(0,s));var p=s;for(h=0;s!==l;)h+i[s]>n&&(o.push(r.slice(p,s)),h=0,p=s),h+=i[s],s++;return p!==s&&o.push(r.slice(p,s)),o},QV=function(r,i,e){e||(e={});var n,o,s,l,h,p,m,f=[],g=[f],y=e.textIndent||0,_=0,w=0,A=r.split(" "),k=jM.apply(this,[" ",e])[0];if(p=e.lineIndent===-1?A[0].length+2:e.lineIndent||0){var R=Array(p).join(" "),q=[];A.map(function(ie){(ie=ie.split(/\s*\n/)).length>1?q=q.concat(ie.map(function(ae,be){return(be&&ae.length?`
`:"")+ae})):q.push(ie[0])}),A=q,p=XV.apply(this,[R,e])}for(s=0,l=A.length;s<l;s++){var X=0;if(n=A[s],p&&n[0]==`
`&&(n=n.substr(1),X=1),y+_+(w=(o=jM.apply(this,[n,e])).reduce(function(ie,ae){return ie+ae},0))>i||X){if(w>i){for(h=KV.apply(this,[n,o,i-(y+_),i]),f.push(h.shift()),f=[h.pop()];h.length;)g.push([h.shift()]);w=o.slice(n.length-(f[0]?f[0].length:0)).reduce(function(ie,ae){return ie+ae},0)}else f=[n];g.push(f),y=w+p,_=k}else f.push(n),y+=_+w,_=k}return m=p?function(ie,ae){return(ae?R:"")+ie.join(" ")}:function(ie){return ie.join(" ")},g.map(m)},lv.splitTextToSize=function(r,i,e){var n,o=(e=e||{}).fontSize||this.internal.getFontSize(),s=function(f){if(f.widths&&f.kerning)return{widths:f.widths,kerning:f.kerning};var g=this.internal.getFont(f.fontName,f.fontStyle),y="Unicode";return g.metadata[y]?{widths:g.metadata[y].widths||{0:1},kerning:g.metadata[y].kerning||{}}:{font:g.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}.call(this,e);n=Array.isArray(r)?r:String(r).split(/\r?\n/);var l=1*this.internal.scaleFactor*i/o;s.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/o:0,s.lineIndent=e.lineIndent;var h,p,m=[];for(h=0,p=n.length;h<p;h++)m=m.concat(QV.apply(this,[n[h],l,s]));return m},function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var i="0123456789abcdef",e="klmnopqrstuvwxyz",n={},o={},s=0;s<16;s++)n[e[s]]=i[s],o[i[s]]=e[s];var l=function(y){return"0x"+parseInt(y,10).toString(16)},h=r.__fontmetrics__.compress=function(y){var _,w,A,k,R=["{"];for(var q in y){if(_=y[q],isNaN(parseInt(q,10))?w="'"+q+"'":(q=parseInt(q,10),w=(w=l(q).slice(2)).slice(0,-1)+o[w.slice(-1)]),typeof _=="number")_<0?(A=l(_).slice(3),k="-"):(A=l(_).slice(2),k=""),A=k+A.slice(0,-1)+o[A.slice(-1)];else{if(Eo(_)!=="object")throw new Error("Don't know what to do with value type "+Eo(_)+".");A=h(_)}R.push(w+A)}return R.push("}"),R.join("")},p=r.__fontmetrics__.uncompress=function(y){if(typeof y!="string")throw new Error("Invalid argument passed to uncompress.");for(var _,w,A,k,R={},q=1,X=R,ie=[],ae="",be="",me=y.length-1,fe=1;fe<me;fe+=1)(k=y[fe])=="'"?_?(A=_.join(""),_=void 0):_=[]:_?_.push(k):k=="{"?(ie.push([X,A]),X={},A=void 0):k=="}"?((w=ie.pop())[0][w[1]]=X,A=void 0,X=w[0]):k=="-"?q=-1:A===void 0?n.hasOwnProperty(k)?(ae+=n[k],A=parseInt(ae,16)*q,q=1,ae=""):ae+=k:n.hasOwnProperty(k)?(be+=n[k],X[A]=parseInt(be,16)*q,q=1,A=void 0,be=""):be+=k;return R},m={codePages:["WinAnsiEncoding"],WinAnsiEncoding:p("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},f={Unicode:{Courier:m,"Courier-Bold":m,"Courier-BoldOblique":m,"Courier-Oblique":m,Helvetica:m,"Helvetica-Bold":m,"Helvetica-BoldOblique":m,"Helvetica-Oblique":m,"Times-Roman":m,"Times-Bold":m,"Times-BoldItalic":m,"Times-Italic":m}},g={Unicode:{"Courier-Oblique":p("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":p("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":p("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:p("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":p("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":p("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:p("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:p("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":p("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:p("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":p("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":p("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":p("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":p("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(y){var _=y.font,w=g.Unicode[_.postScriptName];w&&(_.metadata.Unicode={},_.metadata.Unicode.widths=w.widths,_.metadata.Unicode.kerning=w.kerning);var A=f.Unicode[_.postScriptName];A&&(_.metadata.Unicode.encoding=A,_.encoding=A.codePages[0])}])}(Ui.API),function(r){var i=function(e){for(var n=e.length,o=new Uint8Array(n),s=0;s<n;s++)o[s]=e.charCodeAt(s);return o};r.API.events.push(["addFont",function(e){var n=void 0,o=e.font,s=e.instance;if(!o.isStandardFont){if(s===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+o.postScriptName+"').");if(typeof(n=s.existsFileInVFS(o.postScriptName)===!1?s.loadFile(o.postScriptName):s.getFileFromVFS(o.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+o.postScriptName+"').");(function(l,h){h=/^\x00\x01\x00\x00/.test(h)?i(h):i(VM(h)),l.metadata=r.API.TTFFont.open(h),l.metadata.Unicode=l.metadata.Unicode||{encoding:{},kerning:{},widths:[]},l.metadata.glyIdsUsed=[0]})(o,n)}}])}(Ui),Ui.API.addSvgAsImage=function(r,i,e,n,o,s,l,h){if(isNaN(i)||isNaN(e))throw Xo.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(n)||isNaN(o))throw Xo.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var p=document.createElement("canvas");p.width=n,p.height=o;var m=p.getContext("2d");m.fillStyle="#fff",m.fillRect(0,0,p.width,p.height);var f={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},g=this;return(Wr.canvg?Promise.resolve(Wr.canvg):import("./chunk-V6JCBI22.js")).catch(function(y){return Promise.reject(new Error("Could not load canvg: "+y))}).then(function(y){return y.default?y.default:y}).then(function(y){return y.fromString(m,r,f)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(y){return y.render(f)}).then(function(){g.addImage(p.toDataURL("image/jpeg",1),i,e,n,o,l,h)})},Ui.API.putTotalPages=function(r){var i,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(i=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(i=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var n=1;n<=this.internal.getNumberOfPages();n++)for(var o=0;o<this.internal.pages[n].length;o++)this.internal.pages[n][o]=this.internal.pages[n][o].replace(i,e);return this},Ui.API.viewerPreferences=function(r,i){var e;r=r||{},i=i||!1;var n,o,s,l={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},h=Object.keys(l),p=[],m=0,f=0,g=0;function y(w,A){var k,R=!1;for(k=0;k<w.length;k+=1)w[k]===A&&(R=!0);return R}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(l)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||i===!0){var _=h.length;for(g=0;g<_;g+=1)e[h[g]].value=e[h[g]].defaultValue,e[h[g]].explicitSet=!1}if(Eo(r)==="object"){for(o in r)if(s=r[o],y(h,o)&&s!==void 0){if(e[o].type==="boolean"&&typeof s=="boolean")e[o].value=s;else if(e[o].type==="name"&&y(e[o].valueSet,s))e[o].value=s;else if(e[o].type==="integer"&&Number.isInteger(s))e[o].value=s;else if(e[o].type==="array"){for(m=0;m<s.length;m+=1)if(n=!0,s[m].length===1&&typeof s[m][0]=="number")p.push(String(s[m]-1));else if(s[m].length>1){for(f=0;f<s[m].length;f+=1)typeof s[m][f]!="number"&&(n=!1);n===!0&&p.push([s[m][0]-1,s[m][1]-1].join(" "))}e[o].value="["+p.join(" ")+"]"}else e[o].value=e[o].defaultValue;e[o].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var w,A=[];for(w in e)e[w].explicitSet===!0&&(e[w].type==="name"?A.push("/"+w+" /"+e[w].value):A.push("/"+w+" "+e[w].value));A.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+A.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},function(r){var i=function(){var n='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',o=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),s=unescape(encodeURIComponent(n)),l=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),h=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),p=unescape(encodeURIComponent("</x:xmpmeta>")),m=s.length+l.length+h.length+o.length+p.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+m+" >>"),this.internal.write("stream"),this.internal.write(o+s+l+h+p),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(n,o){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:n,namespaceuri:o||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",i)),this}}(Ui.API),function(r){var i=r.API,e=i.pdfEscape16=function(s,l){for(var h,p=l.metadata.Unicode.widths,m=["","0","00","000","0000"],f=[""],g=0,y=s.length;g<y;++g){if(h=l.metadata.characterToGlyph(s.charCodeAt(g)),l.metadata.glyIdsUsed.push(h),l.metadata.toUnicode[h]=s.charCodeAt(g),p.indexOf(h)==-1&&(p.push(h),p.push([parseInt(l.metadata.widthOfGlyph(h),10)])),h=="0")return f.join("");h=h.toString(16),f.push(m[4-h.length],h)}return f.join("")},n=function(s){var l,h,p,m,f,g,y;for(f=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,p=[],g=0,y=(h=Object.keys(s).sort(function(_,w){return _-w})).length;g<y;g++)l=h[g],p.length>=100&&(f+=`
`+p.length+` beginbfchar
`+p.join(`
`)+`
endbfchar`,p=[]),s[l]!==void 0&&s[l]!==null&&typeof s[l].toString=="function"&&(m=("0000"+s[l].toString(16)).slice(-4),l=("0000"+(+l).toString(16)).slice(-4),p.push("<"+l+"><"+m+">"));return p.length&&(f+=`
`+p.length+` beginbfchar
`+p.join(`
`)+`
endbfchar
`),f+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};i.events.push(["putFont",function(s){(function(l){var h=l.font,p=l.out,m=l.newObject,f=l.putStream;if(h.metadata instanceof r.API.TTFFont&&h.encoding==="Identity-H"){for(var g=h.metadata.Unicode.widths,y=h.metadata.subset.encode(h.metadata.glyIdsUsed,1),_="",w=0;w<y.length;w++)_+=String.fromCharCode(y[w]);var A=m();f({data:_,addLength1:!0,objectId:A}),p("endobj");var k=m();f({data:n(h.metadata.toUnicode),addLength1:!0,objectId:k}),p("endobj");var R=m();p("<<"),p("/Type /FontDescriptor"),p("/FontName /"+uv(h.fontName)),p("/FontFile2 "+A+" 0 R"),p("/FontBBox "+r.API.PDFObject.convert(h.metadata.bbox)),p("/Flags "+h.metadata.flags),p("/StemV "+h.metadata.stemV),p("/ItalicAngle "+h.metadata.italicAngle),p("/Ascent "+h.metadata.ascender),p("/Descent "+h.metadata.decender),p("/CapHeight "+h.metadata.capHeight),p(">>"),p("endobj");var q=m();p("<<"),p("/Type /Font"),p("/BaseFont /"+uv(h.fontName)),p("/FontDescriptor "+R+" 0 R"),p("/W "+r.API.PDFObject.convert(g)),p("/CIDToGIDMap /Identity"),p("/DW 1000"),p("/Subtype /CIDFontType2"),p("/CIDSystemInfo"),p("<<"),p("/Supplement 0"),p("/Registry (Adobe)"),p("/Ordering ("+h.encoding+")"),p(">>"),p(">>"),p("endobj"),h.objectNumber=m(),p("<<"),p("/Type /Font"),p("/Subtype /Type0"),p("/ToUnicode "+k+" 0 R"),p("/BaseFont /"+uv(h.fontName)),p("/Encoding /"+h.encoding),p("/DescendantFonts ["+q+" 0 R]"),p(">>"),p("endobj"),h.isAlreadyPutted=!0}})(s)}]),i.events.push(["putFont",function(s){(function(l){var h=l.font,p=l.out,m=l.newObject,f=l.putStream;if(h.metadata instanceof r.API.TTFFont&&h.encoding==="WinAnsiEncoding"){for(var g=h.metadata.rawData,y="",_=0;_<g.length;_++)y+=String.fromCharCode(g[_]);var w=m();f({data:y,addLength1:!0,objectId:w}),p("endobj");var A=m();f({data:n(h.metadata.toUnicode),addLength1:!0,objectId:A}),p("endobj");var k=m();p("<<"),p("/Descent "+h.metadata.decender),p("/CapHeight "+h.metadata.capHeight),p("/StemV "+h.metadata.stemV),p("/Type /FontDescriptor"),p("/FontFile2 "+w+" 0 R"),p("/Flags 96"),p("/FontBBox "+r.API.PDFObject.convert(h.metadata.bbox)),p("/FontName /"+uv(h.fontName)),p("/ItalicAngle "+h.metadata.italicAngle),p("/Ascent "+h.metadata.ascender),p(">>"),p("endobj"),h.objectNumber=m();for(var R=0;R<h.metadata.hmtx.widths.length;R++)h.metadata.hmtx.widths[R]=parseInt(h.metadata.hmtx.widths[R]*(1e3/h.metadata.head.unitsPerEm));p("<</Subtype/TrueType/Type/Font/ToUnicode "+A+" 0 R/BaseFont/"+uv(h.fontName)+"/FontDescriptor "+k+" 0 R/Encoding/"+h.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(h.metadata.hmtx.widths)+">>"),p("endobj"),h.isAlreadyPutted=!0}})(s)}]);var o=function(s){var l,h=s.text||"",p=s.x,m=s.y,f=s.options||{},g=s.mutex||{},y=g.pdfEscape,_=g.activeFontKey,w=g.fonts,A=_,k="",R=0,q="",X=w[A].encoding;if(w[A].encoding!=="Identity-H")return{text:h,x:p,y:m,options:f,mutex:g};for(q=h,A=_,Array.isArray(h)&&(q=h[0]),R=0;R<q.length;R+=1)w[A].metadata.hasOwnProperty("cmap")&&(l=w[A].metadata.cmap.unicode.codeMap[q[R].charCodeAt(0)]),l||q[R].charCodeAt(0)<256&&w[A].metadata.hasOwnProperty("Unicode")?k+=q[R]:k+="";var ie="";return parseInt(A.slice(1))<14||X==="WinAnsiEncoding"?ie=y(k,A).split("").map(function(ae){return ae.charCodeAt(0).toString(16)}).join(""):X==="Identity-H"&&(ie=e(k,w[A])),g.isHex=!0,{text:ie,x:p,y:m,options:f,mutex:g}};i.events.push(["postProcessText",function(s){var l=s.text||"",h=[],p={text:l,x:s.x,y:s.y,options:s.options,mutex:s.mutex};if(Array.isArray(l)){var m=0;for(m=0;m<l.length;m+=1)Array.isArray(l[m])&&l[m].length===3?h.push([o(Object.assign({},p,{text:l[m][0]})).text,l[m][1],l[m][2]]):h.push(o(Object.assign({},p,{text:l[m]})).text);s.text=h}else s.text=o(Object.assign({},p,{text:l})).text}])}(Ui),function(r){var i=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return i.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,n){return i.call(this),this.internal.vFS[e]=n,this},r.getFileFromVFS=function(e){return i.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}}(Ui.API),function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(n){var o,s,l,h,p,m,f,g=i,y=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],_=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],w={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},A={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},k=["(",")","(","<",">","<","[","]","[","{","}","{","\xAB","\xBB","\xAB","\u2039","\u203A","\u2039","\u2045","\u2046","\u2045","\u207D","\u207E","\u207D","\u208D","\u208E","\u208D","\u2264","\u2265","\u2264","\u2329","\u232A","\u2329","\uFE59","\uFE5A","\uFE59","\uFE5B","\uFE5C","\uFE5B","\uFE5D","\uFE5E","\uFE5D","\uFE64","\uFE65","\uFE64"],R=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),q=!1,X=0;this.__bidiEngine__={};var ie=function(se){var te=se.charCodeAt(),Se=te>>8,Te=A[Se];return Te!==void 0?g[256*Te+(255&te)]:Se===252||Se===253?"AL":R.test(Se)?"L":Se===8?"R":"N"},ae=function(se){for(var te,Se=0;Se<se.length;Se++){if((te=ie(se.charAt(Se)))==="L")return!1;if(te==="R")return!0}return!1},be=function(se,te,Se,Te){var Ee,je,Ne,ze,Re=te[Te];switch(Re){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":q=!1;break;case"N":case"AN":break;case"EN":q&&(Re="AN");break;case"AL":q=!0,Re="R";break;case"WS":case"BN":Re="N";break;case"CS":Te<1||Te+1>=te.length||(Ee=Se[Te-1])!=="EN"&&Ee!=="AN"||(je=te[Te+1])!=="EN"&&je!=="AN"?Re="N":q&&(je="AN"),Re=je===Ee?je:"N";break;case"ES":Re=(Ee=Te>0?Se[Te-1]:"B")==="EN"&&Te+1<te.length&&te[Te+1]==="EN"?"EN":"N";break;case"ET":if(Te>0&&Se[Te-1]==="EN"){Re="EN";break}if(q){Re="N";break}for(Ne=Te+1,ze=te.length;Ne<ze&&te[Ne]==="ET";)Ne++;Re=Ne<ze&&te[Ne]==="EN"?"EN":"N";break;case"NSM":if(l&&!h){for(ze=te.length,Ne=Te+1;Ne<ze&&te[Ne]==="NSM";)Ne++;if(Ne<ze){var Ge=se[Te],He=Ge>=1425&&Ge<=2303||Ge===64286;if(Ee=te[Ne],He&&(Ee==="R"||Ee==="AL")){Re="R";break}}}Re=Te<1||(Ee=te[Te-1])==="B"?"N":Se[Te-1];break;case"B":q=!1,o=!0,Re=X;break;case"S":s=!0,Re="N"}return Re},me=function(se,te,Se){var Te=se.split("");return Se&&fe(Te,Se,{hiLevel:X}),Te.reverse(),te&&te.reverse(),Te.join("")},fe=function(se,te,Se){var Te,Ee,je,Ne,ze,Re=-1,Ge=se.length,He=0,ye=[],Ae=X?_:y,Le=[];for(q=!1,o=!1,s=!1,Ee=0;Ee<Ge;Ee++)Le[Ee]=ie(se[Ee]);for(je=0;je<Ge;je++){if(ze=He,ye[je]=be(se,Le,ye,je),Te=240&(He=Ae[ze][w[ye[je]]]),He&=15,te[je]=Ne=Ae[He][5],Te>0)if(Te===16){for(Ee=Re;Ee<je;Ee++)te[Ee]=1;Re=-1}else Re=-1;if(Ae[He][6])Re===-1&&(Re=je);else if(Re>-1){for(Ee=Re;Ee<je;Ee++)te[Ee]=Ne;Re=-1}Le[je]==="B"&&(te[je]=0),Se.hiLevel|=Ne}s&&function(Ye,qe,et){for(var ft=0;ft<et;ft++)if(Ye[ft]==="S"){qe[ft]=X;for(var mt=ft-1;mt>=0&&Ye[mt]==="WS";mt--)qe[mt]=X}}(Le,te,Ge)},ge=function(se,te,Se,Te,Ee){if(!(Ee.hiLevel<se)){if(se===1&&X===1&&!o)return te.reverse(),void(Se&&Se.reverse());for(var je,Ne,ze,Re,Ge=te.length,He=0;He<Ge;){if(Te[He]>=se){for(ze=He+1;ze<Ge&&Te[ze]>=se;)ze++;for(Re=He,Ne=ze-1;Re<Ne;Re++,Ne--)je=te[Re],te[Re]=te[Ne],te[Ne]=je,Se&&(je=Se[Re],Se[Re]=Se[Ne],Se[Ne]=je);He=ze}He++}}},ue=function(se,te,Se){var Te=se.split(""),Ee={hiLevel:X};return Se||(Se=[]),fe(Te,Se,Ee),function(je,Ne,ze){if(ze.hiLevel!==0&&f)for(var Re,Ge=0;Ge<je.length;Ge++)Ne[Ge]===1&&(Re=k.indexOf(je[Ge]))>=0&&(je[Ge]=k[Re+1])}(Te,Se,Ee),ge(2,Te,te,Se,Ee),ge(1,Te,te,Se,Ee),Te.join("")};return this.__bidiEngine__.doBidiReorder=function(se,te,Se){if(function(Ee,je){if(je)for(var Ne=0;Ne<Ee.length;Ne++)je[Ne]=Ne;h===void 0&&(h=ae(Ee)),m===void 0&&(m=ae(Ee))}(se,te),l||!p||m)if(l&&p&&h^m)X=h?1:0,se=me(se,te,Se);else if(!l&&p&&m)X=h?1:0,se=ue(se,te,Se),se=me(se,te);else if(!l||h||p||m){if(l&&!p&&h^m)se=me(se,te),h?(X=0,se=ue(se,te,Se)):(X=1,se=ue(se,te,Se),se=me(se,te));else if(l&&h&&!p&&m)X=1,se=ue(se,te,Se),se=me(se,te);else if(!l&&!p&&h^m){var Te=f;h?(X=1,se=ue(se,te,Se),X=0,f=!1,se=ue(se,te,Se),f=Te):(X=0,se=ue(se,te,Se),se=me(se,te),X=1,f=!1,se=ue(se,te,Se),f=Te,se=me(se,te))}}else X=0,se=ue(se,te,Se);else X=h?1:0,se=ue(se,te,Se);return se},this.__bidiEngine__.setOptions=function(se){se&&(l=se.isInputVisual,p=se.isOutputVisual,h=se.isInputRtl,m=se.isOutputRtl,f=se.isSymmetricSwapping)},this.__bidiEngine__.setOptions(n),this.__bidiEngine__};var i=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(n){var o=n.text;n.x,n.y;var s=n.options||{};n.mutex,s.lang;var l=[];if(s.isInputVisual=typeof s.isInputVisual!="boolean"||s.isInputVisual,e.setOptions(s),Object.prototype.toString.call(o)==="[object Array]"){var h=0;for(l=[],h=0;h<o.length;h+=1)Object.prototype.toString.call(o[h])==="[object Array]"?l.push([e.doBidiReorder(o[h][0]),o[h][1],o[h][2]]):l.push([e.doBidiReorder(o[h])]);n.text=l}else n.text=e.doBidiReorder(o);e.setOptions({isInputVisual:!0})}])}(Ui),Ui.API.TTFFont=function(){function r(i){var e;if(this.rawData=i,e=this.contents=new T0(i),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new nse(this),this.registerTTF()}return r.open=function(i){return new r(i)},r.prototype.parse=function(){return this.directory=new $ae(this.contents),this.head=new Hae(this),this.name=new Kae(this),this.cmap=new vU(this),this.toUnicode={},this.hhea=new qae(this),this.maxp=new Qae(this),this.hmtx=new Jae(this),this.post=new Zae(this),this.os2=new Yae(this),this.loca=new rse(this),this.glyf=new ese(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var i,e,n,o,s;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=function(){var l,h,p,m;for(m=[],l=0,h=(p=this.bbox).length;l<h;l++)i=p[l],m.push(Math.round(i*this.scaleFactor));return m}.call(this),this.stemV=0,this.post.exists?(n=255&(o=this.post.italic_angle),32768&(e=o>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+n)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(s=this.familyClass)===1||s===2||s===3||s===4||s===5||s===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(i){var e;return((e=this.cmap.unicode)!=null?e.codeMap[i]:void 0)||0},r.prototype.widthOfGlyph=function(i){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(i).advance*e},r.prototype.widthOfString=function(i,e,n){var o,s,l,h;for(l=0,s=0,h=(i=""+i).length;0<=h?s<h:s>h;s=0<=h?++s:--s)o=i.charCodeAt(s),l+=this.widthOfGlyph(this.characterToGlyph(o))+n*(1e3/e)||0;return l*(e/1e3)},r.prototype.lineHeight=function(i,e){var n;return e==null&&(e=!1),n=e?this.lineGap:0,(this.ascender+n-this.decender)/1e3*i},r}();var Sp,T0=function(){function r(i){this.data=i??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(i){return this.data[this.pos++]=i},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(i){return this.writeByte(i>>>24&255),this.writeByte(i>>16&255),this.writeByte(i>>8&255),this.writeByte(255&i)},r.prototype.readInt32=function(){var i;return(i=this.readUInt32())>=2147483648?i-4294967296:i},r.prototype.writeInt32=function(i){return i<0&&(i+=4294967296),this.writeUInt32(i)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(i){return this.writeByte(i>>8&255),this.writeByte(255&i)},r.prototype.readInt16=function(){var i;return(i=this.readUInt16())>=32768?i-65536:i},r.prototype.writeInt16=function(i){return i<0&&(i+=65536),this.writeUInt16(i)},r.prototype.readString=function(i){var e,n;for(n=[],e=0;0<=i?e<i:e>i;e=0<=i?++e:--e)n[e]=String.fromCharCode(this.readByte());return n.join("")},r.prototype.writeString=function(i){var e,n,o;for(o=[],e=0,n=i.length;0<=n?e<n:e>n;e=0<=n?++e:--e)o.push(this.writeByte(i.charCodeAt(e)));return o},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(i){return this.writeInt16(i)},r.prototype.readLongLong=function(){var i,e,n,o,s,l,h,p;return i=this.readByte(),e=this.readByte(),n=this.readByte(),o=this.readByte(),s=this.readByte(),l=this.readByte(),h=this.readByte(),p=this.readByte(),128&i?-1*(72057594037927940*(255^i)+281474976710656*(255^e)+1099511627776*(255^n)+4294967296*(255^o)+16777216*(255^s)+65536*(255^l)+256*(255^h)+(255^p)+1):72057594037927940*i+281474976710656*e+1099511627776*n+4294967296*o+16777216*s+65536*l+256*h+p},r.prototype.writeLongLong=function(i){var e,n;return e=Math.floor(i/4294967296),n=4294967295&i,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(n>>24&255),this.writeByte(n>>16&255),this.writeByte(n>>8&255),this.writeByte(255&n)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(i){return this.writeInt32(i)},r.prototype.read=function(i){var e,n;for(e=[],n=0;0<=i?n<i:n>i;n=0<=i?++n:--n)e.push(this.readByte());return e},r.prototype.write=function(i){var e,n,o,s;for(s=[],n=0,o=i.length;n<o;n++)e=i[n],s.push(this.writeByte(e));return s},r}(),$ae=function(){var r;function i(e){var n,o,s;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},o=0,s=this.tableCount;0<=s?o<s:o>s;o=0<=s?++o:--o)n={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[n.tag]=n}return i.prototype.encode=function(e){var n,o,s,l,h,p,m,f,g,y,_,w,A;for(A in _=Object.keys(e).length,p=Math.log(2),g=16*Math.floor(Math.log(_)/p),l=Math.floor(g/p),f=16*_-g,(o=new T0).writeInt(this.scalarType),o.writeShort(_),o.writeShort(g),o.writeShort(l),o.writeShort(f),s=16*_,m=o.pos+s,h=null,w=[],e)for(y=e[A],o.writeString(A),o.writeInt(r(y)),o.writeInt(m),o.writeInt(y.length),w=w.concat(y),A==="head"&&(h=m),m+=y.length;m%4;)w.push(0),m++;return o.write(w),n=2981146554-r(o.data),o.pos=h+8,o.writeUInt32(n),o.data},r=function(e){var n,o,s,l;for(e=bU.call(e);e.length%4;)e.push(0);for(s=new T0(e),o=0,n=0,l=e.length;n<l;n=n+=4)o+=s.readUInt32();return 4294967295&o},i}(),Wae={}.hasOwnProperty,Lm=function(r,i){for(var e in i)Wae.call(i,e)&&(r[e]=i[e]);function n(){this.constructor=r}return n.prototype=i.prototype,r.prototype=new n,r.__super__=i.prototype,r};Sp=function(){function r(i){var e;this.file=i,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r}();var Hae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="head",r.prototype.parse=function(i){return i.pos=this.offset,this.version=i.readInt(),this.revision=i.readInt(),this.checkSumAdjustment=i.readInt(),this.magicNumber=i.readInt(),this.flags=i.readShort(),this.unitsPerEm=i.readShort(),this.created=i.readLongLong(),this.modified=i.readLongLong(),this.xMin=i.readShort(),this.yMin=i.readShort(),this.xMax=i.readShort(),this.yMax=i.readShort(),this.macStyle=i.readShort(),this.lowestRecPPEM=i.readShort(),this.fontDirectionHint=i.readShort(),this.indexToLocFormat=i.readShort(),this.glyphDataFormat=i.readShort()},r.prototype.encode=function(i){var e;return(e=new T0).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(i),e.writeShort(this.glyphDataFormat),e.data},r}(),sU=function(){function r(i,e){var n,o,s,l,h,p,m,f,g,y,_,w,A,k,R,q,X;switch(this.platformID=i.readUInt16(),this.encodingID=i.readShort(),this.offset=e+i.readInt(),g=i.pos,i.pos=this.offset,this.format=i.readUInt16(),this.length=i.readUInt16(),this.language=i.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(p=0;p<256;++p)this.codeMap[p]=i.readByte();break;case 4:for(_=i.readUInt16(),y=_/2,i.pos+=6,s=function(){var ie,ae;for(ae=[],p=ie=0;0<=y?ie<y:ie>y;p=0<=y?++ie:--ie)ae.push(i.readUInt16());return ae}(),i.pos+=2,A=function(){var ie,ae;for(ae=[],p=ie=0;0<=y?ie<y:ie>y;p=0<=y?++ie:--ie)ae.push(i.readUInt16());return ae}(),m=function(){var ie,ae;for(ae=[],p=ie=0;0<=y?ie<y:ie>y;p=0<=y?++ie:--ie)ae.push(i.readUInt16());return ae}(),f=function(){var ie,ae;for(ae=[],p=ie=0;0<=y?ie<y:ie>y;p=0<=y?++ie:--ie)ae.push(i.readUInt16());return ae}(),o=(this.length-i.pos+this.offset)/2,h=function(){var ie,ae;for(ae=[],p=ie=0;0<=o?ie<o:ie>o;p=0<=o?++ie:--ie)ae.push(i.readUInt16());return ae}(),p=R=0,X=s.length;R<X;p=++R)for(k=s[p],n=q=w=A[p];w<=k?q<=k:q>=k;n=w<=k?++q:--q)f[p]===0?l=n+m[p]:(l=h[f[p]/2+(n-w)-(y-p)]||0)!==0&&(l+=m[p]),this.codeMap[n]=65535&l}i.pos=g}return r.encode=function(i,e){var n,o,s,l,h,p,m,f,g,y,_,w,A,k,R,q,X,ie,ae,be,me,fe,ge,ue,se,te,Se,Te,Ee,je,Ne,ze,Re,Ge,He,ye,Ae,Le,Ye,qe,et,ft,mt,At,ht,he;switch(Te=new T0,l=Object.keys(i).sort(function(st,Je){return st-Je}),e){case"macroman":for(A=0,k=function(){var st=[];for(w=0;w<256;++w)st.push(0);return st}(),q={0:0},s={},Ee=0,Re=l.length;Ee<Re;Ee++)q[mt=i[o=l[Ee]]]==null&&(q[mt]=++A),s[o]={old:i[o],new:q[i[o]]},k[o]=q[i[o]];return Te.writeUInt16(1),Te.writeUInt16(0),Te.writeUInt32(12),Te.writeUInt16(0),Te.writeUInt16(262),Te.writeUInt16(0),Te.write(k),{charMap:s,subtable:Te.data,maxGlyphID:A+1};case"unicode":for(te=[],g=[],X=0,q={},n={},R=m=null,je=0,Ge=l.length;je<Ge;je++)q[ae=i[o=l[je]]]==null&&(q[ae]=++X),n[o]={old:ae,new:q[ae]},h=q[ae]-o,R!=null&&h===m||(R&&g.push(R),te.push(o),m=h),R=o;for(R&&g.push(R),g.push(65535),te.push(65535),ue=2*(ge=te.length),fe=2*Math.pow(Math.log(ge)/Math.LN2,2),y=Math.log(fe/2)/Math.LN2,me=2*ge-fe,p=[],be=[],_=[],w=Ne=0,He=te.length;Ne<He;w=++Ne){if(se=te[w],f=g[w],se===65535){p.push(0),be.push(0);break}if(se-(Se=n[se].new)>=32768)for(p.push(0),be.push(2*(_.length+ge-w)),o=ze=se;se<=f?ze<=f:ze>=f;o=se<=f?++ze:--ze)_.push(n[o].new);else p.push(Se-se),be.push(0)}for(Te.writeUInt16(3),Te.writeUInt16(1),Te.writeUInt32(12),Te.writeUInt16(4),Te.writeUInt16(16+8*ge+2*_.length),Te.writeUInt16(0),Te.writeUInt16(ue),Te.writeUInt16(fe),Te.writeUInt16(y),Te.writeUInt16(me),et=0,ye=g.length;et<ye;et++)o=g[et],Te.writeUInt16(o);for(Te.writeUInt16(0),ft=0,Ae=te.length;ft<Ae;ft++)o=te[ft],Te.writeUInt16(o);for(At=0,Le=p.length;At<Le;At++)h=p[At],Te.writeUInt16(h);for(ht=0,Ye=be.length;ht<Ye;ht++)ie=be[ht],Te.writeUInt16(ie);for(he=0,qe=_.length;he<qe;he++)A=_[he],Te.writeUInt16(A);return{charMap:n,subtable:Te.data,maxGlyphID:X+1}}},r}(),vU=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="cmap",r.prototype.parse=function(i){var e,n,o;for(i.pos=this.offset,this.version=i.readUInt16(),o=i.readUInt16(),this.tables=[],this.unicode=null,n=0;0<=o?n<o:n>o;n=0<=o?++n:--n)e=new sU(i,this.offset),this.tables.push(e),e.isUnicode&&this.unicode==null&&(this.unicode=e);return!0},r.encode=function(i,e){var n,o;return e==null&&(e="macroman"),n=sU.encode(i,e),(o=new T0).writeUInt16(0),o.writeUInt16(1),n.table=o.data.concat(n.subtable),n},r}(),qae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="hhea",r.prototype.parse=function(i){return i.pos=this.offset,this.version=i.readInt(),this.ascender=i.readShort(),this.decender=i.readShort(),this.lineGap=i.readShort(),this.advanceWidthMax=i.readShort(),this.minLeftSideBearing=i.readShort(),this.minRightSideBearing=i.readShort(),this.xMaxExtent=i.readShort(),this.caretSlopeRise=i.readShort(),this.caretSlopeRun=i.readShort(),this.caretOffset=i.readShort(),i.pos+=8,this.metricDataFormat=i.readShort(),this.numberOfMetrics=i.readUInt16()},r}(),Yae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="OS/2",r.prototype.parse=function(i){if(i.pos=this.offset,this.version=i.readUInt16(),this.averageCharWidth=i.readShort(),this.weightClass=i.readUInt16(),this.widthClass=i.readUInt16(),this.type=i.readShort(),this.ySubscriptXSize=i.readShort(),this.ySubscriptYSize=i.readShort(),this.ySubscriptXOffset=i.readShort(),this.ySubscriptYOffset=i.readShort(),this.ySuperscriptXSize=i.readShort(),this.ySuperscriptYSize=i.readShort(),this.ySuperscriptXOffset=i.readShort(),this.ySuperscriptYOffset=i.readShort(),this.yStrikeoutSize=i.readShort(),this.yStrikeoutPosition=i.readShort(),this.familyClass=i.readShort(),this.panose=function(){var e,n;for(n=[],e=0;e<10;++e)n.push(i.readByte());return n}(),this.charRange=function(){var e,n;for(n=[],e=0;e<4;++e)n.push(i.readInt());return n}(),this.vendorID=i.readString(4),this.selection=i.readShort(),this.firstCharIndex=i.readShort(),this.lastCharIndex=i.readShort(),this.version>0&&(this.ascent=i.readShort(),this.descent=i.readShort(),this.lineGap=i.readShort(),this.winAscent=i.readShort(),this.winDescent=i.readShort(),this.codePageRange=function(){var e,n;for(n=[],e=0;e<2;e=++e)n.push(i.readInt());return n}(),this.version>1))return this.xHeight=i.readShort(),this.capHeight=i.readShort(),this.defaultChar=i.readShort(),this.breakChar=i.readShort(),this.maxContext=i.readShort()},r}(),Zae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="post",r.prototype.parse=function(i){var e,n,o;switch(i.pos=this.offset,this.format=i.readInt(),this.italicAngle=i.readInt(),this.underlinePosition=i.readShort(),this.underlineThickness=i.readShort(),this.isFixedPitch=i.readInt(),this.minMemType42=i.readInt(),this.maxMemType42=i.readInt(),this.minMemType1=i.readInt(),this.maxMemType1=i.readInt(),this.format){case 65536:case 196608:break;case 131072:var s;for(n=i.readUInt16(),this.glyphNameIndex=[],s=0;0<=n?s<n:s>n;s=0<=n?++s:--s)this.glyphNameIndex.push(i.readUInt16());for(this.names=[],o=[];i.pos<this.offset+this.length;)e=i.readByte(),o.push(this.names.push(i.readString(e)));return o;case 151552:return n=i.readUInt16(),this.offsets=i.read(n);case 262144:return this.map=function(){var l,h,p;for(p=[],s=l=0,h=this.file.maxp.numGlyphs;0<=h?l<h:l>h;s=0<=h?++l:--l)p.push(i.readUInt32());return p}.call(this)}},r}(),Xae=function(r,i){this.raw=r,this.length=r.length,this.platformID=i.platformID,this.encodingID=i.encodingID,this.languageID=i.languageID},Kae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="name",r.prototype.parse=function(i){var e,n,o,s,l,h,p,m,f,g,y;for(i.pos=this.offset,i.readShort(),e=i.readShort(),h=i.readShort(),n=[],s=0;0<=e?s<e:s>e;s=0<=e?++s:--s)n.push({platformID:i.readShort(),encodingID:i.readShort(),languageID:i.readShort(),nameID:i.readShort(),length:i.readShort(),offset:this.offset+h+i.readShort()});for(p={},s=f=0,g=n.length;f<g;s=++f)o=n[s],i.pos=o.offset,m=i.readString(o.length),l=new Xae(m,o),p[y=o.nameID]==null&&(p[y]=[]),p[o.nameID].push(l);this.strings=p,this.copyright=p[0],this.fontFamily=p[1],this.fontSubfamily=p[2],this.uniqueSubfamily=p[3],this.fontName=p[4],this.version=p[5];try{this.postscriptName=p[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=p[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=p[7],this.manufacturer=p[8],this.designer=p[9],this.description=p[10],this.vendorUrl=p[11],this.designerUrl=p[12],this.license=p[13],this.licenseUrl=p[14],this.preferredFamily=p[15],this.preferredSubfamily=p[17],this.compatibleFull=p[18],this.sampleText=p[19]},r}(),Qae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="maxp",r.prototype.parse=function(i){return i.pos=this.offset,this.version=i.readInt(),this.numGlyphs=i.readUInt16(),this.maxPoints=i.readUInt16(),this.maxContours=i.readUInt16(),this.maxCompositePoints=i.readUInt16(),this.maxComponentContours=i.readUInt16(),this.maxZones=i.readUInt16(),this.maxTwilightPoints=i.readUInt16(),this.maxStorage=i.readUInt16(),this.maxFunctionDefs=i.readUInt16(),this.maxInstructionDefs=i.readUInt16(),this.maxStackElements=i.readUInt16(),this.maxSizeOfInstructions=i.readUInt16(),this.maxComponentElements=i.readUInt16(),this.maxComponentDepth=i.readUInt16()},r}(),Jae=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="hmtx",r.prototype.parse=function(i){var e,n,o,s,l,h,p;for(i.pos=this.offset,this.metrics=[],e=0,h=this.file.hhea.numberOfMetrics;0<=h?e<h:e>h;e=0<=h?++e:--e)this.metrics.push({advance:i.readUInt16(),lsb:i.readInt16()});for(o=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=function(){var m,f;for(f=[],e=m=0;0<=o?m<o:m>o;e=0<=o?++m:--m)f.push(i.readInt16());return f}(),this.widths=function(){var m,f,g,y;for(y=[],m=0,f=(g=this.metrics).length;m<f;m++)s=g[m],y.push(s.advance);return y}.call(this),n=this.widths[this.widths.length-1],p=[],e=l=0;0<=o?l<o:l>o;e=0<=o?++l:--l)p.push(this.widths.push(n));return p},r.prototype.forGlyph=function(i){return i in this.metrics?this.metrics[i]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[i-this.metrics.length]}},r}(),bU=[].slice,ese=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="glyf",r.prototype.parse=function(){return this.cache={}},r.prototype.glyphFor=function(i){var e,n,o,s,l,h,p,m,f,g;return i in this.cache?this.cache[i]:(s=this.file.loca,e=this.file.contents,n=s.indexOf(i),(o=s.lengthOf(i))===0?this.cache[i]=null:(e.pos=this.offset+n,l=(h=new T0(e.read(o))).readShort(),m=h.readShort(),g=h.readShort(),p=h.readShort(),f=h.readShort(),this.cache[i]=l===-1?new ise(h,m,g,p,f):new tse(h,l,m,g,p,f),this.cache[i]))},r.prototype.encode=function(i,e,n){var o,s,l,h,p;for(l=[],s=[],h=0,p=e.length;h<p;h++)o=i[e[h]],s.push(l.length),o&&(l=l.concat(o.encode(n)));return s.push(l.length),{table:l,offsets:s}},r}(),tse=function(){function r(i,e,n,o,s,l){this.raw=i,this.numberOfContours=e,this.xMin=n,this.yMin=o,this.xMax=s,this.yMax=l,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r}(),ise=function(){function r(i,e,n,o,s){var l,h;for(this.raw=i,this.xMin=e,this.yMin=n,this.xMax=o,this.yMax=s,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],l=this.raw;h=l.readShort(),this.glyphOffsets.push(l.pos),this.glyphIDs.push(l.readUInt16()),32&h;)l.pos+=1&h?4:2,128&h?l.pos+=8:64&h?l.pos+=4:8&h&&(l.pos+=2)}return r.prototype.encode=function(){var i,e,n;for(e=new T0(bU.call(this.raw.data)),i=0,n=this.glyphIDs.length;i<n;++i)e.pos=this.glyphOffsets[i];return e.data},r}(),rse=function(){function r(){return r.__super__.constructor.apply(this,arguments)}return Lm(r,Sp),r.prototype.tag="loca",r.prototype.parse=function(i){var e,n;return i.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=e===0?function(){var o,s;for(s=[],n=0,o=this.length;n<o;n+=2)s.push(2*i.readUInt16());return s}.call(this):function(){var o,s;for(s=[],n=0,o=this.length;n<o;n+=4)s.push(i.readUInt32());return s}.call(this)},r.prototype.indexOf=function(i){return this.offsets[i]},r.prototype.lengthOf=function(i){return this.offsets[i+1]-this.offsets[i]},r.prototype.encode=function(i,e){for(var n=new Uint32Array(this.offsets.length),o=0,s=0,l=0;l<n.length;++l)if(n[l]=o,s<e.length&&e[s]==l){++s,n[l]=o;var h=this.offsets[l],p=this.offsets[l+1]-h;p>0&&(o+=p)}for(var m=new Array(4*n.length),f=0;f<n.length;++f)m[4*f+3]=255&n[f],m[4*f+2]=(65280&n[f])>>8,m[4*f+1]=(16711680&n[f])>>16,m[4*f]=(4278190080&n[f])>>24;return m},r}(),nse=function(){function r(i){this.font=i,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var i,e,n,o,s;for(e in o=this.font.cmap.tables[0].codeMap,i={},s=this.subset)n=s[e],i[e]=o[n];return i},r.prototype.glyphsFor=function(i){var e,n,o,s,l,h,p;for(o={},l=0,h=i.length;l<h;l++)o[s=i[l]]=this.font.glyf.glyphFor(s);for(s in e=[],o)(n=o[s])!=null&&n.compound&&e.push.apply(e,n.glyphIDs);if(e.length>0)for(s in p=this.glyphsFor(e))n=p[s],o[s]=n;return o},r.prototype.encode=function(i,e){var n,o,s,l,h,p,m,f,g,y,_,w,A,k,R;for(o in n=vU.encode(this.generateCmap(),"unicode"),l=this.glyphsFor(i),_={0:0},R=n.charMap)_[(p=R[o]).old]=p.new;for(w in y=n.maxGlyphID,l)w in _||(_[w]=y++);return f=function(q){var X,ie;for(X in ie={},q)ie[q[X]]=X;return ie}(_),g=Object.keys(f).sort(function(q,X){return q-X}),A=function(){var q,X,ie;for(ie=[],q=0,X=g.length;q<X;q++)h=g[q],ie.push(f[h]);return ie}(),s=this.font.glyf.encode(l,A,_),m=this.font.loca.encode(s.offsets,A),k={cmap:this.font.cmap.raw(),glyf:s.table,loca:m,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(k["OS/2"]=this.font.os2.raw()),this.font.directory.encode(k)},r}();Ui.API.PDFObject=function(){var r;function i(){}return r=function(e,n){return(Array(n+1).join("0")+e).slice(-n)},i.convert=function(e){var n,o,s,l;if(Array.isArray(e))return"["+function(){var h,p,m;for(m=[],h=0,p=e.length;h<p;h++)n=e[h],m.push(i.convert(n));return m}().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e?.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(o in s=["<<"],e)l=e[o],s.push("/"+o+" "+i.convert(l));return s.push(">>"),s.join(`
`)}return""+e},i}();function MU(r,i,e,n,o){n=n||{};var s=1.15,l=o.internal.scaleFactor,h=o.internal.getFontSize()/l,p=o.getLineHeightFactor?o.getLineHeightFactor():s,m=h*p,f=/\r\n|\r|\n/g,g="",y=1;if((n.valign==="middle"||n.valign==="bottom"||n.halign==="center"||n.halign==="right")&&(g=typeof r=="string"?r.split(f):r,y=g.length||1),e+=h*(2-s),n.valign==="middle"?e-=y/2*m:n.valign==="bottom"&&(e-=y*m),n.halign==="center"||n.halign==="right"){var _=h;if(n.halign==="center"&&(_*=.5),g&&y>=1){for(var w=0;w<g.length;w++)o.text(g[w],i-o.getStringUnitWidth(g[w])*_,e),e+=m;return o}i-=o.getStringUnitWidth(r)*_}return n.halign==="justify"?o.text(r,i,e,{maxWidth:n.maxWidth||100,align:"justify"}):o.text(r,i,e),o}var wU={},gv=function(){function r(i){this.jsPDFDocument=i,this.userStyles={textColor:i.getTextColor?this.jsPDFDocument.getTextColor():0,fontSize:i.internal.getFontSize(),fontStyle:i.internal.getFont().fontStyle,font:i.internal.getFont().fontName,lineWidth:i.getLineWidth?this.jsPDFDocument.getLineWidth():0,lineColor:i.getDrawColor?this.jsPDFDocument.getDrawColor():0}}return r.setDefaults=function(i,e){e===void 0&&(e=null),e?e.__autoTableDocumentDefaults=i:wU=i},r.unifyColor=function(i){return Array.isArray(i)?i:typeof i=="number"?[i,i,i]:typeof i=="string"?[i]:null},r.prototype.applyStyles=function(i,e){var n,o,s;e===void 0&&(e=!1),i.fontStyle&&this.jsPDFDocument.setFontStyle&&this.jsPDFDocument.setFontStyle(i.fontStyle);var l=this.jsPDFDocument.internal.getFont(),h=l.fontStyle,p=l.fontName;if(i.font&&(p=i.font),i.fontStyle){h=i.fontStyle;var m=this.getFontList()[p];m&&m.indexOf(h)===-1&&this.jsPDFDocument.setFontStyle&&(this.jsPDFDocument.setFontStyle(m[0]),h=m[0])}if(this.jsPDFDocument.setFont(p,h),i.fontSize&&this.jsPDFDocument.setFontSize(i.fontSize),!e){var f=r.unifyColor(i.fillColor);f&&(n=this.jsPDFDocument).setFillColor.apply(n,f),f=r.unifyColor(i.textColor),f&&(o=this.jsPDFDocument).setTextColor.apply(o,f),f=r.unifyColor(i.lineColor),f&&(s=this.jsPDFDocument).setDrawColor.apply(s,f),typeof i.lineWidth=="number"&&this.jsPDFDocument.setLineWidth(i.lineWidth)}},r.prototype.splitTextToSize=function(i,e,n){return this.jsPDFDocument.splitTextToSize(i,e,n)},r.prototype.rect=function(i,e,n,o,s){return this.jsPDFDocument.rect(i,e,n,o,s)},r.prototype.getLastAutoTable=function(){return this.jsPDFDocument.lastAutoTable||null},r.prototype.getTextWidth=function(i){return this.jsPDFDocument.getTextWidth(i)},r.prototype.getDocument=function(){return this.jsPDFDocument},r.prototype.setPage=function(i){this.jsPDFDocument.setPage(i)},r.prototype.addPage=function(){return this.jsPDFDocument.addPage()},r.prototype.getFontList=function(){return this.jsPDFDocument.getFontList()},r.prototype.getGlobalOptions=function(){return wU||{}},r.prototype.getDocumentOptions=function(){return this.jsPDFDocument.__autoTableDocumentDefaults||{}},r.prototype.pageSize=function(){var i=this.jsPDFDocument.internal.pageSize;return i.width==null&&(i={width:i.getWidth(),height:i.getHeight()}),i},r.prototype.scaleFactor=function(){return this.jsPDFDocument.internal.scaleFactor},r.prototype.getLineHeightFactor=function(){var i=this.jsPDFDocument;return i.getLineHeightFactor?i.getLineHeightFactor():1.15},r.prototype.getLineHeight=function(i){return i/this.scaleFactor()*this.getLineHeightFactor()},r.prototype.pageNumber=function(){var i=this.jsPDFDocument.internal.getCurrentPageInfo();return i?i.pageNumber:this.jsPDFDocument.internal.getNumberOfPages()},r}(),GL=function(r,i){return GL=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},GL(r,i)};function IU(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");GL(r,i);function e(){this.constructor=r}r.prototype=i===null?Object.create(i):(e.prototype=i.prototype,new e)}var EU=function(r){IU(i,r);function i(e){var n=r.call(this)||this;return n._element=e,n}return i}(Array);function ose(r){return{font:"helvetica",fontStyle:"normal",overflow:"linebreak",fillColor:!1,textColor:20,halign:"left",valign:"top",fontSize:10,cellPadding:5/r,lineColor:200,lineWidth:0,cellWidth:"auto",minCellHeight:0,minCellWidth:0}}function ase(r){var i={striped:{table:{fillColor:255,textColor:80,fontStyle:"normal"},head:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},body:{},foot:{textColor:255,fillColor:[41,128,185],fontStyle:"bold"},alternateRow:{fillColor:245}},grid:{table:{fillColor:255,textColor:80,fontStyle:"normal",lineWidth:.1},head:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},body:{},foot:{textColor:255,fillColor:[26,188,156],fontStyle:"bold",lineWidth:0},alternateRow:{}},plain:{head:{fontStyle:"bold"},foot:{fontStyle:"bold"}}};return i[r]}function ZM(r,i,e){e.applyStyles(i,!0);var n=Array.isArray(r)?r:[r],o=n.map(function(s){return e.getTextWidth(s)}).reduce(function(s,l){return Math.max(s,l)},0);return o}function TU(r,i,e,n){var o=i.settings.tableLineWidth,s=i.settings.tableLineColor;r.applyStyles({lineWidth:o,lineColor:s});var l=FU(o,!1);l&&r.rect(e.x,e.y,i.getWidth(r.pageSize().width),n.y-e.y,l)}function FU(r,i){var e=r>0,n=i||i===0;return e&&n?"DF":e?"S":n?"F":null}function KM(r,i){var e,n,o,s;if(r=r||i,Array.isArray(r)){if(r.length>=4)return{top:r[0],right:r[1],bottom:r[2],left:r[3]};if(r.length===3)return{top:r[0],right:r[1],bottom:r[2],left:r[1]};if(r.length===2)return{top:r[0],right:r[1],bottom:r[0],left:r[1]};r.length===1?r=r[0]:r=i}return typeof r=="object"?(typeof r.vertical=="number"&&(r.top=r.vertical,r.bottom=r.vertical),typeof r.horizontal=="number"&&(r.right=r.horizontal,r.left=r.horizontal),{left:(e=r.left)!==null&&e!==void 0?e:i,top:(n=r.top)!==null&&n!==void 0?n:i,right:(o=r.right)!==null&&o!==void 0?o:i,bottom:(s=r.bottom)!==null&&s!==void 0?s:i}):(typeof r!="number"&&(r=i),{top:r,right:r,bottom:r,left:r})}function PU(r,i){var e=KM(i.settings.margin,0);return r.pageSize().width-(e.left+e.right)}function sse(r,i,e,n,o){var s={},l=1.3333333333333333,h=kL(i,function(X){return o.getComputedStyle(X).backgroundColor});h!=null&&(s.fillColor=h);var p=kL(i,function(X){return o.getComputedStyle(X).color});p!=null&&(s.textColor=p);var m=cse(n,e);m&&(s.cellPadding=m);var f="borderTopColor",g=l*e,y=n.borderTopWidth;if(n.borderBottomWidth===y&&n.borderRightWidth===y&&n.borderLeftWidth===y){var _=(parseFloat(y)||0)/g;_&&(s.lineWidth=_)}else s.lineWidth={top:(parseFloat(n.borderTopWidth)||0)/g,right:(parseFloat(n.borderRightWidth)||0)/g,bottom:(parseFloat(n.borderBottomWidth)||0)/g,left:(parseFloat(n.borderLeftWidth)||0)/g},s.lineWidth.top||(s.lineWidth.right?f="borderRightColor":s.lineWidth.bottom?f="borderBottomColor":s.lineWidth.left&&(f="borderLeftColor"));var w=kL(i,function(X){return o.getComputedStyle(X)[f]});w!=null&&(s.lineColor=w);var A=["left","right","center","justify"];A.indexOf(n.textAlign)!==-1&&(s.halign=n.textAlign),A=["middle","bottom","top"],A.indexOf(n.verticalAlign)!==-1&&(s.valign=n.verticalAlign);var k=parseInt(n.fontSize||"");isNaN(k)||(s.fontSize=k/l);var R=lse(n);R&&(s.fontStyle=R);var q=(n.fontFamily||"").toLowerCase();return r.indexOf(q)!==-1&&(s.font=q),s}function lse(r){var i="";return(r.fontWeight==="bold"||r.fontWeight==="bolder"||parseInt(r.fontWeight)>=700)&&(i="bold"),(r.fontStyle==="italic"||r.fontStyle==="oblique")&&(i+="italic"),i}function kL(r,i){var e=LU(r,i);if(!e)return null;var n=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d*\.?\d*))?\)$/);if(!n||!Array.isArray(n))return null;var o=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])],s=parseInt(n[4]);return s===0||isNaN(o[0])||isNaN(o[1])||isNaN(o[2])?null:o}function LU(r,i){var e=i(r);return e==="rgba(0, 0, 0, 0)"||e==="transparent"||e==="initial"||e==="inherit"?r.parentElement==null?null:LU(r.parentElement,i):e}function cse(r,i){var e=[r.paddingTop,r.paddingRight,r.paddingBottom,r.paddingLeft],n=96/(72/i),o=(parseInt(r.lineHeight)-parseInt(r.fontSize))/i/2,s=e.map(function(h){return parseInt(h||"0")/n}),l=KM(s,0);return o>l.top&&(l.top=o),o>l.bottom&&(l.bottom=o),l}function kU(r,i,e,n,o){var s,l;n===void 0&&(n=!1),o===void 0&&(o=!1);var h;typeof i=="string"?h=e.document.querySelector(i):h=i;var p=Object.keys(r.getFontList()),m=r.scaleFactor(),f=[],g=[],y=[];if(!h)return console.error("Html table could not be found with input: ",i),{head:f,body:g,foot:y};for(var _=0;_<h.rows.length;_++){var w=h.rows[_],A=(l=(s=w?.parentElement)===null||s===void 0?void 0:s.tagName)===null||l===void 0?void 0:l.toLowerCase(),k=use(p,m,e,w,n,o);k&&(A==="thead"?f.push(k):A==="tfoot"?y.push(k):g.push(k))}return{head:f,body:g,foot:y}}function use(r,i,e,n,o,s){for(var l=new EU(n),h=0;h<n.cells.length;h++){var p=n.cells[h],m=e.getComputedStyle(p);if(o||m.display!=="none"){var f=void 0;s&&(f=sse(r,p,i,m,e)),l.push({rowSpan:p.rowSpan,colSpan:p.colSpan,styles:f,_element:p,content:dse(p)})}}var g=e.getComputedStyle(n);if(l.length>0&&(o||g.display!=="none"))return l}function dse(r){var i=r.cloneNode(!0);return i.innerHTML=i.innerHTML.replace(/\n/g,"").replace(/ +/g," "),i.innerHTML=i.innerHTML.split(/<br.*?>/).map(function(e){return e.trim()}).join(`
`),i.innerText||i.textContent||""}function hse(r,i,e){for(var n=0,o=[r,i,e];n<o.length;n++){var s=o[n];s&&typeof s!="object"&&console.error("The options parameter should be of type object, is: "+typeof s),s.startY&&typeof s.startY!="number"&&(console.error("Invalid value for startY option",s.startY),delete s.startY)}}function Kf(r,i,e,n,o){if(r==null)throw new TypeError("Cannot convert undefined or null to object");for(var s=Object(r),l=1;l<arguments.length;l++){var h=arguments[l];if(h!=null)for(var p in h)Object.prototype.hasOwnProperty.call(h,p)&&(s[p]=h[p])}return s}function OU(r,i){var e=new gv(r),n=e.getDocumentOptions(),o=e.getGlobalOptions();hse(o,n,i);var s=Kf({},o,n,i),l;typeof window<"u"&&(l=window);var h=pse(o,n,i),p=mse(o,n,i),m=fse(e,s),f=_se(e,s,l);return{id:i.tableId,content:f,hooks:p,styles:h,settings:m}}function pse(r,i,e){for(var n={styles:{},headStyles:{},bodyStyles:{},footStyles:{},alternateRowStyles:{},columnStyles:{}},o=function(p){if(p==="columnStyles"){var m=r[p],f=i[p],g=e[p];n.columnStyles=Kf({},m,f,g)}else{var y=[r,i,e],_=y.map(function(w){return w[p]||{}});n[p]=Kf({},_[0],_[1],_[2])}},s=0,l=Object.keys(n);s<l.length;s++){var h=l[s];o(h)}return n}function mse(r,i,e){for(var n=[r,i,e],o={didParseCell:[],willDrawCell:[],didDrawCell:[],willDrawPage:[],didDrawPage:[]},s=0,l=n;s<l.length;s++){var h=l[s];h.didParseCell&&o.didParseCell.push(h.didParseCell),h.willDrawCell&&o.willDrawCell.push(h.willDrawCell),h.didDrawCell&&o.didDrawCell.push(h.didDrawCell),h.willDrawPage&&o.willDrawPage.push(h.willDrawPage),h.didDrawPage&&o.didDrawPage.push(h.didDrawPage)}return o}function fse(r,i){var e,n,o,s,l,h,p,m,f,g,y,_,w=KM(i.margin,40/r.scaleFactor()),A=(e=gse(r,i.startY))!==null&&e!==void 0?e:w.top,k;i.showFoot===!0?k="everyPage":i.showFoot===!1?k="never":k=(n=i.showFoot)!==null&&n!==void 0?n:"everyPage";var R;i.showHead===!0?R="everyPage":i.showHead===!1?R="never":R=(o=i.showHead)!==null&&o!==void 0?o:"everyPage";var q=(s=i.useCss)!==null&&s!==void 0?s:!1,X=i.theme||(q?"plain":"striped"),ie=!!i.horizontalPageBreak,ae=(l=i.horizontalPageBreakRepeat)!==null&&l!==void 0?l:null;return{includeHiddenHtml:(h=i.includeHiddenHtml)!==null&&h!==void 0?h:!1,useCss:q,theme:X,startY:A,margin:w,pageBreak:(p=i.pageBreak)!==null&&p!==void 0?p:"auto",rowPageBreak:(m=i.rowPageBreak)!==null&&m!==void 0?m:"auto",tableWidth:(f=i.tableWidth)!==null&&f!==void 0?f:"auto",showHead:R,showFoot:k,tableLineWidth:(g=i.tableLineWidth)!==null&&g!==void 0?g:0,tableLineColor:(y=i.tableLineColor)!==null&&y!==void 0?y:200,horizontalPageBreak:ie,horizontalPageBreakRepeat:ae,horizontalPageBreakBehaviour:(_=i.horizontalPageBreakBehaviour)!==null&&_!==void 0?_:"afterAllRows"}}function gse(r,i){var e=r.getLastAutoTable(),n=r.scaleFactor(),o=r.pageNumber(),s=!1;if(e&&e.startPageNumber){var l=e.startPageNumber+e.pageNumber-1;s=l===o}return typeof i=="number"?i:(i==null||i===!1)&&s&&e?.finalY!=null?e.finalY+20/n:null}function _se(r,i,e){var n=i.head||[],o=i.body||[],s=i.foot||[];if(i.html){var l=i.includeHiddenHtml;if(e){var h=kU(r,i.html,e,l,i.useCss)||{};n=h.head||n,o=h.body||n,s=h.foot||n}else console.error("Cannot parse html in non browser environment")}var p=i.columns||yse(n,o,s);return{columns:p,head:n,body:o,foot:s}}function yse(r,i,e){var n=r[0]||i[0]||e[0]||[],o=[];return Object.keys(n).filter(function(s){return s!=="_element"}).forEach(function(s){var l=1,h;Array.isArray(n)?h=n[parseInt(s)]:h=n[s],typeof h=="object"&&!Array.isArray(h)&&(l=h?.colSpan||1);for(var p=0;p<l;p++){var m=void 0;Array.isArray(n)?m=o.length:m=s+(p>0?"_".concat(p):"");var f={dataKey:m};o.push(f)}}),o}var jL=function(){function r(i,e,n){this.table=e,this.pageNumber=e.pageNumber,this.settings=e.settings,this.cursor=n,this.doc=i.getDocument()}return r}(),vse=function(r){IU(i,r);function i(e,n,o,s,l,h){var p=r.call(this,e,n,h)||this;return p.cell=o,p.row=s,p.column=l,p.section=s.section,p}return i}(jL),bse=function(){function r(i,e){this.pageNumber=1,this.id=i.id,this.settings=i.settings,this.styles=i.styles,this.hooks=i.hooks,this.columns=e.columns,this.head=e.head,this.body=e.body,this.foot=e.foot}return r.prototype.getHeadHeight=function(i){return this.head.reduce(function(e,n){return e+n.getMaxCellHeight(i)},0)},r.prototype.getFootHeight=function(i){return this.foot.reduce(function(e,n){return e+n.getMaxCellHeight(i)},0)},r.prototype.allRows=function(){return this.head.concat(this.body).concat(this.foot)},r.prototype.callCellHooks=function(i,e,n,o,s,l){for(var h=0,p=e;h<p.length;h++){var m=p[h],f=new vse(i,this,n,o,s,l),g=m(f)===!1;if(n.text=Array.isArray(n.text)?n.text:[n.text],g)return!1}return!0},r.prototype.callEndPageHooks=function(i,e){i.applyStyles(i.userStyles);for(var n=0,o=this.hooks.didDrawPage;n<o.length;n++){var s=o[n];s(new jL(i,this,e))}},r.prototype.callWillDrawPageHooks=function(i,e){for(var n=0,o=this.hooks.willDrawPage;n<o.length;n++){var s=o[n];s(new jL(i,this,e))}},r.prototype.getWidth=function(i){if(typeof this.settings.tableWidth=="number")return this.settings.tableWidth;if(this.settings.tableWidth==="wrap"){var e=this.columns.reduce(function(o,s){return o+s.wrappedWidth},0);return e}else{var n=this.settings.margin;return i-n.left-n.right}},r}(),DU=function(){function r(i,e,n,o,s){s===void 0&&(s=!1),this.height=0,this.raw=i,i instanceof EU&&(this.raw=i._element,this.element=i._element),this.index=e,this.section=n,this.cells=o,this.spansMultiplePages=s}return r.prototype.getMaxCellHeight=function(i){var e=this;return i.reduce(function(n,o){var s;return Math.max(n,((s=e.cells[o.index])===null||s===void 0?void 0:s.height)||0)},0)},r.prototype.hasRowSpan=function(i){var e=this;return i.filter(function(n){var o=e.cells[n.index];return o?o.rowSpan>1:!1}).length>0},r.prototype.canEntireRowFit=function(i,e){return this.getMaxCellHeight(e)<=i},r.prototype.getMinimumRowHeight=function(i,e){var n=this;return i.reduce(function(o,s){var l=n.cells[s.index];if(!l)return 0;var h=e.getLineHeight(l.styles.fontSize),p=l.padding("vertical"),m=p+h;return m>o?m:o},0)},r}(),RU=function(){function r(i,e,n){var o;this.contentHeight=0,this.contentWidth=0,this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.height=0,this.x=0,this.y=0,this.styles=e,this.section=n,this.raw=i;var s=i;i!=null&&typeof i=="object"&&!Array.isArray(i)?(this.rowSpan=i.rowSpan||1,this.colSpan=i.colSpan||1,s=(o=i.content)!==null&&o!==void 0?o:i,i._element&&(this.raw=i._element)):(this.rowSpan=1,this.colSpan=1);var l=s!=null?""+s:"",h=/\r\n|\r|\n/g;this.text=l.split(h)}return r.prototype.getTextPos=function(){var i;if(this.styles.valign==="top")i=this.y+this.padding("top");else if(this.styles.valign==="bottom")i=this.y+this.height-this.padding("bottom");else{var e=this.height-this.padding("vertical");i=this.y+e/2+this.padding("top")}var n;if(this.styles.halign==="right")n=this.x+this.width-this.padding("right");else if(this.styles.halign==="center"){var o=this.width-this.padding("horizontal");n=this.x+o/2+this.padding("left")}else n=this.x+this.padding("left");return{x:n,y:i}},r.prototype.getContentHeight=function(i,e){e===void 0&&(e=1.15);var n=Array.isArray(this.text)?this.text.length:1,o=this.styles.fontSize/i*e,s=n*o+this.padding("vertical");return Math.max(s,this.styles.minCellHeight)},r.prototype.padding=function(i){var e=KM(this.styles.cellPadding,0);return i==="vertical"?e.top+e.bottom:i==="horizontal"?e.left+e.right:e[i]},r}(),wse=function(){function r(i,e,n){this.wrappedWidth=0,this.minReadableWidth=0,this.minWidth=0,this.width=0,this.dataKey=i,this.raw=e,this.index=n}return r.prototype.getMaxCustomCellWidth=function(i){for(var e=0,n=0,o=i.allRows();n<o.length;n++){var s=o[n],l=s.cells[this.index];l&&typeof l.styles.cellWidth=="number"&&(e=Math.max(e,l.styles.cellWidth))}return e},r}();function xse(r,i){Sse(r,i);var e=[],n=0;i.columns.forEach(function(s){var l=s.getMaxCustomCellWidth(i);l?s.width=l:(s.width=s.wrappedWidth,e.push(s)),n+=s.width});var o=i.getWidth(r.pageSize().width)-n;o&&(o=VL(e,o,function(s){return Math.max(s.minReadableWidth,s.minWidth)})),o&&(o=VL(e,o,function(s){return s.minWidth})),o=Math.abs(o),!i.settings.horizontalPageBreak&&o>.1/r.scaleFactor()&&(o=o<1?o:Math.round(o),console.warn("Of the table content, ".concat(o," units width could not fit page"))),Ase(i),Mse(i,r),Cse(i)}function Sse(r,i){var e=r.scaleFactor(),n=i.settings.horizontalPageBreak,o=PU(r,i);i.allRows().forEach(function(s){for(var l=0,h=i.columns;l<h.length;l++){var p=h[l],m=s.cells[p.index];if(m){var f=i.hooks.didParseCell;i.callCellHooks(r,f,m,s,p,null);var g=m.padding("horizontal");m.contentWidth=ZM(m.text,m.styles,r)+g;var y=ZM(m.text.join(" ").split(/[^\S\u00A0]+/),m.styles,r);if(m.minReadableWidth=y+m.padding("horizontal"),typeof m.styles.cellWidth=="number")m.minWidth=m.styles.cellWidth,m.wrappedWidth=m.styles.cellWidth;else if(m.styles.cellWidth==="wrap"||n===!0)m.contentWidth>o?(m.minWidth=o,m.wrappedWidth=o):(m.minWidth=m.contentWidth,m.wrappedWidth=m.contentWidth);else{var _=10/e;m.minWidth=m.styles.minCellWidth||_,m.wrappedWidth=m.contentWidth,m.minWidth>m.wrappedWidth&&(m.wrappedWidth=m.minWidth)}}}}),i.allRows().forEach(function(s){for(var l=0,h=i.columns;l<h.length;l++){var p=h[l],m=s.cells[p.index];if(m&&m.colSpan===1)p.wrappedWidth=Math.max(p.wrappedWidth,m.wrappedWidth),p.minWidth=Math.max(p.minWidth,m.minWidth),p.minReadableWidth=Math.max(p.minReadableWidth,m.minReadableWidth);else{var f=i.styles.columnStyles[p.dataKey]||i.styles.columnStyles[p.index]||{},g=f.cellWidth||f.minCellWidth;g&&typeof g=="number"&&(p.minWidth=g,p.wrappedWidth=g)}m&&(m.colSpan>1&&!p.minWidth&&(p.minWidth=m.minWidth),m.colSpan>1&&!p.wrappedWidth&&(p.wrappedWidth=m.minWidth))}})}function VL(r,i,e){for(var n=i,o=r.reduce(function(_,w){return _+w.wrappedWidth},0),s=0;s<r.length;s++){var l=r[s],h=l.wrappedWidth/o,p=n*h,m=l.width+p,f=e(l),g=m<f?f:m;i-=g-l.width,l.width=g}if(i=Math.round(i*1e10)/1e10,i){var y=r.filter(function(_){return i<0?_.width>e(_):!0});y.length&&(i=VL(y,i,e))}return i}function Cse(r){for(var i={},e=1,n=r.allRows(),o=0;o<n.length;o++)for(var s=n[o],l=0,h=r.columns;l<h.length;l++){var p=h[l],m=i[p.index];if(e>1)e--,delete s.cells[p.index];else if(m)m.cell.height+=s.height,e=m.cell.colSpan,delete s.cells[p.index],m.left--,m.left<=1&&delete i[p.index];else{var f=s.cells[p.index];if(!f)continue;if(f.height=s.height,f.rowSpan>1){var g=n.length-o,y=f.rowSpan>g?g:f.rowSpan;i[p.index]={cell:f,left:y,row:s}}}}}function Ase(r){for(var i=r.allRows(),e=0;e<i.length;e++)for(var n=i[e],o=null,s=0,l=0,h=0;h<r.columns.length;h++){var p=r.columns[h];if(l-=1,l>1&&r.columns[h+1])s+=p.width,delete n.cells[p.index];else if(o){var m=o;delete n.cells[p.index],o=null,m.width=p.width+s}else{var m=n.cells[p.index];if(!m)continue;if(l=m.colSpan,s=0,m.colSpan>1){o=m,s+=p.width;continue}m.width=p.width+s}}}function Mse(r,i){for(var e={count:0,height:0},n=0,o=r.allRows();n<o.length;n++){for(var s=o[n],l=0,h=r.columns;l<h.length;l++){var p=h[l],m=s.cells[p.index];if(m){i.applyStyles(m.styles,!0);var f=m.width-m.padding("horizontal");if(m.styles.overflow==="linebreak")m.text=i.splitTextToSize(m.text,f+1/i.scaleFactor(),{fontSize:m.styles.fontSize});else if(m.styles.overflow==="ellipsize")m.text=xU(m.text,f,m.styles,i,"...");else if(m.styles.overflow==="hidden")m.text=xU(m.text,f,m.styles,i,"");else if(typeof m.styles.overflow=="function"){var g=m.styles.overflow(m.text,f);typeof g=="string"?m.text=[g]:m.text=g}m.contentHeight=m.getContentHeight(i.scaleFactor(),i.getLineHeightFactor());var y=m.contentHeight/m.rowSpan;m.rowSpan>1&&e.count*e.height<y*m.rowSpan?e={height:y,count:m.rowSpan}:e&&e.count>0&&e.height>y&&(y=e.height),y>s.height&&(s.height=y)}}e.count--}}function xU(r,i,e,n,o){return r.map(function(s){return Ise(s,i,e,n,o)})}function Ise(r,i,e,n,o){var s=1e4*n.scaleFactor();if(i=Math.ceil(i*s)/s,i>=ZM(r,e,n))return r;for(;i<ZM(r+o,e,n)&&!(r.length<=1);)r=r.substring(0,r.length-1);return r.trim()+o}function NU(r,i){var e=new gv(r),n=Ese(i,e.scaleFactor()),o=new bse(i,n);return xse(e,o),e.applyStyles(e.userStyles),o}function Ese(r,i){var e=r.content,n=Fse(e.columns);if(e.head.length===0){var o=SU(n,"head");o&&e.head.push(o)}if(e.foot.length===0){var o=SU(n,"foot");o&&e.foot.push(o)}var s=r.settings.theme,l=r.styles;return{columns:n,head:OL("head",e.head,n,l,s,i),body:OL("body",e.body,n,l,s,i),foot:OL("foot",e.foot,n,l,s,i)}}function OL(r,i,e,n,o,s){var l={},h=i.map(function(p,m){for(var f=0,g={},y=0,_=0,w=0,A=e;w<A.length;w++){var k=A[w];if(l[k.index]==null||l[k.index].left===0)if(_===0){var R=void 0;Array.isArray(p)?R=p[k.index-y-f]:R=p[k.dataKey];var q={};typeof R=="object"&&!Array.isArray(R)&&(q=R?.styles||{});var X=Pse(r,k,m,o,n,s,q),ie=new RU(R,X,r);g[k.dataKey]=ie,g[k.index]=ie,_=ie.colSpan-1,l[k.index]={left:ie.rowSpan-1,times:_}}else _--,y++;else l[k.index].left--,_=l[k.index].times,f++}return new DU(p,m,r,g)});return h}function SU(r,i){var e={};return r.forEach(function(n){if(n.raw!=null){var o=Tse(i,n.raw);o!=null&&(e[n.dataKey]=o)}}),Object.keys(e).length>0?e:null}function Tse(r,i){if(r==="head"){if(typeof i=="object")return i.header||null;if(typeof i=="string"||typeof i=="number")return i}else if(r==="foot"&&typeof i=="object")return i.footer;return null}function Fse(r){return r.map(function(i,e){var n,o;return typeof i=="object"?o=(n=i.dataKey)!==null&&n!==void 0?n:e:o=e,new wse(o,i,e)})}function Pse(r,i,e,n,o,s,l){var h=ase(n),p;r==="head"?p=o.headStyles:r==="body"?p=o.bodyStyles:r==="foot"&&(p=o.footStyles);var m=Kf({},h.table,h[r],o.styles,p),f=o.columnStyles[i.dataKey]||o.columnStyles[i.index]||{},g=r==="body"?f:{},y=r==="body"&&e%2===0?Kf({},h.alternateRow,o.alternateRowStyles):{},_=ose(s),w=Kf({},_,m,y,g);return Kf(w,l)}function Lse(r,i,e){var n;e===void 0&&(e={});var o=PU(r,i),s=new Map,l=[],h=[],p=[];Array.isArray(i.settings.horizontalPageBreakRepeat)?p=i.settings.horizontalPageBreakRepeat:(typeof i.settings.horizontalPageBreakRepeat=="string"||typeof i.settings.horizontalPageBreakRepeat=="number")&&(p=[i.settings.horizontalPageBreakRepeat]),p.forEach(function(y){var _=i.columns.find(function(w){return w.dataKey===y||w.index===y});_&&!s.has(_.index)&&(s.set(_.index,!0),l.push(_.index),h.push(i.columns[_.index]),o-=_.wrappedWidth)});for(var m=!0,f=(n=e?.start)!==null&&n!==void 0?n:0;f<i.columns.length;){if(s.has(f)){f++;continue}var g=i.columns[f].wrappedWidth;if(m||o>=g)m=!1,l.push(f),h.push(i.columns[f]),o-=g;else break;f++}return{colIndexes:l,columns:h,lastIndex:f-1}}function kse(r,i){for(var e=[],n=0;n<i.columns.length;n++){var o=Lse(r,i,{start:n});o.columns.length&&(e.push(o),n=o.lastIndex)}return e}function BU(r,i){var e=i.settings,n=e.startY,o=e.margin,s={x:o.left,y:n},l=i.getHeadHeight(i.columns)+i.getFootHeight(i.columns),h=n+o.bottom+l;if(e.pageBreak==="avoid"){var p=i.body,m=p.reduce(function(y,_){return y+_.height},0);h+=m}var f=new gv(r);(e.pageBreak==="always"||e.startY!=null&&h>f.pageSize().height)&&(jU(f),s.y=o.top),i.callWillDrawPageHooks(f,s);var g=Kf({},s);i.startPageNumber=f.pageNumber(),e.horizontalPageBreak?Ose(f,i,g,s):(f.applyStyles(f.userStyles),(e.showHead==="firstPage"||e.showHead==="everyPage")&&i.head.forEach(function(y){return Qf(f,i,y,s,i.columns)}),f.applyStyles(f.userStyles),i.body.forEach(function(y,_){var w=_===i.body.length-1;XM(f,i,y,w,g,s,i.columns)}),f.applyStyles(f.userStyles),(e.showFoot==="lastPage"||e.showFoot==="everyPage")&&i.foot.forEach(function(y){return Qf(f,i,y,s,i.columns)})),TU(f,i,g,s),i.callEndPageHooks(f,s),i.finalY=s.y,r.lastAutoTable=i,f.applyStyles(f.userStyles)}function Ose(r,i,e,n){var o=kse(r,i),s=i.settings;if(s.horizontalPageBreakBehaviour==="afterAllRows")o.forEach(function(m,f){r.applyStyles(r.userStyles),f>0?oS(r,i,e,n,m.columns,!0):CU(r,i,n,m.columns),Dse(r,i,e,n,m.columns),DL(r,i,n,m.columns)});else for(var l=-1,h=o[0],p=function(){var m=l;if(h){r.applyStyles(r.userStyles);var f=h.columns;l>=0?oS(r,i,e,n,f,!0):CU(r,i,n,f),m=AU(r,i,l+1,n,f),DL(r,i,n,f)}var g=m-l;o.slice(1).forEach(function(y){r.applyStyles(r.userStyles),oS(r,i,e,n,y.columns,!0),AU(r,i,l+1,n,y.columns,g),DL(r,i,n,y.columns)}),l=m};l<i.body.length-1;)p()}function CU(r,i,e,n){var o=i.settings;r.applyStyles(r.userStyles),(o.showHead==="firstPage"||o.showHead==="everyPage")&&i.head.forEach(function(s){return Qf(r,i,s,e,n)})}function Dse(r,i,e,n,o){r.applyStyles(r.userStyles),i.body.forEach(function(s,l){var h=l===i.body.length-1;XM(r,i,s,h,e,n,o)})}function AU(r,i,e,n,o,s){r.applyStyles(r.userStyles),s=s??i.body.length;var l=Math.min(e+s,i.body.length),h=-1;return i.body.slice(e,l).forEach(function(p,m){var f=e+m===i.body.length-1,g=GU(r,i,f,n);p.canEntireRowFit(g,o)&&(Qf(r,i,p,n,o),h=e+m)}),h}function DL(r,i,e,n){var o=i.settings;r.applyStyles(r.userStyles),(o.showFoot==="lastPage"||o.showFoot==="everyPage")&&i.foot.forEach(function(s){return Qf(r,i,s,e,n)})}function Rse(r,i,e){var n=e.getLineHeight(r.styles.fontSize),o=r.padding("vertical"),s=Math.floor((i-o)/n);return Math.max(0,s)}function Nse(r,i,e,n){var o={};r.spansMultiplePages=!0,r.height=0;for(var s=0,l=0,h=e.columns;l<h.length;l++){var p=h[l],m=r.cells[p.index];if(m){Array.isArray(m.text)||(m.text=[m.text]);var f=new RU(m.raw,m.styles,m.section);f=Kf(f,m),f.text=[];var g=Rse(m,i,n);m.text.length>g&&(f.text=m.text.splice(g,m.text.length));var y=n.scaleFactor(),_=n.getLineHeightFactor();m.contentHeight=m.getContentHeight(y,_),m.contentHeight>=i&&(m.contentHeight=i,f.styles.minCellHeight-=i),m.contentHeight>r.height&&(r.height=m.contentHeight),f.contentHeight=f.getContentHeight(y,_),f.contentHeight>s&&(s=f.contentHeight),o[p.index]=f}}var w=new DU(r.raw,-1,r.section,o,!0);w.height=s;for(var A=0,k=e.columns;A<k.length;A++){var p=k[A],f=w.cells[p.index];f&&(f.height=w.height);var m=r.cells[p.index];m&&(m.height=r.height)}return w}function Bse(r,i,e,n){var o=r.pageSize().height,s=n.settings.margin,l=s.top+s.bottom,h=o-l;i.section==="body"&&(h-=n.getHeadHeight(n.columns)+n.getFootHeight(n.columns));var p=i.getMinimumRowHeight(n.columns,r),m=p<e;if(p>h)return console.error("Will not be able to print row ".concat(i.index," correctly since it's minimum height is larger than page height")),!0;if(!m)return!1;var f=i.hasRowSpan(n.columns),g=i.getMaxCellHeight(n.columns)>h;return g?(f&&console.error("The content of row ".concat(i.index," will not be drawn correctly since drawing rows with a height larger than the page height and has cells with rowspans is not supported.")),!0):!(f||n.settings.rowPageBreak==="avoid")}function XM(r,i,e,n,o,s,l){var h=GU(r,i,n,s);if(e.canEntireRowFit(h,l))Qf(r,i,e,s,l);else if(Bse(r,e,h,i)){var p=Nse(e,h,i,r);Qf(r,i,e,s,l),oS(r,i,o,s,l),XM(r,i,p,n,o,s,l)}else oS(r,i,o,s,l),XM(r,i,e,n,o,s,l)}function Qf(r,i,e,n,o){n.x=i.settings.margin.left;for(var s=0,l=o;s<l.length;s++){var h=l[s],p=e.cells[h.index];if(!p){n.x+=h.width;continue}r.applyStyles(p.styles),p.x=n.x,p.y=n.y;var m=i.callCellHooks(r,i.hooks.willDrawCell,p,e,h,n);if(m===!1){n.x+=h.width;continue}Gse(r,p,n);var f=p.getTextPos();MU(p.text,f.x,f.y,{halign:p.styles.halign,valign:p.styles.valign,maxWidth:Math.ceil(p.width-p.padding("left")-p.padding("right"))},r.getDocument()),i.callCellHooks(r,i.hooks.didDrawCell,p,e,h,n),n.x+=h.width}n.y+=e.height}function Gse(r,i,e){var n=i.styles;if(r.getDocument().setFillColor(r.getDocument().getFillColor()),typeof n.lineWidth=="number"){var o=FU(n.lineWidth,n.fillColor);o&&r.rect(i.x,e.y,i.width,i.height,o)}else typeof n.lineWidth=="object"&&(n.fillColor&&r.rect(i.x,e.y,i.width,i.height,"F"),jse(r,i,e,n.lineWidth))}function jse(r,i,e,n){var o,s,l,h;n.top&&(o=e.x,s=e.y,l=e.x+i.width,h=e.y,n.right&&(l+=.5*n.right),n.left&&(o-=.5*n.left),p(n.top,o,s,l,h)),n.bottom&&(o=e.x,s=e.y+i.height,l=e.x+i.width,h=e.y+i.height,n.right&&(l+=.5*n.right),n.left&&(o-=.5*n.left),p(n.bottom,o,s,l,h)),n.left&&(o=e.x,s=e.y,l=e.x,h=e.y+i.height,n.top&&(s-=.5*n.top),n.bottom&&(h+=.5*n.bottom),p(n.left,o,s,l,h)),n.right&&(o=e.x+i.width,s=e.y,l=e.x+i.width,h=e.y+i.height,n.top&&(s-=.5*n.top),n.bottom&&(h+=.5*n.bottom),p(n.right,o,s,l,h));function p(m,f,g,y,_){r.getDocument().setLineWidth(m),r.getDocument().line(f,g,y,_,"S")}}function GU(r,i,e,n){var o=i.settings.margin.bottom,s=i.settings.showFoot;return(s==="everyPage"||s==="lastPage"&&e)&&(o+=i.getFootHeight(i.columns)),r.pageSize().height-n.y-o}function oS(r,i,e,n,o,s){o===void 0&&(o=[]),s===void 0&&(s=!1),r.applyStyles(r.userStyles),i.settings.showFoot==="everyPage"&&!s&&i.foot.forEach(function(h){return Qf(r,i,h,n,o)}),i.callEndPageHooks(r,n);var l=i.settings.margin;TU(r,i,e,n),jU(r),i.pageNumber++,n.x=l.left,n.y=l.top,e.y=l.top,i.callWillDrawPageHooks(r,n),i.settings.showHead==="everyPage"&&(i.head.forEach(function(h){return Qf(r,i,h,n,o)}),r.applyStyles(r.userStyles))}function jU(r){var i=r.pageNumber();r.setPage(i+1);var e=r.pageNumber();return e===i?(r.addPage(),!0):!1}function Vse(r){r.API.autoTable=function(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];var n=i[0],o=OU(this,n),s=NU(this,o);return BU(this,s),this},r.API.lastAutoTable=!1,r.API.autoTableText=function(i,e,n,o){MU(i,e,n,o,this)},r.API.autoTableSetDefaults=function(i){return gv.setDefaults(i,this),this},r.autoTableSetDefaults=function(i,e){gv.setDefaults(i,e)},r.API.autoTableHtmlToJson=function(i,e){var n;if(e===void 0&&(e=!1),typeof window>"u")return console.error("Cannot run autoTableHtmlToJson in non browser environment"),null;var o=new gv(this),s=kU(o,i,window,e,!1),l=s.head,h=s.body,p=((n=l[0])===null||n===void 0?void 0:n.map(function(m){return m.content}))||[];return{columns:p,rows:h,data:h}}}var RL;function VU(r,i){var e=OU(r,i),n=NU(r,e);BU(r,n)}try{typeof window<"u"&&window&&(NL=window,BL=NL.jsPDF||((RL=NL.jspdf)===null||RL===void 0?void 0:RL.jsPDF),BL&&Vse(BL))}catch(r){console.error("Could not apply autoTable plugin",r)}var NL,BL;var Qq=Jl(D1());var QM=Jl(UU()),P0=Jl(PG());var qU=Jl(cP());function zU(r){return r.type==="group"}function An(r){return r.type==="group"}function jn(r){return!An(r)}function cd(r){return jn(r)&&r.baseLayer}function Use(r){return r.isIgoInternalLayer}function $L(r){let i=r;if(i.sourceOptions?.type==="mvt"&&(i.igoStyle?.styleByAttribute?.hoverStyle||i.igoStyle?.hoverStyle)){let e=i.sourceOptions.featureClass;i.sourceOptions.featureClass=e||"feature"}return r}function $U(r){if(cd(r)&&!r.visible||Use(r))return!1;if(r.options.sourceOptions?.type)return!0}function F0(r,i){return r.sort(i==="desc"?zse:$se).map(e=>(An(e)&&F0([...e.children],i),e))}function zse(r,i){return i.zIndex-r.zIndex}function $se(r,i){return r.zIndex-i.zIndex}function WU(r){let i=[];for(let e of r){if(An(e))continue;let n=e.options.legendOptions;if(e.visible===!1)continue;let o=e.dataSource.getLegend()||[];for(let s of o)s.url!==void 0&&i.push({title:e.title||"",url:s.url,display:n?.display===void 0?!0:n.display,isInResolutionsRange:e.isInResolutionsRange})}return i}function WL(r){let i=function(e,n){let o=e.join(" "),s=n[0],l=n[2],h=n[1],p=n[3],m=[p,s,h,s,h,l,p,l].join(" "),f=this.internal.newAdditionalObject(),g=this.internal.newAdditionalObject(),y=this.internal.newAdditionalObject();y.content='<< /EPSG 3857 /Type /PROJCS /WKT (PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.017453292519943295]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",0.0],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]) >>',g.content="<< /Bounds [ 0 1 0 0 1 0 1 1 ] /GCS "+y.objId+" 0 R /GPTS [ "+m+" ] /LPTS [ 0 1 0 0 1 0 1 1 ] /Subtype /GEO /Type /Measure >>",f.content="<< /BBox [ "+o+" ] /Measure "+g.objId+" 0 R /Name (Layer) /Type /Viewport >>";let _=this.internal.newAdditionalObject(),w=new Date().toLocaleDateString("en-CA");return _.content="<< /Name IGO2 /Type /OCG /Date "+w+" >>",f.objId};r.setGeoArea=function(e,n){this.internal.events.subscribe("putPage",function(){let o=i.call(this,e,n);this.internal.write("/VP [ "+o+" 0 R ]")})}}var HL=k1(["Pdf","Image"]),Xd=k1(["A0","A1","A2","A3","A4","A5","Letter","Legal"]),Cp=k1(["landscape","portrait"]),HU=["72","96","150","300"],qL=k1(["Bmp","Gif","Jpeg","Png","Tiff"]),YL=k1(["none","topright","topleft","bottomleft","bottomright","newpage"]);var JM=(()=>{class r{http;messageService;activityService;languageService;configService;document;zipFile;nbFileToProcess;activityId;mapPrintExtent;imgSizeAdded;TEXTPDFFONT={titleFont:"times",titleFontStyle:"bold",subtitleFont:"times",subtitleFontStyle:"bold",commentFont:"times",commentFontStyle:"normal",commentFontSize:12};constructor(e,n,o,s,l,h){this.http=e,this.messageService=n,this.activityService=o,this.languageService=s,this.configService=l,this.document=h}print(e,n){let o=new Si,s=n.paperFormat,l=+n.resolution,h=n.orientation,p=n.legendPosition;this.activityId=this.activityService.register(),WL(Ui.API);let m=new Ui({orientation:h,format:s.toLowerCase(),unit:"mm"}),{width:f,height:g}=m.internal.pageSize,y=[10,10,10,10],_,w;(n.title!==""||n.subtitle!=="")&&(s===Xd.A1||s===Xd.A0)&&(y[0]+=10);let A=Math.round(2*(g+145)*.05)/2;n.title!==void 0&&n.title!==""&&(_=this.getTextPdfObjectSizeAndMarg(n.title,y,this.TEXTPDFFONT.titleFont,A,this.TEXTPDFFONT.titleFontStyle,m),this.addTextInPdfDoc(m,n.title,this.TEXTPDFFONT.titleFont,this.TEXTPDFFONT.titleFontStyle,_.fontSize,_.marginLeft+y[3],y[0]),y[0]=_.height+y[0]),n.subtitle!==void 0&&n.subtitle!==""&&(w=this.getTextPdfObjectSizeAndMarg(n.subtitle,y,this.TEXTPDFFONT.subtitleFont,n.title!==""?_.fontSize*.7:A*.7,this.TEXTPDFFONT.subtitleFontStyle,m),this.addTextInPdfDoc(m,n.subtitle,this.TEXTPDFFONT.subtitleFont,this.TEXTPDFFONT.subtitleFontStyle,w.fontSize,w.marginLeft+y[3],y[0]),y[0]+=5);let k=5;n.comment!==void 0&&n.comment!==""&&this.addComment(m,n.comment,y,k),this.handleFooter(e,m,n,l,k,y);let R=f-y[3]-y[1],q=g-y[0]-y[2],X=[R,q];return this.addMap(m,e,l,X,y).subscribe(ie=>un(this,null,function*(){if(ie===dn.Done){let ae=this.imgSizeAdded[0],be=this.imgSizeAdded[1];if(this.addGeoRef(m,e,ae,be,y),yield this.handleMeasureLayer(m,e,y),n.showNorthArrow){let me=yield this.createNorthDirectionArrow(e.viewController.getRotation());yield this.addNorthArrowInDoc(m,me,y,p,ae)}n.legendPosition!=="none"?["topleft","topright","bottomleft","bottomright"].indexOf(n.legendPosition)>-1?yield this.addLegendSamePage(m,e,y,l,n.legendPosition):n.legendPosition==="newpage"&&(yield this.addLegend(m,e,y,l)):yield this.saveDoc(m)}(ie===dn.Done||ie===dn.Error)&&(this.activityService.unregister(this.activityId),o.next(dn.Done))})),o}addGeoRef(e,n,o,s,l){let h="mm",p=e.internal.pageSize.getHeight(),m=l[3],f=p-l[0]-s,g=[m,f,m+o,f+s];for(let y=0;y<g.length;y++)g[y]=this.pdf_units2points(g[y],h);e.setGeoArea(g,this.mapPrintExtent)}handleMeasureLayer(e,n,o){return un(this,null,function*(){if(n.layerController.all.find(s=>s.visible&&s.id.startsWith("igo-measures-"))){let s,l=n.ol.getOverlayContainer();yield(0,P0.default)(l,{scale:1,backgroundColor:null}).then(h=>{s=h}),this.addCanvas(e,s,o)}})}getLayersLegendHtml(e,n){return new $r(o=>{let s="",l=WU(e.layerController.all);if(l.filter(p=>p.display===!0).length===0){o.next(s),o.complete();return}s+='<style media="screen" type="text/css">',s+=".html2canvas-container { width: "+n+"mm !important; height: 2000px !important; }",s+="table.tableLegend {table-layout: auto;}",s+="div.styleLegend {padding-top: 5px; padding-right:5px;padding-left:5px;padding-bottom:5px;}",s+="</style>",s+='<font size="3" face="Times" >',s+='<div class="styleLegend">',s+='<table class="tableLegend" >';let h=l.filter(p=>p.display&&p.isInResolutionsRange===!0).map(p=>this.getDataImage(p.url).pipe(Nt(m=>{let f="<tr><td>"+p.title.toUpperCase()+"</td></tr>";return f+='<tr><td><img src="'+m+'"></td></tr>',f})));mp(h).subscribe(p=>{s=p.reduce((m,f)=>m+=f,s),s+="</table>",s+="</div>",o.next(s),o.complete()})})}getDataImage(e){return new R1(this.http,this.configService).transform(e)}getLayersLegendImage(e,n="png",o){return un(this,null,function*(){let s=new Si,h=yield this.getLayersLegendHtml(e,200).toPromise();n=n.toLowerCase(),h.length===0&&(h='<font size="12" face="Courier New" >',h+='<div align="center"><b>NO LEGEND</b></div>');let p=window.document.createElement("div");p.style.position="absolute",p.style.top="0",p.style.zIndex="-1",window.document.body.appendChild(p),p.innerHTML=h,yield this.timeout(1);let m=yield(0,P0.default)(p,{useCORS:!0}).catch(f=>{console.log(f)});if(this.removeHtmlElement(p),m){let f=dn.Done;try{o?this.generateCanvaFileToZip(m,"legendImage."+n):this.saveCanvasImageAsFile(m,"legendImage",n)}catch{f=dn.Error}s.next(f)}return s})}removeHtmlElement(e){e.parentNode.removeChild(e)}getTextPdfObjectSizeAndMarg(e,n,o,s,l,h){let m=h.internal.pageSize.getWidth()-n[1]-n[3];h.setFont(o,l),h.setFontSize(s);let f=h.getTextDimensions(e),g;return f.w>m?(g=0,s=s*.7,h.setFontSize(s),f=h.getTextDimensions(e)):g=(m-f.w)/2,{fontSize:s,marginLeft:g,height:f.h}}addComment(e,n,o,s){o[2]+=s;let l=o[3],h=o[2],p=e.internal.pageSize.height-h+s;this.addTextInPdfDoc(e,n,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,l,p,!0)}addTextInPdfDoc(e,n,o,s,l,h,p,m=!1){e.setFont(o,s),e.setFontSize(l),m&&(n=e.splitTextToSize(n,e.internal.pageSize.getWidth()-h*3)),e.text(n,h,p)}handleFooter(e,n,o,s,l,h){return un(this,null,function*(){let p="",m=this.getAttributionText(e);m&&(p+=m+". "),(o.showProjection===!0||o.showScale===!0)&&(p+=this.getProjScale(e,o,s)),p&&(h[2]+=l);let f=h[3],g=h[2],y=n.internal.pageSize.height-g+l;this.addTextInPdfDoc(n,p,this.TEXTPDFFONT.commentFont,this.TEXTPDFFONT.commentFontStyle,this.TEXTPDFFONT.commentFontSize,f,y)})}getAttributionText(e){let o=e.ol.getOverlayContainerStopEvent().getElementsByClassName("ol-attribution")[0].cloneNode(!0);return o.getElementsByTagName("button")[0].remove(),o.innerText}getProjScale(e,n,o){let s=this.languageService.translate,l="";if(n.showProjection===!0){let h=s.instant("igo.geo.printForm.projection");l+=h+": "+e.projection}if(n.showScale===!0){n.showProjection===!0&&(l+="   ");let h=s.instant("igo.geo.printForm.scale"),p=e.viewController.getScale(o);l+=h+": ~ 1 / "+IP(p)}return l}addLegend(e,n,o,s){return un(this,null,function*(){let l=e.internal.pageSize.width,h=yield this.getLayersLegendHtml(n,l).toPromise();if(h==="")return yield this.saveDoc(e),!0;let p=window.document.createElement("div");p.style.position="absolute",p.style.top="0",p.style.zIndex="-1",window.document.body.appendChild(p),p.innerHTML=h,yield this.timeout(1);let m=yield(0,P0.default)(p,{useCORS:!0}).catch(f=>{console.log(f)});if(this.removeHtmlElement(p),m){let g=[.85*(25.4*m.width)/s,.85*(25.4*m.height)/s];e.addPage();let y=m.toDataURL("image/png");e.addImage(y,"PNG",10,10,g[0],g[1])}yield this.saveDoc(e)})}addLegendSamePage(e,n,o,s,l){return un(this,null,function*(){let h=e.internal.pageSize.width,p=yield this.getLayersLegendHtml(n,h).toPromise();if(p==="")return yield this.saveDoc(e),!0;let m=window.document.createElement("div");m.style.position="absolute",m.style.top="0",m.style.zIndex="-1",window.document.body.appendChild(m),m.innerHTML=p,yield this.timeout(1);let f=yield(0,P0.default)(m,{useCORS:!0}).catch(y=>{console.log(y)});this.removeHtmlElement(m);let g;if(f){let _=[.85*(25.4*f.width)/s,.85*(25.4*f.height)/s];l==="bottomright"?g=[e.internal.pageSize.height-o[2]-_[1],o[1],o[2],e.internal.pageSize.width-o[1]-_[0]]:l==="topright"?g=[o[0],o[1],e.internal.pageSize.height-o[0]-_[1],e.internal.pageSize.width-o[1]-_[0]]:l==="bottomleft"?g=[e.internal.pageSize.height-o[2]-_[1],e.internal.pageSize.width-o[3]-_[0],o[2],o[3]]:l==="topleft"&&(g=[o[0],e.internal.pageSize.width-o[3]-_[0],e.internal.pageSize.height-o[0]-_[1],o[3]]),this.addCanvas(e,f,g),yield this.saveDoc(e)}})}defineNbFileToProcess(e){this.nbFileToProcess=e}timeout(e){return new Promise(n=>setTimeout(n,e))}addCanvas(e,n,o){let s;if(n&&(s=n.toDataURL("image/png")),s!==void 0){if(s.length<20){console.log("Warning: An image cannot be print in pdf file");return}let l=this.getImageSizeToFitPdf(e,n,o);e.addImage(s,"PNG",o[3],o[0],l[0],l[1]),e.rect(o[3],o[0],l[0],l[1]),this.imgSizeAdded=l}}addMap(e,n,o,s,l){let h=n.ol.getSize(),p=n.ol.getView().getResolution(),m=this.setMapResolution(n,s,o,p),f=new Si,g;return n.ol.once("rendercomplete",y=>un(this,null,function*(){let _=y.target.getViewport().getElementsByTagName("canvas"),w=yield this.drawMap(m,_);this.mapPrintExtent=n.viewController.getExtent("EPSG:3857"),this.resetOriginalMapSize(n,h,p),yield this.drawMapControls(n,w);let A=n.status$.subscribe(k=>{if(clearTimeout(g),k!==dn.Done)return;A.unsubscribe();let R=dn.Done;try{w.width!==0&&this.addCanvas(e,w,l)}catch{R=dn.Error,this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}f.next(R)});g=window.setTimeout(()=>{A.unsubscribe();let k=dn.Done;try{w.width!==0&&this.addCanvas(e,w,l)}catch{k=dn.Error,this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}this.resetOriginalMapSize(n,h,p),f.next(k)},200)})),f}setMapResolution(e,n,o,s){let l=e.ol.getSize(),h=Math.round(n[0]*o/25.4),p=Math.round(n[1]*o/25.4),m=[h,p];e.ol.setSize(m);let f=Math.min(h/l[0],p/l[1]);return e.ol.getView().setResolution(s/f),[h,p]}resetOriginalMapSize(e,n,o){e.ol.setSize(n),e.ol.getView().setResolution(o),e.ol.updateSize(),e.ol.renderSync()}drawMap(e,n){return un(this,null,function*(){let o=document.createElement("canvas");o.width=e[0],o.height=e[1];for(let s=0;s<n.length;s++){let l=n[s];l.width>0&&this.handleCanvas(l,o)}return o})}handleCanvas(e,n){let o=n.getContext("2d"),s=e.parentElement.style.opacity||e.style.opacity;o.globalAlpha=s===""?1:Number(s);let l=e.style.transform,h;l?h=l.match(/^matrix\(([^\(]*)\)$/)[1].split(",").map(Number):h=[parseFloat(e.style.width)/e.width,0,0,parseFloat(e.style.height)/e.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(o,h);let p=e.parentElement.style.backgroundColor;p&&(o.fillStyle=p,o.fillRect(0,0,e.width,e.height)),o.drawImage(e,0,0),o.globalAlpha=1,o.setTransform(1,0,0,1,0,0)}drawMapControls(e,n){return un(this,null,function*(){let o=n.getContext("2d"),s=e.ol.getOverlayContainerStopEvent().cloneNode(!0);s.style.width=n.width+"px",s.style.height=n.height+"px",s.style.zIndex="-1",document.getElementsByClassName("ol-viewport")[0].appendChild(s);let l=yield(0,P0.default)(s,{scale:1,backgroundColor:null,allowTaint:!0,useCORS:!0,ignoreElements:h=>h instanceof HTMLElement?h.className.includes("ol-attribution"):!1});l.width!==0&&l.height!==0&&o.drawImage(l,0,0),s.remove()})}addNorthArrowInDoc(e,n,o,s,l,h=0){return un(this,null,function*(){let p=0,m=0;e instanceof CanvasRenderingContext2D?(m=50,p=s==="topright"?0:l-m,e.drawImage(n,p,h,m,m)):(m=16,p=s==="topright"?10:l-o[1],h=o[0],e.addImage(n.toDataURL(),p,h,m,m))})}createNorthDirectionArrow(e){return un(this,null,function*(){let n=this.document.createElement("div");n.style.maxWidth="50mm",n.style.maxHeight="50mm",n.style.textAlign="center";let o=this.document.createElement("img");o.src="./assets/igo2/geo/images/north-direction.png",o.style.maxWidth="50mm",o.style.maxHeight="50mm",o.style.transform="rotate("+e+"rad)",o.style.padding="5mm",n.appendChild(o),this.document.body.appendChild(n);let s=yield(0,P0.default)(n,{backgroundColor:null});if(this.removeHtmlElement(n),s)return s})}downloadMapImage(e,n,o="png",s=!1,l=!1,h="",p="",m="",f=!0,g,y){let _=new Si;this.activityId=this.activityService.register();let w=this.languageService.translate;o=o.toLowerCase();let A=+n,k=e.ol.getSize(),R=e.ol.getView().getResolution();return e.ol.once("rendercomplete",q=>un(this,null,function*(){let X=e.ol.getSize(),ie=q.target.getViewport().getElementsByTagName("canvas"),ae=yield this.drawMap(X,ie);this.resetOriginalMapSize(e,k,R),yield this.drawMapControls(e,ae),g!=="none"&&(["topleft","topright","bottomleft","bottomright"].indexOf(g)>-1?yield this.addLegendToImage(ae,e,A,g,o):g==="newpage"&&(yield this.getLayersLegendImage(e,o,f)));let be=document.createElement("canvas"),me=be.getContext("2d"),fe=0,ge=ae.width,ue=ae.height;me.font="20px Calibri";let se=me.measureText(m).width;ue=h!==""?ue+30:ue,ue=p!==""?ue+30:ue,ue=s!==!1||l!==!1?ue+30:ue;let te=ue-10,Se=Math.ceil(se/ge);ue=m!==""?ue+Se*30:ue;let Te=ue-Se*20+5;if(be.width=ge,be.height=ue,["bmp","gif","jpeg","png","tiff"].indexOf(o)>-1&&(o==="jpeg"||h!==""||p!==""||m!==""||s!==!1||l!==!1)&&(me.fillStyle="#ffffff",me.fillRect(0,0,ge,ue),me.fillStyle="#000000"),h!==""&&(me.font="26px Calibri",fe=30,me.textAlign="center",me.fillText(h,ge/2,20,ge*.9)),p!==""&&(me.font="26px Calibri",fe=60,me.textAlign="center",me.fillText(p,ge/2,50,ge*.9)),me.font="20px Calibri",s!==!1||l!==!1){let Ne="";if(s!==!1&&(Ne=w.instant("igo.geo.printForm.projection")+": "+e.projection+"         "),l!==!1){let ze=w.instant("igo.geo.printForm.scale"),Re=e.viewController.getScale(A);Ne+=ze+": ~ 1 / "+IP(Re)}me.textAlign="center",me.fillText(Ne,ge/2,te,ge*.9)}if(m!=="")if(me.textAlign="center",Se===1)me.fillText(m,ge/2,Te);else{let Ne=m.length,ze=Math.floor(Ne/Se),Re="",Ge=0,He;for(let ye=0;ye<Se;ye++)Se-1>ye?(Re=m.substr(Ge,ze),He=Re.lastIndexOf(" "),me.fillText(Re.substr(0,He),ge/2,Te),Ge+=He,Te+=20):me.fillText(m.substr(Ge),ge/2,Te)}if(me.drawImage(ae,0,fe),y){let Ne=yield this.createNorthDirectionArrow(e.viewController.getRotation());yield this.addNorthArrowInDoc(me,Ne,null,g,ge,fe)}let Ee=dn.Done,je="map."+o;o.toLowerCase()==="tiff"&&(je="map"+e.projection.replace(":","_")+"."+o);try{f?o.toLowerCase()==="tiff"?this.generateCanvaFileToZip(be,je):this.generateCanvaFileToZip(be,je):this.saveCanvasImageAsFile(be,je,o)}catch{Ee=dn.Error}if(_.next(Ee),o.toLowerCase()==="tiff"){let Ne=je.substring(0,je.toLowerCase().indexOf(".tiff"))+".tfw",ze=this.getWorldFileInformation(e),Re=new Blob([ze],{type:"text/plain;charset=utf-8"});f?this.addFileToZip(Ne,Re):((0,QM.saveAs)(Re,Ne),this.saveFileProcessing())}})),this.setMapImageResolution(e,k,A,R),_}setMapImageResolution(e,n,o,s){let l=o/96,h=[Math.round(n[0]*l),Math.round(n[1]*l)];e.ol.setSize(h);let p=Math.min(h[0]/n[0],h[1]/n[1]);e.ol.getView().setResolution(s/p),e.ol.renderSync()}addLegendToImage(e,n,o,s,l){return un(this,null,function*(){let h="map."+l,p=e.getContext("2d"),m=yield this.getLayersLegendHtml(n,e.width).toPromise();if(m==="")return yield this.saveCanvasImageAsFile(e,h,l),!0;let f=window.document.createElement("div");f.style.position="absolute",f.style.top="0",f.style.zIndex="-1",window.document.body.appendChild(f),f.innerHTML=m,yield this.timeout(1);let g=yield(0,P0.default)(f,{useCORS:!0}).catch(y=>{console.log(y)});if(g){let y=e.height,_=e.width,w=g.height,A=g.width,k=y*.01,R,q;return s==="bottomright"?(R=_-A-k,q=y-w-k):s==="topright"?(R=_-A-k,q=k):s==="bottomleft"?(R=k,q=y-w-k-15):s==="topleft"&&(R=k,q=k),p.drawImage(g,R,q,A,w),p.strokeRect(R,q,A,w),this.removeHtmlElement(f),!0}})}saveDoc(e){return un(this,null,function*(){yield e.save("map_georef.pdf",{returnPromise:!0})})}getImageSizeToFitPdf(e,n,o){let s=e.internal.pageSize.getHeight()-(o[0]+o[2]),l=e.internal.pageSize.getWidth()-(o[1]+o[3]),h=this.pdf_units2points(n.height,"mm"),p=this.pdf_units2points(n.width,"mm"),m=h/s,f=p/l,g=m>f?m:f,y=g>1?h/g:h;return[g>1?p/g:p,y]}getWorldFileInformation(e){let n=e.viewController.getResolution(),o=e.viewController.getExtent();return[n,0,0,-n,o[0]+n/.5,o[3]-n/.5].join(`
`)}saveCanvasImageAsFile(e,n,o){let s="image/"+o;try{e.toDataURL(),e.toBlob(l=>{(0,QM.saveAs)(l,n),this.saveFileProcessing()},s)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}generateCanvaFileToZip(e,n){let o="image/jpeg";(!this.hasOwnProperty("zipFile")||typeof this.zipFile>"u")&&(this.zipFile=new qU.default);try{e.toDataURL(),navigator.msSaveBlob?this.addFileToZip(n,e.msToBlob()):e.toBlob(s=>{this.addFileToZip(n,s)},o)}catch{this.messageService.error("igo.geo.printForm.corsErrorMessageBody","igo.geo.printForm.corsErrorMessageHeader")}}addFileToZip(e,n){this.zipFile.file(e,n),this.nbFileToProcess--,this.nbFileToProcess===0&&(this.getZipFile(),this.activityService.unregister(this.activityId))}saveFileProcessing(){this.nbFileToProcess--,this.nbFileToProcess===0&&this.activityService.unregister(this.activityId)}getZipFile(){this.zipFile.generateAsync({type:"blob"}).then(e=>{(0,QM.saveAs)(e,"map.zip"),delete this.zipFile})}pdf_units2points(e,n){let o=1;switch(n){case"pt":o=1;break;case"mm":o=72/25.4;break;case"cm":o=72/2.54;break;case"in":o=72;break;case"px":o=96/72;break;case"pc":o=12;break;case"em":o=12;break;case"ex":o=6;break;default:throw new Error("Invalid unit: "+n)}return e*o}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Gn),pt(Wf),pt(Di),pt(Oi),pt(rc))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var L0=class{};var k0=class{sources;constructor(i){this.sources=i}};function Wse(r){return new k0(r)}function ZU(){return{provide:k0,useFactory:Wse,deps:[L0]}}var ZL=class{constructor(i){this.propagationStopped,this.defaultPrevented,this.type=i,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var To=ZL;var Ap={PROPERTYCHANGE:"propertychange"};var XL=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},_v=XL;function KU(r,i,e){let n,o;e=e||iu;let s=0,l=r.length,h=!1;for(;s<l;)n=s+(l-s>>1),o=+e(r[n],i),o<0?s=n+1:(l=n,h=!o);return h?s:~s}function iu(r,i){return r>i?1:r<i?-1:0}function O0(r,i,e){if(r[0]<=i)return 0;let n=r.length;if(i<=r[n-1])return n-1;if(typeof e=="function"){for(let o=1;o<n;++o){let s=r[o];if(s===i)return o;if(s<i)return e(i,r[o-1],s)>0?o-1:o}return n-1}if(e>0){for(let o=1;o<n;++o)if(r[o]<i)return o-1;return n-1}if(e<0){for(let o=1;o<n;++o)if(r[o]<=i)return o;return n-1}for(let o=1;o<n;++o){if(r[o]==i)return o;if(r[o]<i)return r[o-1]-i<i-r[o]?o-1:o}return n-1}function QU(r,i,e){for(;i<e;){let n=r[i];r[i]=r[e],r[e]=n,++i,--e}}function Cr(r,i){let e=Array.isArray(i)?i:[i],n=e.length;for(let o=0;o<n;o++)r[r.length]=e[o]}function pc(r,i){let e=r.length;if(e!==i.length)return!1;for(let n=0;n<e;n++)if(r[n]!==i[n])return!1;return!0}function JU(r,i,e){let n=i||iu;return r.every(function(o,s){if(s===0)return!0;let l=n(r[s-1],o);return!(l>0||e&&l===0)})}function Tc(){return!0}function Gh(){return!1}function Mp(){}function eI(r){let i=!1,e,n,o;return function(){let s=Array.prototype.slice.call(arguments);return(!i||this!==o||!pc(s,n))&&(i=!0,o=this,n=s,e=r.apply(this,arguments)),e}}function yv(r){function i(){let e;try{e=r()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return i()}var KL=class extends _v{constructor(i){super(),this.eventTarget_=i,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(i,e){if(!i||!e)return;let n=this.listeners_||(this.listeners_={}),o=n[i]||(n[i]=[]);o.includes(e)||o.push(e)}dispatchEvent(i){let e=typeof i=="string",n=e?i:i.type,o=this.listeners_&&this.listeners_[n];if(!o)return;let s=e?new To(i):i;s.target||(s.target=this.eventTarget_||this);let l=this.dispatching_||(this.dispatching_={}),h=this.pendingRemovals_||(this.pendingRemovals_={});n in l||(l[n]=0,h[n]=0),++l[n];let p;for(let m=0,f=o.length;m<f;++m)if("handleEvent"in o[m]?p=o[m].handleEvent(s):p=o[m].call(this,s),p===!1||s.propagationStopped){p=!1;break}if(--l[n]===0){let m=h[n];for(delete h[n];m--;)this.removeEventListener(n,Mp);delete l[n]}return p}disposeInternal(){this.listeners_&&Dh(this.listeners_)}getListeners(i){return this.listeners_&&this.listeners_[i]||void 0}hasListener(i){return this.listeners_?i?i in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(i,e){if(!this.listeners_)return;let n=this.listeners_[i];if(!n)return;let o=n.indexOf(e);o!==-1&&(this.pendingRemovals_&&i in this.pendingRemovals_?(n[o]=Mp,++this.pendingRemovals_[i]):(n.splice(o,1),n.length===0&&delete this.listeners_[i]))}},km=KL;var mi={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Vr(r,i,e,n,o){if(n&&n!==r&&(e=e.bind(n)),o){let l=e;e=function(){r.removeEventListener(i,e),l.apply(this,arguments)}}let s={target:r,type:i,listener:e};return r.addEventListener(i,e),s}function vv(r,i,e,n){return Vr(r,i,e,n,!0)}function wn(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),Dh(r))}var bv=class extends km{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(mi.CHANGE)}getRevision(){return this.revision_}onInternal(i,e){if(Array.isArray(i)){let n=i.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=Vr(this,i[s],e);return o}return Vr(this,i,e)}onceInternal(i,e){let n;if(Array.isArray(i)){let o=i.length;n=new Array(o);for(let s=0;s<o;++s)n[s]=vv(this,i[s],e)}else n=vv(this,i,e);return e.ol_key=n,n}unInternal(i,e){let n=e.ol_key;if(n)io(n);else if(Array.isArray(i))for(let o=0,s=i.length;o<s;++o)this.removeEventListener(i[o],e);else this.removeEventListener(i,e)}};bv.prototype.on;bv.prototype.once;bv.prototype.un;function io(r){if(Array.isArray(r))for(let i=0,e=r.length;i<e;++i)wn(r[i]);else wn(r)}var tI=bv;function Ti(){throw new Error("Unimplemented abstract method.")}var qse=0;function fi(r){return r.ol_uid||(r.ol_uid=String(++qse))}var iI=class extends To{constructor(i,e,n){super(i),this.key=e,this.oldValue=n}},QL=class extends tI{constructor(i){super(),this.on,this.once,this.un,fi(this),this.values_=null,i!==void 0&&this.setProperties(i)}get(i){let e;return this.values_&&this.values_.hasOwnProperty(i)&&(e=this.values_[i]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(i,e){let n;n=`change:${i}`,this.hasListener(n)&&this.dispatchEvent(new iI(n,i,e)),n=Ap.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new iI(n,i,e))}addChangeListener(i,e){this.addEventListener(`change:${i}`,e)}removeChangeListener(i,e){this.removeEventListener(`change:${i}`,e)}set(i,e,n){let o=this.values_||(this.values_={});if(n)o[i]=e;else{let s=o[i];o[i]=e,s!==e&&this.notify(i,s)}}setProperties(i,e){for(let n in i)this.set(n,i[n],e)}applyProperties(i){i.values_&&Object.assign(this.values_||(this.values_={}),i.values_)}unset(i,e){if(this.values_&&i in this.values_){let n=this.values_[i];delete this.values_[i],Bl(this.values_)&&(this.values_=null),e||this.notify(i,n)}}},ls=QL;function Hi(r,i){if(!r)throw new Error(i)}var JL=class r extends ls{constructor(i){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),i)if(typeof i.getSimplifiedGeometry=="function"){let e=i;this.setGeometry(e)}else{let e=i;this.setProperties(e)}}clone(){let i=new r(this.hasProperties()?this.getProperties():null);i.setGeometryName(this.getGeometryName());let e=this.getGeometry();e&&i.setGeometry(e.clone());let n=this.getStyle();return n&&i.setStyle(n),i}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(wn(this.geometryChangeKey_),this.geometryChangeKey_=null);let i=this.getGeometry();i&&(this.geometryChangeKey_=Vr(i,mi.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(i){this.set(this.geometryName_,i)}setStyle(i){this.style_=i,this.styleFunction_=i?Yse(i):void 0,this.changed()}setId(i){this.id_=i,this.changed()}setGeometryName(i){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=i,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function Yse(r){if(typeof r=="function")return r;let i;return Array.isArray(r)?i=r:(Hi(typeof r.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),i=[r]),function(){return i}}var gi=JL;var tz=new Array(6);function el(){return[1,0,0,1,0,0]}function ek(r){return tk(r,1,0,0,1,0,0)}function wv(r,i){let e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],h=r[5],p=i[0],m=i[1],f=i[2],g=i[3],y=i[4],_=i[5];return r[0]=e*p+o*m,r[1]=n*p+s*m,r[2]=e*f+o*g,r[3]=n*f+s*g,r[4]=e*y+o*_+l,r[5]=n*y+s*_+h,r}function tk(r,i,e,n,o,s,l){return r[0]=i,r[1]=e,r[2]=n,r[3]=o,r[4]=s,r[5]=l,r}function iz(r,i){return r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r}function $o(r,i){let e=i[0],n=i[1];return i[0]=r[0]*e+r[2]*n+r[4],i[1]=r[1]*e+r[3]*n+r[5],i}function xv(r,i,e){return wv(r,tk(tz,i,0,0,e,0,0))}function rz(r,i,e){return wv(r,tk(tz,1,0,0,1,i,e))}function Ns(r,i,e,n,o,s,l,h){let p=Math.sin(s),m=Math.cos(s);return r[0]=n*m,r[1]=o*p,r[2]=-n*p,r[3]=o*m,r[4]=l*n*m-h*n*p+i,r[5]=l*o*p+h*o*m+e,r}function D0(r,i){let e=Zse(i);Hi(e!==0,"Transformation matrix cannot be inverted");let n=i[0],o=i[1],s=i[2],l=i[3],h=i[4],p=i[5];return r[0]=l/e,r[1]=-o/e,r[2]=-s/e,r[3]=n/e,r[4]=(s*p-l*h)/e,r[5]=-(n*p-o*h)/e,r}function Zse(r){return r[0]*r[3]-r[1]*r[2]}var ez=[1e6,1e6,1e6,1e6,2,2];function Sv(r){return"matrix("+r.map((e,n)=>Math.round(e*ez[n])/ez[n]).join(", ")+")"}function ud(r,i,e,n,o,s){s=s||[];let l=0;for(let h=i;h<e;h+=n){let p=r[h],m=r[h+1];s[l++]=o[0]*p+o[2]*m+o[4],s[l++]=o[1]*p+o[3]*m+o[5]}return s&&s.length!=l&&(s.length=l),s}function Cv(r,i,e,n,o,s,l){l=l||[];let h=Math.cos(o),p=Math.sin(o),m=s[0],f=s[1],g=0;for(let y=i;y<e;y+=n){let _=r[y]-m,w=r[y+1]-f;l[g++]=m+_*h-w*p,l[g++]=f+_*p+w*h;for(let A=y+2;A<y+n;++A)l[g++]=r[A]}return l&&l.length!=g&&(l.length=g),l}function nz(r,i,e,n,o,s,l,h){h=h||[];let p=l[0],m=l[1],f=0;for(let g=i;g<e;g+=n){let y=r[g]-p,_=r[g+1]-m;h[f++]=p+o*y,h[f++]=m+s*_;for(let w=g+2;w<g+n;++w)h[f++]=r[w]}return h&&h.length!=f&&(h.length=f),h}function oz(r,i,e,n,o,s,l){l=l||[];let h=0;for(let p=i;p<e;p+=n){l[h++]=r[p]+o,l[h++]=r[p+1]+s;for(let m=p+2;m<p+n;++m)l[h++]=r[m]}return l&&l.length!=h&&(l.length=h),l}var az=el(),ik=class extends ls{constructor(){super(),this.extent_=Wn(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=eI((i,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);let o=this.clone();return o.applyTransform(n),o.getSimplifiedGeometry(e)})}simplifyTransformed(i,e){return this.simplifyTransformedInternal(this.getRevision(),i,e)}clone(){return Ti()}closestPointXY(i,e,n,o){return Ti()}containsXY(i,e){let n=this.getClosestPoint([i,e]);return n[0]===i&&n[1]===e}getClosestPoint(i,e){return e=e||[NaN,NaN],this.closestPointXY(i[0],i[1],e,1/0),e}intersectsCoordinate(i){return this.containsXY(i[0],i[1])}computeExtent(i){return Ti()}getExtent(i){if(this.extentRevision_!=this.getRevision()){let e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Uf(e),this.extentRevision_=this.getRevision()}return F9(this.extent_,i)}rotate(i,e){Ti()}scale(i,e,n){Ti()}simplify(i){return this.getSimplifiedGeometry(i*i)}getSimplifiedGeometry(i){return Ti()}getType(){return Ti()}applyTransform(i){Ti()}intersectsExtent(i){return Ti()}translate(i,e){Ti()}transform(i,e){let n=ni(i),o=n.getUnits()=="tile-pixels"?function(s,l,h){let p=n.getExtent(),m=n.getWorldExtent(),f=Hn(m)/Hn(p);return Ns(az,m[0],m[3],f,-f,0,0,0),ud(s,0,s.length,h,az,l),zf(n,e)(s,l,h)}:zf(n,e);return this.applyTransform(o),this}},Av=ik;var rk=class extends Av{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(i){return W1(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}getCoordinates(){return Ti()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(i){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),i<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&i<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;let e=this.getSimplifiedGeometryInternal(i);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=i,this)}getSimplifiedGeometryInternal(i){return this}getStride(){return this.stride}setFlatCoordinates(i,e){this.stride=wy(i),this.layout=i,this.flatCoordinates=e}setCoordinates(i,e){Ti()}setLayout(i,e,n){let o;if(i)o=wy(i);else{for(let s=0;s<n;++s){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}o=e.length,i=R0(o)}this.layout=i,this.stride=o}applyTransform(i){this.flatCoordinates&&(i(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(i,e){let n=this.getFlatCoordinates();if(n){let o=this.getStride();Cv(n,0,n.length,o,i,e,n),this.changed()}}scale(i,e,n){e===void 0&&(e=i),n||(n=as(this.getExtent()));let o=this.getFlatCoordinates();if(o){let s=this.getStride();nz(o,0,o.length,s,i,e,n,o),this.changed()}}translate(i,e){let n=this.getFlatCoordinates();if(n){let o=this.getStride();oz(n,0,n.length,o,i,e,n),this.changed()}}};function R0(r){let i;return r==2?i="XY":r==3?i="XYZ":r==4&&(i="XYZM"),i}function wy(r){let i;return r=="XY"?i=2:r=="XYZ"||r=="XYM"?i=3:r=="XYZM"&&(i=4),i}function sz(r,i,e){let n=r.getFlatCoordinates();if(!n)return null;let o=r.getStride();return ud(n,0,n.length,o,i,e)}var Vl=rk;function rI(r,i,e,n){for(let o=0,s=e.length;o<s;++o)r[i++]=e[o];return i}function Jf(r,i,e,n){for(let o=0,s=e.length;o<s;++o){let l=e[o];for(let h=0;h<n;++h)r[i++]=l[h]}return i}function N0(r,i,e,n,o){o=o||[];let s=0;for(let l=0,h=e.length;l<h;++l){let p=Jf(r,i,e[l],n);o[s++]=p,i=p}return o.length=s,o}function nI(r,i,e,n,o){o=o||[];let s=0;for(let l=0,h=e.length;l<h;++l){let p=N0(r,i,e[l],n,o[s]);p.length===0&&(p[0]=i),o[s++]=p,i=p[p.length-1]}return o.length=s,o}var oI=class r extends Vl{constructor(i,e,n){super(),n!==void 0&&e===void 0?this.setFlatCoordinates(n,i):(e=e||0,this.setCenterAndRadius(i,e,n))}clone(){let i=new r(this.flatCoordinates.slice(),void 0,this.layout);return i.applyProperties(this),i}closestPointXY(i,e,n,o){let s=this.flatCoordinates,l=i-s[0],h=e-s[1],p=l*l+h*h;if(p<o){if(p===0)for(let m=0;m<this.stride;++m)n[m]=s[m];else{let m=this.getRadius()/Math.sqrt(p);n[0]=s[0]+m*l,n[1]=s[1]+m*h;for(let f=2;f<this.stride;++f)n[f]=s[f]}return n.length=this.stride,p}return o}containsXY(i,e){let n=this.flatCoordinates,o=i-n[0],s=e-n[1];return o*o+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(i){let e=this.flatCoordinates,n=e[this.stride]-e[0];return jl(e[0]-n,e[1]-n,e[0]+n,e[1]+n,i)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){let i=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return i*i+e*e}getType(){return"Circle"}intersectsExtent(i){let e=this.getExtent();if(On(i,e)){let n=this.getCenter();return i[0]<=n[0]&&i[2]>=n[0]||i[1]<=n[1]&&i[3]>=n[1]?!0:H1(i,this.intersectsCoordinate.bind(this))}return!1}setCenter(i){let e=this.stride,n=this.flatCoordinates[e]-this.flatCoordinates[0],o=i.slice();o[e]=o[0]+n;for(let s=1;s<e;++s)o[e+s]=i[s];this.setFlatCoordinates(this.layout,o),this.changed()}setCenterAndRadius(i,e,n){this.setLayout(n,i,0),this.flatCoordinates||(this.flatCoordinates=[]);let o=this.flatCoordinates,s=rI(o,0,i,this.stride);o[s++]=o[0]+e;for(let l=1,h=this.stride;l<h;++l)o[s++]=o[l];o.length=s,this.changed()}getCoordinates(){return null}setCoordinates(i,e){}setRadius(i){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+i,this.changed()}rotate(i,e){let n=this.getCenter(),o=this.getStride();this.setCenter(Cv(n,0,n.length,o,i,e,n)),this.changed()}};oI.prototype.transform;var Tu=oI;var ok=class r extends Av{constructor(i){super(),this.geometries_=i,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(wn),this.changeEventsKeys_.length=0}listenGeometriesChange_(){let i=this.geometries_;for(let e=0,n=i.length;e<n;++e)this.changeEventsKeys_.push(Vr(i[e],mi.CHANGE,this.changed,this))}clone(){let i=new r(nk(this.geometries_));return i.applyProperties(this),i}closestPointXY(i,e,n,o){if(o<rd(this.getExtent(),i,e))return o;let s=this.geometries_;for(let l=0,h=s.length;l<h;++l)o=s[l].closestPointXY(i,e,n,o);return o}containsXY(i,e){let n=this.geometries_;for(let o=0,s=n.length;o<s;++o)if(n[o].containsXY(i,e))return!0;return!1}computeExtent(i){Uf(i);let e=this.geometries_;for(let n=0,o=e.length;n<o;++n)Hd(i,e[n].getExtent());return i}getGeometries(){return nk(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let i=[],e=this.geometries_;for(let n=0,o=e.length;n<o;++n)e[n].getType()===this.getType()?i=i.concat(e[n].getGeometriesArrayRecursive()):i.push(e[n]);return i}getSimplifiedGeometry(i){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),i<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&i<this.simplifiedGeometryMaxMinSquaredTolerance)return this;let e=[],n=this.geometries_,o=!1;for(let s=0,l=n.length;s<l;++s){let h=n[s],p=h.getSimplifiedGeometry(i);e.push(p),p!==h&&(o=!0)}return o?new r(e):(this.simplifiedGeometryMaxMinSquaredTolerance=i,this)}getType(){return"GeometryCollection"}intersectsExtent(i){let e=this.geometries_;for(let n=0,o=e.length;n<o;++n)if(e[n].intersectsExtent(i))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(i,e){let n=this.geometries_;for(let o=0,s=n.length;o<s;++o)n[o].rotate(i,e);this.changed()}scale(i,e,n){n||(n=as(this.getExtent()));let o=this.geometries_;for(let s=0,l=o.length;s<l;++s)o[s].scale(i,e,n);this.changed()}setGeometries(i){this.setGeometriesArray(nk(i))}setGeometriesArray(i){this.unlistenGeometriesChange_(),this.geometries_=i,this.listenGeometriesChange_(),this.changed()}applyTransform(i){let e=this.geometries_;for(let n=0,o=e.length;n<o;++n)e[n].applyTransform(i);this.changed()}translate(i,e){let n=this.geometries_;for(let o=0,s=n.length;o<s;++o)n[o].translate(i,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function nk(r){return r.map(i=>i.clone())}var _s=ok;function lz(r,i,e,n,o,s,l){let h=r[i],p=r[i+1],m=r[e]-h,f=r[e+1]-p,g;if(m===0&&f===0)g=i;else{let y=((o-h)*m+(s-p)*f)/(m*m+f*f);if(y>1)g=e;else if(y>0){for(let _=0;_<n;++_)l[_]=Ic(r[i+_],r[e+_],y);l.length=n;return}else g=i}for(let y=0;y<n;++y)l[y]=r[g+y];l.length=n}function aS(r,i,e,n,o){let s=r[i],l=r[i+1];for(i+=n;i<e;i+=n){let h=r[i],p=r[i+1],m=od(s,l,h,p);m>o&&(o=m),s=h,l=p}return o}function sS(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s){let h=e[s];o=aS(r,i,h,n,o),i=h}return o}function cz(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s){let h=e[s];o=sS(r,i,h,n,o),i=h[h.length-1]}return o}function lS(r,i,e,n,o,s,l,h,p,m,f){if(i==e)return m;let g,y;if(o===0){if(y=od(l,h,r[i],r[i+1]),y<m){for(g=0;g<n;++g)p[g]=r[i+g];return p.length=n,y}return m}f=f||[NaN,NaN];let _=i+n;for(;_<e;)if(lz(r,_-n,_,n,l,h,f),y=od(l,h,f[0],f[1]),y<m){for(m=y,g=0;g<n;++g)p[g]=f[g];p.length=n,_+=n}else _+=n*Math.max((Math.sqrt(y)-Math.sqrt(m))/o|0,1);if(s&&(lz(r,e-n,i,n,l,h,f),y=od(l,h,f[0],f[1]),y<m)){for(m=y,g=0;g<n;++g)p[g]=f[g];p.length=n}return m}function cS(r,i,e,n,o,s,l,h,p,m,f){f=f||[NaN,NaN];for(let g=0,y=e.length;g<y;++g){let _=e[g];m=lS(r,i,_,n,o,s,l,h,p,m,f),i=_}return m}function uz(r,i,e,n,o,s,l,h,p,m,f){f=f||[NaN,NaN];for(let g=0,y=e.length;g<y;++g){let _=e[g];m=cS(r,i,_,n,o,s,l,h,p,m,f),i=_[_.length-1]}return m}function xy(r,i,e,n,o,s,l){let h=(e-i)/n;if(h<3){for(;i<e;i+=n)s[l++]=r[i],s[l++]=r[i+1];return l}let p=new Array(h);p[0]=1,p[h-1]=1;let m=[i,e-n],f=0;for(;m.length>0;){let g=m.pop(),y=m.pop(),_=0,w=r[y],A=r[y+1],k=r[g],R=r[g+1];for(let q=y+n;q<g;q+=n){let X=r[q],ie=r[q+1],ae=O9(X,ie,w,A,k,R);ae>_&&(f=q,_=ae)}_>o&&(p[(f-i)/n]=1,y+n<f&&m.push(y,f),f+n<g&&m.push(f,g))}for(let g=0;g<h;++g)p[g]&&(s[l++]=r[i+g*n],s[l++]=r[i+g*n+1]);return l}function aI(r,i,e,n,o,s,l,h){for(let p=0,m=e.length;p<m;++p){let f=e[p];l=xy(r,i,f,n,o,s,l),h.push(l),i=f}return l}function B0(r,i){return i*Math.round(r/i)}function Xse(r,i,e,n,o,s,l){if(i==e)return l;let h=B0(r[i],o),p=B0(r[i+1],o);i+=n,s[l++]=h,s[l++]=p;let m,f;do if(m=B0(r[i],o),f=B0(r[i+1],o),i+=n,i==e)return s[l++]=m,s[l++]=f,l;while(m==h&&f==p);for(;i<e;){let g=B0(r[i],o),y=B0(r[i+1],o);if(i+=n,g==m&&y==f)continue;let _=m-h,w=f-p,A=g-h,k=y-p;if(_*k==w*A&&(_<0&&A<_||_==A||_>0&&A>_)&&(w<0&&k<w||w==k||w>0&&k>w)){m=g,f=y;continue}s[l++]=m,s[l++]=f,h=m,p=f,m=g,f=y}return s[l++]=m,s[l++]=f,l}function uS(r,i,e,n,o,s,l,h){for(let p=0,m=e.length;p<m;++p){let f=e[p];l=Xse(r,i,f,n,o,s,l),h.push(l),i=f}return l}function dz(r,i,e,n,o,s,l,h){for(let p=0,m=e.length;p<m;++p){let f=e[p],g=[];l=uS(r,i,f,n,o,s,l,g),h.push(g),i=f[f.length-1]}return l}function dd(r,i,e,n,o){o=o!==void 0?o:[];let s=0;for(let l=i;l<e;l+=n)o[s++]=r.slice(l,l+n);return o.length=s,o}function G0(r,i,e,n,o){o=o!==void 0?o:[];let s=0;for(let l=0,h=e.length;l<h;++l){let p=e[l];o[s++]=dd(r,i,p,n,o[s]),i=p}return o.length=s,o}function dS(r,i,e,n,o){o=o!==void 0?o:[];let s=0;for(let l=0,h=e.length;l<h;++l){let p=e[l];o[s++]=p.length===1&&p[0]===i?[]:G0(r,i,p,n,o[s]),i=p[p.length-1]}return o.length=s,o}function ak(r,i,e,n){let o=0,s=r[e-n],l=r[e-n+1];for(;i<e;i+=n){let h=r[i],p=r[i+1];o+=l*h-s*p,s=h,l=p}return o/2}function sk(r,i,e,n){let o=0;for(let s=0,l=e.length;s<l;++s){let h=e[s];o+=ak(r,i,h,n),i=h}return o}function hz(r,i,e,n){let o=0;for(let s=0,l=e.length;s<l;++s){let h=e[s];o+=sk(r,i,h,n),i=h[h.length-1]}return o}var lk=class r extends Vl{constructor(i,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(i[0])?this.setFlatCoordinates(e,i):this.setCoordinates(i,e)}clone(){return new r(this.flatCoordinates.slice(),this.layout)}closestPointXY(i,e,n,o){return o<rd(this.getExtent(),i,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(aS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,i,e,n,o))}getArea(){return ak(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(i){let e=[];return e.length=xy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,e,0),new r(e,"XY")}getType(){return"LinearRing"}intersectsExtent(i){return!1}setCoordinates(i,e){this.setLayout(e,i,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,i,this.stride),this.changed()}},Om=lk;function sI(r,i,e,n,o){let s;for(i+=n;i<e;i+=n)if(s=o(r.slice(i-n,i),r.slice(i,i+n)),s)return s;return!1}function Sy(r,i,e,n,o,s,l){let h,p,m=(e-i)/n;if(m===1)h=i;else if(m===2)h=i,p=o;else if(m!==0){let f=r[i],g=r[i+1],y=0,_=[0];for(let k=i+n;k<e;k+=n){let R=r[k],q=r[k+1];y+=Math.sqrt((R-f)*(R-f)+(q-g)*(q-g)),_.push(y),f=R,g=q}let w=o*y,A=KU(_,w);A<0?(p=(w-_[-A-2])/(_[-A-1]-_[-A-2]),h=i+(-A-2)*n):h=i+A*n}l=l>1?l:2,s=s||new Array(l);for(let f=0;f<l;++f)s[f]=h===void 0?NaN:p===void 0?r[h+f]:Ic(r[h+f],r[h+n+f],p);return s}function lI(r,i,e,n,o,s){if(e==i)return null;let l;if(o<r[i+n-1])return s?(l=r.slice(i,i+n),l[n-1]=o,l):null;if(r[e-1]<o)return s?(l=r.slice(e-n,e),l[n-1]=o,l):null;if(o==r[i+n-1])return r.slice(i,i+n);let h=i/n,p=e/n;for(;h<p;){let y=h+p>>1;o<r[(y+1)*n-1]?p=y:h=y+1}let m=r[h*n-1];if(o==m)return r.slice((h-1)*n,(h-1)*n+n);let f=r[(h+1)*n-1],g=(o-m)/(f-m);l=[];for(let y=0;y<n-1;++y)l.push(Ic(r[(h-1)*n+y],r[h*n+y],g));return l.push(o),l}function pz(r,i,e,n,o,s,l){if(l)return lI(r,i,e[e.length-1],n,o,s);let h;if(o<r[n-1])return s?(h=r.slice(0,n),h[n-1]=o,h):null;if(r[r.length-1]<o)return s?(h=r.slice(r.length-n),h[n-1]=o,h):null;for(let p=0,m=e.length;p<m;++p){let f=e[p];if(i!=f){if(o<r[i+n-1])return null;if(o<=r[f-1])return lI(r,i,f,n,o,!1);i=f}}return null}function mz(r,i,e,n,o){return!H1(o,function(l){return!j0(r,i,e,n,l[0],l[1])})}function j0(r,i,e,n,o,s){let l=0,h=r[e-n],p=r[e-n+1];for(;i<e;i+=n){let m=r[i],f=r[i+1];p<=s?f>s&&(m-h)*(s-p)-(o-h)*(f-p)>0&&l++:f<=s&&(m-h)*(s-p)-(o-h)*(f-p)<0&&l--,h=m,p=f}return l!==0}function hS(r,i,e,n,o,s){if(e.length===0||!j0(r,i,e[0],n,o,s))return!1;for(let l=1,h=e.length;l<h;++l)if(j0(r,e[l-1],e[l],n,o,s))return!1;return!0}function fz(r,i,e,n,o,s){if(e.length===0)return!1;for(let l=0,h=e.length;l<h;++l){let p=e[l];if(hS(r,i,p,n,o,s))return!0;i=p[p.length-1]}return!1}function pS(r,i,e,n,o){let s=mP(Wn(),r,i,e,n);return On(o,s)?Pa(o,s)||s[0]>=o[0]&&s[2]<=o[2]||s[1]>=o[1]&&s[3]<=o[3]?!0:sI(r,i,e,n,function(l,h){return P9(o,l,h)}):!1}function gz(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s){if(pS(r,i,e[s],n,o))return!0;i=e[s]}return!1}function ck(r,i,e,n,o){return!!(pS(r,i,e,n,o)||j0(r,i,e,n,o[0],o[1])||j0(r,i,e,n,o[0],o[3])||j0(r,i,e,n,o[2],o[1])||j0(r,i,e,n,o[2],o[3]))}function uk(r,i,e,n,o){if(!ck(r,i,e[0],n,o))return!1;if(e.length===1)return!0;for(let s=1,l=e.length;s<l;++s)if(mz(r,e[s-1],e[s],n,o)&&!pS(r,e[s-1],e[s],n,o))return!1;return!0}function _z(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s){let h=e[s];if(uk(r,i,h,n,o))return!0;i=h[h.length-1]}return!1}function cI(r,i,e,n){let o=r[i],s=r[i+1],l=0;for(let h=i+n;h<e;h+=n){let p=r[h],m=r[h+1];l+=Math.sqrt((p-o)*(p-o)+(m-s)*(m-s)),o=p,s=m}return l}var dk=class r extends Vl{constructor(i,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(i[0])?this.setFlatCoordinates(e,i):this.setCoordinates(i,e)}appendCoordinate(i){Cr(this.flatCoordinates,i),this.changed()}clone(){let i=new r(this.flatCoordinates.slice(),this.layout);return i.applyProperties(this),i}closestPointXY(i,e,n,o){return o<rd(this.getExtent(),i,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(aS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),lS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,i,e,n,o))}forEachSegment(i){return sI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}getCoordinateAtM(i,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,lI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,e))}getCoordinates(){return dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(i,e){return Sy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,e,this.stride)}getLength(){return cI(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(i){let e=[];return e.length=xy(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i,e,0),new r(e,"XY")}getType(){return"LineString"}intersectsExtent(i){return pS(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,i)}setCoordinates(i,e){this.setLayout(e,i,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,i,this.stride),this.changed()}},Tr=dk;var hk=class r extends Vl{constructor(i,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(i[0]))this.setCoordinates(i,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,i),this.ends_=n;else{let o=i,s=[],l=[];for(let p=0,m=o.length;p<m;++p){let f=o[p];Cr(s,f.getFlatCoordinates()),l.push(s.length)}let h=o.length===0?this.getLayout():o[0].getLayout();this.setFlatCoordinates(h,s),this.ends_=l}}appendLineString(i){Cr(this.flatCoordinates,i.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let i=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return i.applyProperties(this),i}closestPointXY(i,e,n,o){return o<rd(this.getExtent(),i,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(sS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),cS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,i,e,n,o))}getCoordinateAtM(i,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,pz(this.flatCoordinates,0,this.ends_,this.stride,i,e,n))}getCoordinates(){return G0(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(i){return i<0||this.ends_.length<=i?null:new Tr(this.flatCoordinates.slice(i===0?0:this.ends_[i-1],this.ends_[i]),this.layout)}getLineStrings(){let i=this.flatCoordinates,e=this.ends_,n=this.layout,o=[],s=0;for(let l=0,h=e.length;l<h;++l){let p=e[l],m=new Tr(i.slice(s,p),n);o.push(m),s=p}return o}getFlatMidpoints(){let i=[],e=this.flatCoordinates,n=0,o=this.ends_,s=this.stride;for(let l=0,h=o.length;l<h;++l){let p=o[l],m=Sy(e,n,p,s,.5);Cr(i,m),n=p}return i}getSimplifiedGeometryInternal(i){let e=[],n=[];return e.length=aI(this.flatCoordinates,0,this.ends_,this.stride,i,e,0,n),new r(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(i){return gz(this.flatCoordinates,0,this.ends_,this.stride,i)}setCoordinates(i,e){this.setLayout(e,i,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=N0(this.flatCoordinates,0,i,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},Ko=hk;var pk=class r extends Vl{constructor(i,e){super(),this.setCoordinates(i,e)}clone(){let i=new r(this.flatCoordinates.slice(),this.layout);return i.applyProperties(this),i}closestPointXY(i,e,n,o){let s=this.flatCoordinates,l=od(i,e,s[0],s[1]);if(l<o){let h=this.stride;for(let p=0;p<h;++p)n[p]=s[p];return n.length=h,l}return o}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(i){return Sm(this.flatCoordinates,i)}getType(){return"Point"}intersectsExtent(i){return Px(i,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(i,e){this.setLayout(e,i,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=rI(this.flatCoordinates,0,i,this.stride),this.changed()}},Ii=pk;var mk=class r extends Vl{constructor(i,e){super(),e&&!Array.isArray(i[0])?this.setFlatCoordinates(e,i):this.setCoordinates(i,e)}appendPoint(i){Cr(this.flatCoordinates,i.getFlatCoordinates()),this.changed()}clone(){let i=new r(this.flatCoordinates.slice(),this.layout);return i.applyProperties(this),i}closestPointXY(i,e,n,o){if(o<rd(this.getExtent(),i,e))return o;let s=this.flatCoordinates,l=this.stride;for(let h=0,p=s.length;h<p;h+=l){let m=od(i,e,s[h],s[h+1]);if(m<o){o=m;for(let f=0;f<l;++f)n[f]=s[h+f];n.length=l}}return o}getCoordinates(){return dd(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(i){let e=this.flatCoordinates.length/this.stride;return i<0||e<=i?null:new Ii(this.flatCoordinates.slice(i*this.stride,(i+1)*this.stride),this.layout)}getPoints(){let i=this.flatCoordinates,e=this.layout,n=this.stride,o=[];for(let s=0,l=i.length;s<l;s+=n){let h=new Ii(i.slice(s,s+n),e);o.push(h)}return o}getType(){return"MultiPoint"}intersectsExtent(i){let e=this.flatCoordinates,n=this.stride;for(let o=0,s=e.length;o<s;o+=n){let l=e[o],h=e[o+1];if(Px(i,l,h))return!0}return!1}setCoordinates(i,e){this.setLayout(e,i,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Jf(this.flatCoordinates,0,i,this.stride),this.changed()}},tl=mk;function mS(r,i,e,n,o,s,l){let h,p,m,f,g,y,_,w=o[s+1],A=[];for(let q=0,X=e.length;q<X;++q){let ie=e[q];for(f=r[ie-n],y=r[ie-n+1],h=i;h<ie;h+=n)g=r[h],_=r[h+1],(w<=y&&_<=w||y<=w&&w<=_)&&(m=(w-y)/(_-y)*(g-f)+f,A.push(m)),f=g,y=_}let k=NaN,R=-1/0;for(A.sort(iu),f=A[0],h=1,p=A.length;h<p;++h){g=A[h];let q=Math.abs(g-f);q>R&&(m=(f+g)/2,hS(r,i,e,n,m,w)&&(k=m,R=q)),f=g}return isNaN(k)&&(k=o[s]),l?(l.push(k,w,R),l):[k,w,R]}function uI(r,i,e,n,o){let s=[];for(let l=0,h=e.length;l<h;++l){let p=e[l];s=mS(r,i,p,n,o,2*l,s),i=p[p.length-1]}return s}function yz(r,i,e,n){for(;i<e-n;){for(let o=0;o<n;++o){let s=r[i+o];r[i+o]=r[e-n+o],r[e-n+o]=s}i+=n,e-=n}}function fS(r,i,e,n){let o=0,s=r[e-n],l=r[e-n+1];for(;i<e;i+=n){let h=r[i],p=r[i+1];o+=(h-s)*(p+l),s=h,l=p}return o===0?void 0:o>0}function gS(r,i,e,n,o){o=o!==void 0?o:!1;for(let s=0,l=e.length;s<l;++s){let h=e[s],p=fS(r,i,h,n);if(s===0){if(o&&p||!o&&!p)return!1}else if(o&&!p||!o&&p)return!1;i=h}return!0}function dI(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s){let h=e[s];if(!gS(r,i,h,n,o))return!1;h.length&&(i=h[h.length-1])}return!0}function Mv(r,i,e,n,o){o=o!==void 0?o:!1;for(let s=0,l=e.length;s<l;++s){let h=e[s],p=fS(r,i,h,n);(s===0?o&&p||!o&&!p:o&&!p||!o&&p)&&yz(r,i,h,n),i=h}return i}function _S(r,i,e,n,o){for(let s=0,l=e.length;s<l;++s)i=Mv(r,i,e[s],n,o);return i}function hI(r,i){let e=[],n=0,o=0,s;for(let l=0,h=i.length;l<h;++l){let p=i[l],m=fS(r,n,p,2);if(s===void 0&&(s=m),m===s)e.push(i.slice(o,l+1));else{if(e.length===0)continue;e[e.length-1].push(i[o])}o=l+1,n=p}return e}var Iv=class r extends Vl{constructor(i,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,i),this.ends_=n):this.setCoordinates(i,e)}appendLinearRing(i){this.flatCoordinates?Cr(this.flatCoordinates,i.getFlatCoordinates()):this.flatCoordinates=i.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let i=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return i.applyProperties(this),i}closestPointXY(i,e,n,o){return o<rd(this.getExtent(),i,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(sS(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),cS(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,i,e,n,o))}containsXY(i,e){return hS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,e)}getArea(){return sk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(i){let e;return i!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Mv(e,0,this.ends_,this.stride,i)):e=this.flatCoordinates,G0(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){let i=as(this.getExtent());this.flatInteriorPoint_=mS(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ii(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(i){return i<0||this.ends_.length<=i?null:new Om(this.flatCoordinates.slice(i===0?0:this.ends_[i-1],this.ends_[i]),this.layout)}getLinearRings(){let i=this.layout,e=this.flatCoordinates,n=this.ends_,o=[],s=0;for(let l=0,h=n.length;l<h;++l){let p=n[l],m=new Om(e.slice(s,p),i);o.push(m),s=p}return o}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let i=this.flatCoordinates;gS(i,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=i:(this.orientedFlatCoordinates_=i.slice(),this.orientedFlatCoordinates_.length=Mv(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(i){let e=[],n=[];return e.length=uS(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(i),e,0,n),new r(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(i){return uk(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,i)}setCoordinates(i,e){this.setLayout(e,i,2),this.flatCoordinates||(this.flatCoordinates=[]);let n=N0(this.flatCoordinates,0,i,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}},on=Iv;function pI(r,i,e,n){e=e||32;let o=[];for(let s=0;s<e;++s)Cr(o,N9(r,i,2*Math.PI*s/e,n));return o.push(o[0],o[1]),new Iv(o,"XY",[o.length])}function fk(r){if(nd(r))throw new Error("Cannot create polygon from empty extent");let i=r[0],e=r[1],n=r[2],o=r[3],s=[i,e,i,o,n,o,n,e,i,e];return new Iv(s,"XY",[s.length])}function Kd(r,i,e){i=i||32;let n=r.getStride(),o=r.getLayout(),s=r.getCenter(),l=n*(i+1),h=new Array(l);for(let f=0;f<l;f+=n){h[f]=0,h[f+1]=0;for(let g=2;g<n;g++)h[f+g]=s[g]}let p=[h.length],m=new Iv(h,o,p);return vz(m,s,r.getRadius(),e),m}function vz(r,i,e,n){let o=r.getFlatCoordinates(),s=r.getStride(),l=o.length/s-1,h=n||0;for(let p=0;p<=l;++p){let m=p*s,f=h+ad(p,l)*2*Math.PI/l;o[m]=i[0]+e*Math.cos(f),o[m+1]=i[1]+e*Math.sin(f)}r.changed()}function mI(r,i,e,n){let o=[],s=Wn();for(let l=0,h=e.length;l<h;++l){let p=e[l];s=W1(r,i,p[0],n),o.push((s[0]+s[2])/2,(s[1]+s[3])/2),i=p[p.length-1]}return o}var gk=class r extends Vl{constructor(i,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(i[0])){let o=i,s=[],l=[];for(let h=0,p=o.length;h<p;++h){let m=o[h],f=s.length,g=m.getEnds();for(let y=0,_=g.length;y<_;++y)g[y]+=f;Cr(s,m.getFlatCoordinates()),l.push(g)}e=o.length===0?this.getLayout():o[0].getLayout(),i=s,n=l}e!==void 0&&n?(this.setFlatCoordinates(e,i),this.endss_=n):this.setCoordinates(i,e)}appendPolygon(i){let e;if(!this.flatCoordinates)this.flatCoordinates=i.getFlatCoordinates().slice(),e=i.getEnds().slice(),this.endss_.push();else{let n=this.flatCoordinates.length;Cr(this.flatCoordinates,i.getFlatCoordinates()),e=i.getEnds().slice();for(let o=0,s=e.length;o<s;++o)e[o]+=n}this.endss_.push(e),this.changed()}clone(){let i=this.endss_.length,e=new Array(i);for(let o=0;o<i;++o)e[o]=this.endss_[o].slice();let n=new r(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(i,e,n,o){return o<rd(this.getExtent(),i,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(cz(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),uz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,i,e,n,o))}containsXY(i,e){return fz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,i,e)}getArea(){return hz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(i){let e;return i!==void 0?(e=this.getOrientedFlatCoordinates().slice(),_S(e,0,this.endss_,this.stride,i)):e=this.flatCoordinates,dS(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let i=mI(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=uI(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,i),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new tl(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let i=this.flatCoordinates;dI(i,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=i:(this.orientedFlatCoordinates_=i.slice(),this.orientedFlatCoordinates_.length=_S(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(i){let e=[],n=[];return e.length=dz(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(i),e,0,n),new r(e,"XY",n)}getPolygon(i){if(i<0||this.endss_.length<=i)return null;let e;if(i===0)e=0;else{let s=this.endss_[i-1];e=s[s.length-1]}let n=this.endss_[i].slice(),o=n[n.length-1];if(e!==0)for(let s=0,l=n.length;s<l;++s)n[s]-=e;return new on(this.flatCoordinates.slice(e,o),this.layout,n)}getPolygons(){let i=this.layout,e=this.flatCoordinates,n=this.endss_,o=[],s=0;for(let l=0,h=n.length;l<h;++l){let p=n[l].slice(),m=p[p.length-1];if(s!==0)for(let g=0,y=p.length;g<y;++g)p[g]-=s;let f=new on(e.slice(s,m),i,p);o.push(f),s=m}return o}getType(){return"MultiPolygon"}intersectsExtent(i){return _z(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,i)}setCoordinates(i,e){this.setLayout(e,i,3),this.flatCoordinates||(this.flatCoordinates=[]);let n=nI(this.flatCoordinates,0,i,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{let o=n[n.length-1];this.flatCoordinates.length=o.length===0?0:o[o.length-1]}this.changed()}},es=gk;var bz=el(),vS=class r{constructor(i,e,n,o,s,l){this.styleFunction,this.extent_,this.id_=l,this.type_=i,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=s,this.squaredTolerance_,this.stride_=o,this.simplifiedGeometry_}get(i){return this.properties_[i]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Sm(this.flatCoordinates_):W1(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let i=as(this.getExtent());this.flatInteriorPoints_=mS(this.flatCoordinates_,0,this.ends_,2,i,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let i=hI(this.flatCoordinates_,this.ends_),e=mI(this.flatCoordinates_,0,i,2);this.flatInteriorPoints_=uI(this.flatCoordinates_,0,i,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=Sy(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let i=this.flatCoordinates_,e=0,n=this.ends_;for(let o=0,s=n.length;o<s;++o){let l=n[o],h=Sy(i,e,l,2,.5);Cr(this.flatMidpoints_,h),e=l}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(i){return this}simplifyTransformed(i,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(i){i=ni(i);let e=i.getExtent(),n=i.getWorldExtent();if(e&&n){let o=Hn(n)/Hn(e);Ns(bz,n[0],n[3],o,-o,0,0,0),ud(this.flatCoordinates_,0,this.flatCoordinates_.length,2,bz,this.flatCoordinates_)}}applyTransform(i){i(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new r(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=eI((i,e)=>{if(i===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);let n=this.simplifiedGeometry_.getFlatCoordinates(),o;switch(this.type_){case"LineString":n.length=xy(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,i,n,0),o=[n.length];break;case"MultiLineString":o=[],n.length=aI(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,i,n,0,o);break;case"Polygon":o=[],n.length=uS(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(i),n,0,o);break;default:}return o&&(this.simplifiedGeometry_=new r(this.type_,n,o,2,this.properties_,this.id_)),this.squaredTolerance_=i,this.simplifiedGeometry_}),this}};vS.prototype.getFlatCoordinates=vS.prototype.getOrientedFlatCoordinates;var il=vS;var _k=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=gi,this.supportedMediaTypes=null}getReadOptions(i,e){if(e){let n=e.dataProjection?ni(e.dataProjection):this.readProjection(i);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=ni(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(i){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},i)}getType(){return Ti()}readFeature(i,e){return Ti()}readFeatures(i,e){return Ti()}readGeometry(i,e){return Ti()}readProjection(i){return Ti()}writeFeature(i,e){return Ti()}writeFeatures(i,e){return Ti()}writeGeometry(i,e){return Ti()}},Dm=_k;function xn(r,i,e){let n=e?ni(e.featureProjection):null,o=e?ni(e.dataProjection):null,s=r;if(n&&o&&!cc(n,o)){i&&(s=r.clone());let l=i?n:o,h=i?o:n;l.getUnits()==="tile-pixels"?s.transform(l,h):s.applyTransform(zf(l,h))}if(i&&e&&e.decimals!==void 0){let l=Math.pow(10,e.decimals),h=function(p){for(let m=0,f=p.length;m<f;++m)p[m]=Math.round(p[m]*l)/l;return p};s===r&&(s=r.clone()),s.applyTransform(h)}return s}function Ev(r,i){let e=i?ni(i.featureProjection):null,n=i?ni(i.dataProjection):null;return e&&n&&!cc(e,n)?Zs(r,n,e):r}var Kse={Point:Ii,LineString:Tr,Polygon:on,MultiPoint:tl,MultiLineString:Ko,MultiPolygon:es};function Qse(r,i,e){return Array.isArray(i[0])?(dI(r,0,i,e)||(r=r.slice(),_S(r,0,i,e)),r):(gS(r,0,i,e)||(r=r.slice(),Mv(r,0,i,e)),r)}function yk(r,i){let e=r.geometry;if(!e)return[];if(Array.isArray(e))return e.map(s=>yk(En(ur({},r),{geometry:s}))).flat();let n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);let o=e.layout.length;return xn(new il(n,n==="Polygon"?Qse(e.flatCoordinates,e.ends,o):e.flatCoordinates,e.ends?.flat(),o,r.properties||{},r.id).enableSimplifyTransformed(),!1,i)}function fI(r,i){if(!r)return null;if(Array.isArray(r)){let n=r.map(o=>fI(o,i));return new _s(n)}let e=Kse[r.type];return xn(new e(r.flatCoordinates,r.layout,r.ends),!1,i)}var vk=class extends Dm{constructor(){super()}getType(){return"json"}readFeature(i,e){return this.readFeatureFromObject(gI(i),this.getReadOptions(i,e))}readFeatures(i,e){return this.readFeaturesFromObject(gI(i),this.getReadOptions(i,e))}readFeatureFromObject(i,e){return Ti()}readFeaturesFromObject(i,e){return Ti()}readGeometry(i,e){return this.readGeometryFromObject(gI(i),this.getReadOptions(i,e))}readGeometryFromObject(i,e){return Ti()}readProjection(i){return this.readProjectionFromObject(gI(i))}readProjectionFromObject(i){return Ti()}writeFeature(i,e){return JSON.stringify(this.writeFeatureObject(i,e))}writeFeatureObject(i,e){return Ti()}writeFeatures(i,e){return JSON.stringify(this.writeFeaturesObject(i,e))}writeFeaturesObject(i,e){return Ti()}writeGeometry(i,e){return JSON.stringify(this.writeGeometryObject(i,e))}writeGeometryObject(i,e){return Ti()}};function gI(r){if(typeof r=="string"){let i=JSON.parse(r);return i||null}return r!==null?r:null}var Tv=vk;var bk=class extends Tv{constructor(i){i=i||{},super(),this.dataProjection=ni(i.dataProjection?i.dataProjection:"EPSG:4326"),i.featureProjection&&(this.defaultFeatureProjection=ni(i.featureProjection)),i.featureClass&&(this.featureClass=i.featureClass),this.geometryName_=i.geometryName,this.extractGeometryName_=i.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(i,e){let n=null;i.type==="Feature"?n=i:n={type:"Feature",geometry:i,properties:null};let o=xk(n.geometry,e);if(this.featureClass===il)return yk({geometry:o,id:n.id,properties:n.properties},e);let s=new gi;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&s.setGeometryName(n.geometry_name),s.setGeometry(fI(o,e)),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s}readFeaturesFromObject(i,e){let n=i,o=null;if(n.type==="FeatureCollection"){let s=i;o=[];let l=s.features;for(let h=0,p=l.length;h<p;++h){let m=this.readFeatureFromObject(l[h],e);m&&o.push(m)}}else o=[this.readFeatureFromObject(i,e)];return o.flat()}readGeometryFromObject(i,e){return Jse(i,e)}readProjectionFromObject(i){let e=i.crs,n;if(e)if(e.type=="name")n=ni(e.properties.name);else if(e.type==="EPSG")n=ni("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(i,e){e=this.adaptOptions(e);let n={type:"Feature",geometry:null,properties:null},o=i.getId();if(o!==void 0&&(n.id=o),!i.hasProperties())return n;let s=i.getProperties(),l=i.getGeometry();return l&&(n.geometry=wk(l,e),delete s[i.getGeometryName()]),Bl(s)||(n.properties=s),n}writeFeaturesObject(i,e){e=this.adaptOptions(e);let n=[];for(let o=0,s=i.length;o<s;++o)n.push(this.writeFeatureObject(i[o],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(i,e){return wk(i,this.adaptOptions(e))}};function xk(r,i){if(!r)return null;let e;switch(r.type){case"Point":{e=tle(r);break}case"LineString":{e=ile(r);break}case"Polygon":{e=ale(r);break}case"MultiPoint":{e=nle(r);break}case"MultiLineString":{e=rle(r);break}case"MultiPolygon":{e=ole(r);break}case"GeometryCollection":{e=ele(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return e}function Jse(r,i){let e=xk(r,i);return fI(e,i)}function ele(r,i){return r.geometries.map(function(n){return xk(n,i)})}function tle(r){let i=r.coordinates;return{type:"Point",flatCoordinates:i,layout:R0(i.length)}}function ile(r){let i=r.coordinates,e=i.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:R0(i[0]?.length||2)}}function rle(r){let i=r.coordinates,e=i[0]?.[0]?.length||2,n=[],o=N0(n,0,i,e);return{type:"MultiLineString",flatCoordinates:n,ends:o,layout:R0(e)}}function nle(r){let i=r.coordinates;return{type:"MultiPoint",flatCoordinates:i.flat(),layout:R0(i[0]?.length||2)}}function ole(r){let i=r.coordinates,e=[],n=i[0]?.[0]?.[0].length||2,o=nI(e,0,i,n);return{type:"MultiPolygon",flatCoordinates:e,ends:o,layout:R0(n)}}function ale(r){let i=r.coordinates,e=[],n=i[0]?.[0]?.length,o=N0(e,0,i,n);return{type:"Polygon",flatCoordinates:e,ends:o,layout:R0(n)}}function wk(r,i){r=xn(r,!0,i);let e=r.getType(),n;switch(e){case"Point":{n=hle(r,i);break}case"LineString":{n=lle(r,i);break}case"Polygon":{n=ple(r,i);break}case"MultiPoint":{n=ule(r,i);break}case"MultiLineString":{n=cle(r,i);break}case"MultiPolygon":{n=dle(r,i);break}case"GeometryCollection":{n=sle(r,i);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function sle(r,i){return i=Object.assign({},i),delete i.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(n){return wk(n,i)})}}function lle(r,i){return{type:"LineString",coordinates:r.getCoordinates()}}function cle(r,i){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function ule(r,i){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function dle(r,i){let e;return i&&(e=i.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function hle(r,i){return{type:"Point",coordinates:r.getCoordinates()}}function ple(r,i){let e;return i&&(e=i.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}var Qr=bk;var mc={};m7(mc,{Circle:()=>an,Fill:()=>hi,Icon:()=>Bs,IconImage:()=>kz,Image:()=>Fv,RegularShape:()=>ru,Stroke:()=>ui,Style:()=>oi,Text:()=>so});var xi={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Sk(r){return r[0]>0&&r[1]>0}function _I(r,i,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*i+.5|0,e[1]=r[1]*i+.5|0,e}function Wo(r,i){return Array.isArray(r)?r:(i===void 0?i=[r,r]:(i[0]=r,i[1]=r),i)}var Ck=class r{constructor(i){this.opacity_=i.opacity,this.rotateWithView_=i.rotateWithView,this.rotation_=i.rotation,this.scale_=i.scale,this.scaleArray_=Wo(i.scale),this.displacement_=i.displacement,this.declutterMode_=i.declutterMode}clone(){let i=this.getScale();return new r({opacity:this.getOpacity(),scale:Array.isArray(i)?i.slice():i,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Ti()}getImage(i){return Ti()}getHitDetectionImage(){return Ti()}getPixelRatio(i){return 1}getImageState(){return Ti()}getImageSize(){return Ti()}getOrigin(){return Ti()}getSize(){return Ti()}setDisplacement(i){this.displacement_=i}setOpacity(i){this.opacity_=i}setRotateWithView(i){this.rotateWithView_=i}setRotation(i){this.rotation_=i}setScale(i){this.scale_=i,this.scaleArray_=Wo(i)}listenImageChange(i){Ti()}load(){Ti()}unlistenImageChange(i){Ti()}ready(){return Promise.resolve()}},Fv=Ck;var mle={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]},eg=mle;var Pv={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};Pv.max=Pv.whitepoint[2].D65;Pv.rgb=function(r,i){i=i||Pv.whitepoint[2].E;var e=r[0]/i[0],n=r[1]/i[1],o=r[2]/i[2],s,l,h;return s=e*3.240969941904521+n*-1.537383177570093+o*-.498610760293,l=e*-.96924363628087+n*1.87596750150772+o*.041555057407175,h=e*.055630079696993+n*-.20397695888897+o*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,l=l>.0031308?1.055*Math.pow(l,1/2.4)-.055:l=l*12.92,h=h>.0031308?1.055*Math.pow(h,1/2.4)-.055:h=h*12.92,s=Math.min(Math.max(0,s),1),l=Math.min(Math.max(0,l),1),h=Math.min(Math.max(0,h),1),[s*255,l*255,h*255]};eg.xyz=function(r,i){var e=r[0]/255,n=r[1]/255,o=r[2]/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92;var s=e*.41239079926595+n*.35758433938387+o*.18048078840183,l=e*.21263900587151+n*.71516867876775+o*.072192315360733,h=e*.019330818715591+n*.11919477979462+o*.95053215224966;return i=i||Pv.whitepoint[2].E,[s*i[0],l*i[1],h*i[2]]};var hd=Pv;var fle={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(r,i,e){var n,o,s,l,h,p,m,f,g,y,_,w,A;if(s=r[0],l=r[1],h=r[2],s===0)return[0,0,0];var k=.0011070564598794539;return i=i||"D65",e=e||2,g=hd.whitepoint[e][i][0],y=hd.whitepoint[e][i][1],_=hd.whitepoint[e][i][2],w=4*g/(g+15*y+3*_),A=9*y/(g+15*y+3*_),n=l/(13*s)+w||0,o=h/(13*s)+A||0,m=s>8?y*Math.pow((s+16)/116,3):y*s*k,p=m*9*n/(4*o)||0,f=m*(12-3*n-20*o)/(4*o)||0,[p,m,f]}},yI=fle;hd.luv=function(r,i,e){var n,o,s,l,h,p,m,f,g,y,_,w,A,k=.008856451679035631,R=903.2962962962961;i=i||"D65",e=e||2,g=hd.whitepoint[e][i][0],y=hd.whitepoint[e][i][1],_=hd.whitepoint[e][i][2],w=4*g/(g+15*y+3*_),A=9*y/(g+15*y+3*_),p=r[0],m=r[1],f=r[2],n=4*p/(p+15*m+3*f)||0,o=9*m/(p+15*m+3*f)||0;var q=m/y;return s=q<=k?R*q:116*Math.pow(q,1/3)-16,l=13*s*(n-w),h=13*s*(o-A),[s,l,h]};var wz={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(r){var i=r[0],e=r[1],n=r[2],o,s,l;return l=n/360*2*Math.PI,o=e*Math.cos(l),s=e*Math.sin(l),[i,o,s]},xyz:function(r){return yI.xyz(wz.luv(r))}},xz=wz;yI.lchuv=function(r){var i=r[0],e=r[1],n=r[2],o=Math.sqrt(e*e+n*n),s=Math.atan2(n,e),l=s*360/2/Math.PI;return l<0&&(l+=360),[i,o,l]};hd.lchuv=function(r){return yI.lchuv(hd.luv(r))};var Ak={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};for(let r in Ak)Object.freeze(Ak[r]);var Mk=Object.freeze(Ak);var Cz=gle,Sz={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function gle(r){var i,e=[],n=1,o;if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(typeof r=="number")return{space:"rgb",values:[r>>>16,(r&65280)>>>8,r&255],alpha:1};if(r=String(r).toLowerCase(),Mk[r])e=Mk[r].slice(),o="rgb";else if(r==="transparent")n=0,o="rgb",e=[0,0,0];else if(r[0]==="#"){var s=r.slice(1),l=s.length,h=l<=4;n=1,h?(e=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],l===4&&(n=parseInt(s[3]+s[3],16)/255)):(e=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],l===8&&(n=parseInt(s[6]+s[7],16)/255)),e[0]||(e[0]=0),e[1]||(e[1]=0),e[2]||(e[2]=0),o="rgb"}else if(i=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(r)){var p=i[1];o=p.replace(/a$/,"");var m=o==="cmyk"?4:o==="gray"?1:3;e=i[2].trim().split(/\s*[,\/]\s*|\s+/),o==="color"&&(o=e.shift()),e=e.map(function(f,g){if(f[f.length-1]==="%")return f=parseFloat(f)/100,g===3?f:o==="rgb"?f*255:o[0]==="h"||o[0]==="l"&&!g?f*100:o==="lab"?f*125:o==="lch"?g<2?f*150:f*360:o[0]==="o"&&!g?f:o==="oklab"?f*.4:o==="oklch"?g<2?f*.4:f*360:f;if(o[g]==="h"||g===2&&o[o.length-1]==="h"){if(Sz[f]!==void 0)return Sz[f];if(f.endsWith("deg"))return parseFloat(f);if(f.endsWith("turn"))return parseFloat(f)*360;if(f.endsWith("grad"))return parseFloat(f)*360/400;if(f.endsWith("rad"))return parseFloat(f)*180/Math.PI}return f==="none"?0:parseFloat(f)}),n=e.length>m?e.pop():1}else/[0-9](?:\s|\/|,)/.test(r)&&(e=r.match(/([0-9]+)/g).map(function(f){return parseFloat(f)}),o=r.match(/([a-z])/ig)?.join("")?.toLowerCase()||"rgb");return{space:o,values:e,alpha:n}}var _le={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(r){var i=r[0]/360,e=r[1]/100,n=r[2]/100,o,s,l,h,p,m=0;if(e===0)return p=n*255,[p,p,p];for(s=n<.5?n*(1+e):n+e-n*e,o=2*n-s,h=[0,0,0];m<3;)l=i+1/3*-(m-1),l<0?l++:l>1&&l--,p=6*l<1?o+(s-o)*6*l:2*l<1?s:3*l<2?o+(s-o)*(2/3-l)*6:o,h[m++]=p*255;return h}},vI=_le;eg.hsl=function(r){var i=r[0]/255,e=r[1]/255,n=r[2]/255,o=Math.min(i,e,n),s=Math.max(i,e,n),l=s-o,h,p,m;return s===o?h=0:i===s?h=(e-n)/l:e===s?h=2+(n-i)/l:n===s&&(h=4+(i-e)/l),h=Math.min(h*60,360),h<0&&(h+=360),m=(o+s)/2,s===o?p=0:m<=.5?p=l/(s+o):p=l/(2-s-o),[h,p*100,m*100]};function Ik(r){Array.isArray(r)&&r.raw&&(r=String.raw(...arguments)),r instanceof Number&&(r=+r);var i,e,n,o=Cz(r);if(!o.space)return[];let s=o.space[0]==="h"?vI.min:eg.min,l=o.space[0]==="h"?vI.max:eg.max;return i=Array(3),i[0]=Math.min(Math.max(o.values[0],s[0]),l[0]),i[1]=Math.min(Math.max(o.values[1],s[1]),l[1]),i[2]=Math.min(Math.max(o.values[2],s[2]),l[2]),o.space[0]==="h"&&(i=vI.rgb(i)),i.push(Math.min(Math.max(o.alpha,0),1)),i}function Az(r){return typeof r=="string"?r:wS(r)}var yle=1024,bS={},Ek=0;function Mz(r){if(r.length===4)return r;let i=r.slice();return i[3]=1,i}function Tk(r){let i=hd.lchuv(eg.xyz(r));return i[3]=r[3],i}function Iz(r){let i=hd.rgb(xz.xyz(r));return i[3]=r[3],i}function bI(r){if(bS.hasOwnProperty(r))return bS[r];if(Ek>=yle){let e=0;for(let n in bS)e++&3||(delete bS[n],--Ek)}let i=Ik(r);if(i.length!==4)throw new Error('Failed to parse "'+r+'" as color');for(let e of i)if(isNaN(e))throw new Error('Failed to parse "'+r+'" as color');return Fk(i),bS[r]=i,++Ek,i}function Ra(r){return Array.isArray(r)?r:bI(r)}function Fk(r){return r[0]=to(r[0]+.5|0,0,255),r[1]=to(r[1]+.5|0,0,255),r[2]=to(r[2]+.5|0,0,255),r[3]=to(r[3],0,1),r}function wS(r){let i=r[0];i!=(i|0)&&(i=i+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let n=r[2];n!=(n|0)&&(n=n+.5|0);let o=r[3]===void 0?1:Math.round(r[3]*1e3)/1e3;return"rgba("+i+","+e+","+n+","+o+")"}function Ez(r){try{return bI(r),!0}catch{return!1}}function yo(r,i,e,n){let o;return e&&e.length?o=e.shift():ZA?o=new OffscreenCanvas(r||300,i||300):o=document.createElement("canvas"),r&&(o.width=r),i&&(o.height=i),o.getContext("2d",n)}var Pk;function xS(){return Pk||(Pk=yo(1,1)),Pk}function tg(r){let i=r.canvas;i.width=1,i.height=1,r.clearRect(0,0,1,1)}function Tz(r){let i=r.offsetWidth,e=getComputedStyle(r);return i+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),i}function Fz(r){let i=r.offsetHeight,e=getComputedStyle(r);return i+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),i}function Lk(r,i){let e=i.parentNode;e&&e.replaceChild(r,i)}function Cy(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function wI(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function Pz(r,i){let e=r.childNodes;for(let n=0;;++n){let o=e[n],s=i[n];if(!o&&!s)break;if(o!==s){if(!o){r.appendChild(s);continue}if(!s){r.removeChild(o),--n;continue}r.insertBefore(s,o)}}}var kk=class extends km{constructor(i,e,n,o){super(),this.extent=i,this.pixelRatio_=n,this.resolution=e,this.state=typeof o=="function"?xi.IDLE:o,this.image_=null,this.loader=typeof o=="function"?o:null}changed(){this.dispatchEvent(mi.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==xi.IDLE&&this.loader){this.state=xi.LOADING,this.changed();let i=this.getResolution(),e=Array.isArray(i)?i[0]:i;yv(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=xi.LOADED}).catch(n=>{this.state=xi.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(i){this.image_=i}setResolution(i){this.resolution=i}};function Lz(r,i,e){let n=r,o=!0,s=!1,l=!1,h=[vv(n,mi.LOAD,function(){l=!0,s||i()})];return n.src&&XA?(s=!0,n.decode().then(function(){o&&i()}).catch(function(p){o&&(l?i():e())})):h.push(vv(n,mi.ERROR,e)),function(){o=!1,h.forEach(wn)}}function vle(r,i){return new Promise((e,n)=>{function o(){l(),e(r)}function s(){l(),n(new Error("Image load error"))}function l(){r.removeEventListener("load",o),r.removeEventListener("error",s)}r.addEventListener("load",o),r.addEventListener("error",s),i&&(r.src=i)})}function Ok(r,i){return i&&(r.src=i),r.src&&XA?new Promise((e,n)=>r.decode().then(()=>e(r)).catch(o=>r.complete&&r.width?e(r):n(o))):vle(r)}function V0(r,i){return i&&(r.src=i),r.src&&XA&&x9?r.decode().then(()=>createImageBitmap(r)).catch(e=>{if(r.complete&&r.width)return r;throw e}):Ok(r)}var xI=kk;var Rk=class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let i=0;for(let e in this.cache_){let n=this.cache_[e];!(i++&3)&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(i,e,n){let o=Dk(i,e,n);return o in this.cache_?this.cache_[o]:null}getPattern(i,e,n){let o=Dk(i,e,n);return o in this.patternCache_?this.patternCache_[o]:null}set(i,e,n,o,s){let l=Dk(i,e,n),h=l in this.cache_;this.cache_[l]=o,s&&(o.getImageState()===xi.IDLE&&o.load(),o.getImageState()===xi.LOADING?o.ready().then(()=>{this.patternCache_[l]=xS().createPattern(o.getImage(1),"repeat")}):this.patternCache_[l]=xS().createPattern(o.getImage(1),"repeat")),h||++this.cacheSize_}setSize(i){this.maxCacheSize_=i,this.expire()}};function Dk(r,i,e){let n=e?Ra(e):"null";return i+":"+r+":"+n}var Qd=new Rk;var SS=null,SI=class extends km{constructor(i,e,n,o,s){super(),this.hitDetectionImage_=null,this.image_=i,this.crossOrigin_=n,this.canvas_={},this.color_=s,this.imageState_=o===void 0?xi.IDLE:o,this.size_=i&&i.width&&i.height?[i.width,i.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===xi.LOADED){SS||(SS=yo(1,1,void 0,{willReadFrequently:!0})),SS.drawImage(this.image_,0,0);try{SS.getImageData(0,0,1,1),this.tainted_=!1}catch{SS=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(mi.CHANGE)}handleImageError_(){this.imageState_=xi.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=xi.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(i){return this.image_||this.initializeImage_(),this.replaceColor_(i),this.canvas_[i]?this.canvas_[i]:this.image_}getPixelRatio(i){return this.replaceColor_(i),this.canvas_[i]?i:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){let i=this.size_[0],e=this.size_[1],n=yo(i,e);n.fillRect(0,0,i,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===xi.IDLE){this.image_||this.initializeImage_(),this.imageState_=xi.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Ok(this.image_,this.src_).then(i=>{this.image_=i,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(i){if(!this.color_||this.canvas_[i]||this.imageState_!==xi.LOADED)return;let e=this.image_,n=document.createElement("canvas");n.width=Math.ceil(e.width*i),n.height=Math.ceil(e.height*i);let o=n.getContext("2d");o.scale(i,i),o.drawImage(e,0,0),o.globalCompositeOperation="multiply",o.fillStyle=Az(this.color_),o.fillRect(0,0,n.width/i,n.height/i),o.globalCompositeOperation="destination-in",o.drawImage(e,0,0),this.canvas_[i]=n}ready(){return this.ready_||(this.ready_=new Promise(i=>{this.imageState_===xi.LOADED||this.imageState_===xi.ERROR?i():this.addEventListener(mi.CHANGE,function e(){(this.imageState_===xi.LOADED||this.imageState_===xi.ERROR)&&(this.removeEventListener(mi.CHANGE,e),i())})})),this.ready_}};function Lv(r,i,e,n,o,s){let l=i===void 0?void 0:Qd.get(i,e,o);return l||(l=new SI(r,r instanceof HTMLImageElement?r.src||void 0:i,e,n,o),Qd.set(i,e,o,l,s)),s&&l&&!Qd.getPattern(i,e,o)&&Qd.set(i,e,o,l,s),l}var kz=SI;function pd(r){return r?Array.isArray(r)?wS(r):typeof r=="object"&&"src"in r?ble(r):r:null}function ble(r){if(!r.offset||!r.size)return Qd.getPattern(r.src,"anonymous",r.color);let i=r.src+":"+r.offset,e=Qd.getPattern(i,void 0,r.color);if(e)return e;let n=Qd.get(r.src,"anonymous",null);if(n.getImageState()!==xi.LOADED)return null;let o=yo(r.size[0],r.size[1]);return o.drawImage(n.getImage(1),r.offset[0],r.offset[1],r.size[0],r.size[1],0,0,r.size[0],r.size[1]),Lv(o.canvas,i,void 0,xi.LOADED,r.color,!0),Qd.getPattern(i,void 0,r.color)}var CS="ol-hidden",Dz="ol-selectable",Rm="ol-unselectable";var kv="ol-control",Nk="ol-collapsed",wle=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Oz=["style","variant","weight","size","lineHeight","family"],Bk=function(r){let i=r.match(wle);if(!i)return null;let e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let n=0,o=Oz.length;n<o;++n){let s=i[n+1];s!==void 0&&(e[Oz[n]]=s)}return e.families=e.family.split(/,\s?/),e};var AI="10px sans-serif",Ul="#000",Bm="round",md=[],fd=0,Gm="round",ig=10,rg="#000",U0="center",Ay="middle",ng=[0,0,0,0],og=1,Nm=new ls,Ov=null,Gk,jk={},Rz=function(){let i="32px ",e=["monospace","serif"],n=e.length,o="wmytzilWMYTZIL@#/&?$%10\uF013",s,l;function h(m,f,g){let y=!0;for(let _=0;_<n;++_){let w=e[_];if(l=CI(m+" "+f+" "+i+w,o),g!=w){let A=CI(m+" "+f+" "+i+g+","+w,o);y=y&&A!=l}}return!!y}function p(){let m=!0,f=Nm.getKeys();for(let g=0,y=f.length;g<y;++g){let _=f[g];Nm.get(_)<100&&(h.apply(this,_.split(`
`))?(Dh(jk),Ov=null,Gk=void 0,Nm.set(_,100)):(Nm.set(_,Nm.get(_)+1,!0),m=!1))}m&&(clearInterval(s),s=void 0)}return function(m){let f=Bk(m);if(!f)return;let g=f.families;for(let y=0,_=g.length;y<_;++y){let w=g[y],A=f.style+`
`+f.weight+`
`+w;Nm.get(A)===void 0&&(Nm.set(A,100,!0),h(f.style,f.weight,w)||(Nm.set(A,0,!0),s===void 0&&(s=setInterval(p,32))))}}}(),xle=function(){let r;return function(i){let e=jk[i];if(e==null){if(ZA){let n=Bk(i),o=Nz(i,"\u017Dg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=i,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);jk[i]=e}return e}}();function Nz(r,i){return Ov||(Ov=yo(1,1)),r!=Gk&&(Ov.font=r,Gk=Ov.font),Ov.measureText(i)}function CI(r,i){return Nz(r,i).width}function Vk(r,i,e){if(i in e)return e[i];let n=i.split(`
`).reduce((o,s)=>Math.max(o,CI(r,s)),0);return e[i]=n,n}function Bz(r,i){let e=[],n=[],o=[],s=0,l=0,h=0,p=0;for(let m=0,f=i.length;m<=f;m+=2){let g=i[m];if(g===`
`||m===f){s=Math.max(s,l),o.push(l),l=0,h+=p;continue}let y=i[m+1]||r.font,_=CI(y,g);e.push(_),l+=_;let w=xle(y);n.push(w),p=Math.max(p,w)}return{width:s,height:h,widths:e,heights:n,lineWidths:o}}function Gz(r,i,e,n,o,s,l,h,p,m,f){r.save(),e!==1&&(r.globalAlpha===void 0?r.globalAlpha=g=>g.globalAlpha*=e:r.globalAlpha*=e),i&&r.transform.apply(r,i),n.contextInstructions?(r.translate(p,m),r.scale(f[0],f[1]),Sle(n,r)):f[0]<0||f[1]<0?(r.translate(p,m),r.scale(f[0],f[1]),r.drawImage(n,o,s,l,h,0,0,l,h)):r.drawImage(n,o,s,l,h,p,m,l*f[0],h*f[1]),r.restore()}function Sle(r,i){let e=r.contextInstructions;for(let n=0,o=e.length;n<o;n+=2)Array.isArray(e[n+1])?i[e[n]].apply(i,e[n+1]):i[e[n]]=e[n+1]}var Uk=class r extends Fv{constructor(i){super({opacity:1,rotateWithView:i.rotateWithView!==void 0?i.rotateWithView:!1,rotation:i.rotation!==void 0?i.rotation:0,scale:i.scale!==void 0?i.scale:1,displacement:i.displacement!==void 0?i.displacement:[0,0],declutterMode:i.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=i.fill!==void 0?i.fill:null,this.origin_=[0,0],this.points_=i.points,this.radius_=i.radius,this.radius2_=i.radius2,this.angle_=i.angle!==void 0?i.angle:0,this.stroke_=i.stroke!==void 0?i.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?xi.LOADING:xi.LOADED,this.imageState_===xi.LOADING&&this.ready().then(()=>this.imageState_=xi.LOADED),this.render()}clone(){let i=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(i)?i.slice():i,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){let i=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[i[0]/2-e[0]/n[0],i[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(i){this.fill_=i,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(i){let e=this.canvases_[i];if(!e){let n=this.renderOptions_,o=yo(n.size*i,n.size*i);this.draw_(n,o,i),e=o.canvas,this.canvases_[i]=e}return e}getPixelRatio(i){return i}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(i){this.stroke_=i,this.render()}listenImageChange(i){}load(){}unlistenImageChange(i){}calculateLineJoinSize_(i,e,n){if(e===0||this.points_===1/0||i!=="bevel"&&i!=="miter")return e;let o=this.radius_,s=this.radius2_===void 0?o:this.radius2_;if(o<s){let be=o;o=s,s=be}let l=this.radius2_===void 0?this.points_:this.points_*2,h=2*Math.PI/l,p=s*Math.sin(h),m=Math.sqrt(s*s-p*p),f=o-m,g=Math.sqrt(p*p+f*f),y=g/p;if(i==="miter"&&y<=n)return y*e;let _=e/2/y,w=e/2*(f/g),k=Math.sqrt((o+_)*(o+_)+w*w)-o;if(this.radius2_===void 0||i==="bevel")return k*2;let R=o*Math.sin(h),q=Math.sqrt(o*o-R*R),X=s-q,ae=Math.sqrt(R*R+X*X)/R;if(ae<=n){let be=ae*e/2-s-o;return 2*Math.max(k,be)}return k*2}createRenderOptions(){let i=Bm,e=Gm,n=0,o=null,s=0,l,h=0;this.stroke_&&(l=pd(this.stroke_.getColor()??rg),h=this.stroke_.getWidth()??og,o=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Gm,i=this.stroke_.getLineCap()??Bm,n=this.stroke_.getMiterLimit()??ig);let p=this.calculateLineJoinSize_(e,h,n),m=Math.max(this.radius_,this.radius2_||0),f=Math.ceil(2*m+p);return{strokeStyle:l,strokeWidth:h,size:f,lineCap:i,lineDash:o,lineDashOffset:s,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();let i=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[i,i]}draw_(i,e,n){if(e.scale(n,n),e.translate(i.size/2,i.size/2),this.createPath_(e),this.fill_){let o=this.fill_.getColor();o===null&&(o=Ul),e.fillStyle=pd(o),e.fill()}i.strokeStyle&&(e.strokeStyle=i.strokeStyle,e.lineWidth=i.strokeWidth,i.lineDash&&(e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset),e.lineCap=i.lineCap,e.lineJoin=i.lineJoin,e.miterLimit=i.miterLimit,e.stroke())}createHitDetectionCanvas_(i){let e;if(this.fill_){let n=this.fill_.getColor(),o=0;typeof n=="string"&&(n=Ra(n)),n===null?o=1:Array.isArray(n)&&(o=n.length===4?n[3]:1),o===0&&(e=yo(i.size,i.size),this.drawHitDetectionCanvas_(i,e))}return e?e.canvas:this.getImage(1)}createPath_(i){let e=this.points_,n=this.radius_;if(e===1/0)i.arc(0,0,n,0,2*Math.PI);else{let o=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);let s=this.angle_-Math.PI/2,l=2*Math.PI/e;for(let h=0;h<e;h++){let p=s+h*l,m=h%2===0?n:o;i.lineTo(m*Math.cos(p),m*Math.sin(p))}i.closePath()}}drawHitDetectionCanvas_(i,e){e.translate(i.size/2,i.size/2),this.createPath_(e),e.fillStyle=Ul,e.fill(),i.strokeStyle&&(e.strokeStyle=i.strokeStyle,e.lineWidth=i.strokeWidth,i.lineDash&&(e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset),e.lineJoin=i.lineJoin,e.miterLimit=i.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}},ru=Uk;var zk=class r extends ru{constructor(i){i=i||{radius:5},super({points:1/0,fill:i.fill,radius:i.radius,stroke:i.stroke,scale:i.scale!==void 0?i.scale:1,rotation:i.rotation!==void 0?i.rotation:0,rotateWithView:i.rotateWithView!==void 0?i.rotateWithView:!1,displacement:i.displacement!==void 0?i.displacement:[0,0],declutterMode:i.declutterMode})}clone(){let i=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(i)?i.slice():i,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(i){this.radius_=i,this.render()}},an=zk;var $k=class r{constructor(i){i=i||{},this.patternImage_=null,this.color_=null,i.color!==void 0&&this.setColor(i.color)}clone(){let i=this.getColor();return new r({color:Array.isArray(i)?i.slice():i||void 0})}getColor(){return this.color_}setColor(i){if(i!==null&&typeof i=="object"&&"src"in i){let e=Lv(null,i.src,"anonymous",void 0,i.offset?null:i.color?i.color:null,!(i.offset&&i.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===xi.IDLE&&e.load(),e.getImageState()===xi.LOADING&&(this.patternImage_=e)}this.color_=i}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}},hi=$k;function jz(r,i,e,n){return e!==void 0&&n!==void 0?[e/r,n/i]:e!==void 0?e/r:n!==void 0?n/i:1}var Wk=class r extends Fv{constructor(i){i=i||{};let e=i.opacity!==void 0?i.opacity:1,n=i.rotation!==void 0?i.rotation:0,o=i.scale!==void 0?i.scale:1,s=i.rotateWithView!==void 0?i.rotateWithView:!1;super({opacity:e,rotation:n,scale:o,displacement:i.displacement!==void 0?i.displacement:[0,0],rotateWithView:s,declutterMode:i.declutterMode}),this.anchor_=i.anchor!==void 0?i.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=i.anchorOrigin!==void 0?i.anchorOrigin:"top-left",this.anchorXUnits_=i.anchorXUnits!==void 0?i.anchorXUnits:"fraction",this.anchorYUnits_=i.anchorYUnits!==void 0?i.anchorYUnits:"fraction",this.crossOrigin_=i.crossOrigin!==void 0?i.crossOrigin:null;let l=i.img!==void 0?i.img:null,h=i.src;Hi(!(h!==void 0&&l),"`image` and `src` cannot be provided at the same time"),(h===void 0||h.length===0)&&l&&(h=l.src||fi(l)),Hi(h!==void 0&&h.length>0,"A defined and non-empty `src` or `image` must be provided"),Hi(!((i.width!==void 0||i.height!==void 0)&&i.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let p;if(i.src!==void 0?p=xi.IDLE:l!==void 0&&(l instanceof HTMLImageElement?l.complete?p=l.src?xi.LOADED:xi.IDLE:p=xi.LOADING:p=xi.LOADED),this.color_=i.color!==void 0?Ra(i.color):null,this.iconImage_=Lv(l,h,this.crossOrigin_,p,this.color_),this.offset_=i.offset!==void 0?i.offset:[0,0],this.offsetOrigin_=i.offsetOrigin!==void 0?i.offsetOrigin:"top-left",this.origin_=null,this.size_=i.size!==void 0?i.size:null,i.width!==void 0||i.height!==void 0){let m,f;if(i.size)[m,f]=i.size;else{let g=this.getImage(1);if(g.width&&g.height)m=g.width,f=g.height;else if(g instanceof HTMLImageElement){this.initialOptions_=i;let y=()=>{if(this.unlistenImageChange(y),!this.initialOptions_)return;let _=this.iconImage_.getSize();this.setScale(jz(_[0],_[1],i.width,i.height))};this.listenImageChange(y);return}}m!==void 0&&this.setScale(jz(m,f,i.width,i.height))}}clone(){let i,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(i=this.getScale(),i=Array.isArray(i)?i.slice():i),new r({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:i,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let i=this.normalizedAnchor_;if(!i){i=this.anchor_;let o=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!o)return null;i=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(i[0]*=o[0]),this.anchorYUnits_=="fraction"&&(i[1]*=o[1])}if(this.anchorOrigin_!="top-left"){if(!o)return null;i===this.anchor_&&(i=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(i[0]=-i[0]+o[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(i[1]=-i[1]+o[1])}this.normalizedAnchor_=i}let e=this.getDisplacement(),n=this.getScaleArray();return[i[0]-e[0]/n[0],i[1]+e[1]/n[1]]}setAnchor(i){this.anchor_=i,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(i){return this.iconImage_.getImage(i)}getPixelRatio(i){return this.iconImage_.getPixelRatio(i)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let i=this.offset_;if(this.offsetOrigin_!="top-left"){let e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;i=i.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(i[0]=n[0]-e[0]-i[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(i[1]=n[1]-e[1]-i[1])}return this.origin_=i,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){let i=this.getScaleArray();if(this.size_)return this.size_[0]*i[0];if(this.iconImage_.getImageState()==xi.LOADED)return this.iconImage_.getSize()[0]*i[0]}getHeight(){let i=this.getScaleArray();if(this.size_)return this.size_[1]*i[1];if(this.iconImage_.getImageState()==xi.LOADED)return this.iconImage_.getSize()[1]*i[1]}setScale(i){delete this.initialOptions_,super.setScale(i)}listenImageChange(i){this.iconImage_.addEventListener(mi.CHANGE,i)}load(){this.iconImage_.load()}unlistenImageChange(i){this.iconImage_.removeEventListener(mi.CHANGE,i)}ready(){return this.iconImage_.ready()}},Bs=Wk;var Hk=class r{constructor(i){i=i||{},this.color_=i.color!==void 0?i.color:null,this.lineCap_=i.lineCap,this.lineDash_=i.lineDash!==void 0?i.lineDash:null,this.lineDashOffset_=i.lineDashOffset,this.lineJoin_=i.lineJoin,this.miterLimit_=i.miterLimit,this.width_=i.width}clone(){let i=this.getColor();return new r({color:Array.isArray(i)?i.slice():i||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(i){this.color_=i}setLineCap(i){this.lineCap_=i}setLineDash(i){this.lineDash_=i}setLineDashOffset(i){this.lineDashOffset_=i}setLineJoin(i){this.lineJoin_=i}setMiterLimit(i){this.miterLimit_=i}setWidth(i){this.width_=i}},ui=Hk;var z0=class r{constructor(i){i=i||{},this.geometry_=null,this.geometryFunction_=Vz,i.geometry!==void 0&&this.setGeometry(i.geometry),this.fill_=i.fill!==void 0?i.fill:null,this.image_=i.image!==void 0?i.image:null,this.renderer_=i.renderer!==void 0?i.renderer:null,this.hitDetectionRenderer_=i.hitDetectionRenderer!==void 0?i.hitDetectionRenderer:null,this.stroke_=i.stroke!==void 0?i.stroke:null,this.text_=i.text!==void 0?i.text:null,this.zIndex_=i.zIndex}clone(){let i=this.getGeometry();return i&&typeof i=="object"&&(i=i.clone()),new r({geometry:i??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(i){this.renderer_=i}setHitDetectionRenderer(i){this.hitDetectionRenderer_=i}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(i){this.fill_=i}getImage(){return this.image_}setImage(i){this.image_=i}getStroke(){return this.stroke_}setStroke(i){this.stroke_=i}getText(){return this.text_}setText(i){this.text_=i}getZIndex(){return this.zIndex_}setGeometry(i){typeof i=="function"?this.geometryFunction_=i:typeof i=="string"?this.geometryFunction_=function(e){return e.get(i)}:i?i!==void 0&&(this.geometryFunction_=function(){return i}):this.geometryFunction_=Vz,this.geometry_=i}setZIndex(i){this.zIndex_=i}};function Uz(r){let i;if(typeof r=="function")i=r;else{let e;Array.isArray(r)?e=r:(Hi(typeof r.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[r]),i=function(){return e}}return i}var qk=null;function zz(r,i){if(!qk){let e=new hi({color:"rgba(255,255,255,0.4)"}),n=new ui({color:"#3399CC",width:1.25});qk=[new z0({image:new an({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return qk}function Dv(){let r={},i=[255,255,255,1],e=[0,153,255,1],n=3;return r.Polygon=[new z0({fill:new hi({color:[255,255,255,.5]})})],r.MultiPolygon=r.Polygon,r.LineString=[new z0({stroke:new ui({color:i,width:n+2})}),new z0({stroke:new ui({color:e,width:n})})],r.MultiLineString=r.LineString,r.Circle=r.Polygon.concat(r.LineString),r.Point=[new z0({image:new an({radius:n*2,fill:new hi({color:e}),stroke:new ui({color:i,width:n/2})}),zIndex:1/0})],r.MultiPoint=r.Point,r.GeometryCollection=r.Polygon.concat(r.LineString,r.Point),r}function Vz(r){return r.getGeometry()}var oi=z0;var Cle="#333",Yk=class r{constructor(i){i=i||{},this.font_=i.font,this.rotation_=i.rotation,this.rotateWithView_=i.rotateWithView,this.scale_=i.scale,this.scaleArray_=Wo(i.scale!==void 0?i.scale:1),this.text_=i.text,this.textAlign_=i.textAlign,this.justify_=i.justify,this.repeat_=i.repeat,this.textBaseline_=i.textBaseline,this.fill_=i.fill!==void 0?i.fill:new hi({color:Cle}),this.maxAngle_=i.maxAngle!==void 0?i.maxAngle:Math.PI/4,this.placement_=i.placement!==void 0?i.placement:"point",this.overflow_=!!i.overflow,this.stroke_=i.stroke!==void 0?i.stroke:null,this.offsetX_=i.offsetX!==void 0?i.offsetX:0,this.offsetY_=i.offsetY!==void 0?i.offsetY:0,this.backgroundFill_=i.backgroundFill?i.backgroundFill:null,this.backgroundStroke_=i.backgroundStroke?i.backgroundStroke:null,this.padding_=i.padding===void 0?null:i.padding,this.declutterMode_=i.declutterMode}clone(){let i=this.getScale();return new r({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(i)?i.slice():i,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(i){this.overflow_=i}setFont(i){this.font_=i}setMaxAngle(i){this.maxAngle_=i}setOffsetX(i){this.offsetX_=i}setOffsetY(i){this.offsetY_=i}setPlacement(i){this.placement_=i}setRepeat(i){this.repeat_=i}setRotateWithView(i){this.rotateWithView_=i}setFill(i){this.fill_=i}setRotation(i){this.rotation_=i}setScale(i){this.scale_=i,this.scaleArray_=Wo(i!==void 0?i:1)}setStroke(i){this.stroke_=i}setText(i){this.text_=i}setTextAlign(i){this.textAlign_=i}setJustify(i){this.justify_=i}setTextBaseline(i){this.textBaseline_=i}setBackgroundFill(i){this.backgroundFill_=i}setBackgroundStroke(i){this.backgroundStroke_=i}setPadding(i){this.padding_=i}},so=Yk;var Hh={};m7(Hh,{EsriJSON:()=>jm,GML:()=>Ty,GPX:()=>sg,GeoJSON:()=>Qr,IGC:()=>t$,IIIFInfo:()=>r$,KML:()=>cg,MVT:()=>LS,OWS:()=>GI,Polyline:()=>G$,TopoJSON:()=>VI,WFS:()=>Wh,WKB:()=>zW,WKT:()=>_d,WMSCapabilities:()=>XI,WMSGetFeatureInfo:()=>DS,WMTSCapabilities:()=>KI});var Ale={Point:Ele,LineString:Tle,Polygon:kle,MultiPoint:Ple,MultiLineString:Fle,MultiPolygon:Lle},Mle={Point:Ole,LineString:Dle,Polygon:Rle,MultiPoint:Ble,MultiLineString:Nle,MultiPolygon:Gle},Zk=class extends Tv{constructor(i){i=i||{},super(),this.geometryName_=i.geometryName}readFeatureFromObject(i,e,n){let o=i,s=$z(o.geometry,e),l=new gi;if(this.geometryName_&&l.setGeometryName(this.geometryName_),l.setGeometry(s),o.attributes){l.setProperties(o.attributes,!0);let h=o.attributes[n];h!==void 0&&l.setId(h)}return l}readFeaturesFromObject(i,e){if(e=e||{},i.features){let n=i,o=[],s=n.features;for(let l=0,h=s.length;l<h;++l)o.push(this.readFeatureFromObject(s[l],e,i.objectIdFieldName));return o}return[this.readFeatureFromObject(i,e)]}readGeometryFromObject(i,e){return $z(i,e)}readProjectionFromObject(i){if(i.spatialReference&&i.spatialReference.wkid!==void 0){let n=i.spatialReference.wkid;return ni("EPSG:"+n)}return null}writeGeometryObject(i,e){return Wz(i,this.adaptOptions(e))}writeFeatureObject(i,e){e=this.adaptOptions(e);let n={};if(!i.hasProperties())return n.attributes={},n;let o=i.getProperties(),s=i.getGeometry();if(s){n.geometry=Wz(s,e);let l=e&&(e.dataProjection||e.featureProjection);l&&(n.geometry.spatialReference={wkid:Number(ni(l).getCode().split(":").pop())}),delete o[i.getGeometryName()]}return Bl(o)?n.attributes={}:n.attributes=o,n}writeFeaturesObject(i,e){e=this.adaptOptions(e);let n=[];for(let o=0,s=i.length;o<s;++o)n.push(this.writeFeatureObject(i[o],e));return{features:n}}};function $z(r,i){if(!r)return null;let e;if(typeof r.x=="number"&&typeof r.y=="number")e="Point";else if(r.points)e="MultiPoint";else if(r.paths)r.paths.length===1?e="LineString":e="MultiLineString";else if(r.rings){let o=r,s=Rv(o),l=Ile(o.rings,s);l.length===1?(e="Polygon",r=Object.assign({},r,{rings:l[0]})):(e="MultiPolygon",r=Object.assign({},r,{rings:l}))}let n=Ale[e];return xn(n(r),!1,i)}function Ile(r,i){let e=[],n=[],o=[],s,l;for(s=0,l=r.length;s<l;++s)e.length=0,Jf(e,0,r[s],i.length),fS(e,0,e.length,i.length)?n.push([r[s]]):o.push(r[s]);for(;o.length;){let h=o.shift(),p=!1;for(s=n.length-1;s>=0;s--){let m=n[s][0];if(Pa(new Om(m).getExtent(),new Om(h).getExtent())){n[s].push(h),p=!0;break}}p||n.push([h.reverse()])}return n}function Ele(r){let i;return r.m!==void 0&&r.z!==void 0?i=new Ii([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?i=new Ii([r.x,r.y,r.z],"XYZ"):r.m!==void 0?i=new Ii([r.x,r.y,r.m],"XYM"):i=new Ii([r.x,r.y]),i}function Tle(r){let i=Rv(r);return new Tr(r.paths[0],i)}function Fle(r){let i=Rv(r);return new Ko(r.paths,i)}function Rv(r){let i="XY";return r.hasZ===!0&&r.hasM===!0?i="XYZM":r.hasZ===!0?i="XYZ":r.hasM===!0&&(i="XYM"),i}function Ple(r){let i=Rv(r);return new tl(r.points,i)}function Lle(r){let i=Rv(r);return new es(r.rings,i)}function kle(r){let i=Rv(r);return new on(r.rings,i)}function Ole(r,i){let e=r.getCoordinates(),n,o=r.getLayout();if(o==="XYZ")n={x:e[0],y:e[1],z:e[2]};else if(o==="XYM")n={x:e[0],y:e[1],m:e[2]};else if(o==="XYZM")n={x:e[0],y:e[1],z:e[2],m:e[3]};else if(o==="XY")n={x:e[0],y:e[1]};else throw new Error("Invalid geometry layout");return n}function AS(r){let i=r.getLayout();return{hasZ:i==="XYZ"||i==="XYZM",hasM:i==="XYM"||i==="XYZM"}}function Dle(r,i){let e=AS(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:[r.getCoordinates()]}}function Rle(r,i){let e=AS(r);return{hasZ:e.hasZ,hasM:e.hasM,rings:r.getCoordinates(!1)}}function Nle(r,i){let e=AS(r);return{hasZ:e.hasZ,hasM:e.hasM,paths:r.getCoordinates()}}function Ble(r,i){let e=AS(r);return{hasZ:e.hasZ,hasM:e.hasM,points:r.getCoordinates()}}function Gle(r,i){let e=AS(r),n=r.getCoordinates(!1),o=[];for(let s=0;s<n.length;s++)for(let l=n[s].length-1;l>=0;l--)o.push(n[s][l]);return{hasZ:e.hasZ,hasM:e.hasM,rings:o}}function Wz(r,i){let e=Mle[r.getType()];return e(xn(r,!0,i),i)}var jm=Zk;var Ip="http://www.w3.org/2001/XMLSchema-instance";function Ar(r,i){return Iy().createElementNS(r,i)}function gl(r,i){return Hz(r,i,[]).join("")}function Hz(r,i,e){if(r.nodeType==Node.CDATA_SECTION_NODE||r.nodeType==Node.TEXT_NODE)i?e.push(String(r.nodeValue).replace(/(\r\n|\r|\n)/g,"")):e.push(r.nodeValue);else{let n;for(n=r.firstChild;n;n=n.nextSibling)Hz(n,i,e)}return e}function Fc(r){return"documentElement"in r}function qz(r,i,e){return r.getAttributeNS(i,e)||""}function Pc(r){return new DOMParser().parseFromString(r,"application/xml")}function My(r,i){return function(e,n){let o=r.call(i!==void 0?i:this,e,n);if(o!==void 0){let s=n[n.length-1];Cr(s,o)}}}function Mi(r,i){return function(e,n){let o=r.call(i!==void 0?i:this,e,n);o!==void 0&&n[n.length-1].push(o)}}function Ki(r,i){return function(e,n){let o=r.call(i!==void 0?i:this,e,n);o!==void 0&&(n[n.length-1]=o)}}function Fo(r,i,e){return function(n,o){let s=r.call(e!==void 0?e:this,n,o);if(s!==void 0){let l=o[o.length-1],h=i!==void 0?i:n.localName,p;h in l?p=l[h]:(p=[],l[h]=p),p.push(s)}}}function Xe(r,i,e){return function(n,o){let s=r.call(e!==void 0?e:this,n,o);if(s!==void 0){let l=o[o.length-1],h=i!==void 0?i:n.localName;l[h]=s}}}function it(r,i){return function(e,n,o){r.call(i!==void 0?i:this,e,n,o),o[o.length-1].node.appendChild(e)}}function Qk(r,i){let e,n;return function(o,s,l){if(e===void 0){e={};let h={};h[o.localName]=r,e[o.namespaceURI]=h,n=Ho(o.localName)}Yz(e,n,s,l)}}function Ho(r,i){return function(e,n,o){let l=n[n.length-1].node,h=r;h===void 0&&(h=o);let p=i!==void 0?i:l.namespaceURI;return Ar(p,h)}}var Gs=Ho();function nu(r,i){let e=i.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=r[i[o]];return n}function It(r,i,e){e=e!==void 0?e:{};let n,o;for(n=0,o=r.length;n<o;++n)e[r[n]]=i;return e}function zl(r,i,e,n){let o;for(o=i.firstElementChild;o;o=o.nextElementSibling){let s=r[o.namespaceURI];if(s!==void 0){let l=s[o.localName];l!==void 0&&l.call(n,o,e)}}}function Lt(r,i,e,n,o){return n.push(r),zl(i,e,n,o),n.pop()}function Yz(r,i,e,n,o,s){let l=(o!==void 0?o:e).length,h,p;for(let m=0;m<l;++m)h=e[m],h!==void 0&&(p=i.call(s!==void 0?s:this,h,n,o!==void 0?o[m]:void 0),p!==void 0&&r[p.namespaceURI][p.localName].call(s,p,h,n))}function yr(r,i,e,n,o,s,l){return o.push(r),Yz(i,e,n,o,s,l),o.pop()}var Xk;function Zz(){return Xk===void 0&&typeof XMLSerializer<"u"&&(Xk=new XMLSerializer),Xk}var Kk;function Iy(){return Kk===void 0&&typeof document<"u"&&(Kk=document.implementation.createDocument("","",null)),Kk}var Jk=class extends Dm{constructor(){super(),this.xmlSerializer_=Zz()}getType(){return"xml"}readFeature(i,e){if(!i)return null;if(typeof i=="string"){let n=Pc(i);return this.readFeatureFromDocument(n,e)}return Fc(i)?this.readFeatureFromDocument(i,e):this.readFeatureFromNode(i,e)}readFeatureFromDocument(i,e){let n=this.readFeaturesFromDocument(i,e);return n.length>0?n[0]:null}readFeatureFromNode(i,e){return null}readFeatures(i,e){if(!i)return[];if(typeof i=="string"){let n=Pc(i);return this.readFeaturesFromDocument(n,e)}return Fc(i)?this.readFeaturesFromDocument(i,e):this.readFeaturesFromNode(i,e)}readFeaturesFromDocument(i,e){let n=[];for(let o=i.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&Cr(n,this.readFeaturesFromNode(o,e));return n}readFeaturesFromNode(i,e){return Ti()}readGeometry(i,e){if(!i)return null;if(typeof i=="string"){let n=Pc(i);return this.readGeometryFromDocument(n,e)}return Fc(i)?this.readGeometryFromDocument(i,e):this.readGeometryFromNode(i,e)}readGeometryFromDocument(i,e){return null}readGeometryFromNode(i,e){return null}readProjection(i){if(!i)return null;if(typeof i=="string"){let e=Pc(i);return this.readProjectionFromDocument(e)}return Fc(i)?this.readProjectionFromDocument(i):this.readProjectionFromNode(i)}readProjectionFromDocument(i){return this.dataProjection}readProjectionFromNode(i){return this.dataProjection}writeFeature(i,e){let n=this.writeFeatureNode(i,e);return this.xmlSerializer_.serializeToString(n)}writeFeatureNode(i,e){return null}writeFeatures(i,e){let n=this.writeFeaturesNode(i,e);return this.xmlSerializer_.serializeToString(n)}writeFeaturesNode(i,e){return null}writeGeometry(i,e){let n=this.writeGeometryNode(i,e);return this.xmlSerializer_.serializeToString(n)}writeGeometryNode(i,e){return null}},jh=Jk;var Vh="http://www.opengis.net/gml",jle=/^\s*$/,cs=class extends jh{constructor(i){super(),i=i||{},this.featureType=i.featureType,this.featureNS=i.featureNS,this.srsName=i.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:Mi(this.readFeaturesInternal),featureMembers:Ki(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(i,e){let n=i.localName,o=null;if(n=="FeatureCollection")o=Lt([],this.FEATURE_COLLECTION_PARSERS,i,e,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){let s=e[0],l=s.featureType,h=s.featureNS,p="p",m="p0";if(!l&&i.childNodes){l=[],h={};for(let y=0,_=i.childNodes.length;y<_;++y){let w=i.childNodes[y];if(w.nodeType===1){let A=w.nodeName.split(":").pop();if(!l.includes(A)){let k="",R=0,q=w.namespaceURI;for(let X in h){if(h[X]===q){k=X;break}++R}k||(k=p+R,h[k]=q),l.push(k+":"+A)}}}n!="featureMember"&&(s.featureType=l,s.featureNS=h)}if(typeof h=="string"){let y=h;h={},h[m]=y}let f={},g=Array.isArray(l)?l:[l];for(let y in h){let _={};for(let w=0,A=g.length;w<A;++w)(g[w].includes(":")?g[w].split(":")[0]:m)===y&&(_[g[w].split(":").pop()]=n=="featureMembers"?Mi(this.readFeatureElement,this):Ki(this.readFeatureElement,this));f[h[y]]=_}n=="featureMember"||n=="member"?o=Lt(void 0,f,i,e):o=Lt([],f,i,e)}return o===null&&(o=[]),o}readGeometryOrExtent(i,e){let n=e[0];return n.srsName=i.firstElementChild.getAttribute("srsName"),n.srsDimension=i.firstElementChild.getAttribute("srsDimension"),Lt(null,this.GEOMETRY_PARSERS,i,e,this)}readExtentElement(i,e){let n=e[0],o=this.readGeometryOrExtent(i,e);return o?Ev(o,n):void 0}readGeometryElement(i,e){let n=e[0],o=this.readGeometryOrExtent(i,e);return o?xn(o,!1,n):void 0}readFeatureElementInternal(i,e,n){let o,s={};for(let p=i.firstElementChild;p;p=p.nextElementSibling){let m,f=p.localName;p.childNodes.length===0||p.childNodes.length===1&&(p.firstChild.nodeType===3||p.firstChild.nodeType===4)?(m=gl(p,!1),jle.test(m)&&(m=void 0)):(n&&(m=f==="boundedBy"?this.readExtentElement(p,e):this.readGeometryElement(p,e)),m?f!=="boundedBy"&&(o=f):m=this.readFeatureElementInternal(p,e,!1));let g=p.attributes.length;if(g>0&&!(m instanceof Av)){m={_content_:m};for(let y=0;y<g;y++){let _=p.attributes[y].name;m[_]=p.attributes[y].value}}s[f]?(s[f]instanceof Array||(s[f]=[s[f]]),s[f].push(m)):s[f]=m}if(!n)return s;let l=new gi(s);o&&l.setGeometryName(o);let h=i.getAttribute("fid")||qz(i,this.namespace,"id");return h&&l.setId(h),l}readFeatureElement(i,e){return this.readFeatureElementInternal(i,e,!0)}readPoint(i,e){let n=this.readFlatCoordinatesFromNode(i,e);if(n)return new Ii(n,"XYZ")}readMultiPoint(i,e){let n=Lt([],this.MULTIPOINT_PARSERS,i,e,this);if(n)return new tl(n)}readMultiLineString(i,e){let n=Lt([],this.MULTILINESTRING_PARSERS,i,e,this);if(n)return new Ko(n)}readMultiPolygon(i,e){let n=Lt([],this.MULTIPOLYGON_PARSERS,i,e,this);if(n)return new es(n)}pointMemberParser(i,e){zl(this.POINTMEMBER_PARSERS,i,e,this)}lineStringMemberParser(i,e){zl(this.LINESTRINGMEMBER_PARSERS,i,e,this)}polygonMemberParser(i,e){zl(this.POLYGONMEMBER_PARSERS,i,e,this)}readLineString(i,e){let n=this.readFlatCoordinatesFromNode(i,e);if(n)return new Tr(n,"XYZ")}readFlatLinearRing(i,e){let n=Lt(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,i,e,this);if(n)return n}readLinearRing(i,e){let n=this.readFlatCoordinatesFromNode(i,e);if(n)return new Om(n,"XYZ")}readPolygon(i,e){let n=Lt([null],this.FLAT_LINEAR_RINGS_PARSERS,i,e,this);if(n&&n[0]){let o=n[0],s=[o.length],l,h;for(l=1,h=n.length;l<h;++l)Cr(o,n[l]),s.push(o.length);return new on(o,"XYZ",s)}}readFlatCoordinatesFromNode(i,e){return Lt(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,i,e,this)}readGeometryFromNode(i,e){let n=this.readGeometryElement(i,[this.getReadOptions(i,e||{})]);return n||null}readFeaturesFromNode(i,e){let n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(i,e)),this.readFeaturesInternal(i,[n])||[]}readProjectionFromNode(i){return ni(this.srsName?this.srsName:i.firstElementChild.getAttribute("srsName"))}};cs.prototype.namespace=Vh;cs.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};cs.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};cs.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};cs.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:Mi(cs.prototype.pointMemberParser),pointMembers:Mi(cs.prototype.pointMemberParser)}};cs.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:Mi(cs.prototype.lineStringMemberParser),lineStringMembers:Mi(cs.prototype.lineStringMemberParser)}};cs.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:Mi(cs.prototype.polygonMemberParser),polygonMembers:Mi(cs.prototype.polygonMemberParser)}};cs.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:Mi(cs.prototype.readFlatCoordinatesFromNode)}};cs.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Mi(cs.prototype.readLineString)}};cs.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Mi(cs.prototype.readPolygon)}};cs.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Ki(cs.prototype.readFlatLinearRing)}};var Jr=cs;function ag(r){let i=gl(r,!1);return $0(i)}function $0(r){let i=/^\s*(true|1)|(false|0)\s*$/.exec(r);if(i)return i[1]!==void 0||!1}function MS(r){let i=gl(r,!1),e=Date.parse(i);return isNaN(e)?void 0:e/1e3}function hn(r){let i=gl(r,!1);return Vm(i)}function Vm(r){let i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(r);if(i)return parseFloat(i[1])}function Na(r){let i=gl(r,!1);return Uh(i)}function Uh(r){let i=/^\s*(\d+)\s*$/.exec(r);if(i)return parseInt(i[1],10)}function zt(r){return gl(r,!1).trim()}function Ey(r,i){hr(r,i?"1":"0")}function Xz(r,i){r.appendChild(Iy().createCDATASection(i))}function Kz(r,i){let e=new Date(i*1e3),n=e.getUTCFullYear()+"-"+Y1(e.getUTCMonth()+1,2)+"-"+Y1(e.getUTCDate(),2)+"T"+Y1(e.getUTCHours(),2)+":"+Y1(e.getUTCMinutes(),2)+":"+Y1(e.getUTCSeconds(),2)+"Z";r.appendChild(Iy().createTextNode(n))}function ou(r,i){let e=i.toPrecision();r.appendChild(Iy().createTextNode(e))}function IS(r,i){let e=i.toString();r.appendChild(Iy().createTextNode(e))}function hr(r,i){r.appendChild(Iy().createTextNode(i))}var Vle=Vh+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Ule={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Dn=class extends Jr{constructor(i){i=i||{},super(i),this.FEATURE_COLLECTION_PARSERS[Vh].featureMember=Mi(this.readFeaturesInternal),this.schemaLocation=i.schemaLocation?i.schemaLocation:Vle}readFlatCoordinates(i,e){let n=gl(i,!1).replace(/^\s*|\s*$/g,""),s=e[0].srsName,l="enu";if(s){let m=ni(s);m&&(l=m.getAxisOrientation())}let h=n.trim().split(/\s+/),p=[];for(let m=0,f=h.length;m<f;m++){let g=h[m].split(/,+/),y=parseFloat(g[0]),_=parseFloat(g[1]),w=g.length===3?parseFloat(g[2]):0;l.substr(0,2)==="en"?p.push(y,_,w):p.push(_,y,w)}return p}readBox(i,e){let n=Lt([null],this.BOX_PARSERS_,i,e,this);return jl(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(i,e){let n=Lt(void 0,this.RING_PARSERS,i,e,this);n&&e[e.length-1].push(n)}outerBoundaryIsParser(i,e){let n=Lt(void 0,this.RING_PARSERS,i,e,this);if(n){let o=e[e.length-1];o[0]=n}}GEOMETRY_NODE_FACTORY_(i,e,n){let o=e[e.length-1],s=o.multiSurface,l=o.surface,h=o.multiCurve;return Array.isArray(i)?n="Envelope":(n=i.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&l===!0?n="Surface":n==="MultiLineString"&&h===!0&&(n="MultiCurve")),Ar("http://www.opengis.net/gml",n)}writeFeatureElement(i,e,n){let o=e.getId();o&&i.setAttribute("fid",o);let s=n[n.length-1],l=s.featureNS,h=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[l]={});let p=[],m=[];if(e.hasProperties()){let g=e.getProperties();for(let y in g){let _=g[y];_!==null&&(p.push(y),m.push(_),y==h||typeof _.getSimplifiedGeometry=="function"?y in s.serializers[l]||(s.serializers[l][y]=it(this.writeGeometryElement,this)):y in s.serializers[l]||(s.serializers[l][y]=it(hr)))}}let f=Object.assign({},s);f.node=i,yr(f,s.serializers,Ho(void 0,l),m,n,p)}writeCurveOrLineString(i,e,n){let s=n[n.length-1].srsName;if(i.nodeName!=="LineStringSegment"&&s&&i.setAttribute("srsName",s),i.nodeName==="LineString"||i.nodeName==="LineStringSegment"){let l=this.createCoordinatesNode_(i.namespaceURI);i.appendChild(l),this.writeCoordinates_(l,e,n)}else if(i.nodeName==="Curve"){let l=Ar(i.namespaceURI,"segments");i.appendChild(l),this.writeCurveSegments_(l,e,n)}}writeLineStringOrCurveMember(i,e,n){let o=this.GEOMETRY_NODE_FACTORY_(e,n);o&&(i.appendChild(o),this.writeCurveOrLineString(o,e,n))}writeMultiCurveOrLineString(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName,h=o.curve;l&&i.setAttribute("srsName",l);let p=e.getLineStrings();yr({node:i,hasZ:s,srsName:l,curve:h},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,n,void 0,this)}writeGeometryElement(i,e,n){let o=n[n.length-1],s=Object.assign({},o);s.node=i;let l;Array.isArray(e)?l=Ev(e,o):l=xn(e,!0,o),yr(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[l],n,void 0,this)}createCoordinatesNode_(i){let e=Ar(i,"coordinates");return e.setAttribute("decimal","."),e.setAttribute("cs",","),e.setAttribute("ts"," "),e}writeCoordinates_(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName,h=e.getCoordinates(),p=h.length,m=new Array(p);for(let f=0;f<p;++f){let g=h[f];m[f]=this.getCoords_(g,l,s)}hr(i,m.join(" "))}writeCurveSegments_(i,e,n){let o=Ar(i.namespaceURI,"LineStringSegment");i.appendChild(o),this.writeCurveOrLineString(o,e,n)}writeSurfaceOrPolygon(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName;if(i.nodeName!=="PolygonPatch"&&l&&i.setAttribute("srsName",l),i.nodeName==="Polygon"||i.nodeName==="PolygonPatch"){let h=e.getLinearRings();yr({node:i,hasZ:s,srsName:l},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,h,n,void 0,this)}else if(i.nodeName==="Surface"){let h=Ar(i.namespaceURI,"patches");i.appendChild(h),this.writeSurfacePatches_(h,e,n)}}RING_NODE_FACTORY_(i,e,n){let o=e[e.length-1],s=o.node,l=o.exteriorWritten;return l===void 0&&(o.exteriorWritten=!0),Ar(s.namespaceURI,l!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(i,e,n){let o=Ar(i.namespaceURI,"PolygonPatch");i.appendChild(o),this.writeSurfaceOrPolygon(o,e,n)}writeRing(i,e,n){let o=Ar(i.namespaceURI,"LinearRing");i.appendChild(o),this.writeLinearRing(o,e,n)}getCoords_(i,e,n){let o="enu";e&&(o=ni(e).getAxisOrientation());let s=o.substr(0,2)==="en"?i[0]+","+i[1]:i[1]+","+i[0];if(n){let l=i[2]||0;s+=","+l}return s}writePoint(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName;l&&i.setAttribute("srsName",l);let h=this.createCoordinatesNode_(i.namespaceURI);i.appendChild(h);let p=e.getCoordinates(),m=this.getCoords_(p,l,s);hr(h,m)}writeMultiPoint(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName;l&&i.setAttribute("srsName",l);let h=e.getPoints();yr({node:i,hasZ:s,srsName:l},this.POINTMEMBER_SERIALIZERS,Ho("pointMember"),h,n,void 0,this)}writePointMember(i,e,n){let o=Ar(i.namespaceURI,"Point");i.appendChild(o),this.writePoint(o,e,n)}writeLinearRing(i,e,n){let s=n[n.length-1].srsName;s&&i.setAttribute("srsName",s);let l=this.createCoordinatesNode_(i.namespaceURI);i.appendChild(l),this.writeCoordinates_(l,e,n)}writeMultiSurfaceOrPolygon(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName,h=o.surface;l&&i.setAttribute("srsName",l);let p=e.getPolygons();yr({node:i,hasZ:s,srsName:l,surface:h},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,n,void 0,this)}writeSurfaceOrPolygonMember(i,e,n){let o=this.GEOMETRY_NODE_FACTORY_(e,n);o&&(i.appendChild(o),this.writeSurfaceOrPolygon(o,e,n))}writeEnvelope(i,e,n){let s=n[n.length-1].srsName;s&&i.setAttribute("srsName",s);let l=["lowerCorner","upperCorner"],h=[e[0]+" "+e[1],e[2]+" "+e[3]];yr({node:i},this.ENVELOPE_SERIALIZERS,Gs,h,n,l,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(i,e,n){let o=e[e.length-1].node;return Ar("http://www.opengis.net/gml",Ule[o.nodeName])}};Dn.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:Ki(Dn.prototype.readFlatCoordinates)}};Dn.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:Dn.prototype.innerBoundaryIsParser,outerBoundaryIs:Dn.prototype.outerBoundaryIsParser}};Dn.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:Mi(Dn.prototype.readFlatCoordinates)}};Dn.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Ki(Jr.prototype.readPoint),MultiPoint:Ki(Jr.prototype.readMultiPoint),LineString:Ki(Jr.prototype.readLineString),MultiLineString:Ki(Jr.prototype.readMultiLineString),LinearRing:Ki(Jr.prototype.readLinearRing),Polygon:Ki(Jr.prototype.readPolygon),MultiPolygon:Ki(Jr.prototype.readMultiPolygon),Box:Ki(Dn.prototype.readBox)}};Dn.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:it(Dn.prototype.writeCurveOrLineString),MultiCurve:it(Dn.prototype.writeMultiCurveOrLineString),Point:it(Dn.prototype.writePoint),MultiPoint:it(Dn.prototype.writeMultiPoint),LineString:it(Dn.prototype.writeCurveOrLineString),MultiLineString:it(Dn.prototype.writeMultiCurveOrLineString),LinearRing:it(Dn.prototype.writeLinearRing),Polygon:it(Dn.prototype.writeSurfaceOrPolygon),MultiPolygon:it(Dn.prototype.writeMultiSurfaceOrPolygon),Surface:it(Dn.prototype.writeSurfaceOrPolygon),MultiSurface:it(Dn.prototype.writeMultiSurfaceOrPolygon),Envelope:it(Dn.prototype.writeEnvelope)}};Dn.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:it(Dn.prototype.writeLineStringOrCurveMember),curveMember:it(Dn.prototype.writeLineStringOrCurveMember)}};Dn.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:it(Dn.prototype.writeRing),innerBoundaryIs:it(Dn.prototype.writeRing)}};Dn.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:it(Dn.prototype.writePointMember)}};Dn.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:it(Dn.prototype.writeSurfaceOrPolygonMember),polygonMember:it(Dn.prototype.writeSurfaceOrPolygonMember)}};Dn.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:it(hr),upperCorner:it(hr)}};var Fu=Dn;var zle=Vh+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",$le={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Bi=class extends Jr{constructor(i){i=i||{},super(i),this.surface_=i.surface!==void 0?i.surface:!1,this.curve_=i.curve!==void 0?i.curve:!1,this.multiCurve_=i.multiCurve!==void 0?i.multiCurve:!0,this.multiSurface_=i.multiSurface!==void 0?i.multiSurface:!0,this.schemaLocation=i.schemaLocation?i.schemaLocation:zle,this.hasZ=i.hasZ!==void 0?i.hasZ:!1}readMultiCurve(i,e){let n=Lt([],this.MULTICURVE_PARSERS,i,e,this);if(n)return new Ko(n)}readFlatCurveRing(i,e){let n=Lt([],this.MULTICURVE_PARSERS,i,e,this),o=[];for(let s=0,l=n.length;s<l;++s)Cr(o,n[s].getFlatCoordinates());return o}readMultiSurface(i,e){let n=Lt([],this.MULTISURFACE_PARSERS,i,e,this);if(n)return new es(n)}curveMemberParser(i,e){zl(this.CURVEMEMBER_PARSERS,i,e,this)}surfaceMemberParser(i,e){zl(this.SURFACEMEMBER_PARSERS,i,e,this)}readPatch(i,e){return Lt([null],this.PATCHES_PARSERS,i,e,this)}readSegment(i,e){return Lt([],this.SEGMENTS_PARSERS,i,e,this)}readPolygonPatch(i,e){return Lt([null],this.FLAT_LINEAR_RINGS_PARSERS,i,e,this)}readLineStringSegment(i,e){return Lt([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,i,e,this)}interiorParser(i,e){let n=Lt(void 0,this.RING_PARSERS,i,e,this);n&&e[e.length-1].push(n)}exteriorParser(i,e){let n=Lt(void 0,this.RING_PARSERS,i,e,this);if(n){let o=e[e.length-1];o[0]=n}}readSurface(i,e){let n=Lt([null],this.SURFACE_PARSERS,i,e,this);if(n&&n[0]){let o=n[0],s=[o.length],l,h;for(l=1,h=n.length;l<h;++l)Cr(o,n[l]),s.push(o.length);return new on(o,"XYZ",s)}}readCurve(i,e){let n=Lt([null],this.CURVE_PARSERS,i,e,this);if(n)return new Tr(n,"XYZ")}readEnvelope(i,e){let n=Lt([null],this.ENVELOPE_PARSERS,i,e,this);return jl(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(i,e){let n=gl(i,!1),o=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[],l;for(;l=o.exec(n);)s.push(parseFloat(l[1])),n=n.substr(l[0].length);if(n!=="")return;let p=e[0].srsName,m="enu";if(p&&(m=ni(p).getAxisOrientation()),m==="neu"){let g,y;for(g=0,y=s.length;g<y;g+=3){let _=s[g],w=s[g+1];s[g]=w,s[g+1]=_}}let f=s.length;if(f==2&&s.push(0),f!==0)return s}readFlatPosList(i,e){let n=gl(i,!1).replace(/^\s*|\s*$/g,""),o=e[0],s=o.srsName,l=o.srsDimension,h="enu";s&&(h=ni(s).getAxisOrientation());let p=n.split(/\s+/),m=2;i.getAttribute("srsDimension")?m=Uh(i.getAttribute("srsDimension")):i.getAttribute("dimension")?m=Uh(i.getAttribute("dimension")):i.parentNode.getAttribute("srsDimension")?m=Uh(i.parentNode.getAttribute("srsDimension")):l&&(m=Uh(l));let f,g,y,_=[];for(let w=0,A=p.length;w<A;w+=m)f=parseFloat(p[w]),g=parseFloat(p[w+1]),y=m===3?parseFloat(p[w+2]):0,h.substr(0,2)==="en"?_.push(f,g,y):_.push(g,f,y);return _}writePos_(i,e,n){let o=n[n.length-1],s=o.hasZ,l=s?"3":"2";i.setAttribute("srsDimension",l);let h=o.srsName,p="enu";h&&(p=ni(h).getAxisOrientation());let m=e.getCoordinates(),f;if(p.substr(0,2)==="en"?f=m[0]+" "+m[1]:f=m[1]+" "+m[0],s){let g=m[2]||0;f+=" "+g}hr(i,f)}getCoords_(i,e,n){let o="enu";e&&(o=ni(e).getAxisOrientation());let s=o.substr(0,2)==="en"?i[0]+" "+i[1]:i[1]+" "+i[0];if(n){let l=i[2]||0;s+=" "+l}return s}writePosList_(i,e,n){let o=n[n.length-1],s=o.hasZ,l=s?"3":"2";i.setAttribute("srsDimension",l);let h=o.srsName,p=e.getCoordinates(),m=p.length,f=new Array(m),g;for(let y=0;y<m;++y)g=p[y],f[y]=this.getCoords_(g,h,s);hr(i,f.join(" "))}writePoint(i,e,n){let s=n[n.length-1].srsName;s&&i.setAttribute("srsName",s);let l=Ar(i.namespaceURI,"pos");i.appendChild(l),this.writePos_(l,e,n)}writeEnvelope(i,e,n){let s=n[n.length-1].srsName;s&&i.setAttribute("srsName",s);let l=["lowerCorner","upperCorner"],h=[e[0]+" "+e[1],e[2]+" "+e[3]];yr({node:i},this.ENVELOPE_SERIALIZERS,Gs,h,n,l,this)}writeLinearRing(i,e,n){let s=n[n.length-1].srsName;s&&i.setAttribute("srsName",s);let l=Ar(i.namespaceURI,"posList");i.appendChild(l),this.writePosList_(l,e,n)}RING_NODE_FACTORY_(i,e,n){let o=e[e.length-1],s=o.node,l=o.exteriorWritten;return l===void 0&&(o.exteriorWritten=!0),Ar(s.namespaceURI,l!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName;if(i.nodeName!=="PolygonPatch"&&l&&i.setAttribute("srsName",l),i.nodeName==="Polygon"||i.nodeName==="PolygonPatch"){let h=e.getLinearRings();yr({node:i,hasZ:s,srsName:l},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,h,n,void 0,this)}else if(i.nodeName==="Surface"){let h=Ar(i.namespaceURI,"patches");i.appendChild(h),this.writeSurfacePatches_(h,e,n)}}writeCurveOrLineString(i,e,n){let s=n[n.length-1].srsName;if(i.nodeName!=="LineStringSegment"&&s&&i.setAttribute("srsName",s),i.nodeName==="LineString"||i.nodeName==="LineStringSegment"){let l=Ar(i.namespaceURI,"posList");i.appendChild(l),this.writePosList_(l,e,n)}else if(i.nodeName==="Curve"){let l=Ar(i.namespaceURI,"segments");i.appendChild(l),this.writeCurveSegments_(l,e,n)}}writeMultiSurfaceOrPolygon(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName,h=o.surface;l&&i.setAttribute("srsName",l);let p=e.getPolygons();yr({node:i,hasZ:s,srsName:l,surface:h},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,n,void 0,this)}writeMultiPoint(i,e,n){let o=n[n.length-1],s=o.srsName,l=o.hasZ;s&&i.setAttribute("srsName",s);let h=e.getPoints();yr({node:i,hasZ:l,srsName:s},this.POINTMEMBER_SERIALIZERS,Ho("pointMember"),h,n,void 0,this)}writeMultiCurveOrLineString(i,e,n){let o=n[n.length-1],s=o.hasZ,l=o.srsName,h=o.curve;l&&i.setAttribute("srsName",l);let p=e.getLineStrings();yr({node:i,hasZ:s,srsName:l,curve:h},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,p,n,void 0,this)}writeRing(i,e,n){let o=Ar(i.namespaceURI,"LinearRing");i.appendChild(o),this.writeLinearRing(o,e,n)}writeSurfaceOrPolygonMember(i,e,n){let o=this.GEOMETRY_NODE_FACTORY_(e,n);o&&(i.appendChild(o),this.writeSurfaceOrPolygon(o,e,n))}writePointMember(i,e,n){let o=Ar(i.namespaceURI,"Point");i.appendChild(o),this.writePoint(o,e,n)}writeLineStringOrCurveMember(i,e,n){let o=this.GEOMETRY_NODE_FACTORY_(e,n);o&&(i.appendChild(o),this.writeCurveOrLineString(o,e,n))}writeSurfacePatches_(i,e,n){let o=Ar(i.namespaceURI,"PolygonPatch");i.appendChild(o),this.writeSurfaceOrPolygon(o,e,n)}writeCurveSegments_(i,e,n){let o=Ar(i.namespaceURI,"LineStringSegment");i.appendChild(o),this.writeCurveOrLineString(o,e,n)}writeGeometryElement(i,e,n){let o=n[n.length-1],s=Object.assign({},o);s.node=i;let l;Array.isArray(e)?l=Ev(e,o):l=xn(e,!0,o),yr(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[l],n,void 0,this)}writeFeatureElement(i,e,n){let o=e.getId();o&&i.setAttribute("fid",o);let s=n[n.length-1],l=s.featureNS,h=e.getGeometryName();s.serializers||(s.serializers={},s.serializers[l]={});let p=[],m=[];if(e.hasProperties()){let g=e.getProperties();for(let y in g){let _=g[y];_!==null&&(p.push(y),m.push(_),y==h||typeof _.getSimplifiedGeometry=="function"?y in s.serializers[l]||(s.serializers[l][y]=it(this.writeGeometryElement,this)):y in s.serializers[l]||(s.serializers[l][y]=it(hr)))}}let f=Object.assign({},s);f.node=i,yr(f,s.serializers,Ho(void 0,l),m,n,p)}writeFeatureMembers_(i,e,n){let o=n[n.length-1],s=o.featureType,l=o.featureNS,h={};h[l]={},h[l][s]=it(this.writeFeatureElement,this);let p=Object.assign({},o);p.node=i,yr(p,h,Ho(s,l),e,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(i,e,n){let o=e[e.length-1].node;return Ar(this.namespace,$le[o.nodeName])}GEOMETRY_NODE_FACTORY_(i,e,n){let o=e[e.length-1],s=o.multiSurface,l=o.surface,h=o.curve,p=o.multiCurve;return Array.isArray(i)?n="Envelope":(n=i.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&l===!0?n="Surface":n==="LineString"&&h===!0?n="Curve":n==="MultiLineString"&&p===!0&&(n="MultiCurve")),Ar(this.namespace,n)}writeGeometryNode(i,e){e=this.adaptOptions(e);let n=Ar(this.namespace,"geom"),o={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return e&&Object.assign(o,e),this.writeGeometryElement(n,i,[o]),n}writeFeaturesNode(i,e){e=this.adaptOptions(e);let n=Ar(this.namespace,"featureMembers");n.setAttributeNS(Ip,"xsi:schemaLocation",this.schemaLocation);let o={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return e&&Object.assign(o,e),this.writeFeatureMembers_(n,i,[o]),n}};Bi.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:Ki(Bi.prototype.readFlatPos),posList:Ki(Bi.prototype.readFlatPosList),coordinates:Ki(Fu.prototype.readFlatCoordinates)}};Bi.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Bi.prototype.interiorParser,exterior:Bi.prototype.exteriorParser}};Bi.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:Ki(Jr.prototype.readPoint),MultiPoint:Ki(Jr.prototype.readMultiPoint),LineString:Ki(Jr.prototype.readLineString),MultiLineString:Ki(Jr.prototype.readMultiLineString),LinearRing:Ki(Jr.prototype.readLinearRing),Polygon:Ki(Jr.prototype.readPolygon),MultiPolygon:Ki(Jr.prototype.readMultiPolygon),Surface:Ki(Bi.prototype.readSurface),MultiSurface:Ki(Bi.prototype.readMultiSurface),Curve:Ki(Bi.prototype.readCurve),MultiCurve:Ki(Bi.prototype.readMultiCurve),Envelope:Ki(Bi.prototype.readEnvelope)}};Bi.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:Mi(Bi.prototype.curveMemberParser),curveMembers:Mi(Bi.prototype.curveMemberParser)}};Bi.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:Mi(Bi.prototype.surfaceMemberParser),surfaceMembers:Mi(Bi.prototype.surfaceMemberParser)}};Bi.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:Mi(Jr.prototype.readLineString),Curve:Mi(Bi.prototype.readCurve)}};Bi.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:Mi(Jr.prototype.readPolygon),Surface:Mi(Bi.prototype.readSurface)}};Bi.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:Ki(Bi.prototype.readPatch)}};Bi.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:Ki(Bi.prototype.readSegment)}};Bi.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:Mi(Bi.prototype.readFlatPosList),upperCorner:Mi(Bi.prototype.readFlatPosList)}};Bi.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:Ki(Bi.prototype.readPolygonPatch)}};Bi.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:My(Bi.prototype.readLineStringSegment)}};Jr.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:Ki(Jr.prototype.readFlatLinearRing),Ring:Ki(Bi.prototype.readFlatCurveRing)}};Bi.prototype.writeFeatures;Bi.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:it(Bi.prototype.writeRing),interior:it(Bi.prototype.writeRing)}};Bi.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:it(hr),upperCorner:it(hr)}};Bi.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:it(Bi.prototype.writeSurfaceOrPolygonMember),polygonMember:it(Bi.prototype.writeSurfaceOrPolygonMember)}};Bi.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:it(Bi.prototype.writePointMember)}};Bi.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:it(Bi.prototype.writeLineStringOrCurveMember),curveMember:it(Bi.prototype.writeLineStringOrCurveMember)}};Bi.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:it(Bi.prototype.writeCurveOrLineString),MultiCurve:it(Bi.prototype.writeMultiCurveOrLineString),Point:it(Bi.prototype.writePoint),MultiPoint:it(Bi.prototype.writeMultiPoint),LineString:it(Bi.prototype.writeCurveOrLineString),MultiLineString:it(Bi.prototype.writeMultiCurveOrLineString),LinearRing:it(Bi.prototype.writeLinearRing),Polygon:it(Bi.prototype.writeSurfaceOrPolygon),MultiPolygon:it(Bi.prototype.writeMultiSurfaceOrPolygon),Surface:it(Bi.prototype.writeSurfaceOrPolygon),MultiSurface:it(Bi.prototype.writeMultiSurfaceOrPolygon),Envelope:it(Bi.prototype.writeEnvelope)}};var Ur=Bi;var eO=Ur;eO.prototype.writeFeatures;eO.prototype.writeFeaturesNode;var Ty=eO;var ts=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Wle="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Hle={rte:Qz,trk:Jz,wpt:e$},qle=It(ts,{rte:Mi(Qz),trk:Mi(Jz),wpt:Mi(e$)}),Yle=It(ts,{text:Xe(zt,"linkText"),type:Xe(zt,"linkType")}),Zle=It(ts,{name:Xe(zt),email:wce,link:ES}),Xle=It(ts,{name:Xe(zt),desc:Xe(zt),author:Xe(yce),copyright:Xe(vce),link:ES,time:Xe(MS),keywords:Xe(zt),bounds:bce,extensions:MI}),Kle=It(ts,{year:Xe(Na),license:Xe(zt)}),Qle=It(ts,{rte:it(Ace),trk:it(Mce),wpt:it(Ece)}),tO=class extends jh{constructor(i){super(),i=i||{},this.dataProjection=ni("EPSG:4326"),this.readExtensions_=i.readExtensions}handleReadExtensions_(i){i||(i=[]);for(let e=0,n=i.length;e<n;++e){let o=i[e];if(this.readExtensions_){let s=o.get("extensionsNode_")||null;this.readExtensions_(o,s)}o.set("extensionsNode_",void 0)}}readMetadata(i){return i?typeof i=="string"?this.readMetadataFromDocument(Pc(i)):Fc(i)?this.readMetadataFromDocument(i):this.readMetadataFromNode(i):null}readMetadataFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType===Node.ELEMENT_NODE){let n=this.readMetadataFromNode(e);if(n)return n}return null}readMetadataFromNode(i){if(!ts.includes(i.namespaceURI))return null;for(let e=i.firstElementChild;e;e=e.nextElementSibling)if(ts.includes(e.namespaceURI)&&e.localName==="metadata")return Lt({},Xle,e,[]);return null}readFeatureFromNode(i,e){if(!ts.includes(i.namespaceURI))return null;let n=Hle[i.localName];if(!n)return null;let o=n(i,[this.getReadOptions(i,e)]);return o?(this.handleReadExtensions_([o]),o):null}readFeaturesFromNode(i,e){if(!ts.includes(i.namespaceURI))return[];if(i.localName=="gpx"){let n=Lt([],qle,i,[this.getReadOptions(i,e)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(i,e){e=this.adaptOptions(e);let n=Ar("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Ip),n.setAttributeNS(Ip,"xsi:schemaLocation",Wle),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),yr({node:n},Qle,_ce,i,[e]),n}},Jle=It(ts,{name:Xe(zt),cmt:Xe(zt),desc:Xe(zt),src:Xe(zt),link:ES,number:Xe(Na),extensions:MI,type:Xe(zt),rtept:xce}),ece=It(ts,{ele:Xe(hn),time:Xe(MS)}),tce=It(ts,{name:Xe(zt),cmt:Xe(zt),desc:Xe(zt),src:Xe(zt),link:ES,number:Xe(Na),type:Xe(zt),extensions:MI,trkseg:Cce}),ice=It(ts,{trkpt:Sce}),rce=It(ts,{ele:Xe(hn),time:Xe(MS)}),nce=It(ts,{ele:Xe(hn),time:Xe(MS),magvar:Xe(hn),geoidheight:Xe(hn),name:Xe(zt),cmt:Xe(zt),desc:Xe(zt),src:Xe(zt),link:ES,sym:Xe(zt),type:Xe(zt),fix:Xe(zt),sat:Xe(Na),hdop:Xe(hn),vdop:Xe(hn),pdop:Xe(hn),ageofdgpsdata:Xe(hn),dgpsid:Xe(Na),extensions:MI}),oce=["text","type"],ace=It(ts,{text:it(hr),type:it(hr)}),sce=It(ts,["name","cmt","desc","src","link","number","type","rtept"]),lce=It(ts,{name:it(hr),cmt:it(hr),desc:it(hr),src:it(hr),link:it(nO),number:it(IS),type:it(hr),rtept:Qk(it(oO))}),cce=It(ts,["ele","time"]),uce=It(ts,["name","cmt","desc","src","link","number","type","trkseg"]),dce=It(ts,{name:it(hr),cmt:it(hr),desc:it(hr),src:it(hr),link:it(nO),number:it(IS),type:it(hr),trkseg:Qk(it(Ice))}),hce=Ho("trkpt"),pce=It(ts,{trkpt:it(oO)}),mce=It(ts,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),fce=It(ts,{ele:it(ou),time:it(Kz),magvar:it(ou),geoidheight:it(ou),name:it(hr),cmt:it(hr),desc:it(hr),src:it(hr),link:it(nO),sym:it(hr),type:it(hr),fix:it(hr),sat:it(IS),hdop:it(ou),vdop:it(ou),pdop:it(ou),ageofdgpsdata:it(ou),dgpsid:it(IS)}),gce={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function _ce(r,i,e){let n=r.getGeometry();if(n){let o=gce[n.getType()];if(o){let s=i[i.length-1].node;return Ar(s.namespaceURI,o)}}}function iO(r,i,e,n){return r.push(parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,i.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,i.hasM=!0):r.push(0),r}function rO(r,i,e){let n="XY",o=2;if(r.hasZ&&r.hasM?(n="XYZM",o=4):r.hasZ?(n="XYZ",o=3):r.hasM&&(n="XYM",o=3),o!==4){for(let s=0,l=i.length/4;s<l;s++)i[s*o]=i[s*4],i[s*o+1]=i[s*4+1],r.hasZ&&(i[s*o+2]=i[s*4+2]),r.hasM&&(i[s*o+2]=i[s*4+3]);if(i.length=i.length/4*o,e)for(let s=0,l=e.length;s<l;s++)e[s]=e[s]/4*o}return n}function yce(r,i){let e=Lt({},Zle,r,i);if(e)return e}function vce(r,i){let e=Lt({},Kle,r,i);if(e){let n=r.getAttribute("author");return n!==null&&(e.author=n),e}}function bce(r,i){let e=i[i.length-1],n=r.getAttribute("minlat"),o=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),l=r.getAttribute("maxlon");o!==null&&n!==null&&l!==null&&s!==null&&(e.bounds=[[parseFloat(o),parseFloat(n)],[parseFloat(l),parseFloat(s)]])}function wce(r,i){let e=i[i.length-1],n=r.getAttribute("id"),o=r.getAttribute("domain");n!==null&&o!==null&&(e.email=`${n}@${o}`)}function ES(r,i){let e=i[i.length-1],n=r.getAttribute("href");n!==null&&(e.link=n),zl(Yle,r,i)}function MI(r,i){let e=i[i.length-1];e.extensionsNode_=r}function xce(r,i){let e=Lt({},ece,r,i);if(e){let n=i[i.length-1],o=n.flatCoordinates,s=n.layoutOptions;iO(o,s,r,e)}}function Sce(r,i){let e=Lt({},rce,r,i);if(e){let n=i[i.length-1],o=n.flatCoordinates,s=n.layoutOptions;iO(o,s,r,e)}}function Cce(r,i){let e=i[i.length-1];zl(ice,r,i);let n=e.flatCoordinates;e.ends.push(n.length)}function Qz(r,i){let e=i[0],n=Lt({flatCoordinates:[],layoutOptions:{}},Jle,r,i);if(!n)return;let o=n.flatCoordinates;delete n.flatCoordinates;let s=n.layoutOptions;delete n.layoutOptions;let l=rO(s,o),h=new Tr(o,l);xn(h,!1,e);let p=new gi(h);return p.setProperties(n,!0),p}function Jz(r,i){let e=i[0],n=Lt({flatCoordinates:[],ends:[],layoutOptions:{}},tce,r,i);if(!n)return;let o=n.flatCoordinates;delete n.flatCoordinates;let s=n.ends;delete n.ends;let l=n.layoutOptions;delete n.layoutOptions;let h=rO(l,o,s),p=new Ko(o,h,s);xn(p,!1,e);let m=new gi(p);return m.setProperties(n,!0),m}function e$(r,i){let e=i[0],n=Lt({},nce,r,i);if(!n)return;let o={},s=iO([],o,r,n),l=rO(o,s),h=new Ii(s,l);xn(h,!1,e);let p=new gi(h);return p.setProperties(n,!0),p}function nO(r,i,e){r.setAttribute("href",i);let o=e[e.length-1].properties,s=[o.linkText,o.linkType];yr({node:r},ace,Gs,s,e,oce)}function oO(r,i,e){let n=e[e.length-1],s=n.node.namespaceURI,l=n.properties;switch(r.setAttributeNS(null,"lat",String(i[1])),r.setAttributeNS(null,"lon",String(i[0])),n.geometryLayout){case"XYZM":i[3]!==0&&(l.time=i[3]);case"XYZ":i[2]!==0&&(l.ele=i[2]);break;case"XYM":i[2]!==0&&(l.time=i[2]);break;default:}let p=r.nodeName=="rtept"?cce[s]:mce[s],m=nu(l,p);yr({node:r,properties:l},fce,Gs,m,e,p)}function Ace(r,i,e){let n=e[0],o=i.getProperties(),s={node:r};s.properties=o;let l=i.getGeometry();if(l.getType()=="LineString"){let f=xn(l,!0,n);s.geometryLayout=f.getLayout(),o.rtept=f.getCoordinates()}let h=e[e.length-1].node,p=sce[h.namespaceURI],m=nu(o,p);yr(s,lce,Gs,m,e,p)}function Mce(r,i,e){let n=e[0],o=i.getProperties(),s={node:r};s.properties=o;let l=i.getGeometry();if(l.getType()=="MultiLineString"){let f=xn(l,!0,n);o.trkseg=f.getLineStrings()}let h=e[e.length-1].node,p=uce[h.namespaceURI],m=nu(o,p);yr(s,dce,Gs,m,e,p)}function Ice(r,i,e){let n={node:r};n.geometryLayout=i.getLayout(),n.properties={},yr(n,pce,hce,i.getCoordinates(),e)}function Ece(r,i,e){let n=e[0],o=e[e.length-1];o.properties=i.getProperties();let s=i.getGeometry();if(s.getType()=="Point"){let l=xn(s,!0,n);o.geometryLayout=l.getLayout(),oO(r,l.getCoordinates(),e)}}var sg=tO;var aO=class extends Dm{constructor(){super()}getType(){return"text"}readFeature(i,e){return this.readFeatureFromText(II(i),this.adaptOptions(e))}readFeatureFromText(i,e){return Ti()}readFeatures(i,e){return this.readFeaturesFromText(II(i),this.adaptOptions(e))}readFeaturesFromText(i,e){return Ti()}readGeometry(i,e){return this.readGeometryFromText(II(i),this.adaptOptions(e))}readGeometryFromText(i,e){return Ti()}readProjection(i){return this.readProjectionFromText(II(i))}readProjectionFromText(i){return this.dataProjection}writeFeature(i,e){return this.writeFeatureText(i,this.adaptOptions(e))}writeFeatureText(i,e){return Ti()}writeFeatures(i,e){return this.writeFeaturesText(i,this.adaptOptions(e))}writeFeaturesText(i,e){return Ti()}writeGeometry(i,e){return this.writeGeometryText(i,this.adaptOptions(e))}writeGeometryText(i,e){return Ti()}};function II(r){return typeof r=="string"?r:""}var Nv=aO;var Tce=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Fce=/^H.([A-Z]{3}).*?:(.*)/,Pce=/^HFDTE(\d{2})(\d{2})(\d{2})/,Lce=/\r\n|\r|\n/,sO=class extends Nv{constructor(i){super(),i=i||{},this.dataProjection=ni("EPSG:4326"),this.altitudeMode_=i.altitudeMode?i.altitudeMode:"none"}readFeatureFromText(i,e){let n=this.altitudeMode_,o=i.split(Lce),s={},l=[],h=2e3,p=0,m=1,f=-1,g,y;for(g=0,y=o.length;g<y;++g){let k=o[g],R;if(k.charAt(0)=="B"){if(R=Tce.exec(k),R){let q=parseInt(R[1],10),X=parseInt(R[2],10),ie=parseInt(R[3],10),ae=parseInt(R[4],10)+parseInt(R[5],10)/6e4;R[6]=="S"&&(ae=-ae);let be=parseInt(R[7],10)+parseInt(R[8],10)/6e4;if(R[9]=="W"&&(be=-be),l.push(be,ae),n!="none"){let fe;n=="gps"?fe=parseInt(R[11],10):n=="barometric"?fe=parseInt(R[12],10):fe=0,l.push(fe)}let me=Date.UTC(h,p,m,q,X,ie);me<f&&(me=Date.UTC(h,p,m+1,q,X,ie)),l.push(me/1e3),f=me}}else k.charAt(0)=="H"&&(R=Pce.exec(k),R?(m=parseInt(R[1],10),p=parseInt(R[2],10)-1,h=2e3+parseInt(R[3],10)):(R=Fce.exec(k),R&&(s[R[1]]=R[2].trim())))}if(l.length===0)return null;let _=n=="none"?"XYM":"XYZM",w=new Tr(l,_),A=new gi(xn(w,!1,e));return A.setProperties(s,!0),A}readFeaturesFromText(i,e){let n=this.readFeatureFromText(i,e);return n?[n]:[]}},t$=sO;var Pu={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Fy={};Fy[Pu.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Fy[Pu.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Fy[Pu.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Fy.none={none:{supports:[],formats:[],qualities:[]}};var kce=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,i$=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Oce=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function Dce(r){let i=r.getComplianceLevelSupportedFeatures();return i===void 0&&(i=Fy[Pu.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:i.supports,formats:[...i.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...i.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function Rce(r){let i=r.getComplianceLevelSupportedFeatures(),e=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=e&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],o=e&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=e&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(l){return[l.width,l.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(l){return l.width})[0],r.imageInfo.tiles.map(function(l){return l.height===void 0?l.width:l.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(l){return l.scaleFactors})[0],supports:[...i.supports,...n],formats:[...i.formats,...o],qualities:[...i.qualities,...s]}}function Nce(r){let i=r.getComplianceLevelSupportedFeatures(),e=r.imageInfo.extraFormats===void 0?i.formats:[...i.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(o){return["jpg","png","gif"].includes(o)}).reduce(function(o,s){return o===void 0&&e.includes(s)?s:o},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?i.supports:[...i.supports,...r.imageInfo.extraFeatures],formats:e,qualities:r.imageInfo.extraQualities===void 0?i.qualities:[...i.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}var EI={};EI[Pu.VERSION1]=Dce;EI[Pu.VERSION2]=Rce;EI[Pu.VERSION3]=Nce;var lO=class{constructor(i){this.setImageInfo(i)}setImageInfo(i){typeof i=="string"?this.imageInfo=JSON.parse(i):this.imageInfo=i}getImageApiVersion(){if(this.imageInfo===void 0)return;let i=this.imageInfo["@context"]||"ol-no-context";typeof i=="string"&&(i=[i]);for(let e=0;e<i.length;e++)switch(i[e]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Pu.VERSION1;case"http://iiif.io/api/image/2/context.json":return Pu.VERSION2;case"http://iiif.io/api/image/3/context.json":return Pu.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Pu.VERSION1)&&this.imageInfo.identifier)return Pu.VERSION1;break;default:}Hi(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(i){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(i===void 0&&(i=this.getImageApiVersion()),i){case Pu.VERSION1:if(kce.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Pu.VERSION3:if(Oce.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Pu.VERSION2:if(typeof this.imageInfo.profile=="string"&&i$.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&i$.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break;default:}}getComplianceLevelFromProfile(i){let e=this.getComplianceLevelEntryFromProfile(i);if(e===void 0)return;let n=e.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;let i=this.getImageApiVersion(),e=this.getComplianceLevelFromProfile(i);return e===void 0?Fy.none.none:Fy[i][e]}getTileSourceOptions(i){let e=i||{},n=this.getImageApiVersion();if(n===void 0)return;let o=n===void 0?void 0:EI[n](this);if(o!==void 0)return{url:o.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:o.sizes,format:e.format!==void 0&&o.formats.includes(e.format)?e.format:o.preferredFormat!==void 0?o.preferredFormat:"jpg",supports:o.supports,quality:e.quality&&o.qualities.includes(e.quality)?e.quality:o.qualities.includes("native")?"native":"default",resolutions:Array.isArray(o.resolutions)?o.resolutions.sort(function(s,l){return l-s}):void 0,tileSize:o.tileSize}}},r$=lO;var lg=["http://www.google.com/kml/ext/2.2"],qi=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],Bce="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd",n$={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},Gce=It(qi,{ExtendedData:C$,Region:A$,MultiGeometry:Xe(w$,"geometry"),LineString:Xe(v$,"geometry"),LinearRing:Xe(b$,"geometry"),Point:Xe(x$,"geometry"),Polygon:Xe(S$,"geometry"),Style:Xe(vO),StyleMap:wue,address:Xe(zt),description:Xe(zt),name:Xe(zt),open:Xe(ag),phoneNumber:Xe(zt),styleUrl:Xe(m$),visibility:Xe(ag)},It(lg,{MultiTrack:Xe(lue,"geometry"),Track:Xe(y$,"geometry")})),jce=It(qi,{ExtendedData:C$,Region:A$,Link:kue,address:Xe(zt),description:Xe(zt),name:Xe(zt),open:Xe(ag),phoneNumber:Xe(zt),visibility:Xe(ag)}),Vce=It(qi,{href:Xe(p$)}),Uce=It(qi,{Altitude:Xe(hn),Longitude:Xe(hn),Latitude:Xe(hn),Tilt:Xe(hn),AltitudeMode:Xe(zt),Heading:Xe(hn),Roll:Xe(hn)}),u$=It(qi,{LatLonAltBox:Mue,Lod:Eue}),zce=It(qi,["Document","Placemark"]),$ce=It(qi,{Document:it(Vue),Placemark:it(E$)}),Bv,FI=null;var dO,TS,FS,PS,LI,hO=null;var _O,pO=null;var mO,Py=null;var o$=null;var fO=null;function kI(r){return 32/Math.min(r[0],r[1])}function Wce(){Bv=[255,255,255,1],FI=new hi({color:Bv}),dO=[20,2],TS="pixels",FS="pixels",PS=[64,64],LI="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",hO=new Bs({anchor:dO,anchorOrigin:"bottom-left",anchorXUnits:TS,anchorYUnits:FS,crossOrigin:"anonymous",rotation:0,scale:kI(PS),size:PS,src:LI}),_O="NO_IMAGE",pO=new ui({color:Bv,width:1}),mO=new ui({color:[51,51,51,1],width:2}),Py=new so({font:"bold 16px Helvetica",fill:FI,stroke:mO,scale:.8}),o$=new oi({fill:FI,image:hO,text:Py,stroke:pO,zIndex:0}),fO=[o$]}var TI;function Hce(r){return r}var gO=class extends jh{constructor(i){super(),i=i||{},fO||Wce(),this.dataProjection=ni("EPSG:4326"),this.defaultStyle_=i.defaultStyle?i.defaultStyle:fO,this.extractStyles_=i.extractStyles!==void 0?i.extractStyles:!0,this.writeStyles_=i.writeStyles!==void 0?i.writeStyles:!0,this.sharedStyles_={},this.showPointNames_=i.showPointNames!==void 0?i.showPointNames:!0,this.crossOrigin_=i.crossOrigin!==void 0?i.crossOrigin:"anonymous",this.iconUrlFunction_=i.iconUrlFunction?i.iconUrlFunction:Hce,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(i,e){let n=It(qi,{Document:My(this.readDocumentOrFolder_,this),Folder:My(this.readDocumentOrFolder_,this),Placemark:Mi(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),o=Lt([],n,i,e,this);if(o)return o}readPlacemark_(i,e){let n=Lt({geometry:null},Gce,i,e,this);if(!n)return;let o=new gi,s=i.getAttribute("id");s!==null&&o.setId(s);let l=e[0],h=n.geometry;if(h&&xn(h,!1,l),o.setGeometry(h),delete n.geometry,this.extractStyles_){let p=n.Style,m=n.styleUrl,f=Yce(p,m,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);o.setStyle(f)}return delete n.Style,o.setProperties(n,!0),o}readSharedStyle_(i,e){let n=i.getAttribute("id");if(n!==null){let o=vO.call(this,i,e);if(o){let s,l=i.baseURI;(!l||l=="about:blank")&&(l=window.location.href),l?s=new URL("#"+n,l).href:s="#"+n,this.sharedStyles_[s]=o}}}readSharedStyleMap_(i,e){let n=i.getAttribute("id");if(n===null)return;let o=g$.call(this,i,e);if(!o)return;let s,l=i.baseURI;(!l||l=="about:blank")&&(l=window.location.href),l?s=new URL("#"+n,l).href:s="#"+n,this.sharedStyles_[s]=o}readFeatureFromNode(i,e){if(!qi.includes(i.namespaceURI))return null;let n=this.readPlacemark_(i,[this.getReadOptions(i,e)]);return n||null}readFeaturesFromNode(i,e){if(!qi.includes(i.namespaceURI))return[];let n,o=i.localName;if(o=="Document"||o=="Folder")return n=this.readDocumentOrFolder_(i,[this.getReadOptions(i,e)]),n||[];if(o=="Placemark"){let s=this.readPlacemark_(i,[this.getReadOptions(i,e)]);return s?[s]:[]}if(o=="kml"){n=[];for(let s=i.firstElementChild;s;s=s.nextElementSibling){let l=this.readFeaturesFromNode(s,e);l&&Cr(n,l)}return n}return[]}readName(i){if(i){if(typeof i=="string"){let e=Pc(i);return this.readNameFromDocument(e)}return Fc(i)?this.readNameFromDocument(i):this.readNameFromNode(i)}}readNameFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){let n=this.readNameFromNode(e);if(n)return n}}readNameFromNode(i){for(let e=i.firstElementChild;e;e=e.nextElementSibling)if(qi.includes(e.namespaceURI)&&e.localName=="name")return zt(e);for(let e=i.firstElementChild;e;e=e.nextElementSibling){let n=e.localName;if(qi.includes(e.namespaceURI)&&(n=="Document"||n=="Folder"||n=="Placemark"||n=="kml")){let o=this.readNameFromNode(e);if(o)return o}}}readNetworkLinks(i){let e=[];if(typeof i=="string"){let n=Pc(i);Cr(e,this.readNetworkLinksFromDocument(n))}else Fc(i)?Cr(e,this.readNetworkLinksFromDocument(i)):Cr(e,this.readNetworkLinksFromNode(i));return e}readNetworkLinksFromDocument(i){let e=[];for(let n=i.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Cr(e,this.readNetworkLinksFromNode(n));return e}readNetworkLinksFromNode(i){let e=[];for(let n=i.firstElementChild;n;n=n.nextElementSibling)if(qi.includes(n.namespaceURI)&&n.localName=="NetworkLink"){let o=Lt({},jce,n,[]);e.push(o)}for(let n=i.firstElementChild;n;n=n.nextElementSibling){let o=n.localName;qi.includes(n.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&Cr(e,this.readNetworkLinksFromNode(n))}return e}readRegion(i){let e=[];if(typeof i=="string"){let n=Pc(i);Cr(e,this.readRegionFromDocument(n))}else Fc(i)?Cr(e,this.readRegionFromDocument(i)):Cr(e,this.readRegionFromNode(i));return e}readRegionFromDocument(i){let e=[];for(let n=i.firstChild;n;n=n.nextSibling)n.nodeType==Node.ELEMENT_NODE&&Cr(e,this.readRegionFromNode(n));return e}readRegionFromNode(i){let e=[];for(let n=i.firstElementChild;n;n=n.nextElementSibling)if(qi.includes(n.namespaceURI)&&n.localName=="Region"){let o=Lt({},u$,n,[]);e.push(o)}for(let n=i.firstElementChild;n;n=n.nextElementSibling){let o=n.localName;qi.includes(n.namespaceURI)&&(o=="Document"||o=="Folder"||o=="kml")&&Cr(e,this.readRegionFromNode(n))}return e}readCamera(i){let e=[];if(typeof i=="string"){let n=Pc(i);Cr(e,this.readCameraFromDocument(n))}else Fc(i)?Cr(e,this.readCameraFromDocument(i)):Cr(e,this.readCameraFromNode(i));return e}readCameraFromDocument(i){let e=[];for(let n=i.firstChild;n;n=n.nextSibling)n.nodeType===Node.ELEMENT_NODE&&Cr(e,this.readCameraFromNode(n));return e}readCameraFromNode(i){let e=[];for(let n=i.firstElementChild;n;n=n.nextElementSibling)if(qi.includes(n.namespaceURI)&&n.localName==="Camera"){let o=Lt({},Uce,n,[]);e.push(o)}for(let n=i.firstElementChild;n;n=n.nextElementSibling){let o=n.localName;qi.includes(n.namespaceURI)&&(o==="Document"||o==="Folder"||o==="Placemark"||o==="kml")&&Cr(e,this.readCameraFromNode(n))}return e}writeFeaturesNode(i,e){e=this.adaptOptions(e);let n=Ar(qi[4],"kml"),o="http://www.w3.org/2000/xmlns/";n.setAttributeNS(o,"xmlns:gx",lg[0]),n.setAttributeNS(o,"xmlns:xsi",Ip),n.setAttributeNS(Ip,"xsi:schemaLocation",Bce);let s={node:n},l={};i.length>1?l.Document=i:i.length==1&&(l.Placemark=i[0]);let h=zce[n.namespaceURI],p=nu(l,h);return yr(s,$ce,Gs,p,[e],h,this),n}};function qce(r,i){let e=[0,0],n="start",o=r.getImage();if(o){let h=o.getSize();if(h&&h.length==2){let p=o.getScaleArray(),m=o.getAnchor();e[0]=p[0]*(h[0]-m[0]),e[1]=p[1]*(h[1]/2-m[1]),n="left"}}let s=r.getText();return s?(s=s.clone(),s.setFont(s.getFont()||Py.getFont()),s.setScale(s.getScale()||Py.getScale()),s.setFill(s.getFill()||Py.getFill()),s.setStroke(s.getStroke()||mO)):s=Py.clone(),s.setText(i),s.setOffsetX(e[0]),s.setOffsetY(e[1]),s.setTextAlign(n),new oi({image:o,text:s})}function Yce(r,i,e,n,o){return function(s,l){let h=o,p="",m=[];if(h){let g=s.getGeometry();if(g)if(g instanceof _s)m=g.getGeometriesArrayRecursive().filter(function(y){let _=y.getType();return _==="Point"||_==="MultiPoint"}),h=m.length>0;else{let y=g.getType();h=y==="Point"||y==="MultiPoint"}}h&&(p=s.get("name"),h=h&&!!p,h&&/&[^&]+;/.test(p)&&(TI||(TI=document.createElement("textarea")),TI.innerHTML=p,p=TI.value));let f=e;if(r?f=r:i&&(f=d$(i,e,n)),h){let g=qce(f[0],p);if(m.length>0){g.setGeometry(new _s(m));let y=new oi({geometry:f[0].getGeometry(),image:null,fill:f[0].getFill(),stroke:f[0].getStroke(),text:null});return[g,y].concat(f.slice(1))}return g}return f}}function d$(r,i,e){return Array.isArray(r)?r:typeof r=="string"?d$(e[r],i,e):i}function OI(r){let i=gl(r,!1),e=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(i);if(e){let n=e[1];return[parseInt(n.substr(6,2),16),parseInt(n.substr(4,2),16),parseInt(n.substr(2,2),16),parseInt(n.substr(0,2),16)/255]}}function h$(r){let i=gl(r,!1),e=[];i=i.replace(/\s*,\s*/g,",");let n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i,o;for(;o=n.exec(i);){let s=parseFloat(o[1]),l=parseFloat(o[2]),h=o[3]?parseFloat(o[3]):0;e.push(s,l,h),i=i.substr(o[0].length)}if(i==="")return e}function p$(r){let i=gl(r,!1).trim(),e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(i,e).href:i}function m$(r){let i=gl(r,!1).trim().replace(/^(?!.*#)/,"#"),e=r.baseURI;return(!e||e=="about:blank")&&(e=window.location.href),e?new URL(i,e).href:i}function Zce(r){let i=r.getAttribute("xunits"),e=r.getAttribute("yunits"),n;return i!=="insetPixels"?e!=="insetPixels"?n="bottom-left":n="top-left":e!=="insetPixels"?n="bottom-right":n="top-right",{x:parseFloat(r.getAttribute("x")),xunits:n$[i],y:parseFloat(r.getAttribute("y")),yunits:n$[e],origin:n}}function f$(r){return hn(r)}var Xce=It(qi,{Pair:bue});function g$(r,i){return Lt(void 0,Xce,r,i,this)}var Kce=It(qi,{Icon:Xe(due),color:Xe(OI),heading:Xe(hn),hotSpot:Xe(Zce),scale:Xe(f$)});function Qce(r,i){let e=Lt({},Kce,r,i);if(!e)return;let n=i[i.length-1],o="Icon"in e?e.Icon:{},s=!("Icon"in e)||Object.keys(o).length>0,l,h=o.href;h?l=h:s&&(l=LI);let p,m,f,g="bottom-left",y=e.hotSpot;y?(p=[y.x,y.y],m=y.xunits,f=y.yunits,g=y.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(l)&&(l.includes("pushpin")?(p=dO,m=TS,f=FS):l.includes("arrow-reverse")?(p=[54,42],m=TS,f=FS):l.includes("paddle")&&(p=[32,1],m=TS,f=FS));let _,w=o.x,A=o.y;w!==void 0&&A!==void 0&&(_=[w,A]);let k,R=o.w,q=o.h;R!==void 0&&q!==void 0&&(k=[R,q]);let X,ie=e.heading;ie!==void 0&&(X=Au(ie));let ae=e.scale,be=e.color;if(s){l==LI&&(k=PS);let me=new Bs({anchor:p,anchorOrigin:g,anchorXUnits:m,anchorYUnits:f,crossOrigin:this.crossOrigin_,offset:_,offsetOrigin:"bottom-left",rotation:X,scale:ae,size:k,src:this.iconUrlFunction_(l),color:be}),fe=me.getScaleArray()[0],ge=me.getSize();if(ge===null){let ue=me.getImageState();if(ue===xi.IDLE||ue===xi.LOADING){let se=function(){let te=me.getImageState();if(!(te===xi.IDLE||te===xi.LOADING)){let Se=me.getSize();if(Se&&Se.length==2){let Te=kI(Se);me.setScale(fe*Te)}me.unlistenImageChange(se)}};me.listenImageChange(se),ue===xi.IDLE&&me.load()}}else if(ge.length==2){let ue=kI(ge);me.setScale(fe*ue)}n.imageStyle=me}else n.imageStyle=_O}var Jce=It(qi,{color:Xe(OI),scale:Xe(f$)});function eue(r,i){let e=Lt({},Jce,r,i);if(!e)return;let n=i[i.length-1],o=new so({fill:new hi({color:"color"in e?e.color:Bv}),scale:e.scale});n.textStyle=o}var tue=It(qi,{color:Xe(OI),width:Xe(hn)});function iue(r,i){let e=Lt({},tue,r,i);if(!e)return;let n=i[i.length-1],o=new ui({color:"color"in e?e.color:Bv,width:"width"in e?e.width:1});n.strokeStyle=o}var rue=It(qi,{color:Xe(OI),fill:Xe(ag),outline:Xe(ag)});function nue(r,i){let e=Lt({},rue,r,i);if(!e)return;let n=i[i.length-1],o=new hi({color:"color"in e?e.color:Bv});n.fillStyle=o;let s=e.fill;s!==void 0&&(n.fill=s);let l=e.outline;l!==void 0&&(n.outline=l)}var oue=It(qi,{coordinates:Ki(h$)});function _$(r,i){return Lt(null,oue,r,i)}function aue(r,i){let n=i[i.length-1].coordinates,o=gl(r,!1),l=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(o);if(l){let h=parseFloat(l[1]),p=parseFloat(l[2]),m=parseFloat(l[3]);n.push([h,p,m])}else n.push([])}var sue=It(lg,{Track:Mi(y$)});function lue(r,i){let e=Lt([],sue,r,i);if(e)return new Ko(e)}var cue=It(qi,{when:Oue},It(lg,{coord:aue}));function y$(r,i){let e=Lt({coordinates:[],whens:[]},cue,r,i);if(!e)return;let n=[],o=e.coordinates,s=e.whens;for(let l=0,h=Math.min(o.length,s.length);l<h;++l)o[l].length==3&&n.push(o[l][0],o[l][1],o[l][2],s[l]);return new Tr(n,"XYZM")}var uue=It(qi,{href:Xe(p$)},It(lg,{x:Xe(hn),y:Xe(hn),w:Xe(hn),h:Xe(hn)}));function due(r,i){let e=Lt({},uue,r,i);return e||null}var hue=It(qi,{coordinates:Ki(h$)});function yO(r,i){return Lt(null,hue,r,i)}var DI=It(qi,{extrude:Xe(ag),tessellate:Xe(ag),altitudeMode:Xe(zt)});function v$(r,i){let e=Lt({},DI,r,i),n=yO(r,i);if(n){let o=new Tr(n,"XYZ");return o.setProperties(e,!0),o}}function b$(r,i){let e=Lt({},DI,r,i),n=yO(r,i);if(n){let o=new on(n,"XYZ",[n.length]);return o.setProperties(e,!0),o}}var pue=It(qi,{LineString:Mi(v$),LinearRing:Mi(b$),MultiGeometry:Mi(w$),Point:Mi(x$),Polygon:Mi(S$)});function w$(r,i){let e=Lt([],pue,r,i);if(!e)return null;if(e.length===0)return new _s(e);let n,o=!0,s=e[0].getType(),l;for(let h=1,p=e.length;h<p;++h)if(l=e[h],l.getType()!=s){o=!1;break}if(o){let h,p;if(s=="Point"){let m=e[0];h=m.getLayout(),p=m.getFlatCoordinates();for(let f=1,g=e.length;f<g;++f)l=e[f],Cr(p,l.getFlatCoordinates());n=new tl(p,h),cO(n,e)}else if(s=="LineString")n=new Ko(e),cO(n,e);else if(s=="Polygon")n=new es(e),cO(n,e);else if(s=="GeometryCollection")n=new _s(e);else throw new Error("Unknown geometry type found")}else n=new _s(e);return n}function x$(r,i){let e=Lt({},DI,r,i),n=yO(r,i);if(n){let o=new Ii(n,"XYZ");return o.setProperties(e,!0),o}}var mue=It(qi,{innerBoundaryIs:Fue,outerBoundaryIs:Lue});function S$(r,i){let e=Lt({},DI,r,i),n=Lt([null],mue,r,i);if(n&&n[0]){let o=n[0],s=[o.length];for(let h=1,p=n.length;h<p;++h)Cr(o,n[h]),s.push(o.length);let l=new on(o,"XYZ",s);return l.setProperties(e,!0),l}}var fue=It(qi,{IconStyle:Qce,LabelStyle:eue,LineStyle:iue,PolyStyle:nue});function vO(r,i){let e=Lt({},fue,r,i,this);if(!e)return null;let n="fillStyle"in e?e.fillStyle:FI,o=e.fill;o!==void 0&&!o&&(n=null);let s;"imageStyle"in e?e.imageStyle!=_O&&(s=e.imageStyle):s=hO;let l="textStyle"in e?e.textStyle:Py,h="strokeStyle"in e?e.strokeStyle:pO,p=e.outline;return p!==void 0&&!p?[new oi({geometry:function(m){let f=m.getGeometry(),g=f.getType();if(g==="GeometryCollection"){let y=f;return new _s(y.getGeometriesArrayRecursive().filter(function(_){let w=_.getType();return w!=="Polygon"&&w!=="MultiPolygon"}))}if(g!=="Polygon"&&g!=="MultiPolygon")return f},fill:n,image:s,stroke:h,text:l,zIndex:void 0}),new oi({geometry:function(m){let f=m.getGeometry(),g=f.getType();if(g==="GeometryCollection"){let y=f;return new _s(y.getGeometriesArrayRecursive().filter(function(_){let w=_.getType();return w==="Polygon"||w==="MultiPolygon"}))}if(g==="Polygon"||g==="MultiPolygon")return f},fill:n,stroke:null,zIndex:void 0})]:[new oi({fill:n,image:s,stroke:h,text:l,zIndex:void 0})]}function cO(r,i){let e=i.length,n=new Array(i.length),o=new Array(i.length),s=new Array(i.length),l,h,p;l=!1,h=!1,p=!1;for(let m=0;m<e;++m){let f=i[m];n[m]=f.get("extrude"),o[m]=f.get("tessellate"),s[m]=f.get("altitudeMode"),l=l||n[m]!==void 0,h=h||o[m]!==void 0,p=p||s[m]}l&&r.set("extrude",n),h&&r.set("tessellate",o),p&&r.set("altitudeMode",s)}var gue=It(qi,{displayName:Xe(zt),value:Xe(zt)});function _ue(r,i){let e=r.getAttribute("name");zl(gue,r,i);let n=i[i.length-1];e&&n.displayName?n[e]={value:n.value,displayName:n.displayName,toString:function(){return n.value}}:e!==null?n[e]=n.value:n.displayName!==null&&(n[n.displayName]=n.value),delete n.value}var yue=It(qi,{Data:_ue,SchemaData:Sue});function C$(r,i){zl(yue,r,i)}function A$(r,i){zl(u$,r,i)}var vue=It(qi,{Style:Xe(vO),key:Xe(zt),styleUrl:Xe(m$)});function bue(r,i){let e=Lt({},vue,r,i,this);if(!e)return;let n=e.key;if(n&&n=="normal"){let o=e.styleUrl;o&&(i[i.length-1]=o);let s=e.Style;s&&(i[i.length-1]=s)}}function wue(r,i){let e=g$.call(this,r,i);if(!e)return;let n=i[i.length-1];if(Array.isArray(e))n.Style=e;else if(typeof e=="string")n.styleUrl=e;else throw new Error("`styleMapValue` has an unknown type")}var xue=It(qi,{SimpleData:Cue});function Sue(r,i){zl(xue,r,i)}function Cue(r,i){let e=r.getAttribute("name");if(e!==null){let n=zt(r),o=i[i.length-1];o[e]=n}}var Aue=It(qi,{altitudeMode:Xe(zt),minAltitude:Xe(hn),maxAltitude:Xe(hn),north:Xe(hn),south:Xe(hn),east:Xe(hn),west:Xe(hn)});function Mue(r,i){let e=Lt({},Aue,r,i);if(!e)return;let n=i[i.length-1],o=[parseFloat(e.west),parseFloat(e.south),parseFloat(e.east),parseFloat(e.north)];n.extent=o,n.altitudeMode=e.altitudeMode,n.minAltitude=parseFloat(e.minAltitude),n.maxAltitude=parseFloat(e.maxAltitude)}var Iue=It(qi,{minLodPixels:Xe(hn),maxLodPixels:Xe(hn),minFadeExtent:Xe(hn),maxFadeExtent:Xe(hn)});function Eue(r,i){let e=Lt({},Iue,r,i);if(!e)return;let n=i[i.length-1];n.minLodPixels=parseFloat(e.minLodPixels),n.maxLodPixels=parseFloat(e.maxLodPixels),n.minFadeExtent=parseFloat(e.minFadeExtent),n.maxFadeExtent=parseFloat(e.maxFadeExtent)}var Tue=It(qi,{LinearRing:Mi(_$)});function Fue(r,i){let e=Lt([],Tue,r,i);e.length>0&&i[i.length-1].push(...e)}var Pue=It(qi,{LinearRing:Ki(_$)});function Lue(r,i){let e=Lt(void 0,Pue,r,i);if(e){let n=i[i.length-1];n[0]=e}}function kue(r,i){zl(Vce,r,i)}function Oue(r,i){let n=i[i.length-1].whens,o=gl(r,!1),s=Date.parse(o);n.push(isNaN(s)?0:s)}function RI(r,i){let e=Ra(i),o=[(e.length==4?e[3]:1)*255,e[2],e[1],e[0]];for(let s=0;s<4;++s){let l=Math.floor(o[s]).toString(16);o[s]=l.length==1?"0"+l:l}hr(r,o.join(""))}function Due(r,i,e){let n=e[e.length-1],o=n.layout,s=n.stride,l;if(o=="XY"||o=="XYM")l=2;else if(o=="XYZ"||o=="XYZM")l=3;else throw new Error("Invalid geometry layout");let h=i.length,p="";if(h>0){p+=i[0];for(let m=1;m<l;++m)p+=","+i[m];for(let m=s;m<h;m+=s){p+=" "+i[m];for(let f=1;f<l;++f)p+=","+i[m+f]}}hr(r,p)}var PI=It(qi,{Data:it(Rue),value:it(Bue),displayName:it(Nue)});function Rue(r,i,e){r.setAttribute("name",i.name);let n={node:r},o=i.value;typeof o=="object"?(o!==null&&o.displayName&&yr(n,PI,Gs,[o.displayName],e,["displayName"]),o!==null&&o.value&&yr(n,PI,Gs,[o.value],e,["value"])):yr(n,PI,Gs,[o],e,["value"])}function Nue(r,i){Xz(r,i)}function Bue(r,i){hr(r,i)}var Gue=It(qi,{Placemark:it(E$)}),jue=function(r,i,e){let n=i[i.length-1].node;return Ar(n.namespaceURI,"Placemark")};function Vue(r,i,e){yr({node:r},Gue,jue,i,e,void 0,this)}var Uue=Ho("Data");function zue(r,i,e){let n={node:r},o=i.names,s=i.values,l=o.length;for(let h=0;h<l;h++)yr(n,PI,Uue,[{name:o[h],value:s[h]}],e)}var a$=It(qi,["href"],It(lg,["x","y","w","h"])),s$=It(qi,{href:it(hr)},It(lg,{x:it(ou),y:it(ou),w:it(ou),h:it(ou)})),$ue=function(r,i,e){return Ar(lg[0],"gx:"+e)};function Wue(r,i,e){let n={node:r},o=e[e.length-1].node,s=a$[o.namespaceURI],l=nu(i,s);yr(n,s$,Gs,l,e,s),s=a$[lg[0]],l=nu(i,s),yr(n,s$,$ue,l,e,s)}var Hue=It(qi,["scale","heading","Icon","color","hotSpot"]),que=It(qi,{Icon:it(Wue),color:it(RI),heading:it(ou),hotSpot:it(bde),scale:it(F$)});function Yue(r,i,e){let n={node:r},o={},s=i.getSrc(),l=i.getSize(),h=i.getImageSize(),p={href:s};if(l){p.w=l[0],p.h=l[1];let k=i.getAnchor(),R=i.getOrigin();if(R&&h&&R[0]!==0&&R[1]!==l[1]&&(p.x=R[0],p.y=h[1]-(R[1]+l[1])),k&&(k[0]!==l[0]/2||k[1]!==l[1]/2)){let q={x:k[0],xunits:"pixels",y:l[1]-k[1],yunits:"pixels"};o.hotSpot=q}}o.Icon=p;let m=i.getScaleArray()[0],f=l;if(f===null&&(f=PS),f.length==2){let k=kI(f);m=m/k}m!==1&&(o.scale=m);let g=i.getRotation();g!==0&&(o.heading=g);let y=i.getColor();y&&(o.color=y);let _=e[e.length-1].node,w=Hue[_.namespaceURI],A=nu(o,w);yr(n,que,Gs,A,e,w)}var Zue=It(qi,["color","scale"]),Xue=It(qi,{color:it(RI),scale:it(F$)});function Kue(r,i,e){let n={node:r},o={},s=i.getFill();s&&(o.color=s.getColor());let l=i.getScale();l&&l!==1&&(o.scale=l);let h=e[e.length-1].node,p=Zue[h.namespaceURI],m=nu(o,p);yr(n,Xue,Gs,m,e,p)}var Que=It(qi,["color","width"]),Jue=It(qi,{color:it(RI),width:it(ou)});function ede(r,i,e){let n={node:r},o={color:i.getColor(),width:Number(i.getWidth())||1},s=e[e.length-1].node,l=Que[s.namespaceURI],h=nu(o,l);yr(n,Jue,Gs,h,e,l)}var tde={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},M$=function(r,i,e){if(r){let n=i[i.length-1].node;return Ar(n.namespaceURI,tde[r.getType()])}},ide=Ho("Point"),rde=Ho("LineString"),nde=Ho("LinearRing"),ode=Ho("Polygon"),ade=It(qi,{LineString:it(Gv),Point:it(Gv),Polygon:it(T$),GeometryCollection:it(I$)});function I$(r,i,e){let n={node:r},o=i.getType(),s=[],l;if(o==="GeometryCollection")i.getGeometriesArrayRecursive().forEach(function(h){let p=h.getType();if(p==="MultiPoint")s=s.concat(h.getPoints());else if(p==="MultiLineString")s=s.concat(h.getLineStrings());else if(p==="MultiPolygon")s=s.concat(h.getPolygons());else if(p==="Point"||p==="LineString"||p==="Polygon")s.push(h);else throw new Error("Unknown geometry type")}),l=M$;else if(o==="MultiPoint")s=i.getPoints(),l=ide;else if(o==="MultiLineString")s=i.getLineStrings(),l=rde;else if(o==="MultiPolygon")s=i.getPolygons(),l=ode;else throw new Error("Unknown geometry type");yr(n,ade,l,s,e)}var sde=It(qi,{LinearRing:it(Gv)});function l$(r,i,e){yr({node:r},sde,nde,[i],e)}var uO=It(qi,{ExtendedData:it(zue),MultiGeometry:it(I$),LineString:it(Gv),LinearRing:it(Gv),Point:it(Gv),Polygon:it(T$),Style:it(vde),address:it(hr),description:it(hr),name:it(hr),open:it(Ey),phoneNumber:it(hr),styleUrl:it(hr),visibility:it(Ey)}),lde=It(qi,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),cde=Ho("ExtendedData");function E$(r,i,e){let n={node:r};i.getId()&&r.setAttribute("id",i.getId());let o=i.getProperties(),s={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};s[i.getGeometryName()]=1;let l=Object.keys(o||{}).sort().filter(function(_){return!s[_]}),h=i.getStyleFunction();if(h){let _=h(i,0);if(_){let w=Array.isArray(_)?_:[_],A=w;if(i.getGeometry()&&(A=w.filter(function(k){let R=k.getGeometryFunction()(i);if(R){let q=R.getType();return q==="GeometryCollection"?R.getGeometriesArrayRecursive().filter(function(X){let ie=X.getType();return ie==="Point"||ie==="MultiPoint"}).length:q==="Point"||q==="MultiPoint"}})),this.writeStyles_){let k=w,R=w;i.getGeometry()&&(k=w.filter(function(q){let X=q.getGeometryFunction()(i);if(X){let ie=X.getType();return ie==="GeometryCollection"?X.getGeometriesArrayRecursive().filter(function(ae){let be=ae.getType();return be==="LineString"||be==="MultiLineString"}).length:ie==="LineString"||ie==="MultiLineString"}}),R=w.filter(function(q){let X=q.getGeometryFunction()(i);if(X){let ie=X.getType();return ie==="GeometryCollection"?X.getGeometriesArrayRecursive().filter(function(ae){let be=ae.getType();return be==="Polygon"||be==="MultiPolygon"}).length:ie==="Polygon"||ie==="MultiPolygon"}})),o.Style={pointStyles:A,lineStyles:k,polyStyles:R}}if(A.length&&o.name===void 0){let k=A[0].getText();k&&(o.name=k.getText())}}}let p=e[e.length-1].node,m=lde[p.namespaceURI],f=nu(o,m);if(yr(n,uO,Gs,f,e,m),l.length>0){let _=nu(o,l);yr(n,uO,cde,[{names:l,values:_}],e)}let g=e[0],y=i.getGeometry();y&&(y=xn(y,!0,g)),yr(n,uO,M$,[y],e)}var ude=It(qi,["extrude","tessellate","altitudeMode","coordinates"]),dde=It(qi,{extrude:it(Ey),tessellate:it(Ey),altitudeMode:it(hr),coordinates:it(Due)});function Gv(r,i,e){let n=i.getFlatCoordinates(),o={node:r};o.layout=i.getLayout(),o.stride=i.getStride();let s=i.getProperties();s.coordinates=n;let l=e[e.length-1].node,h=ude[l.namespaceURI],p=nu(s,h);yr(o,dde,Gs,p,e,h)}var hde=It(qi,["color","fill","outline"]),c$=It(qi,{outerBoundaryIs:it(l$),innerBoundaryIs:it(l$)}),pde=Ho("innerBoundaryIs"),mde=Ho("outerBoundaryIs");function T$(r,i,e){let n=i.getLinearRings(),o=n.shift(),s={node:r};yr(s,c$,pde,n,e),yr(s,c$,mde,[o],e)}var fde=It(qi,{color:it(RI),fill:it(Ey),outline:it(Ey)});function gde(r,i,e){let n={node:r},o=i.getFill(),s=i.getStroke(),l={color:o?o.getColor():void 0,fill:o?void 0:!1,outline:s?void 0:!1},h=e[e.length-1].node,p=hde[h.namespaceURI],m=nu(l,p);yr(n,fde,Gs,m,e,p)}function F$(r,i){ou(r,Math.round(i*1e6)/1e6)}var _de=It(qi,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),yde=It(qi,{IconStyle:it(Yue),LabelStyle:it(Kue),LineStyle:it(ede),PolyStyle:it(gde)});function vde(r,i,e){let n={node:r},o={};if(i.pointStyles.length){let p=i.pointStyles[0].getText();p&&(o.LabelStyle=p);let m=i.pointStyles[0].getImage();m&&typeof m.getSrc=="function"&&(o.IconStyle=m)}if(i.lineStyles.length){let p=i.lineStyles[0].getStroke();p&&(o.LineStyle=p)}if(i.polyStyles.length){let p=i.polyStyles[0].getStroke();p&&!o.LineStyle&&(o.LineStyle=p),o.PolyStyle=i.polyStyles[0]}let s=e[e.length-1].node,l=_de[s.namespaceURI],h=nu(o,l);yr(n,yde,Gs,h,e,l)}function bde(r,i){r.setAttribute("x",String(i.x)),r.setAttribute("y",String(i.y)),r.setAttribute("xunits",i.xunits),r.setAttribute("yunits",i.yunits)}var cg=gO;var B$=Jl(N$(),1);var xO=class extends Dm{constructor(i){super(),i=i||{},this.dataProjection=new lc({code:"",units:"tile-pixels"}),this.featureClass_=i.featureClass?i.featureClass:il,this.geometryName_=i.geometryName,this.layerName_=i.layerName?i.layerName:"layer",this.layers_=i.layers?i.layers:null,this.idProperty_=i.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(i,e,n,o){i.pos=e.geometry;let s=i.readVarint()+i.pos,l=1,h=0,p=0,m=0,f=0,g=0;for(;i.pos<s;){if(!h){let y=i.readVarint();l=y&7,h=y>>3}if(h--,l===1||l===2)p+=i.readSVarint(),m+=i.readSVarint(),l===1&&f>g&&(o.push(f),g=f),n.push(p,m),f+=2;else if(l===7)f>g&&(n.push(n[g],n[g+1]),f+=2);else throw new Error("Invalid command found in the PBF")}f>g&&(o.push(f),g=f)}createFeature_(i,e,n){let o=e.type;if(o===0)return null;let s,l=e.properties,h;this.idProperty_?(h=l[this.idProperty_],delete l[this.idProperty_]):h=e.id,l[this.layerName_]=e.layer.name;let p=[],m=[];this.readRawGeometry_(i,e,p,m);let f=Ude(o,m.length);if(this.featureClass_===il)s=new this.featureClass_(f,p,m,2,l,h),s.transform(n.dataProjection);else{let g;if(f=="Polygon"){let w=hI(p,m);g=w.length>1?new es(p,"XY",w):new on(p,"XY",m)}else g=f==="Point"?new Ii(p,"XY"):f==="LineString"?new Tr(p,"XY"):f==="MultiPoint"?new tl(p,"XY"):f==="MultiLineString"?new Ko(p,"XY",m):null;let y=this.featureClass_;s=new y,this.geometryName_&&s.setGeometryName(this.geometryName_);let _=xn(g,!1,n);s.setGeometry(_),h!==void 0&&s.setId(h),s.setProperties(l,!0)}return s}getType(){return"arraybuffer"}readFeatures(i,e){let n=this.layers_;e=this.adaptOptions(e);let o=ni(e.dataProjection);o.setWorldExtent(e.extent),e.dataProjection=o;let s=new B$.default(i),l=s.readFields(Bde,{}),h=[];for(let p in l){if(n&&!n.includes(p))continue;let m=l[p],f=m?[0,0,m.extent,m.extent]:null;o.setExtent(f);for(let g=0,y=m.length;g<y;++g){let _=Vde(s,m,g),w=this.createFeature_(s,_,e);w!==null&&h.push(w)}}return h}readProjection(i){return this.dataProjection}setLayers(i){this.layers_=i}};function Bde(r,i,e){if(r===3){let n={keys:[],values:[],features:[]},o=e.readVarint()+e.pos;e.readFields(Gde,n,o),n.length=n.features.length,n.length&&(i[n.name]=n)}}function Gde(r,i,e){if(r===15)i.version=e.readVarint();else if(r===1)i.name=e.readString();else if(r===5)i.extent=e.readVarint();else if(r===2)i.features.push(e.pos);else if(r===3)i.keys.push(e.readString());else if(r===4){let n=null,o=e.readVarint()+e.pos;for(;e.pos<o;)r=e.readVarint()>>3,n=r===1?e.readString():r===2?e.readFloat():r===3?e.readDouble():r===4?e.readVarint64():r===5?e.readVarint():r===6?e.readSVarint():r===7?e.readBoolean():null;i.values.push(n)}}function jde(r,i,e){if(r==1)i.id=e.readVarint();else if(r==2){let n=e.readVarint()+e.pos;for(;e.pos<n;){let o=i.layer.keys[e.readVarint()],s=i.layer.values[e.readVarint()];i.properties[o]=s}}else r==3?i.type=e.readVarint():r==4&&(i.geometry=e.pos)}function Vde(r,i,e){r.pos=i.features[e];let n=r.readVarint()+r.pos,o={layer:i,type:0,properties:{}};return r.readFields(jde,o,n),o}function Ude(r,i){let e;return r===1?e=i===1?"Point":"MultiPoint":r===2?e=i===1?"LineString":"MultiLineString":r===3&&(e="Polygon"),e}var LS=xO;var SO=class{read(i){if(!i)return null;if(typeof i=="string"){let e=Pc(i);return this.readFromDocument(e)}return Fc(i)?this.readFromDocument(i):this.readFromNode(i)}readFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(i){Ti()}},Uv=SO;var zde="http://www.w3.org/1999/xlink";function dg(r){return r.getAttributeNS(zde,"href")}var gd=[null,"http://www.opengis.net/ows/1.1"],$de=It(gd,{ServiceIdentification:Xe(mhe),ServiceProvider:Xe(ghe),OperationsMetadata:Xe(hhe)}),CO=class extends Uv{constructor(){super()}readFromNode(i){let e=Lt({},$de,i,[]);return e||null}},Wde=It(gd,{DeliveryPoint:Xe(zt),City:Xe(zt),AdministrativeArea:Xe(zt),PostalCode:Xe(zt),Country:Xe(zt),ElectronicMailAddress:Xe(zt)}),Hde=It(gd,{Value:Fo(_he)}),qde=It(gd,{AllowedValues:Xe(ohe)}),Yde=It(gd,{Phone:Xe(phe),Address:Xe(nhe)}),Zde=It(gd,{HTTP:Xe(uhe)}),Xde=It(gd,{Get:Fo(che),Post:void 0}),Kde=It(gd,{DCP:Xe(lhe)}),Qde=It(gd,{Operation:dhe}),Jde=It(gd,{Voice:Xe(zt),Facsimile:Xe(zt)}),ehe=It(gd,{Constraint:Fo(ahe)}),the=It(gd,{IndividualName:Xe(zt),PositionName:Xe(zt),ContactInfo:Xe(she)}),ihe=It(gd,{Abstract:Xe(zt),AccessConstraints:Xe(zt),Fees:Xe(zt),Title:Xe(zt),ServiceTypeVersion:Xe(zt),ServiceType:Xe(zt)}),rhe=It(gd,{ProviderName:Xe(zt),ProviderSite:Xe(dg),ServiceContact:Xe(fhe)});function nhe(r,i){return Lt({},Wde,r,i)}function ohe(r,i){return Lt({},Hde,r,i)}function ahe(r,i){let e=r.getAttribute("name");if(e)return Lt({name:e},qde,r,i)}function she(r,i){return Lt({},Yde,r,i)}function lhe(r,i){return Lt({},Zde,r,i)}function che(r,i){let e=dg(r);if(e)return Lt({href:e},ehe,r,i)}function uhe(r,i){return Lt({},Xde,r,i)}function dhe(r,i){let e=r.getAttribute("name"),n=Lt({},Kde,r,i);if(!n)return;let o=i[i.length-1];o[e]=n}function hhe(r,i){return Lt({},Qde,r,i)}function phe(r,i){return Lt({},Jde,r,i)}function mhe(r,i){return Lt({},ihe,r,i)}function fhe(r,i){return Lt({},the,r,i)}function ghe(r,i){return Lt({},rhe,r,i)}function _he(r,i){return zt(r)}var GI=CO;function AO(r,i,e,n,o,s){o!==void 0?(o=o,s=s!==void 0?s:0):(o=[],s=0);let l=i;for(;l<e;){let h=r[l++];o[s++]=r[l++],o[s++]=h;for(let p=2;p<n;++p)o[s++]=r[l++]}return o.length=s,o}var MO=class extends Nv{constructor(i){super(),i=i||{},this.dataProjection=ni("EPSG:4326"),this.factor_=i.factor?i.factor:1e5,this.geometryLayout_=i.geometryLayout?i.geometryLayout:"XY"}readFeatureFromText(i,e){let n=this.readGeometryFromText(i,e);return new gi(n)}readFeaturesFromText(i,e){return[this.readFeatureFromText(i,e)]}readGeometryFromText(i,e){let n=wy(this.geometryLayout_),o=vhe(i,n,this.factor_);AO(o,0,o.length,n,o);let s=dd(o,0,o.length,n),l=new Tr(s,this.geometryLayout_);return xn(l,!1,this.adaptOptions(e))}writeFeatureText(i,e){let n=i.getGeometry();if(n)return this.writeGeometryText(n,e);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(i,e){return this.writeFeatureText(i[0],e)}writeGeometryText(i,e){i=xn(i,!0,this.adaptOptions(e));let n=i.getFlatCoordinates(),o=i.getStride();return AO(n,0,n.length,o,n),yhe(n,o,this.factor_)}};function yhe(r,i,e){e=e||1e5;let n,o=new Array(i);for(n=0;n<i;++n)o[n]=0;for(let s=0,l=r.length;s<l;)for(n=0;n<i;++n,++s){let h=r[s],p=h-o[n];o[n]=h,r[s]=p}return bhe(r,e)}function vhe(r,i,e){e=e||1e5;let n,o=new Array(i);for(n=0;n<i;++n)o[n]=0;let s=whe(r,e);for(let l=0,h=s.length;l<h;)for(n=0;n<i;++n,++l)o[n]+=s[l],s[l]=o[n];return s}function bhe(r,i){i=i||1e5;for(let e=0,n=r.length;e<n;++e)r[e]=Math.round(r[e]*i);return xhe(r)}function whe(r,i){i=i||1e5;let e=She(r);for(let n=0,o=e.length;n<o;++n)e[n]/=i;return e}function xhe(r){for(let i=0,e=r.length;i<e;++i){let n=r[i];r[i]=n<0?~(n<<1):n<<1}return Che(r)}function She(r){let i=Ahe(r);for(let e=0,n=i.length;e<n;++e){let o=i[e];i[e]=o&1?~(o>>1):o>>1}return i}function Che(r){let i="";for(let e=0,n=r.length;e<n;++e)i+=Mhe(r[e]);return i}function Ahe(r){let i=[],e=0,n=0;for(let o=0,s=r.length;o<s;++o){let l=r.charCodeAt(o)-63;e|=(l&31)<<n,l<32?(i.push(e),e=0,n=0):n+=5}return i}function Mhe(r){let i,e="";for(;r>=32;)i=(32|r&31)+63,e+=String.fromCharCode(i),r>>=5;return i=r+63,e+=String.fromCharCode(i),e}var G$=MO;var IO=class extends Tv{constructor(i){super(),i=i||{},this.layerName_=i.layerName,this.layers_=i.layers?i.layers:null,this.dataProjection=ni(i.dataProjection?i.dataProjection:"EPSG:4326")}readFeaturesFromObject(i,e){if(i.type=="Topology"){let n=i,o,s=null,l=null;n.transform&&(o=n.transform,s=o.scale,l=o.translate);let h=n.arcs;o&&Dhe(h,s,l);let p=[],m=n.objects,f=this.layerName_,g;for(let y in m)this.layers_&&!this.layers_.includes(y)||(m[y].type==="GeometryCollection"?(g=m[y],p.push.apply(p,Ohe(g,h,s,l,f,y,e))):(g=m[y],p.push(j$(g,h,s,l,f,y,e))));return p}return[]}readProjectionFromObject(i){return this.dataProjection}},Ihe={Point:Ehe,LineString:Fhe,Polygon:Lhe,MultiPoint:The,MultiLineString:Phe,MultiPolygon:khe};function jI(r,i){let e=[],n;for(let o=0,s=r.length;o<s;++o)if(n=r[o],o>0&&e.pop(),n>=0){let l=i[n];for(let h=0,p=l.length;h<p;++h)e.push(l[h].slice(0))}else{let l=i[~n];for(let h=l.length-1;h>=0;--h)e.push(l[h].slice(0))}return e}function Ehe(r,i,e){let n=r.coordinates;return i&&e&&EO(n,i,e),new Ii(n)}function The(r,i,e){let n=r.coordinates;if(i&&e)for(let o=0,s=n.length;o<s;++o)EO(n[o],i,e);return new tl(n)}function Fhe(r,i){let e=jI(r.arcs,i);return new Tr(e)}function Phe(r,i){let e=[];for(let n=0,o=r.arcs.length;n<o;++n)e[n]=jI(r.arcs[n],i);return new Ko(e)}function Lhe(r,i){let e=[];for(let n=0,o=r.arcs.length;n<o;++n)e[n]=jI(r.arcs[n],i);return new on(e)}function khe(r,i){let e=[];for(let n=0,o=r.arcs.length;n<o;++n){let s=r.arcs[n],l=[];for(let h=0,p=s.length;h<p;++h)l[h]=jI(s[h],i);e[n]=l}return new es(e)}function Ohe(r,i,e,n,o,s,l){let h=r.geometries,p=[];for(let m=0,f=h.length;m<f;++m)p[m]=j$(h[m],i,e,n,o,s,l);return p}function j$(r,i,e,n,o,s,l){let h=null,p=r.type;if(p){let g=Ihe[p];p==="Point"||p==="MultiPoint"?h=g(r,e,n):h=g(r,i),h=xn(h,!1,l)}let m=new gi({geometry:h});r.id!==void 0&&m.setId(r.id);let f=r.properties;return o&&(f||(f={}),f[o]=s),f&&m.setProperties(f,!0),m}function Dhe(r,i,e){for(let n=0,o=r.length;n<o;++n)Rhe(r[n],i,e)}function Rhe(r,i,e){let n=0,o=0;for(let s=0,l=r.length;s<l;++s){let h=r[s];n+=h[0],o+=h[1],h[0]=n,h[1]=o,EO(h,i,e)}}function EO(r,i,e){r[0]=r[0]*i[0]+e[0],r[1]=r[1]*i[1]+e[1]}var VI=IO;var ro=class extends Ur{constructor(i){i=i||{},super(i),this.schemaLocation=i.schemaLocation?i.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(i,e,n){let o=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},o),super.writeGeometryElement(i,e,n)}};ro.prototype.namespace="http://www.opengis.net/gml/3.2";ro.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:Ki(Ur.prototype.readFlatPos),posList:Ki(Ur.prototype.readFlatPosList),coordinates:Ki(Fu.prototype.readFlatCoordinates)}};ro.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:Ur.prototype.interiorParser,exterior:Ur.prototype.exteriorParser}};ro.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Ki(Jr.prototype.readPoint),MultiPoint:Ki(Jr.prototype.readMultiPoint),LineString:Ki(Jr.prototype.readLineString),MultiLineString:Ki(Jr.prototype.readMultiLineString),LinearRing:Ki(Jr.prototype.readLinearRing),Polygon:Ki(Jr.prototype.readPolygon),MultiPolygon:Ki(Jr.prototype.readMultiPolygon),Surface:Ki(ro.prototype.readSurface),MultiSurface:Ki(Ur.prototype.readMultiSurface),Curve:Ki(ro.prototype.readCurve),MultiCurve:Ki(Ur.prototype.readMultiCurve),Envelope:Ki(ro.prototype.readEnvelope)}};ro.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:Mi(Ur.prototype.curveMemberParser),curveMembers:Mi(Ur.prototype.curveMemberParser)}};ro.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:Mi(Ur.prototype.surfaceMemberParser),surfaceMembers:Mi(Ur.prototype.surfaceMemberParser)}};ro.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Mi(Jr.prototype.readLineString),Curve:Mi(Ur.prototype.readCurve)}};ro.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Mi(Jr.prototype.readPolygon),Surface:Mi(Ur.prototype.readSurface)}};ro.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:Ki(Ur.prototype.readPatch)}};ro.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:Ki(Ur.prototype.readSegment)}};ro.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:Mi(Ur.prototype.readFlatPosList),upperCorner:Mi(Ur.prototype.readFlatPosList)}};ro.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:Ki(Ur.prototype.readPolygonPatch)}};ro.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:My(Ur.prototype.readLineStringSegment)}};ro.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:Mi(Jr.prototype.pointMemberParser),pointMembers:Mi(Jr.prototype.pointMemberParser)}};ro.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:Mi(Jr.prototype.lineStringMemberParser),lineStringMembers:Mi(Jr.prototype.lineStringMemberParser)}};ro.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:Mi(Jr.prototype.polygonMemberParser),polygonMembers:Mi(Jr.prototype.polygonMemberParser)}};ro.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:Mi(Jr.prototype.readFlatCoordinatesFromNode)}};ro.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:Mi(Jr.prototype.readLineString)}};ro.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:Mi(Jr.prototype.readPolygon)}};ro.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:Ki(Jr.prototype.readFlatLinearRing),Ring:Ki(ro.prototype.readFlatCurveRing)}};ro.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:it(Ur.prototype.writeRing),interior:it(Ur.prototype.writeRing)}};ro.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:it(hr),upperCorner:it(hr)}};ro.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:it(Ur.prototype.writeSurfaceOrPolygonMember),polygonMember:it(Ur.prototype.writeSurfaceOrPolygonMember)}};ro.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:it(Ur.prototype.writePointMember)}};ro.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:it(Ur.prototype.writeLineStringOrCurveMember),curveMember:it(Ur.prototype.writeLineStringOrCurveMember)}};ro.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:it(Ur.prototype.writeCurveOrLineString),MultiCurve:it(Ur.prototype.writeMultiCurveOrLineString),Point:it(ro.prototype.writePoint),MultiPoint:it(Ur.prototype.writeMultiPoint),LineString:it(Ur.prototype.writeCurveOrLineString),MultiLineString:it(Ur.prototype.writeMultiCurveOrLineString),LinearRing:it(Ur.prototype.writeLinearRing),Polygon:it(Ur.prototype.writeSurfaceOrPolygon),MultiPolygon:it(Ur.prototype.writeMultiSurfaceOrPolygon),Surface:it(Ur.prototype.writeSurfaceOrPolygon),MultiSurface:it(Ur.prototype.writeMultiSurfaceOrPolygon),Envelope:it(Ur.prototype.writeEnvelope)}};var zv=ro;var TO=class{constructor(i){this.tagName_=i}getTagName(){return this.tagName_}},Um=TO;var FO=class extends Um{constructor(i,e){super(i),this.conditions=e,Hi(this.conditions.length>=2,"At least 2 conditions are required")}},UI=FO;var PO=class extends UI{constructor(i){super("And",Array.prototype.slice.call(arguments))}},V$=PO;var LO=class extends Um{constructor(i,e,n){if(super("BBOX"),this.geometryName=i,this.extent=e,e.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}},U$=LO;var kO=class extends Um{constructor(i,e,n,o){super(i),this.geometryName=e||"the_geom",this.geometry=n,this.srsName=o}},$v=kO;var OO=class extends $v{constructor(i,e,n){super("Contains",i,e,n)}},z$=OO;var DO=class extends Um{constructor(i,e){super(i),this.propertyName=e}},zm=DO;var RO=class extends zm{constructor(i,e,n){super("During",i),this.begin=e,this.end=n}},$$=RO;var NO=class extends zm{constructor(i,e,n,o){super(i,e),this.expression=n,this.matchCase=o}},zh=NO;var BO=class extends zh{constructor(i,e,n){super("PropertyIsEqualTo",i,e,n)}},W$=BO;var GO=class extends zh{constructor(i,e){super("PropertyIsGreaterThan",i,e)}},H$=GO;var jO=class extends zh{constructor(i,e){super("PropertyIsGreaterThanOrEqualTo",i,e)}},q$=jO;var VO=class extends $v{constructor(i,e,n){super("Intersects",i,e,n)}},Y$=VO;var UO=class extends zm{constructor(i,e,n){super("PropertyIsBetween",i),this.lowerBoundary=e,this.upperBoundary=n}},Z$=UO;var zO=class extends zm{constructor(i,e,n,o,s,l){super("PropertyIsLike",i),this.pattern=e,this.wildCard=n!==void 0?n:"*",this.singleChar=o!==void 0?o:".",this.escapeChar=s!==void 0?s:"!",this.matchCase=l}},X$=zO;var $O=class extends zm{constructor(i){super("PropertyIsNull",i)}},K$=$O;var WO=class extends zh{constructor(i,e){super("PropertyIsLessThan",i,e)}},Q$=WO;var HO=class extends zh{constructor(i,e){super("PropertyIsLessThanOrEqualTo",i,e)}},J$=HO;var qO=class extends Um{constructor(i){super("Not"),this.condition=i}},eW=qO;var YO=class extends zh{constructor(i,e,n){super("PropertyIsNotEqualTo",i,e,n)}},tW=YO;var ZO=class extends UI{constructor(i){super("Or",Array.prototype.slice.call(arguments))}},iW=ZO;var XO=class extends $v{constructor(i,e,n){super("Within",i,e,n)}},rW=XO;function kS(r){let i=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(V$,i))}function nW(r){let i=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(iW,i))}function oW(r){return new eW(r)}function OS(r,i,e){return new U$(r,i,e)}function aW(r,i,e){return new z$(r,i,e)}function sW(r,i,e){return new Y$(r,i,e)}function lW(r,i,e){return new rW(r,i,e)}function cW(r,i,e){return new W$(r,i,e)}function uW(r,i,e){return new tW(r,i,e)}function dW(r,i){return new Q$(r,i)}function hW(r,i){return new J$(r,i)}function pW(r,i){return new H$(r,i)}function mW(r,i){return new q$(r,i)}function fW(r){return new K$(r)}function gW(r,i,e){return new Z$(r,i,e)}function _W(r,i,e,n,o,s){return new X$(r,i,e,n,o,s)}function yW(r,i,e){return new $$(r,i,e)}var vW={"http://www.opengis.net/gml":{boundedBy:Xe(Jr.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:Mi(Jr.prototype.readFeaturesInternal)}},Bhe={"http://www.opengis.net/wfs":{totalInserted:Xe(Na),totalUpdated:Xe(Na),totalDeleted:Xe(Na)},"http://www.opengis.net/wfs/2.0":{totalInserted:Xe(Na),totalUpdated:Xe(Na),totalDeleted:Xe(Na)}},Ghe={"http://www.opengis.net/wfs":{TransactionSummary:Xe(wW,"transactionSummary"),InsertResults:Xe(SW,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:Xe(wW,"transactionSummary"),InsertResults:Xe(SW,"insertIds")}},jhe={"http://www.opengis.net/wfs":{PropertyName:it(hr)},"http://www.opengis.net/wfs/2.0":{PropertyName:it(hr)}},GW={"http://www.opengis.net/wfs":{Insert:it(CW),Update:it(MW),Delete:it(AW),Property:it(IW),Native:it(EW)},"http://www.opengis.net/wfs/2.0":{Insert:it(CW),Update:it(MW),Delete:it(AW),Property:it(IW),Native:it(EW)}},jW="feature",JO="http://www.w3.org/2000/xmlns/",eD={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},KO={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},tD={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},bW={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},iD={"2.0.0":zv,"1.1.0":Ur,"1.0.0":Fu},Vhe="1.1.0",QO=class extends jh{constructor(i){super(),i=i||{},this.version_=i.version?i.version:Vhe,this.featureType_=i.featureType,this.featureNS_=i.featureNS,this.gmlFormat_=i.gmlFormat?i.gmlFormat:new iD[this.version_],this.schemaLocation_=i.schemaLocation?i.schemaLocation:bW[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(i){this.featureType_=i}readFeaturesFromNode(i,e){let n={node:i};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(i,e||{}));let o=[n],s;this.version_==="2.0.0"?s=vW:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let l=Lt([],s,i,o,this.gmlFormat_);return l||(l=[]),l}readTransactionResponse(i){if(i){if(typeof i=="string"){let e=Pc(i);return this.readTransactionResponseFromDocument(e)}return Fc(i)?this.readTransactionResponseFromDocument(i):this.readTransactionResponseFromNode(i)}}readFeatureCollectionMetadata(i){if(i){if(typeof i=="string"){let e=Pc(i);return this.readFeatureCollectionMetadataFromDocument(e)}return Fc(i)?this.readFeatureCollectionMetadataFromDocument(i):this.readFeatureCollectionMetadataFromNode(i)}}readFeatureCollectionMetadataFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)}readFeatureCollectionMetadataFromNode(i){let e={},n=Uh(i.getAttribute("numberOfFeatures"));return e.numberOfFeatures=n,Lt(e,vW,i,[],this.gmlFormat_)}readTransactionResponseFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)}readTransactionResponseFromNode(i){return Lt({},Ghe,i,[])}writeGetFeature(i){let e=Ar(KO[this.version_],"GetFeature");e.setAttribute("service","WFS"),e.setAttribute("version",this.version_),i.handle&&e.setAttribute("handle",i.handle),i.outputFormat&&e.setAttribute("outputFormat",i.outputFormat),i.maxFeatures!==void 0&&e.setAttribute("maxFeatures",String(i.maxFeatures)),i.resultType&&e.setAttribute("resultType",i.resultType),i.startIndex!==void 0&&e.setAttribute("startIndex",String(i.startIndex)),i.count!==void 0&&e.setAttribute("count",String(i.count)),i.viewParams!==void 0&&e.setAttribute("viewParams",i.viewParams),e.setAttributeNS(Ip,"xsi:schemaLocation",this.schemaLocation_);let n={node:e};if(Object.assign(n,{version:this.version_,srsName:i.srsName,featureNS:i.featureNS?i.featureNS:this.featureNS_,featurePrefix:i.featurePrefix,propertyNames:i.propertyNames?i.propertyNames:[]}),Hi(Array.isArray(i.featureTypes),"`options.featureTypes` must be an Array"),typeof i.featureTypes[0]=="string"){let o=i.filter;i.bbox&&(Hi(i.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),o=this.combineBboxAndFilter(i.geometryName,i.bbox,i.srsName,o)),Object.assign(n,{geometryName:i.geometryName,filter:o}),BW(e,i.featureTypes,[n])}else i.featureTypes.forEach(o=>{let s=this.combineBboxAndFilter(o.geometryName,o.bbox,i.srsName,i.filter);Object.assign(n,{geometryName:o.geometryName,filter:s}),BW(e,[o.name],[n])});return e}combineBboxAndFilter(i,e,n,o){let s=OS(i,e,n);return o?kS(o,s):s}writeTransaction(i,e,n,o){let s=[],l=o.version?o.version:this.version_,h=Ar(KO[l],"Transaction");h.setAttribute("service","WFS"),h.setAttribute("version",l);let p;o&&(p=o.gmlOptions?o.gmlOptions:{},o.handle&&h.setAttribute("handle",o.handle)),h.setAttributeNS(Ip,"xsi:schemaLocation",bW[l]);let m=Uhe(h,p,l,o);return i&&zI("Insert",i,s,m),e&&zI("Update",e,s,m),n&&zI("Delete",n,s,m),o.nativeElements&&zI("Native",o.nativeElements,s,m),h}readProjectionFromDocument(i){for(let e=i.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null}readProjectionFromNode(i){if(i.firstElementChild&&i.firstElementChild.firstElementChild){i=i.firstElementChild.firstElementChild;for(let e=i.firstElementChild;e;e=e.nextElementSibling)if(!(e.childNodes.length===0||e.childNodes.length===1&&e.firstChild.nodeType===3)){let n=[{}];return this.gmlFormat_.readGeometryElement(e,n),ni(n.pop().srsName)}}return null}};function Uhe(r,i,e,n){let o=n.featurePrefix?n.featurePrefix:jW,s;return e==="1.0.0"?s=2:e==="1.1.0"?s=3:e==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:e,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:o,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},i)}function zI(r,i,e,n){yr(n,GW,Ho(r),i,e)}function wW(r,i){return Lt({},Bhe,r,i)}var zhe={"http://www.opengis.net/ogc":{FeatureId:Mi(function(r,i){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:Mi(function(r,i){return r.getAttribute("fid")})}};function xW(r,i){zl(zhe,r,i)}var $he={"http://www.opengis.net/wfs":{Feature:xW},"http://www.opengis.net/wfs/2.0":{Feature:xW}};function SW(r,i){return Lt([],$he,r,i)}function CW(r,i,e){let n=e[e.length-1],o=n.featureType,s=n.featureNS,l=n.gmlVersion,h=Ar(s,o);r.appendChild(h),l===2?Fu.prototype.writeFeatureElement(h,i,e):l===3?Ur.prototype.writeFeatureElement(h,i,e):zv.prototype.writeFeatureElement(h,i,e)}function VW(r,i,e){let o=e[e.length-1].version,s=eD[o],l=Ar(s,"Filter"),h=Ar(s,"FeatureId");l.appendChild(h),h.setAttribute("fid",i),r.appendChild(l)}function rD(r,i){r=r||jW;let e=r+":";return i.startsWith(e)?i:e+i}function AW(r,i,e){let n=e[e.length-1];Hi(i.getId()!==void 0,"Features must have an id set");let o=n.featureType,s=n.featurePrefix,l=n.featureNS,h=rD(s,o);r.setAttribute("typeName",h),r.setAttributeNS(JO,"xmlns:"+s,l);let p=i.getId();p!==void 0&&VW(r,p,e)}function MW(r,i,e){let n=e[e.length-1];Hi(i.getId()!==void 0,"Features must have an id set");let o=n.version,s=n.featureType,l=n.featurePrefix,h=n.featureNS,p=rD(l,s),m=i.getGeometryName();r.setAttribute("typeName",p),r.setAttributeNS(JO,"xmlns:"+l,h);let f=i.getId();if(f!==void 0){let g=i.getKeys(),y=[];for(let _=0,w=g.length;_<w;_++){let A=i.get(g[_]);if(A!==void 0){let k=g[_];A&&typeof A.getSimplifiedGeometry=="function"&&(k=m),y.push({name:k,value:A})}}yr({version:o,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},GW,Ho("Property"),y,e),VW(r,f,e)}}function IW(r,i,e){let n=e[e.length-1],o=n.version,s=KO[o],h=Ar(s,o==="2.0.0"?"ValueReference":"Name"),p=n.gmlVersion;if(r.appendChild(h),hr(h,i.name),i.value!==void 0&&i.value!==null){let m=Ar(s,"Value");r.appendChild(m),i.value&&typeof i.value.getSimplifiedGeometry=="function"?p===2?Fu.prototype.writeGeometryElement(m,i.value,e):p===3?Ur.prototype.writeGeometryElement(m,i.value,e):zv.prototype.writeGeometryElement(m,i.value,e):hr(m,i.value)}}function EW(r,i,e){i.vendorId&&r.setAttribute("vendorId",i.vendorId),i.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(i.safeToIgnore)),i.value!==void 0&&hr(r,i.value)}var qI={"http://www.opengis.net/wfs":{Query:it(TW)},"http://www.opengis.net/wfs/2.0":{Query:it(TW)},"http://www.opengis.net/ogc":{During:it(LW),And:it($I),Or:it($I),Not:it(kW),BBOX:it(FW),Contains:it(W0),Intersects:it(W0),Within:it(W0),DWithin:it(PW),PropertyIsEqualTo:it($h),PropertyIsNotEqualTo:it($h),PropertyIsLessThan:it($h),PropertyIsLessThanOrEqualTo:it($h),PropertyIsGreaterThan:it($h),PropertyIsGreaterThanOrEqualTo:it($h),PropertyIsNull:it(OW),PropertyIsBetween:it(DW),PropertyIsLike:it(RW)},"http://www.opengis.net/fes/2.0":{During:it(LW),And:it($I),Or:it($I),Not:it(kW),BBOX:it(FW),Contains:it(W0),Disjoint:it(W0),Intersects:it(W0),ResourceId:it(Hhe),Within:it(W0),DWithin:it(PW),PropertyIsEqualTo:it($h),PropertyIsNotEqualTo:it($h),PropertyIsLessThan:it($h),PropertyIsLessThanOrEqualTo:it($h),PropertyIsGreaterThan:it($h),PropertyIsGreaterThanOrEqualTo:it($h),PropertyIsNull:it(OW),PropertyIsBetween:it(DW),PropertyIsLike:it(RW)}};function TW(r,i,e){let n=e[e.length-1],o=n.version,s=n.featurePrefix,l=n.featureNS,h=n.propertyNames,p=n.srsName,m;s?m=rD(s,i):m=i;let f;o==="2.0.0"?f="typeNames":f="typeName",r.setAttribute(f,m),p&&r.setAttribute("srsName",p),l&&r.setAttributeNS(JO,"xmlns:"+s,l);let g=Object.assign({},n);g.node=r,yr(g,jhe,Ho("PropertyName"),h,e);let y=n.filter;if(y){let _=Ar(YI(o),"Filter");r.appendChild(_),Whe(_,y,e)}}function Whe(r,i,e){let n=e[e.length-1],o={node:r};Object.assign(o,{context:n}),yr(o,qI,Ho(i.getTagName()),[i],e)}function FW(r,i,e){let n=e[e.length-1],s=n.context.version;n.srsName=i.srsName;let l=iD[s];Wv(s,r,i.geometryName),l.prototype.writeGeometryElement(r,i.extent,e)}function Hhe(r,i,e){r.setAttribute("rid",i.rid)}function W0(r,i,e){let n=e[e.length-1],s=n.context.version;n.srsName=i.srsName;let l=iD[s];Wv(s,r,i.geometryName),l.prototype.writeGeometryElement(r,i.geometry,e)}function PW(r,i,e){let s=e[e.length-1].context.version;W0(r,i,e);let l=Ar(YI(s),"Distance");hr(l,i.distance.toString()),s==="2.0.0"?l.setAttribute("uom",i.unit):l.setAttribute("units",i.unit),r.appendChild(l)}function LW(r,i,e){let s=e[e.length-1].context.version;WI(tD[s],"ValueReference",r,i.propertyName);let l=Ar(Vh,"TimePeriod");r.appendChild(l);let h=Ar(Vh,"begin");l.appendChild(h),NW(h,i.begin);let p=Ar(Vh,"end");l.appendChild(p),NW(p,i.end)}function $I(r,i,e){let o=e[e.length-1].context,s={node:r};Object.assign(s,{context:o});let l=i.conditions;for(let h=0,p=l.length;h<p;++h){let m=l[h];yr(s,qI,Ho(m.getTagName()),[m],e)}}function kW(r,i,e){let o=e[e.length-1].context,s={node:r};Object.assign(s,{context:o});let l=i.condition;yr(s,qI,Ho(l.getTagName()),[l],e)}function $h(r,i,e){let s=e[e.length-1].context.version;i.matchCase!==void 0&&r.setAttribute("matchCase",i.matchCase.toString()),Wv(s,r,i.propertyName),HI(s,r,""+i.expression)}function OW(r,i,e){let s=e[e.length-1].context.version;Wv(s,r,i.propertyName)}function DW(r,i,e){let s=e[e.length-1].context.version,l=YI(s);Wv(s,r,i.propertyName);let h=Ar(l,"LowerBoundary");r.appendChild(h),HI(s,h,""+i.lowerBoundary);let p=Ar(l,"UpperBoundary");r.appendChild(p),HI(s,p,""+i.upperBoundary)}function RW(r,i,e){let s=e[e.length-1].context.version;r.setAttribute("wildCard",i.wildCard),r.setAttribute("singleChar",i.singleChar),r.setAttribute("escapeChar",i.escapeChar),i.matchCase!==void 0&&r.setAttribute("matchCase",i.matchCase.toString()),Wv(s,r,i.propertyName),HI(s,r,""+i.pattern)}function WI(r,i,e,n){let o=Ar(r,i);hr(o,n),e.appendChild(o)}function HI(r,i,e){WI(YI(r),"Literal",i,e)}function Wv(r,i,e){r==="2.0.0"?WI(tD[r],"ValueReference",i,e):WI(eD[r],"PropertyName",i,e)}function NW(r,i){let e=Ar(Vh,"TimeInstant");r.appendChild(e);let n=Ar(Vh,"timePosition");e.appendChild(n),hr(n,i)}function BW(r,i,e){let n=e[e.length-1],o=Object.assign({},n);o.node=r,yr(o,qI,Ho("Query"),i,e)}function YI(r){let i;return r==="2.0.0"?i=tD[r]:i=eD[r],i}var Wh=QO;var Po={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17},ZI=class{constructor(i){this.view_=i,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(i){return this.view_.getUint32((this.pos_+=4)-4,i!==void 0?i:this.isLittleEndian_)}readDouble(i){return this.view_.getFloat64((this.pos_+=8)-8,i!==void 0?i:this.isLittleEndian_)}readPoint(){let i=[];return i.push(this.readDouble()),i.push(this.readDouble()),this.hasZ_&&i.push(this.readDouble()),this.hasM_&&i.push(this.readDouble()),i}readLineString(){let i=this.readUint32(),e=[];for(let n=0;n<i;n++)e.push(this.readPoint());return e}readPolygon(){let i=this.readUint32(),e=[];for(let n=0;n<i;n++)e.push(this.readLineString());return e}readWkbHeader(i){let n=this.readUint8()>0,o=this.readUint32(n),s=Math.floor((o&268435455)/1e3),l=!!(o&2147483648)||s===1||s===3,h=!!(o&1073741824)||s===2||s===3,p=!!(o&536870912),m=(o&268435455)%1e3,f=["XY",l?"Z":"",h?"M":""].join(""),g=p?this.readUint32(n):null;if(i!==void 0&&i!==m)throw new Error("Unexpected WKB geometry type "+m);if(this.initialized_){if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==f)throw new Error("Inconsistent geometry layout");if(g&&this.srid_!==g)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=n,this.hasZ_=l,this.hasM_=h,this.layout_=f,this.srid_=g,this.initialized_=!0;return m}readWkbPayload(i){switch(i){case Po.POINT:return this.readPoint();case Po.LINE_STRING:return this.readLineString();case Po.POLYGON:case Po.TRIANGLE:return this.readPolygon();case Po.MULTI_POINT:return this.readMultiPoint();case Po.MULTI_LINE_STRING:return this.readMultiLineString();case Po.MULTI_POLYGON:case Po.POLYHEDRAL_SURFACE:case Po.TIN:return this.readMultiPolygon();case Po.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+i+" is found")}}readWkbBlock(i){return this.readWkbPayload(this.readWkbHeader(i))}readWkbCollection(i,e){let n=this.readUint32(),o=[];for(let s=0;s<n;s++){let l=i.call(this,e);l&&o.push(l)}return o}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,Po.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,Po.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,Po.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){let i=this.readWkbHeader(),e=this.readWkbPayload(i);switch(i){case Po.POINT:return new Ii(e,this.layout_);case Po.LINE_STRING:return new Tr(e,this.layout_);case Po.POLYGON:case Po.TRIANGLE:return new on(e,this.layout_);case Po.MULTI_POINT:return new tl(e,this.layout_);case Po.MULTI_LINE_STRING:return new Ko(e,this.layout_);case Po.MULTI_POLYGON:case Po.POLYHEDRAL_SURFACE:case Po.TIN:return new es(e,this.layout_);case Po.GEOMETRY_COLLECTION:return new _s(e);default:return null}}getSrid(){return this.srid_}},nD=class{constructor(i){i=i||{},this.layout_=i.layout,this.isLittleEndian_=i.littleEndian!==!1,this.isEWKB_=i.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},i.nodata)}writeUint8(i){this.writeQueue_.push([1,i])}writeUint32(i){this.writeQueue_.push([4,i])}writeDouble(i){this.writeQueue_.push([8,i])}writePoint(i,e){let n=Object.assign.apply(null,e.split("").map((o,s)=>({[o]:i[s]})));for(let o of this.layout_)this.writeDouble(o in n?n[o]:this.nodata_[o])}writeLineString(i,e){this.writeUint32(i.length);for(let n=0;n<i.length;n++)this.writePoint(i[n],e)}writePolygon(i,e){this.writeUint32(i.length);for(let n=0;n<i.length;n++)this.writeLineString(i[n],e)}writeWkbHeader(i,e){i%=1e3,this.layout_.includes("Z")&&(i+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(i+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(e)&&(i|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(i),this.isEWKB_&&Number.isInteger(e)&&this.writeUint32(e)}writeMultiPoint(i,e){this.writeUint32(i.length);for(let n=0;n<i.length;n++)this.writeWkbHeader(1),this.writePoint(i[n],e)}writeMultiLineString(i,e){this.writeUint32(i.length);for(let n=0;n<i.length;n++)this.writeWkbHeader(2),this.writeLineString(i[n],e)}writeMultiPolygon(i,e){this.writeUint32(i.length);for(let n=0;n<i.length;n++)this.writeWkbHeader(3),this.writePolygon(i[n],e)}writeGeometryCollection(i){this.writeUint32(i.length);for(let e=0;e<i.length;e++)this.writeGeometry(i[e])}findMinimumLayout(i,e="XYZM"){let n=(o,s)=>o===s?o:o==="XYZM"?s:s==="XYZM"?o:"XY";if(i instanceof Vl)return n(i.getLayout(),e);if(i instanceof _s){let o=i.getGeometriesArray();for(let s=0;s<o.length&&e!=="XY";s++)e=this.findMinimumLayout(o[s],e)}return e}writeGeometry(i,e){let n={Point:Po.POINT,LineString:Po.LINE_STRING,Polygon:Po.POLYGON,MultiPoint:Po.MULTI_POINT,MultiLineString:Po.MULTI_LINE_STRING,MultiPolygon:Po.MULTI_POLYGON,GeometryCollection:Po.GEOMETRY_COLLECTION},o=i.getType(),s=n[o];if(!s)throw new Error("GeometryType "+o+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(i)),this.writeWkbHeader(s,e),i instanceof Vl?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[o].call(this,i.getCoordinates(),i.getLayout()):i instanceof _s&&this.writeGeometryCollection(i.getGeometriesArray())}getBuffer(){let i=this.writeQueue_.reduce((s,l)=>s+l[0],0),e=new ArrayBuffer(i),n=new DataView(e),o=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(o,s[1]);break;case 4:n.setUint32(o,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(o,s[1],this.isLittleEndian_);break;default:break}o+=s[0]}),e}},oD=class extends Dm{constructor(i){super(),i=i||{},this.splitCollection=!!i.splitCollection,this.viewCache_=null,this.hex_=i.hex!==!1,this.littleEndian_=i.littleEndian!==!1,this.ewkb_=i.ewkb!==!1,this.layout_=i.geometryLayout,this.nodataZ_=i.nodataZ||0,this.nodataM_=i.nodataM||0,this.srid_=i.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(i,e){return new gi({geometry:this.readGeometry(i,e)})}readFeatures(i,e){let n=[],o=this.readGeometry(i,e);return this.splitCollection&&o instanceof _s?n=o.getGeometriesArray():n=[o],n.map(s=>new gi({geometry:s}))}readGeometry(i,e){let n=UW(i);if(!n)return null;let s=new ZI(n).readGeometry();return this.viewCache_=n,e=this.getReadOptions(i,e),this.viewCache_=null,xn(s,!1,e)}readProjection(i){let e=this.viewCache_||UW(i);if(!e)return;let n=new ZI(e);return n.readWkbHeader(),n.getSrid()&&ni("EPSG:"+n.getSrid())||void 0}writeFeature(i,e){return this.writeGeometry(i.getGeometry(),e)}writeFeatures(i,e){return this.writeGeometry(new _s(i.map(n=>n.getGeometry())),e)}writeGeometry(i,e){e=this.adaptOptions(e);let n=new nD({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}}),o=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){let l=e.dataProjection&&ni(e.dataProjection);if(l){let h=l.getCode();h.startsWith("EPSG:")&&(o=Number(h.substring(5)))}}n.writeGeometry(xn(i,!0,e),o);let s=n.getBuffer();return this.hex_?qhe(s):s}};function qhe(r){let i=new Uint8Array(r);return Array.from(i.values()).map(e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase()).join("")}function Yhe(r){let i=new Uint8Array(r.length/2);for(let e=0;e<r.length/2;e++)i[e]=parseInt(r.substr(e*2,2),16);return new DataView(i.buffer)}function UW(r){return typeof r=="string"?Yhe(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}var zW=oD;var Zhe={POINT:Ii,LINESTRING:Tr,POLYGON:on,MULTIPOINT:tl,MULTILINESTRING:Ko,MULTIPOLYGON:es},$W="EMPTY",WW="Z",HW="M",Xhe="ZM",bo={START:0,TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6},Khe={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"},aD=class{constructor(i){this.wkt=i,this.index_=-1}isAlpha_(i){return i>="a"&&i<="z"||i>="A"&&i<="Z"}isNumeric_(i,e){return e=e!==void 0?e:!1,i>="0"&&i<="9"||i=="."&&!e}isWhiteSpace_(i){return i==" "||i=="	"||i=="\r"||i==`
`}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){let i=this.nextChar_(),e=this.index_,n=i,o;if(i=="(")o=bo.LEFT_PAREN;else if(i==",")o=bo.COMMA;else if(i==")")o=bo.RIGHT_PAREN;else if(this.isNumeric_(i)||i=="-")o=bo.NUMBER,n=this.readNumber_();else if(this.isAlpha_(i))o=bo.TEXT,n=this.readText_();else{if(this.isWhiteSpace_(i))return this.nextToken();if(i==="")o=bo.EOF;else throw new Error("Unexpected character: "+i)}return{position:e,value:n,type:o}}readNumber_(){let i,e=this.index_,n=!1,o=!1;do i=="."?n=!0:(i=="e"||i=="E")&&(o=!0),i=this.nextChar_();while(this.isNumeric_(i,n)||!o&&(i=="e"||i=="E")||o&&(i=="-"||i=="+"));return parseFloat(this.wkt.substring(e,this.index_--))}readText_(){let i,e=this.index_;do i=this.nextChar_();while(this.isAlpha_(i));return this.wkt.substring(e,this.index_--).toUpperCase()}},sD=class{constructor(i){this.lexer_=i,this.token_={position:0,type:bo.START},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(i){return this.token_.type==i}match(i){let e=this.isTokenType(i);return e&&this.consume_(),e}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let i="XY",e=this.token_;if(this.isTokenType(bo.TEXT)){let n=e.value;n===WW?i="XYZ":n===HW?i="XYM":n===Xhe&&(i="XYZM"),i!=="XY"&&this.consume_()}return i}parseGeometryCollectionText_(){if(this.match(bo.LEFT_PAREN)){let i=[];do i.push(this.parseGeometry_());while(this.match(bo.COMMA));if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(bo.LEFT_PAREN)){let i=this.parsePoint_();if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(bo.LEFT_PAREN)){let i=this.parsePointList_();if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(bo.LEFT_PAREN)){let i=this.parseLineStringTextList_();if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(bo.LEFT_PAREN)){let i;if(this.token_.type==bo.LEFT_PAREN?i=this.parsePointTextList_():i=this.parsePointList_(),this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(bo.LEFT_PAREN)){let i=this.parseLineStringTextList_();if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(bo.LEFT_PAREN)){let i=this.parsePolygonTextList_();if(this.match(bo.RIGHT_PAREN))return i}throw new Error(this.formatErrorMessage_())}parsePoint_(){let i=[],e=this.layout_.length;for(let n=0;n<e;++n){let o=this.token_;if(this.match(bo.NUMBER))i.push(o.value);else break}if(i.length==e)return i;throw new Error(this.formatErrorMessage_())}parsePointList_(){let i=[this.parsePoint_()];for(;this.match(bo.COMMA);)i.push(this.parsePoint_());return i}parsePointTextList_(){let i=[this.parsePointText_()];for(;this.match(bo.COMMA);)i.push(this.parsePointText_());return i}parseLineStringTextList_(){let i=[this.parseLineStringText_()];for(;this.match(bo.COMMA);)i.push(this.parseLineStringText_());return i}parsePolygonTextList_(){let i=[this.parsePolygonText_()];for(;this.match(bo.COMMA);)i.push(this.parsePolygonText_());return i}isEmptyGeometry_(){let i=this.isTokenType(bo.TEXT)&&this.token_.value==$W;return i&&this.consume_(),i}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){let i=this.token_;if(this.match(bo.TEXT)){let e=i.value;this.layout_=this.parseGeometryLayout_();let n=this.isEmptyGeometry_();if(e=="GEOMETRYCOLLECTION"){if(n)return new _s([]);let l=this.parseGeometryCollectionText_();return new _s(l)}let o=Zhe[e];if(!o)throw new Error("Invalid geometry type: "+e);let s;if(n)e=="POINT"?s=[NaN,NaN]:s=[];else switch(e){case"POINT":{s=this.parsePointText_();break}case"LINESTRING":{s=this.parseLineStringText_();break}case"POLYGON":{s=this.parsePolygonText_();break}case"MULTIPOINT":{s=this.parseMultiPointText_();break}case"MULTILINESTRING":{s=this.parseMultiLineStringText_();break}case"MULTIPOLYGON":{s=this.parseMultiPolygonText_();break}default:break}return new o(s,this.layout_)}throw new Error(this.formatErrorMessage_())}},lD=class extends Nv{constructor(i){super(),i=i||{},this.splitCollection_=i.splitCollection!==void 0?i.splitCollection:!1}parse_(i){let e=new aD(i);return new sD(e).parse()}readFeatureFromText(i,e){let n=this.readGeometryFromText(i,e),o=new gi;return o.setGeometry(n),o}readFeaturesFromText(i,e){let n=[],o=this.readGeometryFromText(i,e);this.splitCollection_&&o.getType()=="GeometryCollection"?n=o.getGeometriesArray():n=[o];let s=[];for(let l=0,h=n.length;l<h;++l){let p=new gi;p.setGeometry(n[l]),s.push(p)}return s}readGeometryFromText(i,e){let n=this.parse_(i);return xn(n,!1,e)}writeFeatureText(i,e){let n=i.getGeometry();return n?this.writeGeometryText(n,e):""}writeFeaturesText(i,e){if(i.length==1)return this.writeFeatureText(i[0],e);let n=[];for(let s=0,l=i.length;s<l;++s)n.push(i[s].getGeometry());let o=new _s(n);return this.writeGeometryText(o,e)}writeGeometryText(i,e){return ZW(xn(i,!0,e))}};function qW(r){let i=r.getCoordinates();return i.length===0?"":i.join(" ")}function Qhe(r){let i=[],e=r.getPoints();for(let n=0,o=e.length;n<o;++n)i.push("("+qW(e[n])+")");return i.join(",")}function Jhe(r){let i=[],e=r.getGeometries();for(let n=0,o=e.length;n<o;++n)i.push(ZW(e[n]));return i.join(",")}function cD(r){let i=r.getCoordinates(),e=[];for(let n=0,o=i.length;n<o;++n)e.push(i[n].join(" "));return e.join(",")}function epe(r){let i=[],e=r.getLineStrings();for(let n=0,o=e.length;n<o;++n)i.push("("+cD(e[n])+")");return i.join(",")}function YW(r){let i=[],e=r.getLinearRings();for(let n=0,o=e.length;n<o;++n)i.push("("+cD(e[n])+")");return i.join(",")}function tpe(r){let i=[],e=r.getPolygons();for(let n=0,o=e.length;n<o;++n)i.push("("+YW(e[n])+")");return i.join(",")}function ipe(r){let i=r.getLayout(),e="";return(i==="XYZ"||i==="XYZM")&&(e+=WW),(i==="XYM"||i==="XYZM")&&(e+=HW),e}var rpe={Point:qW,LineString:cD,Polygon:YW,MultiPoint:Qhe,MultiLineString:epe,MultiPolygon:tpe,GeometryCollection:Jhe};function ZW(r){let i=r.getType(),e=rpe[i],n=e(r),o=Khe[i];if(typeof r.getFlatCoordinates=="function"){let s=ipe(r);s.length>0&&(o+=" "+s)}return n.length===0?o+" "+$W:o+"("+n+")"}var _d=lD;var Lc=[null,"http://www.opengis.net/wms"],npe=It(Lc,{Service:Xe(Cpe),Capability:Xe(Spe)}),ope=It(Lc,{Request:Xe(Ppe),Exception:Xe(Epe),Layer:Xe(Tpe)}),dD=class extends Uv{constructor(){super(),this.version=void 0}readFromNode(i){this.version=i.getAttribute("version").trim();let e=Lt({version:this.version},npe,i,[]);return e||null}},ape=It(Lc,{Name:Xe(zt),Title:Xe(zt),Abstract:Xe(zt),KeywordList:Xe(JW),OnlineResource:Xe(dg),ContactInformation:Xe(Ape),Fees:Xe(zt),AccessConstraints:Xe(zt),LayerLimit:Xe(Na),MaxWidth:Xe(Na),MaxHeight:Xe(Na)}),spe=It(Lc,{ContactPersonPrimary:Xe(Mpe),ContactPosition:Xe(zt),ContactAddress:Xe(Ipe),ContactVoiceTelephone:Xe(zt),ContactFacsimileTelephone:Xe(zt),ContactElectronicMailAddress:Xe(zt)}),lpe=It(Lc,{ContactPerson:Xe(zt),ContactOrganization:Xe(zt)}),cpe=It(Lc,{AddressType:Xe(zt),Address:Xe(zt),City:Xe(zt),StateOrProvince:Xe(zt),PostCode:Xe(zt),Country:Xe(zt)}),upe=It(Lc,{Format:Mi(zt)}),XW=It(Lc,{Name:Xe(zt),Title:Xe(zt),Abstract:Xe(zt),KeywordList:Xe(JW),CRS:Fo(zt),EX_GeographicBoundingBox:Xe(xpe),BoundingBox:Fo(wpe),Dimension:Fo(Fpe),Attribution:Xe(bpe),AuthorityURL:Fo(Ope),Identifier:Fo(zt),MetadataURL:Fo(Dpe),DataURL:Fo(hg),FeatureListURL:Fo(hg),Style:Fo(Rpe),MinScaleDenominator:Xe(hn),MaxScaleDenominator:Xe(hn),Layer:Fo(KW)}),dpe=It(Lc,{Title:Xe(zt),OnlineResource:Xe(dg),LogoURL:Xe(QW)}),hpe=It(Lc,{westBoundLongitude:Xe(hn),eastBoundLongitude:Xe(hn),southBoundLatitude:Xe(hn),northBoundLatitude:Xe(hn)}),ppe=It(Lc,{GetCapabilities:Xe(uD),GetMap:Xe(uD),GetFeatureInfo:Xe(uD)}),mpe=It(Lc,{Format:Fo(zt),DCPType:Fo(Lpe)}),fpe=It(Lc,{HTTP:Xe(kpe)}),gpe=It(Lc,{Get:Xe(hg),Post:Xe(hg)}),_pe=It(Lc,{Name:Xe(zt),Title:Xe(zt),Abstract:Xe(zt),LegendURL:Fo(QW),StyleSheetURL:Xe(hg),StyleURL:Xe(hg)}),ype=It(Lc,{Format:Xe(zt),OnlineResource:Xe(dg)}),vpe=It(Lc,{Keyword:Mi(zt)});function bpe(r,i){return Lt({},dpe,r,i)}function wpe(r,i){let e=[Vm(r.getAttribute("minx")),Vm(r.getAttribute("miny")),Vm(r.getAttribute("maxx")),Vm(r.getAttribute("maxy"))],n=[Vm(r.getAttribute("resx")),Vm(r.getAttribute("resy"))];return{crs:r.getAttribute("CRS"),extent:e,res:n}}function xpe(r,i){let e=Lt({},hpe,r,i);if(!e)return;let n=e.westBoundLongitude,o=e.southBoundLatitude,s=e.eastBoundLongitude,l=e.northBoundLatitude;if(!(n===void 0||o===void 0||s===void 0||l===void 0))return[n,o,s,l]}function Spe(r,i){return Lt({},ope,r,i)}function Cpe(r,i){return Lt({},ape,r,i)}function Ape(r,i){return Lt({},spe,r,i)}function Mpe(r,i){return Lt({},lpe,r,i)}function Ipe(r,i){return Lt({},cpe,r,i)}function Epe(r,i){return Lt([],upe,r,i)}function Tpe(r,i){let e=Lt({},XW,r,i);return e.Layer===void 0?Object.assign(e,KW(r,i)):e}function KW(r,i){let e=i[i.length-1],n=Lt({},XW,r,i);if(!n)return;let o=$0(r.getAttribute("queryable"));o===void 0&&(o=e.queryable),n.queryable=o!==void 0?o:!1;let s=Uh(r.getAttribute("cascaded"));s===void 0&&(s=e.cascaded),n.cascaded=s;let l=$0(r.getAttribute("opaque"));l===void 0&&(l=e.opaque),n.opaque=l!==void 0?l:!1;let h=$0(r.getAttribute("noSubsets"));h===void 0&&(h=e.noSubsets),n.noSubsets=h!==void 0?h:!1;let p=Vm(r.getAttribute("fixedWidth"));p||(p=e.fixedWidth),n.fixedWidth=p;let m=Vm(r.getAttribute("fixedHeight"));return m||(m=e.fixedHeight),n.fixedHeight=m,["Style","CRS","AuthorityURL"].forEach(function(y){if(y in e){let _=n[y]||[];n[y]=_.concat(e[y])}}),["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(y){if(!(y in n)){let _=e[y];n[y]=_}}),n}function Fpe(r,i){return{name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol"),default:r.getAttribute("default"),multipleValues:$0(r.getAttribute("multipleValues")),nearestValue:$0(r.getAttribute("nearestValue")),current:$0(r.getAttribute("current")),values:zt(r)}}function hg(r,i){return Lt({},ype,r,i)}function Ppe(r,i){return Lt({},ppe,r,i)}function Lpe(r,i){return Lt({},fpe,r,i)}function kpe(r,i){return Lt({},gpe,r,i)}function uD(r,i){return Lt({},mpe,r,i)}function QW(r,i){let e=hg(r,i);if(e){let n=[Uh(r.getAttribute("width")),Uh(r.getAttribute("height"))];return e.size=n,e}}function Ope(r,i){let e=hg(r,i);if(e)return e.name=r.getAttribute("name"),e}function Dpe(r,i){let e=hg(r,i);if(e)return e.type=r.getAttribute("type"),e}function Rpe(r,i){return Lt({},_pe,r,i)}function JW(r,i){return Lt([],vpe,r,i)}var XI=dD;var Npe="_feature",Bpe="_layer",hD=class extends jh{constructor(i){super(),i=i||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new Fu,this.layers_=i.layers?i.layers:null}getLayers(){return this.layers_}setLayers(i){this.layers_=i}readFeatures_(i,e){i.setAttribute("namespaceURI",this.featureNS_);let n=i.localName,o=[];if(i.childNodes.length===0)return o;if(n=="msGMLOutput")for(let s=0,l=i.childNodes.length;s<l;s++){let h=i.childNodes[s];if(h.nodeType!==Node.ELEMENT_NODE)continue;let p=h,m=e[0],f=Bpe,g=p.localName.replace(f,"");if(this.layers_&&!this.layers_.includes(g))continue;let y=g+Npe;m.featureType=y,m.featureNS=this.featureNS_;let _={};_[y]=Mi(this.gmlFormat_.readFeatureElement,this.gmlFormat_);let w=It([m.featureNS,null],_);p.setAttribute("namespaceURI",this.featureNS_);let A=Lt([],w,p,e,this.gmlFormat_);A&&Cr(o,A)}if(n=="FeatureCollection"){let s=Lt([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,i,[{}],this.gmlFormat_);s&&(o=s)}return o}readFeaturesFromNode(i,e){let n={};return e&&Object.assign(n,this.getReadOptions(i,e)),this.readFeatures_(i,[n])}},DS=hD;var $m=[null,"http://www.opengis.net/wmts/1.0"],Hv=[null,"http://www.opengis.net/ows/1.1"],Gpe=It($m,{Contents:Xe(Zpe)}),pD=class extends Uv{constructor(){super(),this.owsParser_=new GI}readFromNode(i){let e=i.getAttribute("version");e&&(e=e.trim());let n=this.owsParser_.readFromNode(i);return n?(n.version=e,n=Lt(n,Gpe,i,[]),n||null):null}},jpe=It($m,{Layer:Fo(Xpe),TileMatrixSet:Fo(Kpe)}),Vpe=It($m,{Style:Fo(Qpe),Format:Fo(zt),TileMatrixSetLink:Fo(Jpe),Dimension:Fo(eme),ResourceURL:Fo(tme)},It(Hv,{Title:Xe(zt),Abstract:Xe(zt),WGS84BoundingBox:Xe(tH),BoundingBox:Fo(ime),Identifier:Xe(zt)})),Upe=It($m,{LegendURL:Fo(rme)},It(Hv,{Title:Xe(zt),Identifier:Xe(zt)})),zpe=It($m,{TileMatrixSet:Xe(zt),TileMatrixSetLimits:Xe(ome)}),$pe=It($m,{TileMatrixLimits:Mi(ame)}),Wpe=It($m,{TileMatrix:Xe(zt),MinTileRow:Xe(Na),MaxTileRow:Xe(Na),MinTileCol:Xe(Na),MaxTileCol:Xe(Na)}),Hpe=It($m,{Default:Xe(zt),Value:Fo(zt)},It(Hv,{Identifier:Xe(zt)})),eH=It(Hv,{LowerCorner:Mi(mD),UpperCorner:Mi(mD)}),qpe=It($m,{WellKnownScaleSet:Xe(zt),TileMatrix:Fo(nme)},It(Hv,{SupportedCRS:Xe(zt),Identifier:Xe(zt),BoundingBox:Xe(tH)})),Ype=It($m,{TopLeftCorner:Xe(mD),ScaleDenominator:Xe(hn),TileWidth:Xe(Na),TileHeight:Xe(Na),MatrixWidth:Xe(Na),MatrixHeight:Xe(Na)},It(Hv,{Identifier:Xe(zt)}));function Zpe(r,i){return Lt({},jpe,r,i)}function Xpe(r,i){return Lt({},Vpe,r,i)}function Kpe(r,i){return Lt({},qpe,r,i)}function Qpe(r,i){let e=Lt({},Upe,r,i);if(!e)return;let n=r.getAttribute("isDefault")==="true";return e.isDefault=n,e}function Jpe(r,i){return Lt({},zpe,r,i)}function eme(r,i){return Lt({},Hpe,r,i)}function tme(r,i){let e=r.getAttribute("format"),n=r.getAttribute("template"),o=r.getAttribute("resourceType"),s={};return e&&(s.format=e),n&&(s.template=n),o&&(s.resourceType=o),s}function tH(r,i){let e=Lt([],eH,r,i);if(e.length==2)return Ds(e)}function ime(r,i){let e=r.getAttribute("crs"),n=Lt([],eH,r,i);if(n.length==2)return{extent:Ds(n),crs:e}}function rme(r,i){let e={};return e.format=r.getAttribute("format"),e.href=dg(r),e}function mD(r,i){let e=zt(r).split(/\s+/);if(!e||e.length!=2)return;let n=+e[0],o=+e[1];if(!(isNaN(n)||isNaN(o)))return[n,o]}function nme(r,i){return Lt({},Ype,r,i)}function ome(r,i){return Lt([],$pe,r,i)}function ame(r,i){return Lt({},Wpe,r,i)}var KI=pD;var Va={ADD:"add",REMOVE:"remove"};var iH={LENGTH:"length"},qv=class extends To{constructor(i,e,n){super(i),this.element=e,this.index=n}},fD=class extends ls{constructor(i,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=i||[],this.unique_)for(let n=0,o=this.array_.length;n<o;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(i){for(let e=0,n=i.length;e<n;++e)this.push(i[e]);return this}forEach(i){let e=this.array_;for(let n=0,o=e.length;n<o;++n)i(e[n],n,e)}getArray(){return this.array_}item(i){return this.array_[i]}getLength(){return this.get(iH.LENGTH)}insertAt(i,e){if(i<0||i>this.getLength())throw new Error("Index out of bounds: "+i);this.unique_&&this.assertUnique_(e),this.array_.splice(i,0,e),this.updateLength_(),this.dispatchEvent(new qv(Va.ADD,e,i))}pop(){return this.removeAt(this.getLength()-1)}push(i){this.unique_&&this.assertUnique_(i);let e=this.getLength();return this.insertAt(e,i),this.getLength()}remove(i){let e=this.array_;for(let n=0,o=e.length;n<o;++n)if(e[n]===i)return this.removeAt(n)}removeAt(i){if(i<0||i>=this.getLength())return;let e=this.array_[i];return this.array_.splice(i,1),this.updateLength_(),this.dispatchEvent(new qv(Va.REMOVE,e,i)),e}setAt(i,e){let n=this.getLength();if(i>=n){this.insertAt(i,e);return}if(i<0)throw new Error("Index out of bounds: "+i);this.unique_&&this.assertUnique_(e,i);let o=this.array_[i];this.array_[i]=e,this.dispatchEvent(new qv(Va.REMOVE,o,i)),this.dispatchEvent(new qv(Va.ADD,e,i))}updateLength_(){this.set(iH.LENGTH,this.array_.length)}assertUnique_(i,e){for(let n=0,o=this.array_.length;n<o;++n)if(this.array_[n]===i&&n!==e)throw new Error("Duplicate item added to a unique collection")}},Ua=fD;var rH=Jl(QI(),1);var yD=class{constructor(i){this.rbush_=new rH.default(i),this.items_={}}insert(i,e){let n={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3],value:e};this.rbush_.insert(n),this.items_[fi(e)]=n}load(i,e){let n=new Array(e.length);for(let o=0,s=e.length;o<s;o++){let l=i[o],h=e[o],p={minX:l[0],minY:l[1],maxX:l[2],maxY:l[3],value:h};n[o]=p,this.items_[fi(h)]=p}this.rbush_.load(n)}remove(i){let e=fi(i),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(i,e){let n=this.items_[fi(e)],o=[n.minX,n.minY,n.maxX,n.maxY];Wd(o,i)||(this.remove(e),this.insert(i,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(i){let e={minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]};return this.rbush_.search(e).map(function(o){return o.value})}forEach(i){return this.forEach_(this.getAll(),i)}forEachInExtent(i,e){return this.forEach_(this.getInExtent(i),e)}forEach_(i,e){let n;for(let o=0,s=i.length;o<s;o++)if(n=e(i[o]),n)return n;return n}isEmpty(){return Bl(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(i){let e=this.rbush_.toJSON();return jl(e.minX,e.minY,e.maxX,e.maxY,i)}concat(i){this.rbush_.load(i.rbush_.all());for(let e in i.items_)this.items_[e]=i.items_[e]}},RS=yD;var vD=class extends ls{constructor(i){super(),this.projection=ni(i.projection),this.attributions_=nH(i.attributions),this.attributionsCollapsible_=i.attributionsCollapsible!==void 0?i.attributionsCollapsible:!0,this.loading=!1,this.state_=i.state!==void 0?i.state:"ready",this.wrapX_=i.wrapX!==void 0?i.wrapX:!1,this.interpolate_=!!i.interpolate,this.viewResolver=null,this.viewRejector=null;let e=this;this.viewPromise_=new Promise(function(n,o){e.viewResolver=n,e.viewRejector=o})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(i){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(i){this.attributions_=nH(i),this.changed()}setState(i){this.state_=i,this.changed()}};function nH(r){return r?Array.isArray(r)?function(i){return r}:typeof r=="function"?r:function(i){return[r]}:null}var Yv=vD;var au={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function oH(r,i){return[[-1/0,-1/0,1/0,1/0]]}function JI(r,i){return[r]}var sme=!1;function bD(r,i,e,n,o,s,l){let h=new XMLHttpRequest;h.open("GET",typeof r=="function"?r(e,n,o):r,!0),i.getType()=="arraybuffer"&&(h.responseType="arraybuffer"),h.withCredentials=sme,h.onload=function(p){if(!h.status||h.status>=200&&h.status<300){let m=i.getType(),f;m=="json"?f=JSON.parse(h.responseText):m=="text"?f=h.responseText:m=="xml"?(f=h.responseXML,f||(f=new DOMParser().parseFromString(h.responseText,"application/xml"))):m=="arraybuffer"&&(f=h.response),f?s(i.readFeatures(f,{extent:e,featureProjection:o}),i.readProjection(f)):l()}else l()},h.onerror=l,h.send()}function wD(r,i){return function(e,n,o,s,l){let h=this;bD(r,i,e,n,o,function(p,m){h.addFeatures(p),s!==void 0&&s(p)},l||Mp)}}var Wm=class extends To{constructor(i,e,n){super(i),this.feature=e,this.features=n}},xD=class extends Yv{constructor(i){i=i||{},super({attributions:i.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:i.wrapX!==void 0?i.wrapX:!0}),this.on,this.once,this.un,this.loader_=Mp,this.format_=i.format,this.overlaps_=i.overlaps===void 0?!0:i.overlaps,this.url_=i.url,i.loader!==void 0?this.loader_=i.loader:this.url_!==void 0&&(Hi(this.format_,"`format` must be set when `url` is set"),this.loader_=wD(this.url_,this.format_)),this.strategy_=i.strategy!==void 0?i.strategy:oH;let e=i.useSpatialIndex!==void 0?i.useSpatialIndex:!0;this.featuresRtree_=e?new RS:null,this.loadedExtentsRtree_=new RS,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,o;Array.isArray(i.features)?o=i.features:i.features&&(n=i.features,o=n.getArray()),!e&&n===void 0&&(n=new Ua(o)),o!==void 0&&this.addFeaturesInternal(o),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(i){this.addFeatureInternal(i),this.changed()}addFeatureInternal(i){let e=fi(i);if(!this.addToIndex_(e,i)){this.featuresCollection_&&this.featuresCollection_.remove(i);return}this.setupChangeEvents_(e,i);let n=i.getGeometry();if(n){let o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,i)}else this.nullGeometryFeatures_[e]=i;this.dispatchEvent(new Wm(au.ADDFEATURE,i))}setupChangeEvents_(i,e){e instanceof il||(this.featureChangeKeys_[i]=[Vr(e,mi.CHANGE,this.handleFeatureChange_,this),Vr(e,Ap.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(i,e){let n=!0;if(e.getId()!==void 0){let o=String(e.getId());if(!(o in this.idIndex_))this.idIndex_[o]=e;else if(e instanceof il){let s=this.idIndex_[o];s instanceof il?Array.isArray(s)?s.push(e):this.idIndex_[o]=[s,e]:n=!1}else n=!1}return n&&(Hi(!(i in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[i]=e),n}addFeatures(i){this.addFeaturesInternal(i),this.changed()}addFeaturesInternal(i){let e=[],n=[],o=[];for(let s=0,l=i.length;s<l;s++){let h=i[s],p=fi(h);this.addToIndex_(p,h)&&n.push(h)}for(let s=0,l=n.length;s<l;s++){let h=n[s],p=fi(h);this.setupChangeEvents_(p,h);let m=h.getGeometry();if(m){let f=m.getExtent();e.push(f),o.push(h)}else this.nullGeometryFeatures_[p]=h}if(this.featuresRtree_&&this.featuresRtree_.load(e,o),this.hasListener(au.ADDFEATURE))for(let s=0,l=n.length;s<l;s++)this.dispatchEvent(new Wm(au.ADDFEATURE,n[s]))}bindFeaturesCollection_(i){let e=!1;this.addEventListener(au.ADDFEATURE,function(n){e||(e=!0,i.push(n.feature),e=!1)}),this.addEventListener(au.REMOVEFEATURE,function(n){e||(e=!0,i.remove(n.feature),e=!1)}),i.addEventListener(Va.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),i.addEventListener(Va.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=i}clear(i){if(i){for(let n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(wn);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){let n=o=>{this.removeFeatureInternal(o)};this.featuresRtree_.forEach(n);for(let o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};let e=new Wm(au.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(i){if(this.featuresRtree_)return this.featuresRtree_.forEach(i);this.featuresCollection_&&this.featuresCollection_.forEach(i)}forEachFeatureAtCoordinateDirect(i,e){let n=[i[0],i[1],i[0],i[1]];return this.forEachFeatureInExtent(n,function(o){let s=o.getGeometry();if(s instanceof il||s.intersectsCoordinate(i))return e(o)})}forEachFeatureInExtent(i,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(i,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(i,e){return this.forEachFeatureInExtent(i,function(n){let o=n.getGeometry();if(o instanceof il||o.intersectsExtent(i)){let s=e(n);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let i;return this.featuresCollection_?i=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(i=this.featuresRtree_.getAll(),Bl(this.nullGeometryFeatures_)||Cr(i,Object.values(this.nullGeometryFeatures_))),i}getFeaturesAtCoordinate(i){let e=[];return this.forEachFeatureAtCoordinateDirect(i,function(n){e.push(n)}),e}getFeaturesInExtent(i,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(i);let o=k9(i,e);return[].concat(...o.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(i,e){let n=i[0],o=i[1],s=null,l=[NaN,NaN],h=1/0,p=[-1/0,-1/0,1/0,1/0];return e=e||Tc,this.featuresRtree_.forEachInExtent(p,function(m){if(e(m)){let f=m.getGeometry(),g=h;if(h=f instanceof il?0:f.closestPointXY(n,o,l,h),h<g){s=m;let y=Math.sqrt(h);p[0]=n-y,p[1]=o-y,p[2]=n+y,p[3]=o+y}}}),s}getExtent(i){return this.featuresRtree_.getExtent(i)}getFeatureById(i){let e=this.idIndex_[i.toString()];return e!==void 0?e:null}getFeatureByUid(i){let e=this.uidIndex_[i];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(i){let e=i.target,n=fi(e),o=e.getGeometry();if(!o)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{let l=o.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(l,e)):this.featuresRtree_&&this.featuresRtree_.update(l,e)}let s=e.getId();if(s!==void 0){let l=s.toString();this.idIndex_[l]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[l]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Wm(au.CHANGEFEATURE,e))}hasFeature(i){let e=i.getId();return e!==void 0?e in this.idIndex_:fi(i)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Bl(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(i,e,n){let o=this.loadedExtentsRtree_,s=this.strategy_(i,e,n);for(let l=0,h=s.length;l<h;++l){let p=s[l];o.forEachInExtent(p,function(f){return Pa(f.extent,p)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Wm(au.FEATURESLOADSTART)),this.loader_.call(this,p,e,n,f=>{--this.loadingExtentsCount_,this.dispatchEvent(new Wm(au.FEATURESLOADEND,void 0,f))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Wm(au.FEATURESLOADERROR))}),o.insert(p,{extent:p.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(i){let e=this.loadedExtentsRtree_,n;e.forEachInExtent(i,function(o){if(Wd(o.extent,i))return n=o,!0}),n&&e.remove(n)}removeFeatures(i){let e=[];for(let n=0,o=i.length;n<o;++n){let s=i[n],l=this.removeFeatureInternal(s);l&&e.push(l)}e.length>0&&this.changed()}removeFeature(i){if(!i)return;this.removeFeatureInternal(i)&&this.changed()}removeFeatureInternal(i){let e=fi(i);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(i);let n=this.featureChangeKeys_[e];if(!n)return;n.forEach(wn),delete this.featureChangeKeys_[e];let o=i.getId();return o!==void 0&&delete this.idIndex_[o.toString()],delete this.uidIndex_[e],this.hasListener(au.REMOVEFEATURE)&&this.dispatchEvent(new Wm(au.REMOVEFEATURE,i)),i}removeFromIdIndex_(i){let e=!1;for(let n in this.idIndex_){let o=this.idIndex_[n];if(i instanceof il&&Array.isArray(o)&&o.includes(i))o.splice(o.indexOf(i),1);else if(this.idIndex_[n]===i){delete this.idIndex_[n],e=!0;break}}return e}setLoader(i){this.loader_=i}setUrl(i){Hi(this.format_,"`format` must be set when `url` is set"),this.url_=i,this.setLoader(wD(i,this.format_))}},$a=xD;function Ep(r){return({wms:lme,wmts:cme,xyz:ume,feature:dme,wfs:hme,arcgisrest:SD,imagearcgisrest:SD,tilearcgisrest:SD,osm:n=>"OSM",tiledebug:n=>"tiledebug"}[r.type]||CD)(r)}function lme(r){let i=r.params.LAYERS,n="wms"+pg(r.url)+i;return Ph.hashStr(n)}function cme(r){let i=r.layer,n="wmts"+pg(r.url)+i;return Ph.hashStr(n)}function ume(r){let e="xyz"+pg(r.url);return Ph.hashStr(e)}function dme(r){if(!r.url)return CD();let e="feature"+pg(r.url);return Ph.hashStr(e)}function hme(r){if(!r.url||!r.params)return CD();let e="wfs"+pg(r.url)+r.params.featureTypes;return Ph.hashStr(e)}function SD(r){let i=r.layer,e=pg(r.url),n=(r.type||"arcgis")+e+i;return Ph.hashStr(n)}function CD(){return rn()}function pg(r){let e=(r.charAt(0)==="/"?window.location.origin+r:r).split(/[?&]/),n=e.shift(),o=e.filter(s=>s.length!==0&&s.charAt(0)!=="_");return o.length&&(n+="?"+o.join("&")),n}var Wa=class{options;dataService;id;ol;legend;get saveableOptions(){return{id:this.options.id,type:this.options.type,url:this.options.url}}constructor(i={},e){this.options=i,this.dataService=e,this.options=i,this.id=this.options.id||this.generateId(),this.ol=this.createOlSource()}generateId(){return Ep(this.options)}getLegend(i,e){return this.legend?this.legend:[]}setLegend(i){return i.url?this.legend=[{url:i.url}]:i.html?this.legend=[{html:i.html}]:this.legend=[],this.legend}};var kr=class extends Wa{get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}createOlSource(){let i={format:this.getSourceFormatFromOptions(this.options)};return new $a(Object.assign(i,this.options))}getSourceFormatFromOptions(i){if(i.format)return i.format;let e,n=i.formatType;if(!n)e=Qr;else if(e=Hh[n],e===void 0)throw new Error("Invalid vector source format ${formatType}.");let o=i.formatOptions,s;return o?s=new e(o):s=new e,s}onUnwatch(){}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}};var e5=class{};var si={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function AD(r){return Math.pow(r,3)}function $l(r){return 1-AD(1-r)}function sH(r){return 3*r*r-2*r*r*r}function lH(r){return r}var MD=class extends km{constructor(i,e,n){super(),n=n||{},this.tileCoord=i,this.state=e,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(mi.CHANGE)}release(){this.state===si.ERROR&&this.setState(si.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let i=this.interimTile;if(!i)return this;do{if(i.getState()==si.LOADED)return this.transition_=0,i;i=i.interimTile}while(i);return this}refreshInterimChain(){let i=this.interimTile;if(!i)return;let e=this;do{if(i.getState()==si.LOADED){i.interimTile=null;break}i.getState()==si.LOADING?e=i:i.getState()==si.IDLE?e.interimTile=i.interimTile:e=i,i=e.interimTile}while(i)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(i){if(this.state!==si.ERROR&&this.state>i)throw new Error("Tile load sequence violation");this.state=i,this.changed()}load(){Ti()}getAlpha(i,e){if(!this.transition_)return 1;let n=this.transitionStarts_[i];if(!n)n=e,this.transitionStarts_[i]=n;else if(n===-1)return 1;let o=e-n+1e3/60;return o>=this.transition_?1:AD(o/this.transition_)}inTransition(i){return this.transition_?this.transitionStarts_[i]!==-1:!1}endTransition(i){this.transition_&&(this.transitionStarts_[i]=-1)}},H0=MD;var ID=class extends H0{constructor(i,e,n,o,s,l){super(i,e,l),this.crossOrigin_=o,this.src_=n,this.key=n,this.image_=new Image,o!==null&&(this.image_.crossOrigin=o),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(i){this.image_=i,this.state=si.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=si.ERROR,this.unlistenImage_(),this.image_=mme(),this.changed()}handleImageLoad_(){let i=this.image_;i.naturalWidth&&i.naturalHeight?this.state=si.LOADED:this.state=si.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==si.ERROR&&(this.state=si.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==si.IDLE&&(this.state=si.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Lz(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};function mme(){let r=yo(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}var t5=ID;var fme=10,cH=.25,ED=class{constructor(i,e,n,o,s,l){this.sourceProj_=i,this.targetProj_=e;let h={},p=zf(this.targetProj_,this.sourceProj_);this.transformInv_=function(q){let X=q[0]+"/"+q[1];return h[X]||(h[X]=p(q)),h[X]},this.maxSourceExtent_=o,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!o&&!!this.sourceProj_.getExtent()&&mr(o)>=mr(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?mr(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?mr(this.targetProj_.getExtent()):null;let m=Mc(n),f=oy(n),g=ny(n),y=ry(n),_=this.transformInv_(m),w=this.transformInv_(f),A=this.transformInv_(g),k=this.transformInv_(y),R=fme+(l?Math.max(0,Math.ceil(Math.log2(g0(n)/(l*l*256*256)))):0);if(this.addQuad_(m,f,g,y,_,w,A,k,R),this.wrapsXInSource_){let q=1/0;this.triangles_.forEach(function(X,ie,ae){q=Math.min(q,X.source[0][0],X.source[1][0],X.source[2][0])}),this.triangles_.forEach(X=>{if(Math.max(X.source[0][0],X.source[1][0],X.source[2][0])-q>this.sourceWorldWidth_/2){let ie=[[X.source[0][0],X.source[0][1]],[X.source[1][0],X.source[1][1]],[X.source[2][0],X.source[2][1]]];ie[0][0]-q>this.sourceWorldWidth_/2&&(ie[0][0]-=this.sourceWorldWidth_),ie[1][0]-q>this.sourceWorldWidth_/2&&(ie[1][0]-=this.sourceWorldWidth_),ie[2][0]-q>this.sourceWorldWidth_/2&&(ie[2][0]-=this.sourceWorldWidth_);let ae=Math.min(ie[0][0],ie[1][0],ie[2][0]);Math.max(ie[0][0],ie[1][0],ie[2][0])-ae<this.sourceWorldWidth_/2&&(X.source=ie)}})}h={}}addTriangle_(i,e,n,o,s,l){this.triangles_.push({source:[o,s,l],target:[i,e,n]})}addQuad_(i,e,n,o,s,l,h,p,m){let f=Ds([s,l,h,p]),g=this.sourceWorldWidth_?mr(f)/this.sourceWorldWidth_:null,y=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&g>.5&&g<1,w=!1;if(m>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let k=Ds([i,e,n,o]);w=mr(k)/this.targetWorldWidth_>cH||w}!_&&this.sourceProj_.isGlobal()&&g&&(w=g>cH||w)}if(!w&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!On(f,this.maxSourceExtent_))return;let A=0;if(!w&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(h[0])||!isFinite(h[1])||!isFinite(p[0])||!isFinite(p[1]))){if(m>0)w=!0;else if(A=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(l[0])||!isFinite(l[1])?4:0)+(!isFinite(h[0])||!isFinite(h[1])?2:0)+(!isFinite(p[0])||!isFinite(p[1])?1:0),A!=1&&A!=2&&A!=4&&A!=8)return}if(m>0){if(!w){let k=[(i[0]+n[0])/2,(i[1]+n[1])/2],R=this.transformInv_(k),q;_?q=(ad(s[0],y)+ad(h[0],y))/2-ad(R[0],y):q=(s[0]+h[0])/2-R[0];let X=(s[1]+h[1])/2-R[1];w=q*q+X*X>this.errorThresholdSquared_}if(w){if(Math.abs(i[0]-n[0])<=Math.abs(i[1]-n[1])){let k=[(e[0]+n[0])/2,(e[1]+n[1])/2],R=this.transformInv_(k),q=[(o[0]+i[0])/2,(o[1]+i[1])/2],X=this.transformInv_(q);this.addQuad_(i,e,k,q,s,l,R,X,m-1),this.addQuad_(q,k,n,o,X,R,h,p,m-1)}else{let k=[(i[0]+e[0])/2,(i[1]+e[1])/2],R=this.transformInv_(k),q=[(n[0]+o[0])/2,(n[1]+o[1])/2],X=this.transformInv_(q);this.addQuad_(i,k,q,o,s,R,X,p,m-1),this.addQuad_(k,e,n,q,R,l,h,X,m-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}A&11||this.addTriangle_(i,n,o,s,h,p),A&14||this.addTriangle_(i,n,e,s,h,l),A&&(A&13||this.addTriangle_(e,o,i,l,p,s),A&7||this.addTriangle_(e,o,n,l,p,h))}calculateSourceExtent(){let i=Wn();return this.triangles_.forEach(function(e,n,o){let s=e.source;iy(i,s[0]),iy(i,s[1]),iy(i,s[2])}),i}getTriangles(){return this.triangles_}},i5=ED;var TD,Ly=[];function uH(r,i,e,n,o){r.beginPath(),r.moveTo(0,0),r.lineTo(i,e),r.lineTo(n,o),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(i,n)+1,Math.max(e,o)),r.restore()}function FD(r,i){return Math.abs(r[i*4]-210)>2||Math.abs(r[i*4+3]-.75*255)>2}function gme(){if(TD===void 0){let r=yo(6,6,Ly);r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",uH(r,4,5,4,0),uH(r,4,5,0,5);let i=r.getImageData(0,0,3,3).data;TD=FD(i,0)||FD(i,4)||FD(i,8),tg(r),Ly.push(r.canvas)}return TD}function Zv(r,i,e,n){let o=Sr(e,i,r),s=ly(i,n,e),l=i.getMetersPerUnit();l!==void 0&&(s*=l);let h=r.getMetersPerUnit();h!==void 0&&(s/=h);let p=r.getExtent();if(!p||$d(p,o)){let m=ly(r,s,o)/s;isFinite(m)&&m>0&&(s/=m)}return s}function dH(r,i,e,n){let o=as(e),s=Zv(r,i,o,n);return(!isFinite(s)||s<=0)&&H1(e,function(l){return s=Zv(r,i,l,n),isFinite(s)&&s>0}),s}function r5(r,i,e,n,o,s,l,h,p,m,f,g,y,_){let w=yo(Math.round(e*r),Math.round(e*i),Ly);if(g||(w.imageSmoothingEnabled=!1),p.length===0)return w.canvas;w.scale(e,e);function A(ae){return Math.round(ae*e)/e}w.globalCompositeOperation="lighter";let k=Wn();p.forEach(function(ae,be,me){Hd(k,ae.extent)});let R,q=e/n,X=(g?1:1+Math.pow(2,-24))/q;if(!y||p.length!==1||m!==0){if(R=yo(Math.round(mr(k)*q),Math.round(Hn(k)*q),Ly),g||(R.imageSmoothingEnabled=!1),o&&_){let ae=(o[0]-k[0])*q,be=-(o[3]-k[3])*q,me=mr(o)*q,fe=Hn(o)*q;R.rect(ae,be,me,fe),R.clip()}p.forEach(function(ae,be,me){let fe=(ae.extent[0]-k[0])*q,ge=-(ae.extent[3]-k[3])*q,ue=mr(ae.extent)*q,se=Hn(ae.extent)*q;ae.image.width>0&&ae.image.height>0&&R.drawImage(ae.image,m,m,ae.image.width-2*m,ae.image.height-2*m,g?fe:Math.round(fe),g?ge:Math.round(ge),g?ue:Math.round(fe+ue)-Math.round(fe),g?se:Math.round(ge+se)-Math.round(ge))})}let ie=Mc(l);return h.getTriangles().forEach(function(ae,be,me){let fe=ae.source,ge=ae.target,ue=fe[0][0],se=fe[0][1],te=fe[1][0],Se=fe[1][1],Te=fe[2][0],Ee=fe[2][1],je=A((ge[0][0]-ie[0])/s),Ne=A(-(ge[0][1]-ie[1])/s),ze=A((ge[1][0]-ie[0])/s),Re=A(-(ge[1][1]-ie[1])/s),Ge=A((ge[2][0]-ie[0])/s),He=A(-(ge[2][1]-ie[1])/s),ye=ue,Ae=se;ue=0,se=0,te-=ye,Se-=Ae,Te-=ye,Ee-=Ae;let Le=[[te,Se,0,0,ze-je],[Te,Ee,0,0,Ge-je],[0,0,te,Se,Re-Ne],[0,0,Te,Ee,He-Ne]],Ye=D9(Le);if(!Ye)return;if(w.save(),w.beginPath(),gme()||!g){w.moveTo(ze,Re);let et=4,ft=je-ze,mt=Ne-Re;for(let At=0;At<et;At++)w.lineTo(ze+A((At+1)*ft/et),Re+A(At*mt/(et-1))),At!=et-1&&w.lineTo(ze+A((At+1)*ft/et),Re+A((At+1)*mt/(et-1)));w.lineTo(Ge,He)}else w.moveTo(ze,Re),w.lineTo(je,Ne),w.lineTo(Ge,He);w.clip(),w.transform(Ye[0],Ye[2],Ye[1],Ye[3],je,Ne),w.translate(k[0]-ye,k[3]-Ae);let qe;if(R)qe=R.canvas,w.scale(X,-X);else{let et=p[0],ft=et.extent;qe=et.image,w.scale(mr(ft)/qe.width,-Hn(ft)/qe.height)}w.drawImage(qe,0,0),w.restore()}),R&&(tg(R),Ly.push(R.canvas)),f&&(w.save(),w.globalCompositeOperation="source-over",w.strokeStyle="black",w.lineWidth=1,h.getTriangles().forEach(function(ae,be,me){let fe=ae.target,ge=(fe[0][0]-ie[0])/s,ue=-(fe[0][1]-ie[1])/s,se=(fe[1][0]-ie[0])/s,te=-(fe[1][1]-ie[1])/s,Se=(fe[2][0]-ie[0])/s,Te=-(fe[2][1]-ie[1])/s;w.beginPath(),w.moveTo(se,te),w.lineTo(ge,ue),w.lineTo(Se,Te),w.closePath(),w.stroke()}),w.restore()),w.canvas}var PD=class extends H0{constructor(i,e,n,o,s,l,h,p,m,f,g,y){super(s,si.IDLE,y),this.renderEdges_=g!==void 0?g:!1,this.pixelRatio_=h,this.gutter_=p,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=o,this.wrappedTileCoord_=l||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let _=o.getTileCoordExtent(this.wrappedTileCoord_),w=this.targetTileGrid_.getExtent(),A=this.sourceTileGrid_.getExtent(),k=w?Xc(_,w):_;if(g0(k)===0){this.state=si.EMPTY;return}let R=i.getExtent();R&&(A?A=Xc(A,R):A=R);let q=o.getResolution(this.wrappedTileCoord_[0]),X=dH(i,n,k,q);if(!isFinite(X)||X<=0){this.state=si.EMPTY;return}let ie=f!==void 0?f:.5;if(this.triangulation_=new i5(i,n,k,A,X*ie,q),this.triangulation_.getTriangles().length===0){this.state=si.EMPTY;return}this.sourceZ_=e.getZForResolution(X);let ae=this.triangulation_.calculateSourceExtent();if(A&&(i.canWrapX()?(ae[1]=to(ae[1],A[1],A[3]),ae[3]=to(ae[3],A[1],A[3])):ae=Xc(ae,A)),!g0(ae))this.state=si.EMPTY;else{let be=e.getTileRangeForExtentAndZ(ae,this.sourceZ_);for(let me=be.minX;me<=be.maxX;me++)for(let fe=be.minY;fe<=be.maxY;fe++){let ge=m(this.sourceZ_,me,fe,h);ge&&this.sourceTiles_.push(ge)}this.sourceTiles_.length===0&&(this.state=si.EMPTY)}}getImage(){return this.canvas_}reproject_(){let i=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==si.LOADED&&i.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,i.length===0)this.state=si.ERROR;else{let e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),o=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],l=this.targetTileGrid_.getResolution(e),h=this.sourceTileGrid_.getResolution(this.sourceZ_),p=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=r5(o,s,this.pixelRatio_,h,this.sourceTileGrid_.getExtent(),l,p,this.triangulation_,i,this.gutter_,this.renderEdges_,this.interpolate),this.state=si.LOADED}this.changed()}load(){if(this.state==si.IDLE){this.state=si.LOADING,this.changed();let i=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{let n=e.getState();if(n==si.IDLE||n==si.LOADING){i++;let o=Vr(e,mi.CHANGE,function(s){let l=e.getState();(l==si.LOADED||l==si.ERROR||l==si.EMPTY)&&(wn(o),i--,i===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}),i===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,o){e.getState()==si.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(wn),this.sourcesListenerKeys_=null}release(){this.canvas_&&(tg(this.canvas_.getContext("2d")),Ly.push(this.canvas_),this.canvas_=null),super.release()}},NS=PD;var LD=class{constructor(i){this.highWaterMark=i!==void 0?i:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(i){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(i){return this.entries_.hasOwnProperty(i)}forEach(i){let e=this.oldest_;for(;e;)i(e.value_,e.key_,this),e=e.newer}get(i,e){let n=this.entries_[i];return Hi(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(i){let e=this.entries_[i];return Hi(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[i],--this.count_,e.value_}getCount(){return this.count_}getKeys(){let i=new Array(this.count_),e=0,n;for(n=this.newest_;n;n=n.older)i[e++]=n.key_;return i}getValues(){let i=new Array(this.count_),e=0,n;for(n=this.newest_;n;n=n.older)i[e++]=n.value_;return i}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(i){return this.entries_[i]?.value_}pop(){let i=this.oldest_;return delete this.entries_[i.key_],i.newer&&(i.newer.older=null),this.oldest_=i.newer,this.oldest_||(this.newest_=null),--this.count_,i.value_}replace(i,e){this.get(i),this.entries_[i].value_=e}set(i,e){Hi(!(i in this.entries_),"Tried to set a value for a key that is used already");let n={key_:i,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[i]=n,++this.count_}setSize(i){this.highWaterMark=i}},hH=LD;function kD(r,i,e,n){return n!==void 0?(n[0]=r,n[1]=i,n[2]=e,n):[r,i,e]}function Hm(r,i,e){return r+"/"+i+"/"+e}function n5(r){return Hm(r[0],r[1],r[2])}function pH(r){let[i,e,n]=r.substring(r.lastIndexOf("/")+1,r.length).split(",").map(Number);return Hm(i,e,n)}function o5(r){return r.split("/").map(Number)}function a5(r){return(r[1]<<r[0])+r[2]}function mH(r,i){let e=r[0],n=r[1],o=r[2];if(i.getMinZoom()>e||e>i.getMaxZoom())return!1;let s=i.getFullTileRange(e);return s?s.containsXY(n,o):!0}var OD=class extends hH{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(i){for(;this.canExpireCache()&&!(this.peekLast().getKey()in i);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;let i=this.peekFirstKey(),n=o5(i)[0];this.forEach(o=>{o.tileCoord[0]!==n&&(this.remove(n5(o.tileCoord)),o.release())})}},Xv=OD;var s5={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var l5=class{constructor(i,e,n,o){this.minX=i,this.maxX=e,this.minY=n,this.maxY=o}contains(i){return this.containsXY(i[1],i[2])}containsTileRange(i){return this.minX<=i.minX&&i.maxX<=this.maxX&&this.minY<=i.minY&&i.maxY<=this.maxY}containsXY(i,e){return this.minX<=i&&i<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(i){return this.minX==i.minX&&this.minY==i.minY&&this.maxX==i.maxX&&this.maxY==i.maxY}extend(i){i.minX<this.minX&&(this.minX=i.minX),i.maxX>this.maxX&&(this.maxX=i.maxX),i.minY<this.minY&&(this.minY=i.minY),i.maxY>this.maxY&&(this.maxY=i.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(i){return this.minX<=i.maxX&&this.maxX>=i.minX&&this.minY<=i.maxY&&this.maxY>=i.minY}};function ky(r,i,e,n,o){return o!==void 0?(o.minX=r,o.maxX=i,o.minY=e,o.maxY=n,o):new l5(r,i,e,n)}var c5=l5;var Kv=[0,0,0],q0=5,DD=class{constructor(i){this.minZoom=i.minZoom!==void 0?i.minZoom:0,this.resolutions_=i.resolutions,Hi(JU(this.resolutions_,(o,s)=>s-o,!0),"`resolutions` must be sorted in descending order");let e;if(!i.origins){for(let o=0,s=this.resolutions_.length-1;o<s;++o)if(!e)e=this.resolutions_[o]/this.resolutions_[o+1];else if(this.resolutions_[o]/this.resolutions_[o+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=i.origin!==void 0?i.origin:null,this.origins_=null,i.origins!==void 0&&(this.origins_=i.origins,Hi(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let n=i.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Mc(n)),Hi(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,i.tileSizes!==void 0&&(this.tileSizes_=i.tileSizes,Hi(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=i.tileSize!==void 0?i.tileSize:this.tileSizes_?null:256,Hi(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],i.sizes!==void 0?this.fullTileRanges_=i.sizes.map((o,s)=>{let l=new c5(Math.min(0,o[0]),Math.max(o[0]-1,-1),Math.min(0,o[1]),Math.max(o[1]-1,-1));if(n){let h=this.getTileRangeForExtentAndZ(n,s);l.minX=Math.max(h.minX,l.minX),l.maxX=Math.min(h.maxX,l.maxX),l.minY=Math.max(h.minY,l.minY),l.maxY=Math.min(h.maxY,l.maxY)}return l}):n&&this.calculateTileRanges_(n)}forEachTileCoord(i,e,n){let o=this.getTileRangeForExtentAndZ(i,e);for(let s=o.minX,l=o.maxX;s<=l;++s)for(let h=o.minY,p=o.maxY;h<=p;++h)n([e,s,h])}forEachTileCoordParentTileRange(i,e,n,o){let s,l,h,p=null,m=i[0]-1;for(this.zoomFactor_===2?(l=i[1],h=i[2]):p=this.getTileCoordExtent(i,o);m>=this.minZoom;){if(l!==void 0&&h!==void 0?(l=Math.floor(l/2),h=Math.floor(h/2),s=ky(l,l,h,h,n)):s=this.getTileRangeForExtentAndZ(p,m,n),e(m,s))return!0;--m}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(i){return this.origin_?this.origin_:this.origins_[i]}getResolution(i){return this.resolutions_[i]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(i,e,n){if(i[0]<this.maxZoom){if(this.zoomFactor_===2){let s=i[1]*2,l=i[2]*2;return ky(s,s+1,l,l+1,e)}let o=this.getTileCoordExtent(i,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,i[0]+1,e)}return null}getTileRangeForTileCoordAndZ(i,e,n){if(e>this.maxZoom||e<this.minZoom)return null;let o=i[0],s=i[1],l=i[2];if(e===o)return ky(s,l,s,l,n);if(this.zoomFactor_){let p=Math.pow(this.zoomFactor_,e-o),m=Math.floor(s*p),f=Math.floor(l*p);if(e<o)return ky(m,m,f,f,n);let g=Math.floor(p*(s+1))-1,y=Math.floor(p*(l+1))-1;return ky(m,g,f,y,n)}let h=this.getTileCoordExtent(i,this.tmpExtent_);return this.getTileRangeForExtentAndZ(h,e,n)}getTileRangeForExtentAndZ(i,e,n){this.getTileCoordForXYAndZ_(i[0],i[3],e,!1,Kv);let o=Kv[1],s=Kv[2];this.getTileCoordForXYAndZ_(i[2],i[1],e,!0,Kv);let l=Kv[1],h=Kv[2];return ky(o,l,s,h,n)}getTileCoordCenter(i){let e=this.getOrigin(i[0]),n=this.getResolution(i[0]),o=Wo(this.getTileSize(i[0]),this.tmpSize_);return[e[0]+(i[1]+.5)*o[0]*n,e[1]-(i[2]+.5)*o[1]*n]}getTileCoordExtent(i,e){let n=this.getOrigin(i[0]),o=this.getResolution(i[0]),s=Wo(this.getTileSize(i[0]),this.tmpSize_),l=n[0]+i[1]*s[0]*o,h=n[1]-(i[2]+1)*s[1]*o,p=l+s[0]*o,m=h+s[1]*o;return jl(l,h,p,m,e)}getTileCoordForCoordAndResolution(i,e,n){return this.getTileCoordForXYAndResolution_(i[0],i[1],e,!1,n)}getTileCoordForXYAndResolution_(i,e,n,o,s){let l=this.getZForResolution(n),h=n/this.getResolution(l),p=this.getOrigin(l),m=Wo(this.getTileSize(l),this.tmpSize_),f=h*(i-p[0])/n/m[0],g=h*(p[1]-e)/n/m[1];return o?(f=Cm(f,q0)-1,g=Cm(g,q0)-1):(f=_0(f,q0),g=_0(g,q0)),kD(l,f,g,s)}getTileCoordForXYAndZ_(i,e,n,o,s){let l=this.getOrigin(n),h=this.getResolution(n),p=Wo(this.getTileSize(n),this.tmpSize_),m=(i-l[0])/h/p[0],f=(l[1]-e)/h/p[1];return o?(m=Cm(m,q0)-1,f=Cm(f,q0)-1):(m=_0(m,q0),f=_0(f,q0)),kD(n,m,f,s)}getTileCoordForCoordAndZ(i,e,n){return this.getTileCoordForXYAndZ_(i[0],i[1],e,!1,n)}getTileCoordResolution(i){return this.resolutions_[i[0]]}getTileSize(i){return this.tileSize_?this.tileSize_:this.tileSizes_[i]}getFullTileRange(i){return this.fullTileRanges_?this.fullTileRanges_[i]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,i):null}getZForResolution(i,e){let n=O0(this.resolutions_,i,e||0);return to(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(i,e){return ck(e,0,e.length,2,this.getTileCoordExtent(i))}calculateTileRanges_(i){let e=this.resolutions_.length,n=new Array(e);for(let o=this.minZoom;o<e;++o)n[o]=this.getTileRangeForExtentAndZ(i,o);this.fullTileRanges_=n}},mg=DD;var u5=class extends mg{constructor(i){super({extent:i.extent,origin:i.origin,origins:i.origins,resolutions:i.resolutions,tileSize:i.tileSize,tileSizes:i.tileSizes,sizes:i.sizes}),this.matrixIds_=i.matrixIds}getMatrixId(i){return this.matrixIds_[i]}getMatrixIds(){return this.matrixIds_}},gH=u5;function _H(r,i,e){let n=[],o=[],s=[],l=[],h=[];e=e!==void 0?e:[];let p="SupportedCRS",m="TileMatrix",f="Identifier",g="ScaleDenominator",y="TopLeftCorner",_="TileWidth",w="TileHeight",A=r[p],k=ni(A),R=k.getMetersPerUnit(),q=k.getAxisOrientation().substr(0,2)=="ne";return r[m].sort(function(X,ie){return ie[g]-X[g]}),r[m].forEach(function(X){let ie;if(e.length>0?ie=e.find(function(ae){return X[f]==ae[m]?!0:X[f].includes(":")?!1:r[f]+":"+X[f]===ae[m]}):ie=!0,ie){o.push(X[f]);let ae=X[g]*28e-5/R,be=X[_],me=X[w];q?s.push([X[y][1],X[y][0]]):s.push(X[y]),n.push(ae),l.push(be==me?be:[be,me]),h.push([X.MatrixWidth,X.MatrixHeight])}}),new u5({extent:i,origins:s,resolutions:n,matrixIds:o,tileSizes:l,sizes:h})}function d5(r){let i=r.getDefaultTileGrid();return i||(i=bme(r),r.setDefaultTileGrid(i)),i}function yH(r,i,e){let n=i[0],o=r.getTileCoordCenter(i),s=Qv(e);if(!$d(s,o)){let l=mr(s),h=Math.ceil((s[0]-o[0])/l);return o[0]+=l*h,r.getTileCoordForCoordAndZ(o,n)}return i}function vme(r,i,e,n){n=n!==void 0?n:"top-left";let o=vH(r,i,e);return new mg({extent:r,origin:E9(r,n),resolutions:o,tileSize:e})}function h5(r){let i=r||{},e=i.extent||ni("EPSG:3857").getExtent(),n={extent:e,minZoom:i.minZoom,tileSize:i.tileSize,resolutions:vH(e,i.maxZoom,i.tileSize,i.maxResolution)};return new mg(n)}function vH(r,i,e,n){i=i!==void 0?i:42,e=Wo(e!==void 0?e:256);let o=Hn(r),s=mr(r);n=n>0?n:Math.max(s/e[0],o/e[1]);let l=i+1,h=new Array(l);for(let p=0;p<l;++p)h[p]=n/Math.pow(2,p);return h}function bme(r,i,e,n){let o=Qv(r);return vme(o,i,e,n)}function Qv(r){r=ni(r);let i=r.getExtent();if(!i){let e=180*Cu.degrees/r.getMetersPerUnit();i=jl(-e,-e,e,e)}return i}var RD=class extends Yv{constructor(i){super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,projection:i.projection,state:i.state,wrapX:i.wrapX,interpolate:i.interpolate}),this.on,this.once,this.un,this.opaque_=i.opaque!==void 0?i.opaque:!1,this.tilePixelRatio_=i.tilePixelRatio!==void 0?i.tilePixelRatio:1,this.tileGrid=i.tileGrid!==void 0?i.tileGrid:null;let e=[256,256];this.tileGrid&&Wo(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Xv(i.cacheSize||0),this.tmpSize=[0,0],this.key_=i.key||"",this.tileOptions={transition:i.transition,interpolate:i.interpolate},this.zDirection=i.zDirection?i.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(i,e){let n=this.getTileCacheForProjection(i);n&&n.expireCache(e)}forEachLoadedTile(i,e,n,o){let s=this.getTileCacheForProjection(i);if(!s)return!1;let l=!0,h,p,m;for(let f=n.minX;f<=n.maxX;++f)for(let g=n.minY;g<=n.maxY;++g)p=Hm(e,f,g),m=!1,s.containsKey(p)&&(h=s.get(p),m=h.getState()===si.LOADED,m&&(m=o(h)!==!1)),m||(l=!1);return l}getGutterForProjection(i){return 0}getKey(){return this.key_}setKey(i){this.key_!==i&&(this.key_=i,this.changed())}getOpaque(i){return this.opaque_}getResolutions(i){let e=i?this.getTileGridForProjection(i):this.tileGrid;return e?e.getResolutions():null}getTile(i,e,n,o,s){return Ti()}getTileGrid(){return this.tileGrid}getTileGridForProjection(i){return this.tileGrid?this.tileGrid:d5(i)}getTileCacheForProjection(i){let e=this.getProjection();return Hi(e===null||cc(e,i),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(i){return this.tilePixelRatio_}getTilePixelSize(i,e,n){let o=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),l=Wo(o.getTileSize(i),this.tmpSize);return s==1?l:_I(l,s,this.tmpSize)}getTileCoordForTileUrlFunction(i,e){e=e!==void 0?e:this.getProjection();let n=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(i=yH(n,i,e)),mH(i,n)?i:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(i,e){let n=this.getTileCacheForProjection(e);i>n.highWaterMark&&(n.highWaterMark=i)}useTile(i,e,n,o){}},p5=class extends To{constructor(i,e){super(i),this.tile=e}},bH=RD;function wme(r,i){let e=/\{z\}/g,n=/\{x\}/g,o=/\{y\}/g,s=/\{-y\}/g;return function(l,h,p){if(l)return r.replace(e,l[0].toString()).replace(n,l[1].toString()).replace(o,l[2].toString()).replace(s,function(){let m=l[0],f=i.getFullTileRange(m);if(!f)throw new Error("The {-y} placeholder requires a tile grid with extent");return(f.getHeight()-l[2]-1).toString()})}}function wH(r,i){let e=r.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=wme(r[o],i);return m5(n)}function m5(r){return r.length===1?r[0]:function(i,e,n){if(!i)return;let o=a5(i),s=ad(o,r.length);return r[s](i,e,n)}}function f5(r){let i=[],e=/\{([a-z])-([a-z])\}/.exec(r);if(e){let n=e[1].charCodeAt(0),o=e[2].charCodeAt(0),s;for(s=n;s<=o;++s)i.push(r.replace(e[0],String.fromCharCode(s)));return i}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){let n=parseInt(e[2],10);for(let o=parseInt(e[1],10);o<=n;o++)i.push(r.replace(e[0],o.toString()));return i}return i.push(r),i}var ND=class r extends bH{constructor(i){super({attributions:i.attributions,cacheSize:i.cacheSize,opaque:i.opaque,projection:i.projection,state:i.state,tileGrid:i.tileGrid,tilePixelRatio:i.tilePixelRatio,wrapX:i.wrapX,transition:i.transition,interpolate:i.interpolate,key:i.key,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===r.prototype.tileUrlFunction,this.tileLoadFunction=i.tileLoadFunction,i.tileUrlFunction&&(this.tileUrlFunction=i.tileUrlFunction),this.urls=null,i.urls?this.setUrls(i.urls):i.url&&this.setUrl(i.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(i){let e=i.target,n=fi(e),o=e.getState(),s;o==si.LOADING?(this.tileLoadingKeys_[n]=!0,s=s5.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=o==si.ERROR?s5.TILELOADERROR:o==si.LOADED?s5.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new p5(s,e))}setTileLoadFunction(i){this.tileCache.clear(),this.tileLoadFunction=i,this.changed()}setTileUrlFunction(i,e){this.tileUrlFunction=i,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(i){let e=f5(i);this.urls=e,this.setUrls(e)}setUrls(i){this.urls=i;let e=i.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(wH(i,this.tileGrid),e):this.setKey(e)}tileUrlFunction(i,e,n){}useTile(i,e,n){let o=Hm(i,e,n);this.tileCache.containsKey(o)&&this.tileCache.get(o)}},g5=ND;var BD=class extends g5{constructor(i){super({attributions:i.attributions,cacheSize:i.cacheSize,opaque:i.opaque,projection:i.projection,state:i.state,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction?i.tileLoadFunction:xme,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:i.wrapX,transition:i.transition,interpolate:i.interpolate!==void 0?i.interpolate:!0,key:i.key,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection}),this.crossOrigin=i.crossOrigin!==void 0?i.crossOrigin:null,this.tileClass=i.tileClass!==void 0?i.tileClass:t5,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=i.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(let i in this.tileCacheForProjection)if(this.tileCacheForProjection[i].canExpireCache())return!0;return!1}expireCache(i,e){let n=this.getTileCacheForProjection(i);this.tileCache.expireCache(this.tileCache==n?e:{});for(let o in this.tileCacheForProjection){let s=this.tileCacheForProjection[o];s.expireCache(s==n?e:{})}}getGutterForProjection(i){return this.getProjection()&&i&&!cc(this.getProjection(),i)?0:this.getGutter()}getGutter(){return 0}getKey(){let i=super.getKey();return this.getInterpolate()||(i+=":disable-interpolation"),i}getOpaque(i){return this.getProjection()&&i&&!cc(this.getProjection(),i)?!1:super.getOpaque(i)}getTileGridForProjection(i){let e=this.getProjection();if(this.tileGrid&&(!e||cc(e,i)))return this.tileGrid;let n=fi(i);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=d5(i)),this.tileGridForProjection[n]}getTileCacheForProjection(i){let e=this.getProjection();if(!e||cc(e,i))return this.tileCache;let n=fi(i);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Xv(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}createTile_(i,e,n,o,s,l){let h=[i,e,n],p=this.getTileCoordForTileUrlFunction(h,s),m=p?this.tileUrlFunction(p,o,s):void 0,f=new this.tileClass(h,m!==void 0?si.IDLE:si.EMPTY,m!==void 0?m:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=l,f.addEventListener(mi.CHANGE,this.handleTileChange.bind(this)),f}getTile(i,e,n,o,s){let l=this.getProjection();if(!l||!s||cc(l,s))return this.getTileInternal(i,e,n,o,l||s);let h=this.getTileCacheForProjection(s),p=[i,e,n],m,f=n5(p);h.containsKey(f)&&(m=h.get(f));let g=this.getKey();if(m&&m.key==g)return m;let y=this.getTileGridForProjection(l),_=this.getTileGridForProjection(s),w=this.getTileCoordForTileUrlFunction(p,s),A=new NS(l,y,s,_,p,w,this.getTilePixelRatio(o),this.getGutter(),(k,R,q,X)=>this.getTileInternal(k,R,q,X,l),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return A.key=g,m?(A.interimTile=m,A.refreshInterimChain(),h.replace(f,A)):h.set(f,A),A}getTileInternal(i,e,n,o,s){let l=null,h=Hm(i,e,n),p=this.getKey();if(!this.tileCache.containsKey(h))l=this.createTile_(i,e,n,o,s,p),this.tileCache.set(h,l);else if(l=this.tileCache.get(h),l.key!=p){let m=l;l=this.createTile_(i,e,n,o,s,p),m.getState()==si.IDLE?l.interimTile=m.interimTile:l.interimTile=m,l.refreshInterimChain(),this.tileCache.replace(h,l)}return l}setRenderReprojectionEdges(i){if(this.renderReprojectionEdges_!=i){this.renderReprojectionEdges_=i;for(let e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(i,e){let n=ni(i);if(n){let o=fi(n);o in this.tileGridForProjection||(this.tileGridForProjection[o]=e)}}clear(){super.clear();for(let i in this.tileCacheForProjection)this.tileCacheForProjection[i].clear()}};function xme(r,i){r.getImage().src=i}var Jv=BD;var GD=class extends Jv{constructor(i){i=i||{};let e=i.projection!==void 0?i.projection:"EPSG:3857",n=i.tileGrid!==void 0?i.tileGrid:h5({extent:Qv(e),maxResolution:i.maxResolution,maxZoom:i.maxZoom,minZoom:i.minZoom,tileSize:i.tileSize});super({attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:i.interpolate,opaque:i.opaque,projection:e,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:i.wrapX!==void 0?i.wrapX:!0,transition:i.transition,attributionsCollapsible:i.attributionsCollapsible,zDirection:i.zDirection}),this.gutter_=i.gutter!==void 0?i.gutter:0}getGutter(){return this.gutter_}},Y0=GD;var Sme='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',jD=class extends Y0{constructor(i){i=i||{};let e;i.attributions!==void 0?e=i.attributions:e=[Sme];let n=i.crossOrigin!==void 0?i.crossOrigin:"anonymous",o=i.url!==void 0?i.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:i.cacheSize,crossOrigin:n,interpolate:i.interpolate,maxZoom:i.maxZoom!==void 0?i.maxZoom:19,opaque:i.opaque!==void 0?i.opaque:!0,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,transition:i.transition,url:o,wrapX:i.wrapX,zDirection:i.zDirection})}},xH=jD;var eb=class extends Wa{createOlSource(){return this.options.url||(this.options.url="https://tile.openstreetmap.org/{z}/{x}/{y}.png"),new xH(this.options)}onUnwatch(){}};var tb=class extends Wa{createOlSource(){return new Y0(this.options)}onUnwatch(){}};var Z0=Jl(D1());var Jd=function(r){return r.BasicNumericOperator="basicnumericoperator",r.Basic="basic",r.BasicAndSpatial="basicandspatial",r.Spatial="spatial",r.All="all",r.Time="time",r}(Jd||{}),_i=function(r){return r.BBOX="BBox",r.PropertyIsBetween="PropertyIsBetween",r.Contains="Contains",r.During="During",r.PropertyIsEqualTo="PropertyIsEqualTo",r.PropertyIsGreaterThan="PropertyIsGreaterThan",r.PropertyIsGreaterThanOrEqualTo="PropertyIsGreaterThanOrEqualTo",r.Intersects="Intersects",r.PropertyIsNull="PropertyIsNull",r.PropertyIsLessThan="PropertyIsLessThan",r.PropertyIsLessThanOrEqualTo="PropertyIsLessThanOrEqualTo",r.PropertyIsLike="PropertyIsLike",r.PropertyIsNotEqualTo="PropertyIsNotEqualTo",r.Within="Within",r.And="And",r.Or="Or",r.Not="Not",r}(_i||{});var us=class{filterSequence=[];operators={[_i.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsLike]:{spatial:!1,fieldRestrict:["string"]},[_i.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsBetween]:{spatial:!1,fieldRestrict:["number"]},[_i.During]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNull]:{spatial:!1,fieldRestrict:[]},[_i.Intersects]:{spatial:!0,fieldRestrict:[]},[_i.Within]:{spatial:!0,fieldRestrict:[]},[_i.Contains]:{spatial:!0,fieldRestrict:[]}};defineOgcFiltersDefaultOptions(i,e,n){let o=!0;return n&&n==="wms"&&(o=!1),i=i||{},i.enabled=i.enabled===void 0?o:i.enabled,i.editable=i.editable===void 0?o:i.editable,i.geometryName=e,i.advancedOgcFilters=!0,i.enabled&&(i.pushButtons||i.checkboxes||i.radioButtons||i.select||i.autocomplete)&&(i.advancedOgcFilters=!1),i}buildFilter(i,e,n,o,s){let l,h;/intersects|contains|within/gi.test(JSON.stringify(i))?h=!1:h=!0,i&&(o=i.geometryName!==void 0?i.geometryName:o),e&&i&&(l=OS(o,e,n.getCode()));let p;if(i)i=this.checkIgoFiltersProperties(i,o,n),e&&h?p=kS(l,this.bundleFilter(i,s)):p=this.bundleFilter(i,s);else return e&&n?"bbox="+e.join(",")+","+n.getCode():void 0;let m={srsName:"",featureNS:"",featurePrefix:"",featureTypes:["featureTypes"],filter:p,outputFormat:"",geometryName:o},f=new Wh().writeGetFeature(m),g=new XMLSerializer().serializeToString(f),y=/typenames *=|typename *=\"featureTypes\" *>/gi,_=/<\/Query><\/GetFeature>/gi;return"filter="+g.split(y)[1].split(_)[0]}bundleFilter(i,e){if(i instanceof Array){let n=[];return i.forEach(o=>{n.push(this.bundleFilter(o,e))}),n}else{if(i.hasOwnProperty("logical"))return this.createFilter({operator:i.logical,logicalArray:this.bundleFilter(i.filters,e)},e);if(i.hasOwnProperty("operator"))return this.createFilter(i,e)}}createFilter(i,e){let n=i.operator,o=i.logicalArray,s=i.propertyName,l=i.pattern,h=i.matchCase?i.matchCase:!0,p=i.wildCard?i.wildCard:"*",m=i.singleChar?i.singleChar:".",f=i.escapeChar?i.escapeChar:"!",g=i.lowerBoundary,y=i.upperBoundary,_=i.geometryName,w=i.extent,A=i.wkt_geometry,k=i.srsName?i.srsName:"EPSG:3857",R=this.parseFilterOptionDate(i.begin,e?e.minDate:void 0),q=this.parseFilterOptionDate(i.end,e?e.maxDate:void 0),X=i.expression,ie;switch(A&&(ie=new _d().readGeometry(A,{dataProjection:k,featureProjection:k||"EPSG:3857"})),n.toLowerCase()){case _i.BBOX.toLowerCase():return OS(_,w,k);case _i.PropertyIsBetween.toLowerCase():return gW(s,g||1e40*-1,y||1e40);case _i.Contains.toLowerCase():return aW(_,ie,k);case _i.During.toLowerCase():return yW(s,R,q);case _i.PropertyIsEqualTo.toLowerCase():return cW(s,X,h);case _i.PropertyIsGreaterThan.toLowerCase():return pW(s,X);case _i.PropertyIsGreaterThanOrEqualTo.toLowerCase():return mW(s,X);case _i.Intersects.toLowerCase():return sW(_,ie,k);case _i.PropertyIsNull.toLowerCase():return fW(s);case _i.PropertyIsLessThan.toLowerCase():return dW(s,X);case _i.PropertyIsLessThanOrEqualTo.toLowerCase():return hW(s,X);case _i.PropertyIsLike.toLowerCase():return _W(s,l?l.replace(/[()_]/gi,m):p,p,m,f,h);case _i.PropertyIsNotEqualTo.toLowerCase():return uW(s,X,h);case _i.Within.toLowerCase():return lW(_,ie,k);case _i.And.toLowerCase():return kS.apply(null,o);case _i.Or.toLowerCase():return nW.apply(null,o);case _i.Not.toLowerCase():return oW.apply(null,o);default:return}}defineInterfaceFilterSequence(i,e,n="",o=-1){return i instanceof Array?i.forEach(s=>{this.filterSequence.concat(this.defineInterfaceFilterSequence(s,e,n,o))}):i.hasOwnProperty("logical")?(o=o+1,this.filterSequence.concat(this.defineInterfaceFilterSequence(i.filters,e,i.logical,o))):i.hasOwnProperty("operator")&&this.filterSequence.push(this.addInterfaceFilter(i,e,o,n)),this.filterSequence}computeAllowedOperators(i,e,n){let o={},s,l,h;if(i&&e){let p=i.find(m=>m.name===e);s=p&&p.allowedOperatorsType?p.allowedOperatorsType:n}switch(i&&i.map(p=>{if(!p.allowedOperatorsType)return;let m=p.allowedOperatorsType.toLowerCase();(m===Jd.All.toLowerCase()||m===Jd.Spatial.toLowerCase()||m===Jd.BasicAndSpatial.toLowerCase())&&(l=!0,m===Jd.All.toLowerCase()&&(h=!0))}),s=s||Jd.BasicAndSpatial,s.toLowerCase()){case Jd.All:o=this.operators;break;case Jd.Spatial:o={[_i.Intersects]:{spatial:!0,fieldRestrict:[]},[_i.Within]:{spatial:!0,fieldRestrict:[]}};break;case Jd.BasicAndSpatial:o={[_i.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.Intersects]:{spatial:!0,fieldRestrict:[]},[_i.Within]:{spatial:!0,fieldRestrict:[]}};break;case Jd.Basic:o={[_i.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]}};break;case Jd.Time:o={[_i.During]:{spatial:!1,fieldRestrict:[]}};break;case Jd.BasicNumericOperator:o={[_i.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsGreaterThan]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsGreaterThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsLessThan]:{spatial:!1,fieldRestrict:["number"]},[_i.PropertyIsLessThanOrEqualTo]:{spatial:!1,fieldRestrict:["number"]}};break;default:o={[_i.PropertyIsEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.PropertyIsNotEqualTo]:{spatial:!1,fieldRestrict:[]},[_i.Intersects]:{spatial:!0,fieldRestrict:[]},[_i.Within]:{spatial:!0,fieldRestrict:[]}}}return l&&(o.Intersects={spatial:!0,fieldRestrict:[]},o.Within={spatial:!0,fieldRestrict:[]},h&&(o.Contains={spatial:!0,fieldRestrict:[]})),o}addInterfaceFilter(i,e,n=0,o="Or"){i||(i={operator:"PropertyIsEqualTo"});let s={propertyName:"",operator:"",active:"",filterid:rn(),step:"",begin:"",end:"",sliderOptions:{},lowerBoundary:"",upperBoundary:"",expression:"",pattern:"",wildCard:"*",singleChar:".",escapeChar:"!",matchCase:!0,igoSpatialSelector:"",igoSNRC:"",geometryName:"",geometry:"",wkt_geometry:"",extent:"",srsName:"",parentLogical:"",level:0};return Object.assign(s,{parentLogical:o,level:n,geometryName:e},i)}checkIgoFiltersProperties(i,e,n,o=!1){let s=[];if(i instanceof Array)return i.forEach(l=>{s.push(this.checkIgoFiltersProperties(l,e,n,o))}),s;if(i.hasOwnProperty("logical"))return Object.assign({},{logical:i.logical,filters:this.checkIgoFiltersProperties(i.filters,e,n,o)});if(i.hasOwnProperty("operator"))return this.addFilterProperties(i,e,n,o)}addFilterProperties(i,e,n,o=!1){let s=i.hasOwnProperty("filterid")?i.filterid:rn(),l=i.hasOwnProperty("active")?i.active:o,h=i.hasOwnProperty("srsName")?i.srsName:n?n.getCode():"EPSG:3857";return Object.assign({},{filterid:s,active:l,igoSpatialSelector:"fixedExtent",srsName:h},i,{geometryName:e})}rebuiltIgoOgcFilterObjectFromSequence(i){if(i instanceof Array)if(i.length>=1){let e=i[0].parentLogical,n,o=[],s;return i.forEach(l=>{let h=Object.assign({},l),p=i.indexOf(l);p>=0&&p<i.length-1?n=i[p+1]:n=h,delete h.active,delete h.filterid,delete h.parentLogical,o.push(h),i.length===1?s=h:e!==n.parentLogical&&(o.length===1?console.log("You must set at least two operator in a logical ("+e+")"):(s=Object.assign({},{logical:e,filters:o}),o=[s],e=n.parentLogical))}),s}else return;else return}computeIgoSelector(i){if(i.groups.every(n=>n.computedSelectors!==void 0))return i;let e;if(i.groups&&i.bundles){if(!i.bundles.every(n=>n.id!==void 0))throw new Error("You must set an id for each of your bundles");e=rr.copyDeep(i),e.groups.forEach(n=>{n.title=n.title?n.title:n.name,n.enabled=n.enabled?n.enabled:!1,n.computedSelectors=rr.copyDeep(e.bundles.filter(o=>n.ids.includes(o.id)))})}else!i.groups&&i.bundles?(e=rr.copyDeep(i),e.groups=[{title:"group1",name:"group1",computedSelectors:rr.copyDeep(e.bundles)}]):e={bundles:i,groups:[{title:"group1",name:"group1",computedSelectors:rr.copyDeep(i)}],selectorType:e.selectorType};return e.groups.find(n=>n.enabled)||(e.groups[0].enabled=!0),e}handleOgcFiltersAppliedValue(i,e,n,o){let s=i.ogcFilters;if(!s)return;let l=[],h="",p="";if(s.enabled&&(s.pushButtons||s.checkboxes||s.radioButtons||s.select||s.autocomplete)){let f;if(s.pushButtons){f=s.pushButtons;let g=this.formatGroupAndFilter(s,f);for(let y of g)l.push(y)}if(s.checkboxes){f=s.checkboxes;let g=this.formatGroupAndFilter(s,f);for(let y of g)l.push(y)}if(s.radioButtons){f=s.radioButtons;let g=this.verifyMultipleEnableds(f),y=this.formatGroupAndFilter(s,g);for(let _ of y)l.push(_)}if(s.select){f=s.select;let g=this.verifyMultipleEnableds(f),y=this.formatGroupAndFilter(s,g);for(let _ of y)l.push(_)}if(s.autocomplete){f=s.autocomplete;let g=this.formatGroupAndFilter(s,f);for(let y of g)l.push(y)}s.filters&&"operator"in s.filters&&s.filters.operator.toLowerCase()===_i.During.toLowerCase()&&s.filters.active&&s.interfaceOgcFilters?.length>0&&l.push(s.interfaceOgcFilters[0]),l.length>=1&&(h=this.buildFilter(l.length===1?l[0]:{logical:"And",filters:l},n,o,s.geometryName))}if(s.enabled&&s.filters){s.geometryName=s.geometryName||e;let f=s.filters;p=this.buildFilter(f,n,o,s.geometryName,i)}let m=s.advancedOgcFilters?p:h;return i.type==="wms"&&(m=this.formatProcessedOgcFilter(m,i.params.LAYERS)),i.type==="wfs"&&(m=this.formatProcessedOgcFilter(m,i.params.featureTypes)),m}verifyMultipleEnableds(i){return i.bundles.forEach(e=>{if(!e.multiple&&e.selectors){let n=e.selectors.reduce((o,s,l)=>s.enabled===!0?o.concat(l):o,[]);n.length>1&&(n.splice(0,1),n.forEach(o=>{e.selectors[o].enabled=!1}))}}),i}formatGroupAndFilter(i,e){e=this.computeIgoSelector(e);let n=e.groups.find(s=>s.enabled).computedSelectors,o=[];return n.map(s=>{let l=[],h=s.selectors;h&&(h.filter(p=>p.enabled===!0).forEach(p=>l.push(p.filters)),l.length===1?o.push(l[0]):l.length>1&&o.push({logical:s.logical,filters:l}))}),e.selectorType==="pushButton"?i.pushButtons=e:e.selectorType==="checkbox"?i.checkboxes=e:e.selectorType==="radioButton"?i.radioButtons=e:e.selectorType==="select"?i.select=e:e.selectorType==="autocomplete"&&(i.autocomplete=e),o}formatProcessedOgcFilter(i,e){if(!i)return;let n="";return i.length===0&&e.indexOf(",")===-1?n=i:e.split(",").forEach(()=>{n=`${n}(${i.replace("filter=","")})`}),n=n.replace(/\(\)/g,""),n.length>0?n.replace("filter=",""):void 0}parseFilterOptionDate(i,e){return i?i.toLowerCase().includes("now")||i.toLowerCase().includes("today")?this.parseDateOperation(i):(0,Z0.default)(i).isValid()?i:void 0:e}parseDateOperation(i){let e=i.toLowerCase().split(" "),n=e[0],o=["+","-"].includes(e[1])?e[1]:void 0,s=/^[0-9]*$/.test(e[2])?e[2]:void 0,l=["years","months","weeks","days","hours","seconds"].includes(e[3])?e[3]:void 0;return!o||!l||!s?n==="now"?(0,Z0.default)().format():(0,Z0.default)().endOf("day").format():o==="+"?n==="now"?(0,Z0.default)().add(parseInt(s,10),l).format():(0,Z0.default)().endOf("day").add(parseInt(s,10),l).format():n==="now"?(0,Z0.default)().subtract(parseInt(s,10),l).format():(0,Z0.default)().endOf("day").subtract(parseInt(s,10),l).format()}};var UD=[null],Cme=It(UD,{nd:Tme,tag:SH}),Ame=It(UD,{node:Ime,way:Eme}),VD=class extends jh{constructor(){super(),this.dataProjection=ni("EPSG:4326")}readFeaturesFromNode(i,e){if(e=this.getReadOptions(i,e),i.localName=="osm"){let n=Lt({nodes:{},ways:[],features:[]},Ame,i,[e]);for(let o=0;o<n.ways.length;o++){let s=n.ways[o],l=s.flatCoordinates;if(!l.length)for(let m=0,f=s.ndrefs.length;m<f;m++){let g=n.nodes[s.ndrefs[m]];Cr(l,g)}let h;s.ndrefs[0]==s.ndrefs[s.ndrefs.length-1]?h=new on(l,"XY",[l.length]):h=new Tr(l,"XY"),xn(h,!1,e);let p=new gi(h);s.id!==void 0&&p.setId(s.id),p.setProperties(s.tags,!0),n.features.push(p)}if(n.features)return n.features}return[]}},Mme=It(UD,{tag:SH});function Ime(r,i){let e=i[0],n=i[i.length-1],o=r.getAttribute("id"),s=[parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))];n.nodes[o]=s;let l=Lt({tags:{}},Mme,r,i);if(!Bl(l.tags)){let h=new Ii(s);xn(h,!1,e);let p=new gi(h);o!==void 0&&p.setId(o),p.setProperties(l.tags,!0),n.features.push(p)}}function Eme(r,i){let e=r.getAttribute("id"),n=Lt({id:e,ndrefs:[],flatCoordinates:[],tags:{}},Cme,r,i);i[i.length-1].ways.push(n)}function Tme(r,i){let e=i[i.length-1];e.ndrefs.push(r.getAttribute("ref")),r.hasAttribute("lon")&&r.hasAttribute("lat")&&(e.flatCoordinates.push(parseFloat(r.getAttribute("lon"))),e.flatCoordinates.push(parseFloat(r.getAttribute("lat"))))}function SH(r,i){let e=i[i.length-1];e.tags[r.getAttribute("k")]=r.getAttribute("v")}var CH=VD;var zD="EPSG:3857",qm=5e3,AH="2.0.0",BS="geometry",$D=new RegExp(/(.*)?gml(.*)?/gi),Eze=new RegExp(/(.*)?json(.*)?/gi);function _5(r,i,e,n,o){let s=r.paramsWFS,l=GS(r,void 0,r.paramsWFS.srsName),h;n?.enabled&&(h=n?.filters);let p=new us,m=p.buildFilter(h,i,e,n?.geometryName,r),f=p.handleOgcFiltersAppliedValue(r,n?.geometryName,i,e),g="filter";i&&!f&&(g="bbox",f=i.join(",")+","+e.getCode()),(n?.advancedOgcFilters||f)&&(s.xmlFilter=n?.advancedOgcFilters?m:`${g}=${f}`);let y=l.find(w=>w.name==="getfeature").value;return y=/(filter|bbox)=.*/gi.test(s.xmlFilter)?`${y}&${s.xmlFilter}`:y,r.download=Object.assign({},r.download,{dynamicUrl:y}),o&&(y+=`$&_t${new Date().getTime()}`),y.replace(/&&/g,"&")}function GS(r,i,e,n,o=0,s=!1){let l="2.0.0",h=r.urlWfs,p=r.paramsWFS,m=i||qm,f=p.version===l?`startIndex=${o}`:"",g=e||zD,y=p.outputFormat?`outputFormat=${p.outputFormat}`:"",_=p.version?`version=${p.version}`:`version=${AH}`,A=`${p.version===l?"typenames":"typename"}=${p.featureTypes}`,k=p.version===l?"count":"maxFeatures",R=i?`${k}=${m}`:p.maxFeatures?`${k}=${p.maxFeatures}`:`${k}=${m}`;s&&(y="",_="version=1.1.0",R=R.replace("count","maxFeatures"));let q=e?`srsname=${g}`:p.srsName?"srsname="+p.srsName:`srsname=${g}`,X="",ie="";n&&(X=`propertyName=${n}`,ie=`valueReference=${n}`);let ae=r.sourceFields;if(!X&&ae&&ae.length>0){let ue=[];r.sourceFields.forEach(se=>{ue.push(se.name)}),X=`propertyName=${ue.join(",")},${p.fieldNameGeometry}`}let be=h.indexOf("?")===-1?"?":"&",me=`${h}${be}service=WFS&request=GetCapabilities&${_}`,fe=`${h}${be}service=WFS&request=GetFeature&${_}&${A}&`;fe+=`${y}&${q}&${R}&${X}&${f}`;let ge=`${h}?service=WFS&request=GetPropertyValue&version=${l}&${A}&`;return ge+=`&${R}&${ie}`,[{name:"outputformat",value:y},{name:"version",value:_},{name:"typename",value:A},{name:"count",value:R},{name:"srsname",value:q},{name:"propertyname",value:X},{name:"valuereference",value:ie},{name:"getcapabilities",value:me.replace(/&&/g,"&")},{name:"getfeature",value:fe.replace(/&&/g,"&")},{name:"getpropertyvalue",value:ge.replace(/&&/g,"&")}]}function y5(r,i){i&&i==="wfs"&&(r.paramsWFS=r.params);let e=r.paramsWFS;r.urlWfs=r.urlWfs||r.url,e.version=e.version||AH,e.fieldNameGeometry=e.fieldNameGeometry||BS,e.maxFeatures=e.maxFeatures||qm;let n;return e.outputFormat&&(n=e.outputFormat),($D.test(n)||!n)&&(e.version="1.1.0"),Object.assign({},r)}function jS(r){let i=r,e,n=i.paramsWFS.outputFormat?i.paramsWFS.outputFormat:void 0;return n?Hh[n]?(e=Hh[n],new e(i.formatOptions)):n.toLowerCase().match("gml2")?(e=Wh,new e(En(ur({},i.formatOptions),{gmlFormat:Fu}))):n.toLowerCase().match("gml32")?(e=Wh,new e(En(ur({},i.formatOptions),{gmlFormat:zv}))):n.toLowerCase().match("gml3")?(e=Wh,new e(En(ur({},i.formatOptions),{gmlFormat:Ur}))):n.toLowerCase().match("topojson")?(e=VI,new e(i.formatOptions)):n.toLowerCase().match("geojson")?(e=Qr,new e(i.formatOptions)):n.toLowerCase().match("esrijson")?(e=jm,new e(i.formatOptions)):n.toLowerCase().match("json")?(e=Qr,new e(i.formatOptions)):n.toLowerCase().match("gpx")?(e=sg,new e(i.formatOptions)):n.toLowerCase().match("WKT")?(e=_d,new e(i.formatOptions)):n.toLowerCase().match("osmxml")?(e=CH,new e(i.formatOptions)):n.toLowerCase().match("kml")?(e=cg,new e(i.formatOptions)):new e:(e=Wh,new e(i.formatOptions))}var qh=class extends Wa{options;wfsService;authInterceptor;set ogcFilters(i){this.options.ogcFilters=i}get ogcFilters(){return this.options.ogcFilters}get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}constructor(i,e,n){super(y5(i,"wfs")),this.options=i,this.wfsService=e,this.authInterceptor=n;let o=this.options.ogcFilters,s=this.options.paramsWFS.fieldNameGeometry||BS,l=new us;this.options.ogcFilters=l.defineOgcFiltersDefaultOptions(o,s),this.options.ogcFilters.enabled&&this.options.ogcFilters.editable&&(i.sourceFields||[]).filter(h=>!h.values).length>0&&this.wfsService.getSourceFieldsFromWFS(this.options),o?.pushButtons&&(o.pushButtons.selectorType="pushButton"),o?.checkboxes&&(o.checkboxes.selectorType="checkbox"),o?.radioButtons&&(o.radioButtons.selectorType="radioButton"),o?.select&&(o.select.selectorType="select"),o?.autocomplete&&(o.autocomplete.selectorType="autocomplete"),this.setOgcFilters(this.options.ogcFilters,!0)}createOlSource(){return new $a({format:jS(this.options),strategy:JI})}setOgcFilters(i,e=!1){this.ogcFilters=i,e&&this.ol.notify("ogcFilters",this.ogcFilters)}onUnwatch(){}fetchFeatures({extent:i,projection:e,httpClient:n}){let o=this.options.paramsWFS,s=o.srsName?new lc({code:o.srsName}):e,l=i?Zs(i,e,s):void 0,h=this.ogcFilters;o.srsName=o.srsName||e.getCode();let p=_5(this.options,l,s,h);if(!i&&p.includes("bbox")){let[f,g]=p.split("?"),_=g.split("&").filter(w=>!w.includes("bbox"));p=`${f}?${_.join("&")}`}let m=0;if(o.version==="2.0.0"&&o.maxFeatures>qm)for(;m<o.maxFeatures;){let g=p.replace("count="+o.maxFeatures,"count=1000");return g=g.replace("startIndex=0","0"),g+="&startIndex="+m,g.replace(/&&/g,"&"),this._fetchFeatures(s,g,{extent:l,projection:e,httpClient:n}).pipe(Nt(y=>(m+=1e3,y)))}else return this._fetchFeatures(s,p,{extent:l,projection:e,httpClient:n})}_fetchFeatures(i,e,{extent:n,projection:o,httpClient:s}){return s.get(e,{responseType:"text"}).pipe(Nt(l=>this._parseXmlFeatures(l,o,i)),qr(l=>{throw n&&this.ol.removeLoadedExtent(n),l}))}_parseXmlFeatures(i,e,n){return this.ol.getFormat().readFeatures(i,{dataProjection:e,featureProjection:n})}};var MH=(()=>{class r extends e5{http;constructor(e){super(),this.http=e}getData(){return console.log("This is defining a data service."),"This is defining a data service."}getSourceFieldsFromWFS(e){!e.sourceFields||e.sourceFields.length===0?(e.sourceFields=[],this.defineFieldAndValuefromWFS(e).subscribe(n=>{e.sourceFields=n})):this.defineFieldAndValuefromWFS(e).subscribe(n=>{e.sourceFields.forEach(o=>{o.alias===void 0&&(o.alias=o.name),(o.values===void 0||o.values.length===0)&&(o.values=n.find(s=>s.name===o.name).values)})})}wfsGetFeature(e,n=qm,o=zD,s,l=0,h=!1){let m=GS(e,n,o,s,l,h).find(g=>g.name==="getfeature").value,f=e.paramsWFS.outputFormat;return h||$D.test(f)||!f?this.http.get(m,{responseType:"text"}):this.http.get(m)}defineFieldAndValuefromWFS(e){return new $r(n=>{let o=[],s,l,h,p,m=jS(e),f=JSON.parse(JSON.stringify(e));delete f.paramsWFS.outputFormat,delete f.formatOptions,p=jS(f);let g=e.sourceFields?.filter(y=>!y.values).map(y=>y.name);this.wfsGetFeature(e,1,void 0,void 0,0,!0).pipe(qs(y=>String(y).toLowerCase().includes("exception")?ai(!1):ai(!0)),qs(y=>this.wfsGetFeature(e,1).pipe(qs(_=>{let w=m.readFeatures(_);s=w[0].getKeys(),(e.sourceFields||e.sourceFields.length===0)&&(g=s),l=s.filter(R=>g.includes(R)&&R!==w[0].getGeometryName()&&!R.match(/boundedby/gi)),h=l.join(",");let A=[],k=0;if(!y&&e.paramsWFS.version==="2.0.0"&&e.paramsWFS.maxFeatures>qm){for(;k<e.paramsWFS.maxFeatures;)A.push(this.wfsGetFeature(e,1e3,e.paramsWFS.srsName,h,k)),k+=1e3;p=m}else A.push(this.wfsGetFeature(e,e.paramsWFS.maxFeatures||qm,e.paramsWFS.srsName,h,0,!0));return Ts(A)})))).subscribe(y=>{let _=[];y.map(w=>{let A=p.readFeatures(w);_=_.concat(A)}),this.built_properties_value(_).forEach(w=>{o.push(w)}),n.next(o),n.complete()})})}built_properties_value(e){if(e.length===0)return[];let n=Object.assign({},e[0].getProperties());delete n[e[0].getGeometryName()],delete n.boundedBy;let o=[];for(let s in n)if(n.hasOwnProperty(s)){let l=typeof e[0].get(s)=="object"?void 0:typeof e[0].get(s);o.push({name:s,alias:s,type:l,values:[n[s]]})}return e.every(s=>{let l=s.getProperties();for(let h in l)l.hasOwnProperty(h)&&h in n&&o.filter(p=>p.name===h).forEach(p=>{p.values.indexOf(l[h])===-1&&p.values.push(l[h])});return!0}),o}static \u0275fac=function(n){return new(n||r)(pt(Er))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function VS(r){return Array.isArray(r)?Math.min(...r):r}var WD=class extends xI{constructor(i,e,n,o,s,l,h){let p=i.getExtent();p&&i.canWrapX()&&(p=p.slice(),p[0]=-1/0,p[2]=1/0);let m=e.getExtent();m&&e.canWrapX()&&(m=m.slice(),m[0]=-1/0,m[2]=1/0);let f=m?Xc(n,m):n,g=as(f),y=Zv(i,e,g,o),_=.5,w=new i5(i,e,f,p,y*_,o),A=w.calculateSourceExtent(),k=nd(A)?null:l(A,y,s),R=k?xi.IDLE:xi.EMPTY,q=k?k.getPixelRatio():1;super(n,o,q,R),this.targetProj_=e,this.maxSourceExtent_=p,this.triangulation_=w,this.targetResolution_=o,this.targetExtent_=n,this.sourceImage_=k,this.sourcePixelRatio_=q,this.interpolate_=h,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==xi.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){let i=this.sourceImage_.getState();if(i==xi.LOADED){let e=mr(this.targetExtent_)/this.targetResolution_,n=Hn(this.targetExtent_)/this.targetResolution_;this.canvas_=r5(e,n,this.sourcePixelRatio_,VS(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=i,this.changed()}load(){if(this.state==xi.IDLE){this.state=xi.LOADING,this.changed();let i=this.sourceImage_.getState();i==xi.LOADED||i==xi.ERROR?this.reproject_():(this.sourceListenerKey_=Vr(this.sourceImage_,mi.CHANGE,function(e){let n=this.sourceImage_.getState();(n==xi.LOADED||n==xi.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){wn(this.sourceListenerKey_),this.sourceListenerKey_=null}},IH=WD;var HD={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"},qD=class extends To{constructor(i,e){super(i),this.image=e}},YD=class extends Yv{constructor(i){super({attributions:i.attributions,projection:i.projection,state:i.state,interpolate:i.interpolate!==void 0?i.interpolate:!0}),this.on,this.once,this.un,this.loader=i.loader||null,this.resolutions_=i.resolutions!==void 0?i.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=i.loader?i.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(i){this.resolutions_=i}findNearestResolution(i){let e=this.getResolutions();if(e){let n=O0(e,i,0);i=e[n]}return i}getImage(i,e,n,o){let s=this.getProjection();if(!s||!o||cc(s,o))return s&&(o=s),this.getImageInternal(i,e,n,o);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&cc(this.reprojectedImage_.getProjection(),o)&&this.reprojectedImage_.getResolution()==e&&Wd(this.reprojectedImage_.getExtent(),i))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new IH(s,o,i,e,n,(l,h,p)=>this.getImageInternal(l,h,p,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(i,e,n,o){if(this.loader){let s=US(i,e,n,1),l=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===o&&(this.wantedExtent_&&Pa(this.wantedExtent_,s)||Pa(this.image.getExtent(),s))&&(this.wantedResolution_&&VS(this.wantedResolution_)===l||VS(this.image.getResolution())===l)))return this.image;this.wantedProjection_=o,this.wantedExtent_=s,this.wantedResolution_=l,this.image=new xI(s,l,n,this.loader),this.image.addEventListener(mi.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(i){let e=i.target,n;switch(e.getState()){case xi.LOADING:this.loading=!0,n=HD.IMAGELOADSTART;break;case xi.LOADED:this.loading=!1,n=HD.IMAGELOADEND;break;case xi.ERROR:this.loading=!1,n=HD.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new qD(n,e))}};function v5(r,i){r.getImage().src=i}function US(r,i,e,n){let o=i/e,s=as(r),l=Cm(mr(r)/o,4),h=Cm(Hn(r)/o,4),p=Cm((n-1)*l/2,4),m=l+2*p,f=Cm((n-1)*h/2,4),g=h+2*f;return _p(s,o,0,[m,g])}var b5=YD;function X0(r,i){let e=[];Object.keys(i).forEach(function(o){i[o]!==null&&i[o]!==void 0&&e.push(o+"="+encodeURIComponent(i[o]))});let n=e.join("&");return r=r.replace(/[?&]$/,""),r+=r.includes("?")?"&":"?",r+n}var TH="1.3.0",EH=[101,101];function FH(r,i,e,n,o){o.WIDTH=e[0],o.HEIGHT=e[1];let s=n.getAxisOrientation(),l,h=_P(o.VERSION,"1.3")>=0;return o[h?"CRS":"SRS"]=n.getCode(),h&&s.substr(0,2)=="ne"?l=[i[1],i[0],i[3],i[2]]:l=i,o.BBOX=l.join(","),X0(r,o)}function Pme(r,i,e,n,o,s,l){s=Object.assign({REQUEST:"GetMap"},s);let h=i/e,p=[q1(mr(r)/h,4),q1(Hn(r)/h,4)];if(e!=1)switch(l){case"geoserver":let f=90*e+.5|0;"FORMAT_OPTIONS"in s?s.FORMAT_OPTIONS+=";dpi:"+f:s.FORMAT_OPTIONS="dpi:"+f;break;case"mapserver":s.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":s.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return FH(o,r,p,n,s)}function PH(r,i){return Object.assign({REQUEST:i,SERVICE:"WMS",VERSION:TH,FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},r)}function LH(r){let i=r.hidpi===void 0?!0:r.hidpi,e=ni(r.projection||"EPSG:3857"),n=r.ratio||1.5,o=r.load||V0;return(s,l,h)=>{s=US(s,l,h,n),h!=1&&(!i||r.serverType===void 0)&&(h=1);let p=Pme(s,l,h,e,r.url,PH(r.params,"GetMap"),r.serverType),m=new Image;return r.crossOrigin!==null&&(m.crossOrigin=r.crossOrigin),o(m,p).then(f=>({image:f,extent:s,pixelRatio:h}))}}function kH(r,i,e){if(r.url===void 0)return;let n=ni(r.projection||"EPSG:3857"),o=_p(i,e,0,EH),s={QUERY_LAYERS:r.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(s,PH(r.params,"GetFeatureInfo"),r.params);let l=_0((i[0]-o[0])/e,4),h=_0((o[3]-i[1])/e,4),p=_P(s.VERSION,"1.3")>=0;return s[p?"I":"X"]=l,s[p?"J":"Y"]=h,FH(r.url,o,EH,n,s)}function OH(r,i){if(r.url===void 0)return;let e={SERVICE:"WMS",VERSION:TH,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(r.params===void 0||r.params.LAYER===void 0){let n=r.params.LAYERS;if(!(!Array.isArray(n)||n.length===1))return;e.LAYER=n}if(i!==void 0){let n=ni(r.projection||"EPSG:3857").getMetersPerUnit()||1,o=28e-5;e.SCALE=i*n/o}return Object.assign(e,r.params),X0(r.url,e)}var ZD=class extends b5{constructor(i){i=i||{},super({attributions:i.attributions,interpolate:i.interpolate,projection:i.projection,resolutions:i.resolutions}),this.crossOrigin_=i.crossOrigin!==void 0?i.crossOrigin:null,this.url_=i.url,this.imageLoadFunction_=i.imageLoadFunction!==void 0?i.imageLoadFunction:v5,this.params_=Object.assign({},i.params),this.serverType_=i.serverType,this.hidpi_=i.hidpi!==void 0?i.hidpi:!0,this.renderedRevision_=0,this.ratio_=i.ratio!==void 0?i.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(i,e,n,o){let s=ni(n),l=this.getProjection();l&&l!==s&&(e=Zv(l,s,i,e),i=Sr(i,s,l));let h={url:this.url_,params:ur(ur({},this.params_),o),projection:l||s};return kH(h,i,e)}getLegendUrl(i,e){return OH({url:this.url_,params:ur(ur({},this.params_),e)},i)}getParams(){return this.params_}getImageInternal(i,e,n,o){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==o)&&(this.loaderProjection_=o,this.loader=LH({crossOrigin:this.crossOrigin_,params:this.params_,projection:o,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,l)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,l),V0(s))})),super.getImageInternal(i,e,n,o))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(i){this.imageLoadFunction_=i,this.changed()}setUrl(i){i!=this.url_&&(this.url_=i,this.loader=null,this.changed())}updateParams(i){Object.assign(this.params_,i),this.changed()}changed(){this.image=null,super.changed()}},DH=ZD;var Ya=function(r){return r.GML2="gml2",r.GML3="gml3",r.JSON="json",r.GEOJSON="geojson",r.GEOJSON2="geojson2",r.ESRIJSON="esrijson",r.TEXT="text",r.HTML="html",r.HTMLGML2="htmlgml2",r}(Ya||{}),Yh=function(r){return r.GML2="application/vnd.ogc.gml",r.GML3="application/vnd.ogc.gml/3.1.1",r.JSON="application/json",r.GEOJSON="application/geojson",r.GEOJSON2="geojson",r.ESRIJSON="application/json",r.TEXT="text/plain",r.HTML="text/html",r.HTMLGML2="text/html",r}(Yh||{}),eh=function(r){return r.IFRAME="iframe",r.BLANK="_blank",r}(eh||{});var _l=class extends Wa{options;wfsService;get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:eh.BLANK}set ogcFilters(i){this.options.ogcFilters=i}get ogcFilters(){return this.options.ogcFilters}set timeFilter(i){this.options.timeFilter=i}get timeFilter(){return this.options.timeFilter}timeFilter$=new ut(void 0);get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.params})}constructor(i,e){super(i),this.options=i,this.wfsService=e;let n=i.params,o=n.DPI||96;n.DPI=o,n.MAP_RESOLUTION=o,n.FORMAT_OPTIONS="dpi:"+o,i.refreshIntervalSec&&i.refreshIntervalSec>0&&setInterval(()=>{this.refresh()},i.refreshIntervalSec*1e3);let s=BS;if(i.paramsWFS){let f=y5(i,"wms");rr.mergeDeep(i.paramsWFS,f.paramsWFS),s=i.paramsWFS.fieldNameGeometry||s,i.download=Object.assign({},i.download,{dynamicUrl:this.buildDynamicDownloadUrlFromParamsWFS(i)})}!i.sourceFields||i.sourceFields.length===0?i.sourceFields=[]:i.sourceFields.forEach(f=>{f.alias=f.alias?f.alias:f.name});let l=i.ogcFilters,h=new us;l?(l.advancedOgcFilters=!(l.pushButtons||l.checkboxes||l.radioButtons||l.select||l.autocomplete),l.advancedOgcFilters&&l.filters&&l.filters.calendarModeYear&&(l.advancedOgcFilters=!1),l.pushButtons&&(l.pushButtons.selectorType="pushButton"),l.checkboxes&&(l.checkboxes.selectorType="checkbox"),l.radioButtons&&(l.radioButtons.selectorType="radioButton"),l.select&&(l.select.selectorType="select"),l.autocomplete&&(l.autocomplete.selectorType="autocomplete")):i.ogcFilters=h.defineOgcFiltersDefaultOptions(l,s,"wms"),n.LAYERS.split(",").length>1&&l&&l.enabled&&(console.log("*******************************"),console.log("BE CAREFULL, YOUR WMS LAYERS ("+n.LAYERS+") MUST SHARE THE SAME FIELDS TO ALLOW ogcFilters TO WORK !! "),console.log("*******************************")),i.paramsWFS&&l&&l.enabled&&l.editable&&(i.sourceFields||[]).filter(f=>!f.values).length>0&&this.wfsService.getSourceFieldsFromWFS(i);let p=h.handleOgcFiltersAppliedValue(i,s);n.FILTER=p,this.ol.updateParams({FILTER:n.FILTER}),this.setOgcFilters(l,!0);let m=i;m?.timeFilterable&&m?.timeFilter&&this.setTimeFilter(m.timeFilter,!0)}refresh(){this.ol.updateParams({igoRefresh:Math.random()})}buildDynamicDownloadUrlFromParamsWFS(i){return GS(i).find(o=>o.name==="getfeature").value}createOlSource(){return new DH(Object.assign({ratio:1},this.options))}setOgcFilters(i,e=!1){this.ogcFilters=i,e&&this.ol.notify("ogcFilters",this.ogcFilters)}setTimeFilter(i,e=!1){this.timeFilter=i,e&&(this.timeFilter$.next(this.timeFilter),this.ol.notify("timeFilter",this.ogcFilters))}getLegend(i,e){let n=super.getLegend();if(n.length>0&&i===void 0&&!e?.scale)return n;let o=!1,s;e?.size&&e?.extent&&e?.projection&&this.options.contentDependentLegend&&(s=this.params.VERSION==="1.3.0"||this.params.VERSION===void 0?"CRS":"SRS",o=!0);let l=this.params,h=[];l.LAYERS!==void 0&&(h=l.LAYERS.split(","));let p=this.options.url.replace(/\?$/,""),m=["REQUEST=GetLegendGraphic","SERVICE=WMS","FORMAT=image/png","SLD_VERSION=1.1.0",`VERSION=${l.VERSION||"1.3.0"}`];return i!==void 0&&m.push(`STYLE=${i}`),e?.scale!==void 0&&m.push(`SCALE=${e.scale}`),o&&(m.push(`WIDTH=${e.size[0]}`),m.push(`HEIGHT=${e.size[1]}`),m.push(`BBOX=${e.extent.join(",")}`),m.push(`${s}=${e.projection}`)),n=h.map(f=>{let g=p.match(/\?/)?"&":"?";return{url:`${p}${g}${m.join("&")}&LAYER=${f}`,title:h.length>1?f:void 0,currentStyle:i===void 0?void 0:i}}),n}onUnwatch(){}};var XD=class extends Jv{constructor(i){let e=i.requestEncoding!==void 0?i.requestEncoding:"KVP",n=i.tileGrid,o=i.urls;o===void 0&&i.url!==void 0&&(o=f5(i.url)),super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:i.interpolate,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileClass:i.tileClass,tileGrid:n,tileLoadFunction:i.tileLoadFunction,tilePixelRatio:i.tilePixelRatio,urls:o,wrapX:i.wrapX!==void 0?i.wrapX:!1,transition:i.transition,zDirection:i.zDirection}),this.version_=i.version!==void 0?i.version:"1.0.0",this.format_=i.format!==void 0?i.format:"image/jpeg",this.dimensions_=i.dimensions!==void 0?i.dimensions:{},this.layer_=i.layer,this.matrixSet_=i.matrixSet,this.style_=i.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),o&&o.length>0&&(this.tileUrlFunction=m5(o.map(this.createFromWMTSTemplate.bind(this))))}setUrls(i){this.urls=i;let e=i.join(`
`);this.setTileUrlFunction(m5(i.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){let i=this.urls?this.urls.slice(0):[];for(let e in this.dimensions_)i.push(e+"-"+this.dimensions_[e]);return i.join("/")}updateDimensions(i){Object.assign(this.dimensions_,i),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(i){let e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),i=e=="KVP"?X0(i,n):i.replace(/\{(\w+?)\}/g,function(l,h){return h.toLowerCase()in n?n[h.toLowerCase()]:l});let o=this.tileGrid,s=this.dimensions_;return function(l,h,p){if(!l)return;let m={TileMatrix:o.getMatrixId(l[0]),TileCol:l[1],TileRow:l[2]};Object.assign(m,s);let f=i;return e=="KVP"?f=X0(f,m):f=f.replace(/\{(\w+?)\}/g,function(g,y){return m[y]}),f}}},RH=XD;function NH(r,i){let n=r.Contents.Layer?.find(function(te){return te.Identifier==i.layer});if(!n)return null;let o=r.Contents.TileMatrixSet,s;n.TileMatrixSetLink.length>1?"projection"in i?s=n.TileMatrixSetLink.findIndex(function(te){let Te=o.find(function(Ne){return Ne.Identifier==te.TileMatrixSet}).SupportedCRS,Ee=ni(Te),je=ni(i.projection);return Ee&&je?cc(Ee,je):Te==i.projection}):s=n.TileMatrixSetLink.findIndex(function(te){return te.TileMatrixSet==i.matrixSet}):s=0,s<0&&(s=0);let l=n.TileMatrixSetLink[s].TileMatrixSet,h=n.TileMatrixSetLink[s].TileMatrixSetLimits,p=n.Format[0];"format"in i&&(p=i.format),s=n.Style.findIndex(function(te){return"style"in i?te.Title==i.style:te.isDefault}),s<0&&(s=0);let m=n.Style[s].Identifier,f={};"Dimension"in n&&n.Dimension.forEach(function(te,Se,Te){let Ee=te.Identifier,je=te.Default;je===void 0&&(je=te.Value[0]),f[Ee]=je});let y=r.Contents.TileMatrixSet.find(function(te){return te.Identifier==l}),_,w=y.SupportedCRS;if(w&&(_=ni(w)),"projection"in i){let te=ni(i.projection);te&&(!_||cc(te,_))&&(_=te)}let A=!1,k=_.getAxisOrientation().substr(0,2)=="ne",R=y.TileMatrix[0],q={MinTileCol:0,MinTileRow:0,MaxTileCol:R.MatrixWidth-1,MaxTileRow:R.MatrixHeight-1};if(h){q=h[h.length-1];let te=y.TileMatrix.find(Se=>Se.Identifier===q.TileMatrix||y.Identifier+":"+Se.Identifier===q.TileMatrix);te&&(R=te)}let X=R.ScaleDenominator*28e-5/_.getMetersPerUnit(),ie=k?[R.TopLeftCorner[1],R.TopLeftCorner[0]]:R.TopLeftCorner,ae=R.TileWidth*X,be=R.TileHeight*X,me=y.BoundingBox;me&&k&&(me=[me[1],me[0],me[3],me[2]]);let fe=[ie[0]+ae*q.MinTileCol,ie[1]-be*(1+q.MaxTileRow),ie[0]+ae*(1+q.MaxTileCol),ie[1]-be*q.MinTileRow];if(me!==void 0&&!Pa(me,fe)){let te=n.WGS84BoundingBox,Se=ni("EPSG:4326").getExtent();if(fe=me,te)A=te[0]===Se[0]&&te[2]===Se[2];else{let Te=Zs(me,y.SupportedCRS,"EPSG:4326");A=Te[0]-1e-10<=Se[0]&&Te[2]+1e-10>=Se[2]}}let ge=_H(y,fe,h),ue=[],se=i.requestEncoding;if(se=se!==void 0?se:"","OperationsMetadata"in r&&"GetTile"in r.OperationsMetadata){let te=r.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let Se=0,Te=te.length;Se<Te;++Se)if(te[Se].Constraint){let je=te[Se].Constraint.find(function(Ne){return Ne.name=="GetEncoding"}).AllowedValues.Value;if(se===""&&(se=je[0]),se==="KVP")je.includes("KVP")&&ue.push(te[Se].href);else break}else te[Se].href&&(se="KVP",ue.push(te[Se].href))}return ue.length===0&&(se="REST",n.ResourceURL.forEach(function(te){te.resourceType==="tile"&&(p=te.format,ue.push(te.template))})),{urls:ue,layer:i.layer,matrixSet:l,format:p,projection:_,requestEncoding:se,tileGrid:ge,style:m,dimensions:f,wrapX:A,crossOrigin:i.crossOrigin}}function BH(r){let e=(r?ni(r):ni("EPSG:3857")).getExtent(),n=mr(e)/256,o=new Array(20),s=new Array(20);for(let l=0;l<20;++l)o[l]=n/Math.pow(2,l),s[l]=l;return new gH({origin:Mc(e),resolutions:o,matrixIds:s})}var Oy=class extends Wa{constructor(i){super(i)}createOlSource(){let i=Object.assign({tileGrid:BH(this.options.projection)},this.options);return new RH(i)}onUnwatch(){}};var KD=class extends Y0{constructor(i){super({attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,maxZoom:i.maxZoom!==void 0?i.maxZoom:18,minZoom:i.minZoom,projection:i.projection,transition:i.transition,wrapX:i.wrapX,zDirection:i.zDirection}),this.account_=i.account,this.mapId_=i.map||"",this.config_=i.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(i){Object.assign(this.config_,i),this.initializeMap_()}setConfig(i){this.config_=i||{},this.initializeMap_()}initializeMap_(){let i=JSON.stringify(this.config_);if(this.templateCache_[i]){this.applyTemplate_(this.templateCache_[i]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);let n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,i)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",e),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(i,e){let n=e.target;if(!n.status||n.status>=200&&n.status<300){let o;try{o=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(o),this.templateCache_[i]=o,this.setState("ready")}else this.setState("error")}handleInitError_(i){this.setState("error")}applyTemplate_(i){let e="https://"+i.cdn_url.https+"/"+this.account_+"/api/v1/map/"+i.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}},GH=KD;var gg=class extends Wa{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:eh.BLANK}get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}createOlSource(){let i=this.options.crossOrigin?this.options.crossOrigin:"anonymous",e=Object.assign({crossOrigin:i},this.options);return new GH(e)}getLegend(){let i=super.getLegend();if(i.length>0)return i;let e="<table>";if(this.options.config.layers[0].legend)return this.options.config.layers[0].legend.items.forEach(n=>{n.visible===!0&&(e+='<tr><td><p><font size="5" color="'+n.value+'"> &#9679</font></p></td><td>'+n.name+"</td></tr>")}),e+="</table>",[{html:e}];{let n=this.options.config.layers[0].options,o=["polygon-fill:","marker-fill:","shield-fill:","building-fill:","line-color:"];for(let s of o)if(n.cartocss.includes(s)){let l=n.cartocss.split(s).pop(),h=l.substr(0,l.indexOf(";"));if(h.includes("ramp")){let p=h.split(", (")[1].split(","),m=h.split(", (")[2].split(",");for(let f=0;f<p.length;f++)p[f]=p[f].replace(/("|\))/g,""),m[f]=m[f].replace(/("|\))/g,""),m[f].replace(/\s+/g,"")==="="&&(m[f]="Autres"),e+='<tr><td><p><font size="5" color="'+p[f]+'"> &#9679</font></p></td><td>'+m[f]+"</td></tr>";break}else{let p=n.layer_name?n.layer_name:"";e+='<tr><td><p><font size="5" color="'+h+'"> &#9679</font></p></td><td>'+p+"</td></tr>";break}}return e+="</table>",[{html:e}]}}onUnwatch(){}};var Dy=class extends Wa{get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params,url:this.options.url})}createOlSource(){let i=new jm;return new $a({attributions:this.options.params.attributions,overlaps:!1,format:i,url:function(e){let n=this.options.url+"/"+this.options.layer+"/query/",s=["f=json",`geometry=${encodeURIComponent('{"xmin":'+e[0]+',"ymin":'+e[1]+',"xmax":'+e[2]+',"ymax":'+e[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];if(this.options.params.time){let l=`time=${this.options.params.time}`;s.push(l)}return this.options.params.customParams&&this.options.params.customParams.forEach(l=>{s.push(l)}),`${n}?${s.join("&")}`}.bind(this),strategy:JI})}getLegend(){let i=this.options.legendInfo,e=super.getLegend();if(i===void 0||e.length>0)return e;if(!i)return;let n="<table>",o,s,l;if(i.legend)for(let h of i.legend)o=this.htmlImgSrc(h.contentType,h.imageData),s=h.label?h.label.replace("<Null>","Null"):"",n+=`<tr><td align='left'><img src="`+o+`" alt ='' /></td><td class="mat-typography">`+s+"</td></tr>";else if(i.type==="uniqueValue")for(let h of i.uniqueValueInfos)s=h.label.replace("<Null>","Null"),h.symbol.type==="esriPMS"?(o=this.htmlImgSrc(h.symbol.contentType,h.symbol.imageData),n+=`<tr><td align='left'><img src="`+o+`" alt ='' /></td><td class="mat-typography">`+s+"</td></tr>"):h.symbol.type!=="esriPMS"&&(l=this.createSVG(h.symbol),n+="<tr><td align='left'>"+l+'</td><td class="mat-typography">'+s+"</td></tr>");else i.type==="simple"&&(s=i.label?i.label.replace("<Null>","Null"):"",i.symbol.type==="esriPMS"?(o=this.htmlImgSrc(i.symbol.contentType,i.symbol.imageData),n+=`<tr><td align='left'><img src="`+o+`" alt ='' /></td><td class="mat-typography">`+s+"</td></tr>"):i.symbol.type!=="esriPMS"&&(l=this.createSVG(i.symbol),n+="<tr><td align='left'>"+l+'</td><td class="mat-typography">'+s+"</td></tr>"));return n+="</table>",[{html:n}]}htmlImgSrc(i,e){return`data:${i};base64,${e}`}createSVG(i){let e="",n=i.color?i.color:[0,0,0,0];if(i.type==="esriSLS"){let o=i.width?i.width:0,s="stroke:rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")",l="stroke-width:"+o;i.style==="esriSLSSolid"?e='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+l+'"/></svg>':i.style==="esriSLSDash"&&(e='<svg height="30" width="30"><line x1="0" y1="15" x2="30" y2="15" style="'+s+";"+l+'" '+'stroke-dasharray="5,5"'+"/></svg>")}else if(i.style==="esriSMSCircle"||i.style==="esriSFSSolid"){let o=i.outline.color,s=i.outline.width,l=i.size,h="stroke:rgba("+o[0]+","+o[1]+","+o[2]+","+o[3]+")",p="stroke-width:"+s,m="fill:rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")";i.style==="esriSMSCircle"?e='<svg height="30" width="30"><circle cx="15" cy="15" r="'+l/2+'" style="'+h+";"+p+";"+m+'"/></svg>':e='<svg height="30" width="30"><rect x="5" y="5" width="20" height="20" style ="'+h+";"+p+";"+m+'"/></svg>'}return e}onUnwatch(){}};function QD(r,i,e,n,o,s){let l=o.getCode().split(/:(?=\d+$)/).pop(),h=e/n,p=[q1(mr(i)/h,4),q1(Hn(i)/h,4)];s.SIZE=p[0]+","+p[1],s.BBOX=i.join(","),s.BBOXSR=l,s.IMAGESR=l,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);let m=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return X0(m,s)}function jH(r){let i=r.load?r.load:V0,e=ni(r.projection||"EPSG:3857");return function(n,o,s){s=r.hidpi?s:1;let l={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(l,r.params),n=US(n,o,s,r.ratio);let h=QD(r.url,n,o,s,e,l),p=new Image;return r.crossOrigin!==null&&(p.crossOrigin=r.crossOrigin),i(p,h).then(m=>{let f=mr(n)/m.width*s;return{image:m,extent:n,resolution:f,pixelRatio:s}})}}var JD=class extends b5{constructor(i){i=i||{},super({attributions:i.attributions,interpolate:i.interpolate,projection:i.projection,resolutions:i.resolutions}),this.crossOrigin_=i.crossOrigin!==void 0?i.crossOrigin:null,this.hidpi_=i.hidpi!==void 0?i.hidpi:!0,this.url_=i.url,this.imageLoadFunction_=i.imageLoadFunction!==void 0?i.imageLoadFunction:v5,this.params_=Object.assign({},i.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=i.ratio!==void 0?i.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(i,e,n,o){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==o)&&(this.loaderProjection_=o,this.loader=jH({crossOrigin:this.crossOrigin_,params:this.params_,projection:o,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,l)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,l),V0(s))})),super.getImageInternal(i,e,n,o))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(i){this.imageLoadFunction_=i,this.changed()}setUrl(i){i!=this.url_&&(this.url_=i,this.loader=null,this.changed())}updateParams(i){Object.assign(this.params_,i),this.changed()}changed(){this.image=null,super.changed()}},VH=JD;var K0=class extends Wa{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:eh.BLANK}get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}createOlSource(){let i=this.options.layer===void 0?this.options.params:Object.assign({LAYERS:`show:${this.options.layer}`},this.options.params);return typeof i.renderingRule=="object"&&(i.renderingRule=JSON.stringify(i.renderingRule)),new VH({ratio:1,params:i,url:this.options.url})}getLegend(){let i=this.options.legendInfo,e=super.getLegend();if(i===void 0||this.options.layer===void 0||e.length>0)return e;if(!i)return;let n="<table>";for(let o of i.legend){let s=`${this.options.url}/${i.layerId}/images/${o.url}`,l=o.label.replace("<Null>","Null");n+=`<tr><td align='left'><img src="`+s+`" alt ='' /></td><td class="mat-typography">`+l+"</td></tr>"}return n+="</table>",[{html:n}]}onUnwatch(){}};var e4=class extends Jv{constructor(i){i=i||{},super({attributions:i.attributions,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:i.interpolate,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileGrid:i.tileGrid,tileLoadFunction:i.tileLoadFunction,url:i.url,urls:i.urls,wrapX:i.wrapX!==void 0?i.wrapX:!0,transition:i.transition,zDirection:i.zDirection}),this.params_=Object.assign({},i.params),this.hidpi_=i.hidpi!==void 0?i.hidpi:!0,this.tmpExtent_=Wn(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let i=0,e=[];for(let n in this.params_)e[i++]=n+"-"+this.params_[n];return e.join("/")}getParams(){return this.params_}getRequestUrl_(i,e,n,o,s,l){let h=this.urls;if(!h)return;let p;if(h.length==1)p=h[0];else{let m=ad(a5(i),h.length);p=h[m]}return QD(p,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(i[0]),o,s,l)}getTilePixelRatio(i){return this.hidpi_?i:1}updateParams(i){Object.assign(this.params_,i),this.setKey(this.getKeyForParams_())}tileUrlFunction(i,e,n){let o=this.getTileGrid();if(o||(o=this.getTileGridForProjection(n)),o.getResolutions().length<=i[0])return;e!=1&&!this.hidpi_&&(e=1);let s=o.getTileCoordExtent(i,this.tmpExtent_),l=Wo(o.getTileSize(i[0]),this.tmpSize);e!=1&&(l=_I(l,e,this.tmpSize));let h={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(h,this.params_),this.getRequestUrl_(i,l,s,e,n,h)}},UH=e4;var Tp=class extends Wa{get params(){return this.options.params}get queryTitle(){return this.options.queryTitle?this.options.queryTitle:"title"}get mapLabel(){return this.options.mapLabel}get queryHtmlTarget(){return this.options.queryHtmlTarget?this.options.queryHtmlTarget:eh.BLANK}get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}createOlSource(){return new UH(this.options)}getLegend(){let i=this.options.legendInfo,e=super.getLegend();if(i===void 0||this.options.layer===void 0||e.length>0)return e;if(!i)return;let n="<table>";for(let o of i.legend){let s=`${this.options.url}/${i.layerId}/images/${o.url}`,l=o.label.replace("<Null>","Null");n+=`<tr><td align='left'><img src="`+s+`" alt ='' /></td><td class="mat-typography">`+l+"</td></tr>"}return n+="</table>",[{html:n}]}onUnwatch(){}};var t4=class extends Y0{constructor(i){i=i||{},super({opaque:!1,projection:i.projection,tileGrid:i.tileGrid,wrapX:i.wrapX!==void 0?i.wrapX:!0,zDirection:i.zDirection,url:i.template||"z:{z} x:{x} y:{y}",tileLoadFunction:(e,n)=>{let o=e.getTileCoord()[0],s=Wo(this.tileGrid.getTileSize(o)),l=yo(s[0],s[1]);l.strokeStyle="grey",l.strokeRect(.5,.5,s[0]+.5,s[1]+.5),l.fillStyle="grey",l.strokeStyle="white",l.textAlign="center",l.textBaseline="middle",l.font="24px sans-serif",l.lineWidth=4,l.strokeText(n,s[0]/2,s[1]/2,s[0]),l.fillText(n,s[0]/2,s[1]/2,s[0]),e.setImage(l.canvas)}})}},zH=t4;var ib=class extends Wa{createOlSource(){let i=JSON.parse(JSON.stringify(this.options));return this.options.tileGrid&&(delete i.tileGrid,i.tileGrid=new mg(this.options.tileGrid)),new zH(i)}onUnwatch(){}};var rb=class extends kr{ws;createOlSource(){return this.createWebSocket(),this.options.format=this.getSourceFormatFromOptions(this.options),super.createOlSource()}createWebSocket(){this.ws=new WebSocket(this.options.url),this.ws.onmessage=this.onMessage.bind(this),this.options.onclose&&(this.ws.onclose=this.onClose.bind(this)),this.options.onerror&&(this.ws.onerror=this.onError.bind(this)),this.options.onopen&&(this.ws.onopen=this.onOpen.bind(this))}onMessage(i){let e=this.options.format.readFeature(i.data);switch(this.options.onmessage){case"update":{let n=this.ol.getFeatureById(e.getId());n&&this.ol.removeFeature(n),this.ol.addFeature(e);break}case"delete":this.ol.clear(!0),this.ol.addFeature(e);break;case"add":default:this.ol.addFeature(e)}}onClose(){}onError(){}onOpen(){}onUnwatch(){this.ws.close()}};var i4=class extends H0{constructor(i,e,n,o,s,l){super(i,e,l),this.extent=null,this.format_=o,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=n,this.key=n}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==si.IDLE&&(this.setState(si.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(i,e){this.setFeatures(i)}onError(){this.setState(si.ERROR)}setFeatures(i){this.features_=i,this.setState(si.LOADED)}setLoader(i){this.loader_=i}},$H=i4;var WH=[],r4=class extends H0{constructor(i,e,n,o){super(i,e,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=o.bind(void 0,this),this.wrappedTileCoord=n}getContext(i){let e=fi(i);return e in this.context_||(this.context_[e]=yo(1,1,WH)),this.context_[e]}hasContext(i){return fi(i)in this.context_}getImage(i){return this.hasContext(i)?this.getContext(i).canvas:null}getReplayState(i){let e=fi(i);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){for(let i in this.context_){let e=this.context_[i];tg(e),WH.push(e.canvas),delete this.context_[i]}super.release()}},HH=r4;var n4=class extends g5{constructor(i){let e=i.projection||"EPSG:3857",n=i.extent||Qv(e),o=i.tileGrid||h5({extent:n,maxResolution:i.maxResolution,maxZoom:i.maxZoom!==void 0?i.maxZoom:22,minZoom:i.minZoom,tileSize:i.tileSize||512});super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,interpolate:!0,opaque:!1,projection:e,state:i.state,tileGrid:o,tileLoadFunction:i.tileLoadFunction?i.tileLoadFunction:Lme,tileUrlFunction:i.tileUrlFunction,url:i.url,urls:i.urls,wrapX:i.wrapX===void 0?!0:i.wrapX,transition:i.transition,zDirection:i.zDirection===void 0?1:i.zDirection}),this.format_=i.format?i.format:null,this.sourceTileCache=new Xv(this.tileCache.highWaterMark),this.overlaps_=i.overlaps==null?!0:i.overlaps,this.tileClass=i.tileClass?i.tileClass:$H,this.tileGrids_={}}getFeaturesInExtent(i){let e=[],n=this.tileCache;if(n.getCount()===0)return e;let o=o5(n.peekFirstKey())[0],s=this.tileGrid;return n.forEach(function(l){if(l.tileCoord[0]!==o||l.getState()!==si.LOADED)return;let h=l.getSourceTiles();for(let p=0,m=h.length;p<m;++p){let f=h[p],g=f.tileCoord;if(On(i,s.getTileCoordExtent(g))){let y=f.getFeatures();if(y)for(let _=0,w=y.length;_<w;++_){let A=y[_],k=A.getGeometry();On(i,k.getExtent())&&e.push(A)}}}}),e}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(i,e){let n=this.getTileCacheForProjection(i),o=Object.keys(e).reduce((s,l)=>{let h=pH(l),p=n.peek(h);if(p){let m=p.sourceTiles;for(let f=0,g=m.length;f<g;++f)s[m[f].getKey()]=!0}return s},{});super.expireCache(i,e),this.sourceTileCache.expireCache(o)}getSourceTiles(i,e,n){if(n.getState()===si.IDLE){n.setState(si.LOADING);let o=n.wrappedTileCoord,s=this.getTileGridForProjection(e),l=s.getTileCoordExtent(o),h=o[0],p=s.getResolution(h);Gl(l,-p,l);let m=this.tileGrid,f=m.getExtent();f&&Xc(l,f,l);let g=m.getZForResolution(p,this.zDirection);m.forEachTileCoord(l,g,y=>{let _=this.tileUrlFunction(y,i,e),w=this.sourceTileCache.containsKey(_)?this.sourceTileCache.get(_):new this.tileClass(y,_?si.IDLE:si.EMPTY,_,this.format_,this.tileLoadFunction);n.sourceTiles.push(w);let A=w.getState();if(A<si.LOADED){let k=R=>{this.handleTileChange(R);let q=w.getState();if(q===si.LOADED||q===si.ERROR){let X=w.getKey();X in n.errorTileKeys?w.getState()===si.LOADED&&delete n.errorTileKeys[X]:n.loadingSourceTiles--,q===si.ERROR?n.errorTileKeys[X]=!0:w.removeEventListener(mi.CHANGE,k),n.loadingSourceTiles===0&&n.setState(Bl(n.errorTileKeys)?si.LOADED:si.ERROR)}};w.addEventListener(mi.CHANGE,k),n.loadingSourceTiles++}A===si.IDLE&&(w.extent=m.getTileCoordExtent(y),w.projection=e,w.resolution=m.getResolution(y[0]),this.sourceTileCache.set(_,w),w.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(y=>y.getState()===si.ERROR)?si.ERROR:si.LOADED)}return n.sourceTiles}getTile(i,e,n,o,s){let l=Hm(i,e,n),h=this.getKey(),p;if(this.tileCache.containsKey(l)&&(p=this.tileCache.get(l),p.key===h))return p;let m=[i,e,n],f=this.getTileCoordForTileUrlFunction(m,s),g=this.getTileGrid().getExtent(),y=this.getTileGridForProjection(s);if(f&&g){let A=y.getTileCoordExtent(f);Gl(A,-y.getResolution(i),A),On(g,A)||(f=null)}let _=!0;if(f!==null){let A=this.tileGrid,k=y.getResolution(i),R=A.getZForResolution(k,1),q=y.getTileCoordExtent(f);Gl(q,-k,q),A.forEachTileCoord(q,R,X=>{_=_&&!this.tileUrlFunction(X,o,s)})}let w=new HH(m,_?si.EMPTY:si.IDLE,f,this.getSourceTiles.bind(this,o,s));return w.key=h,p?(w.interimTile=p,w.refreshInterimChain(),this.tileCache.replace(l,w)):this.tileCache.set(l,w),w}getTileGridForProjection(i){let e=i.getCode(),n=this.tileGrids_[e];if(!n){let o=this.tileGrid,s=o.getResolutions().slice(),l=s.map(function(m,f){return o.getOrigin(f)}),h=s.map(function(m,f){return o.getTileSize(f)}),p=43;for(let m=s.length;m<p;++m)s.push(s[m-1]/2),l.push(l[m-1]),h.push(h[m-1]);n=new mg({extent:o.getExtent(),origins:l,resolutions:s,tileSizes:h}),this.tileGrids_[e]=n}return n}getTilePixelRatio(i){return i}getTilePixelSize(i,e,n){let o=this.getTileGridForProjection(n),s=Wo(o.getTileSize(i),this.tmpSize);return[Math.round(s[0]*e),Math.round(s[1]*e)]}updateCacheSize(i,e){super.updateCacheSize(i*2,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}},w5=n4;function Lme(r,i){r.setLoader(function(e,n,o){bD(i,r.getFormat(),e,n,o,r.onLoad.bind(r),r.onError.bind(r))})}var nb=class extends Wa{get saveableOptions(){return super.saveableOptions}createOlSource(){let i;return this.options.featureClass==="feature"?i=new LS({featureClass:gi}):i=new LS,this.options.format=i,new w5(this.options)}generateId(){if(!this.options.url)return rn();let i="mvt"+this.options.url;return Ph.hashStr(i)}onUnwatch(){}};var o4=class extends $a{constructor(i){super({attributions:i.attributions,wrapX:i.wrapX}),this.resolution=void 0,this.distance=i.distance!==void 0?i.distance:20,this.minDistance=i.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=i.geometryFunction||function(e){let n=e.getGeometry();return Hi(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=i.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(i.source||null)}clear(i){this.features.length=0,super.clear(i)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(i,e,n){this.source.loadFeatures(i,e,n),e!==this.resolution&&(this.resolution=e,this.refresh())}setDistance(i){this.updateDistance(i,this.minDistance)}setMinDistance(i){this.updateDistance(this.distance,i)}getMinDistance(){return this.minDistance}setSource(i){this.source&&this.source.removeEventListener(mi.CHANGE,this.boundRefresh_),this.source=i,i&&i.addEventListener(mi.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(i,e){let n=i===0?0:Math.min(e,i)/i,o=i!==this.distance||this.interpolationRatio!==n;this.distance=i,this.minDistance=e,this.interpolationRatio=n,o&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;let i=Wn(),e=this.distance*this.resolution,n=this.source.getFeatures(),o={};for(let s=0,l=n.length;s<l;s++){let h=n[s];if(!(fi(h)in o)){let p=this.geometryFunction(h);if(p){let m=p.getCoordinates();Sm(m,i),Gl(i,e,i);let f=this.source.getFeaturesInExtent(i).filter(function(g){let y=fi(g);return y in o?!1:(o[y]=!0,!0)});this.features.push(this.createCluster(f,i))}}}}createCluster(i,e){let n=[0,0];for(let h=i.length-1;h>=0;--h){let p=this.geometryFunction(i[h]);p?rM(n,p.getCoordinates()):i.splice(h,1)}nM(n,1/i.length);let o=as(e),s=this.interpolationRatio,l=new Ii([n[0]*(1-s)+o[0]*s,n[1]*(1-s)+o[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(l,i):new gi({geometry:l,features:i})}},qH=o4;var kc=class extends kr{get saveableOptions(){let i=super.saveableOptions;return En(ur({},i),{params:this.options.params})}createOlSource(){return this.options.format=this.getSourceFormatFromOptions(this.options),this.options.source=super.createOlSource(),new qH(this.options)}generateId(){return rn()}onUnwatch(){}};var wo={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};var a4=class extends ls{constructor(i){super(),this.on,this.once,this.un,this.background_=i.background;let e=Object.assign({},i);typeof i.properties=="object"&&(delete e.properties,Object.assign(e,i.properties)),e[wo.OPACITY]=i.opacity!==void 0?i.opacity:1,Hi(typeof e[wo.OPACITY]=="number","Layer opacity must be a number"),e[wo.VISIBLE]=i.visible!==void 0?i.visible:!0,e[wo.Z_INDEX]=i.zIndex,e[wo.MAX_RESOLUTION]=i.maxResolution!==void 0?i.maxResolution:1/0,e[wo.MIN_RESOLUTION]=i.minResolution!==void 0?i.minResolution:0,e[wo.MIN_ZOOM]=i.minZoom!==void 0?i.minZoom:-1/0,e[wo.MAX_ZOOM]=i.maxZoom!==void 0?i.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(i){let e=this.state_||{layer:this,managed:i===void 0?!0:i},n=this.getZIndex();return e.opacity=to(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(i){return Ti()}getLayerStatesArray(i){return Ti()}getExtent(){return this.get(wo.EXTENT)}getMaxResolution(){return this.get(wo.MAX_RESOLUTION)}getMinResolution(){return this.get(wo.MIN_RESOLUTION)}getMinZoom(){return this.get(wo.MIN_ZOOM)}getMaxZoom(){return this.get(wo.MAX_ZOOM)}getOpacity(){return this.get(wo.OPACITY)}getSourceState(){return Ti()}getVisible(){return this.get(wo.VISIBLE)}getZIndex(){return this.get(wo.Z_INDEX)}setBackground(i){this.background_=i,this.changed()}setExtent(i){this.set(wo.EXTENT,i)}setMaxResolution(i){this.set(wo.MAX_RESOLUTION,i)}setMinResolution(i){this.set(wo.MIN_RESOLUTION,i)}setMaxZoom(i){this.set(wo.MAX_ZOOM,i)}setMinZoom(i){this.set(wo.MIN_ZOOM,i)}setOpacity(i){Hi(typeof i=="number","Layer opacity must be a number"),this.set(wo.OPACITY,i)}setVisible(i){this.set(wo.VISIBLE,i)}setZIndex(i){this.set(wo.Z_INDEX,i)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}},x5=a4;var Oc={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};var Ro={ANIMATING:0,INTERACTING:1};var Zh={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function s4(r,i,e){return function(n,o,s,l,h){if(!n)return;if(!o&&!i)return n;let p=i?0:s[0]*o,m=i?0:s[1]*o,f=h?h[0]:0,g=h?h[1]:0,y=r[0]+p/2+f,_=r[2]-p/2+f,w=r[1]+m/2+g,A=r[3]-m/2+g;y>_&&(y=(_+y)/2,_=y),w>A&&(w=(A+w)/2,A=w);let k=to(n[0],y,_),R=to(n[1],w,A);if(l&&e&&o){let q=30*o;k+=-q*Math.log(1+Math.max(0,y-n[0])/q)+q*Math.log(1+Math.max(0,n[0]-_)/q),R+=-q*Math.log(1+Math.max(0,w-n[1])/q)+q*Math.log(1+Math.max(0,n[1]-A)/q)}return[k,R]}}function YH(r){return r}function l4(r,i,e,n){let o=mr(i)/e[0],s=Hn(i)/e[1];return n?Math.min(r,Math.max(o,s)):Math.min(r,Math.min(o,s))}function c4(r,i,e){let n=Math.min(r,i),o=50;return n*=Math.log(1+o*Math.max(0,r/i-1))/o+1,e&&(n=Math.max(n,e),n/=Math.log(1+o*Math.max(0,e/r-1))/o+1),to(n,e/2,i*2)}function ZH(r,i,e,n){return i=i!==void 0?i:!0,function(o,s,l,h){if(o!==void 0){let p=r[0],m=r[r.length-1],f=e?l4(p,e,l,n):p;if(h)return i?c4(o,f,m):to(o,m,f);let g=Math.min(f,o),y=Math.floor(O0(r,g,s));return r[y]>f&&y<r.length-1?r[y+1]:r[y]}}}function XH(r,i,e,n,o,s){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(l,h,p,m){if(l!==void 0){let f=o?l4(i,o,p,s):i;if(m)return n?c4(l,f,e):to(l,e,f);let g=1e-9,y=Math.ceil(Math.log(i/f)/Math.log(r)-g),_=-h*(.5-g)+.5,w=Math.min(f,l),A=Math.floor(Math.log(i/w)/Math.log(r)+_),k=Math.max(y,A),R=i/Math.pow(r,k);return to(R,e,f)}}}function u4(r,i,e,n,o){return e=e!==void 0?e:!0,function(s,l,h,p){if(s!==void 0){let m=n?l4(r,n,h,o):r;return!e||!p?to(s,i,m):c4(s,m,i)}}}function ob(r){if(r!==void 0)return 0}function d4(r){if(r!==void 0)return r}function KH(r){let i=2*Math.PI/r;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/i+.5)*i,e}}function QH(r){let i=r===void 0?Au(5):r;return function(e,n){return n||e===void 0?e:Math.abs(e)<=i?0:e}}var h4=0,m4=class extends ls{constructor(i){super(),this.on,this.once,this.un,i=Object.assign({},i),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=uM(i.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,i.projection&&SP(),i.center&&(i.center=zo(i.center,this.projection_)),i.extent&&(i.extent=Kc(i.extent,this.projection_)),this.applyOptions_(i)}applyOptions_(i){let e=Object.assign({},i);for(let h in Zh)delete e[h];this.setProperties(e,!0);let n=Ome(i);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=i.resolutions,this.padding_=i.padding,this.minZoom_=n.minZoom;let o=kme(i),s=n.constraint,l=Dme(i);this.constraints_={center:o,resolution:s,rotation:l},this.setRotation(i.rotation!==void 0?i.rotation:0),this.setCenterInternal(i.center!==void 0?i.center:null),i.resolution!==void 0?this.setResolution(i.resolution):i.zoom!==void 0&&this.setZoom(i.zoom)}get padding(){return this.padding_}set padding(i){let e=this.padding_;this.padding_=i;let n=this.getCenterInternal();if(n){let o=i||[0,0,0,0];e=e||[0,0,0,0];let s=this.getResolution(),l=s/2*(o[3]-e[3]+e[1]-o[1]),h=s/2*(o[0]-e[0]+e[2]-o[2]);this.setCenterInternal([n[0]+l,n[1]-h])}}getUpdatedOptions_(i){let e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,i)}animate(i){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);let e=new Array(arguments.length);for(let n=0;n<e.length;++n){let o=arguments[n];o.center&&(o=Object.assign({},o),o.center=zo(o.center,this.getProjection())),o.anchor&&(o=Object.assign({},o),o.anchor=zo(o.anchor,this.getProjection())),e[n]=o}this.animateInternal.apply(this,e)}animateInternal(i){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let o=0;for(;o<e&&!this.isDef();++o){let f=arguments[o];f.center&&this.setCenterInternal(f.center),f.zoom!==void 0?this.setZoom(f.zoom):f.resolution&&this.setResolution(f.resolution),f.rotation!==void 0&&this.setRotation(f.rotation)}if(o===e){n&&S5(n,!0);return}let s=Date.now(),l=this.targetCenter_.slice(),h=this.targetResolution_,p=this.targetRotation_,m=[];for(;o<e;++o){let f=arguments[o],g={start:s,complete:!1,anchor:f.anchor,duration:f.duration!==void 0?f.duration:1e3,easing:f.easing||sH,callback:n};if(f.center&&(g.sourceCenter=l,g.targetCenter=f.center.slice(),l=g.targetCenter),f.zoom!==void 0?(g.sourceResolution=h,g.targetResolution=this.getResolutionForZoom(f.zoom),h=g.targetResolution):f.resolution&&(g.sourceResolution=h,g.targetResolution=f.resolution,h=g.targetResolution),f.rotation!==void 0){g.sourceRotation=p;let y=ad(f.rotation-p+Math.PI,2*Math.PI)-Math.PI;g.targetRotation=p+y,p=g.targetRotation}Rme(g)?g.complete=!0:s+=g.duration,m.push(g)}this.animations_.push(m),this.setHint(Ro.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Ro.ANIMATING]>0}getInteracting(){return this.hints_[Ro.INTERACTING]>0}cancelAnimations(){this.setHint(Ro.ANIMATING,-this.hints_[Ro.ANIMATING]);let i;for(let e=0,n=this.animations_.length;e<n;++e){let o=this.animations_[e];if(o[0].callback&&S5(o[0].callback,!1),!i)for(let s=0,l=o.length;s<l;++s){let h=o[s];if(!h.complete){i=h.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=i,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;let i=Date.now(),e=!1;for(let n=this.animations_.length-1;n>=0;--n){let o=this.animations_[n],s=!0;for(let l=0,h=o.length;l<h;++l){let p=o[l];if(p.complete)continue;let m=i-p.start,f=p.duration>0?m/p.duration:1;f>=1?(p.complete=!0,f=1):s=!1;let g=p.easing(f);if(p.sourceCenter){let y=p.sourceCenter[0],_=p.sourceCenter[1],w=p.targetCenter[0],A=p.targetCenter[1];this.nextCenter_=p.targetCenter;let k=y+g*(w-y),R=_+g*(A-_);this.targetCenter_=[k,R]}if(p.sourceResolution&&p.targetResolution){let y=g===1?p.targetResolution:p.sourceResolution+g*(p.targetResolution-p.sourceResolution);if(p.anchor){let _=this.getViewportSize_(this.getRotation()),w=this.constraints_.resolution(y,0,_,!0);this.targetCenter_=this.calculateCenterZoom(w,p.anchor)}this.nextResolution_=p.targetResolution,this.targetResolution_=y,this.applyTargetState_(!0)}if(p.sourceRotation!==void 0&&p.targetRotation!==void 0){let y=g===1?ad(p.targetRotation+Math.PI,2*Math.PI)-Math.PI:p.sourceRotation+g*(p.targetRotation-p.sourceRotation);if(p.anchor){let _=this.constraints_.rotation(y,!0);this.targetCenter_=this.calculateCenterRotate(_,p.anchor)}this.nextRotation_=p.targetRotation,this.targetRotation_=y}if(this.applyTargetState_(!0),e=!0,!p.complete)break}if(s){this.animations_[n]=null,this.setHint(Ro.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;let l=o[0].callback;l&&S5(l,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(i,e){let n,o=this.getCenterInternal();return o!==void 0&&(n=[o[0]-e[0],o[1]-e[1]],Z1(n,i-this.getRotation()),rM(n,e)),n}calculateCenterZoom(i,e){let n,o=this.getCenterInternal(),s=this.getResolution();if(o!==void 0&&s!==void 0){let l=e[0]-i*(e[0]-o[0])/s,h=e[1]-i*(e[1]-o[1])/s;n=[l,h]}return n}getViewportSize_(i){let e=this.viewportSize_;if(i){let n=e[0],o=e[1];return[Math.abs(n*Math.cos(i))+Math.abs(o*Math.sin(i)),Math.abs(n*Math.sin(i))+Math.abs(o*Math.cos(i))]}return e}setViewportSize(i){this.viewportSize_=Array.isArray(i)?i.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){let i=this.getCenterInternal();return i&&$f(i,this.getProjection())}getCenterInternal(){return this.get(Zh.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(i){return i!==void 0?(i[0]=this.hints_[0],i[1]=this.hints_[1],i):this.hints_.slice()}calculateExtent(i){let e=this.calculateExtentInternal(i);return Am(e,this.getProjection())}calculateExtentInternal(i){i=i||this.getViewportSizeMinusPadding_();let e=this.getCenterInternal();Hi(e,"The view center is not defined");let n=this.getResolution();Hi(n!==void 0,"The view resolution is not defined");let o=this.getRotation();return Hi(o!==void 0,"The view rotation is not defined"),_p(e,n,o,i)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(i){this.applyOptions_(this.getUpdatedOptions_({maxZoom:i}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(i){this.applyOptions_(this.getUpdatedOptions_({minZoom:i}))}setConstrainResolution(i){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:i}))}getProjection(){return this.projection_}getResolution(){return this.get(Zh.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(i,e){return this.getResolutionForExtentInternal(Kc(i,this.getProjection()),e)}getResolutionForExtentInternal(i,e){e=e||this.getViewportSizeMinusPadding_();let n=mr(i)/e[0],o=Hn(i)/e[1];return Math.max(n,o)}getResolutionForValueFunction(i){i=i||2;let e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,o=Math.log(e/n)/Math.log(i);return function(s){return e/Math.pow(i,s*o)}}getRotation(){return this.get(Zh.ROTATION)}getValueForResolutionFunction(i){let e=Math.log(i||2),n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,s=Math.log(n/o)/e;return function(l){return Math.log(n/l)/e/s}}getViewportSizeMinusPadding_(i){let e=this.getViewportSize_(i),n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){let i=this.getProjection(),e=this.getResolution(),n=this.getRotation(),o=this.getCenterInternal(),s=this.padding_;if(s){let l=this.getViewportSizeMinusPadding_();o=p4(o,this.getViewportSize_(),[l[0]/2+s[3],l[1]/2+s[0]],e,n)}return{center:o.slice(0),projection:i!==void 0?i:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let i,e=this.getResolution();return e!==void 0&&(i=this.getZoomForResolution(e)),i}getZoomForResolution(i){let e=this.minZoom_||0,n,o;if(this.resolutions_){let s=O0(this.resolutions_,i,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?o=2:o=n/this.resolutions_[s+1]}else n=this.maxResolution_,o=this.zoomFactor_;return e+Math.log(n/i)/Math.log(o)}getResolutionForZoom(i){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;let e=to(Math.floor(i),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,to(i-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,i-this.minZoom_)}fit(i,e){let n;if(Hi(Array.isArray(i)||typeof i.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(i)){Hi(!nd(i),"Cannot fit empty extent provided as `geometry`");let o=Kc(i,this.getProjection());n=fk(o)}else if(i.getType()==="Circle"){let o=Kc(i.getExtent(),this.getProjection());n=fk(o),n.rotate(this.getRotation(),as(o))}else{let o=fl();o?n=i.clone().transform(o,this.getProjection()):n=i}this.fitInternal(n,e)}rotatedExtentForGeometry(i){let e=this.getRotation(),n=Math.cos(e),o=Math.sin(-e),s=i.getFlatCoordinates(),l=i.getStride(),h=1/0,p=1/0,m=-1/0,f=-1/0;for(let g=0,y=s.length;g<y;g+=l){let _=s[g]*n-s[g+1]*o,w=s[g]*o+s[g+1]*n;h=Math.min(h,_),p=Math.min(p,w),m=Math.max(m,_),f=Math.max(f,w)}return[h,p,m,f]}fitInternal(i,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());let o=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1,l;e.minResolution!==void 0?l=e.minResolution:e.maxZoom!==void 0?l=this.getResolutionForZoom(e.maxZoom):l=0;let h=this.rotatedExtentForGeometry(i),p=this.getResolutionForExtentInternal(h,[n[0]-o[1]-o[3],n[1]-o[0]-o[2]]);p=isNaN(p)?l:Math.max(p,l),p=this.getConstrainedResolution(p,s?0:1);let m=this.getRotation(),f=Math.sin(m),g=Math.cos(m),y=as(h);y[0]+=(o[1]-o[3])/2*p,y[1]+=(o[0]-o[2])/2*p;let _=y[0]*g-y[1]*f,w=y[1]*g+y[0]*f,A=this.getConstrainedCenter([_,w],p),k=e.callback?e.callback:Mp;e.duration!==void 0?this.animateInternal({resolution:p,center:A,duration:e.duration,easing:e.easing},k):(this.targetResolution_=p,this.targetCenter_=A,this.applyTargetState_(!1,!0),S5(k,!0))}centerOn(i,e,n){this.centerOnInternal(zo(i,this.getProjection()),e,n)}centerOnInternal(i,e,n){this.setCenterInternal(p4(i,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(i,e,n,o){let s,l=this.padding_;if(l&&i){let h=this.getViewportSizeMinusPadding_(-n),p=p4(i,o,[h[0]/2+l[3],h[1]/2+l[0]],e,n);s=[i[0]-p[0],i[1]-p[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(i){let e=$f(this.targetCenter_,this.getProjection());this.setCenter([e[0]+i[0],e[1]+i[1]])}adjustCenterInternal(i){let e=this.targetCenter_;this.setCenterInternal([e[0]+i[0],e[1]+i[1]])}adjustResolution(i,e){e=e&&zo(e,this.getProjection()),this.adjustResolutionInternal(i,e)}adjustResolutionInternal(i,e){let n=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*i,0,o,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=i,this.applyTargetState_()}adjustZoom(i,e){this.adjustResolution(Math.pow(this.zoomFactor_,-i),e)}adjustRotation(i,e){e&&(e=zo(e,this.getProjection())),this.adjustRotationInternal(i,e)}adjustRotationInternal(i,e){let n=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+i,n);e&&(this.targetCenter_=this.calculateCenterRotate(o,e)),this.targetRotation_+=i,this.applyTargetState_()}setCenter(i){this.setCenterInternal(i&&zo(i,this.getProjection()))}setCenterInternal(i){this.targetCenter_=i,this.applyTargetState_()}setHint(i,e){return this.hints_[i]+=e,this.changed(),this.hints_[i]}setResolution(i){this.targetResolution_=i,this.applyTargetState_()}setRotation(i){this.targetRotation_=i,this.applyTargetState_()}setZoom(i){this.setResolution(this.getResolutionForZoom(i))}applyTargetState_(i,e){let n=this.getAnimating()||this.getInteracting()||e,o=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(o),l=this.constraints_.resolution(this.targetResolution_,0,s,n),h=this.constraints_.center(this.targetCenter_,l,s,n,this.calculateCenterShift(this.targetCenter_,l,o,s));this.get(Zh.ROTATION)!==o&&this.set(Zh.ROTATION,o),this.get(Zh.RESOLUTION)!==l&&(this.set(Zh.RESOLUTION,l),this.set("zoom",this.getZoom(),!0)),(!h||!this.get(Zh.CENTER)||!Mu(this.get(Zh.CENTER),h))&&this.set(Zh.CENTER,h),this.getAnimating()&&!i&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(i,e,n){i=i!==void 0?i:200;let o=e||0,s=this.constraints_.rotation(this.targetRotation_),l=this.getViewportSize_(s),h=this.constraints_.resolution(this.targetResolution_,o,l),p=this.constraints_.center(this.targetCenter_,h,l,!1,this.calculateCenterShift(this.targetCenter_,h,s,l));if(i===0&&!this.cancelAnchor_){this.targetResolution_=h,this.targetRotation_=s,this.targetCenter_=p,this.applyTargetState_();return}n=n||(i===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==h||this.getRotation()!==s||!this.getCenterInternal()||!Mu(this.getCenterInternal(),p))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:p,resolution:h,duration:i,easing:$l,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Ro.INTERACTING,1)}endInteraction(i,e,n){n=n&&zo(n,this.getProjection()),this.endInteractionInternal(i,e,n)}endInteractionInternal(i,e,n){this.getInteracting()&&(this.setHint(Ro.INTERACTING,-1),this.resolveConstraints(i,e,n))}getConstrainedCenter(i,e){let n=this.getViewportSize_(this.getRotation());return this.constraints_.center(i,e||this.getResolution(),n)}getConstrainedZoom(i,e){let n=this.getResolutionForZoom(i);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(i,e){e=e||0;let n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(i,e,n)}};function S5(r,i){setTimeout(function(){r(i)},0)}function kme(r){if(r.extent!==void 0){let e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return s4(r.extent,r.constrainOnlyCenter,e)}let i=uM(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&i.isGlobal()){let e=i.getExtent().slice();return e[0]=-1/0,e[2]=1/0,s4(e,!1,!1)}return YH}function Ome(r){let i,e,n,l=r.minZoom!==void 0?r.minZoom:h4,h=r.maxZoom!==void 0?r.maxZoom:28,p=r.zoomFactor!==void 0?r.zoomFactor:2,m=r.multiWorld!==void 0?r.multiWorld:!1,f=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,g=r.showFullExtent!==void 0?r.showFullExtent:!1,y=uM(r.projection,"EPSG:3857"),_=y.getExtent(),w=r.constrainOnlyCenter,A=r.extent;if(!m&&!A&&y.isGlobal()&&(w=!1,A=_),r.resolutions!==void 0){let k=r.resolutions;e=k[l],n=k[h]!==void 0?k[h]:k[k.length-1],r.constrainResolution?i=ZH(k,f,!w&&A,g):i=u4(e,n,f,!w&&A,g)}else{let R=(_?Math.max(mr(_),Hn(_)):360*Cu.degrees/y.getMetersPerUnit())/256/Math.pow(2,h4),q=R/Math.pow(2,28-h4);e=r.maxResolution,e!==void 0?l=0:e=R/Math.pow(p,l),n=r.minResolution,n===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?n=e/Math.pow(p,h):n=R/Math.pow(p,h):n=q),h=l+Math.floor(Math.log(e/n)/Math.log(p)),n=e/Math.pow(p,h-l),r.constrainResolution?i=XH(p,e,n,f,!w&&A,g):i=u4(e,n,f,!w&&A,g)}return{constraint:i,maxResolution:e,minResolution:n,minZoom:l,zoomFactor:p}}function Dme(r){if(r.enableRotation!==void 0?r.enableRotation:!0){let e=r.constrainRotation;return e===void 0||e===!0?QH():e===!1?d4:typeof e=="number"?KH(e):d4}return ob}function Rme(r){return!(r.sourceCenter&&r.targetCenter&&!Mu(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function p4(r,i,e,n,o){let s=Math.cos(-o),l=Math.sin(-o),h=r[0]*s-r[1]*l,p=r[1]*s+r[0]*l;h+=(i[0]/2-e[0])*n,p+=(e[1]-i[1]/2)*n,l=-l;let m=h*s-p*l,f=p*s+h*l;return[m,f]}var th=m4;var f4=class extends x5{constructor(i){let e=Object.assign({},i);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,i.render&&(this.render=i.render),i.map&&this.setMap(i.map),this.addChangeListener(wo.SOURCE,this.handleSourcePropertyChange_);let n=i.source?i.source:null;this.setSource(n)}getLayersArray(i){return i=i||[],i.push(this),i}getLayerStatesArray(i){return i=i||[],i.push(this.getLayerState()),i}getSource(){return this.get(wo.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){let i=this.getSource();return i?i.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(wn(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;let i=this.getSource();i&&(this.sourceChangeKey_=Vr(i,mi.CHANGE,this.handleSourceChange_,this),i.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(i){return this.renderer_?this.renderer_.getFeatures(i):Promise.resolve([])}getData(i){return!this.renderer_||!this.rendered?null:this.renderer_.getData(i)}isVisible(i){let e,n=this.getMapInternal();!i&&n&&(i=n.getView()),i instanceof th?e={viewState:i.getState(),extent:i.calculateExtent()}:e=i,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let o;e.layerStatesArray?o=e.layerStatesArray.find(l=>l.layer===this):o=this.getLayerState();let s=this.getExtent();return zS(o,e.viewState)&&(!s||On(s,e.extent))}getAttributions(i){if(!this.isVisible(i))return[];let e,n=this.getSource();if(n&&(e=n.getAttributions()),!e)return[];let o=i instanceof th?i.getViewStateAndExtent():i,s=e(o);return Array.isArray(s)||(s=[s]),s}render(i,e){let n=this.getRenderer();return n.prepareFrame(i)?(this.rendered=!0,n.renderFrame(i,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(i,e){}renderDeferred(i){let e=this.getRenderer();e&&e.renderDeferred(i)}setMapInternal(i){i||this.unrender(),this.set(wo.MAP,i)}getMapInternal(){return this.get(wo.MAP)}setMap(i){this.mapPrecomposeKey_&&(wn(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),i||this.changed(),this.mapRenderKey_&&(wn(this.mapRenderKey_),this.mapRenderKey_=null),i&&(this.mapPrecomposeKey_=Vr(i,Oc.PRECOMPOSE,function(e){let o=e.frameState.layerStatesArray,s=this.getLayerState(!1);Hi(!o.some(function(l){return l.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),o.push(s)},this),this.mapRenderKey_=Vr(this,mi.CHANGE,i.render,i),this.changed())}setSource(i){this.set(wo.SOURCE,i)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};function zS(r,i){if(!r.visible)return!1;let e=i.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;let n=i.zoom;return n>r.minZoom&&n<=r.maxZoom}var _g=f4;var uq=Jl(QI(),1);var ab=0,sb=0,ys=1<<ab++,nr=1<<ab++,yd=1<<ab++,yl=1<<ab++,Ym=1<<ab++,su=Math.pow(2,ab)-1,eq={[ys]:"boolean",[nr]:"number",[yd]:"string",[yl]:"color",[Ym]:"number[]"},Nme=Object.keys(eq).map(Number).sort(iu);function Dc(r){let i=[];for(let e of Nme)Bme(r,e)&&i.push(eq[e]);return i.length===0?"untyped":i.length<3?i.join(" or "):i.slice(0,-1).join(", ")+", or "+i[i.length-1]}function Bme(r,i){return(r&i)===i}function Pp(r,i){return!!(r&i)}function C5(r,i){return r===i}var Fp=class{constructor(i,e){this.type=i,this.value=e}},g4=class{constructor(i,e,...n){this.type=i,this.operator=e,this.args=n}};function _4(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function Gme(r){switch(r){case"string":return yd;case"color":return yl;case"number":return nr;case"boolean":return ys;case"number[]":return Ym;default:throw new Error(`Unrecognized type hint: ${r}`)}}function xo(r,i,e){switch(typeof r){case"boolean":return new Fp(ys,r);case"number":return new Fp(nr,r);case"string":{let o=yd;return Ez(r)&&(o|=yl),C5(o&e,sb)||(o&=e),new Fp(o,r)}default:}if(!Array.isArray(r))throw new Error("Expression must be an array or a primitive value");if(r.length===0)throw new Error("Empty expression");if(typeof r[0]=="string")return Kme(r,i,e);for(let o of r)if(typeof o!="number")throw new Error("Expected an array of numbers");let n=Ym;return(r.length===3||r.length===4)&&(n|=yl),e&&(n&=e),new Fp(n,r)}var Bt={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},jme={[Bt.Get]:en(([r,i])=>i!==void 0?Gme(i.value):su,Mn(1,2),Vme),[Bt.Var]:en(([r])=>r.type,Mn(1,1),Ume),[Bt.Id]:en(nr|yd,$S,zme),[Bt.Concat]:en(yd,Mn(2,1/0),lo(su)),[Bt.GeometryType]:en(yd,$S,$me),[Bt.Resolution]:en(nr,$S),[Bt.Zoom]:en(nr,$S),[Bt.Time]:en(nr,$S),[Bt.Any]:en(ys,Mn(2,1/0),lo(ys)),[Bt.All]:en(ys,Mn(2,1/0),lo(ys)),[Bt.Not]:en(ys,Mn(1,1),lo(ys)),[Bt.Equal]:en(ys,Mn(2,2),lo(su),Q0),[Bt.NotEqual]:en(ys,Mn(2,2),lo(su),Q0),[Bt.GreaterThan]:en(ys,Mn(2,2),lo(su),Q0),[Bt.GreaterThanOrEqualTo]:en(ys,Mn(2,2),lo(su),Q0),[Bt.LessThan]:en(ys,Mn(2,2),lo(su),Q0),[Bt.LessThanOrEqualTo]:en(ys,Mn(2,2),lo(su),Q0),[Bt.Multiply]:en(r=>{let i=nr|yl;for(let e=0;e<r.length;e++)i&=r[e].type;return i},Mn(2,1/0),lo(nr|yl),Q0),[Bt.Coalesce]:en(r=>{let i=su;for(let e=1;e<r.length;e+=2)i&=r[e].type;return i&=r[r.length-1].type,i},Mn(2,1/0),lo(su),Q0),[Bt.Divide]:en(nr,Mn(2,2),lo(nr)),[Bt.Add]:en(nr,Mn(2,1/0),lo(nr)),[Bt.Subtract]:en(nr,Mn(2,2),lo(nr)),[Bt.Clamp]:en(nr,Mn(3,3),lo(nr)),[Bt.Mod]:en(nr,Mn(2,2),lo(nr)),[Bt.Pow]:en(nr,Mn(2,2),lo(nr)),[Bt.Abs]:en(nr,Mn(1,1),lo(nr)),[Bt.Floor]:en(nr,Mn(1,1),lo(nr)),[Bt.Ceil]:en(nr,Mn(1,1),lo(nr)),[Bt.Round]:en(nr,Mn(1,1),lo(nr)),[Bt.Sin]:en(nr,Mn(1,1),lo(nr)),[Bt.Cos]:en(nr,Mn(1,1),lo(nr)),[Bt.Atan]:en(nr,Mn(1,2),lo(nr)),[Bt.Sqrt]:en(nr,Mn(1,1),lo(nr)),[Bt.Match]:en(r=>{let i=su;for(let e=2;e<r.length;e+=2)i&=r[e].type;return i&=r[r.length-1].type,i},Mn(4,1/0),JH,Hme),[Bt.Between]:en(ys,Mn(3,3),lo(nr)),[Bt.Interpolate]:en(r=>{let i=yl|nr;for(let e=3;e<r.length;e+=2)i&=r[e].type;return i},Mn(6,1/0),JH,qme),[Bt.Case]:en(r=>{let i=su;for(let e=1;e<r.length;e+=2)i&=r[e].type;return i&=r[r.length-1].type,i},Mn(3,1/0),Wme,Yme),[Bt.In]:en(ys,Mn(2,2),Zme),[Bt.Number]:en(nr,Mn(1,1/0),lo(su)),[Bt.String]:en(yd,Mn(1,1/0),lo(su)),[Bt.Array]:en(r=>r.length===3||r.length===4?Ym|yl:Ym,Mn(1,1/0),lo(nr)),[Bt.Color]:en(yl,Mn(1,4),lo(nr)),[Bt.Band]:en(nr,Mn(1,3),lo(nr)),[Bt.Palette]:en(yl,Mn(2,2),Xme),[Bt.ToString]:en(yd,Mn(1,1),lo(ys|nr|yd|yl))};function Vme(r,i){let e=xo(r[1],i);if(!(e instanceof Fp))throw new Error("Expected a literal argument for get operation");if(typeof e.value!="string")throw new Error("Expected a string argument for get operation");if(i.properties.add(e.value),r.length===3){let n=xo(r[2],i);return[e,n]}return[e]}function Ume(r,i,e,n){let o=r[1];if(typeof o!="string")throw new Error("Expected a string argument for var operation");if(i.variables.add(o),!("variables"in i.style)||i.style.variables[o]===void 0)return[new Fp(su,o)];let s=i.style.variables[o],l=xo(s,i);if(l.value=o,n&&!Pp(n,l.type))throw new Error(`The variable ${o} has type ${Dc(l.type)} but the following type was expected: ${Dc(n)}`);return[l]}function zme(r,i){i.featureId=!0}function $me(r,i){i.geometryType=!0}function $S(r,i){let e=r[0];if(r.length!==1)throw new Error(`Expected no arguments for ${e} operation`);return[]}function Mn(r,i){return function(e,n){let o=e[0],s=e.length-1;if(r===i){if(s!==r){let l=r===1?"":"s";throw new Error(`Expected ${r} argument${l} for ${o}, got ${s}`)}}else if(s<r||s>i){let l=i===1/0?`${r} or more`:`${r} to ${i}`;throw new Error(`Expected ${l} arguments for ${o}, got ${s}`)}}}function lo(r){return function(i,e){let n=i[0],o=i.length-1,s=new Array(o);for(let l=0;l<o;++l){let h=xo(i[l+1],e);if(!Pp(r,h.type)){let p=Dc(r),m=Dc(h.type);throw new Error(`Unexpected type for argument ${l} of ${n} operation, got ${p} but expected ${m}`)}h.type&=r,s[l]=h}return s}}function Q0(r,i,e){let n=r[0],o=r.length-1,s=su;for(let h=0;h<e.length;++h)s&=e[h].type;if(s===sb)throw new Error(`No common type could be found for arguments of ${n} operation`);let l=new Array(o);for(let h=0;h<o;++h)l[h]=xo(r[h+1],i,s);return l}function Wme(r,i){let e=r[0],n=r.length-1;if(n%2===0)throw new Error(`An odd amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function JH(r,i){let e=r[0],n=r.length-1;if(n%2===1)throw new Error(`An even amount of arguments was expected for operation ${e}, got ${JSON.stringify(n)} instead`)}function Hme(r,i,e,n){let o=r.length-1,l=xo(r[1],i).type,h=xo(r[r.length-1],i),p=n!==void 0?n&h.type:h.type,m=new Array(o-2);for(let g=0;g<o-2;g+=2){let y=xo(r[g+2],i),_=xo(r[g+3],i);l&=y.type,p&=_.type,m[g]=y,m[g+1]=_}let f=yd|nr|ys;if(!Pp(f,l))throw new Error(`Expected an input of type ${Dc(f)} for the interpolate operation, got ${Dc(l)} instead`);if(C5(p,sb))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(r));for(let g=0;g<o-2;g+=2){let y=xo(r[g+2],i,l),_=xo(r[g+3],i,p);m[g]=y,m[g+1]=_}return[xo(r[1],i,l),...m,xo(r[r.length-1],i,p)]}function qme(r,i,e,n){let o=r[1],s;switch(o[0]){case"linear":s=1;break;case"exponential":if(s=o[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(o)}`);s=xo(s,i);let l=xo(r[2],i);if(!Pp(nr,l.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${Dc(l.type)} instead`);l=xo(r[2],i,nr);let h=new Array(r.length-3);for(let p=0;p<h.length;p+=2){let m=xo(r[p+3],i);if(!Pp(nr,m.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${Dc(m.type)} at position ${p+2} instead`);let f=xo(r[p+4],i);if(!Pp(nr|yl,f.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${Dc(f.type)} at position ${p+3} instead`);m=xo(r[p+3],i,nr),f=xo(r[p+4],i,nr|yl),h[p]=m,h[p+1]=f}return[s,l,...h]}function Yme(r,i,e,n){let o=xo(r[r.length-1],i),s=n!==void 0?n&o.type:o.type,l=new Array(r.length-1);for(let h=0;h<l.length-1;h+=2){let p=xo(r[h+1],i),m=xo(r[h+2],i);if(!Pp(ys,p.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${Dc(p.type)} at position ${h} instead`);s&=m.type,l[h]=p,l[h+1]=m}if(C5(s,sb))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(r));for(let h=0;h<l.length-1;h+=2)l[h+1]=xo(r[h+2],i,s);return l[l.length-1]=xo(r[r.length-1],i,s),l}function Zme(r,i){let e=r[2];if(!Array.isArray(e))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof e[0]=="string"){if(e[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(e[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');e=e[1]}let n=yd|nr,o=new Array(e.length);for(let l=0;l<o.length;l++){let h=xo(e[l],i);n&=h.type,o[l]=h}if(C5(n,sb))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(r));return[xo(r[1],i,n),...o]}function Xme(r,i){let e=xo(r[1],i,nr);if(e.type!==nr)throw new Error(`The first argument of palette must be an number, got ${Dc(e.type)} instead`);let n=r[2];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");let o=new Array(n.length);for(let s=0;s<o.length;s++){let l=xo(n[s],i,yl);if(!(l instanceof Fp))throw new Error(`The palette color at index ${s} must be a literal value`);if(!Pp(l.type,yl))throw new Error(`The palette color at index ${s} should be of type color, got ${Dc(l.type)} instead`);o[s]=l}return[e,...o]}function en(r,...i){return function(e,n,o){let s=e[0],l=[];for(let p=0;p<i.length;p++)l=i[p](e,n,l,o)||l;let h=typeof r=="function"?r(l):r;if(o!==void 0){if(!Pp(h,o))throw new Error(`The following expression was expected to return ${Dc(o)}, but returns ${Dc(h)} instead: ${JSON.stringify(e)}`);h&=o}if(h===sb)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(e)}`);return new g4(h,s,...l)}}function Kme(r,i,e){let n=r[0],o=jme[n];if(!o)throw new Error(`Unknown operator: ${n}`);return o(r,i,e)}function y4(r){if(!r)return"";let i=r.getType();switch(i){case"Point":case"LineString":case"Polygon":return i;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return i.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return y4(r.getGeometries()[0]);default:return""}}function v4(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Zm(r,i,e){let n=xo(r,e);if(!Pp(i,n.type)){let o=Dc(i),s=Dc(n.type);throw new Error(`Expected expression to be of type ${o}, got ${s}`)}return Lp(n,e)}function Lp(r,i){if(r instanceof Fp){if(r.type===yl&&typeof r.value=="string"){let n=bI(r.value);return function(){return n}}return function(){return r.value}}let e=r.operator;switch(e){case Bt.Number:case Bt.String:case Bt.Coalesce:return Qme(r,i);case Bt.Get:case Bt.Var:return Jme(r,i);case Bt.Id:return n=>n.featureId;case Bt.GeometryType:return n=>n.geometryType;case Bt.Concat:{let n=r.args.map(o=>Lp(o,i));return o=>"".concat(...n.map(s=>s(o).toString()))}case Bt.Resolution:return n=>n.resolution;case Bt.Any:case Bt.All:case Bt.Between:case Bt.In:case Bt.Not:return tfe(r,i);case Bt.Equal:case Bt.NotEqual:case Bt.LessThan:case Bt.LessThanOrEqualTo:case Bt.GreaterThan:case Bt.GreaterThanOrEqualTo:return efe(r,i);case Bt.Multiply:case Bt.Divide:case Bt.Add:case Bt.Subtract:case Bt.Clamp:case Bt.Mod:case Bt.Pow:case Bt.Abs:case Bt.Floor:case Bt.Ceil:case Bt.Round:case Bt.Sin:case Bt.Cos:case Bt.Atan:case Bt.Sqrt:return ife(r,i);case Bt.Case:return rfe(r,i);case Bt.Match:return nfe(r,i);case Bt.Interpolate:return ofe(r,i);case Bt.ToString:return afe(r,i);default:throw new Error(`Unsupported operator ${e}`)}}function Qme(r,i){let e=r.operator,n=r.args.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=Lp(r.args[s],i);switch(e){case Bt.Coalesce:return s=>{for(let l=0;l<n;++l){let h=o[l](s);if(typeof h<"u"&&h!==null)return h}throw new Error("Expected one of the values to be non-null")};case Bt.Number:case Bt.String:return s=>{for(let l=0;l<n;++l){let h=o[l](s);if(typeof h===e)return h}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function Jme(r,i){let n=r.args[0].value;switch(r.operator){case Bt.Get:return o=>o.properties[n];case Bt.Var:return o=>o.variables[n];default:throw new Error(`Unsupported accessor operator ${r.operator}`)}}function efe(r,i){let e=r.operator,n=Lp(r.args[0],i),o=Lp(r.args[1],i);switch(e){case Bt.Equal:return s=>n(s)===o(s);case Bt.NotEqual:return s=>n(s)!==o(s);case Bt.LessThan:return s=>n(s)<o(s);case Bt.LessThanOrEqualTo:return s=>n(s)<=o(s);case Bt.GreaterThan:return s=>n(s)>o(s);case Bt.GreaterThanOrEqualTo:return s=>n(s)>=o(s);default:throw new Error(`Unsupported comparison operator ${e}`)}}function tfe(r,i){let e=r.operator,n=r.args.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=Lp(r.args[s],i);switch(e){case Bt.Any:return s=>{for(let l=0;l<n;++l)if(o[l](s))return!0;return!1};case Bt.All:return s=>{for(let l=0;l<n;++l)if(!o[l](s))return!1;return!0};case Bt.Between:return s=>{let l=o[0](s),h=o[1](s),p=o[2](s);return l>=h&&l<=p};case Bt.In:return s=>{let l=o[0](s);for(let h=1;h<n;++h)if(l===o[h](s))return!0;return!1};case Bt.Not:return s=>!o[0](s);default:throw new Error(`Unsupported logical operator ${e}`)}}function ife(r,i){let e=r.operator,n=r.args.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=Lp(r.args[s],i);switch(e){case Bt.Multiply:return s=>{let l=1;for(let h=0;h<n;++h)l*=o[h](s);return l};case Bt.Divide:return s=>o[0](s)/o[1](s);case Bt.Add:return s=>{let l=0;for(let h=0;h<n;++h)l+=o[h](s);return l};case Bt.Subtract:return s=>o[0](s)-o[1](s);case Bt.Clamp:return s=>{let l=o[0](s),h=o[1](s);if(l<h)return h;let p=o[2](s);return l>p?p:l};case Bt.Mod:return s=>o[0](s)%o[1](s);case Bt.Pow:return s=>Math.pow(o[0](s),o[1](s));case Bt.Abs:return s=>Math.abs(o[0](s));case Bt.Floor:return s=>Math.floor(o[0](s));case Bt.Ceil:return s=>Math.ceil(o[0](s));case Bt.Round:return s=>Math.round(o[0](s));case Bt.Sin:return s=>Math.sin(o[0](s));case Bt.Cos:return s=>Math.cos(o[0](s));case Bt.Atan:return n===2?s=>Math.atan2(o[0](s),o[1](s)):s=>Math.atan(o[0](s));case Bt.Sqrt:return s=>Math.sqrt(o[0](s));default:throw new Error(`Unsupported numeric operator ${e}`)}}function rfe(r,i){let e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Lp(r.args[o],i);return o=>{for(let s=0;s<e-1;s+=2)if(n[s](o))return n[s+1](o);return n[e-1](o)}}function nfe(r,i){let e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Lp(r.args[o],i);return o=>{let s=n[0](o);for(let l=1;l<e;l+=2)if(s===n[l](o))return n[l+1](o);return n[e-1](o)}}function ofe(r,i){let e=r.args.length,n=new Array(e);for(let o=0;o<e;++o)n[o]=Lp(r.args[o],i);return o=>{let s=n[0](o),l=n[1](o),h,p;for(let m=2;m<e;m+=2){let f=n[m](o),g=n[m+1](o),y=Array.isArray(g);if(y&&(g=Mz(g)),f>=l)return m===2?g:y?sfe(s,l,h,p,f,g):WS(s,l,h,p,f,g);h=f,p=g}return p}}function afe(r,i){let e=r.operator,n=r.args.length,o=new Array(n);for(let s=0;s<n;++s)o[s]=Lp(r.args[s],i);switch(e){case Bt.ToString:return s=>{let l=o[0](s);return r.args[0].type===yl?wS(l):l.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function WS(r,i,e,n,o,s){let l=o-e;if(l===0)return n;let h=i-e,p=r===1?h/l:(Math.pow(r,h)-1)/(Math.pow(r,l)-1);return n+p*(s-n)}function sfe(r,i,e,n,o,s){if(o-e===0)return n;let h=Tk(n),p=Tk(s),m=p[2]-h[2];m>180?m-=360:m<-180&&(m+=360);let f=[WS(r,i,e,h[0],o,p[0]),WS(r,i,e,h[1],o,p[1]),h[2]+WS(r,i,e,0,o,m),WS(r,i,e,n[3],o,s[3])];return Fk(Iz(f))}function lfe(r){return!0}function nq(r){let i=_4(),e=cfe(r,i),n=v4();return function(o,s){if(n.properties=o.getPropertiesInternal(),n.resolution=s,i.featureId){let l=o.getId();l!==void 0?n.featureId=l:n.featureId=null}return i.geometryType&&(n.geometryType=y4(o.getGeometry())),e(n)}}function x4(r){let i=_4(),e=r.length,n=new Array(e);for(let l=0;l<e;++l)n[l]=b4(r[l],i);let o=v4(),s=new Array(e);return function(l,h){if(o.properties=l.getPropertiesInternal(),o.resolution=h,i.featureId){let m=l.getId();m!==void 0?o.featureId=m:o.featureId=null}let p=0;for(let m=0;m<e;++m){let f=n[m](o);f&&(s[p]=f,p+=1)}return s.length=p,s}}function cfe(r,i){let e=r.length,n=new Array(e);for(let o=0;o<e;++o){let s=r[o],l="filter"in s?Zm(s.filter,ys,i):lfe,h;if(Array.isArray(s.style)){let p=s.style.length;h=new Array(p);for(let m=0;m<p;++m)h[m]=b4(s.style[m],i)}else h=[b4(s.style,i)];n[o]={filter:l,styles:h}}return function(o){let s=[],l=!1;for(let h=0;h<e;++h){let p=n[h].filter;if(p(o)&&!(r[h].else&&l)){l=!0;for(let m of n[h].styles){let f=m(o);f&&s.push(f)}}}return s}}function b4(r,i){let e=HS(r,"",i),n=qS(r,"",i),o=ufe(r,i),s=dfe(r,i),l=vd(r,"z-index",i);if(!e&&!n&&!o&&!s&&!Bl(r))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(r));let h=new oi;return function(p){let m=!0;if(e){let f=e(p);f&&(m=!1),h.setFill(f)}if(n){let f=n(p);f&&(m=!1),h.setStroke(f)}if(o){let f=o(p);f&&(m=!1),h.setText(f)}if(s){let f=s(p);f&&(m=!1),h.setImage(f)}return l&&h.setZIndex(l(p)),m?null:h}}function HS(r,i,e){let n;if(i+"fill-pattern-src"in r?n=ffe(r,i+"fill-",e):n=S4(r,i+"fill-color",e),!n)return null;let o=new hi;return function(s){let l=n(s);return l==="none"?null:(o.setColor(l),o)}}function qS(r,i,e){let n=vd(r,i+"stroke-width",e),o=S4(r,i+"stroke-color",e);if(!n&&!o)return null;let s=yg(r,i+"stroke-line-cap",e),l=yg(r,i+"stroke-line-join",e),h=oq(r,i+"stroke-line-dash",e),p=vd(r,i+"stroke-line-dash-offset",e),m=vd(r,i+"stroke-miter-limit",e),f=new ui;return function(g){if(o){let y=o(g);if(y==="none")return null;f.setColor(y)}if(n&&f.setWidth(n(g)),s){let y=s(g);if(y!=="butt"&&y!=="round"&&y!=="square")throw new Error("Expected butt, round, or square line cap");f.setLineCap(y)}if(l){let y=l(g);if(y!=="bevel"&&y!=="round"&&y!=="miter")throw new Error("Expected bevel, round, or miter line join");f.setLineJoin(y)}return h&&f.setLineDash(h(g)),p&&f.setLineDashOffset(p(g)),m&&f.setMiterLimit(m(g)),f}}function ufe(r,i){let e="text-",n=yg(r,e+"value",i);if(!n)return null;let o=HS(r,e,i),s=HS(r,e+"background-",i),l=qS(r,e,i),h=qS(r,e+"background-",i),p=yg(r,e+"font",i),m=vd(r,e+"max-angle",i),f=vd(r,e+"offset-x",i),g=vd(r,e+"offset-y",i),y=YS(r,e+"overflow",i),_=yg(r,e+"placement",i),w=vd(r,e+"repeat",i),A=I5(r,e+"scale",i),k=YS(r,e+"rotate-with-view",i),R=vd(r,e+"rotation",i),q=yg(r,e+"align",i),X=yg(r,e+"justify",i),ie=yg(r,e+"baseline",i),ae=oq(r,e+"padding",i),be=E5(r,e+"declutter-mode"),me=new so({declutterMode:be});return function(fe){if(me.setText(n(fe)),o&&me.setFill(o(fe)),s&&me.setBackgroundFill(s(fe)),l&&me.setStroke(l(fe)),h&&me.setBackgroundStroke(h(fe)),p&&me.setFont(p(fe)),m&&me.setMaxAngle(m(fe)),f&&me.setOffsetX(f(fe)),g&&me.setOffsetY(g(fe)),y&&me.setOverflow(y(fe)),_){let ge=_(fe);if(ge!=="point"&&ge!=="line")throw new Error("Expected point or line for text-placement");me.setPlacement(ge)}if(w&&me.setRepeat(w(fe)),A&&me.setScale(A(fe)),k&&me.setRotateWithView(k(fe)),R&&me.setRotation(R(fe)),q){let ge=q(fe);if(ge!=="left"&&ge!=="center"&&ge!=="right"&&ge!=="end"&&ge!=="start")throw new Error("Expected left, right, center, start, or end for text-align");me.setTextAlign(ge)}if(X){let ge=X(fe);if(ge!=="left"&&ge!=="right"&&ge!=="center")throw new Error("Expected left, right, or center for text-justify");me.setJustify(ge)}if(ie){let ge=ie(fe);if(ge!=="bottom"&&ge!=="top"&&ge!=="middle"&&ge!=="alphabetic"&&ge!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");me.setTextBaseline(ge)}return ae&&me.setPadding(ae(fe)),me}}function dfe(r,i){return"icon-src"in r?hfe(r,i):"shape-points"in r?pfe(r,i):"circle-radius"in r?mfe(r,i):null}function hfe(r,i){let e="icon-",n=e+"src",o=aq(r[n],n),s=A5(r,e+"anchor",i),l=I5(r,e+"scale",i),h=vd(r,e+"opacity",i),p=A5(r,e+"displacement",i),m=vd(r,e+"rotation",i),f=YS(r,e+"rotate-with-view",i),g=iq(r,e+"anchor-origin"),y=rq(r,e+"anchor-x-units"),_=rq(r,e+"anchor-y-units"),w=vfe(r,e+"color"),A=_fe(r,e+"cross-origin"),k=yfe(r,e+"offset"),R=iq(r,e+"offset-origin"),q=M5(r,e+"width"),X=M5(r,e+"height"),ie=gfe(r,e+"size"),ae=E5(r,e+"declutter-mode"),be=new Bs({src:o,anchorOrigin:g,anchorXUnits:y,anchorYUnits:_,color:w,crossOrigin:A,offset:k,offsetOrigin:R,height:X,width:q,size:ie,declutterMode:ae});return function(me){return h&&be.setOpacity(h(me)),p&&be.setDisplacement(p(me)),m&&be.setRotation(m(me)),f&&be.setRotateWithView(f(me)),l&&be.setScale(l(me)),s&&be.setAnchor(s(me)),be}}function pfe(r,i){let e="shape-",n=e+"points",o=e+"radius",s=w4(r[n],n),l=w4(r[o],o),h=HS(r,e,i),p=qS(r,e,i),m=I5(r,e+"scale",i),f=A5(r,e+"displacement",i),g=vd(r,e+"rotation",i),y=YS(r,e+"rotate-with-view",i),_=M5(r,e+"radius2"),w=M5(r,e+"angle"),A=E5(r,e+"declutter-mode"),k=new ru({points:s,radius:l,radius2:_,angle:w,declutterMode:A});return function(R){return h&&k.setFill(h(R)),p&&k.setStroke(p(R)),f&&k.setDisplacement(f(R)),g&&k.setRotation(g(R)),y&&k.setRotateWithView(y(R)),m&&k.setScale(m(R)),k}}function mfe(r,i){let e="circle-",n=HS(r,e,i),o=qS(r,e,i),s=vd(r,e+"radius",i),l=I5(r,e+"scale",i),h=A5(r,e+"displacement",i),p=vd(r,e+"rotation",i),m=YS(r,e+"rotate-with-view",i),f=E5(r,e+"declutter-mode"),g=new an({radius:5,declutterMode:f});return function(y){return s&&g.setRadius(s(y)),n&&g.setFill(n(y)),o&&g.setStroke(o(y)),h&&g.setDisplacement(h(y)),p&&g.setRotation(p(y)),m&&g.setRotateWithView(m(y)),l&&g.setScale(l(y)),g}}function vd(r,i,e){if(!(i in r))return;let n=Zm(r[i],nr,e);return function(o){return w4(n(o),i)}}function yg(r,i,e){if(!(i in r))return null;let n=Zm(r[i],yd,e);return function(o){return aq(n(o),i)}}function ffe(r,i,e){let n=yg(r,i+"pattern-src",e),o=tq(r,i+"pattern-offset",e),s=tq(r,i+"pattern-size",e),l=S4(r,i+"color",e);return function(h){return{src:n(h),offset:o&&o(h),size:s&&s(h),color:l&&l(h)}}}function YS(r,i,e){if(!(i in r))return null;let n=Zm(r[i],ys,e);return function(o){let s=n(o);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${i}`);return s}}function S4(r,i,e){if(!(i in r))return null;let n=Zm(r[i],yl|yd,e);return function(o){return sq(n(o),i)}}function oq(r,i,e){if(!(i in r))return null;let n=Zm(r[i],Ym,e);return function(o){return ZS(n(o),i)}}function A5(r,i,e){if(!(i in r))return null;let n=Zm(r[i],Ym,e);return function(o){let s=ZS(n(o),i);if(s.length!==2)throw new Error(`Expected two numbers for ${i}`);return s}}function tq(r,i,e){if(!(i in r))return null;let n=Zm(r[i],Ym,e);return function(o){return lq(n(o),i)}}function I5(r,i,e){if(!(i in r))return null;let n=Zm(r[i],Ym|nr,e);return function(o){return bfe(n(o),i)}}function M5(r,i){let e=r[i];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${i}`);return e}}function gfe(r,i){let e=r[i];if(e!==void 0){if(typeof e=="number")return Wo(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${i}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${i}`);return e}}function _fe(r,i){let e=r[i];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${i}`);return e}}function iq(r,i){let e=r[i];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${i}`);return e}}function rq(r,i){let e=r[i];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${i}`);return e}}function yfe(r,i){let e=r[i];if(e!==void 0)return ZS(e,i)}function E5(r,i){let e=r[i];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${i}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${i}`);return e}}function vfe(r,i){let e=r[i];if(e!==void 0)return sq(e,i)}function ZS(r,i){if(!Array.isArray(r))throw new Error(`Expected an array for ${i}`);let e=r.length;for(let n=0;n<e;++n)if(typeof r[n]!="number")throw new Error(`Expected an array of numbers for ${i}`);return r}function aq(r,i){if(typeof r!="string")throw new Error(`Expected a string for ${i}`);return r}function w4(r,i){if(typeof r!="number")throw new Error(`Expected a number for ${i}`);return r}function sq(r,i){if(typeof r=="string")return r;let e=ZS(r,i),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${i}`);return e}function lq(r,i){let e=ZS(r,i);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${i}`);return e}function bfe(r,i){return typeof r=="number"?r:lq(r,i)}var cq={RENDER_ORDER:"renderOrder"},C4=class extends _g{constructor(i){i=i||{};let e=Object.assign({},i);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=i.declutter?String(i.declutter):void 0,this.renderBuffer_=i.renderBuffer!==void 0?i.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(i.style),this.updateWhileAnimating_=i.updateWhileAnimating!==void 0?i.updateWhileAnimating:!1,this.updateWhileInteracting_=i.updateWhileInteracting!==void 0?i.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(i){return super.getFeatures(i)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(cq.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(i,e){let n=this.getDeclutter();n in i.declutter||(i.declutter[n]=new uq.default(9)),this.getRenderer().renderDeclutter(i,e)}setRenderOrder(i){this.set(cq.RENDER_ORDER,i)}setStyle(i){this.style_=wfe(i),this.styleFunction_=i===null?void 0:Uz(this.style_),this.changed()}};function wfe(r){if(r===void 0)return zz;if(!r)return null;if(typeof r=="function"||r instanceof oi)return r;if(!Array.isArray(r))return x4([r]);if(r.length===0)return[];let i=r.length,e=r[0];if(e instanceof oi){let o=new Array(i);for(let s=0;s<i;++s){let l=r[s];if(!(l instanceof oi))throw new Error("Expected a list of style instances");o[s]=l}return o}if("style"in e){let o=new Array(i);for(let s=0;s<i;++s){let l=r[s];if(!("style"in l))throw new Error("Expected a list of rules with a style property");o[s]=l}return nq(o)}return x4(r)}var lb=C4;var XS={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},KS=[XS.FILL],Xm=[XS.STROKE],vg=[XS.BEGIN_PATH],A4=[XS.CLOSE_PATH],fr=XS;var M4=class{drawCustom(i,e,n,o,s){}drawGeometry(i){}setStyle(i){}drawCircle(i,e,n){}drawFeature(i,e,n){}drawGeometryCollection(i,e,n){}drawLineString(i,e,n){}drawMultiLineString(i,e,n){}drawMultiPoint(i,e,n){}drawMultiPolygon(i,e,n){}drawPoint(i,e,n){}drawPolygon(i,e,n){}drawText(i,e,n){}setFillStrokeStyle(i,e){}setImageStyle(i,e){}setTextStyle(i,e){}},T5=M4;var I4=class extends T5{constructor(i,e,n,o){super(),this.tolerance=i,this.maxExtent=e,this.pixelRatio=o,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(i){let e=this.pixelRatio;return e==1?i:i.map(function(n){return n*e})}appendFlatPointCoordinates(i,e){let n=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,s=this.coordinates,l=s.length;for(let h=0,p=i.length;h<p;h+=e)o[0]=i[h],o[1]=i[h+1],$d(n,o)&&(s[l++]=o[0],s[l++]=o[1]);return l}appendFlatLineCoordinates(i,e,n,o,s,l){let h=this.coordinates,p=h.length,m=this.getBufferedMaxExtent();l&&(e+=o);let f=i[e],g=i[e+1],y=this.tmpCoordinate_,_=!0,w,A,k;for(w=e+o;w<n;w+=o)y[0]=i[w],y[1]=i[w+1],k=eM(m,y),k!==A?(_&&(h[p++]=f,h[p++]=g,_=!1),h[p++]=y[0],h[p++]=y[1]):k===ml.INTERSECTING?(h[p++]=y[0],h[p++]=y[1],_=!1):_=!0,f=y[0],g=y[1],A=k;return(s&&_||w===e+o)&&(h[p++]=f,h[p++]=g),p}drawCustomCoordinates_(i,e,n,o,s){for(let l=0,h=n.length;l<h;++l){let p=n[l],m=this.appendFlatLineCoordinates(i,e,p,o,!1,!1);s.push(m),e=p}return e}drawCustom(i,e,n,o,s){this.beginGeometry(i,e,s);let l=i.getType(),h=i.getStride(),p=this.coordinates.length,m,f,g,y,_;switch(l){case"MultiPolygon":m=i.getOrientedFlatCoordinates(),y=[];let w=i.getEndss();_=0;for(let A=0,k=w.length;A<k;++A){let R=[];_=this.drawCustomCoordinates_(m,_,w[A],h,R),y.push(R)}this.instructions.push([fr.CUSTOM,p,y,i,n,dS,s]),this.hitDetectionInstructions.push([fr.CUSTOM,p,y,i,o||n,dS,s]);break;case"Polygon":case"MultiLineString":g=[],m=l=="Polygon"?i.getOrientedFlatCoordinates():i.getFlatCoordinates(),_=this.drawCustomCoordinates_(m,0,i.getEnds(),h,g),this.instructions.push([fr.CUSTOM,p,g,i,n,G0,s]),this.hitDetectionInstructions.push([fr.CUSTOM,p,g,i,o||n,G0,s]);break;case"LineString":case"Circle":m=i.getFlatCoordinates(),f=this.appendFlatLineCoordinates(m,0,m.length,h,!1,!1),this.instructions.push([fr.CUSTOM,p,f,i,n,dd,s]),this.hitDetectionInstructions.push([fr.CUSTOM,p,f,i,o||n,dd,s]);break;case"MultiPoint":m=i.getFlatCoordinates(),f=this.appendFlatPointCoordinates(m,h),f>p&&(this.instructions.push([fr.CUSTOM,p,f,i,n,dd,s]),this.hitDetectionInstructions.push([fr.CUSTOM,p,f,i,o||n,dd,s]));break;case"Point":m=i.getFlatCoordinates(),this.coordinates.push(m[0],m[1]),f=this.coordinates.length,this.instructions.push([fr.CUSTOM,p,f,i,n,void 0,s]),this.hitDetectionInstructions.push([fr.CUSTOM,p,f,i,o||n,void 0,s]);break;default:}this.endGeometry(e)}beginGeometry(i,e,n){this.beginGeometryInstruction1_=[fr.BEGIN_GEOMETRY,e,0,i,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[fr.BEGIN_GEOMETRY,e,0,i,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let i=this.hitDetectionInstructions;i.reverse();let e,n=i.length,o,s,l=-1;for(e=0;e<n;++e)o=i[e],s=o[0],s==fr.END_GEOMETRY?l=e:s==fr.BEGIN_GEOMETRY&&(o[2]=e,QU(this.hitDetectionInstructions,l,e),l=-1)}setFillStrokeStyle(i,e){let n=this.state;if(i){let o=i.getColor();n.fillPatternScale=o&&typeof o=="object"&&"src"in o?this.pixelRatio:1,n.fillStyle=pd(o||Ul)}else n.fillStyle=void 0;if(e){let o=e.getColor();n.strokeStyle=pd(o||rg);let s=e.getLineCap();n.lineCap=s!==void 0?s:Bm;let l=e.getLineDash();n.lineDash=l?l.slice():md;let h=e.getLineDashOffset();n.lineDashOffset=h||fd;let p=e.getLineJoin();n.lineJoin=p!==void 0?p:Gm;let m=e.getWidth();n.lineWidth=m!==void 0?m:og;let f=e.getMiterLimit();n.miterLimit=f!==void 0?f:ig,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0}createFill(i){let e=i.fillStyle,n=[fr.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(i.fillPatternScale),n}applyStroke(i){this.instructions.push(this.createStroke(i))}createStroke(i){return[fr.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth*this.pixelRatio,i.lineCap,i.lineJoin,i.miterLimit,this.applyPixelRatio(i.lineDash),i.lineDashOffset*this.pixelRatio]}updateFillStyle(i,e){let n=i.fillStyle;(typeof n!="string"||i.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,i)),i.currentFillStyle=n)}updateStrokeStyle(i,e){let n=i.strokeStyle,o=i.lineCap,s=i.lineDash,l=i.lineDashOffset,h=i.lineJoin,p=i.lineWidth,m=i.miterLimit;(i.currentStrokeStyle!=n||i.currentLineCap!=o||s!=i.currentLineDash&&!pc(i.currentLineDash,s)||i.currentLineDashOffset!=l||i.currentLineJoin!=h||i.currentLineWidth!=p||i.currentMiterLimit!=m)&&(n!==void 0&&e.call(this,i),i.currentStrokeStyle=n,i.currentLineCap=o,i.currentLineDash=s,i.currentLineDashOffset=l,i.currentLineJoin=h,i.currentLineWidth=p,i.currentMiterLimit=m)}endGeometry(i){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let e=[fr.END_GEOMETRY,i];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=tM(this.maxExtent),this.maxLineWidth>0)){let i=this.resolution*(this.maxLineWidth+1)/2;Gl(this.bufferedMaxExtent_,i,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},Km=I4;var E4=class extends Km{constructor(i,e,n,o){super(i,e,n,o),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(i,e,n){if(!this.image_||this.maxExtent&&!$d(this.maxExtent,i.getFlatCoordinates()))return;this.beginGeometry(i,e,n);let o=i.getFlatCoordinates(),s=i.getStride(),l=this.coordinates.length,h=this.appendFlatPointCoordinates(o,s);this.instructions.push([fr.DRAW_IMAGE,l,h,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([fr.DRAW_IMAGE,l,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(i,e,n){if(!this.image_)return;this.beginGeometry(i,e,n);let o=i.getFlatCoordinates(),s=[];for(let p=0,m=o.length;p<m;p+=i.getStride())(!this.maxExtent||$d(this.maxExtent,o.slice(p,p+2)))&&s.push(o[p],o[p+1]);let l=this.coordinates.length,h=this.appendFlatPointCoordinates(s,2);this.instructions.push([fr.DRAW_IMAGE,l,h,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([fr.DRAW_IMAGE,l,h,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(i,e){let n=i.getAnchor(),o=i.getSize(),s=i.getOrigin();this.imagePixelRatio_=i.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=i.getHitDetectionImage(),this.image_=i.getImage(this.pixelRatio),this.height_=o[1],this.opacity_=i.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=i.getRotateWithView(),this.rotation_=i.getRotation(),this.scale_=i.getScaleArray(),this.width_=o[0],this.declutterMode_=i.getDeclutterMode(),this.declutterImageWithText_=e}},dq=E4;var T4=class extends Km{constructor(i,e,n,o){super(i,e,n,o)}drawFlatCoordinates_(i,e,n,o){let s=this.coordinates.length,l=this.appendFlatLineCoordinates(i,e,n,o,!1,!1),h=[fr.MOVE_TO_LINE_TO,s,l];return this.instructions.push(h),this.hitDetectionInstructions.push(h),n}drawLineString(i,e,n){let o=this.state,s=o.strokeStyle,l=o.lineWidth;if(s===void 0||l===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(i,e,n),this.hitDetectionInstructions.push([fr.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,md,fd],vg);let h=i.getFlatCoordinates(),p=i.getStride();this.drawFlatCoordinates_(h,0,h.length,p),this.hitDetectionInstructions.push(Xm),this.endGeometry(e)}drawMultiLineString(i,e,n){let o=this.state,s=o.strokeStyle,l=o.lineWidth;if(s===void 0||l===void 0)return;this.updateStrokeStyle(o,this.applyStroke),this.beginGeometry(i,e,n),this.hitDetectionInstructions.push([fr.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,md,fd],vg);let h=i.getEnds(),p=i.getFlatCoordinates(),m=i.getStride(),f=0;for(let g=0,y=h.length;g<y;++g)f=this.drawFlatCoordinates_(p,f,h[g],m);this.hitDetectionInstructions.push(Xm),this.endGeometry(e)}finish(){let i=this.state;return i.lastStroke!=null&&i.lastStroke!=this.coordinates.length&&this.instructions.push(Xm),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(i){i.lastStroke!=null&&i.lastStroke!=this.coordinates.length&&(this.instructions.push(Xm),i.lastStroke=this.coordinates.length),i.lastStroke=0,super.applyStroke(i),this.instructions.push(vg)}},hq=T4;var F4=class extends Km{constructor(i,e,n,o){super(i,e,n,o)}drawFlatCoordinatess_(i,e,n,o){let s=this.state,l=s.fillStyle!==void 0,h=s.strokeStyle!==void 0,p=n.length;this.instructions.push(vg),this.hitDetectionInstructions.push(vg);for(let m=0;m<p;++m){let f=n[m],g=this.coordinates.length,y=this.appendFlatLineCoordinates(i,e,f,o,!0,!h),_=[fr.MOVE_TO_LINE_TO,g,y];this.instructions.push(_),this.hitDetectionInstructions.push(_),h&&(this.instructions.push(A4),this.hitDetectionInstructions.push(A4)),e=f}return l&&(this.instructions.push(KS),this.hitDetectionInstructions.push(KS)),h&&(this.instructions.push(Xm),this.hitDetectionInstructions.push(Xm)),e}drawCircle(i,e,n){let o=this.state,s=o.fillStyle,l=o.strokeStyle;if(s===void 0&&l===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(i,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_FILL_STYLE,Ul]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,md,fd]);let h=i.getFlatCoordinates(),p=i.getStride(),m=this.coordinates.length;this.appendFlatLineCoordinates(h,0,h.length,p,!1,!1);let f=[fr.CIRCLE,m];this.instructions.push(vg,f),this.hitDetectionInstructions.push(vg,f),o.fillStyle!==void 0&&(this.instructions.push(KS),this.hitDetectionInstructions.push(KS)),o.strokeStyle!==void 0&&(this.instructions.push(Xm),this.hitDetectionInstructions.push(Xm)),this.endGeometry(e)}drawPolygon(i,e,n){let o=this.state,s=o.fillStyle,l=o.strokeStyle;if(s===void 0&&l===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(i,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_FILL_STYLE,Ul]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,md,fd]);let h=i.getEnds(),p=i.getOrientedFlatCoordinates(),m=i.getStride();this.drawFlatCoordinatess_(p,0,h,m),this.endGeometry(e)}drawMultiPolygon(i,e,n){let o=this.state,s=o.fillStyle,l=o.strokeStyle;if(s===void 0&&l===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(i,e,n),o.fillStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_FILL_STYLE,Ul]),o.strokeStyle!==void 0&&this.hitDetectionInstructions.push([fr.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,md,fd]);let h=i.getEndss(),p=i.getOrientedFlatCoordinates(),m=i.getStride(),f=0;for(let g=0,y=h.length;g<y;++g)f=this.drawFlatCoordinatess_(p,f,h[g],m);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let i=this.tolerance;if(i!==0){let e=this.coordinates;for(let n=0,o=e.length;n<o;++n)e[n]=B0(e[n],i)}return super.finish()}setFillStrokeStyles_(){let i=this.state;i.fillStyle!==void 0&&this.updateFillStyle(i,this.createFill),i.strokeStyle!==void 0&&this.updateStrokeStyle(i,this.applyStroke)}},P4=F4;function pq(r,i,e,n,o){let s=[],l=e,h=0,p=i.slice(e,2);for(;h<r&&l+o<n;){let[m,f]=p.slice(-2),g=i[l+o],y=i[l+o+1],_=Math.sqrt((g-m)*(g-m)+(y-f)*(y-f));if(h+=_,h>=r){let w=(r-h+_)/_,A=Ic(m,g,w),k=Ic(f,y,w);p.push(A,k),s.push(p),p=[A,k],h==r&&(l+=o),h=0}else if(h<r)p.push(i[l+o],i[l+o+1]),l+=o;else{let w=_-h,A=Ic(m,g,w/_),k=Ic(f,y,w/_);p.push(A,k),s.push(p),p=[A,k],h=0,l+=o}}return h>0&&s.push(p),s}function mq(r,i,e,n,o){let s=e,l=e,h=0,p=0,m=e,f,g,y,_,w,A,k,R,q,X;for(g=e;g<n;g+=o){let ie=i[g],ae=i[g+1];w!==void 0&&(q=ie-w,X=ae-A,_=Math.sqrt(q*q+X*X),k!==void 0&&(p+=y,f=Math.acos((k*q+R*X)/(y*_)),f>r&&(p>h&&(h=p,s=m,l=g),p=0,m=g-o)),y=_,k=q,R=X),w=ie,A=ae}return p+=_,p>h?[m,g]:[s,l]}var QS={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},L4=class extends Km{constructor(i,e,n,o){super(i,e,n,o),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Ul]={fillStyle:Ul},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let i=super.finish();return i.textStates=this.textStates,i.fillStates=this.fillStates,i.strokeStates=this.strokeStates,i}drawText(i,e,n){let o=this.textFillState_,s=this.textStrokeState_,l=this.textState_;if(this.text_===""||!l||!o&&!s)return;let h=this.coordinates,p=h.length,m=i.getType(),f=null,g=i.getStride();if(l.placement==="line"&&(m=="LineString"||m=="MultiLineString"||m=="Polygon"||m=="MultiPolygon")){if(!On(this.maxExtent,i.getExtent()))return;let y;if(f=i.getFlatCoordinates(),m=="LineString")y=[f.length];else if(m=="MultiLineString")y=i.getEnds();else if(m=="Polygon")y=i.getEnds().slice(0,1);else if(m=="MultiPolygon"){let k=i.getEndss();y=[];for(let R=0,q=k.length;R<q;++R)y.push(k[R][0])}this.beginGeometry(i,e,n);let _=l.repeat,w=_?void 0:l.textAlign,A=0;for(let k=0,R=y.length;k<R;++k){let q;_?q=pq(_*this.resolution,f,A,y[k],g):q=[f.slice(A,y[k])];for(let X=0,ie=q.length;X<ie;++X){let ae=q[X],be=0,me=ae.length;if(w==null){let ge=mq(l.maxAngle,ae,0,ae.length,2);be=ge[0],me=ge[1]}for(let ge=be;ge<me;ge+=g)h.push(ae[ge],ae[ge+1]);let fe=h.length;A=y[k],this.drawChars_(p,fe),p=fe}}this.endGeometry(e)}else{let y=l.overflow?null:[];switch(m){case"Point":case"MultiPoint":f=i.getFlatCoordinates();break;case"LineString":f=i.getFlatMidpoint();break;case"Circle":f=i.getCenter();break;case"MultiLineString":f=i.getFlatMidpoints(),g=2;break;case"Polygon":f=i.getFlatInteriorPoint(),l.overflow||y.push(f[2]/this.resolution),g=3;break;case"MultiPolygon":let q=i.getFlatInteriorPoints();f=[];for(let X=0,ie=q.length;X<ie;X+=3)l.overflow||y.push(q[X+2]/this.resolution),f.push(q[X],q[X+1]);if(f.length===0)return;g=2;break;default:}let _=this.appendFlatPointCoordinates(f,g);if(_===p)return;if(y&&(_-p)/2!==f.length/g){let q=p/2;y=y.filter((X,ie)=>{let ae=h[(q+ie)*2]===f[ie*g]&&h[(q+ie)*2+1]===f[ie*g+1];return ae||--q,ae})}this.saveTextStates_(),(l.backgroundFill||l.backgroundStroke)&&(this.setFillStrokeStyle(l.backgroundFill,l.backgroundStroke),l.backgroundFill&&this.updateFillStyle(this.state,this.createFill),l.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(i,e,n);let w=l.padding;if(w!=ng&&(l.scale[0]<0||l.scale[1]<0)){let q=l.padding[0],X=l.padding[1],ie=l.padding[2],ae=l.padding[3];l.scale[0]<0&&(X=-X,ae=-ae),l.scale[1]<0&&(q=-q,ie=-ie),w=[q,X,ie,ae]}let A=this.pixelRatio;this.instructions.push([fr.DRAW_IMAGE,p,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,w==ng?ng:w.map(function(q){return q*A}),!!l.backgroundFill,!!l.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]);let k=1/A,R=this.state.fillStyle;l.backgroundFill&&(this.state.fillStyle=Ul,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([fr.DRAW_IMAGE,p,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[k,k],NaN,this.declutterMode_,this.declutterImageWithText_,w,!!l.backgroundFill,!!l.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Ul:this.fillKey_,this.textOffsetX_,this.textOffsetY_,y]),l.backgroundFill&&(this.state.fillStyle=R,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(e)}}saveTextStates_(){let i=this.textStrokeState_,e=this.textState_,n=this.textFillState_,o=this.strokeKey_;i&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:i.strokeStyle,lineCap:i.lineCap,lineDashOffset:i.lineDashOffset,lineWidth:i.lineWidth,lineJoin:i.lineJoin,miterLimit:i.miterLimit,lineDash:i.lineDash}));let s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||U0,justify:e.justify,textBaseline:e.textBaseline||Ay,scale:e.scale});let l=this.fillKey_;n&&(l in this.fillStates||(this.fillStates[l]={fillStyle:n.fillStyle}))}drawChars_(i,e){let n=this.textStrokeState_,o=this.textState_,s=this.strokeKey_,l=this.textKey_,h=this.fillKey_;this.saveTextStates_();let p=this.pixelRatio,m=QS[o.textBaseline],f=this.textOffsetY_*p,g=this.text_,y=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([fr.DRAW_CHARS,i,e,m,o.overflow,h,o.maxAngle,p,f,s,y*p,g,l,1,this.declutterMode_]),this.hitDetectionInstructions.push([fr.DRAW_CHARS,i,e,m,o.overflow,h&&Ul,o.maxAngle,p,f,s,y*p,g,l,1/p,this.declutterMode_])}setTextStyle(i,e){let n,o,s;if(!i)this.text_="";else{let l=i.getFill();l?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=pd(l.getColor()||Ul)):(o=null,this.textFillState_=o);let h=i.getStroke();if(!h)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);let w=h.getLineDash(),A=h.getLineDashOffset(),k=h.getWidth(),R=h.getMiterLimit();s.lineCap=h.getLineCap()||Bm,s.lineDash=w?w.slice():md,s.lineDashOffset=A===void 0?fd:A,s.lineJoin=h.getLineJoin()||Gm,s.lineWidth=k===void 0?og:k,s.miterLimit=R===void 0?ig:R,s.strokeStyle=pd(h.getColor()||rg)}n=this.textState_;let p=i.getFont()||AI;Rz(p);let m=i.getScaleArray();n.overflow=i.getOverflow(),n.font=p,n.maxAngle=i.getMaxAngle(),n.placement=i.getPlacement(),n.textAlign=i.getTextAlign(),n.repeat=i.getRepeat(),n.justify=i.getJustify(),n.textBaseline=i.getTextBaseline()||Ay,n.backgroundFill=i.getBackgroundFill(),n.backgroundStroke=i.getBackgroundStroke(),n.padding=i.getPadding()||ng,n.scale=m===void 0?[1,1]:m;let f=i.getOffsetX(),g=i.getOffsetY(),y=i.getRotateWithView(),_=i.getRotation();this.text_=i.getText()||"",this.textOffsetX_=f===void 0?0:f,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=y===void 0?!1:y,this.textRotation_=_===void 0?0:_,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:fi(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=o&&o.fillStyle?typeof o.fillStyle=="string"?o.fillStyle:"|"+fi(o.fillStyle):""}this.declutterMode_=i.getDeclutterMode(),this.declutterImageWithText_=e}},fq=L4;var xfe={Circle:P4,Default:Km,Image:dq,LineString:hq,Polygon:P4,Text:fq},k4=class{constructor(i,e,n,o){this.tolerance_=i,this.maxExtent_=e,this.pixelRatio_=o,this.resolution_=n,this.buildersByZIndex_={}}finish(){let i={};for(let e in this.buildersByZIndex_){i[e]=i[e]||{};let n=this.buildersByZIndex_[e];for(let o in n){let s=n[o].finish();i[e][o]=s}}return i}getBuilder(i,e){let n=i!==void 0?i.toString():"0",o=this.buildersByZIndex_[n];o===void 0&&(o={},this.buildersByZIndex_[n]=o);let s=o[e];if(s===void 0){let l=xfe[e];s=new l(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),o[e]=s}return s}},F5=k4;var O4=class extends tI{constructor(i){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=i,this.declutterExecutorGroup=null}getFeatures(i){return Ti()}getData(i){return null}prepareFrame(i){return Ti()}renderFrame(i,e){return Ti()}loadedTileCallback(i,e,n){i[e]||(i[e]={}),i[e][n.tileCoord.toString()]=n}createLoadedTileFinder(i,e,n){return(o,s)=>{let l=this.loadedTileCallback.bind(this,n,o);return i.forEachLoadedTile(e,o,s,l)}}forEachFeatureAtCoordinate(i,e,n,o,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(i){let e=i.target;(e.getState()===xi.LOADED||e.getState()===xi.ERROR)&&this.renderIfReadyAndVisible()}loadImage(i){let e=i.getState();return e!=xi.LOADED&&e!=xi.ERROR&&i.addEventListener(mi.CHANGE,this.boundHandleImageChange_),e==xi.IDLE&&(i.load(),e=i.getState()),e==xi.LOADED}renderIfReadyAndVisible(){let i=this.getLayer();i&&i.getVisible()&&i.getSourceState()==="ready"&&i.changed()}renderDeferred(i){}disposeInternal(){delete this.layer_,super.disposeInternal()}},gq=O4;var D4=class extends To{constructor(i,e,n,o){super(i),this.inversePixelTransform=e,this.frameState=n,this.context=o}},P5=D4;var R4=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(CanvasRenderingContext2D.prototype,{get:(i,e)=>{if(typeof xS()[e]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e),this.pushMethodArgs_},set:(i,e,n)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(e,n),!0)})}pushMethodArgs_=(...i)=>(this.instructions_[this.zIndex+this.offset_].push(i),this);getContext(){return this.context_}draw(i){this.instructions_.forEach(e=>{for(let n=0,o=e.length;n<o;n+=2){let s=e[n],l=e[n+1];if(typeof i[s]=="function")i[s](...l);else{if(typeof l=="function"){i[s]=l(i);continue}i[s]=l}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},cb=R4;var B4=[],ub=null;function Sfe(){ub=yo(1,1,void 0,{willReadFrequently:!0})}var N4=class extends gq{constructor(i){super(i),this.container=null,this.renderedResolution,this.tempTransform=el(),this.pixelTransform=el(),this.inversePixelTransform=el(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(i,e,n){ub||Sfe(),ub.clearRect(0,0,1,1);let o;try{ub.drawImage(i,e,n,1,1,0,0,1,1),o=ub.getImageData(0,0,1,1).data}catch{return ub=null,null}return o}getBackground(i){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(i.viewState.resolution)),n||void 0}useContainer(i,e,n){let o=this.getLayer().getClassName(),s,l;if(i&&i.className===o&&(!n||i&&i.style.backgroundColor&&pc(Ra(i.style.backgroundColor),Ra(n)))){let h=i.firstElementChild;h instanceof HTMLCanvasElement&&(l=h.getContext("2d"))}if(l&&l.canvas.style.transform===e?(this.container=i,this.context=l,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=o;let h=s.style;h.position="absolute",h.width="100%",h.height="100%",l=yo();let p=l.canvas;s.appendChild(p),h=p.style,h.position="absolute",h.left="0",h.transformOrigin="top left",this.container=s,this.context=l}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(i,e,n){let o=Mc(n),s=oy(n),l=ny(n),h=ry(n);$o(e.coordinateToPixelTransform,o),$o(e.coordinateToPixelTransform,s),$o(e.coordinateToPixelTransform,l),$o(e.coordinateToPixelTransform,h);let p=this.inversePixelTransform;$o(p,o),$o(p,s),$o(p,l),$o(p,h),i.save(),i.beginPath(),i.moveTo(Math.round(o[0]),Math.round(o[1])),i.lineTo(Math.round(s[0]),Math.round(s[1])),i.lineTo(Math.round(l[0]),Math.round(l[1])),i.lineTo(Math.round(h[0]),Math.round(h[1])),i.clip()}dispatchRenderEvent_(i,e,n){let o=this.getLayer();if(o.hasListener(i)){let s=new P5(i,this.inversePixelTransform,n,e);o.dispatchEvent(s)}}preRender(i,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Oc.PRERENDER,i,e)}postRender(i,e){e.declutter||this.dispatchRenderEvent_(Oc.POSTRENDER,i,e)}renderDeferredInternal(i){}getRenderContext(i){return i.declutter&&!this.deferredContext_&&(this.deferredContext_=new cb),i.declutter?this.deferredContext_.getContext():this.context}renderDeferred(i){i.declutter&&(this.dispatchRenderEvent_(Oc.PRERENDER,this.context,i),i.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(i),this.dispatchRenderEvent_(Oc.POSTRENDER,this.context,i))}getRenderTransform(i,e,n,o,s,l,h){let p=s/2,m=l/2,f=o/e,g=-f,y=-i[0]+h,_=-i[1];return Ns(this.tempTransform,p,m,f,g,-n,y,_)}disposeInternal(){delete this.frameState,super.disposeInternal()}},db=N4;function _q(r,i,e,n,o,s,l,h,p,m,f,g){let y=r[i],_=r[i+1],w=0,A=0,k=0,R=0;function q(){w=y,A=_,i+=n,y=r[i],_=r[i+1],R+=k,k=Math.sqrt((y-w)*(y-w)+(_-A)*(_-A))}do q();while(i<e-n&&R+k<s);let X=k===0?0:(s-R)/k,ie=Ic(w,y,X),ae=Ic(A,_,X),be=i-n,me=R,fe=s+h*p(m,o,f);for(;i<e-n&&R+k<fe;)q();X=k===0?0:(fe-R)/k;let ge=Ic(w,y,X),ue=Ic(A,_,X),se;if(g){let je=[ie,ae,ge,ue];Cv(je,0,4,2,g,je,je),se=je[0]>je[2]}else se=ie>ge;let te=Math.PI,Se=[],Te=be+n===i;i=be,k=0,R=me,y=r[i],_=r[i+1];let Ee;if(Te){q(),Ee=Math.atan2(_-A,y-w),se&&(Ee+=Ee>0?-te:te);let je=(ge+ie)/2,Ne=(ue+ae)/2;return Se[0]=[je,Ne,(fe-s)/2,Ee,o],Se}o=o.replace(/\n/g," ");for(let je=0,Ne=o.length;je<Ne;){q();let ze=Math.atan2(_-A,y-w);if(se&&(ze+=ze>0?-te:te),Ee!==void 0){let Le=ze-Ee;if(Le+=Le>te?-2*te:Le<-te?2*te:0,Math.abs(Le)>l)return null}Ee=ze;let Re=je,Ge=0;for(;je<Ne;++je){let Le=se?Ne-je-1:je,Ye=h*p(m,o[Le],f);if(i+n<e&&R+k<s+Ge+Ye/2)break;Ge+=Ye}if(je===Re)continue;let He=se?o.substring(Ne-Re,Ne-je):o.substring(Re,je);X=k===0?0:(s+Ge/2-R)/k;let ye=Ic(w,y,X),Ae=Ic(A,_,X);Se.push([ye,Ae,Ge/2,ze,He]),s+=Ge}return Se}var hb=Wn(),J0=[],bg=[],wg=[],e_=[];function yq(r){return r[3].declutterBox}var vq=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function G4(r,i){return i==="start"?i=vq.test(r)?"right":"left":i==="end"&&(i=vq.test(r)?"left":"right"),QS[i]}function Cfe(r,i,e){return e>0&&r.push(`
`,""),r.push(i,""),r}var j4=class{constructor(i,e,n,o,s){this.overlaps=n,this.pixelRatio=e,this.resolution=i,this.alignAndScaleFill_,this.instructions=o.instructions,this.coordinates=o.coordinates,this.coordinateCache_={},this.renderedTransform_=el(),this.hitDetectionInstructions=o.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=o.fillStates||{},this.strokeStates=o.strokeStates||{},this.textStates=o.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new cb:null}getZIndexContext(){return this.zIndexContext_}createLabel(i,e,n,o){let s=i+e+n+o;if(this.labels_[s])return this.labels_[s];let l=o?this.strokeStates[o]:null,h=n?this.fillStates[n]:null,p=this.textStates[e],m=this.pixelRatio,f=[p.scale[0]*m,p.scale[1]*m],g=Array.isArray(i),y=p.justify?QS[p.justify]:G4(Array.isArray(i)?i[0]:i,p.textAlign||U0),_=o&&l.lineWidth?l.lineWidth:0,w=g?i:i.split(`
`).reduce(Cfe,[]),{width:A,height:k,widths:R,heights:q,lineWidths:X}=Bz(p,w),ie=A+_,ae=[],be=(ie+2)*f[0],me=(k+_)*f[1],fe={width:be<0?Math.floor(be):Math.ceil(be),height:me<0?Math.floor(me):Math.ceil(me),contextInstructions:ae};(f[0]!=1||f[1]!=1)&&ae.push("scale",f),o&&(ae.push("strokeStyle",l.strokeStyle),ae.push("lineWidth",_),ae.push("lineCap",l.lineCap),ae.push("lineJoin",l.lineJoin),ae.push("miterLimit",l.miterLimit),ae.push("setLineDash",[l.lineDash]),ae.push("lineDashOffset",l.lineDashOffset)),n&&ae.push("fillStyle",h.fillStyle),ae.push("textBaseline","middle"),ae.push("textAlign","center");let ge=.5-y,ue=y*ie+ge*_,se=[],te=[],Se=0,Te=0,Ee=0,je=0,Ne;for(let ze=0,Re=w.length;ze<Re;ze+=2){let Ge=w[ze];if(Ge===`
`){Te+=Se,Se=0,ue=y*ie+ge*_,++je;continue}let He=w[ze+1]||p.font;He!==Ne&&(o&&se.push("font",He),n&&te.push("font",He),Ne=He),Se=Math.max(Se,q[Ee]);let ye=[Ge,ue+ge*R[Ee]+y*(R[Ee]-X[je]),.5*(_+Se)+Te];ue+=R[Ee],o&&se.push("strokeText",ye),n&&te.push("fillText",ye),++Ee}return Array.prototype.push.apply(ae,se),Array.prototype.push.apply(ae,te),this.labels_[s]=fe,fe}replayTextBackground_(i,e,n,o,s,l,h){i.beginPath(),i.moveTo.apply(i,e),i.lineTo.apply(i,n),i.lineTo.apply(i,o),i.lineTo.apply(i,s),i.lineTo.apply(i,e),l&&(this.alignAndScaleFill_=l[2],this.fill_(i)),h&&(this.setStrokeStyle_(i,h),i.stroke())}calculateImageOrLabelDimensions_(i,e,n,o,s,l,h,p,m,f,g,y,_,w,A,k){h*=y[0],p*=y[1];let R=n-h,q=o-p,X=s+m>i?i-m:s,ie=l+f>e?e-f:l,ae=w[3]+X*y[0]+w[1],be=w[0]+ie*y[1]+w[2],me=R-w[3],fe=q-w[0];(A||g!==0)&&(J0[0]=me,e_[0]=me,J0[1]=fe,bg[1]=fe,bg[0]=me+ae,wg[0]=bg[0],wg[1]=fe+be,e_[1]=wg[1]);let ge;return g!==0?(ge=Ns(el(),n,o,1,1,g,-n,-o),$o(ge,J0),$o(ge,bg),$o(ge,wg),$o(ge,e_),jl(Math.min(J0[0],bg[0],wg[0],e_[0]),Math.min(J0[1],bg[1],wg[1],e_[1]),Math.max(J0[0],bg[0],wg[0],e_[0]),Math.max(J0[1],bg[1],wg[1],e_[1]),hb)):jl(Math.min(me,me+ae),Math.min(fe,fe+be),Math.max(me,me+ae),Math.max(fe,fe+be),hb),_&&(R=Math.round(R),q=Math.round(q)),{drawImageX:R,drawImageY:q,drawImageW:X,drawImageH:ie,originX:m,originY:f,declutterBox:{minX:hb[0],minY:hb[1],maxX:hb[2],maxY:hb[3],value:k},canvasTransform:ge,scale:y}}replayImageOrLabel_(i,e,n,o,s,l,h){let p=!!(l||h),m=o.declutterBox,f=h?h[2]*o.scale[0]/2:0;return m.minX-f<=e[0]&&m.maxX+f>=0&&m.minY-f<=e[1]&&m.maxY+f>=0&&(p&&this.replayTextBackground_(i,J0,bg,wg,e_,l,h),Gz(i,o.canvasTransform,s,n,o.originX,o.originY,o.drawImageW,o.drawImageH,o.drawImageX,o.drawImageY,o.scale)),!0}fill_(i){let e=this.alignAndScaleFill_;if(e){let n=$o(this.renderedTransform_,[0,0]),o=512*this.pixelRatio;i.save(),i.translate(n[0]%o,n[1]%o),e!==1&&i.scale(e,e),i.rotate(this.viewRotation_)}i.fill(),e&&i.restore()}setStrokeStyle_(i,e){i.strokeStyle=e[1],i.lineWidth=e[2],i.lineCap=e[3],i.lineJoin=e[4],i.miterLimit=e[5],i.lineDashOffset=e[7],i.setLineDash(e[6])}drawLabelWithPointPlacement_(i,e,n,o){let s=this.textStates[e],l=this.createLabel(i,e,o,n),h=this.strokeStates[n],p=this.pixelRatio,m=G4(Array.isArray(i)?i[0]:i,s.textAlign||U0),f=QS[s.textBaseline||Ay],g=h&&h.lineWidth?h.lineWidth:0,y=l.width/p-2*s.scale[0],_=m*y+2*(.5-m)*g,w=f*l.height/p+2*(.5-f)*g;return{label:l,anchorX:_,anchorY:w}}execute_(i,e,n,o,s,l,h,p){let m=this.zIndexContext_,f;this.pixelCoordinates_&&pc(n,this.renderedTransform_)?f=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),f=ud(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),iz(this.renderedTransform_,n));let g=0,y=o.length,_=0,w,A,k,R,q,X,ie,ae,be,me,fe,ge,ue,se=0,te=0,Se=null,Te=null,Ee=this.coordinateCache_,je=this.viewRotation_,Ne=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,ze={context:i,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:je},Re=this.instructions!=o||this.overlaps?0:200,Ge,He,ye,Ae;for(;g<y;){let Le=o[g];switch(Le[0]){case fr.BEGIN_GEOMETRY:Ge=Le[1],Ae=Le[3],Ge.getGeometry()?h!==void 0&&!On(h,Ae.getExtent())?g=Le[2]+1:++g:g=Le[2],m&&(m.zIndex=Le[4]);break;case fr.BEGIN_PATH:se>Re&&(this.fill_(i),se=0),te>Re&&(i.stroke(),te=0),!se&&!te&&(i.beginPath(),q=NaN,X=NaN),++g;break;case fr.CIRCLE:_=Le[1];let qe=f[_],et=f[_+1],ft=f[_+2],mt=f[_+3],At=ft-qe,ht=mt-et,he=Math.sqrt(At*At+ht*ht);i.moveTo(qe+he,et),i.arc(qe,et,he,0,2*Math.PI,!0),++g;break;case fr.CLOSE_PATH:i.closePath(),++g;break;case fr.CUSTOM:_=Le[1],w=Le[2];let st=Le[3],Je=Le[4],de=Le[5];ze.geometry=st,ze.feature=Ge,g in Ee||(Ee[g]=[]);let ke=Ee[g];de?de(f,_,w,2,ke):(ke[0]=f[_],ke[1]=f[_+1],ke.length=2),m&&(m.zIndex=Le[6]),Je(ke,ze),++g;break;case fr.DRAW_IMAGE:_=Le[1],w=Le[2],be=Le[3],A=Le[4],k=Le[5];let Ze=Le[6],vt=Le[7],tt=Le[8],ot=Le[9],wt=Le[10],Mt=Le[11],St=Le[12],ei=Le[13];R=Le[14]||"declutter";let Jt=Le[15];if(!be&&Le.length>=20){me=Le[19],fe=Le[20],ge=Le[21],ue=Le[22];let mo=this.drawLabelWithPointPlacement_(me,fe,ge,ue);be=mo.label,Le[3]=be;let Al=Le[23];A=(mo.anchorX-Al)*this.pixelRatio,Le[4]=A;let ps=Le[24];k=(mo.anchorY-ps)*this.pixelRatio,Le[5]=k,Ze=be.height,Le[6]=Ze,ei=be.width,Le[13]=ei}let Ut;Le.length>25&&(Ut=Le[25]);let pi,yi,Kt;Le.length>17?(pi=Le[16],yi=Le[17],Kt=Le[18]):(pi=ng,yi=!1,Kt=!1),wt&&Ne?Mt+=je:!wt&&!Ne&&(Mt-=je);let li=0;for(;_<w;_+=2){if(Ut&&Ut[li++]<ei/this.pixelRatio)continue;let mo=this.calculateImageOrLabelDimensions_(be.width,be.height,f[_],f[_+1],ei,Ze,A,k,tt,ot,Mt,St,s,pi,yi||Kt,Ge),Al=[i,e,be,mo,vt,yi?Se:null,Kt?Te:null];if(p){let ps,zi,Cs;if(Jt){let Un=w-_;if(!Jt[Un]){Jt[Un]={args:Al,declutterMode:R};continue}let Pn=Jt[Un];ps=Pn.args,zi=Pn.declutterMode,delete Jt[Un],Cs=yq(ps)}let Ml,As;if(ps&&(zi!=="declutter"||!p.collides(Cs))&&(Ml=!0),(R!=="declutter"||!p.collides(mo.declutterBox))&&(As=!0),zi==="declutter"&&R==="declutter"){let Un=Ml&&As;Ml=Un,As=Un}Ml&&(zi!=="none"&&p.insert(Cs),this.replayImageOrLabel_.apply(this,ps)),As&&(R!=="none"&&p.insert(mo.declutterBox),this.replayImageOrLabel_.apply(this,Al))}else this.replayImageOrLabel_.apply(this,Al)}++g;break;case fr.DRAW_CHARS:let Ft=Le[1],Nr=Le[2],Qi=Le[3],ji=Le[4];ue=Le[5];let cr=Le[6],Yr=Le[7],Ci=Le[8];ge=Le[9];let pr=Le[10];me=Le[11],fe=Le[12];let Ai=[Le[13],Le[13]];R=Le[14]||"declutter";let Pi=this.textStates[fe],er=Pi.font,xr=[Pi.scale[0]*Yr,Pi.scale[1]*Yr],tr;er in this.widths_?tr=this.widths_[er]:(tr={},this.widths_[er]=tr);let Vn=cI(f,Ft,Nr,2),Vu=Math.abs(xr[0])*Vk(er,me,tr);if(ji||Vu<=Vn){let mo=this.textStates[fe].textAlign,Al=(Vn-Vu)*G4(me,mo),ps=_q(f,Ft,Nr,2,me,Al,cr,Math.abs(xr[0]),Vk,er,tr,Ne?0:this.viewRotation_);e:if(ps){let zi=[],Cs,Ml,As,Un,Pn;if(ge)for(Cs=0,Ml=ps.length;Cs<Ml;++Cs){Pn=ps[Cs],As=Pn[4],Un=this.createLabel(As,fe,"",ge),A=Pn[2]+(xr[0]<0?-pr:pr),k=Qi*Un.height+(.5-Qi)*2*pr*xr[1]/xr[0]-Ci;let Go=this.calculateImageOrLabelDimensions_(Un.width,Un.height,Pn[0],Pn[1],Un.width,Un.height,A,k,0,0,Pn[3],Ai,!1,ng,!1,Ge);if(p&&R==="declutter"&&p.collides(Go.declutterBox))break e;zi.push([i,e,Un,Go,1,null,null])}if(ue)for(Cs=0,Ml=ps.length;Cs<Ml;++Cs){Pn=ps[Cs],As=Pn[4],Un=this.createLabel(As,fe,ue,""),A=Pn[2],k=Qi*Un.height-Ci;let Go=this.calculateImageOrLabelDimensions_(Un.width,Un.height,Pn[0],Pn[1],Un.width,Un.height,A,k,0,0,Pn[3],Ai,!1,ng,!1,Ge);if(p&&R==="declutter"&&p.collides(Go.declutterBox))break e;zi.push([i,e,Un,Go,1,null,null])}p&&R!=="none"&&p.load(zi.map(yq));for(let Go=0,Il=zi.length;Go<Il;++Go)this.replayImageOrLabel_.apply(this,zi[Go])}}++g;break;case fr.END_GEOMETRY:if(l!==void 0){Ge=Le[1];let mo=l(Ge,Ae);if(mo)return mo}++g;break;case fr.FILL:Re?se++:this.fill_(i),++g;break;case fr.MOVE_TO_LINE_TO:for(_=Le[1],w=Le[2],He=f[_],ye=f[_+1],ie=He+.5|0,ae=ye+.5|0,(ie!==q||ae!==X)&&(i.moveTo(He,ye),q=ie,X=ae),_+=2;_<w;_+=2)He=f[_],ye=f[_+1],ie=He+.5|0,ae=ye+.5|0,(_==w-2||ie!==q||ae!==X)&&(i.lineTo(He,ye),q=ie,X=ae);++g;break;case fr.SET_FILL_STYLE:Se=Le,this.alignAndScaleFill_=Le[2],se&&(this.fill_(i),se=0,te&&(i.stroke(),te=0)),i.fillStyle=Le[1],++g;break;case fr.SET_STROKE_STYLE:Te=Le,te&&(i.stroke(),te=0),this.setStrokeStyle_(i,Le),++g;break;case fr.STROKE:Re?te++:i.stroke(),++g;break;default:++g;break}}se&&this.fill_(i),te&&i.stroke()}execute(i,e,n,o,s,l){this.viewRotation_=o,this.execute_(i,e,n,this.instructions,s,void 0,void 0,l)}executeHitDetection(i,e,n,o,s){return this.viewRotation_=n,this.execute_(i,[i.canvas.width,i.canvas.height],e,this.hitDetectionInstructions,!0,o,s)}},bq=j4;var pb=["Polygon","Circle","LineString","Image","Text","Default"],mb=["Image","Text"],wq=pb.filter(r=>!mb.includes(r)),U4=class{constructor(i,e,n,o,s,l,h){this.maxExtent_=i,this.overlaps_=o,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=l,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=el(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,h)}clip(i,e){let n=this.getClipCoords(e);i.beginPath(),i.moveTo(n[0],n[1]),i.lineTo(n[2],n[3]),i.lineTo(n[4],n[5]),i.lineTo(n[6],n[7]),i.clip()}createExecutors_(i,e){for(let n in i){let o=this.executorsByZIndex_[n];o===void 0&&(o={},this.executorsByZIndex_[n]=o);let s=i[n];for(let l in s){let h=s[l];o[l]=new bq(this.resolution_,this.pixelRatio_,this.overlaps_,h,e)}}}hasExecutors(i){for(let e in this.executorsByZIndex_){let n=this.executorsByZIndex_[e];for(let o=0,s=i.length;o<s;++o)if(i[o]in n)return!0}return!1}forEachFeatureAtCoordinate(i,e,n,o,s,l){o=Math.round(o);let h=o*2+1,p=Ns(this.hitDetectionTransform_,o+.5,o+.5,1/e,-1/e,-n,-i[0],-i[1]),m=!this.hitDetectionContext_;m&&(this.hitDetectionContext_=yo(h,h,void 0,{willReadFrequently:!0}));let f=this.hitDetectionContext_;f.canvas.width!==h||f.canvas.height!==h?(f.canvas.width=h,f.canvas.height=h):m||f.clearRect(0,0,h,h);let g;this.renderBuffer_!==void 0&&(g=Wn(),iy(g,i),Gl(g,e*(this.renderBuffer_+o),g));let y=Afe(o),_;function w(ae,be){let me=f.getImageData(0,0,h,h).data;for(let fe=0,ge=y.length;fe<ge;fe++)if(me[y[fe]]>0){if(!l||_!=="Image"&&_!=="Text"||l.includes(ae)){let ue=(y[fe]-3)/4,se=o-ue%h,te=o-(ue/h|0),Se=s(ae,be,se*se+te*te);if(Se)return Se}f.clearRect(0,0,h,h);break}}let A=Object.keys(this.executorsByZIndex_).map(Number);A.sort(iu);let k,R,q,X,ie;for(k=A.length-1;k>=0;--k){let ae=A[k].toString();for(q=this.executorsByZIndex_[ae],R=pb.length-1;R>=0;--R)if(_=pb[R],X=q[_],X!==void 0&&(ie=X.executeHitDetection(f,p,n,w,g),ie))return ie}}getClipCoords(i){let e=this.maxExtent_;if(!e)return null;let n=e[0],o=e[1],s=e[2],l=e[3],h=[n,o,n,l,s,l,s,o];return ud(h,0,8,2,i,h),h}isEmpty(){return Bl(this.executorsByZIndex_)}execute(i,e,n,o,s,l,h){let p=Object.keys(this.executorsByZIndex_).map(Number);p.sort(iu),l=l||pb;let m,f,g,y,_,w;for(h&&p.reverse(),m=0,f=p.length;m<f;++m){let A=p[m].toString();for(_=this.executorsByZIndex_[A],g=0,y=l.length;g<y;++g){let k=l[g];if(w=_[k],w!==void 0){let R=h===null?void 0:w.getZIndexContext(),q=R?R.getContext():i,X=this.maxExtent_&&k!=="Image"&&k!=="Text";if(X&&(q.save(),this.clip(q,n)),w.execute(q,e,n,o,s,h),X&&q.restore(),R){R.offset();let ie=p[m];this.deferredZIndexContexts_[ie]||(this.deferredZIndexContexts_[ie]=[]),this.deferredZIndexContexts_[ie].push(R)}}}}this.renderedContext_=i}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let i=this.deferredZIndexContexts_,e=Object.keys(i).map(Number).sort(iu);for(let n=0,o=e.length;n<o;++n)i[e[n]].forEach(s=>{s.draw(this.renderedContext_),s.clear()})}},V4={};function Afe(r){if(V4[r]!==void 0)return V4[r];let i=r*2+1,e=r*r,n=new Array(e+1);for(let s=0;s<=r;++s)for(let l=0;l<=r;++l){let h=s*s+l*l;if(h>e)break;let p=n[h];p||(p=[],n[h]=p),p.push(((r+s)*i+(r+l))*4+3),s>0&&p.push(((r-s)*i+(r+l))*4+3),l>0&&(p.push(((r+s)*i+(r-l))*4+3),s>0&&p.push(((r-s)*i+(r-l))*4+3))}let o=[];for(let s=0,l=n.length;s<l;++s)n[s]&&o.push(...n[s]);return V4[r]=o,o}var L5=U4;var z4=class extends T5{constructor(i,e,n,o,s,l,h){super(),this.context_=i,this.pixelRatio_=e,this.extent_=n,this.transform_=o,this.transformRotation_=o?ay(Math.atan2(o[1],o[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=l,this.userTransform_=h,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=el()}drawImages_(i,e,n,o){if(!this.image_)return;let s=ud(i,e,n,o,this.transform_,this.pixelCoordinates_),l=this.context_,h=this.tmpLocalTransform_,p=l.globalAlpha;this.imageOpacity_!=1&&(l.globalAlpha=p*this.imageOpacity_);let m=this.imageRotation_;this.transformRotation_===0&&(m-=this.viewRotation_),this.imageRotateWithView_&&(m+=this.viewRotation_);for(let f=0,g=s.length;f<g;f+=2){let y=s[f]-this.imageAnchorX_,_=s[f+1]-this.imageAnchorY_;if(m!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){let w=y+this.imageAnchorX_,A=_+this.imageAnchorY_;Ns(h,w,A,1,1,m,-w,-A),l.save(),l.transform.apply(l,h),l.translate(w,A),l.scale(this.imageScale_[0],this.imageScale_[1]),l.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),l.restore()}else l.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,y,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(l.globalAlpha=p)}drawText_(i,e,n,o){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);let s=ud(i,e,n,o,this.transform_,this.pixelCoordinates_),l=this.context_,h=this.textRotation_;for(this.transformRotation_===0&&(h-=this.viewRotation_),this.textRotateWithView_&&(h+=this.viewRotation_);e<n;e+=o){let p=s[e]+this.textOffsetX_,m=s[e+1]+this.textOffsetY_;h!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(l.save(),l.translate(p-this.textOffsetX_,m-this.textOffsetY_),l.rotate(h),l.translate(this.textOffsetX_,this.textOffsetY_),l.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&l.strokeText(this.text_,0,0),this.textFillState_&&l.fillText(this.text_,0,0),l.restore()):(this.textStrokeState_&&l.strokeText(this.text_,p,m),this.textFillState_&&l.fillText(this.text_,p,m))}}moveToLineTo_(i,e,n,o,s){let l=this.context_,h=ud(i,e,n,o,this.transform_,this.pixelCoordinates_);l.moveTo(h[0],h[1]);let p=h.length;s&&(p-=2);for(let m=2;m<p;m+=2)l.lineTo(h[m],h[m+1]);return s&&l.closePath(),n}drawRings_(i,e,n,o){for(let s=0,l=n.length;s<l;++s)e=this.moveToLineTo_(i,e,n[s],o,!0);return e}drawCircle(i){if(this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!On(this.extent_,i.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=sz(i,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],o=e[3]-e[1],s=Math.sqrt(n*n+o*o),l=this.context_;l.beginPath(),l.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&l.fill(),this.strokeState_&&l.stroke()}this.text_!==""&&this.drawText_(i.getCenter(),0,2,2)}}setStyle(i){this.setFillStrokeStyle(i.getFill(),i.getStroke()),this.setImageStyle(i.getImage()),this.setTextStyle(i.getText())}setTransform(i){this.transform_=i}drawGeometry(i){switch(i.getType()){case"Point":this.drawPoint(i);break;case"LineString":this.drawLineString(i);break;case"Polygon":this.drawPolygon(i);break;case"MultiPoint":this.drawMultiPoint(i);break;case"MultiLineString":this.drawMultiLineString(i);break;case"MultiPolygon":this.drawMultiPolygon(i);break;case"GeometryCollection":this.drawGeometryCollection(i);break;case"Circle":this.drawCircle(i);break;default:}}drawFeature(i,e){let n=e.getGeometryFunction()(i);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(i){let e=i.getGeometriesArray();for(let n=0,o=e.length;n<o;++n)this.drawGeometry(e[n])}drawPoint(i){this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=i.getFlatCoordinates(),n=i.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(i){this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=i.getFlatCoordinates(),n=i.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(i){if(this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!On(this.extent_,i.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let e=this.context_,n=i.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,i.getStride(),!1),e.stroke()}if(this.text_!==""){let e=i.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(i){this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_));let e=i.getExtent();if(On(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);let n=this.context_,o=i.getFlatCoordinates(),s=0,l=i.getEnds(),h=i.getStride();n.beginPath();for(let p=0,m=l.length;p<m;++p)s=this.moveToLineTo_(o,s,l[p],h,!1);n.stroke()}if(this.text_!==""){let n=i.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(i){if(this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!On(this.extent_,i.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_;e.beginPath(),this.drawRings_(i.getOrientedFlatCoordinates(),0,i.getEnds(),i.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=i.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(i){if(this.squaredTolerance_&&(i=i.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!On(this.extent_,i.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);let e=this.context_,n=i.getOrientedFlatCoordinates(),o=0,s=i.getEndss(),l=i.getStride();e.beginPath();for(let h=0,p=s.length;h<p;++h){let m=s[h];o=this.drawRings_(n,o,m,l)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){let e=i.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(i){let e=this.context_,n=this.contextFillState_;n?n.fillStyle!=i.fillStyle&&(n.fillStyle=i.fillStyle,e.fillStyle=i.fillStyle):(e.fillStyle=i.fillStyle,this.contextFillState_={fillStyle:i.fillStyle})}setContextStrokeState_(i){let e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=i.lineCap&&(n.lineCap=i.lineCap,e.lineCap=i.lineCap),pc(n.lineDash,i.lineDash)||e.setLineDash(n.lineDash=i.lineDash),n.lineDashOffset!=i.lineDashOffset&&(n.lineDashOffset=i.lineDashOffset,e.lineDashOffset=i.lineDashOffset),n.lineJoin!=i.lineJoin&&(n.lineJoin=i.lineJoin,e.lineJoin=i.lineJoin),n.lineWidth!=i.lineWidth&&(n.lineWidth=i.lineWidth,e.lineWidth=i.lineWidth),n.miterLimit!=i.miterLimit&&(n.miterLimit=i.miterLimit,e.miterLimit=i.miterLimit),n.strokeStyle!=i.strokeStyle&&(n.strokeStyle=i.strokeStyle,e.strokeStyle=i.strokeStyle)):(e.lineCap=i.lineCap,e.setLineDash(i.lineDash),e.lineDashOffset=i.lineDashOffset,e.lineJoin=i.lineJoin,e.lineWidth=i.lineWidth,e.miterLimit=i.miterLimit,e.strokeStyle=i.strokeStyle,this.contextStrokeState_={lineCap:i.lineCap,lineDash:i.lineDash,lineDashOffset:i.lineDashOffset,lineJoin:i.lineJoin,lineWidth:i.lineWidth,miterLimit:i.miterLimit,strokeStyle:i.strokeStyle})}setContextTextState_(i){let e=this.context_,n=this.contextTextState_,o=i.textAlign?i.textAlign:U0;n?(n.font!=i.font&&(n.font=i.font,e.font=i.font),n.textAlign!=o&&(n.textAlign=o,e.textAlign=o),n.textBaseline!=i.textBaseline&&(n.textBaseline=i.textBaseline,e.textBaseline=i.textBaseline)):(e.font=i.font,e.textAlign=o,e.textBaseline=i.textBaseline,this.contextTextState_={font:i.font,textAlign:o,textBaseline:i.textBaseline})}setFillStrokeStyle(i,e){if(!i)this.fillState_=null;else{let n=i.getColor();this.fillState_={fillStyle:pd(n||Ul)}}if(!e)this.strokeState_=null;else{let n=e.getColor(),o=e.getLineCap(),s=e.getLineDash(),l=e.getLineDashOffset(),h=e.getLineJoin(),p=e.getWidth(),m=e.getMiterLimit(),f=s||md;this.strokeState_={lineCap:o!==void 0?o:Bm,lineDash:this.pixelRatio_===1?f:f.map(g=>g*this.pixelRatio_),lineDashOffset:(l||fd)*this.pixelRatio_,lineJoin:h!==void 0?h:Gm,lineWidth:(p!==void 0?p:og)*this.pixelRatio_,miterLimit:m!==void 0?m:ig,strokeStyle:pd(n||rg)}}}setImageStyle(i){let e;if(!i||!(e=i.getSize())){this.image_=null;return}let n=i.getPixelRatio(this.pixelRatio_),o=i.getAnchor(),s=i.getOrigin();this.image_=i.getImage(this.pixelRatio_),this.imageAnchorX_=o[0]*n,this.imageAnchorY_=o[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=i.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=i.getRotateWithView(),this.imageRotation_=i.getRotation();let l=i.getScaleArray();this.imageScale_=[l[0]*this.pixelRatio_/n,l[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(i){if(!i)this.text_="";else{let e=i.getFill();if(!e)this.textFillState_=null;else{let _=e.getColor();this.textFillState_={fillStyle:pd(_||Ul)}}let n=i.getStroke();if(!n)this.textStrokeState_=null;else{let _=n.getColor(),w=n.getLineCap(),A=n.getLineDash(),k=n.getLineDashOffset(),R=n.getLineJoin(),q=n.getWidth(),X=n.getMiterLimit();this.textStrokeState_={lineCap:w!==void 0?w:Bm,lineDash:A||md,lineDashOffset:k||fd,lineJoin:R!==void 0?R:Gm,lineWidth:q!==void 0?q:og,miterLimit:X!==void 0?X:ig,strokeStyle:pd(_||rg)}}let o=i.getFont(),s=i.getOffsetX(),l=i.getOffsetY(),h=i.getRotateWithView(),p=i.getRotation(),m=i.getScaleArray(),f=i.getText(),g=i.getTextAlign(),y=i.getTextBaseline();this.textState_={font:o!==void 0?o:AI,textAlign:g!==void 0?g:U0,textBaseline:y!==void 0?y:Ay},this.text_=f!==void 0?Array.isArray(f)?f.reduce((_,w,A)=>_+=A%2?" ":w,""):f:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=l!==void 0?this.pixelRatio_*l:0,this.textRotateWithView_=h!==void 0?h:!1,this.textRotation_=p!==void 0?p:0,this.textScale_=[this.pixelRatio_*m[0],this.pixelRatio_*m[1]]}}},k5=z4;var Lu=.5;function O5(r,i,e,n,o,s,l,h,p){let m=p?Am(o,p):o,f=r[0]*Lu,g=r[1]*Lu,y=yo(f,g);y.imageSmoothingEnabled=!1;let _=y.canvas,w=new k5(y,Lu,o,null,l,h,p?vp(fl(),p):null),A=e.length,k=Math.floor((256*256*256-1)/A),R={};for(let X=1;X<=A;++X){let ie=e[X-1],ae=ie.getStyleFunction()||n;if(!ae)continue;let be=ae(ie,s);if(!be)continue;Array.isArray(be)||(be=[be]);let fe=(X*k).toString(16).padStart(7,"#00000");for(let ge=0,ue=be.length;ge<ue;++ge){let se=be[ge],te=se.getGeometryFunction()(ie);if(!te||!On(m,te.getExtent()))continue;let Se=se.clone(),Te=Se.getFill();Te&&Te.setColor(fe);let Ee=Se.getStroke();Ee&&(Ee.setColor(fe),Ee.setLineDash(null)),Se.setText(void 0);let je=se.getImage();if(je){let Ge=je.getImageSize();if(!Ge)continue;let He=yo(Ge[0],Ge[1],void 0,{alpha:!1}),ye=He.canvas;He.fillStyle=fe,He.fillRect(0,0,ye.width,ye.height),Se.setImage(new Bs({img:ye,anchor:je.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:je.getOrigin(),opacity:1,size:je.getSize(),scale:je.getScale(),rotation:je.getRotation(),rotateWithView:je.getRotateWithView()}))}let Ne=Se.getZIndex()||0,ze=R[Ne];ze||(ze={},R[Ne]=ze,ze.Polygon=[],ze.Circle=[],ze.LineString=[],ze.Point=[]);let Re=te.getType();if(Re==="GeometryCollection"){let Ge=te.getGeometriesArrayRecursive();for(let He=0,ye=Ge.length;He<ye;++He){let Ae=Ge[He];ze[Ae.getType().replace("Multi","")].push(Ae,Se)}}else ze[Re.replace("Multi","")].push(te,Se)}}let q=Object.keys(R).map(Number).sort(iu);for(let X=0,ie=q.length;X<ie;++X){let ae=R[q[X]];for(let be in ae){let me=ae[be];for(let fe=0,ge=me.length;fe<ge;fe+=2){w.setStyle(me[fe+1]);for(let ue=0,se=i.length;ue<se;++ue)w.setTransform(i[ue]),w.drawGeometry(me[fe])}}}return y.getImageData(0,0,_.width,_.height)}function D5(r,i,e){let n=[];if(e){let o=Math.floor(Math.round(r[0])*Lu),s=Math.floor(Math.round(r[1])*Lu),l=(to(o,0,e.width-1)+to(s,0,e.height-1)*e.width)*4,h=e.data[l],p=e.data[l+1],f=e.data[l+2]+256*(p+256*h),g=Math.floor((256*256*256-1)/i.length);f&&f%g===0&&n.push(i[f/g-1])}return n}var Mfe=.5,xq={Point:kfe,LineString:Ffe,Polygon:Dfe,MultiPoint:Ofe,MultiLineString:Pfe,MultiPolygon:Lfe,GeometryCollection:Tfe,Circle:Ife};function Sq(r,i){return parseInt(fi(r),10)-parseInt(fi(i),10)}function Ry(r,i){let e=$4(r,i);return e*e}function $4(r,i){return Mfe*r/i}function Ife(r,i,e,n,o){let s=e.getFill(),l=e.getStroke();if(s||l){let p=r.getBuilder(e.getZIndex(),"Circle");p.setFillStrokeStyle(s,l),p.drawCircle(i,n,o)}let h=e.getText();if(h&&h.getText()){let p=r.getBuilder(e.getZIndex(),"Text");p.setTextStyle(h),p.drawText(i,n)}}function fb(r,i,e,n,o,s,l,h){let p=[],m=e.getImage();if(m){let y=!0,_=m.getImageState();_==xi.LOADED||_==xi.ERROR?y=!1:_==xi.IDLE&&m.load(),y&&p.push(m.ready())}let f=e.getFill();f&&f.loading()&&p.push(f.ready());let g=p.length>0;return g&&Promise.all(p).then(()=>o(null)),Efe(r,i,e,n,s,l,h),g}function Efe(r,i,e,n,o,s,l){let h=e.getGeometryFunction()(i);if(!h)return;let p=h.simplifyTransformed(n,o);if(e.getRenderer())Cq(r,p,e,i,l);else{let f=xq[p.getType()];f(r,p,e,i,l,s)}}function Cq(r,i,e,n,o){if(i.getType()=="GeometryCollection"){let l=i.getGeometries();for(let h=0,p=l.length;h<p;++h)Cq(r,l[h],e,n,o);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(i,n,e.getRenderer(),e.getHitDetectionRenderer(),o)}function Tfe(r,i,e,n,o,s){let l=i.getGeometriesArray(),h,p;for(h=0,p=l.length;h<p;++h){let m=xq[l[h].getType()];m(r,l[h],e,n,o,s)}}function Ffe(r,i,e,n,o){let s=e.getStroke();if(s){let h=r.getBuilder(e.getZIndex(),"LineString");h.setFillStrokeStyle(null,s),h.drawLineString(i,n,o)}let l=e.getText();if(l&&l.getText()){let h=r.getBuilder(e.getZIndex(),"Text");h.setTextStyle(l),h.drawText(i,n,o)}}function Pfe(r,i,e,n,o){let s=e.getStroke();if(s){let h=r.getBuilder(e.getZIndex(),"LineString");h.setFillStrokeStyle(null,s),h.drawMultiLineString(i,n,o)}let l=e.getText();if(l&&l.getText()){let h=r.getBuilder(e.getZIndex(),"Text");h.setTextStyle(l),h.drawText(i,n,o)}}function Lfe(r,i,e,n,o){let s=e.getFill(),l=e.getStroke();if(l||s){let p=r.getBuilder(e.getZIndex(),"Polygon");p.setFillStrokeStyle(s,l),p.drawMultiPolygon(i,n,o)}let h=e.getText();if(h&&h.getText()){let p=r.getBuilder(e.getZIndex(),"Text");p.setTextStyle(h),p.drawText(i,n,o)}}function kfe(r,i,e,n,o,s){let l=e.getImage(),h=e.getText(),p=h&&h.getText(),m=s&&l&&p?{}:void 0;if(l){if(l.getImageState()!=xi.LOADED)return;let f=r.getBuilder(e.getZIndex(),"Image");f.setImageStyle(l,m),f.drawPoint(i,n,o)}if(p){let f=r.getBuilder(e.getZIndex(),"Text");f.setTextStyle(h,m),f.drawText(i,n,o)}}function Ofe(r,i,e,n,o,s){let l=e.getImage(),h=l&&l.getOpacity()!==0,p=e.getText(),m=p&&p.getText(),f=s&&h&&m?{}:void 0;if(h){if(l.getImageState()!=xi.LOADED)return;let g=r.getBuilder(e.getZIndex(),"Image");g.setImageStyle(l,f),g.drawMultiPoint(i,n,o)}if(m){let g=r.getBuilder(e.getZIndex(),"Text");g.setTextStyle(p,f),g.drawText(i,n,o)}}function Dfe(r,i,e,n,o){let s=e.getFill(),l=e.getStroke();if(s||l){let p=r.getBuilder(e.getZIndex(),"Polygon");p.setFillStrokeStyle(s,l),p.drawPolygon(i,n,o)}let h=e.getText();if(h&&h.getText()){let p=r.getBuilder(e.getZIndex(),"Text");p.setTextStyle(h),p.drawText(i,n,o)}}var W4=class extends db{constructor(i){super(i),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Wn(),this.wrappedRenderedExtent_=Wn(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(i,e,n){let o=e.extent,s=e.viewState,l=s.center,h=s.resolution,p=s.projection,m=s.rotation,f=p.getExtent(),g=this.getLayer().getSource(),y=this.getLayer().getDeclutter(),_=e.pixelRatio,w=e.viewHints,A=!(w[Ro.ANIMATING]||w[Ro.INTERACTING]),k=this.context,R=Math.round(mr(o)/h*_),q=Math.round(Hn(o)/h*_),X=g.getWrapX()&&p.canWrapX(),ie=X?mr(f):null,ae=X?Math.ceil((o[2]-f[2])/ie)+1:1,be=X?Math.floor((o[0]-f[0])/ie):0;do{let me=this.getRenderTransform(l,h,m,_,R,q,be*ie);i.execute(k,[k.canvas.width,k.canvas.height],me,m,A,n===void 0?pb:n?mb:wq,n?y&&e.declutter[y]:void 0)}while(++be<ae)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=yo(this.context.canvas.width,this.context.canvas.height,B4))}resetDrawContext_(){if(this.opacity_!==1){let i=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=i,tg(this.context),B4.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(i){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,i,!0)}renderDeferredInternal(i){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.resetDrawContext_())}renderFrame(i,e){let n=i.pixelRatio,o=i.layerStatesArray[i.layerIndex];this.opacity_=o.opacity;let s=i.extent,l=i.viewState.resolution,h=Math.round(mr(s)/l*n),p=Math.round(Hn(s)/l*n);Ns(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/n,1/n,0,-h/2,-p/2),D0(this.inversePixelTransform,this.pixelTransform);let m=Sv(this.pixelTransform);this.useContainer(e,m,this.getBackground(i));let f=this.context,g=f.canvas,y=this.replayGroup_,_=y&&!y.isEmpty();if(!_&&!(this.getLayer().hasListener(Oc.PRERENDER)||this.getLayer().hasListener(Oc.POSTRENDER)))return null;g.width!=h||g.height!=p?(g.width=h,g.height=p,g.style.transform!==m&&(g.style.transform=m)):this.containerReused||f.clearRect(0,0,h,p),this.setDrawContext_(),this.preRender(f,i);let w=i.viewState,A=w.projection,k=!1;if(_&&o.extent&&this.clipping){let R=Kc(o.extent,A);_=On(R,i.extent),k=_&&!Pa(R,i.extent),k&&this.clipUnrotated(f,i,R)}return _&&this.renderWorlds(y,i,this.getLayer().getDeclutter()?!1:void 0),k&&f.restore(),this.postRender(f,i),this.renderedRotation_!==w.rotation&&(this.renderedRotation_=w.rotation,this.hitDetectionImageData_=null),i.declutter||this.resetDrawContext_(),this.container}getFeatures(i){return new Promise(e=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){let n=[this.context.canvas.width,this.context.canvas.height];$o(this.pixelTransform,n);let o=this.renderedCenter_,s=this.renderedResolution_,l=this.renderedRotation_,h=this.renderedProjection_,p=this.wrappedRenderedExtent_,m=this.getLayer(),f=[],g=n[0]*Lu,y=n[1]*Lu;f.push(this.getRenderTransform(o,s,l,Lu,g,y,0).slice());let _=m.getSource(),w=h.getExtent();if(_.getWrapX()&&h.canWrapX()&&!Pa(w,p)){let k=p[0],R=mr(w),q=0,X;for(;k<w[0];)--q,X=R*q,f.push(this.getRenderTransform(o,s,l,Lu,g,y,X).slice()),k+=R;for(q=0,k=p[2];k>w[2];)++q,X=R*q,f.push(this.getRenderTransform(o,s,l,Lu,g,y,X).slice()),k-=R}let A=fl();this.hitDetectionImageData_=O5(n,f,this.renderedFeatures_,m.getStyleFunction(),p,s,l,Ry(s,this.renderedPixelRatio_),A?h:null)}e(D5(i,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(i,e,n,o,s){if(!this.replayGroup_)return;let l=e.viewState.resolution,h=e.viewState.rotation,p=this.getLayer(),m={},f=function(w,A,k){let R=fi(w),q=m[R];if(q){if(q!==!0&&k<q.distanceSq){if(k===0)return m[R]=!0,s.splice(s.lastIndexOf(q),1),o(w,p,A);q.geometry=A,q.distanceSq=k}}else{if(k===0)return m[R]=!0,o(w,p,A);s.push(m[R]={feature:w,layer:p,geometry:A,distanceSq:k,callback:o})}},g,y=[this.replayGroup_],_=this.getLayer().getDeclutter();return y.some(w=>g=w.forEachFeatureAtCoordinate(i,l,h,n,f,_&&e.declutter[_]?e.declutter[_].all().map(A=>A.value):null)),g}handleFontsChanged(){let i=this.getLayer();i.getVisible()&&this.replayGroup_&&i.changed()}handleStyleImageChange_(i){this.renderIfReadyAndVisible()}prepareFrame(i){let e=this.getLayer(),n=e.getSource();if(!n)return!1;let o=i.viewHints[Ro.ANIMATING],s=i.viewHints[Ro.INTERACTING],l=e.getUpdateWhileAnimating(),h=e.getUpdateWhileInteracting();if(this.ready&&!l&&o||!h&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;let p=i.extent,m=i.viewState,f=m.projection,g=m.resolution,y=i.pixelRatio,_=e.getRevision(),w=e.getRenderBuffer(),A=e.getRenderOrder();A===void 0&&(A=Sq);let k=m.center.slice(),R=Gl(p,w*g),q=R.slice(),X=[R.slice()],ie=f.getExtent();if(n.getWrapX()&&f.canWrapX()&&!Pa(ie,i.extent)){let Ee=mr(ie),je=Math.max(mr(R)/2,Ee);R[0]=ie[0]-je,R[2]=ie[2]+je,X1(k,f);let Ne=fP(X[0],f);Ne[0]<ie[0]&&Ne[2]<ie[2]?X.push([Ne[0]+Ee,Ne[1],Ne[2]+Ee,Ne[3]]):Ne[0]>ie[0]&&Ne[2]>ie[2]&&X.push([Ne[0]-Ee,Ne[1],Ne[2]-Ee,Ne[3]])}if(this.ready&&this.renderedResolution_==g&&this.renderedRevision_==_&&this.renderedRenderOrder_==A&&Pa(this.wrappedRenderedExtent_,R))return pc(this.renderedExtent_,q)||(this.hitDetectionImageData_=null,this.renderedExtent_=q),this.renderedCenter_=k,this.replayGroupChanged=!1,!0;this.replayGroup_=null;let ae=new F5($4(g,y),R,g,y),be=fl(),me;if(be){for(let Ee=0,je=X.length;Ee<je;++Ee){let Ne=X[Ee],ze=Am(Ne,f);n.loadFeatures(ze,V9(g,f),be)}me=vp(be,f)}else for(let Ee=0,je=X.length;Ee<je;++Ee)n.loadFeatures(X[Ee],g,f);let fe=Ry(g,y),ge=!0,ue=(Ee,je)=>{let Ne,ze=Ee.getStyleFunction()||e.getStyleFunction();if(ze&&(Ne=ze(Ee,g)),Ne){let Re=this.renderFeature(Ee,fe,Ne,ae,me,this.getLayer().getDeclutter(),je);ge=ge&&!Re}},se=Am(R,f),te=n.getFeaturesInExtent(se);A&&te.sort(A);for(let Ee=0,je=te.length;Ee<je;++Ee)ue(te[Ee],Ee);this.renderedFeatures_=te,this.ready=ge;let Se=ae.finish(),Te=new L5(R,g,y,n.getOverlaps(),Se,e.getRenderBuffer(),!!i.declutter);return this.renderedResolution_=g,this.renderedRevision_=_,this.renderedRenderOrder_=A,this.renderedExtent_=q,this.wrappedRenderedExtent_=R,this.renderedCenter_=k,this.renderedProjection_=f,this.renderedPixelRatio_=y,this.replayGroup_=Te,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(i,e,n,o,s,l,h){if(!n)return!1;let p=!1;if(Array.isArray(n))for(let m=0,f=n.length;m<f;++m)p=fb(o,i,n[m],e,this.boundHandleStyleImageChange_,s,l,h)||p;else p=fb(o,i,n,e,this.boundHandleStyleImageChange_,s,l,h);return p}},Aq=W4;var H4=class extends lb{constructor(i){super(i)}createRenderer(){return new Aq(this)}},fc=H4;function Mq(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");let i=r.inversePixelTransform[0],e=r.inversePixelTransform[1],n=Math.sqrt(i*i+e*e),o=r.frameState,s=wv(r.inversePixelTransform.slice(),o.coordinateToPixelTransform),l=Ry(o.viewState.resolution,n),h,p=fl();return p&&(h=vp(p,o.viewState.projection)),new k5(r.context,n,o.extent,s,o.viewState.rotation,l,h)}function Iq(r){let i=r.getStyle();return typeof i=="function"||i instanceof Array?void 0:{fill:{color:i.getFill().getColor()},stroke:{color:i.getStroke().getColor(),width:2},circle:{fill:{color:i.getImage().getFill().getColor()},stroke:{color:i.getImage().getStroke().getColor(),width:2},radius:5}}}var R5=class extends u0{id;loaded=0;loading=0;layer;constructor(i){super(),this.layer=i,this.id=rn()}watch(){let i=this.layer.options.source.ol;this.layer.dataSource instanceof kc&&(i=this.layer.options.source.options.source),i.getUrl()&&(i.on("featuresloadstart",()=>this.handleLoadStart()),i.on("featuresloadend",()=>this.handleLoadEnd()),i.on("featuresloaderror",()=>this.handleLoadEnd()))}unwatch(){let i=this.layer.options.source.ol;this.layer.dataSource instanceof kc&&(i=this.layer.options.source.options.source),i.getUrl()&&(i.un("featuresloadstart",()=>this.handleLoadStart()),i.un("featuresloadend",()=>this.handleLoadEnd()),i.un("featuresloaderror",()=>this.handleLoadEnd()))}handleLoadStart(){this.loading+=1,this.status=dn.Working}handleLoadEnd(){this.loaded+=1;let i=this.loading;this.loaded>=i&&i===this.loading&&(this.status=dn.Done,this.loaded=this.loading=0)}};function kp(r){return jn(r)&&!!r.options.linkedLayers}function gb(r){return!!r.options.linkedLayers?.links}function q4(r,i,e,n){if(!kp(r)||!kp(i))return!1;let o=gb(r)?r:gb(i)?i:void 0,s=!!o;if(!o){let p=Tq(r,e),m=Tq(i,e);if(p?.id!==m?.id)return!1;o=p}let l=o.options.linkedLayers.links;return s?!!Eq(l,o===r?i:r,n):Eq(l,r,n)?.some(p=>p.linkedIds.includes(i.id))}function Eq(r,i,e){let n=i.options.linkedLayers.linkId;return r.filter(o=>{let s=o.linkedIds.includes(n);return e?s&&o.properties.includes(e):s})}function Tq(r,i){if(r.options.linkedLayers)return i.find(e=>Rfe(r,e))}function Rfe(r,i){if(!jn(i))return;let e=i.options.linkedLayers?.links;return e?e.some(n=>n.linkedIds.includes(r.options.linkedLayers.linkId)):!1}var JS=class r{options;collapsed;firstLoadComponent=!0;map;olLoadingProblem=!1;status$;dataSource;get isIgoInternalLayer(){return this.options.isIgoInternalLayer||!1}get id(){return String(this.options.id)}get parentId(){return this.options.parentId}get alias(){return this.options.alias}get title(){return this.options.title}set title(i){this.options.title=i}get zIndex(){return this.ol.getZIndex()}set zIndex(i){i!==this.zIndex&&this.ol.setZIndex(i)}get baseLayer(){return this.options.baseLayer}set baseLayer(i){this.options.baseLayer=i}get opacity(){return this.ol.get("opacity")}set opacity(i){this.ol.setOpacity(i)}set isInResolutionsRange(i){this.isInResolutionsRange$.next(i)}get isInResolutionsRange(){return this.isInResolutionsRange$.value}isInResolutionsRange$=new ut(!1);set maxResolution(i){this.ol.setMaxResolution(i===0?0:i||1/0)}get maxResolution(){return this.ol.getMaxResolution()}set minResolution(i){this.ol.setMinResolution(i||0)}get minResolution(){return this.ol.getMinResolution()}set visible(i){i!==this.visible&&(this.ol.setVisible(i),this._visible$.next(i))}get visible(){return this._visible$.value}_visible$=new ut(void 0);visible$=this._visible$.asObservable();get displayed(){return this._displayed$.value}set displayed(i){i!==this.displayed&&this._displayed$.next(i)}_displayed$=new ut(void 0);displayed$=this._displayed$.asObservable();displayed$$;get showInLayerList(){return this.options.showInLayerList!==!1}get saveableOptions(){return{title:this.options.title,zIndex:this.zIndex,visible:this.visible,security:this.options.security,opacity:this.opacity}}constructor(i){this.options=i,this.initDisplayed$$()}afterCreated(){this.options.zIndex!==void 0&&(this.zIndex=this.options.zIndex),this.options.baseLayer&&this.options.visible===void 0&&(this.options.visible=!1),this.maxResolution=this.options.maxResolution||Oa(Number(this.options.maxScaleDenom)),this.minResolution=this.options.minResolution||Oa(Number(this.options.minScaleDenom)),this.visible=this.options.visible===void 0?!0:this.options.visible,this.opacity=this.options.opacity===void 0?1:this.options.opacity}init(i){this.map=i}add(i){this._add(i)}_add(i){this.addParent(i),this.parent?this.parent.addChild(this):this.map.ol.addLayer(this.ol)}addParent(i){this.parent&&this.parent===i||(this.parent=i,!this.map&&this.parent&&(this.map=this.parent.map),this.initDisplayed$$())}remove(){this._remove()}_remove(){if(!this.map){console.error(`No map for ${this.title}`);return}this.parent?this.parent.removeChild(this):this.map.ol.removeLayer(this.ol)}reset(i){this._remove(),this._add(i)}moveTo(i){i==null&&this.parent==null||this.parent&&this.parent.id===i?.id||this.reset(i)}clone(){let i=Object.assign({},this);return Object.setPrototypeOf(i,r.prototype)}initDisplayed$$(){this.displayed$$?.unsubscribe();let i=[this.isInResolutionsRange$,this.visible$];this.parent&&i.push(this.parent.displayed$),this.displayed$$=Ts(i).subscribe(([e,n,o=null])=>{let s=this.parent?o&&n:n;this.displayed=s&&e})}},N5=class extends JS{type="group";children};function Nfe(r,i,e){let n=i,o=n,s=!0;for(;s;)n=o,o=Bfe(r,n,e),s=!!o;return s||Gfe(n,e)||(n=void 0),s?o:n}function Pq(r,i,e,n){return Fq(r,i,n).map(s=>{e.push(s),Fq(r,s,n)&&Pq(r,s,e,n)}),e}function Bfe(r,i,e){if(i?.options.linkedLayers?.linkId){let n=i.options.linkedLayers.linkId,o=r.filter(s=>{if(An(s))return!1;let l=s.options.linkedLayers;if(l&&l.links)return l.links.find(p=>p.linkedIds.includes(n)&&p.properties.includes(e))});return o.length>1&&console.warn(`Your layer ${i.title||i.id} must only have 1 parent (${o.map(s=>s.title||s.id)})
            , The first parent (${o[0].title||o[0].id}) will be use to sync properties`),o[0]}}function Fq(r,i,e){let n=[];i?.options.linkedLayers?.links&&i.options.linkedLayers.links.filter(s=>s.properties.includes(e)).map(s=>{n=n.concat(s.linkedIds)});let o=r.filter(s=>jn(s));return n.map(s=>B5(o,s))}function Gfe(r,i){let e=!1,n=Lq(r);return n?.links&&(e=!!n.links.find(s=>s.properties.includes(i))),e}function Lq(r){return r.options.linkedLayers}function B5(r,i){return r.find(e=>e.options.linkedLayers?.linkId===i)}function kq(r,i){return i?.filter(e=>e.syncedDelete).reduce((e,n)=>{let o=jfe(n,r);return e.concat(o)},[])}function jfe(r,i){return r.linkedIds.reduce((e,n)=>{let o=B5(i,n);return o&&e.push(o),e},[])}function Oq(r,i,e){if(!i)return;let n=new us,o=!0,s=!0,l=i.event.key,h;if(l==="ogcFilters"?(o=!1,s=!0,h=i.layer.dataSource.options.ogcFilters):l==="timeFilter"?(o=!1,s=!0,h=i.layer.dataSource.options.timeFilter):(o=!0,s=!1,h=i.layer.ol.get(l)),Lq(i.layer)){let m=Nfe(r,i.layer,l);m||(m=i.layer);let f=[m];Pq(r,m,f,l);let g=!1,y=i.layer.options.source.options.type,_=i.layer.dataSource.options;f.map(w=>{if(i.layer&&w&&fi(i.layer.ol)!==fi(w?.ol)){let A=w.options.source.options.type;if(o)l==="visible"&&(h&&i.layer.showInLayerList&&i.layer.parent&&!i.layer.parent.displayed&&(h=i.layer.displayed),w.visible=h),w.ol.set(l,h,!0),(l==="minResolution"||l==="maxResolution")&&(g=!0);else if(s){if(l==="ogcFilters"){if(w.dataSource.setOgcFilters(h,!1),A==="wfs"&&w.ol.getSource().refresh(),A==="wms"){let k;y==="wfs"?k=n.handleOgcFiltersAppliedValue(_,i.layer.dataSource.options.fieldNameGeometry,void 0,e.getOlProjection()):y==="wms"&&(k=i.layer.dataSource.ol.getParams().FILTER),w.dataSource.ol.updateParams({FILTER:k})}}else if(w.dataSource instanceof _l&&l==="timeFilter"){w.dataSource.setTimeFilter(h,!1);let k=i.layer.ol.getSource().getParams().TIME;w.dataSource.ol.updateParams({TIME:k})}}}}),g&&e.resolution$.next(e.resolution$.value)}}var Op=class extends To{constructor(i,e){super(i),this.layer=e}},Y4={LAYERS:"layers"},Z4=class r extends x5{constructor(i){i=i||{};let e=Object.assign({},i);delete e.layers;let n=i.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Y4.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new Ua(n.slice(),{unique:!0}):Hi(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new Ua(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(wn),this.layersListenerKeys_.length=0;let i=this.getLayers();this.layersListenerKeys_.push(Vr(i,Va.ADD,this.handleLayersAdd_,this),Vr(i,Va.REMOVE,this.handleLayersRemove_,this));for(let n in this.listenerKeys_)this.listenerKeys_[n].forEach(wn);Dh(this.listenerKeys_);let e=i.getArray();for(let n=0,o=e.length;n<o;n++){let s=e[n];this.registerLayerListeners_(s),this.dispatchEvent(new Op("addlayer",s))}this.changed()}registerLayerListeners_(i){let e=[Vr(i,Ap.PROPERTYCHANGE,this.handleLayerChange_,this),Vr(i,mi.CHANGE,this.handleLayerChange_,this)];i instanceof r&&e.push(Vr(i,"addlayer",this.handleLayerGroupAdd_,this),Vr(i,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[fi(i)]=e}handleLayerGroupAdd_(i){this.dispatchEvent(new Op("addlayer",i.layer))}handleLayerGroupRemove_(i){this.dispatchEvent(new Op("removelayer",i.layer))}handleLayersAdd_(i){let e=i.element;this.registerLayerListeners_(e),this.dispatchEvent(new Op("addlayer",e)),this.changed()}handleLayersRemove_(i){let e=i.element,n=fi(e);this.listenerKeys_[n].forEach(wn),delete this.listenerKeys_[n],this.dispatchEvent(new Op("removelayer",e)),this.changed()}getLayers(){return this.get(Y4.LAYERS)}setLayers(i){let e=this.getLayers();if(e){let n=e.getArray();for(let o=0,s=n.length;o<s;++o)this.dispatchEvent(new Op("removelayer",n[o]))}this.set(Y4.LAYERS,i)}getLayersArray(i){return i=i!==void 0?i:[],this.getLayers().forEach(function(e){e.getLayersArray(i)}),i}getLayerStatesArray(i){let e=i!==void 0?i:[],n=e.length;this.getLayers().forEach(function(l){l.getLayerStatesArray(e)});let o=this.getLayerState(),s=o.zIndex;!i&&o.zIndex===void 0&&(s=0);for(let l=n,h=e.length;l<h;l++){let p=e[l];p.opacity*=o.opacity,p.visible=p.visible&&o.visible,p.maxResolution=Math.min(p.maxResolution,o.maxResolution),p.minResolution=Math.max(p.minResolution,o.minResolution),p.minZoom=Math.max(p.minZoom,o.minZoom),p.maxZoom=Math.min(p.maxZoom,o.maxZoom),o.extent!==void 0&&(p.extent!==void 0?p.extent=Xc(p.extent,o.extent):p.extent=o.extent),p.zIndex===void 0&&(p.zIndex=s)}return e}getSourceState(){return"ready"}},Dp=Z4;var _n=function(r){return r.OPACITY="opacity",r.VISIBLE="visible",r.DISPLAYED="displayed",r.OGCFILTERS="ogcFilters",r.MINRESOLUTION="minResolution",r.MAXRESOLUTION="maxResolution",r.ZINDEX="zIndex",r.TIMEFILTER="timeFilter",r}(_n||{});var _b=class extends u0{propertyChange$=new ut(void 0);loaded=0;loading=0;layers=[];subscriptionsByLayerId=new Map;subscriptions=[];constructor(){super()}watch(){}unwatch(){this.layers.forEach(i=>this.unwatchLayer(i),this)}setPropertyChange(i){[_n.TIMEFILTER,_n.OGCFILTERS,_n.VISIBLE,_n.OPACITY,_n.MINRESOLUTION,_n.MAXRESOLUTION,_n.ZINDEX,_n.DISPLAYED].includes(i.event.key)&&this.propertyChange$.next(i)}watchLayer(i){if(i.status$===void 0||i.ol instanceof Dp)return;this._watchLayer(i);let e=i.status$.pipe($u()).subscribe(n=>{n===dn.Error&&(this.loading=0,this.loaded=-1),n===dn.Working?this.loading+=1:n===dn.Done&&(this.loaded+=1),this.loaded>=this.loading?(this.loading=this.loaded=0,this.status=dn.Done):this.loading>0&&(this.status=dn.Working)});this.subscriptions.push(e)}_watchLayer(i){let e=i.displayed$.pipe(Nt(o=>({event:{key:"displayed",oldValue:!o,value:i.displayed},layer:i}))),n=Fs(this.createOlEventObservable(i.ol,i),this.createOlEventObservable(i.dataSource.ol,i),e).subscribe(o=>this.setPropertyChange(o));this.layers.push(i),this.subscriptionsByLayerId.set(i.id,[n])}createOlEventObservable(i,e){return jo(i,"propertychange").pipe(Nt(n=>({event:En(ur({},n),{value:i.get(n.key)}),layer:e})))}unwatchLayer(i){i.ol instanceof Dp||this._unwatchLayer(i)}_unwatchLayer(i){i.status$.next(dn.Done),this.subscriptionsByLayerId.get(i.id)?.forEach(n=>{n.unsubscribe(),this.subscriptionsByLayerId.delete(i.id)});let e=this.layers.indexOf(i);if(e>=0){let n=i.watcher.status;[dn.Working,dn.Waiting].indexOf(n)!==-1&&(this.loaded+=1),this.subscriptions[e].unsubscribe(),this.subscriptions.splice(e,1),this.layers.splice(e,1),i.watcher.unwatch()}}};var G5=class{layer;children=[];watcher=new _b;bidirectionnalChildren=[];childrenByProperty=new Map;disabledProperties=[];constructor(i){this.layer=i,this.init(),this.watcher.watchLayer(i),this.watcher.propertyChange$.subscribe(e=>{e&&this.handleChange(e)})}get options(){return this.layer.options}get links(){return this.layer.options.linkedLayers.links}get map(){return this.layer.map}init(){let i=this.findChildren(this.map.layerController.all,this.links);this.links.forEach(e=>{e.properties.forEach(n=>{let o=this.getByProperty(n);if(n===_n.ZINDEX){let s=[this.layer,...i];o=this.initZIndexLinkOptions(o,s)}this.childrenByProperty.set(n,o)})}),i.forEach(e=>this.add(e))}initZIndexLinkOptions(i,e){return i.initialOrder=F0(e,"desc"),i}destroy(){this.children.forEach(i=>{this.remove(i)}),this.unwatch()}add(i){this.children.includes(i)||this.children.push(i),this.getLayerLinks(i).forEach(e=>{if(e.bidirectionnal){if(this.bidirectionnalChildren.includes(i))return;this.bidirectionnalChildren.push(i),this.watcher.watchLayer(i)}e.properties.forEach(n=>{let o=this.getByProperty(n);if(!o.layers.includes(i)){if(n===_n.VISIBLE&&!i.showInLayerList){let s=this.getByProperty(_n.DISPLAYED);s.layers.push(i),this.childrenByProperty.set(_n.DISPLAYED,s)}if(n===_n.ZINDEX){let s=o;s.initialOrder.includes(i)||(s.initialOrder=F0([...s.initialOrder,i],"desc"))}o.layers.push(i),this.childrenByProperty.set(n,o),i[n]!==this.layer[n]&&this.handleChange({event:{key:n,oldValue:i[n],value:this.layer[n]},layer:this.layer})}})})}hasSyncDeletion(i){return this.getLayerLinks(i).some(e=>e.syncedDelete)}remove(i){i.linkMaster=void 0,this.removeArrayItem(i,this.children,"id"),this.getLayerLinks(i).forEach(e=>{e.bidirectionnal&&this.watcher.unwatchLayer(i),e.properties.forEach(n=>{let o=this.getByProperty(n);this.removeArrayItem(i,o.layers,"id"),this.childrenByProperty.set(n,o)})})}deleteChildren(i){kq(this.children,this.links)?.forEach(n=>{this.remove(n),i.remove(n)})}move(i,e){if(this.propertyIsDisabled(_n.ZINDEX))return;let n=this.getByProperty(_n.ZINDEX);if(!n.layers.length)return;let o=this.getLinkedLayersOnZindex(i.id);this.disable(_n.ZINDEX);let s=n.initialOrder.findIndex(l=>l.id===i.id);o?.forEach(l=>{if(!l.showInLayerList){l.zIndex=i.zIndex,e!==l.parent&&l.reset(e);return}n.initialOrder.findIndex(p=>p.id===l.id)<s?this.map.layerController.moveAbove(i,l):this.map.layerController.moveBelow(i,l)}),this.enable(_n.ZINDEX)}disable(...i){i.forEach(e=>{this.disabledProperties.includes(e)||this.disabledProperties.push(e)}),this.bidirectionnalChildren.forEach(e=>{this.watcher.unwatchLayer(e)})}enable(...i){i.forEach(e=>{let n=this.disabledProperties.findIndex(o=>o===e);n>-1&&this.disabledProperties.splice(n,1)}),this.bidirectionnalChildren.forEach(e=>{this.watcher.watchLayer(e)})}getByProperty(i){return this.childrenByProperty.get(i)??{layers:[]}}propertyIsDisabled(i){return this.disabledProperties.includes(i)}getLayerLinks(i){let e=i.options.linkedLayers.linkId;return this.links.filter(n=>n.linkedIds.includes(e))}removeArrayItem(i,e,n="id"){let o=e.findIndex(s=>s[n]===i[n]);o!==-1&&e.splice(o,1)}getLinkedLayersOnZindex(i){return[...this.getByProperty(_n.ZINDEX).layers].concat(this.layer).filter(e=>e.id!==i)}unwatch(){this.watcher.unwatch()}handleChange=i=>{let e=i.layer.id===this.layer.id,n=i.event.key;if(this.propertyIsDisabled(n))return;let s=[...this.getByProperty(n).layers];if(!(!s?.length&&e)){if(e||(s=s.filter(l=>l.id!==i.layer.id),s.push(this.layer)),n===_n.DISPLAYED&&e)return this.handleDisplayChange(i,s);Oq(s,i,this.map.viewController)}};handleDisplayChange(i,e){let n=[_n.DISPLAYED,_n.VISIBLE];this.disable(...n),e.forEach(o=>{o.showInLayerList||(o.visible=!!i.event.value)}),this.enable(...n)}findChildren(i,e){let n=i.filter(o=>jn(o));return e.reduce((o,s)=>{let l=s.linkedIds.map(h=>B5(n,h)).filter(Boolean);return o.concat(l)},[])}};var Qm=class extends JS{options;messageService;authInterceptor;parent;ol;hasBeenVisible$=new ut(void 0);legend;legendCollapsed=!0;link;linkMaster;resolution$$;get id(){return String(this.options.id||this.dataSource.id)}get visible(){return super.visible}set visible(i){super.visible=i,!this.hasBeenVisible$.value&&i&&this.hasBeenVisible$.next(i),this.options?.messages&&i&&this.options?.messages.filter(e=>e.options?.showOnEachLayerVisibility).map(e=>this.showMessage(e))}get maxResolution(){return super.maxResolution}set maxResolution(i){super.maxResolution=i,this.updateInResolutionsRange()}get minResolution(){return super.minResolution}set minResolution(i){super.minResolution=i,this.updateInResolutionsRange()}get saveableOptions(){if($U(this))return En(ur({},super.saveableOptions),{sourceOptions:this.dataSource.saveableOptions})}constructor(i,e,n){super(i),this.options=i,this.messageService=e,this.authInterceptor=n,this.dataSource=i.source,this.legendCollapsed=i.legendOptions&&i.legendOptions.collapsed?i.legendOptions.collapsed:!0,i.legendOptions&&(i.legendOptions.url||i.legendOptions.html)&&(this.legend=this.dataSource.setLegend(i.legendOptions)),this.ol=this.createOlLayer(),this.ol.set("_layer",this,!0),super.afterCreated()}init(i){super.init(i),i.layerWatcher.watchLayer(this),this.observeResolution(),this.hasBeenVisible$.subscribe(()=>{this.options.messages&&this.visible&&this.options.messages.map(e=>{this.showMessage(e)})}),this.createLink()}createLink(){!gb(this)||this.link||(this.link=new G5(this))}remove(){if(super.remove(),this.unobserveResolution(),this.map.layerWatcher.unwatchLayer(this),gb(this)&&(this.link?.deleteChildren(this.map.layerController),this.link?.destroy()),kp(this)){if(!this.linkMaster)return;let i=this.linkMaster.layer,e=this.linkMaster.hasSyncDeletion(this);this.linkMaster.remove(this),e&&i&&this.map.layerController.remove(i)}}add(i){super.add(i),kp(this)&&(gb(this)&&this.link.init(),this.createLinkWithParent())}moveTo(i){super.moveTo(i),kp(this)&&(this.link?.move(this,i),this.linkMaster?.move(this,i))}createLinkWithParent(){let i=this.findParentByLinkId(this.map.layerController.all,this.options.linkedLayers.linkId);i&&(this.linkMaster=i.link,i?.link.add(this))}findParentByLinkId(i,e){return i.find(n=>{if(jn(n))return n.options.linkedLayers?.links?n.options.linkedLayers.links.some(o=>o.linkedIds.includes(e)):!1})}showMessage(i){this.messageService&&this.messageService.message(i)}observeResolution(){this.resolution$$=this.map.viewController.resolution$.subscribe(()=>this.updateInResolutionsRange())}unobserveResolution(){this.resolution$$!==void 0&&(this.resolution$$.unsubscribe(),this.resolution$$=void 0)}updateInResolutionsRange(){if(this.map!==void 0){let i=this.map.viewController.getResolution(),e=this.minResolution,n=this.maxResolution===void 0?1/0:this.maxResolution;this.isInResolutionsRange=i>=e&&i<=n}else this.isInResolutionsRange=!1}};var Fr=class extends Qm{messageService;authInterceptor;geoNetworkService;type="vector";previousLoadExtent;previousLoadResolution;previousOgcFilters;xhrAccumulator=[];watcher;trackFeatureListenerId;get browsable(){return this.options.browsable!==!1}get exportable(){return this.options.exportable!==!1}constructor(i,e,n,o){super(i,e,n),this.messageService=e,this.authInterceptor=n,this.geoNetworkService=o,this.watcher=new R5(this),this.status$=this.watcher.status$}createOlLayer(){let i=Object.assign({},this.options,{source:this.options.source.ol,sourceOptions:this.options.sourceOptions||this.options.source.options});(this.options.sourceOptions?.preload?.bypassResolution||this.options.sourceOptions?.preload?.bypassVisible)&&this.handlePreload(),this.options.animation&&this.dataSource.ol.on("addfeature",function(s){this.flash(s.feature)}.bind(this)),this.options.trackFeature&&this.enableTrackFeature(this.options.trackFeature);let e=new fc(i),n=e.getSource(),o=n.getUrl();if(typeof o=="function")return e;if(o||i.sourceOptions?.type==="wfs"){let s,l=i.sourceOptions;l?.type==="wfs"&&(l.params||l.paramsWFS)?s=(h,p,m,f,g)=>{this.customWFSLoader(n,l,this.authInterceptor,h,p,m,f,g)}:s=(h,p,m,f,g)=>{this.customLoader(n,o,h,p,m,f,g)},s&&n.setLoader(s)}return this.handleIdbStorage(e),e}handleIdbStorage(i){this.options.idbInfo?.storeToIdb&&(jo(i,"sourceready").pipe(bu(()=>{this.options.idbInfo.firstLoad!==!1&&(this.maintainFeaturesInIdb(),this.maintainOptionsInIdb())}),Xn(()=>Fs(jo(i.getSource(),"featuresloadend"),jo(i.getSource(),"addfeature"),jo(i.getSource(),"changefeature"),jo(i.getSource(),"clear"),jo(i.getSource(),"removefeature")))).pipe(Br(750)).subscribe(()=>this.maintainFeaturesInIdb()),jo(i,"sourceready").pipe(Xn(()=>Fs(jo(i,"change"),jo(i,"change:zIndex")))).pipe(Br(750)).subscribe(()=>this.maintainOptionsInIdb()))}handlePreload(){let i=this.options.sourceOptions.preload;if(this.dataSource instanceof kr){let e=this.options.opacity||1,n=this.options.visible!==!1,o=this.options.minResolution||Oa(Number(this.options.minScaleDenom)),s=this.options.maxResolution||Oa(Number(this.options.maxScaleDenom));this.options.opacity=0,i.bypassResolution&&(this.options.minResolution||this.options.maxResolution)&&(this.options.minResolution=0,this.options.maxResolution=1/0),i.bypassVisible&&!n&&(this.options.visible=!0),this.dataSource.ol.once("featuresloadend",()=>{e&&(this.opacity=e),i.bypassResolution&&(this.minResolution=o,this.maxResolution=s),i.bypassVisible&&(this.visible=n)})}}remove(){this.watcher.unsubscribe(),this.options.idbInfo?.storeToIdb&&this.removeLayerFromIDB(),super.remove()}removeLayerFromIDB(){let i=new zd,e=new xm;Fs(i.delete(this.id),e.delete(this.id)).subscribe()}maintainOptionsInIdb(){this.options.igoStyle.igoStyleObject=Iq(this.ol);let i=rr.removeUndefined({layerId:this.id,detailedContextUri:this.options.idbInfo?.contextUri,sourceOptions:{id:this.id,type:"vector",queryable:!0,url:this.options.sourceOptions?.url},layerOptions:{workspace:this.options.workspace,zIndex:this.ol?this.zIndex:1e6,id:this.id,isIgoInternalLayer:this.isIgoInternalLayer,title:this.title,igoStyle:this.options.igoStyle,idbInfo:Object.assign({contextUri:"*"},this.options.idbInfo,{firstLoad:!1})},insertEvent:`${this.title}-${this.id}-${new Date}`});new xm().update(i).pipe(Ps()).subscribe()}maintainFeaturesInIdb(){let i=this.dataSource.ol.getFeatures(),e=JSON.parse(new Qr().writeFeatures(i,{dataProjection:"EPSG:4326",featureProjection:this.dataSource.ol.getProjection()||"EPSG:3857"}));new zd().update(this.options.sourceOptions.url||this.id,this.id,e,p0.User,`${this.title}-${this.id}-${new Date}`).pipe(Ps()).subscribe()}flash(i){let e=new Date().getTime(),n=this.ol.on("postrender",o.bind(this));function o(s){let l=Mq(s),h=s.frameState,p=i.getGeometry().clone(),m=h.time-e,f=m/this.options.animation.duration,g=$l(1-f),y=Ra(this.options.animation.color||"red");y[3]=g;let _=this.ol.getStyleFunction().call(this,i).find(A=>A.getImage());_||(_=this.ol.getStyleFunction().call(this,i)[0]);let w=_.clone();switch(i.getGeometry().getType()){case"Point":if(w.getImage()!==null&&typeof w.getImage().getRadius=="function"){let A=$l(f)*(w.getImage().getRadius()*3);w.getImage().setRadius(A),w.getImage().setOpacity(g)}break;case"LineString":w.getImage()&&(w.getImage().getStroke().setColor(y),w.getImage().getStroke().setWidth($l(f)*(w.getImage().getStroke().getWidth()*3))),w.getStroke()&&(w.getStroke().setColor(y),w.getStroke().setWidth($l(f)*(w.getStroke().getWidth()*3)));break;case"Polygon":w.getImage()&&w.getImage().getFill().setColor(y),w.getFill()&&w.getFill().setColor(y);break}if(w.setText(""),l.setStyle(w),l.drawGeometry(p),m>this.options.animation.duration){io(n),this.map.ol.render();return}this.map.ol.render()}}init(i){i===void 0?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.init(i)}setExtent(i){this.options.extent=i}onUnwatch(){this.dataSource.onUnwatch(),this.stopAnimation()}stopAnimation(){this.dataSource.ol.un("addfeature",function(i){this.visible&&this.flash(i.feature)}.bind(this))}enableTrackFeature(i){this.trackFeatureListenerId=this.dataSource.ol.on("addfeature",this.trackFeature.bind(this,i))}centerMapOnFeature(i){let e=this.dataSource.ol.getFeatureById(i);e&&this.map.ol.getView().setCenter(e.getGeometry().getCoordinates())}trackFeature(i,e){e.feature.getId()===i&&this.visible&&this.centerMapOnFeature(i)}disableTrackFeature(){io(this.trackFeatureListenerId)}customWFSLoader(i,e,n,o,s,l,h,p,m){{let f=e.paramsWFS,g=f.srsName?new lc({code:f.srsName}):l,y=Zs(o,l,g),_=e.ogcFilters;if(this.previousLoadExtent&&this.previousLoadExtent!==y||this.previousLoadResolution&&this.previousLoadResolution!==s||this.previousOgcFilters&&this.previousOgcFilters!==_){i.removeLoadedExtent(this.previousLoadExtent);for(let k of this.xhrAccumulator)k.abort()}this.previousLoadExtent=y,this.previousLoadResolution=s,this.previousOgcFilters=_,f.srsName=f.srsName||l.getCode();let w=_5(e,y,g,_,m),A=0;if(f.version==="2.0.0"&&f.maxFeatures>qm)for(;A<f.maxFeatures;){let R=w.replace("count="+f.maxFeatures,"count=1000");R=R.replace("startIndex=0","0"),R+="&startIndex="+A,R.replace(/&&/g,"&"),this.getFeatures(i,y,g,l,R,h,p),A+=1e3}else this.getFeatures(i,y,g,l,w,h,p)}}getFeatures(i,e,n,o,s,l,h){let p=new XMLHttpRequest,m=this.authInterceptor.alterUrlWithKeyAuth(s),f=s;m&&(f=m),p.open("GET",f),this.authInterceptor&&this.authInterceptor.interceptXhr(p,f);let g=()=>{i.removeLoadedExtent(e),h()};p.onerror=g,p.onload=()=>{p.status===200&&p.responseText.length>0?this.handleOnLoad(i,p.responseText,e,o,l,g):g()},this.xhrAccumulator.push(p),p.send()}handleOnLoad(i,e,n,o,s,l){let h=i.getFormat(),p=h.getType();if(e){let m;switch(p){case"xml":m=new DOMParser().parseFromString(e.toString(),"application/xml");break;case"json":case"text":case"arraybuffer":default:m=e;break}if(m){let f=h.readFeatures(m,{extent:n,featureProjection:o});i.addFeatures(f),s(f)}else l()}}customLoader(i,e,n,o,s,l,h){let p=()=>{i.removeLoadedExtent(n),h()},m=new XMLHttpRequest,f=e;if(typeof e!="function"){let _=this.authInterceptor.alterUrlWithKeyAuth(e);_&&(f=_)}let y=i.getFormat().getType();if(this.geoNetworkService&&typeof e!="function"){let _={responseType:y},w=this.geoNetworkService.get(f,_).pipe(Ps(),qr(R=>{throw p(),R})),k=new zd().get(e).pipe(y7(750),qs(R=>R?ai(R):w));(this.options.idbInfo?.storeToIdb?k:w).subscribe(R=>{this.handleOnLoad(i,R,n,s,l,p)})}else m.open("GET",f),y==="arraybuffer"&&(m.responseType="arraybuffer"),this.authInterceptor&&this.authInterceptor.interceptXhr(m,f),m.onerror=p,m.onload=()=>{!m.status||m.status>=200&&m.status<300?this.handleOnLoad(i,m.responseText,n,s,l,p):p()},m.send()}};function bd(r,i){return r.layer!==void 0?(r.map.layerController.getById(r.layer.id)||r.map.layerController.add(r.layer),r.layer):(i=i||new Fr({source:new kr}),r.bindLayer(i),r.map.layerController.getById(r.layer.id)||r.map.layerController.add(r.layer),i)}var vr="Feature",Yi=function(r){return r[r.None=0]="None",r[r.Move=1]="Move",r[r.Zoom=2]="Zoom",r[r.Default=3]="Default",r}(Yi||{});var vl=class extends td{options;stores$$=new Map;motion;constructor(i){super(i),this.options=i,this.setMotion(i.motion)}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i)}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}setMotion(i){this.motion=i}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}watchStore(i){if(this.stores$$.has(i))return;let e=i.view.all$().subscribe(n=>this.onFeaturesChange(n,i));this.stores$$.set(i,e)}unwatchStore(i){let e=this.stores$$.get(i);e!==void 0&&(e.unsubscribe(),this.stores$$.delete(i))}unwatchAll(){Array.from(this.stores$$.entries()).forEach(i=>{i[1].unsubscribe()}),this.stores$$.clear()}onFeaturesChange(i,e){i.length===0?e.clearLayer():e.setLayerFeatures(i,this.selectMotion(e),this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}selectMotion(i){return this.motion!==void 0?this.motion:i.pristine===!0?Yi.Default:i.count>i.view.count?Yi.Default:Yi.None}};var Ny={ACTIVE:"active"};var X4=class extends ls{constructor(i){super(),this.on,this.once,this.un,i&&i.handleEvent&&(this.handleEvent=i.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Ny.ACTIVE)}getMap(){return this.map_}handleEvent(i){return!0}setActive(i){this.set(Ny.ACTIVE,i)}setMap(i){this.map_=i}};function Dq(r,i,e){let n=r.getCenterInternal();if(n){let o=[n[0]+i[0],n[1]+i[1]];r.animateInternal({duration:e!==void 0?e:250,easing:lH,center:r.getConstrainedCenter(o)})}}function yb(r,i,e,n){let o=r.getZoom();if(o===void 0)return;let s=r.getConstrainedZoom(o+i),l=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:l,anchor:e,duration:n!==void 0?n:250,easing:$l})}var Xh=X4;var sn={SINGLECLICK:"singleclick",CLICK:mi.CLICK,DBLCLICK:mi.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var K4=class extends Xh{constructor(i){i=i||{},super(i),i.handleDownEvent&&(this.handleDownEvent=i.handleDownEvent),i.handleDragEvent&&(this.handleDragEvent=i.handleDragEvent),i.handleMoveEvent&&(this.handleMoveEvent=i.handleMoveEvent),i.handleUpEvent&&(this.handleUpEvent=i.handleUpEvent),i.stopDown&&(this.stopDown=i.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(i){return!1}handleDragEvent(i){}handleEvent(i){if(!i.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(i),this.handlingDownUpSequence){if(i.type==sn.POINTERDRAG)this.handleDragEvent(i),i.originalEvent.preventDefault();else if(i.type==sn.POINTERUP){let n=this.handleUpEvent(i);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(i.type==sn.POINTERDOWN){let n=this.handleDownEvent(i);this.handlingDownUpSequence=n,e=this.stopDown(n)}else i.type==sn.POINTERMOVE&&this.handleMoveEvent(i);return!e}handleMoveEvent(i){}handleUpEvent(i){return!1}stopDown(i){return i}updateTrackedPointers_(i){i.activePointers&&(this.targetPointers=i.activePointers)}};function vb(r){let i=r.length,e=0,n=0;for(let o=0;o<i;o++)e+=r[o].clientX,n+=r[o].clientY;return{clientX:e/i,clientY:n/i}}var lu=K4;var Q4=class extends _v{constructor(i){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+i,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){let i=this.startPixel_,e=this.endPixel_,n="px",o=this.element_.style;o.left=Math.min(i[0],e[0])+n,o.top=Math.min(i[1],e[1])+n,o.width=Math.abs(e[0]-i[0])+n,o.height=Math.abs(e[1]-i[1])+n}setMap(i){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);let e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=i,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(i,e){this.startPixel_=i,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){let i=this.startPixel_,e=this.endPixel_,o=[i,[i[0],e[1]],e,[e[0],i[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new on([o])}getGeometry(){return this.geometry_}},Rq=Q4;function e2(r){let i=arguments;return function(e){let n=!0;for(let o=0,s=i.length;o<s&&(n=n&&i[o](e),!!n);++o);return n}}var Nq=function(r){let i=r.originalEvent;return i.altKey&&!(i.metaKey||i.ctrlKey)&&!i.shiftKey},Bq=function(r){let i=r.originalEvent;return i.altKey&&!(i.metaKey||i.ctrlKey)&&i.shiftKey},Vfe=function(r){let i=r.map.getTargetElement(),e=r.map.getOwnerDocument().activeElement;return i.contains(e)},j5=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?Vfe(r):!0},xg=Tc,Gq=function(r){return r.type==sn.CLICK},V5=function(r){let i=r.originalEvent;return i.button==0&&!(w9&&Tx&&i.ctrlKey)},t2=Gh;var U5=function(r){return r.type==sn.SINGLECLICK},jq=function(r){return r.type==sn.DBLCLICK},bb=function(r){let i=r.originalEvent;return!i.altKey&&!(i.metaKey||i.ctrlKey)&&!i.shiftKey};var Vq=function(r){let i=r.originalEvent;return Tx?i.metaKey:i.ctrlKey},wb=function(r){let i=r.originalEvent;return!i.altKey&&!(i.metaKey||i.ctrlKey)&&i.shiftKey},z5=function(r){let i=r.originalEvent,e=i.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!i.target.isContentEditable},$5=function(r){let i=r.originalEvent;return Hi(i!==void 0,"mapBrowserEvent must originate from a pointer event"),i.pointerType=="mouse"};var W5=function(r){let i=r.originalEvent;return Hi(i!==void 0,"mapBrowserEvent must originate from a pointer event"),i.isPrimary&&i.button===0};var H5={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},i2=class extends To{constructor(i,e,n){super(i),this.coordinate=e,this.mapBrowserEvent=n}},J4=class extends lu{constructor(i){super(),this.on,this.once,this.un,i=i||{},this.box_=new Rq(i.className||"ol-dragbox"),this.minArea_=i.minArea!==void 0?i.minArea:64,i.onBoxEnd&&(this.onBoxEnd=i.onBoxEnd),this.startPixel_=null,this.condition_=i.condition?i.condition:V5,this.boxEndCondition_=i.boxEndCondition?i.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(i,e,n){let o=n[0]-e[0],s=n[1]-e[1];return o*o+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(i){this.box_.setPixels(this.startPixel_,i.pixel),this.dispatchEvent(new i2(H5.BOXDRAG,i.coordinate,i))}handleUpEvent(i){this.box_.setMap(null);let e=this.boxEndCondition_(i,this.startPixel_,i.pixel);return e&&this.onBoxEnd(i),this.dispatchEvent(new i2(e?H5.BOXEND:H5.BOXCANCEL,i.coordinate,i)),!1}handleDownEvent(i){return this.condition_(i)?(this.startPixel_=i.pixel,this.box_.setMap(i.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new i2(H5.BOXSTART,i.coordinate,i)),!0):!1}onBoxEnd(i){}},xb=J4;function ku(r,i,e){e=e||jA;let o=new Qr().readFeature(r,{dataProjection:r.projection,featureProjection:i});o.setId(e(r));let s=ed(r);s!==void 0&&o.set("_title",s,!0),r.extent!==void 0&&o.set("_extent",r.extent,!0),r.projection!==void 0&&o.set("_projection",r.projection,!0);let l=QF(r,"meta.mapTitle");l!==void 0&&o.set("_mapTitle",l,!0),o.set("_entityRevision",VA(r),!0);let h=d0(r);return h!==void 0&&o.set("_icon",h,!0),r.meta&&r.meta.style&&o.set("_style",r.meta.style,!0),r.sourceId&&o.set("_sourceId",r.sourceId,!0),o}function Uq(r,i,e,n="EPSG:4326"){let o,s,l,h;e?(s=e.get("title"),e.get("sourceOptions")&&(l=e.get("sourceOptions").excludeAttribute,h=e.get("sourceOptions").excludeAttributeOffline)):s=r.get("_title");let p=new Qr,m=r.getProperties(),f=r.getType();if(f==="Polygon"){let A=r.getEnds();o=new on(r.getFlatCoordinates(),"XY",A)}else f==="Point"?o=new Ii(r.getFlatCoordinates(),"XY"):f==="LineString"&&(o=new Tr(r.getFlatCoordinates(),"XY"));let g=p.writeGeometryObject(o,{dataProjection:n,featureProjection:i}),y=r.getId()?r.getId():rn(),_=r.get("_mapTitle"),w=Zs(r.getExtent(),i,n);return{type:vr,projection:n,extent:w,meta:{id:y,title:s||_||y,mapTitle:_,excludeAttribute:l,excludeAttributeOffline:h},properties:m,geometry:g,ol:r}}function Sb(r,i,e,n="EPSG:4326"){let o,s,l,h,p=new Qr,f=r.getKeys().filter(w=>!w.startsWith("_")&&w!=="geometry").reduce((w,A)=>(w[A]=r.get(A),w),{}),g=p.writeGeometryObject(r.getGeometry(),{dataProjection:n,featureProjection:i});if(e){o=e.get("title");let w=e.get("sourceOptions");w&&(s=w.excludeAttribute,l=w.excludeAttributeOffline,h=w.idColumn||(w.type==="arcgisrest"||w.type==="tilearcgisrest"?"OBJECTID":void 0))}else o=r.get("_title");let y=r.get("_mapTitle"),_=r.getId()?r.getId():r.get(h)?r.get(h):rn();return{type:vr,projection:n,extent:r.get("_extent"),meta:{id:_,title:o||y||_,mapTitle:y,revision:r.getRevision(),style:r.get("_style"),excludeAttribute:s,excludeAttributeOffline:l},properties:f,geometry:g,ol:r}}function zfe(r,i){let e=Wn(),n=r.get("_extent"),o=r.get("_projection");if(n!==void 0&&o!==void 0)e=Zs(n,o,i);else{let s=r.getGeometry();s!==null&&(e=s.getExtent())}return e}function By(r,i){let e=Wn();return r.forEach(n=>{let o=zfe(n,i);Hd(e,o)}),e}function zq(r,i){let[e,n]=T9(r);return[i[3]?r[0]-e*i[3]:r[0],i[2]?r[1]-n*i[2]:r[1],i[1]?r[2]+e*i[1]:r[2],i[0]?r[3]+n*i[0]:r[3]]}function eR(r,i,e=.05){let n=Array.isArray(e)?e:[e,e,e,e],o=[-1,-1,-1,-1].map((l,h)=>l*n[h]),s=zq(r,o);return!Pa(s,i)}function $fe(r,i,e){e=e||.004;let n=r.getExtent(),o=g0(n),s=g0(i);return s===0&&r.getZoom()>13?!1:s/o<e}function ih(r,i,e=Yi.Default,n,o){let s=r.getExtent(),l=r.getOlProjection(),h=By(i,l),p=h;n!==void 0&&(p=zq(p,n)),e===Yi.Zoom?r.zoomToExtent(p):e===Yi.Move?r.moveToExtent(p):e===Yi.Default&&(eR(s,h)||$fe(r,h,o))&&r.zoomToExtent(p)}function tR(r){r.setStyle(new oi({}))}function $q(r,i){let e=new Map;i.forEach(l=>{e.set(l.getId(),l)});let n=[];r.forEach(l=>{let h=e.get(l.getId());h===void 0||h.get("_entityRevision")!==l.get("_entityRevision")?n.push(l):e.delete(h.getId())});let o=Array.from(e.keys());return{add:i.filter(l=>o.indexOf(l.getId())>=0),remove:n}}var is=class extends Lh{layer;map;get source(){return this.layer?this.layer.dataSource:void 0}set searchDocument(i){this._searchDocument=i}get searchDocument(){return this._searchDocument}_searchDocument;constructor(i,e){super(i,e),this.map=e.map}bindLayer(i){return this.layer=i,this}setLayerFeatures(i,e=Yi.Default,n,o,s){s=s||jA,this.checkLayer();let l=i.map(h=>ku(h,this.map.projection,s));this.setLayerOlFeatures(l,e,n,o)}setStoreOlFeatures(i){this.checkLayer();let e=i.map(n=>(n.set("_featureStore",this,!0),Sb(n,this.layer.map.projection)));this.load(e)}clearLayer(){this.checkLayer(),this.source.ol.clear()}checkLayer(){if(this.layer===void 0)throw new Error("This FeatureStore is not bound to a layer.")}setLayerOlFeatures(i,e=Yi.Default,n,o){let s=this.layer.ol.getSource(),l=$q(s.getFeatures(),i);l.remove.length>0&&this.removeOlFeaturesFromLayer(l.remove),l.add.length>0&&this.addOlFeaturesToLayer(l.add),l.add.length>0?ih(this.map.viewController,l.add,e,n,o):l.remove.length>0&&ih(this.map.viewController,i,e,n,o)}setLayerExtent(){let i=this.entities$.getValue(),e=Wn(),n=[];i.forEach(s=>{n.push(ku(s,this.map.projection))});let o=By(n,this.map.viewProjection);Hd(e,o),this.layer.setExtent(e)}addOlFeaturesToLayer(i){i.forEach(e=>{e.set("_featureStore",this,!0)}),this.source.ol.addFeatures(i)}removeOlFeaturesFromLayer(i){i.forEach(e=>{this.source.ol.removeFeature(e)})}};var Gy=class extends xb{constructor(i){super(i)}},rs=class extends td{options;mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;stores$$;motion;get map(){return this.options.map}get overlayStore(){return this._overlayStore}_overlayStore;constructor(i){super(i),this.options=i,this.setMotion(i.motion),this._overlayStore=this.createOverlayStore()}bindStore(i){super.bindStore(i),this.active===!0&&this.activate()}unbindStore(i){super.unbindStore(i),this.active===!0&&this.activate()}setMotion(i){this.motion=i}unselectAll(){this.stores.forEach(i=>{i.state.updateAll({selected:!1})})}clear(){this.overlayStore.source.ol.clear(),this.overlayStore.clear()}deactivateSelection(){this.unlistenToMapClick(),this.removeDragBoxInteraction(),this.unwatchAll()}doActivate(){this.addOverlayLayer(),this.listenToMapClick(),this.options.dragBox===!0&&this.addDragBoxInteraction(),this.watchAll()}doDeactivate(){this.deactivateSelection(),this.removeOverlayLayer()}watchAll(){this.unwatchAll();let i=this.stores.map(e=>e.stateView.manyBy$(n=>n.state.selected===!0).pipe(Nt(n=>n.map(o=>o.entity))));this.stores$$=Ts(i).pipe(Br(5),Of(1),Nt(e=>e.reduce((n,o)=>n.concat(o)))).subscribe(e=>this.onSelectFromStore(e))}unwatchAll(){this.stores$$!==void 0&&this.stores$$.unsubscribe()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",i=>{this.onMapClick(i)})}unlistenToMapClick(){io(this.mapClickListener)}onMapClick(i){let e=!K1(i),n=!e,o=i.map.getFeaturesAtPixel(i.pixel,{hitTolerance:this.options.hitTolerance||0,layerFilter:s=>this.stores.find(h=>h.layer?.ol===s)!==void 0});this.onSelectFromMap(o,e,n)}addDragBoxInteraction(){let i,e=this.map.ol.getInteractions().getArray();for(let n of e)if(n instanceof Gy){i=n;break}i===void 0&&(i=new Gy({condition:K1}),this.map.ol.addInteraction(i),this.olDragSelectInteraction=i),this.olDragSelectInteractionEndKey=i.on("boxend",n=>this.onDragBoxEnd(n))}removeDragBoxInteraction(){this.olDragSelectInteractionEndKey!==void 0&&io(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==void 0&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}onDragBoxEnd(i){let e=!K1(i.mapBrowserEvent),o=i.target.getGeometry().getExtent(),s=this.stores.reduce((l,h)=>{let p=h.layer.ol.getSource();return l.push(...p.getFeaturesInExtent(o)),l},[]);this.onSelectFromMap(s,e,!1)}onSelectFromStore(i){let e=this.motion,o=this.overlayStore.layer.ol.getSource().getFeatures().map(h=>h.getId()),s=i.map(this.overlayStore.getKey),l;i.length===0?l=!1:l=o.length!==s.length||!o.every(h=>s.indexOf(h)>=0),this.overlayStore.setLayerFeatures(i,l?e:Yi.None,this.options.viewScale,this.options.areaRatio,this.options.getFeatureId)}onSelectFromMap(i,e,n){let o=this.groupFeaturesByStore(i);this.stores.forEach(s=>{let l=o.get(s);l===void 0&&e===!0?this.unselectAllFeaturesFromStore(s):l===void 0&&e===!1||this.selectFeaturesFromStore(s,l,e,n)})}selectFeaturesFromStore(i,e,n,o){o===!0?i.state.reverseMany(e,["selected"]):i.state.updateMany(e,{selected:!0},n)}unselectAllFeaturesFromStore(i){i.state.updateAll({selected:!1})}groupFeaturesByStore(i){let e=new Map;return i==null||i.forEach(n=>{let o=n.get("_featureStore");if(o===void 0)return;let s=e.get(o);s===void 0&&(s=[],e.set(o,s));let l=o.get(n.getId());l!==void 0&&s.push(l)}),e}createOverlayStore(){let i=this.options.layer?this.options.layer:this.createOverlayLayer();return new is([],{map:this.map}).bindLayer(i)}createOverlayLayer(){return new Fr({zIndex:300,source:new kr,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1})}addOverlayLayer(){let i=this.overlayStore.layer;this.map.layerController.getById(i.id)||this.map.layerController.add(i)}removeOverlayLayer(){this.overlayStore.source.ol.clear(),this.map.layerController.remove(this.overlayStore.layer)}};function Jm(r,i){if(r.getStrategyOfType(vl)!==void 0){r.activateStrategyOfType(vl);return}i=i||new vl({}),r.addStrategy(i),i.activate()}function Cb(r,i){if(r.getStrategyOfType(rs)!==void 0){r.activateStrategyOfType(rs);return}i=i||new rs({map:r.map}),r.addStrategy(i),i.activate()}function t_({text:r,opacity:i=1,markerColor:e=[0,161,222],markerOutlineColor:n=[255,255,255]}={}){let o=Ra(e).slice(0),s=Ra(n).slice(0);o.length===4&&(typeof e!="string"||/^#[0-9A-F]{8}$/i.test(e))&&(i=o[3]);let l=`"rgba(${o[0]},${o[1]},${o[2]},${i})"`,h=`"rgb(${s[0]},${s[1]},${s[2]})"`,p='data:image/svg+xml;utf8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36"><path fill='+l+" stroke="+h+' stroke-width="2" d="M 17.692635,32.565644 C 15.71852,30.330584 13.290925,27.058065 11.6766,24.455732 9.3398623,20.688851 7.8905694,17.205334 7.6297492,14.728733 7.5616025,14.081649 7.5739557,12.528552 7.6513363,12.014724 8.1013861,9.0262716 9.8047068,6.3655569 12.310675,4.7364878 c 1.113691,-0.7239832 2.508083,-1.2834131 3.776687,-1.5152052 0.242945,-0.044389 0.451656,-0.09393 0.463804,-0.1100911 0.01215,-0.016161 0.638282,-0.025502 1.391411,-0.02076 1.088235,0.00685 1.450932,0.024316 1.766871,0.085071 2.650763,0.5097353 4.947142,1.8701891 6.498786,3.8501033 0.628018,0.8013587 1.297046,2.0200608 1.640967,2.9891872 0.191065,0.538399 0.427644,1.447408 0.477391,1.834287 0.0164,0.127546 0.0434,0.231902 0.06,0.231902 0.0166,0 0.03122,0.626135 0.03249,1.391411 0.0013,0.765276 -0.011,1.391411 -0.02726,1.391411 -0.01626,0 -0.05449,0.154049 -0.08495,0.342331 -0.08815,0.544879 -0.387235,1.721449 -0.604837,2.379406 -1.209421,3.656888 -4.014463,8.349762 -7.849521,13.132357 -0.790496,0.985807 -1.795217,2.167992 -1.842543,2.167992 -0.01896,0 -0.161766,-0.144111 -0.317336,-0.320246 z m 1.066937,-15.36525 c 0.133519,-0.02121 0.248766,-0.05657 0.256105,-0.07859 0.0073,-0.02202 0.04918,-0.03066 0.09298,-0.0192 0.0438,0.01145 0.107628,-0.0072 0.141834,-0.04137 0.03421,-0.03421 0.08456,-0.05474 0.111888,-0.04563 0.02733,0.0091 0.07703,-0.01077 0.110429,-0.04417 0.03341,-0.03341 0.08416,-0.05293 0.112796,-0.04338 0.02863,0.0095 0.08974,-0.01867 0.135802,-0.06271 0.04606,-0.04403 0.111902,-0.08625 0.146319,-0.09381 0.204084,-0.04483 0.762371,-0.519108 1.079463,-0.917027 0.26749,-0.335672 0.570987,-0.878795 0.529019,-0.946701 -0.01496,-0.0242 -0.0067,-0.044 0.01835,-0.044 0.05645,0 0.196809,-0.467982 0.158801,-0.529481 -0.01521,-0.02461 -0.0043,-0.04475 0.02427,-0.04475 0.03157,0 0.04365,-0.04329 0.03082,-0.11043 -0.01161,-0.06074 -0.0066,-0.110429 0.01124,-0.110429 0.01779,0 0.03235,-0.258405 0.03235,-0.574233 0,-0.315829 -0.01545,-0.574234 -0.03434,-0.574234 -0.01889,0 -0.02437,-0.03811 -0.01219,-0.08469 0.04412,-0.168712 -0.336329,-1.152668 -0.481536,-1.245401 -0.02327,-0.01486 -0.04022,-0.03992 -0.03765,-0.05568 0.01222,-0.07498 -0.156557,-0.318365 -0.406379,-0.586027 -0.295921,-0.317054 -0.773059,-0.690104 -0.83427,-0.652274 -0.0206,0.01273 -0.03745,0.0024 -0.03745,-0.02289 0,-0.06107 -0.433076,-0.2789369 -0.487546,-0.245273 -0.02338,0.01445 -0.04251,0.0068 -0.04251,-0.01695 0,-0.056281 -0.393995,-0.1865457 -0.613804,-0.2029397 -0.0943,-0.00703 -0.188579,-0.023183 -0.209503,-0.035888 -0.02092,-0.012705 -0.276571,-0.023337 -0.568105,-0.023627 -0.534044,-5.301e-4 -1.12638,0.091025 -1.12638,0.1741017 0,0.023781 -0.01713,0.032648 -0.03808,0.019705 -0.05054,-0.031232 -0.403641,0.1088602 -0.403641,0.1601422 0,0.02204 -0.01988,0.02779 -0.04417,0.01278 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01988,0.0371 -0.04417,0.02209 -0.0243,-0.01501 -0.04417,-0.0051 -0.04417,0.02209 0,0.02716 -0.01915,0.03755 -0.04256,0.02308 -0.02341,-0.01447 -0.08138,0.01252 -0.128834,0.05997 -0.04745,0.04745 -0.0974,0.07515 -0.111001,0.06155 -0.0136,-0.0136 -0.03722,0.0078 -0.05248,0.0476 -0.01526,0.03978 -0.0411,0.06408 -0.0574,0.054 -0.03277,-0.02025 -0.462299,0.323995 -0.491977,0.394291 -0.01026,0.02429 -0.07454,0.0912 -0.142856,0.148686 -0.248033,0.208705 -0.730279,0.974169 -0.672565,1.067553 0.0145,0.02346 0.0059,0.04266 -0.01914,0.04266 -0.05907,0 -0.241471,0.599428 -0.208527,0.685278 0.01385,0.0361 0.0044,0.06564 -0.02098,0.06564 -0.02539,0 -0.04169,0.0646 -0.03622,0.143558 0.0055,0.07896 -0.0042,0.213129 -0.02144,0.29816 -0.04741,0.233576 0.0511,1.055502 0.167516,1.397721 0.126048,0.370516 0.310099,0.740163 0.426484,0.856548 0.04776,0.04776 0.07554,0.08684 0.06174,0.08684 -0.0138,0 0.01516,0.05653 0.06436,0.125632 0.131301,0.184396 0.499365,0.587266 0.518785,0.567846 0.0092,-0.0092 0.09821,0.06081 0.197812,0.155562 0.09961,0.09475 0.190589,0.162786 0.202187,0.151188 0.0116,-0.0116 0.05991,0.01774 0.107361,0.06519 0.04745,0.04745 0.105426,0.07444 0.128834,0.05997 0.02341,-0.01447 0.04256,-0.0057 0.04256,0.01958 0,0.06106 0.344664,0.23496 0.399061,0.201341 0.02346,-0.0145 0.04266,-0.0059 0.04266,0.01914 0,0.05907 0.599429,0.241471 0.685279,0.208527 0.0361,-0.01385 0.06564,-0.0065 0.06564,0.01645 0,0.05196 1.079115,0.04833 1.413314,-0.0048 z"></path></svg>';return new oi({image:new Bs({src:p,opacity:i,anchor:[.5,.92]}),text:new so({text:r,font:"12px Calibri,sans-serif",fill:new hi({color:"#000"}),stroke:new ui({color:"#fff",width:3}),overflow:!0})})}var iR=function(r){return r[r.GeoJSON=0]="GeoJSON",r[r.JSON=1]="JSON",r}(iR||{}),rR=function(r){return r.Route="route",r.Trip="trip",r}(rR||{}),Ab=function(r){return r.Coord="coord",r.Text="text",r}(Ab||{}),Rp=function(r){return r.Stop="stop",r.Route="route",r.Vertex="vertex",r}(Rp||{}),Sg=function(r){return r.Start="start",r.Intermediate="intermediate",r.End="end",r}(Sg||{}),Wl=function(r){return r.Turn="turn",r.NewName="new name",r.Depart="depart",r.Arrive="arrive",r.Merge="merge",r.Ramp="ramp",r.OnRamp="on ramp",r.OffRamp="off ramp",r.Fork="fork",r.EndOfRoad="end of road",r.UseLane="use lane",r.Continue="continue",r.Roundabout="roundabout",r.Rotary="rotary",r.RoundaboutTurn="roundabout turn",r.Notification="notification",r.ExitRoundabout="exit roundabout",r.ExitRotary="exit rotary",r}(Wl||{}),gc=function(r){return r.Uturn="uturn",r.SharpRight="sharp right",r.Right="right",r.SlightRight="slight right",r.SharpLeft="sharp left",r.Left="left",r.SlightLeft="slight left",r.Straight="straight",r}(gc||{});function n2(r,i="asc",e="position"){r.view.sort({direction:i,valueAccessor:n=>n[e]})}function r2(r,i){let e=Sg.Intermediate;return r===0?e=Sg.Start:r===i&&(e=Sg.End),e}function Wfe(r,i){for(let e of i.all())e.position=e.position>r?e.position-=1:e.position,e.relativePosition=r2(e.position,i.all().length-1)}function o2(r){let i=rn(),e=r.all(),n=e.length;for(let o of r.all())o.relativePosition=r2(o.position,e.length);return r.insert({id:i,position:n,relativePosition:r2(n,e.length)}),n2(r),r.get(i)}function Wq(r,i){r.delete(i),Wfe(i.position,r)}function nR(r){let i=[new oi({geometry:r.getGeometry(),image:new an({radius:7,stroke:new ui({color:"#FF0000",width:3})})})],e=t_({text:r.get("stopText"),opacity:r.get("stopOpacity"),markerColor:r.get("stopColor"),markerOutlineColor:[255,255,255]}),n=[new oi({stroke:new ui({color:`rgba(106, 121, 130, ${r.get("active")?.75:0})`,width:10})}),new oi({stroke:new ui({color:`rgba(79, 169, 221, ${r.get("active")?.75:0})`,width:6})})];if(r.get("type")===Rp.Stop)return e;if(r.get("type")===Rp.Vertex)return i;if(r.get("type")===Rp.Route)return n}function Hq(r,i){let e=new vl({motion:Yi.None}),n=new Fr({isIgoInternalLayer:!0,id:"igo-direction-stops-layer",title:i.translate.instant("igo.geo.directions.layer.stops"),zIndex:911,source:new kr,showInLayerList:!0,visible:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-stops-layer",links:[{syncedDelete:!0,linkedIds:["igo-direction-route-layer"],properties:[]}]},exportable:!0,browsable:!1,style:nR});bd(r,n),Jm(r,e)}function qq(r,i){let e=new vl({motion:Yi.None}),n=new Fr({isIgoInternalLayer:!0,id:"igo-direction-route-layer",title:i.translate.instant("igo.geo.directions.layer.route"),zIndex:910,source:new kr,showInLayerList:!0,visible:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!0,browsable:!1,style:nR});bd(r,n),Jm(r,e)}function Yq(r){let i=new vl({motion:Yi.None}),e=new Fr({isIgoInternalLayer:!0,id:"igo-direction-step-layer",title:"",zIndex:910,source:new kr,showInLayerList:!1,visible:!0,workspace:{enabled:!1},linkedLayers:{linkId:"igo-direction-route-layer"},exportable:!1,browsable:!1,style:nR});bd(r,e),Jm(r,i)}function Zq(r,i,e,n){let o,s;switch(r.relativePosition){case Sg.Start:o="#008000",s=n.translate.instant("igo.geo.directions.input.start");break;case Sg.End:o="#f64139",s=n.translate.instant("igo.geo.directions.input.end");break;default:o="#ffd700",s=n.translate.instant("igo.geo.directions.input.intermediate")+" #"+r.position;break}let l=new Ii(Sr(r.coordinates,e,i.map.projectionCode)),h=new Qr().writeGeometryObject(l,{featureProjection:i.map.projectionCode,dataProjection:i.map.projectionCode}),p=i.get(r.id),m=p?p.meta.revision:0,f={type:vr,geometry:h,projection:i.map.projectionCode,properties:{id:r.id,type:Rp.Stop,stopText:s,stopColor:o,stopOpacity:1,stop:r},meta:{id:r.id,revision:m+1},ol:new gi({point:l})};i.update(f)}function Xq(r,i,e,n=!1){let o=i.geometry.coordinates,l=new Tr(o).transform(e,r.map.projectionCode),h=new Qr().writeGeometryObject(l,{featureProjection:r.map.projectionCode,dataProjection:r.map.projectionCode}),p=r.get(i.id),m=p?p.meta.revision:0,f={type:vr,geometry:h,projection:r.map.projectionCode,properties:{id:i.id,type:Rp.Route,active:n,directions:i},meta:{id:i.id,revision:m+1},ol:new gi({linestringStore:l})};r.update(f)}function i_(r){if(r===0)return;if(r<1e3)return`${Math.round(r)} m`;let i=r/1e3,e=i>=10?1:0;return`${Ax.roundToNDecimal(i,e)} km`.replace(".",",")}function r_(r){let i=Math.floor(r/3600),e=Math.floor(r%3600/60);return i?`${i} h ${e} min`:e?`${e} min`:"< 1 min"}function Mb(r,i,e=!1){let n=r.maneuver.type,o=r.maneuver.modifier,s=r.name,l=r.maneuver.bearing_after,h=i.translate,p=qfe(l,i),m=Hfe(o,i),f="straight",g="";if(n===Wl.Turn)o===gc.Uturn||o===gc.Straight?(g=h.instant(`igo.geo.directions.results.maneuverType.turn.${o}`,{maneuverModifier:m,name:s}),o===gc.Uturn&&(f="u_turn_left")):(g=h.instant("igo.geo.directions.results.maneuverType.turn.else",{maneuverModifier:m,name:s}),o===gc.SlightRight?f="turn_slight_right":o===gc.Right||o===gc.SharpRight?f="turn_right":o===gc.Left||o===gc.SharpLeft?f="turn_left":o===gc.SlightLeft&&(f="turn_slight_left"));else if(n===Wl.NewName)g=h.instant("igo.geo.directions.results.maneuverType.new name",{name:s,maneuverBearing:p});else if(n===Wl.Depart)f="directions",g=h.instant("igo.geo.directions.results.maneuverType.depart",{name:s,maneuverBearing:p});else if(n===Wl.Arrive)f="sports_score",g=h.instant(`igo.geo.directions.results.maneuverType.arrive.${e?"lastStep":"intermediate"}`,{name:s});else if(n===Wl.Merge)g=h.instant("igo.geo.directions.results.maneuverType.merge",{name:s}),f="merge";else if(n===Wl.OnRamp||n===Wl.OffRamp)g=h.instant(`igo.geo.directions.results.maneuverType.${n}`,{maneuverModifier:m});else if(n===Wl.Fork){let y=o.search("left")>=0?"left":"right";f=y==="left"?"turn_slight_left":"turn_slight_right",g=h.instant(`igo.geo.directions.results.maneuverType.fork.${y}`,{name:s})}else if(n===Wl.EndOfRoad||n===Wl.UseLane||n===Wl.Continue)n===Wl.Continue?o===gc.Uturn?(f="u_turn_left",g=h.instant(`igo.geo.directions.results.maneuverType.turn.${o}`,{maneuverModifier:m,name:s})):g=h.instant(`igo.geo.directions.results.maneuverType.${n}`,{maneuverModifier:m,name:s}):(o===gc.SharpRight||o===gc.Right?f="turn_right":o===gc.SharpLeft||o===gc.Left?f="turn_left":o===gc.SlightRight?f="turn_slight_right":o===gc.SlightLeft&&(f="turn_slight_left"),g=h.instant(`igo.geo.directions.results.maneuverType.${n}`,{maneuverModifier:m,name:s}));else if(n===Wl.Roundabout||n===Wl.Rotary||n===Wl.RoundaboutTurn||n===Wl.ExitRoundabout){let y=n.replace("roundabout ","");g=h.instant(`igo.geo.directions.results.maneuverType.${y}`,{name:s}),f="donut_large"}else n===Wl.Notification&&(g=h.instant("igo.geo.directions.results.maneuverType.notification"));return{instruction:g,iconName:f}}function Hfe(r,i){let e=i.translate;return r?e.instant(`igo.geo.directions.results.maneuverModifier.${r}`):void 0}function qfe(r,i){let e=i.translate,n=["n","ne","e","se","s","sw","w","nw"],o=Math.round(r/45)%8;return e.instant(`igo.geo.directions.results.direction.${n[o]}`)}var jy=(()=>{class r{directionsSourceService;configService;languageService;printService;document;activityService;constructor(e,n,o,s,l,h){this.directionsSourceService=e,this.configService=n,this.languageService=o,this.printService=s,this.document=l,this.activityService=h}route(e,n={}){return e.length===0?void 0:this.directionsSourceService.sources[0].route(e,n)}downloadDirections(e,n){let o=this.activityService.register(),s=new Si,l=new Ui({orientation:"p",format:"letter",unit:"mm"}),h=l.internal.pageSize,p=[30,10,20,10],m=h.getWidth()-p[3]-p[1],f=h.getHeight()-p[0]-p[2],g=[m,f],y=i_(n.distance),_=r_(n.duration),w=y&&_?`${n.title} (${y} - ${_})`:n.title;return l.text(w,h.getWidth()/2,25,{align:"center"}),this.printService.addMap(l,e,96,g,p).subscribe(k=>un(this,null,function*(){k===dn.Done&&(yield this.addInstructions(l,n,w),this.setPageHeaderFooter(l),yield l.save(`${w}.pdf`,{returnPromise:!0})),this.activityService.unregister(o),s.next(k)})),s}setHTMLTableDirections(e){return un(this,null,function*(){let n=yield this.directionsSteps(e),o=document.createElement("table"),s=document.createElement("tbody");for(let l of n){let h=document.createElement("tr"),p=document.createElement("td"),m=document.createElement("img");m.style.verticalAlign="middle",m.src=l.icon,p.appendChild(m),h.append(p);let f=document.createElement("td"),g=document.createElement("span");if(g.style.verticalAlign="middle",g.innerHTML=l.instruction,f.appendChild(g),l.distanceDuration){let y=document.createElement("span");y.style.verticalAlign="middle",y.innerHTML=" "+l.distanceDuration,f.appendChild(y)}h.append(f),s.appendChild(h)}return o.appendChild(s),o})}directionsSteps(e){return un(this,null,function*(){let o=this.document.getElementsByTagName("igo-directions-results")[0].getElementsByTagName("mat-list")[0].getElementsByTagName("mat-list-item"),s=[];for(let h of Array.from(o)){let p=h.getElementsByTagName("mat-icon")[0],m=p.innerText;if(!s.some(g=>g.name===m)){let g=yield(0,Kq.default)(p);s.push({name:m,icon:g.toDataURL()})}}let l=[];for(let h=0;h<e.steps.length;h++){let p=e.steps[h],m=Mb(p,this.languageService,h===e.steps.length-1),f=i_(p.distance),g=r_(p.duration);(f&&g||h===e.steps.length-1)&&l.push({instruction:`${m.instruction}`,icon:s.find(y=>y.name===m.iconName).icon,distanceDuration:f&&g?`(${f} - ${g})`:""})}return l})}addInstructions(e,n,o){return un(this,null,function*(){e.addPage(),e.text(o,e.internal.pageSize.getWidth()/2,25,{align:"center"});let s=yield this.setHTMLTableDirections(n);VU(e,{html:s,startY:30,margin:{top:20,bottom:20},columnStyles:{0:{cellWidth:10}},theme:"plain",styles:{fontSize:10},didDrawCell:function(l){if(l.column.index===0&&l.cell.section==="body"){l.row.height=10;let p=l.cell.raw.getElementsByTagName("img")[0];e.addImage(p.src,l.cell.x,l.cell.y,8,8)}}})})}setPageHeaderFooter(e){let n=e.getNumberOfPages(),o=(0,Qq.default)(Date.now()).format("YYYY-MM-DD HH:mm"),s=this.configService.getConfig("directionsSources.logo")?this.configService.getConfig("directionsSources.logo"):"assets/logo.png";for(let l=0;l<n;l++){e.setPage(l),e.setFontSize(8);let h=e.internal.pageSize;e.text(o,10,10,{baseline:"top"}),e.addImage(s,"PNG",h.getWidth()-20,5,10,10),e.text(o,10,h.getHeight()-10),e.text("Page "+e.getCurrentPageInfo().pageNumber+" / "+n,h.getWidth()-20,h.getHeight()-10)}}static \u0275fac=function(n){return new(n||r)(pt(k0),pt(Oi),pt(Di),pt(JM),pt(rc),pt(Wf))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var Jq=class extends Lh{storeInitialized$=new ut(!1);clearStops(){this.storeInitialized$.next(!1),this.clear()}},eY=class extends is{},tY=class extends is{},iY=class extends is{};var q5=(()=>{class r{languageService;messageService;routeService;directionsService;contextUri;zoomOnActiveRoute$=new Si;stopsStore;routesFeatureStore;stepsFeatureStore;downloadDirectionsBtnDisabled=!1;constructor(e,n,o,s){this.languageService=e,this.messageService=n,this.routeService=o,this.directionsService=s}get activeRoute(){return this.routesFeatureStore.all().find(e=>e.properties.active)}resetStops(){this.stopsStore.clearStops()}zoomOnActiveRoute(){this.zoomOnActiveRoute$.next()}copyDirectionsToClipboard(){let e=this.directionsToText();Cx.copy(e)&&this.messageService.success("igo.geo.directions.buttons.message.copyDirections")}copyLinkToClipboard(){Cx.copy(this.getLink())&&this.messageService.success("igo.geo.directions.buttons.message.copyLink")}downloadDirections(){this.stepsFeatureStore.clear(),this.downloadDirectionsBtnDisabled=!0,this.directionsService.downloadDirections(this.routesFeatureStore.map,this.activeRoute.properties.directions).subscribe(()=>{this.downloadDirectionsBtnDisabled=!1})}directionsToText(){let e="	",n=`
`,o=this.languageService.translate.instant("igo.geo.directions.directionsText.summary")+":"+n+e+this.activeRoute.properties.directions.title,s=i_(this.activeRoute.properties.directions.distance),l=r_(this.activeRoute.properties.directions.duration);s&&l&&(o+=" ("+s+" - "+l+")"),o+=n+n;let h=this.languageService.translate.instant("igo.geo.directions.directionsText.stopList")+":"+n,p=1;this.stopsStore.view.all().forEach(y=>{let _="",w="";y.text!==Rh(y.coordinates,6).join(", ")?(w=y.text,_=` (${Rh(y.coordinates,6).join(", ")})`):w=Rh(y.coordinates,6).join(", "),h=h+e+p.toLocaleString()+". "+w+_+n,p++}),h+=n;let m=this.languageService.translate.instant("igo.geo.directions.directionsText.link")+":"+n+e+this.getLink()+n+n,f=this.languageService.translate.instant("igo.geo.directions.directions")+":"+n;return this.activeRoute.properties.directions.steps.forEach((y,_,w)=>{let A=i_(y.distance),k=r_(y.duration);if(A&&k||_===w.length-1){let R=this.getFormattedStepInstruction(y,_),q=A&&k?` (${A} - ${k}) `:"";f=f+e+"- "+R+q+n}}),o+h+m+f}getFormattedStepInstruction(e,n){return Mb(e,this.languageService,n===this.activeRoute.properties.directions.steps.length-1).instruction}getLink(){if(!this.routeService)return;let e="";this.contextUri&&(e=`context=${this.contextUri}&`);let n=this.routesFeatureStore.all().map(p=>p.properties.id).indexOf(this.activeRoute.properties.id),o="";n!==0&&(o=`&${this.routeService.options.directionsOptionsKey}=result:${n}`);let s=this.routeService.options.directionsCoordKey,l=this.stopsStore.view.all().map(p=>uc(p.coordinates,6)),h="";if(l.length>=2)return h=`${s}=${l.join(";")}`,`${location.origin}${location.pathname}?${e}tool=directions&sidenav=1&${h}${o}`}static \u0275fac=function(n){return new(n||r)(Ie(Di),Ie(Gn),Ie(v9,8),Ie(jy))};static \u0275cmp=nt({type:r,selectors:[["igo-directions-buttons"]],inputs:{contextUri:"contextUri",zoomOnActiveRoute$:"zoomOnActiveRoute$",stopsStore:"stopsStore",routesFeatureStore:"routesFeatureStore",stepsFeatureStore:"stepsFeatureStore"},standalone:!0,features:[lt],decls:20,vars:16,consts:[["mat-icon-button","","color","warn",3,"click","matTooltip"],["mat-icon-button","","color","primary",3,"click","matTooltip"],["mat-icon-button","","color","primary",3,"click","disabled","matTooltip"]],template:function(n,o){n&1&&($(0,"button",0),le(1,"translate"),ve("click",function(){return o.resetStops()}),$(2,"mat-icon"),_e(3,"restart_alt"),ee()(),$(4,"button",1),le(5,"translate"),ve("click",function(){return o.zoomOnActiveRoute()}),$(6,"mat-icon"),_e(7,"frame_inspect"),ee()(),$(8,"button",1),le(9,"translate"),ve("click",function(){return o.copyDirectionsToClipboard()}),$(10,"mat-icon"),_e(11,"content_copy"),ee()(),$(12,"button",1),le(13,"translate"),ve("click",function(){return o.copyLinkToClipboard()}),$(14,"mat-icon"),_e(15,"link"),ee()(),$(16,"button",2),le(17,"translate"),ve("click",function(){return o.downloadDirections()}),$(18,"mat-icon"),_e(19,"download"),ee()()),n&2&&(z("matTooltip",ce(1,6,"igo.geo.directions.buttons.resetStops")),j(4),z("matTooltip",ce(5,8,"igo.geo.directions.buttons.zoomOnRoute")),j(4),z("matTooltip",ce(9,10,"igo.geo.directions.buttons.copyDirections")),j(4),z("matTooltip",ce(13,12,"igo.geo.directions.buttons.copyLink")),j(4),z("disabled",o.downloadDirectionsBtnDisabled)("matTooltip",ce(17,14,"igo.geo.directions.buttons.downloadDirections")))},dependencies:[Vt,ci,Qt,ti,jt,$t,Et,Tt]})}return r})();function vY(r){let i=r.cloneNode(!0),e=i.querySelectorAll("[id]"),n=r.nodeName.toLowerCase();i.removeAttribute("id");for(let o=0;o<e.length;o++)e[o].removeAttribute("id");return n==="canvas"?oY(r,i):(n==="input"||n==="select"||n==="textarea")&&nY(r,i),rY("canvas",r,i,oY),rY("input, textarea, select",r,i,nY),i}function rY(r,i,e,n){let o=i.querySelectorAll(r);if(o.length){let s=e.querySelectorAll(r);for(let l=0;l<o.length;l++)n(o[l],s[l])}}var Kfe=0;function nY(r,i){i.type!=="file"&&(i.value=r.value),i.type==="radio"&&i.name&&(i.name=`mat-clone-${i.name}-${Kfe++}`)}function oY(r,i){let e=i.getContext("2d");if(e)try{e.drawImage(r,0,0)}catch{}}function hR(r){let i=r.getBoundingClientRect();return{top:i.top,right:i.right,bottom:i.bottom,left:i.left,width:i.width,height:i.height,x:i.x,y:i.y}}function aR(r,i,e){let{top:n,bottom:o,left:s,right:l}=r;return e>=n&&e<=o&&i>=s&&i<=l}function s2(r,i,e){r.top+=i,r.bottom=r.top+r.height,r.left+=e,r.right=r.left+r.width}function aY(r,i,e,n){let{top:o,right:s,bottom:l,left:h,width:p,height:m}=r,f=p*i,g=m*i;return n>o-g&&n<l+g&&e>h-f&&e<s+f}var K5=class{constructor(i){this._document=i,this.positions=new Map}clear(){this.positions.clear()}cache(i){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),i.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:hR(e)})})}handleScroll(i){let e=bx(i),n=this.positions.get(e);if(!n)return null;let o=n.scrollPosition,s,l;if(e===this._document){let m=this.getViewportScrollPosition();s=m.top,l=m.left}else s=e.scrollTop,l=e.scrollLeft;let h=o.top-s,p=o.left-l;return this.positions.forEach((m,f)=>{m.clientRect&&e!==f&&e.contains(f)&&s2(m.clientRect,h,p)}),o.top=s,o.left=l,{top:h,left:p}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function bY(r,i){let e=r.rootNodes;if(e.length===1&&e[0].nodeType===i.ELEMENT_NODE)return e[0];let n=i.createElement("div");return e.forEach(o=>n.appendChild(o)),n}function pR(r,i,e){for(let n in i)if(i.hasOwnProperty(n)){let o=i[n];o?r.setProperty(n,o,e?.has(n)?"important":""):r.removeProperty(n)}return r}function Ib(r,i){let e=i?"":"none";pR(r.style,{"touch-action":i?"":"none","-webkit-user-drag":i?"":"none","-webkit-tap-highlight-color":i?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function sY(r,i,e){pR(r.style,{position:i?"":"fixed",top:i?"":"0",opacity:i?"":"0",left:i?"":"-999em"},e)}function Q5(r,i){return i&&i!="none"?r+" "+i:r}function lY(r,i){r.style.width=`${i.width}px`,r.style.height=`${i.height}px`,r.style.transform=J5(i.left,i.top)}function J5(r,i){return`translate3d(${Math.round(r)}px, ${Math.round(i)}px, 0)`}function cY(r){let i=r.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(r)*i}function Qfe(r){let i=getComputedStyle(r),e=oR(i,"transition-property"),n=e.find(h=>h==="transform"||h==="all");if(!n)return 0;let o=e.indexOf(n),s=oR(i,"transition-duration"),l=oR(i,"transition-delay");return cY(s[o])+cY(l[o])}function oR(r,i){return r.getPropertyValue(i).split(",").map(n=>n.trim())}var Jfe=new Set(["position"]),sR=class{get element(){return this._preview}constructor(i,e,n,o,s,l,h,p,m){this._document=i,this._rootElement=e,this._direction=n,this._initialDomRect=o,this._previewTemplate=s,this._previewClass=l,this._pickupPositionOnPage=h,this._initialTransform=p,this._zIndex=m}attach(i){this._preview=this._createPreview(),i.appendChild(this._preview),uY(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(i){this._preview.style.transform=i}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(i){this._preview.classList.add(i)}getTransitionDuration(){return Qfe(this._preview)}addEventListener(i,e){this._preview.addEventListener(i,e)}removeEventListener(i,e){this._preview.removeEventListener(i,e)}_createPreview(){let i=this._previewTemplate,e=this._previewClass,n=i?i.template:null,o;if(n&&i){let s=i.matchSize?this._initialDomRect:null,l=i.viewContainer.createEmbeddedView(n,i.context);l.detectChanges(),o=bY(l,this._document),this._previewEmbeddedView=l,i.matchSize?lY(o,s):o.style.transform=J5(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else o=vY(this._rootElement),lY(o,this._initialDomRect),this._initialTransform&&(o.style.transform=this._initialTransform);return pR(o.style,{"pointer-events":"none",margin:uY(o)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},Jfe),Ib(o,!1),o.classList.add("cdk-drag-preview"),o.setAttribute("popover","manual"),o.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(s=>o.classList.add(s)):o.classList.add(e)),o}};function uY(r){return"showPopover"in r}var dY=Q_({passive:!0}),Y5=Q_({passive:!1}),hY=Q_({passive:!1,capture:!0}),ege=800,pY=new Set(["position"]),lR=class{get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(i){i!==this._disabled&&(this._disabled=i,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Ib(e,i)))}constructor(i,e,n,o,s,l){this._config=e,this._document=n,this._ngZone=o,this._viewportRuler=s,this._dragDropRegistry=l,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=K_(!1),this._moveEvents=new Si,this._pointerMoveSubscription=Es.EMPTY,this._pointerUpSubscription=Es.EMPTY,this._scrollSubscription=Es.EMPTY,this._resizeSubscription=Es.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this.scale=1,this._disabled=!1,this.beforeStarted=new Si,this.started=new Si,this.released=new Si,this.ended=new Si,this.entered=new Si,this.exited=new Si,this.dropped=new Si,this.moved=this._moveEvents,this._pointerDown=h=>{if(this.beforeStarted.next(),this._handles.length){let p=this._getTargetHandle(h);p&&!this._disabledHandles.has(p)&&!this.disabled&&this._initializeDragSequence(p,h)}else this.disabled||this._initializeDragSequence(this._rootElement,h)},this._pointerMove=h=>{let p=this._getPointerPositionOnPage(h);if(!this._hasStartedDragging()){let f=Math.abs(p.x-this._pickupPositionOnPage.x),g=Math.abs(p.y-this._pickupPositionOnPage.y);if(f+g>=this._config.dragStartThreshold){let _=Date.now()>=this._dragStartTime+this._getDragStartDelay(h),w=this._dropContainer;if(!_){this._endDragSequence(h);return}(!w||!w.isDragging()&&!w.isReceiving())&&(h.cancelable&&h.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(h)))}return}h.cancelable&&h.preventDefault();let m=this._getConstrainedPointerPosition(p);if(this._hasMoved=!0,this._lastKnownPointerPosition=p,this._updatePointerDirectionDelta(m),this._dropContainer)this._updateActiveDropContainer(m,p);else{let f=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,g=this._activeTransform;g.x=m.x-f.x+this._passiveTransform.x,g.y=m.y-f.y+this._passiveTransform.y,this._applyRootElementTransform(g.x,g.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:m,event:h,distance:this._getDragDistance(m),delta:this._pointerDirectionDelta})})},this._pointerUp=h=>{this._endDragSequence(h)},this._nativeDragStart=h=>{if(this._handles.length){let p=this._getTargetHandle(h);p&&!this._disabledHandles.has(p)&&!this.disabled&&h.preventDefault()}else this.disabled||h.preventDefault()},this.withRootElement(i).withParent(e.parentDragRef||null),this._parentPositions=new K5(n),l.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(i){this._handles=i.map(n=>l0(n)),this._handles.forEach(n=>Ib(n,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&e.add(n)}),this._disabledHandles=e,this}withPreviewTemplate(i){return this._previewTemplate=i,this}withPlaceholderTemplate(i){return this._placeholderTemplate=i,this}withRootElement(i){let e=l0(i);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{e.addEventListener("mousedown",this._pointerDown,Y5),e.addEventListener("touchstart",this._pointerDown,dY),e.addEventListener("dragstart",this._nativeDragStart,Y5)}),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(i){return this._boundaryElement=i?l0(i):null,this._resizeSubscription.unsubscribe(),i&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(i){return this._parentDragRef=i,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(i){!this._disabledHandles.has(i)&&this._handles.indexOf(i)>-1&&(this._disabledHandles.add(i),Ib(i,!0))}enableHandle(i){this._disabledHandles.has(i)&&(this._disabledHandles.delete(i),Ib(i,this.disabled))}withDirection(i){return this._direction=i,this}_withDropContainer(i){this._dropContainer=i}getFreeDragPosition(){let i=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:i.x,y:i.y}}setFreeDragPosition(i){return this._activeTransform={x:0,y:0},this._passiveTransform.x=i.x,this._passiveTransform.y=i.y,this._dropContainer||this._applyRootElementTransform(i.x,i.y),this}withPreviewContainer(i){return this._previewContainer=i,this}_sortFromLastPointerPosition(){let i=this._lastKnownPointerPosition;i&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(i),i)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._getShadowRoot()?.removeEventListener("selectstart",fY,hY)}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(i){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:i}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(i),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(i);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:i})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(i){a2(i)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),n=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{e.addEventListener("selectstart",fY,hY)}),n){let o=this._rootElement,s=o.parentNode,l=this._placeholder=this._createPlaceholderElement(),h=this._anchor=this._anchor||this._document.createComment("");s.insertBefore(h,o),this._initialTransform=o.style.transform||"",this._preview=new sR(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3),this._preview.attach(this._getPreviewInsertionPoint(s,e)),sY(o,!1,pY),this._document.body.appendChild(s.replaceChild(l,o)),this.started.next({source:this,event:i}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:i}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(i,e){this._parentDragRef&&e.stopPropagation();let n=this.isDragging(),o=a2(e),s=!o&&e.button!==0,l=this._rootElement,h=bx(e),p=!o&&this._lastTouchEventTime&&this._lastTouchEventTime+ege>Date.now(),m=o?U7(e):V7(e);if(h&&h.draggable&&e.type==="mousedown"&&e.preventDefault(),n||s||p||m)return;if(this._handles.length){let y=l.style;this._rootElementTapHighlight=y.webkitTapHighlightColor||"",y.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(y=>this._updateOnScroll(y)),this._boundaryElement&&(this._boundaryRect=hR(this._boundaryElement));let f=this._previewTemplate;this._pickupPositionInElement=f&&f.template&&!f.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,i,e);let g=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:g.x,y:g.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(i){sY(this._rootElement,!0,pY),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,n=e.getItemIndex(this),o=this._getPointerPositionOnPage(i),s=this._getDragDistance(o),l=e._isOverContainer(o.x,o.y);this.ended.next({source:this,distance:s,dropPoint:o,event:i}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:l,distance:s,dropPoint:o,event:i}),e.drop(this,n,this._initialIndex,this._initialContainer,l,s,o,i),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:i,y:e},{x:n,y:o}){let s=this._initialContainer._getSiblingContainerFromPosition(this,i,e);!s&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(i,e)&&(s=this._initialContainer),s&&s!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=s,this._dropContainer.enter(this,i,e,s===this._initialContainer&&s.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:s,currentIndex:s.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,o),this._dropContainer._sortItem(this,i,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(i,e):this._applyPreviewTransform(i-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let i=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(i.left,i.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let o=l=>{(!l||this._preview&&bx(l)===this._preview.element&&l.propertyName==="transform")&&(this._preview?.removeEventListener("transitionend",o),n(),clearTimeout(s))},s=setTimeout(o,e*1.5);this._preview.addEventListener("transitionend",o)}))}_createPlaceholderElement(){let i=this._placeholderTemplate,e=i?i.template:null,n;return e?(this._placeholderRef=i.viewContainer.createEmbeddedView(e,i.context),this._placeholderRef.detectChanges(),n=bY(this._placeholderRef,this._document)):n=vY(this._rootElement),n.style.pointerEvents="none",n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(i,e,n){let o=e===this._rootElement?null:e,s=o?o.getBoundingClientRect():i,l=a2(n)?n.targetTouches[0]:n,h=this._getViewportScrollPosition(),p=l.pageX-s.left-h.left,m=l.pageY-s.top-h.top;return{x:s.left-i.left+p,y:s.top-i.top+m}}_getPointerPositionOnPage(i){let e=this._getViewportScrollPosition(),n=a2(i)?i.touches[0]||i.changedTouches[0]||{pageX:0,pageY:0}:i,o=n.pageX-e.left,s=n.pageY-e.top;if(this._ownerSVGElement){let l=this._ownerSVGElement.getScreenCTM();if(l){let h=this._ownerSVGElement.createSVGPoint();return h.x=o,h.y=s,h.matrixTransform(l.inverse())}}return{x:o,y:s}}_getConstrainedPointerPosition(i){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:o}=this.constrainPosition?this.constrainPosition(i,this,this._initialDomRect,this._pickupPositionInElement):i;if(this.lockAxis==="x"||e==="x"?o=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:s,y:l}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,h=this._boundaryRect,{width:p,height:m}=this._getPreviewRect(),f=h.top+l,g=h.bottom-(m-l),y=h.left+s,_=h.right-(p-s);n=mY(n,y,_),o=mY(o,f,g)}return{x:n,y:o}}_updatePointerDirectionDelta(i){let{x:e,y:n}=i,o=this._pointerDirectionDelta,s=this._pointerPositionAtLastDirectionChange,l=Math.abs(e-s.x),h=Math.abs(n-s.y);return l>this._config.pointerDirectionChangeThreshold&&(o.x=e>s.x?1:-1,s.x=e),h>this._config.pointerDirectionChangeThreshold&&(o.y=n>s.y?1:-1,s.y=n),o}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let i=this._handles.length>0||!this.isDragging();i!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=i,Ib(this._rootElement,i))}_removeRootElementListeners(i){i.removeEventListener("mousedown",this._pointerDown,Y5),i.removeEventListener("touchstart",this._pointerDown,dY),i.removeEventListener("dragstart",this._nativeDragStart,Y5)}_applyRootElementTransform(i,e){let n=1/this.scale,o=J5(i*n,e*n),s=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=s.transform&&s.transform!="none"?s.transform:""),s.transform=Q5(o,this._initialTransform)}_applyPreviewTransform(i,e){let n=this._previewTemplate?.template?void 0:this._initialTransform,o=J5(i,e);this._preview.setTransform(Q5(o,n))}_getDragDistance(i){let e=this._pickupPositionOnPage;return e?{x:i.x-e.x,y:i.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:i,y:e}=this._passiveTransform;if(i===0&&e===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),o=this._boundaryElement.getBoundingClientRect();if(o.width===0&&o.height===0||n.width===0&&n.height===0)return;let s=o.left-n.left,l=n.right-o.right,h=o.top-n.top,p=n.bottom-o.bottom;o.width>n.width?(s>0&&(i+=s),l>0&&(i-=l)):i=0,o.height>n.height?(h>0&&(e+=h),p>0&&(e-=p)):e=0,(i!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:i})}_getDragStartDelay(i){let e=this.dragStartDelay;return typeof e=="number"?e:a2(i)?e.touch:e?e.mouse:0}_updateOnScroll(i){let e=this._parentPositions.handleScroll(i);if(e){let n=bx(i);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&s2(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=TA(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(i,e){let n=this._previewContainer||"global";if(n==="parent")return i;if(n==="global"){let o=this._document;return e||o.fullscreenElement||o.webkitFullscreenElement||o.mozFullScreenElement||o.msFullscreenElement||o.body}return l0(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_getTargetHandle(i){return this._handles.find(e=>i.target&&(i.target===e||e.contains(i.target)))}};function mY(r,i,e){return Math.max(i,Math.min(e,r))}function a2(r){return r.type[0]==="t"}function fY(r){r.preventDefault()}function tE(r,i,e){let n=gY(i,r.length-1),o=gY(e,r.length-1);if(n===o)return;let s=r[n],l=o<n?-1:1;for(let h=n;h!==o;h+=l)r[h]=r[h+l];r[o]=s}function gY(r,i){return Math.max(0,Math.min(i,r))}var eE=class{constructor(i){this._dragDropRegistry=i,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(i){this.withItems(i)}sort(i,e,n,o){let s=this._itemPositions,l=this._getItemIndexFromPointerPosition(i,e,n,o);if(l===-1&&s.length>0)return null;let h=this.orientation==="horizontal",p=s.findIndex(k=>k.drag===i),m=s[l],f=s[p].clientRect,g=m.clientRect,y=p>l?1:-1,_=this._getItemOffsetPx(f,g,y),w=this._getSiblingOffsetPx(p,s,y),A=s.slice();return tE(s,p,l),s.forEach((k,R)=>{if(A[R]===k)return;let q=k.drag===i,X=q?_:w,ie=q?i.getPlaceholderElement():k.drag.getRootElement();k.offset+=X;let ae=Math.round(k.offset*(1/k.drag.scale));h?(ie.style.transform=Q5(`translate3d(${ae}px, 0, 0)`,k.initialTransform),s2(k.clientRect,0,X)):(ie.style.transform=Q5(`translate3d(0, ${ae}px, 0)`,k.initialTransform),s2(k.clientRect,X,0))}),this._previousSwap.overlaps=aR(g,e,n),this._previousSwap.drag=m.drag,this._previousSwap.delta=h?o.x:o.y,{previousIndex:p,currentIndex:l}}enter(i,e,n,o){let s=o==null||o<0?this._getItemIndexFromPointerPosition(i,e,n):o,l=this._activeDraggables,h=l.indexOf(i),p=i.getPlaceholderElement(),m=l[s];if(m===i&&(m=l[s+1]),!m&&(s==null||s===-1||s<l.length-1)&&this._shouldEnterAsFirstChild(e,n)&&(m=l[0]),h>-1&&l.splice(h,1),m&&!this._dragDropRegistry.isDragging(m)){let f=m.getRootElement();f.parentElement.insertBefore(p,f),l.splice(s,0,i)}else this._element.appendChild(p),l.push(i);p.style.transform="",this._cacheItemPositions()}withItems(i){this._activeDraggables=i.slice(),this._cacheItemPositions()}withSortPredicate(i){this._sortPredicate=i}reset(){this._activeDraggables?.forEach(i=>{let e=i.getRootElement();if(e){let n=this._itemPositions.find(o=>o.drag===i)?.initialTransform;e.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(i){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(n=>n.drag===i)}updateOnScroll(i,e){this._itemPositions.forEach(({clientRect:n})=>{s2(n,i,e)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(i){this._element=i}_cacheItemPositions(){let i=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let n=e.getVisibleElement();return{drag:e,offset:0,initialTransform:n.style.transform||"",clientRect:hR(n)}}).sort((e,n)=>i?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_getItemOffsetPx(i,e,n){let o=this.orientation==="horizontal",s=o?e.left-i.left:e.top-i.top;return n===-1&&(s+=o?e.width-i.width:e.height-i.height),s}_getSiblingOffsetPx(i,e,n){let o=this.orientation==="horizontal",s=e[i].clientRect,l=e[i+n*-1],h=s[o?"width":"height"]*n;if(l){let p=o?"left":"top",m=o?"right":"bottom";n===-1?h-=l.clientRect[p]-s[m]:h+=s[p]-l.clientRect[m]}return h}_shouldEnterAsFirstChild(i,e){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,o=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let l=n[n.length-1].clientRect;return o?i>=l.right:e>=l.bottom}else{let l=n[0].clientRect;return o?i<=l.left:e<=l.top}}_getItemIndexFromPointerPosition(i,e,n,o){let s=this.orientation==="horizontal",l=this._itemPositions.findIndex(({drag:h,clientRect:p})=>{if(h===i)return!1;if(o){let m=s?o.x:o.y;if(h===this._previousSwap.drag&&this._previousSwap.overlaps&&m===this._previousSwap.delta)return!1}return s?e>=Math.floor(p.left)&&e<Math.floor(p.right):n>=Math.floor(p.top)&&n<Math.floor(p.bottom)});return l===-1||!this._sortPredicate(l,i)?-1:l}},cR=class{constructor(i,e){this._document=i,this._dragDropRegistry=e,this._previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1},this._relatedNodes=[]}start(i){let e=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<e.length;n++){let o=e[n];this._relatedNodes.push([o,o.nextSibling])}this.withItems(i)}sort(i,e,n,o){let s=this._getItemIndexFromPointerPosition(i,e,n),l=this._previousSwap;if(s===-1||this._activeItems[s]===i)return null;let h=this._activeItems[s];if(l.drag===h&&l.overlaps&&l.deltaX===o.x&&l.deltaY===o.y)return null;let p=this.getItemIndex(i),m=i.getPlaceholderElement(),f=h.getRootElement();s>p?f.after(m):f.before(m),tE(this._activeItems,p,s);let g=this._getRootNode().elementFromPoint(e,n);return l.deltaX=o.x,l.deltaY=o.y,l.drag=h,l.overlaps=f===g||f.contains(g),{previousIndex:p,currentIndex:s}}enter(i,e,n,o){let s=o==null||o<0?this._getItemIndexFromPointerPosition(i,e,n):o;s===-1&&(s=this._getClosestItemIndexToPointer(i,e,n));let l=this._activeItems[s],h=this._activeItems.indexOf(i);h>-1&&this._activeItems.splice(h,1),l&&!this._dragDropRegistry.isDragging(l)?(this._activeItems.splice(s,0,i),l.getRootElement().before(i.getPlaceholderElement())):(this._activeItems.push(i),this._element.appendChild(i.getPlaceholderElement()))}withItems(i){this._activeItems=i.slice()}withSortPredicate(i){this._sortPredicate=i}reset(){let i=this._element,e=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[o,s]=this._relatedNodes[n];o.parentNode===i&&o.nextSibling!==s&&(s===null?i.appendChild(o):s.parentNode===i&&i.insertBefore(o,s))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(i){return this._activeItems.indexOf(i)}updateOnScroll(){this._activeItems.forEach(i=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}withElementContainer(i){i!==this._element&&(this._element=i,this._rootNode=void 0)}_getItemIndexFromPointerPosition(i,e,n){let o=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(n)),s=o?this._activeItems.findIndex(l=>{let h=l.getRootElement();return o===h||h.contains(o)}):-1;return s===-1||!this._sortPredicate(s,i)?-1:s}_getRootNode(){return this._rootNode||(this._rootNode=TA(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(i,e,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let o=1/0,s=-1;for(let l=0;l<this._activeItems.length;l++){let h=this._activeItems[l];if(h!==i){let{x:p,y:m}=h.getRootElement().getBoundingClientRect(),f=Math.hypot(e-p,n-m);f<o&&(o=f,s=l)}}return s}},_Y=.05,wY=.05,Kh=function(r){return r[r.NONE=0]="NONE",r[r.UP=1]="UP",r[r.DOWN=2]="DOWN",r}(Kh||{}),Ou=function(r){return r[r.NONE=0]="NONE",r[r.LEFT=1]="LEFT",r[r.RIGHT=2]="RIGHT",r}(Ou||{}),uR=class{constructor(i,e,n,o,s){this._dragDropRegistry=e,this._ngZone=o,this._viewportRuler=s,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new Si,this.entered=new Si,this.exited=new Si,this.dropped=new Si,this.sorted=new Si,this.receivingStarted=new Si,this.receivingStopped=new Si,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=Es.EMPTY,this._verticalScrollDirection=Kh.NONE,this._horizontalScrollDirection=Ou.NONE,this._stopScrollTimers=new Si,this._cachedShadowRoot=null,this._scrollableElements=[],this._direction="ltr",this._startScrollInterval=()=>{this._stopScrolling(),xA(0,_7).pipe(Vo(this._stopScrollTimers)).subscribe(()=>{let h=this._scrollNode,p=this.autoScrollStep;this._verticalScrollDirection===Kh.UP?h.scrollBy(0,-p):this._verticalScrollDirection===Kh.DOWN&&h.scrollBy(0,p),this._horizontalScrollDirection===Ou.LEFT?h.scrollBy(-p,0):this._horizontalScrollDirection===Ou.RIGHT&&h.scrollBy(p,0)})};let l=this.element=l0(i);this._document=n,this.withOrientation("vertical").withElementContainer(l),e.registerDropContainer(this),this._parentPositions=new K5(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(i,e,n,o){this._draggingStarted(),o==null&&this.sortingDisabled&&(o=this._draggables.indexOf(i)),this._sortStrategy.enter(i,e,n,o),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:i,container:this,currentIndex:this.getItemIndex(i)})}exit(i){this._reset(),this.exited.next({item:i,container:this})}drop(i,e,n,o,s,l,h,p={}){this._reset(),this.dropped.next({item:i,currentIndex:e,previousIndex:n,container:this,previousContainer:o,isPointerOverContainer:s,distance:l,dropPoint:h,event:p})}withItems(i){let e=this._draggables;return this._draggables=i,i.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(e.filter(o=>o.isDragging()).every(o=>i.indexOf(o)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(i){return this._direction=i,this._sortStrategy instanceof eE&&(this._sortStrategy.direction=i),this}connectedTo(i){return this._siblings=i.slice(),this}withOrientation(i){if(i==="mixed")this._sortStrategy=new cR(this._document,this._dragDropRegistry);else{let e=new eE(this._dragDropRegistry);e.direction=this._direction,e.orientation=i,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,n)=>this.sortPredicate(e,n,this)),this}withScrollableParents(i){let e=this._container;return this._scrollableElements=i.indexOf(e)===-1?[e,...i]:i.slice(),this}withElementContainer(i){if(i===this._container)return this;let e=l0(this.element),n=this._scrollableElements.indexOf(this._container),o=this._scrollableElements.indexOf(i);return n>-1&&this._scrollableElements.splice(n,1),o>-1&&this._scrollableElements.splice(o,1),this._sortStrategy&&this._sortStrategy.withElementContainer(i),this._cachedShadowRoot=null,this._scrollableElements.unshift(i),this._container=i,this}getScrollableParents(){return this._scrollableElements}getItemIndex(i){return this._isDragging?this._sortStrategy.getItemIndex(i):this._draggables.indexOf(i)}isReceiving(){return this._activeSiblings.size>0}_sortItem(i,e,n,o){if(this.sortingDisabled||!this._domRect||!aY(this._domRect,_Y,e,n))return;let s=this._sortStrategy.sort(i,e,n,o);s&&this.sorted.next({previousIndex:s.previousIndex,currentIndex:s.currentIndex,container:this,item:i})}_startScrollingIfNecessary(i,e){if(this.autoScrollDisabled)return;let n,o=Kh.NONE,s=Ou.NONE;if(this._parentPositions.positions.forEach((l,h)=>{h===this._document||!l.clientRect||n||aY(l.clientRect,_Y,i,e)&&([o,s]=tge(h,l.clientRect,this._direction,i,e),(o||s)&&(n=h))}),!o&&!s){let{width:l,height:h}=this._viewportRuler.getViewportSize(),p={width:l,height:h,top:0,right:l,bottom:h,left:0};o=xY(p,e),s=SY(p,i),n=window}n&&(o!==this._verticalScrollDirection||s!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=o,this._horizontalScrollDirection=s,this._scrollNode=n,(o||s)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let i=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=i.msScrollSnapType||i.scrollSnapType||"",i.scrollSnapType=i.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let i=this._container.style;i.scrollSnapType=i.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(i,e){return this._domRect!=null&&aR(this._domRect,i,e)}_getSiblingContainerFromPosition(i,e,n){return this._siblings.find(o=>o._canReceive(i,e,n))}_canReceive(i,e,n){if(!this._domRect||!aR(this._domRect,e,n)||!this.enterPredicate(i,this))return!1;let o=this._getShadowRoot().elementFromPoint(e,n);return o?o===this._container||this._container.contains(o):!1}_startReceiving(i,e){let n=this._activeSiblings;!n.has(i)&&e.every(o=>this.enterPredicate(o,this)||this._draggables.indexOf(o)>-1)&&(n.add(i),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:i,receiver:this,items:e}))}_stopReceiving(i){this._activeSiblings.delete(i),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:i,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(i=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(i);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let i=TA(this._container);this._cachedShadowRoot=i||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let i=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,i))}};function xY(r,i){let{top:e,bottom:n,height:o}=r,s=o*wY;return i>=e-s&&i<=e+s?Kh.UP:i>=n-s&&i<=n+s?Kh.DOWN:Kh.NONE}function SY(r,i){let{left:e,right:n,width:o}=r,s=o*wY;return i>=e-s&&i<=e+s?Ou.LEFT:i>=n-s&&i<=n+s?Ou.RIGHT:Ou.NONE}function tge(r,i,e,n,o){let s=xY(i,o),l=SY(i,n),h=Kh.NONE,p=Ou.NONE;if(s){let m=r.scrollTop;s===Kh.UP?m>0&&(h=Kh.UP):r.scrollHeight-m>r.clientHeight&&(h=Kh.DOWN)}if(l){let m=r.scrollLeft;e==="rtl"?l===Ou.RIGHT?m<0&&(p=Ou.RIGHT):r.scrollWidth+m>r.clientWidth&&(p=Ou.LEFT):l===Ou.LEFT?m>0&&(p=Ou.LEFT):r.scrollWidth-m>r.clientWidth&&(p=Ou.RIGHT)}return[h,p]}var Z5=Q_({passive:!1,capture:!0}),X5=new Set,ige=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=nt({type:r,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],standalone:!0,features:[lt],decls:0,vars:0,template:function(n,o){},styles:["@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}"],encapsulation:2,changeDetection:0})}}return r})(),rge=(()=>{class r{constructor(e,n){this._ngZone=e,this._appRef=ga(I1),this._environmentInjector=ga(AA),this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=K_([]),this._globalListeners=new Map,this._draggingPredicate=o=>o.isDragging(),this.pointerMove=new Si,this.pointerUp=new Si,this.scroll=new Si,this._preventDefaultWhileDragging=o=>{this._activeDragInstances().length>0&&o.preventDefault()},this._persistentTouchmoveListener=o=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&o.preventDefault(),this.pointerMove.next(o))},this._document=n}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,Z5)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,Z5)}startDragging(e,n){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._loadResets(),this._activeDragInstances.update(o=>[...o,e]),this._activeDragInstances().length===1)){let o=n.type.startsWith("touch");this._globalListeners.set(o?"touchend":"mouseup",{handler:s=>this.pointerUp.next(s),options:!0}).set("scroll",{handler:s=>this.scroll.next(s),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:Z5}),o||this._globalListeners.set("mousemove",{handler:s=>this.pointerMove.next(s),options:Z5}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((s,l)=>{this._document.addEventListener(l,s.handler,s.options)})})}}stopDragging(e){this._activeDragInstances.update(n=>{let o=n.indexOf(e);return o>-1?(n.splice(o,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let n=[this.scroll];return e&&e!==this._document&&n.push(new $r(o=>this._ngZone.runOutsideAngular(()=>{let l=h=>{this._activeDragInstances().length&&o.next(h)};return e.addEventListener("scroll",l,!0),()=>{e.removeEventListener("scroll",l,!0)}}))),Fs(...n)}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((e,n)=>{this._document.removeEventListener(n,e.handler,e.options)}),this._globalListeners.clear()}_loadResets(){if(!X5.has(this._appRef)){X5.add(this._appRef);let e=IA(ige,{environmentInjector:this._environmentInjector});this._appRef.onDestroy(()=>{X5.delete(this._appRef),X5.size===0&&e.destroy()})}}static{this.\u0275fac=function(n){return new(n||r)(pt(tc),pt(rc))}}static{this.\u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),nge={dragStartThreshold:5,pointerDirectionChangeThreshold:5},CY=(()=>{class r{constructor(e,n,o,s){this._document=e,this._ngZone=n,this._viewportRuler=o,this._dragDropRegistry=s}createDrag(e,n=nge){return new lR(e,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(e){return new uR(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static{this.\u0275fac=function(n){return new(n||r)(pt(rc),pt(tc),pt(Sx),pt(rge))}}static{this.\u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})(),dR=new Ln("CDK_DRAG_PARENT");var AY=new Ln("CdkDragHandle"),MY=(()=>{class r{get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._stateChanges.next(this)}constructor(e,n){this.element=e,this._parentDrag=n,this._stateChanges=new Si,this._disabled=!1,n?._addHandle(this)}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(dR,12))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",Vi]},standalone:!0,features:[Xi([{provide:AY,useExisting:r}]),$n]})}}return r})(),IY=new Ln("CDK_DRAG_CONFIG"),oge="cdk-drag",EY=new Ln("CdkDropList"),TY=(()=>{class r{static{this._dragInstances=[]}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}constructor(e,n,o,s,l,h,p,m,f,g,y){this.element=e,this.dropContainer=n,this._ngZone=s,this._viewContainerRef=l,this._dir=p,this._changeDetectorRef=f,this._selfHandle=g,this._parentDrag=y,this._destroyed=new Si,this._handles=new ut([]),this.scale=1,this.started=new Ke,this.released=new Ke,this.ended=new Ke,this.entered=new Ke,this.exited=new Ke,this.dropped=new Ke,this.moved=new $r(_=>{let w=this._dragRef.moved.pipe(Nt(A=>({source:this,pointerPosition:A.pointerPosition,event:A.event,delta:A.delta,distance:A.distance}))).subscribe(_);return()=>{w.unsubscribe()}}),this._injector=ga(jd),this._dragRef=m.createDrag(e,{dragStartThreshold:h&&h.dragStartThreshold!=null?h.dragStartThreshold:5,pointerDirectionChangeThreshold:h&&h.pointerDirectionChangeThreshold!=null?h.pointerDirectionChangeThreshold:5,zIndex:h?.zIndex}),this._dragRef.data=this,r._dragInstances.push(this),h&&this._assignDefaults(h),n&&(this._dragRef._withDropContainer(n._dropListRef),n.addItem(this),n._dropListRef.beforeStarted.pipe(Vo(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){M1(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let n=e.rootElementSelector,o=e.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,o&&!o.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);let e=r._dragInstances.indexOf(this);e>-1&&r._dragInstances.splice(e,1),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let n=this._handles.getValue();n.push(e),this._handles.next(n)}_removeHandle(e){let n=this._handles.getValue(),o=n.indexOf(e);o>-1&&(n.splice(o,1),this._handles.next(n))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,n=e;this.rootElementSelector&&(n=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):l0(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let n=this._dir,o=this.dragStartDelay,s=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,l=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof o=="object"&&o?o:HF(o),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(s).withPreviewTemplate(l).withPreviewContainer(this.previewContainer||"global"),n&&e.withDirection(n.value)}}),e.beforeStarted.pipe(Ol(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){if(n.classList.contains(oge)){e.withParent(r._dragInstances.find(o=>o.element.nativeElement===n)?._dragRef||null);break}n=n.parentElement}})}_handleEvents(e){e.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),e.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(e){let{lockAxis:n,dragStartDelay:o,constrainPosition:s,previewClass:l,boundaryElement:h,draggingDisabled:p,rootElementSelector:m,previewContainer:f}=e;this.disabled=p??!1,this.dragStartDelay=o||0,n&&(this.lockAxis=n),s&&(this.constrainPosition=s),l&&(this.previewClass=l),h&&(this.boundaryElement=h),m&&(this.rootElementSelector=m),f&&(this.previewContainer=f)}_setupHandlesListener(){this._handles.pipe(bu(e=>{let n=e.map(o=>o.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),Xn(e=>Fs(...e.map(n=>n._stateChanges.pipe(ec(n))))),Vo(this._destroyed)).subscribe(e=>{let n=this._dragRef,o=e.element.nativeElement;e.disabled?n.disableHandle(o):n.enableHandle(o)})}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(EY,12),Ie(rc),Ie(tc),Ie(Mh),Ie(IY,8),Ie(Rl,8),Ie(CY),Ie(lr),Ie(AY,10),Ie(dR,12))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,o){n&2&&dr("cdk-drag-disabled",o.disabled)("cdk-drag-dragging",o._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Vi],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Uo]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],standalone:!0,features:[Xi([{provide:dR,useExisting:r}]),$n,wu]})}}return r})(),yY=new Ln("CdkDropListGroup");var age=0,FY=(()=>{class r{static{this._dropLists=[]}get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}constructor(e,n,o,s,l,h,p){this.element=e,this._changeDetectorRef=o,this._scrollDispatcher=s,this._dir=l,this._group=h,this._destroyed=new Si,this.connectedTo=[],this.id=`cdk-drop-list-${age++}`,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.dropped=new Ke,this.entered=new Ke,this.exited=new Ke,this.sorted=new Ke,this._unsortedItems=new Set,this._dropListRef=n.createDropList(e),this._dropListRef.data=this,p&&this._assignDefaults(p),this._dropListRef.enterPredicate=(m,f)=>this.enterPredicate(m.data,f.data),this._dropListRef.sortPredicate=(m,f,g)=>this.sortPredicate(m,f.data,g.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),r._dropLists.push(this),h&&h._items.add(this)}addItem(e){this._unsortedItems.add(e),this._dropListRef.isDragging()&&this._syncItemsWithRef()}removeItem(e){this._unsortedItems.delete(e),this._dropListRef.isDragging()&&this._syncItemsWithRef()}getSortedItems(){return Array.from(this._unsortedItems).sort((e,n)=>e._dragRef.getVisibleElement().compareDocumentPosition(n._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=r._dropLists.indexOf(this);e>-1&&r._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(ec(this._dir.value),Vo(this._destroyed)).subscribe(n=>e.withDirection(n)),e.beforeStarted.subscribe(()=>{let n=D7(this.connectedTo).map(o=>{if(typeof o=="string"){let s=r._dropLists.find(l=>l.id===o);return s}return o});if(this._group&&this._group._items.forEach(o=>{n.indexOf(o)===-1&&n.push(o)}),!this._scrollableParentsResolved){let o=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(s=>s.getElementRef().nativeElement);this._dropListRef.withScrollableParents(o),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let o=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(o)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=HF(this.autoScrollStep,2),e.connectedTo(n.filter(o=>o&&o!==this).map(o=>o._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:this,item:n.item.data,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:this,item:n.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(n=>{this.sorted.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,container:this,item:n.item.data})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,item:n.item.data,isPointerOverContainer:n.isPointerOverContainer,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),Fs(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:n,draggingDisabled:o,sortingDisabled:s,listAutoScrollDisabled:l,listOrientation:h}=e;this.disabled=o??!1,this.sortingDisabled=s??!1,this.autoScrollDisabled=l??!1,this.orientation=h||"vertical",n&&(this.lockAxis=n)}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(e=>e._dragRef))}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(CY),Ie(lr),Ie(nG),Ie(Rl,8),Ie(yY,12),Ie(IY,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(n,o){n&2&&(Or("id",o.id),dr("cdk-drop-list-disabled",o.disabled)("cdk-drop-list-dragging",o._dropListRef.isDragging())("cdk-drop-list-receiving",o._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",Vi],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",Vi],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",Vi],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],standalone:!0,features:[Xi([{provide:yY,useValue:void 0},{provide:EY,useExisting:r}]),$n]})}}return r})();var Du=63710088e-1,sge={centimeters:Du*100,centimetres:Du*100,degrees:Du/111325,feet:Du*3.28084,inches:Du*39.37,kilometers:Du/1e3,kilometres:Du/1e3,meters:Du,metres:Du,miles:Du/1609.344,millimeters:Du*1e3,millimetres:Du*1e3,nauticalmiles:Du/1852,radians:1,yards:Du*1.0936},Ret={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Du,yards:1.0936133};function l2(r,i,e){e===void 0&&(e={});var n={type:"Feature"};return(e.id===0||e.id)&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.properties=i||{},n.geometry=r,n}function Cg(r,i,e){if(e===void 0&&(e={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!mR(r[0])||!mR(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return l2(n,i,e)}function n_(r,i){i===void 0&&(i={});var e={type:"FeatureCollection"};return i.id&&(e.id=i.id),i.bbox&&(e.bbox=i.bbox),e.features=r,e}function PY(r,i){i===void 0&&(i="kilometers");var e=sge[i];if(!e)throw new Error(i+" units is invalid");return r*e}function LY(r){var i=r%360;return i<0&&(i+=360),i}function c2(r){var i=r%360;return i*Math.PI/180}function mR(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Tb(r,i,e){if(r!==null)for(var n,o,s,l,h,p,m,f=0,g=0,y,_=r.type,w=_==="FeatureCollection",A=_==="Feature",k=w?r.features.length:1,R=0;R<k;R++){m=w?r.features[R].geometry:A?r.geometry:r,y=m?m.type==="GeometryCollection":!1,h=y?m.geometries.length:1;for(var q=0;q<h;q++){var X=0,ie=0;if(l=y?m.geometries[q]:m,l!==null){p=l.coordinates;var ae=l.type;switch(f=e&&(ae==="Polygon"||ae==="MultiPolygon")?1:0,ae){case null:break;case"Point":if(i(p,g,R,X,ie)===!1)return!1;g++,X++;break;case"LineString":case"MultiPoint":for(n=0;n<p.length;n++){if(i(p[n],g,R,X,ie)===!1)return!1;g++,ae==="MultiPoint"&&X++}ae==="LineString"&&X++;break;case"Polygon":case"MultiLineString":for(n=0;n<p.length;n++){for(o=0;o<p[n].length-f;o++){if(i(p[n][o],g,R,X,ie)===!1)return!1;g++}ae==="MultiLineString"&&X++,ae==="Polygon"&&ie++}ae==="Polygon"&&X++;break;case"MultiPolygon":for(n=0;n<p.length;n++){for(ie=0,o=0;o<p[n].length;o++){for(s=0;s<p[n][o].length-f;s++){if(i(p[n][o][s],g,R,X,ie)===!1)return!1;g++}ie++}X++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(Tb(l.geometries[n],i,e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function u2(r,i){if(r.type==="Feature")i(r,0);else if(r.type==="FeatureCollection")for(var e=0;e<r.features.length&&i(r.features[e],e)!==!1;e++);}function lge(r){var i=[];return r.type==="FeatureCollection"?u2(r,function(e){Tb(e,function(n){i.push(Cg(n,e.properties))})}):Tb(r,function(e){i.push(Cg(e,r.properties))}),n_(i)}var OY=lge;function fR(r){var i=[1/0,1/0,-1/0,-1/0];return Tb(r,function(e){i[0]>e[0]&&(i[0]=e[0]),i[1]>e[1]&&(i[1]=e[1]),i[2]<e[0]&&(i[2]=e[0]),i[3]<e[1]&&(i[3]=e[1])}),i}fR.default=fR;var DY=fR;function cge(r,i){i===void 0&&(i={});var e=DY(r),n=(e[0]+e[2])/2,o=(e[1]+e[3])/2;return Cg([n,o],i.properties,i)}var RY=cge;function uge(r){if(!r)throw new Error("geojson is required");switch(r.type){case"Feature":return NY(r);case"FeatureCollection":return dge(r);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return gR(r);default:throw new Error("unknown GeoJSON type")}}function NY(r){var i={type:"Feature"};return Object.keys(r).forEach(function(e){switch(e){case"type":case"properties":case"geometry":return;default:i[e]=r[e]}}),i.properties=BY(r.properties),i.geometry=gR(r.geometry),i}function BY(r){var i={};return r&&Object.keys(r).forEach(function(e){var n=r[e];typeof n=="object"?n===null?i[e]=null:Array.isArray(n)?i[e]=n.map(function(o){return o}):i[e]=BY(n):i[e]=n}),i}function dge(r){var i={type:"FeatureCollection"};return Object.keys(r).forEach(function(e){switch(e){case"type":case"features":return;default:i[e]=r[e]}}),i.features=r.features.map(function(e){return NY(e)}),i}function gR(r){var i={type:r.type};return r.bbox&&(i.bbox=r.bbox),r.type==="GeometryCollection"?(i.geometries=r.geometries.map(function(e){return gR(e)}),i):(i.coordinates=GY(r.coordinates),i)}function GY(r){var i=r;return typeof i[0]!="object"?i.slice():i.map(function(e){return GY(e)})}var jY=uge;function d2(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function VY(r){return r.type==="Feature"?r.geometry:r}function hge(r,i,e){e===void 0&&(e={});var n=d2(r),o=d2(i),s=c2(o[1]-n[1]),l=c2(o[0]-n[0]),h=c2(n[1]),p=c2(o[1]),m=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(h)*Math.cos(p);return PY(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),e.units)}var UY=hge;function pge(r,i){if(!r)throw new Error("targetPoint is required");if(!i)throw new Error("points is required");var e,n=1/0,o=0;return u2(i,function(s,l){var h=UY(r,s);h<n&&(o=l,n=h)}),e=jY(i.features[o]),e.properties.featureIndex=o,e.properties.distanceToPoint=n,e}var zY=pge;function _R(r,i,e){if(e===void 0&&(e={}),!r)throw new Error("point is required");if(!i)throw new Error("polygon is required");var n=d2(r),o=VY(i),s=o.type,l=i.bbox,h=o.coordinates;if(l&&mge(n,l)===!1)return!1;s==="Polygon"&&(h=[h]);for(var p=!1,m=0;m<h.length&&!p;m++)if($Y(n,h[m][0],e.ignoreBoundary)){for(var f=!1,g=1;g<h[m].length&&!f;)$Y(n,h[m][g],!e.ignoreBoundary)&&(f=!0),g++;f||(p=!0)}return p}function $Y(r,i,e){var n=!1;i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]&&(i=i.slice(0,i.length-1));for(var o=0,s=i.length-1;o<i.length;s=o++){var l=i[o][0],h=i[o][1],p=i[s][0],m=i[s][1],f=r[1]*(l-p)+h*(p-r[0])+m*(r[0]-l)===0&&(l-r[0])*(p-r[0])<=0&&(h-r[1])*(m-r[1])<=0;if(f)return!e;var g=h>r[1]!=m>r[1]&&r[0]<(p-l)*(r[1]-h)/(m-h)+l;g&&(n=!n)}return n}function mge(r,i){return i[0]<=r[0]&&i[1]<=r[1]&&i[2]>=r[0]&&i[3]>=r[1]}function fge(r){for(var i=gge(r),e=RY(i),n=!1,o=0;!n&&o<i.features.length;){var s=i.features[o].geometry,l,h,p,m,f,g,y,_=!1;if(s.type==="Point")e.geometry.coordinates[0]===s.coordinates[0]&&e.geometry.coordinates[1]===s.coordinates[1]&&(n=!0);else if(s.type==="MultiPoint"){var w=!1;for(y=0;!w&&y<s.coordinates.length;)e.geometry.coordinates[0]===s.coordinates[y][0]&&e.geometry.coordinates[1]===s.coordinates[y][1]&&(n=!0,w=!0),y++}else if(s.type==="LineString")for(y=0;!_&&y<s.coordinates.length-1;)l=e.geometry.coordinates[0],h=e.geometry.coordinates[1],p=s.coordinates[y][0],m=s.coordinates[y][1],f=s.coordinates[y+1][0],g=s.coordinates[y+1][1],WY(l,h,p,m,f,g)&&(_=!0,n=!0),y++;else if(s.type==="MultiLineString")for(var A=0;A<s.coordinates.length;){_=!1,y=0;for(var k=s.coordinates[A];!_&&y<k.length-1;)l=e.geometry.coordinates[0],h=e.geometry.coordinates[1],p=k[y][0],m=k[y][1],f=k[y+1][0],g=k[y+1][1],WY(l,h,p,m,f,g)&&(_=!0,n=!0),y++;A++}else(s.type==="Polygon"||s.type==="MultiPolygon")&&_R(e,s)&&(n=!0);o++}if(n)return e;var R=n_([]);for(o=0;o<i.features.length;o++)R.features=R.features.concat(OY(i.features[o]).features);return Cg(zY(e,R).geometry.coordinates)}function gge(r){return r.type!=="FeatureCollection"?r.type!=="Feature"?n_([l2(r)]):n_([r]):r}function WY(r,i,e,n,o,s){var l=Math.sqrt((o-e)*(o-e)+(s-n)*(s-n)),h=Math.sqrt((r-e)*(r-e)+(i-n)*(i-n)),p=Math.sqrt((o-r)*(o-r)+(s-i)*(s-i));return l===h+p}var Fb=fge;function _ge(r,i){if(r&1){let e=We();$(0,"button",16),le(1,"translate"),ve("click",function(o){we(e);let s=ne().$implicit;return ne().useCurrentPosition(s),xe(o.stopPropagation())}),$(2,"mat-icon"),_e(3,"my_location"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.directions.input.currentPosition"))}function yge(r,i){if(r&1){let e=We();$(0,"button",17),le(1,"translate"),ve("click",function(){we(e);let o=ne().$implicit,s=ne();return xe(s.clearStopInput(o))}),$(2,"mat-icon"),_e(3,"close"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.directions.input.clearStop"))}function vge(r,i){if(r&1&&($(0,"mat-option",20),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e.meta?e.meta.title:""," ")}}function bge(r,i){if(r&1&&($(0,"mat-optgroup",18),Pe(1,vge,2,2,"mat-option",19),ee()),r&2){let e=i.$implicit;z("label",e.source.title)("disabled",!e.source.enabled),j(),z("ngForOf",e.results)}}function wge(r,i){if(r&1){let e=We();$(0,"button",21),le(1,"translate"),ve("click",function(){we(e);let o=ne().$implicit,s=ne();return xe(s.removeStop(o))}),$(2,"mat-icon"),_e(3,"delete"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.directions.input.removeStop"))}function xge(r,i){if(r&1){let e=We();$(0,"div",5)(1,"div",6),ve("touchenter",function(){let o=we(e).$implicit,s=ne();return xe(s.onStopEnter(o))})("touchleave",function(){we(e);let o=ne();return xe(o.onStopLeave())})("mouseover",function(){let o=we(e).$implicit,s=ne();return xe(s.onStopEnter(o))})("mouseleave",function(){we(e);let o=ne();return xe(o.onStopLeave())})("cdkDragStarted",function(){we(e);let o=ne();return xe(o.stopIsDragged=!0)})("cdkDragEnded",function(){we(e);let o=ne();return xe(o.stopIsDragged=!1)}),$(2,"div",3)(3,"button",7),le(4,"translate"),$(5,"mat-icon"),_e(6,"drag_indicator"),ee()()(),$(7,"div",8)(8,"mat-form-field",9)(9,"mat-label"),_e(10),ee(),$(11,"input",10),le(12,"translate"),ve("focus",function(){let o=we(e).$implicit,s=ne();return xe(s.onInputFocus(o))}),eo("ngModelChange",function(o){let s=we(e).$implicit;return Jn(s.text,o)||(s.text=o),xe(o)}),ve("keyup",function(o){let s=we(e).$implicit,l=ne();return xe(l.setStopText(o,s))})("keydown.enter",function(o){return we(e),xe(o.preventDefault())}),ee(),Pe(13,_ge,4,3,"button",11)(14,yge,4,3,"button",12),$(15,"mat-autocomplete",13,0),ve("optionSelected",function(o){let s=we(e).$implicit,l=ne();return xe(l.chooseOption(o,s))}),Pe(17,bge,2,3,"mat-optgroup",14),ee()()(),Pe(18,wge,4,3,"button",15),le(19,"async"),ee()()}if(r&2){let e=i.$implicit,n=Xt(16),o=ne();j(3),z("matTooltip",ce(4,11,"igo.geo.directions.input.moveStop")),j(7),bt(o.getInputLabel(e)),j(),z("id",e.id)("placeholder",ce(12,13,"igo.geo.directions.input.placeholder")),Qn("ngModel",e.text),z("matAutocomplete",n),j(2),z("ngIf",o.currentPosition),j(),z("ngIf",e.text||e.coordinates),j(),z("displayWith",o.getOptionText),j(2),z("ngForOf",e.searchProposals),j(),z("ngIf",ce(19,15,o.stopsStore.count$)>2)}}var iE=(()=>{class r{languageService;stopsStore;stopsFeatureStore;projection;coordRoundedDecimals=6;debounce=200;length=2;stopInputHasFocus=new Ke(!1);invalidKeys=["Control","Shift","Alt"];onMapClickEventKeys=[];stopWithHover;stopIsDragged=!1;constructor(e){this.languageService=e}get currentPosition(){return this.stopsFeatureStore?.map?.geolocationController?.position$?.value?.position&&this.stopsFeatureStore?.map?.geolocationController?.tracking}ngOnDestroy(){this.unlistenMapSingleClick()}onStopEnter(e){this.stopWithHover=e}onStopLeave(){this.stopWithHover=void 0}addStop(){o2(this.stopsStore)}getOptionText(e){if(e instanceof Object){let{meta:n}=e;return n?.title||""}return e}chooseOption(e,n){let o=e.option.value;if(o){let s,l=o.geometry;if(l.type==="Point")s=l.coordinates;else{let h=Fb(o.geometry);s=[h.geometry.coordinates[0],h.geometry.coordinates[1]]}s&&(n.coordinates=s,n.text=o.meta.title,this.stopsStore.update(n))}}setStopText(e,n){this.unlistenMapSingleClick();let o=e.target.value;o.length===0?this.clearStopInput(n):this.validateSearchTerm(o)&&(n.text=o,this.stopsStore.update(n))}validateSearchTerm(e){let n=this.invalidKeys.indexOf(e)===-1,o=e.length>=this.length||e.length===0;return n&&o}getInputLabel(e){let{relativePosition:n,position:o}=e,s=n?this.languageService.translate.instant(`igo.geo.directions.input.${n}`):"";return n===Sg.Intermediate?`${s} #${o}`:s}removeStop(e){Wq(this.stopsStore,e)}clearStopInput(e){this.stopsStore.update({id:e.id,relativePosition:e.relativePosition,position:e.position})}useCurrentPosition(e){this.useCoordinatesAsStop(this.stopsFeatureStore.map.geolocationController.position$.value.position,e)}dropStop(e){this.moveStops(e.previousIndex,e.currentIndex)}moveStops(e,n){if(e!==n){let o=[...this.stopsStore.view.all()];tE(o,e,n),o.map((s,l)=>{s.relativePosition=r2(l,o.length-1),s.position=l}),this.stopsStore.updateMany(o),n2(this.stopsStore)}}onInputFocus(e){this.unlistenMapSingleClick(),this.stopInputHasFocus.emit(!0),this.listenMapSingleClick(e)}listenMapSingleClick(e){let n=this.stopsFeatureStore.layer.map.ol.once("singleclick",o=>{this.useCoordinatesAsStop(o.coordinate,e)});this.onMapClickEventKeys.push(n)}unlistenMapSingleClick(){this.onMapClickEventKeys.map(e=>{io(e)}),this.onMapClickEventKeys=[]}useCoordinatesAsStop(e,n){let o=Sr(e,this.stopsFeatureStore.layer.map.projection,this.projection),s=uc(o,this.coordRoundedDecimals);n.text=Rh(o,this.coordRoundedDecimals).join(", "),n.coordinates=s,this.stopsStore.update(n),setTimeout(()=>{this.stopInputHasFocus.emit(!1)},500)}static \u0275fac=function(n){return new(n||r)(Ie(Di))};static \u0275cmp=nt({type:r,selectors:[["igo-directions-inputs"]],inputs:{stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",projection:"projection",coordRoundedDecimals:"coordRoundedDecimals",debounce:"debounce",length:"length"},outputs:{stopInputHasFocus:"stopInputHasFocus"},standalone:!0,features:[lt],decls:10,vars:11,consts:[["auto","matAutocomplete"],["cdkDropList","",1,"stops-list",3,"cdkDropListDropped"],["class","stop",4,"ngFor","ngForOf"],[1,"prefix-actions"],["mat-icon-button","","color","primary",3,"click","disabled","matTooltip"],[1,"stop"],["cdkDragLockAxis","y","cdkDrag","",1,"stop-box",3,"touchenter","touchleave","mouseover","mouseleave","cdkDragStarted","cdkDragEnded"],["cdkDragHandle","","mat-icon-button","","color","primary",1,"swipe-vertical",3,"matTooltip"],[1,"igo-input-container"],["subscriptSizing","dynamic"],["type","text","matInput","",3,"focus","ngModelChange","keyup","keydown.enter","id","placeholder","ngModel","matAutocomplete"],["mat-icon-button","","matPrefix","","color","accent",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matSuffix","","color","warn",3,"matTooltip","click",4,"ngIf"],[3,"optionSelected","displayWith"],[3,"label","disabled",4,"ngFor","ngForOf"],["class","delete-button","mat-icon-button","","color","warn",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","matPrefix","","color","accent",3,"click","matTooltip"],["mat-icon-button","","matSuffix","","color","warn",3,"click","matTooltip"],[3,"label","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-icon-button","","color","warn",1,"delete-button",3,"click","matTooltip"]],template:function(n,o){n&1&&($(0,"div",1),ve("cdkDropListDropped",function(l){return o.dropStop(l)}),Pe(1,xge,20,17,"div",2),le(2,"async"),$(3,"div",3)(4,"button",4),le(5,"async"),le(6,"async"),le(7,"translate"),ve("click",function(){return o.addStop()}),$(8,"mat-icon"),_e(9,"add_location_alt"),ee()()()()),n&2&&(j(),z("ngForOf",ce(2,3,o.stopsStore.view.all$())),j(3),z("disabled",ce(5,5,o.stopsStore.count$)!==ce(6,7,o.stopsFeatureStore.count$)||o.stopIsDragged)("matTooltip",ce(7,9,"igo.geo.directions.input.addStop")))},dependencies:[FY,Li,TY,jr,Gr,Mo,OA,Vc,gn,Cn,Sn,os,kn,nc,Oh,kh,Nn,Y7,Su,Qt,ti,Gt,Vt,ci,jt,$t,Bn,MY,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%]{padding:12px 10px}[_nghost-%COMP%]   .stops-list[_ngcontent-%COMP%], [_nghost-%COMP%]   .stop[_ngcontent-%COMP%]{display:flex;flex-flow:column;row-gap:12px}[_nghost-%COMP%]   .stop[_ngcontent-%COMP%]:hover   .swipe-vertical[_ngcontent-%COMP%], [_nghost-%COMP%]   .stop[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{visibility:visible;display:block}[_nghost-%COMP%]   .swipe-vertical[_ngcontent-%COMP%]{visibility:hidden;cursor:move}[_nghost-%COMP%]   .delete-button[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .stop-box[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}[_nghost-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}[_nghost-%COMP%]   .cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}[_nghost-%COMP%]   .stops-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .stop-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}
/*# sourceMappingURL=directions-inputs.component-KZDZBJAU.css.map */`]})}return r})();function Sge(r,i){if(r&1&&($(0,"mat-option",9),_e(1),ee()),r&2){let e=i.$implicit,n=i.index,o=ne(3);z("value",e),j(),I7(" Option ",n+1,": ",e.title," (",o.formatDistance(e.distance)," - ",o.formatDuration(e.duration),") ")}}function Cge(r,i){if(r&1){let e=We();$(0,"mat-form-field",6)(1,"mat-label"),_e(2),le(3,"translate"),ee(),$(4,"mat-select",7),ve("selectionChange",function(){we(e);let o=ne(2);return xe(o.chooseRouteOption())}),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.activeRoute,o)||(s.activeRoute=o),xe(o)}),Pe(5,Sge,2,5,"mat-option",8),ee()()}if(r&2){let e=ne(2);z("matTooltip",e.activeRoute.title),j(2),bt(ce(3,4,"igo.geo.directions.results.routeOptions")),j(2),Qn("ngModel",e.activeRoute),j(),z("ngForOf",e.routes)}}function Age(r,i){if(r&1&&($(0,"span",15),_e(1),ee()),r&2){let e=ne(2).$implicit,n=ne(2);j(),Nf(" ",n.formatDistance(e.distance)," - ",n.formatDuration(e.duration)," ")}}function Mge(r,i){if(r&1){let e=We();$(0,"mat-list-item",11),ve("mouseenter",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.showStep(o))})("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.showStep(o,!0))}),$(1,"mat-icon",12),le(2,"translate"),_e(3),ee(),$(4,"span",13),_e(5),ee(),Pe(6,Age,2,2,"span",14),ee()}if(r&2){let e=ne(),n=e.$implicit,o=e.index,s=ne(2);j(),z("matTooltip",ce(2,5,"igo.geo.directions.results.stepTitleTooltip")),j(2),Qe("",s.getFormattedStep(n,o).iconName," "),j(),z("matTooltip",s.getFormattedStep(n,o).instruction),j(),Qe(" ",s.getFormattedStep(n,o).instruction," "),j(),z("ngIf",o!==s.activeRoute.steps.length-1)}}function Ige(r,i){if(r&1&&(Dr(0),Pe(1,Mge,7,7,"mat-list-item",10),Rr()),r&2){let e=i.$implicit,n=i.index,o=ne(2);j(),z("ngIf",o.formatDistance(e.distance)&&o.formatDuration(e.duration)||n===o.activeRoute.steps.length-1)}}function Ege(r,i){if(r&1){let e=We();$(0,"div",1),Pe(1,Cge,6,6,"mat-form-field",2),$(2,"h3",3),_e(3),ee(),$(4,"mat-list",4),ve("mouseleave",function(){we(e);let o=ne();return xe(o.onLeaveList())}),Pe(5,Ige,2,1,"ng-container",5),ee()()}if(r&2){let e=ne();j(),z("ngIf",e.routes.length>1),j(2),Nf(" ",e.activeRoute.title," ",e.getTitleDurationAndDistance()," "),j(2),z("ngForOf",e.activeRoute.steps)}}var rE=(()=>{class r{languageService;cdRef;routesFeatureStore;stepsFeatureStore;activeRoute;routes;entities$$;constructor(e,n){this.languageService=e,this.cdRef=n}ngOnInit(){this.entities$$=this.routesFeatureStore.entities$.pipe(Br(200)).subscribe(e=>{let n=e.find(o=>o.properties.active);this.routes=e.map(o=>o.properties.directions),this.activeRoute=n?n.properties.directions:void 0,this.cdRef.detectChanges()})}ngOnDestroy(){this.entities$$.unsubscribe()}chooseRouteOption(){this.routesFeatureStore.entities$.value.map(e=>e.properties.active=!e.properties.active),this.routesFeatureStore.layer.ol.getSource().getFeatures().map(e=>e.set("active",!e.get("active")))}formatDistance(e){return i_(e)}formatDuration(e){return r_(e)}getTitleDurationAndDistance(){return this.formatDistance(this.activeRoute.distance)&&this.formatDuration(this.activeRoute.duration)?" ("+this.formatDistance(this.activeRoute.distance)+" - "+this.formatDuration(this.activeRoute.duration)+")":""}getFormattedStep(e,n){return Mb(e,this.languageService,n===this.activeRoute.steps.length-1)}onLeaveList(){this.stepsFeatureStore.clear()}showStep(e,n=!1){this.showRouteSegmentGeometry(e,n)}showRouteSegmentGeometry(e,n=!1){let o=e.geometry.coordinates,s="vertex",m=new Tr(o).transform("EPSG:4326",this.stepsFeatureStore.layer.map.projection).getCoordinates()[0],f=new Ii(m),g=new gi({geometry:f}),y=new Qr().writeGeometryObject(f,{featureProjection:this.stepsFeatureStore.layer.map.projection,dataProjection:this.stepsFeatureStore.layer.map.projection}),_=this.stepsFeatureStore.get(s),w=_?_.meta.revision:0,A={type:vr,geometry:y,projection:this.stepsFeatureStore.layer.map.projection,properties:{id:s,step:e,type:Rp.Vertex},meta:{id:s,revision:w+1},ol:g};this.stepsFeatureStore.update(A),n&&this.stepsFeatureStore.layer.map.viewController.zoomToExtent(g.getGeometry().getExtent())}static \u0275fac=function(n){return new(n||r)(Ie(Di),Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-directions-results"]],inputs:{routesFeatureStore:"routesFeatureStore",stepsFeatureStore:"stepsFeatureStore"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["class","igo-input-container",4,"ngIf"],[1,"igo-input-container"],[3,"matTooltip",4,"ngIf"],["mat-header","",1,"igo-route-title"],[3,"mouseleave"],[4,"ngFor","ngForOf"],[3,"matTooltip"],[3,"selectionChange","ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["matListItem","","class","igo-steps step",3,"mouseenter","click",4,"ngIf"],["matListItem","",1,"igo-steps","step",3,"mouseenter","click"],["matListItemIcon","",3,"matTooltip"],["matListItemTitle","",1,"step-title",3,"matTooltip"],["matListItemLine","",4,"ngIf"],["matListItemLine",""]],template:function(n,o){n&1&&Pe(0,Ege,6,4,"div",0),n&2&&z("ngIf",o.routes&&o.activeRoute)},dependencies:[Gt,jr,Gr,Mo,ho,uo,Nn,Sn,kn,nc,Li,Bn,dl,Qt,ti,Io,RA,ks,oc,rG,Ta,jt,$t,Et,Tt],styles:[`.igo-input-container[_ngcontent-%COMP%]{width:100%;padding:20px 10px;box-sizing:border-box}.igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.igo-route-title[_ngcontent-%COMP%]{font-weight:700;margin:0}.step[_ngcontent-%COMP%]{cursor:pointer}
/*# sourceMappingURL=directions-results.component-JKFAX6MP.css.map */`]})}return r})();var Tge=["switch"],Fge=["*"];function Pge(r,i){r&1&&($(0,"span",10),fp(),$(1,"svg",12),ct(2,"path",13),ee(),$(3,"svg",14),ct(4,"path",15),ee()())}var Lge=new Ln("mat-slide-toggle-default-options",{providedIn:"root",factory:()=>({disableToggleValue:!1,hideIcon:!1,disabledInteractive:!1})}),kge={provide:Yu,useExisting:Dl(()=>js),multi:!0},nE=class{constructor(i,e){this.source=i,this.checked=e}},Oge=0,js=(()=>{class r{_createChangeEvent(e){return new nE(this,e)}get buttonId(){return`${this.id||this._uniqueId}-button`}focus(){this._switchElement.nativeElement.focus()}get checked(){return this._checked}set checked(e){this._checked=e,this._changeDetectorRef.markForCheck()}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(e,n,o,s,l,h){this._elementRef=e,this._focusMonitor=n,this._changeDetectorRef=o,this.defaults=l,this._onChange=p=>{},this._onTouched=()=>{},this._validatorOnChange=()=>{},this._checked=!1,this.name=null,this.labelPosition="after",this.ariaLabel=null,this.ariaLabelledby=null,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.change=new Ke,this.toggleChange=new Ke,this.tabIndex=parseInt(s)||0,this.color=l.color||"accent",this._noopAnimations=h==="NoopAnimations",this.id=this._uniqueId=`mat-mdc-slide-toggle-${++Oge}`,this.hideIcon=l.hideIcon??!1,this.disabledInteractive=l.disabledInteractive??!1,this._labelId=this._uniqueId+"-label"}ngAfterContentInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{e==="keyboard"||e==="program"?(this._focused=!0,this._changeDetectorRef.markForCheck()):e||Promise.resolve().then(()=>{this._focused=!1,this._onTouched(),this._changeDetectorRef.markForCheck()})})}ngOnChanges(e){e.required&&this._validatorOnChange()}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}writeValue(e){this.checked=!!e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}validate(e){return this.required&&e.value!==!0?{required:!0}:null}registerOnValidatorChange(e){this._validatorOnChange=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck()}toggle(){this.checked=!this.checked,this._onChange(this.checked)}_emitChangeEvent(){this._onChange(this.checked),this.change.emit(this._createChangeEvent(this.checked))}_handleClick(){this.disabled||(this.toggleChange.emit(),this.defaults.disableToggleValue||(this.checked=!this.checked,this._onChange(this.checked),this.change.emit(new nE(this,this.checked))))}_getAriaLabelledBy(){return this.ariaLabelledby?this.ariaLabelledby:this.ariaLabel?null:this._labelId}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(F1),Ie(lr),Df("tabindex"),Ie(Lge),Ie(Ah,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-slide-toggle"]],viewQuery:function(n,o){if(n&1&&Ir(Tge,5),n&2){let s;bi(s=wi())&&(o._switchElement=s.first)}},hostAttrs:[1,"mat-mdc-slide-toggle"],hostVars:13,hostBindings:function(n,o){n&2&&(mm("id",o.id),Or("tabindex",null)("aria-label",null)("name",null)("aria-labelledby",null),Vd(o.color?"mat-"+o.color:""),dr("mat-mdc-slide-toggle-focused",o._focused)("mat-mdc-slide-toggle-checked",o.checked)("_mat-animation-noopable",o._noopAnimations))},inputs:{name:"name",id:"id",labelPosition:"labelPosition",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[0,"aria-describedby","ariaDescribedby"],required:[2,"required","required",Vi],color:"color",disabled:[2,"disabled","disabled",Vi],disableRipple:[2,"disableRipple","disableRipple",Vi],tabIndex:[2,"tabIndex","tabIndex",e=>e==null?0:Uo(e)],checked:[2,"checked","checked",Vi],hideIcon:[2,"hideIcon","hideIcon",Vi],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Vi]},outputs:{change:"change",toggleChange:"toggleChange"},exportAs:["matSlideToggle"],standalone:!0,features:[Xi([kge,{provide:DA,useExisting:r,multi:!0}]),$n,wu,lt],ngContentSelectors:Fge,decls:13,vars:27,consts:[["switch",""],["mat-internal-form-field","",3,"labelPosition"],["role","switch","type","button",1,"mdc-switch",3,"click","tabIndex","disabled"],[1,"mdc-switch__track"],[1,"mdc-switch__handle-track"],[1,"mdc-switch__handle"],[1,"mdc-switch__shadow"],[1,"mdc-elevation-overlay"],[1,"mdc-switch__ripple"],["mat-ripple","",1,"mat-mdc-slide-toggle-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-switch__icons"],[1,"mdc-label",3,"click","for"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--on"],["d","M19.69,5.23L8.96,15.96l-4.23-4.23L2.96,13.5l6,6L21.46,7L19.69,5.23z"],["viewBox","0 0 24 24","aria-hidden","true",1,"mdc-switch__icon","mdc-switch__icon--off"],["d","M20 13H4v-2h16v2z"]],template:function(n,o){if(n&1){let s=We();Kn(),$(0,"div",1)(1,"button",2,0),ve("click",function(){return we(s),xe(o._handleClick())}),ct(3,"span",3),$(4,"span",4)(5,"span",5)(6,"span",6),ct(7,"span",7),ee(),$(8,"span",8),ct(9,"span",9),ee(),Pe(10,Pge,5,0,"span",10),ee()()(),$(11,"label",11),ve("click",function(h){return we(s),xe(h.stopPropagation())}),Tn(12),ee()()}if(n&2){let s=Xt(2);z("labelPosition",o.labelPosition),j(),dr("mdc-switch--selected",o.checked)("mdc-switch--unselected",!o.checked)("mdc-switch--checked",o.checked)("mdc-switch--disabled",o.disabled)("mat-mdc-slide-toggle-disabled-interactive",o.disabledInteractive),z("tabIndex",o.disabled&&!o.disabledInteractive?-1:o.tabIndex)("disabled",o.disabled&&!o.disabledInteractive),Or("id",o.buttonId)("name",o.name)("aria-label",o.ariaLabel)("aria-labelledby",o._getAriaLabelledBy())("aria-describedby",o.ariaDescribedby)("aria-required",o.required||null)("aria-checked",o.checked)("aria-disabled",o.disabled&&o.disabledInteractive?"true":null),j(8),z("matRippleTrigger",s)("matRippleDisabled",o.disableRipple||o.disabled)("matRippleCentered",!0),j(),jc(o.hideIcon?-1:10),j(),z("for",o.buttonId),Or("id",o._labelId)}},dependencies:[fm,X7],styles:['.mdc-switch{align-items:center;background:none;border:none;cursor:pointer;display:inline-flex;flex-shrink:0;margin:0;outline:none;overflow:visible;padding:0;position:relative;width:var(--mdc-switch-track-width)}.mdc-switch.mdc-switch--disabled{cursor:default;pointer-events:none}.mdc-switch.mat-mdc-slide-toggle-disabled-interactive{pointer-events:auto}.mdc-switch__track{overflow:hidden;position:relative;width:100%;height:var(--mdc-switch-track-height);border-radius:var(--mdc-switch-track-shape, var(--mat-app-corner-full))}.mdc-switch--disabled.mdc-switch .mdc-switch__track{opacity:var(--mdc-switch-disabled-track-opacity)}.mdc-switch__track::before,.mdc-switch__track::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";height:100%;left:0;position:absolute;width:100%;border-width:var(--mat-switch-track-outline-width);border-color:var(--mat-switch-track-outline-color, var(--mat-app-outline))}.cdk-high-contrast-active .mdc-switch__track::before,.cdk-high-contrast-active .mdc-switch__track::after{border-color:currentColor}.mdc-switch--selected .mdc-switch__track::before,.mdc-switch--selected .mdc-switch__track::after{border-width:var(--mat-switch-selected-track-outline-width);border-color:var(--mat-switch-selected-track-outline-color)}.mdc-switch--disabled .mdc-switch__track::before,.mdc-switch--disabled .mdc-switch__track::after{border-width:var(--mat-switch-disabled-unselected-track-outline-width);border-color:var(--mat-switch-disabled-unselected-track-outline-color, var(--mat-app-on-surface))}.mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0, 0, 0.2, 1);transform:translateX(0);background:var(--mdc-switch-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__track::before{transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.6, 1);transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch--selected .mdc-switch__track::before{transform:translateX(-100%)}.mdc-switch--selected .mdc-switch__track::before{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch--unselected .mdc-switch__track::before{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-hover-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::before{background:var(--mdc-switch-unselected-focus-track-color, var(--mat-app-surface-variant))}.mdc-switch:enabled:active .mdc-switch__track::before{background:var(--mdc-switch-unselected-pressed-track-color, var(--mat-app-surface-variant))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::before,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::before,.mdc-switch.mdc-switch--disabled .mdc-switch__track::before{background:var(--mdc-switch-disabled-unselected-track-color, var(--mat-app-surface-variant))}.mdc-switch__track::after{transform:translateX(-100%);background:var(--mdc-switch-selected-track-color, var(--mat-app-primary))}[dir=rtl] .mdc-switch__track::after{transform:translateX(100%)}.mdc-switch--selected .mdc-switch__track::after{transform:translateX(0)}.mdc-switch--selected .mdc-switch__track::after{opacity:var(--mat-switch-visible-track-opacity);transition:var(--mat-switch-visible-track-transition)}.mdc-switch--unselected .mdc-switch__track::after{opacity:var(--mat-switch-hidden-track-opacity);transition:var(--mat-switch-hidden-track-transition)}.mdc-switch:enabled:hover:not(:focus):not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-hover-track-color, var(--mat-app-primary))}.mdc-switch:enabled:focus:not(:active) .mdc-switch__track::after{background:var(--mdc-switch-selected-focus-track-color, var(--mat-app-primary))}.mdc-switch:enabled:active .mdc-switch__track::after{background:var(--mdc-switch-selected-pressed-track-color, var(--mat-app-primary))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__track::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__track::after,.mdc-switch.mdc-switch--disabled .mdc-switch__track::after{background:var(--mdc-switch-disabled-selected-track-color, var(--mat-app-on-surface))}.mdc-switch__handle-track{height:100%;pointer-events:none;position:absolute;top:0;transition:transform 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);left:0;right:auto;transform:translateX(0);width:calc(100% - var(--mdc-switch-handle-width))}[dir=rtl] .mdc-switch__handle-track{left:auto;right:0}.mdc-switch--selected .mdc-switch__handle-track{transform:translateX(100%)}[dir=rtl] .mdc-switch--selected .mdc-switch__handle-track{transform:translateX(-100%)}.mdc-switch__handle{display:flex;pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);left:0;right:auto;transition:width 75ms cubic-bezier(0.4, 0, 0.2, 1),height 75ms cubic-bezier(0.4, 0, 0.2, 1),margin 75ms cubic-bezier(0.4, 0, 0.2, 1);width:var(--mdc-switch-handle-width);height:var(--mdc-switch-handle-height);border-radius:var(--mdc-switch-handle-shape, var(--mat-app-corner-full))}[dir=rtl] .mdc-switch__handle{left:auto;right:0}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle{width:var(--mat-switch-unselected-handle-size);height:var(--mat-switch-unselected-handle-size);margin:var(--mat-switch-unselected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-unselected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle{width:var(--mat-switch-selected-handle-size);height:var(--mat-switch-selected-handle-size);margin:var(--mat-switch-selected-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--selected .mdc-switch__handle:has(.mdc-switch__icons){margin:var(--mat-switch-selected-with-icon-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch__handle:has(.mdc-switch__icons){width:var(--mat-switch-with-icon-handle-size);height:var(--mat-switch-with-icon-handle-size)}.mat-mdc-slide-toggle .mdc-switch:active:not(.mdc-switch--disabled) .mdc-switch__handle{width:var(--mat-switch-pressed-handle-size);height:var(--mat-switch-pressed-handle-size)}.mat-mdc-slide-toggle .mdc-switch--selected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-selected-pressed-handle-horizontal-margin)}.mat-mdc-slide-toggle .mdc-switch--unselected:active:not(.mdc-switch--disabled) .mdc-switch__handle{margin:var(--mat-switch-unselected-pressed-handle-horizontal-margin)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-selected-handle-opacity)}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__handle::after{opacity:var(--mat-switch-disabled-unselected-handle-opacity)}.mdc-switch__handle::before,.mdc-switch__handle::after{border:1px solid rgba(0,0,0,0);border-radius:inherit;box-sizing:border-box;content:"";width:100%;height:100%;left:0;position:absolute;top:0;transition:background-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1),border-color 75ms 0ms cubic-bezier(0.4, 0, 0.2, 1);z-index:-1}.cdk-high-contrast-active .mdc-switch__handle::before,.cdk-high-contrast-active .mdc-switch__handle::after{border-color:currentColor}.mdc-switch--selected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-selected-handle-color, var(--mat-app-on-primary))}.mdc-switch--selected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-hover-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-selected-focus-handle-color, var(--mat-app-primary-container))}.mdc-switch--selected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-selected-pressed-handle-color, var(--mat-app-primary-container))}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:hover:not(:focus):not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:focus:not(:active) .mdc-switch__handle::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled.mdc-switch--selected:active .mdc-switch__handle::after,.mdc-switch--selected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-selected-handle-color, var(--mat-app-surface))}.mdc-switch--unselected:enabled .mdc-switch__handle::after{background:var(--mdc-switch-unselected-handle-color, var(--mat-app-outline))}.mdc-switch--unselected:enabled:hover:not(:focus):not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-hover-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:focus:not(:active) .mdc-switch__handle::after{background:var(--mdc-switch-unselected-focus-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected:enabled:active .mdc-switch__handle::after{background:var(--mdc-switch-unselected-pressed-handle-color, var(--mat-app-on-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__handle::after{background:var(--mdc-switch-disabled-unselected-handle-color, var(--mat-app-on-surface))}.mdc-switch__handle::before{background:var(--mdc-switch-handle-surface-color)}.mdc-switch__shadow{border-radius:inherit;bottom:0;left:0;position:absolute;right:0;top:0}.mdc-switch:enabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-handle-elevation-shadow)}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:hover:not(:focus):not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:focus:not(:active) .mdc-switch__shadow,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:active .mdc-switch__shadow,.mdc-switch.mdc-switch--disabled .mdc-switch__shadow{box-shadow:var(--mdc-switch-disabled-handle-elevation-shadow)}.mdc-switch__ripple{left:50%;position:absolute;top:50%;transform:translate(-50%, -50%);z-index:-1;width:var(--mdc-switch-state-layer-size);height:var(--mdc-switch-state-layer-size)}.mdc-switch__ripple::after{content:"";opacity:0}.mdc-switch--disabled .mdc-switch__ripple::after{display:none}.mat-mdc-slide-toggle-disabled-interactive .mdc-switch__ripple::after{display:block}.mdc-switch:hover .mdc-switch__ripple::after{opacity:.04;transition:75ms opacity cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mdc-switch .mdc-switch__ripple::after{opacity:.12}.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:focus .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:active .mdc-switch__ripple::after,.mat-mdc-slide-toggle-disabled-interactive.mdc-switch--disabled:enabled:hover:not(:focus) .mdc-switch__ripple::after,.mdc-switch--unselected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-hover-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-focus-state-layer-color, var(--mat-app-on-surface))}.mdc-switch--unselected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-unselected-pressed-state-layer-color, var(--mat-app-on-surface));opacity:var(--mdc-switch-unselected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch--selected:enabled:hover:not(:focus) .mdc-switch__ripple::after{background:var(--mdc-switch-selected-hover-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:focus .mdc-switch__ripple::after{background:var(--mdc-switch-selected-focus-state-layer-color, var(--mat-app-primary))}.mdc-switch--selected:enabled:active .mdc-switch__ripple::after{background:var(--mdc-switch-selected-pressed-state-layer-color, var(--mat-app-primary));opacity:var(--mdc-switch-selected-pressed-state-layer-opacity, var(--mat-app-pressed-state-layer-opacity));transition:opacity 75ms linear}.mdc-switch__icons{position:relative;height:100%;width:100%;z-index:1}.mdc-switch--disabled.mdc-switch--unselected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-unselected-icon-opacity)}.mdc-switch--disabled.mdc-switch--selected .mdc-switch__icons{opacity:var(--mdc-switch-disabled-selected-icon-opacity)}.mdc-switch__icon{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;opacity:0;transition:opacity 30ms 0ms cubic-bezier(0.4, 0, 1, 1)}.mdc-switch--unselected .mdc-switch__icon{width:var(--mdc-switch-unselected-icon-size);height:var(--mdc-switch-unselected-icon-size);fill:var(--mdc-switch-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--unselected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-unselected-icon-color, var(--mat-app-surface-variant))}.mdc-switch--selected .mdc-switch__icon{width:var(--mdc-switch-selected-icon-size);height:var(--mdc-switch-selected-icon-size);fill:var(--mdc-switch-selected-icon-color, var(--mat-app-on-primary-container))}.mdc-switch--selected.mdc-switch--disabled .mdc-switch__icon{fill:var(--mdc-switch-disabled-selected-icon-color, var(--mat-app-on-surface))}.mdc-switch--selected .mdc-switch__icon--on,.mdc-switch--unselected .mdc-switch__icon--off{opacity:1;transition:opacity 45ms 30ms cubic-bezier(0, 0, 0.2, 1)}.mat-mdc-slide-toggle{-webkit-user-select:none;user-select:none;display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);outline:0}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple,.mat-mdc-slide-toggle .mdc-switch__ripple::after{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-slide-toggle .mat-mdc-slide-toggle-ripple:not(:empty),.mat-mdc-slide-toggle .mdc-switch__ripple::after:not(:empty){transform:translateZ(0)}.mat-mdc-slide-toggle.mat-mdc-slide-toggle-focused .mat-mdc-focus-indicator::before{content:""}.mat-mdc-slide-toggle .mat-internal-form-field{color:var(--mat-switch-label-text-color, var(--mat-app-on-surface));font-family:var(--mat-switch-label-text-font, var(--mat-app-body-medium-font));line-height:var(--mat-switch-label-text-line-height, var(--mat-app-body-medium-line-height));font-size:var(--mat-switch-label-text-size, var(--mat-app-body-medium-size));letter-spacing:var(--mat-switch-label-text-tracking, var(--mat-app-body-medium-tracking));font-weight:var(--mat-switch-label-text-weight, var(--mat-app-body-medium-weight))}.mat-mdc-slide-toggle .mat-ripple-element{opacity:.12}.mat-mdc-slide-toggle .mat-mdc-focus-indicator::before{border-radius:50%}.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle-track,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__icon,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__handle::after,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::before,.mat-mdc-slide-toggle._mat-animation-noopable .mdc-switch__track::after{transition:none}.mat-mdc-slide-toggle .mdc-switch:enabled+.mdc-label{cursor:pointer}.mat-mdc-slide-toggle .mdc-switch--disabled+label{color:var(--mdc-switch-disabled-label-text-color)}'],encapsulation:2,changeDetection:0})}}return r})();var bl=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[js,ul,ul]})}}return r})();var yR=class extends Xh{constructor(i){super(),i=i||{},this.delta_=i.delta?i.delta:1,this.duration_=i.duration!==void 0?i.duration:250}handleEvent(i){let e=!1;if(i.type==sn.DBLCLICK){let n=i.originalEvent,o=i.map,s=i.coordinate,l=n.shiftKey?-this.delta_:this.delta_,h=o.getView();yb(h,l,s,this.duration_),n.preventDefault(),e=!0}return!e}},HY=yR;var vR=class extends lu{constructor(i){super({stopDown:Gh}),i=i||{},this.kinetic_=i.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;let e=i.condition?i.condition:e2(bb,W5);this.condition_=i.onFocusOnly?e2(j5,e):e,this.noKinetic_=!1}handleDragEvent(i){let e=i.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());let n=this.targetPointers,o=e.getEventPixel(vb(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(o[0],o[1]),this.lastCentroid){let s=[this.lastCentroid[0]-o[0],o[1]-this.lastCentroid[1]],h=i.map.getView();nM(s,h.getResolution()),Z1(s,h.getRotation()),h.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o,this.lastPointersCount_=n.length,i.originalEvent.preventDefault()}handleUpEvent(i){let e=i.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){let o=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),l=n.getCenterInternal(),h=e.getPixelFromCoordinateInternal(l),p=e.getCoordinateFromPixelInternal([h[0]-o*Math.cos(s),h[1]-o*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(p),duration:500,easing:$l})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(i){if(this.targetPointers.length>0&&this.condition_(i)){let n=i.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},qY=vR;var bR=class extends lu{constructor(i){i=i||{},super({stopDown:Gh}),this.condition_=i.condition?i.condition:Bq,this.lastAngle_=void 0,this.duration_=i.duration!==void 0?i.duration:250}handleDragEvent(i){if(!$5(i))return;let e=i.map,n=e.getView();if(n.getConstraints().rotation===ob)return;let o=e.getSize(),s=i.pixel,l=Math.atan2(o[1]/2-s[1],s[0]-o[0]/2);if(this.lastAngle_!==void 0){let h=l-this.lastAngle_;n.adjustRotationInternal(-h)}this.lastAngle_=l}handleUpEvent(i){return $5(i)?(i.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(i){return $5(i)&&V5(i)&&this.condition_(i)?(i.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}},YY=bR;var wR=class extends xb{constructor(i){i=i||{};let e=i.condition?i.condition:wb;super({condition:e,className:i.className||"ol-dragzoom",minArea:i.minArea}),this.duration_=i.duration!==void 0?i.duration:200,this.out_=i.out!==void 0?i.out:!1}onBoxEnd(i){let n=this.getMap().getView(),o=this.getGeometry();if(this.out_){let s=n.rotatedExtentForGeometry(o),l=n.getResolutionForExtentInternal(s),h=n.getResolution()/l;o=o.clone(),o.scale(h*h)}n.fitInternal(o,{duration:this.duration_,easing:$l})}},ZY=wR;var xR=class extends To{constructor(i,e,n){super(i),this.map=e,this.frameState=n!==void 0?n:null}},o_=xR;var SR=class extends o_{constructor(i,e,n,o,s,l){super(i,e,s),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=o!==void 0?o:!1,this.activePointers=l}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(i){this.pixel_=i}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(i){this.coordinate_=i}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}},Qh=SR;var aE={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"},Pb=class extends To{constructor(i,e){super(i),this.feature=e}};function Dge(r,i){let e=[];for(let n=0;n<i.length;++n){let s=i[n].getGeometry();XY(r,s,e)}return e}function sE(r,i){return od(r[0],r[1],i[0],i[1])}function Lb(r,i){let e=r.length;return i<0?r[i+e]:i>=e?r[i-e]:r[i]}function lE(r,i,e){let n,o;i<e?(n=i,o=e):(n=e,o=i);let s=Math.ceil(n),l=Math.floor(o);if(s>l){let p=kb(r,n),m=kb(r,o);return sE(p,m)}let h=0;if(n<s){let p=kb(r,n),m=Lb(r,s);h+=sE(p,m)}if(l<o){let p=Lb(r,l),m=kb(r,o);h+=sE(p,m)}for(let p=s;p<l-1;++p){let m=Lb(r,p),f=Lb(r,p+1);h+=sE(m,f)}return h}function XY(r,i,e){if(i instanceof Tr){cE(r,i.getCoordinates(),!1,e);return}if(i instanceof Ko){let n=i.getCoordinates();for(let o=0,s=n.length;o<s;++o)cE(r,n[o],!1,e);return}if(i instanceof on){let n=i.getCoordinates();for(let o=0,s=n.length;o<s;++o)cE(r,n[o],!0,e);return}if(i instanceof es){let n=i.getCoordinates();for(let o=0,s=n.length;o<s;++o){let l=n[o];for(let h=0,p=l.length;h<p;++h)cE(r,l[h],!0,e)}return}if(i instanceof _s){let n=i.getGeometries();for(let o=0;o<n.length;++o)XY(r,n[o],e);return}}var CR={index:-1,endIndex:NaN};function Rge(r,i,e,n){let o=r[0],s=r[1],l=1/0,h=-1,p=NaN;for(let g=0;g<i.targets.length;++g){let y=i.targets[g],_=y.coordinates,w=1/0,A;for(let k=0;k<_.length-1;++k){let R=_[k],q=_[k+1],X=KY(o,s,R,q);X.squaredDistance<w&&(w=X.squaredDistance,A=k+X.along)}w<l&&(l=w,y.ring&&i.targetIndex===g&&(y.endIndex>y.startIndex?A<y.startIndex&&(A+=_.length):y.endIndex<y.startIndex&&A>y.startIndex&&(A-=_.length)),p=A,h=g)}let m=i.targets[h],f=m.ring;if(i.targetIndex===h&&f){let g=kb(m.coordinates,p),y=e.getPixelFromCoordinate(g);v0(y,i.startPx)>n&&(f=!1)}if(f){let g=m.coordinates,y=g.length,_=m.startIndex,w=p;if(_<w){let A=lE(g,_,w);lE(g,_,w-y)<A&&(p-=y)}else{let A=lE(g,_,w);lE(g,_,w+y)<A&&(p+=y)}}return CR.index=h,CR.endIndex=p,CR}function cE(r,i,e,n){let o=r[0],s=r[1];for(let l=0,h=i.length-1;l<h;++l){let p=i[l],m=i[l+1],f=KY(o,s,p,m);if(f.squaredDistance===0){let g=l+f.along;n.push({coordinates:i,ring:e,startIndex:g,endIndex:g});return}}}var AR={along:0,squaredDistance:0};function KY(r,i,e,n){let o=e[0],s=e[1],l=n[0],h=n[1],p=l-o,m=h-s,f=0,g=o,y=s;return(p!==0||m!==0)&&(f=to(((r-o)*p+(i-s)*m)/(p*p+m*m),0,1),g+=p*f,y+=m*f),AR.along=f,AR.squaredDistance=ay(od(r,i,g,y),10),AR}function kb(r,i){let e=r.length,n=Math.floor(i),o=i-n;n>=e?n-=e:n<0&&(n+=e);let s=n+1;s>=e&&(s-=e);let l=r[n],h=l[0],p=l[1],m=r[s],f=m[0]-h,g=m[1]-p;return[h+f*o,p+g*o]}var MR=class extends lu{constructor(i){let e=i;e.stopDown||(e.stopDown=Gh),super(e),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=i.source?i.source:null,this.features_=i.features?i.features:null,this.snapTolerance_=i.snapTolerance?i.snapTolerance:12,this.type_=i.type,this.mode_=Bge(this.type_),this.stopClick_=!!i.stopClick,this.minPoints_=i.minPoints?i.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:i.maxPoints?i.maxPoints:1/0,this.finishCondition_=i.finishCondition?i.finishCondition:Tc,this.geometryLayout_=i.geometryLayout?i.geometryLayout:"XY";let n=i.geometryFunction;if(!n){let o=this.mode_;if(o==="Circle")n=function(s,l,h){let p=l||new Tu([NaN,NaN]),m=zo(s[0],h),f=y0(m,zo(s[s.length-1],h));p.setCenterAndRadius(m,Math.sqrt(f),this.geometryLayout_);let g=fl();return g&&p.transform(h,g),p};else{let s;o==="Point"?s=Ii:o==="LineString"?s=Tr:o==="Polygon"&&(s=on),n=function(l,h,p){return h?o==="Polygon"?l[0].length?h.setCoordinates([l[0].concat([l[0][0]])],this.geometryLayout_):h.setCoordinates([],this.geometryLayout_):h.setCoordinates(l,this.geometryLayout_):h=new s(l,this.geometryLayout_),h}}}this.geometryFunction_=n,this.dragVertexDelay_=i.dragVertexDelay!==void 0?i.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=i.clickTolerance?i.clickTolerance*i.clickTolerance:36,this.overlay_=new fc({source:new $a({useSpatialIndex:!1,wrapX:i.wrapX?i.wrapX:!1}),style:i.style?i.style:Nge(),updateWhileInteracting:!0}),this.geometryName_=i.geometryName,this.condition_=i.condition?i.condition:bb,this.freehandCondition_,i.freehand?this.freehandCondition_=xg:this.freehandCondition_=i.freehandCondition?i.freehandCondition:wb,this.traceCondition_,this.setTrace(i.trace||!1),this.traceState_={active:!1},this.traceSource_=i.traceSource||i.source||null,this.addChangeListener(Ny.ACTIVE,this.updateState_)}setTrace(i){let e;i?i===!0?e=xg:e=i:e=t2,this.traceCondition_=e}setMap(i){super.setMap(i),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(i){i.originalEvent.type===mi.CONTEXTMENU&&i.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(i);let e=i.type===sn.POINTERMOVE,n=!0;return!this.freehand_&&this.lastDragTime_&&i.type===sn.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=i.pixel,this.shouldHandle_=!this.freehand_,e=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&i.type===sn.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(i.coordinate),n=!1):this.freehand_&&i.type===sn.POINTERDOWN?n=!1:e&&this.getPointerCount()<2?(n=i.type===sn.POINTERMOVE,n&&this.freehand_?(this.handlePointerMove_(i),this.shouldHandle_&&i.originalEvent.preventDefault()):(i.originalEvent.pointerType==="mouse"||i.type===sn.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(i)):i.type===sn.DBLCLICK&&(n=!1),super.handleEvent(i)&&n}handleDownEvent(i){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=i.pixel,this.finishCoordinate_||this.startDrawing_(i.coordinate),!0):this.condition_(i)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Qh(sn.POINTERMOVE,i.map,i.originalEvent,!1,i.frameState))},this.dragVertexDelay_),this.downPx_=i.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(i){if(!this.traceSource_||!this.traceCondition_(i))return;if(this.traceState_.active){this.deactivateTrace_();return}let e=this.getMap(),n=e.getCoordinateFromPixel([i.pixel[0]-this.snapTolerance_,i.pixel[1]+this.snapTolerance_]),o=e.getCoordinateFromPixel([i.pixel[0]+this.snapTolerance_,i.pixel[1]-this.snapTolerance_]),s=Ds([n,o]),l=this.traceSource_.getFeaturesInExtent(s);if(l.length===0)return;let h=Dge(i.coordinate,l);h.length&&(this.traceState_={active:!0,startPx:i.pixel.slice(),targets:h,targetIndex:-1})}addOrRemoveTracedCoordinates_(i,e){let n=i.startIndex<=i.endIndex,o=i.startIndex<=e;n===o?n&&e>i.endIndex||!n&&e<i.endIndex?this.addTracedCoordinates_(i,i.endIndex,e):(n&&e<i.endIndex||!n&&e>i.endIndex)&&this.removeTracedCoordinates_(e,i.endIndex):(this.removeTracedCoordinates_(i.startIndex,i.endIndex),this.addTracedCoordinates_(i,i.startIndex,e))}removeTracedCoordinates_(i,e){if(i===e)return;let n=0;if(i<e){let o=Math.ceil(i),s=Math.floor(e);s===e&&(s-=1),n=s-o+1}else{let o=Math.floor(i),s=Math.ceil(e);s===e&&(s+=1),n=o-s+1}n>0&&this.removeLastPoints_(n)}addTracedCoordinates_(i,e,n){if(e===n)return;let o=[];if(e<n){let s=Math.ceil(e),l=Math.floor(n);l===n&&(l-=1);for(let h=s;h<=l;++h)o.push(Lb(i.coordinates,h))}else{let s=Math.floor(e),l=Math.ceil(n);l===n&&(l+=1);for(let h=s;h>=l;--h)o.push(Lb(i.coordinates,h))}o.length&&this.appendCoordinates(o)}updateTrace_(i){let e=this.traceState_;if(!e.active||e.targetIndex===-1&&v0(e.startPx,i.pixel)<this.snapTolerance_)return;let n=Rge(i.coordinate,e,this.getMap(),this.snapTolerance_);if(e.targetIndex!==n.index){if(e.targetIndex!==-1){let p=e.targets[e.targetIndex];this.removeTracedCoordinates_(p.startIndex,p.endIndex)}let h=e.targets[n.index];this.addTracedCoordinates_(h,h.startIndex,n.endIndex)}else{let h=e.targets[e.targetIndex];this.addOrRemoveTracedCoordinates_(h,n.endIndex)}e.targetIndex=n.index;let o=e.targets[e.targetIndex];o.endIndex=n.endIndex;let s=kb(o.coordinates,o.endIndex),l=this.getMap().getPixelFromCoordinate(s);i.coordinate=s,i.pixel=[Math.round(l[0]),Math.round(l[1])]}handleUpEvent(i){let e=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(i);let n=this.traceState_.active;if(this.toggleTraceState_(i),this.shouldHandle_){let o=!this.finishCoordinate_;o&&this.startDrawing_(i.coordinate),!o&&this.freehand_?this.finishDrawing():!this.freehand_&&(!o||this.mode_==="Point")&&(this.atFinish_(i.pixel,n)?this.finishCondition_(i)&&this.finishDrawing():this.addToDrawing_(i.coordinate)),e=!1}else this.freehand_&&this.abortDrawing()}return!e&&this.stopClick_&&i.preventDefault(),e}handlePointerMove_(i){if(this.pointerType_=i.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){let e=this.downPx_,n=i.pixel,o=e[0]-n[0],s=e[1]-n[1],l=o*o+s*s;if(this.shouldHandle_=this.freehand_?l>this.squaredClickTolerance_:l<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(i.coordinate.slice());return}this.updateTrace_(i),this.modifyDrawing_(i.coordinate)}atFinish_(i,e){let n=!1;if(this.sketchFeature_){let o=!1,s=[this.finishCoordinate_],l=this.mode_;if(l==="Point")n=!0;else if(l==="Circle")n=this.sketchCoords_.length===2;else if(l==="LineString")o=!e&&this.sketchCoords_.length>this.minPoints_;else if(l==="Polygon"){let h=this.sketchCoords_;o=h[0].length>this.minPoints_,s=[h[0][0],h[0][h[0].length-2]],e?s=[h[0][0]]:s=[h[0][0],h[0][h[0].length-2]]}if(o){let h=this.getMap();for(let p=0,m=s.length;p<m;p++){let f=s[p],g=h.getPixelFromCoordinate(f),y=i[0]-g[0],_=i[1]-g[1],w=this.freehand_?1:this.snapTolerance_;if(n=Math.sqrt(y*y+_*_)<=w,n){this.finishCoordinate_=f;break}}}}return n}createOrUpdateSketchPoint_(i){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(i):(this.sketchPoint_=new gi(new Ii(i)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(i){this.sketchLine_||(this.sketchLine_=new gi);let e=i.getLinearRing(0),n=this.sketchLine_.getGeometry();n?(n.setFlatCoordinates(e.getLayout(),e.getFlatCoordinates()),n.changed()):(n=new Tr(e.getFlatCoordinates(),e.getLayout()),this.sketchLine_.setGeometry(n))}startDrawing_(i){let e=this.getMap().getView().getProjection(),n=wy(this.geometryLayout_);for(;i.length<n;)i.push(0);this.finishCoordinate_=i,this.mode_==="Point"?this.sketchCoords_=i.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[i.slice(),i.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[i.slice(),i.slice()],this.sketchLineCoords_&&(this.sketchLine_=new gi(new Tr(this.sketchLineCoords_)));let o=this.geometryFunction_(this.sketchCoords_,void 0,e);this.sketchFeature_=new gi,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(o),this.updateSketchFeatures_(),this.dispatchEvent(new Pb(aE.DRAWSTART,this.sketchFeature_))}modifyDrawing_(i){let e=this.getMap(),n=this.sketchFeature_.getGeometry(),o=e.getView().getProjection(),s=wy(this.geometryLayout_),l,h;for(;i.length<s;)i.push(0);this.mode_==="Point"?h=this.sketchCoords_:this.mode_==="Polygon"?(l=this.sketchCoords_[0],h=l[l.length-1],this.atFinish_(e.getPixelFromCoordinate(i))&&(i=this.finishCoordinate_.slice())):(l=this.sketchCoords_,h=l[l.length-1]),h[0]=i[0],h[1]=i[1],this.geometryFunction_(this.sketchCoords_,n,o),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(i),n.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(n):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(i){let e=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),o,s,l=this.mode_;return l==="LineString"||l==="Circle"?(this.finishCoordinate_=i.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():o=!0),s.push(i.slice()),this.geometryFunction_(s,e,n)):l==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():o=!0),s.push(i.slice()),o&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,e,n)),this.createOrUpdateSketchPoint_(i.slice()),this.updateSketchFeatures_(),o?this.finishDrawing():this.sketchFeature_}removeLastPoints_(i){if(!this.sketchFeature_)return;let e=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection(),o=this.mode_;for(let s=0;s<i;++s){let l;if(o==="LineString"||o==="Circle"){if(l=this.sketchCoords_,l.splice(-2,1),l.length>=2){this.finishCoordinate_=l[l.length-2].slice();let h=this.finishCoordinate_.slice();l[l.length-1]=h,this.createOrUpdateSketchPoint_(h)}this.geometryFunction_(l,e,n),e.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(e)}else if(o==="Polygon"){l=this.sketchCoords_[0],l.splice(-2,1);let h=this.sketchLine_.getGeometry();if(l.length>=2){let p=l[l.length-2].slice();l[l.length-1]=p,this.createOrUpdateSketchPoint_(p)}h.setCoordinates(l),this.geometryFunction_(this.sketchCoords_,e,n)}if(l.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){let i=this.abortDrawing_();if(!i)return null;let e=this.sketchCoords_,n=i.getGeometry(),o=this.getMap().getView().getProjection();return this.mode_==="LineString"?(e.pop(),this.geometryFunction_(e,n,o)):this.mode_==="Polygon"&&(e[0].pop(),this.geometryFunction_(e,n,o),e=n.getCoordinates()),this.type_==="MultiPoint"?i.setGeometry(new tl([e])):this.type_==="MultiLineString"?i.setGeometry(new Ko([e])):this.type_==="MultiPolygon"&&i.setGeometry(new es([e])),this.dispatchEvent(new Pb(aE.DRAWEND,i)),this.features_&&this.features_.push(i),this.source_&&this.source_.addFeature(i),i}abortDrawing_(){this.finishCoordinate_=null;let i=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),i}abortDrawing(){let i=this.abortDrawing_();i&&this.dispatchEvent(new Pb(aE.DRAWABORT,i))}appendCoordinates(i){let e=this.mode_,n=!this.sketchFeature_;n&&this.startDrawing_(i[0]);let o;if(e==="LineString"||e==="Circle")o=this.sketchCoords_;else if(e==="Polygon")o=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;n&&o.shift(),o.pop();for(let l=0;l<i.length;l++)this.addToDrawing_(i[l]);let s=i[i.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(i){let n=i.getGeometry();this.sketchFeature_=i,this.sketchCoords_=n.getCoordinates();let o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice(),this.sketchCoords_.push(o.slice()),this.sketchPoint_=new gi(new Ii(o)),this.updateSketchFeatures_(),this.dispatchEvent(new Pb(aE.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){let i=[];this.sketchFeature_&&i.push(this.sketchFeature_),this.sketchLine_&&i.push(this.sketchLine_),this.sketchPoint_&&i.push(this.sketchPoint_);let e=this.overlay_.getSource();e.clear(!0),e.addFeatures(i)}updateState_(){let i=this.getMap(),e=this.getActive();(!i||!e)&&this.abortDrawing(),this.overlay_.setMap(e?i:null)}};function Nge(){let r=Dv();return function(i,e){return r[i.getGeometry().getType()]}}function Bge(r){switch(r){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+r)}}var Vy=MR;var a_={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};var IR=class extends Xh{constructor(i){super(),i=i||{},this.defaultCondition_=function(e){return bb(e)&&z5(e)},this.condition_=i.condition!==void 0?i.condition:this.defaultCondition_,this.duration_=i.duration!==void 0?i.duration:100,this.pixelDelta_=i.pixelDelta!==void 0?i.pixelDelta:128}handleEvent(i){let e=!1;if(i.type==mi.KEYDOWN){let n=i.originalEvent,o=n.key;if(this.condition_(i)&&(o==a_.DOWN||o==a_.LEFT||o==a_.RIGHT||o==a_.UP)){let l=i.map.getView(),h=l.getResolution()*this.pixelDelta_,p=0,m=0;o==a_.DOWN?m=-h:o==a_.LEFT?p=-h:o==a_.RIGHT?p=h:m=h;let f=[p,m];Z1(f,l.getRotation()),Dq(l,f,this.duration_),n.preventDefault(),e=!0}}return!e}},QY=IR;var ER=class extends Xh{constructor(i){super(),i=i||{},this.condition_=i.condition?i.condition:function(e){return!Vq(e)&&z5(e)},this.delta_=i.delta?i.delta:1,this.duration_=i.duration!==void 0?i.duration:100}handleEvent(i){let e=!1;if(i.type==mi.KEYDOWN||i.type==mi.KEYPRESS){let n=i.originalEvent,o=n.key;if(this.condition_(i)&&(o==="+"||o==="-")){let s=i.map,l=o==="+"?this.delta_:-this.delta_,h=s.getView();yb(h,l,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}},JY=ER;var Jh={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"};var eZ=0,p2=1,tZ=[0,0,0,0],Ob=[],TR={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"},m2=class extends To{constructor(i,e,n){super(i),this.features=e,this.mapBrowserEvent=n}},FR=class extends lu{constructor(i){super(i),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=i.condition?i.condition:W5,this.defaultDeleteCondition_=function(n){return Nq(n)&&U5(n)},this.deleteCondition_=i.deleteCondition?i.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=i.insertVertexCondition?i.insertVertexCondition:xg,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new RS,this.pixelTolerance_=i.pixelTolerance!==void 0?i.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new fc({source:new $a({useSpatialIndex:!1,wrapX:!!i.wrapX}),style:i.style?i.style:jge(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let e;if(i.features?e=i.features:i.source&&(this.source_=i.source,e=new Ua(this.source_.getFeatures()),this.source_.addEventListener(au.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(au.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!e)throw new Error("The modify interaction requires features, a source or a layer");i.hitDetection&&(this.hitDetection_=i.hitDetection),this.features_=e,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Va.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Va.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=i.snapToPointer===void 0?!this.hitDetection_:i.snapToPointer}addFeature_(i){let e=i.getGeometry();if(e){let o=this.SEGMENT_WRITERS_[e.getType()];o&&o(i,e)}let n=this.getMap();n&&n.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,n),i.addEventListener(mi.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(i,e){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Ua;let n=this.featuresBeingModified_.getArray();for(let o=0,s=e.length;o<s;++o){let l=e[o];for(let h=0,p=l.length;h<p;++h){let m=l[h].feature;m&&!n.includes(m)&&this.featuresBeingModified_.push(m)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new m2(TR.MODIFYSTART,this.featuresBeingModified_,i))}}removeFeature_(i){this.removeFeatureSegmentData_(i),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),i.removeEventListener(mi.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(i){let e=this.rBush_,n=[];e.forEach(function(o){i===o.feature&&n.push(o)});for(let o=n.length-1;o>=0;--o){let s=n[o];for(let l=this.dragSegments_.length-1;l>=0;--l)this.dragSegments_[l][0]===s&&this.dragSegments_.splice(l,1);e.remove(s)}}setActive(i){this.vertexFeature_&&!i&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(i)}setMap(i){this.overlay_.setMap(i),super.setMap(i)}getOverlay(){return this.overlay_}handleSourceAdd_(i){i.feature&&this.features_.push(i.feature)}handleSourceRemove_(i){i.feature&&this.features_.remove(i.feature)}handleFeatureAdd_(i){this.addFeature_(i.element)}handleFeatureChange_(i){if(!this.changingFeature_){let e=i.target;this.removeFeature_(e),this.addFeature_(e)}}handleFeatureRemove_(i){this.removeFeature_(i.element)}writePointGeometry_(i,e){let n=e.getCoordinates(),o={feature:i,geometry:e,segment:[n,n]};this.rBush_.insert(e.getExtent(),o)}writeMultiPointGeometry_(i,e){let n=e.getCoordinates();for(let o=0,s=n.length;o<s;++o){let l=n[o],h={feature:i,geometry:e,depth:[o],index:o,segment:[l,l]};this.rBush_.insert(e.getExtent(),h)}}writeLineStringGeometry_(i,e){let n=e.getCoordinates();for(let o=0,s=n.length-1;o<s;++o){let l=n.slice(o,o+2),h={feature:i,geometry:e,index:o,segment:l};this.rBush_.insert(Ds(l),h)}}writeMultiLineStringGeometry_(i,e){let n=e.getCoordinates();for(let o=0,s=n.length;o<s;++o){let l=n[o];for(let h=0,p=l.length-1;h<p;++h){let m=l.slice(h,h+2),f={feature:i,geometry:e,depth:[o],index:h,segment:m};this.rBush_.insert(Ds(m),f)}}}writePolygonGeometry_(i,e){let n=e.getCoordinates();for(let o=0,s=n.length;o<s;++o){let l=n[o];for(let h=0,p=l.length-1;h<p;++h){let m=l.slice(h,h+2),f={feature:i,geometry:e,depth:[o],index:h,segment:m};this.rBush_.insert(Ds(m),f)}}}writeMultiPolygonGeometry_(i,e){let n=e.getCoordinates();for(let o=0,s=n.length;o<s;++o){let l=n[o];for(let h=0,p=l.length;h<p;++h){let m=l[h];for(let f=0,g=m.length-1;f<g;++f){let y=m.slice(f,f+2),_={feature:i,geometry:e,depth:[h,o],index:f,segment:y};this.rBush_.insert(Ds(y),_)}}}}writeCircleGeometry_(i,e){let n=e.getCenter(),o={feature:i,geometry:e,index:eZ,segment:[n,n]},s={feature:i,geometry:e,index:p2,segment:[n,n]},l=[o,s];o.featureSegments=l,s.featureSegments=l,this.rBush_.insert(Sm(n),o);let h=e,p=fl();if(p&&this.getMap()){let m=this.getMap().getView().getProjection();h=h.clone().transform(p,m),h=Kd(h).transform(m,p)}this.rBush_.insert(h.getExtent(),s)}writeGeometryCollectionGeometry_(i,e){let n=e.getGeometriesArray();for(let o=0;o<n.length;++o){let s=n[o],l=this.SEGMENT_WRITERS_[s.getType()];l(i,s)}}createOrUpdateVertexFeature_(i,e,n){let o=this.vertexFeature_;return o?o.getGeometry().setCoordinates(i):(o=new gi(new Ii(i)),this.vertexFeature_=o,this.overlay_.getSource().addFeature(o)),o.set("features",e),o.set("geometries",n),o}handleEvent(i){if(!i.originalEvent)return!0;this.lastPointerEvent_=i;let e;return!i.map.getView().getInteracting()&&i.type==sn.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(i),this.vertexFeature_&&this.deleteCondition_(i)&&(i.type!=sn.SINGLECLICK||!this.ignoreNextSingleClick_?e=this.removePoint():e=!0),i.type==sn.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(i)&&!e}handleDragEvent(i){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(i,this.dragSegments_);let e=[i.coordinate[0]+this.delta_[0],i.coordinate[1]+this.delta_[1]],n=[],o=[];for(let s=0,l=this.dragSegments_.length;s<l;++s){let h=this.dragSegments_[s],p=h[0],m=p.feature;n.includes(m)||n.push(m);let f=p.geometry;o.includes(f)||o.push(f);let g=p.depth,y,_=p.segment,w=h[1];for(;e.length<f.getStride();)e.push(_[w][e.length]);switch(f.getType()){case"Point":y=e,_[0]=e,_[1]=e;break;case"MultiPoint":y=f.getCoordinates(),y[p.index]=e,_[0]=e,_[1]=e;break;case"LineString":y=f.getCoordinates(),y[p.index+w]=e,_[w]=e;break;case"MultiLineString":y=f.getCoordinates(),y[g[0]][p.index+w]=e,_[w]=e;break;case"Polygon":y=f.getCoordinates(),y[g[0]][p.index+w]=e,_[w]=e;break;case"MultiPolygon":y=f.getCoordinates(),y[g[1]][g[0]][p.index+w]=e,_[w]=e;break;case"Circle":if(_[0]=e,_[1]=e,p.index===eZ)this.changingFeature_=!0,f.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;let A=i.map.getView().getProjection(),k=v0(zo(f.getCenter(),A),zo(e,A)),R=fl();if(R){let q=f.clone().transform(R,A);q.setRadius(k),k=q.transform(A,R).getRadius()}f.setRadius(k),this.changingFeature_=!1}break;default:}y&&this.setGeometryCoordinates_(f,y)}this.createOrUpdateVertexFeature_(e,n,o)}handleDownEvent(i){if(!this.condition_(i))return!1;let e=i.coordinate;this.handlePointerAtPixel_(i.pixel,i.map,e),this.dragSegments_.length=0,this.featuresBeingModified_=null;let n=this.vertexFeature_;if(n){let o=i.map.getView().getProjection(),s=[],l=n.getGeometry().getCoordinates(),h=Ds([l]),p=this.rBush_.getInExtent(h),m={};p.sort(Gge);for(let f=0,g=p.length;f<g;++f){let y=p[f],_=y.segment,w=fi(y.geometry),A=y.depth;if(A&&(w+="-"+A.join("-")),m[w]||(m[w]=new Array(2)),y.geometry.getType()==="Circle"&&y.index===p2){let k=rZ(e,y,o);Mu(k,l)&&!m[w][0]&&(this.dragSegments_.push([y,0]),m[w][0]=y);continue}if(Mu(_[0],l)&&!m[w][0]){this.dragSegments_.push([y,0]),m[w][0]=y;continue}if(Mu(_[1],l)&&!m[w][1]){if(m[w][0]&&m[w][0].index===0){let k=y.geometry.getCoordinates();switch(y.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":k=k[A[1]];case"Polygon":if(y.index!==k[A[0]].length-2)continue;break;default:}}this.dragSegments_.push([y,1]),m[w][1]=y;continue}fi(_)in this.vertexSegments_&&!m[w][0]&&!m[w][1]&&this.insertVertexCondition_(i)&&s.push(y)}s.length&&this.willModifyFeatures_(i,[s]);for(let f=s.length-1;f>=0;--f)this.insertVertex_(s[f],l)}return!!this.vertexFeature_}handleUpEvent(i){for(let e=this.dragSegments_.length-1;e>=0;--e){let n=this.dragSegments_[e][0],o=n.geometry;if(o.getType()==="Circle"){let s=o.getCenter(),l=n.featureSegments[0],h=n.featureSegments[1];l.segment[0]=s,l.segment[1]=s,h.segment[0]=s,h.segment[1]=s,this.rBush_.update(Sm(s),l);let p=o,m=fl();if(m){let f=i.map.getView().getProjection();p=p.clone().transform(m,f),p=Kd(p).transform(f,m)}this.rBush_.update(p.getExtent(),h)}else this.rBush_.update(Ds(n.segment),n)}return this.featuresBeingModified_&&(this.dispatchEvent(new m2(TR.MODIFYEND,this.featuresBeingModified_,i)),this.featuresBeingModified_=null),!1}handlePointerMove_(i){this.lastPixel_=i.pixel,this.handlePointerAtPixel_(i.pixel,i.map,i.coordinate)}handlePointerAtPixel_(i,e,n){let o=n||e.getCoordinateFromPixel(i),s=e.getView().getProjection(),l=function(m,f){return iZ(o,m,s)-iZ(o,f,s)},h,p;if(this.hitDetection_){let m=typeof this.hitDetection_=="object"?f=>f===this.hitDetection_:void 0;e.forEachFeatureAtPixel(i,(f,g,y)=>{y&&y.getType()==="Point"&&(y=new Ii($f(y.getCoordinates(),s)));let _=y||f.getGeometry();if(f instanceof gi&&this.features_.getArray().includes(f)){p=_;let w=f.getGeometry().getFlatCoordinates().slice(0,2);h=[{feature:f,geometry:p,segment:[w,w]}]}return!0},{layerFilter:m})}if(!h){let m=Kc(Sm(o,tZ),s),f=e.getView().getResolution()*this.pixelTolerance_,g=Am(Gl(m,f,tZ),s);h=this.rBush_.getInExtent(g)}if(h&&h.length>0){let m=h.sort(l)[0],f=m.segment,g=rZ(o,m,s),y=e.getPixelFromCoordinate(g),_=v0(i,y);if(p||_<=this.pixelTolerance_){let w={};if(w[fi(f)]=!0,this.snapToPointer_||(this.delta_[0]=g[0]-o[0],this.delta_[1]=g[1]-o[1]),m.geometry.getType()==="Circle"&&m.index===p2)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g,[m.feature],[m.geometry]);else{let A=e.getPixelFromCoordinate(f[0]),k=e.getPixelFromCoordinate(f[1]),R=y0(y,A),q=y0(y,k);_=Math.sqrt(Math.min(R,q)),this.snappedToVertex_=_<=this.pixelTolerance_,this.snappedToVertex_&&(g=R>q?f[1]:f[0]),this.createOrUpdateVertexFeature_(g,[m.feature],[m.geometry]);let X={};X[fi(m.geometry)]=!0;for(let ie=1,ae=h.length;ie<ae;++ie){let be=h[ie].segment;if(Mu(f[0],be[0])&&Mu(f[1],be[1])||Mu(f[0],be[1])&&Mu(f[1],be[0])){let me=fi(h[ie].geometry);me in X||(X[me]=!0,w[fi(be)]=!0)}else break}}this.vertexSegments_=w;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(i,e){let n=i.segment,o=i.feature,s=i.geometry,l=i.depth,h=i.index,p;for(;e.length<s.getStride();)e.push(0);switch(s.getType()){case"MultiLineString":p=s.getCoordinates(),p[l[0]].splice(h+1,0,e);break;case"Polygon":p=s.getCoordinates(),p[l[0]].splice(h+1,0,e);break;case"MultiPolygon":p=s.getCoordinates(),p[l[1]][l[0]].splice(h+1,0,e);break;case"LineString":p=s.getCoordinates(),p.splice(h+1,0,e);break;default:return}this.setGeometryCoordinates_(s,p);let m=this.rBush_;m.remove(i),this.updateSegmentIndices_(s,h,l,1);let f={segment:[n[0],e],feature:o,geometry:s,depth:l,index:h};m.insert(Ds(f.segment),f),this.dragSegments_.push([f,1]);let g={segment:[e,n[1]],feature:o,geometry:s,depth:l,index:h+1};m.insert(Ds(g.segment),g),this.dragSegments_.push([g,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=sn.POINTERDRAG){let i=this.lastPointerEvent_;this.willModifyFeatures_(i,this.dragSegments_);let e=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new m2(TR.MODIFYEND,this.featuresBeingModified_,i)),this.featuresBeingModified_=null,e}return!1}removeVertex_(){let i=this.dragSegments_,e={},n=!1,o,s,l,h,p,m,f,g,y,_,w;for(p=i.length-1;p>=0;--p)l=i[p],_=l[0],w=fi(_.feature),_.depth&&(w+="-"+_.depth.join("-")),w in e||(e[w]={}),l[1]===0?(e[w].right=_,e[w].index=_.index):l[1]==1&&(e[w].left=_,e[w].index=_.index+1);for(w in e){switch(y=e[w].right,f=e[w].left,m=e[w].index,g=m-1,f!==void 0?_=f:_=y,g<0&&(g=0),h=_.geometry,s=h.getCoordinates(),o=s,n=!1,h.getType()){case"MultiLineString":s[_.depth[0]].length>2&&(s[_.depth[0]].splice(m,1),n=!0);break;case"LineString":s.length>2&&(s.splice(m,1),n=!0);break;case"MultiPolygon":o=o[_.depth[1]];case"Polygon":o=o[_.depth[0]],o.length>4&&(m==o.length-1&&(m=0),o.splice(m,1),n=!0,m===0&&(o.pop(),o.push(o[0]),g=o.length-1));break;default:}if(n){this.setGeometryCoordinates_(h,s);let A=[];if(f!==void 0&&(this.rBush_.remove(f),A.push(f.segment[0])),y!==void 0&&(this.rBush_.remove(y),A.push(y.segment[1])),f!==void 0&&y!==void 0){let k={depth:_.depth,feature:_.feature,geometry:_.geometry,index:g,segment:A};this.rBush_.insert(Ds(k.segment),k)}this.updateSegmentIndices_(h,m,_.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),i.length=0}}return n}setGeometryCoordinates_(i,e){this.changingFeature_=!0,i.setCoordinates(e),this.changingFeature_=!1}updateSegmentIndices_(i,e,n,o){this.rBush_.forEachInExtent(i.getExtent(),function(s){s.geometry===i&&(n===void 0||s.depth===void 0||pc(s.depth,n))&&s.index>e&&(s.index+=o)})}};function Gge(r,i){return r.index-i.index}function iZ(r,i,e){let n=i.geometry;if(n.getType()==="Circle"){let s=n;if(i.index===p2){let l=fl();l&&(s=s.clone().transform(l,e));let h=y0(s.getCenter(),zo(r,e)),p=Math.sqrt(h)-s.getRadius();return p*p}}let o=zo(r,e);return Ob[0]=zo(i.segment[0],e),Ob[1]=zo(i.segment[1],e),R9(o,Ob)}function rZ(r,i,e){let n=i.geometry;if(n.getType()==="Circle"&&i.index===p2){let s=n,l=fl();return l&&(s=s.clone().transform(l,e)),$f(s.getClosestPoint(zo(r,e)),e)}let o=zo(r,e);return Ob[0]=zo(i.segment[0],e),Ob[1]=zo(i.segment[1],e),$f(yP(o,Ob),e)}function jge(){let r=Dv();return function(i,e){return r.Point}}var Db=FR;var PR=class extends Xh{constructor(i){i=i||{},super(i),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=i.maxDelta!==void 0?i.maxDelta:1,this.duration_=i.duration!==void 0?i.duration:250,this.timeout_=i.timeout!==void 0?i.timeout:80,this.useAnchor_=i.useAnchor!==void 0?i.useAnchor:!0,this.constrainResolution_=i.constrainResolution!==void 0?i.constrainResolution:!1;let e=i.condition?i.condition:xg;this.condition_=i.onFocusOnly?e2(j5,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;let i=this.getMap();if(!i)return;i.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(i){if(!this.condition_(i)||i.type!==mi.WHEEL)return!0;let n=i.map,o=i.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=i.coordinate);let s;if(i.type==mi.WHEEL&&(s=o.deltaY,b9&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=YA),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;let l=Date.now();this.startTime_===void 0&&(this.startTime_=l),(!this.mode_||l-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");let h=n.getView();if(this.mode_==="trackpad"&&!(h.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(h.getAnimating()&&h.cancelAnimations(),h.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),h.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=l,!1;this.totalDelta_+=s;let p=Math.max(this.timeout_-(l-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),p),!1}handleWheelZoom_(i){let e=i.getView();e.getAnimating()&&e.cancelAnimations();let n=-to(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),yb(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(i){this.useAnchor_=i,i||(this.lastAnchor_=null)}},nZ=PR;var LR=class extends lu{constructor(i){i=i||{};let e=i;e.stopDown||(e.stopDown=Gh),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=i.threshold!==void 0?i.threshold:.3,this.duration_=i.duration!==void 0?i.duration:250}handleDragEvent(i){let e=0,n=this.targetPointers[0],o=this.targetPointers[1],s=Math.atan2(o.clientY-n.clientY,o.clientX-n.clientX);if(this.lastAngle_!==void 0){let p=s-this.lastAngle_;this.rotationDelta_+=p,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=p}this.lastAngle_=s;let l=i.map,h=l.getView();h.getConstraints().rotation!==ob&&(this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(vb(this.targetPointers))),this.rotating_&&(l.render(),h.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(i){return this.targetPointers.length<2?(i.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(i){if(this.targetPointers.length>=2){let e=i.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},oZ=LR;var kR=class extends lu{constructor(i){i=i||{};let e=i;e.stopDown||(e.stopDown=Gh),super(e),this.anchor_=null,this.duration_=i.duration!==void 0?i.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(i){let e=1,n=this.targetPointers[0],o=this.targetPointers[1],s=n.clientX-o.clientX,l=n.clientY-o.clientY,h=Math.sqrt(s*s+l*l);this.lastDistance_!==void 0&&(e=this.lastDistance_/h),this.lastDistance_=h;let p=i.map,m=p.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=p.getCoordinateFromPixelInternal(p.getEventPixel(vb(this.targetPointers))),p.render(),m.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(i){if(this.targetPointers.length<2){let n=i.map.getView(),o=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,o),!1}return!0}handleDownEvent(i){if(this.targetPointers.length>=2){let e=i.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}},aZ=kR;var Vge={SELECT:"select"},OR=class extends To{constructor(i,e,n,o){super(i),this.selected=e,this.deselected=n,this.mapBrowserEvent=o}},uE={},DR=class r extends Xh{constructor(i){super(),this.on,this.once,this.un,i=i||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=i.condition?i.condition:U5,this.addCondition_=i.addCondition?i.addCondition:t2,this.removeCondition_=i.removeCondition?i.removeCondition:t2,this.toggleCondition_=i.toggleCondition?i.toggleCondition:wb,this.multi_=i.multi?i.multi:!1,this.filter_=i.filter?i.filter:Tc,this.hitTolerance_=i.hitTolerance?i.hitTolerance:0,this.style_=i.style!==void 0?i.style:Uge(),this.features_=i.features||new Ua;let e;if(i.layers)if(typeof i.layers=="function")e=i.layers;else{let n=i.layers;e=function(o){return n.includes(o)}}else e=Tc;this.layerFilter_=e,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(i,e){this.featureLayerAssociation_[fi(i)]=e}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(i){return this.featureLayerAssociation_[fi(i)]}setHitTolerance(i){this.hitTolerance_=i}setMap(i){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(i),i?(this.features_.addEventListener(Va.ADD,this.boundAddFeature_),this.features_.addEventListener(Va.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Va.ADD,this.boundAddFeature_),this.features_.removeEventListener(Va.REMOVE,this.boundRemoveFeature_))}addFeature_(i){let e=i.element;if(this.style_&&this.applySelectedStyle_(e),!this.getLayer(e)){let n=this.getMap().getAllLayers().find(function(o){if(o instanceof fc&&o.getSource()&&o.getSource().hasFeature(e))return o});n&&this.addFeatureLayerAssociation_(e,n)}}removeFeature_(i){this.style_&&this.restorePreviousStyle_(i.element)}getStyle(){return this.style_}applySelectedStyle_(i){let e=fi(i);e in uE||(uE[e]=i.getStyle()),i.setStyle(this.style_)}restorePreviousStyle_(i){let e=this.getMap().getInteractions().getArray();for(let o=e.length-1;o>=0;--o){let s=e[o];if(s!==this&&s instanceof r&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(i)!==-1){i.setStyle(s.getStyle());return}}let n=fi(i);i.setStyle(uE[n]),delete uE[n]}removeFeatureLayerAssociation_(i){delete this.featureLayerAssociation_[fi(i)]}handleEvent(i){if(!this.condition_(i))return!0;let e=this.addCondition_(i),n=this.removeCondition_(i),o=this.toggleCondition_(i),s=!e&&!n&&!o,l=i.map,h=this.getFeatures(),p=[],m=[];if(s){Dh(this.featureLayerAssociation_),l.forEachFeatureAtPixel(i.pixel,(f,g)=>{if(!(!(f instanceof gi)||!this.filter_(f,g)))return this.addFeatureLayerAssociation_(f,g),m.push(f),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let f=h.getLength()-1;f>=0;--f){let g=h.item(f),y=m.indexOf(g);y>-1?m.splice(y,1):(h.remove(g),p.push(g))}m.length!==0&&h.extend(m)}else{l.forEachFeatureAtPixel(i.pixel,(f,g)=>{if(!(!(f instanceof gi)||!this.filter_(f,g)))return(e||o)&&!h.getArray().includes(f)?(this.addFeatureLayerAssociation_(f,g),m.push(f)):(n||o)&&h.getArray().includes(f)&&(p.push(f),this.removeFeatureLayerAssociation_(f)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let f=p.length-1;f>=0;--f)h.remove(p[f]);h.extend(m)}return(m.length>0||p.length>0)&&this.dispatchEvent(new OR(Vge.SELECT,m,p,i)),!0}};function Uge(){let r=Dv();return Cr(r.Polygon,r.LineString),Cr(r.GeometryCollection,r.LineString),function(i){return i.getGeometry()?r[i.getGeometry().getType()]:null}}var Rb=DR;var RR={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},f2=class extends To{constructor(i,e,n,o,s){super(i),this.features=e,this.coordinate=n,this.startCoordinate=o,this.mapBrowserEvent=s}},NR=class extends lu{constructor(i){i=i||{},super(i),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=i.features!==void 0?i.features:null;let e;if(i.layers&&!this.features_)if(typeof i.layers=="function")e=i.layers;else{let n=i.layers;e=function(o){return n.includes(o)}}else e=Tc;this.layerFilter_=e,this.filter_=i.filter&&!this.features_?i.filter:Tc,this.hitTolerance_=i.hitTolerance?i.hitTolerance:0,this.condition_=i.condition?i.condition:xg,this.lastFeature_=null,this.addChangeListener(Ny.ACTIVE,this.handleActiveChanged_)}handleDownEvent(i){if(!i.originalEvent||!this.condition_(i))return!1;if(this.lastFeature_=this.featuresAtPixel_(i.pixel,i.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=i.coordinate,this.lastCoordinate_=i.coordinate,this.handleMoveEvent(i);let e=this.features_||new Ua([this.lastFeature_]);return this.dispatchEvent(new f2(RR.TRANSLATESTART,e,i.coordinate,this.startCoordinate_,i)),!0}return!1}handleUpEvent(i){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(i);let e=this.features_||new Ua([this.lastFeature_]);return this.dispatchEvent(new f2(RR.TRANSLATEEND,e,i.coordinate,this.startCoordinate_,i)),this.startCoordinate_=null,!0}return!1}handleDragEvent(i){if(this.lastCoordinate_){let e=i.coordinate,n=i.map.getView().getProjection(),o=zo(e,n),s=zo(this.lastCoordinate_,n),l=o[0]-s[0],h=o[1]-s[1],p=this.features_||new Ua([this.lastFeature_]),m=fl();p.forEach(function(f){let g=f.getGeometry();m?(g.transform(m,n),g.translate(l,h),g.transform(n,m)):g.translate(l,h),f.setGeometry(g)}),this.lastCoordinate_=e,this.dispatchEvent(new f2(RR.TRANSLATING,p,e,this.startCoordinate_,i))}}handleMoveEvent(i){let e=i.map.getViewport();this.featuresAtPixel_(i.pixel,i.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(i,e){return e.forEachFeatureAtPixel(i,(n,o)=>{if(!(!(n instanceof gi)||!this.filter_(n,o))&&!(this.features_&&!this.features_.getArray().includes(n)))return n},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(i){this.hitTolerance_=i}setMap(i){let e=this.getMap();super.setMap(i),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(i){let e=this.getMap(),n=this.getActive();(!e||!n)&&(e=e||i,e&&e.getViewport().classList.remove("ol-grab","ol-grabbing"))}},g2=NR;var BR=class{constructor(i,e,n){this.decay_=i,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(i,e){this.points_.push(i,e,Date.now())}end(){if(this.points_.length<6)return!1;let i=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<i)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>i;)n-=3;let o=this.points_[e+2]-this.points_[n+2];if(o<1e3/60)return!1;let s=this.points_[e]-this.points_[n],l=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(l,s),this.initialVelocity_=Math.sqrt(s*s+l*l)/o,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},sZ=BR;function _2(r){r=r||{};let i=new Ua,e=new sZ(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&i.push(new YY),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&i.push(new HY({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&i.push(new qY({onFocusOnly:r.onFocusOnly,kinetic:e})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&i.push(new oZ),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&i.push(new aZ({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(i.push(new QY),i.push(new JY({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&i.push(new nZ({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&i.push(new ZY({duration:r.zoomDuration})),i}var GR=class extends _v{constructor(i){super(),this.map_=i}dispatchRenderEvent(i,e){Ti()}calculateMatrices2D(i){let e=i.viewState,n=i.coordinateToPixelTransform,o=i.pixelToCoordinateTransform;Ns(n,i.size[0]/2,i.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),D0(o,n)}forEachFeatureAtCoordinate(i,e,n,o,s,l,h,p){let m,f=e.viewState;function g(ie,ae,be,me){return s.call(l,ae,ie?be:null,me)}let y=f.projection,_=X1(i.slice(),y),w=[[0,0]];if(y.canWrapX()&&o){let ie=y.getExtent(),ae=mr(ie);w.push([-ae,0],[ae,0])}let A=e.layerStatesArray,k=A.length,R=[],q=[];for(let ie=0;ie<w.length;ie++)for(let ae=k-1;ae>=0;--ae){let be=A[ae],me=be.layer;if(me.hasRenderer()&&zS(be,f)&&h.call(p,me)){let fe=me.getRenderer(),ge=me.getSource();if(fe&&ge){let ue=ge.getWrapX()?_:i,se=g.bind(null,be.managed);q[0]=ue[0]+w[ie][0],q[1]=ue[1]+w[ie][1],m=fe.forEachFeatureAtCoordinate(q,e,n,se,R)}if(m)return m}}if(R.length===0)return;let X=1/R.length;return R.forEach((ie,ae)=>ie.distanceSq+=ae*X),R.sort((ie,ae)=>ie.distanceSq-ae.distanceSq),R.some(ie=>m=ie.callback(ie.feature,ie.layer,ie.geometry)),m}hasFeatureAtCoordinate(i,e,n,o,s,l){return this.forEachFeatureAtCoordinate(i,e,n,o,Tc,this,s,l)!==void 0}getMap(){return this.map_}renderFrame(i){Ti()}scheduleExpireIconCache(i){Qd.canExpireCache()&&i.postRenderFunctions.push(zge)}};function zge(r,i){Qd.expire()}var cZ=GR;var jR=class extends cZ{constructor(i){super(i),this.fontChangeListenerKey_=Vr(Nm,Ap.PROPERTYCHANGE,i.redrawText.bind(i)),this.element_=document.createElement("div");let e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Rm+" ol-layers";let n=i.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(i,e){let n=this.getMap();if(n.hasListener(i)){let o=new P5(i,void 0,e);n.dispatchEvent(o)}}disposeInternal(){wn(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(i){if(!i){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(i),this.dispatchRenderEvent(Oc.PRECOMPOSE,i);let e=i.layerStatesArray.sort(function(h,p){return h.zIndex-p.zIndex});e.some(h=>h.layer instanceof lb&&h.layer.getDeclutter())&&(i.declutter={});let o=i.viewState;this.children_.length=0;let s=[],l=null;for(let h=0,p=e.length;h<p;++h){let m=e[h];i.layerIndex=h;let f=m.layer,g=f.getSourceState();if(!zS(m,o)||g!="ready"&&g!="undefined"){f.unrender();continue}let y=f.render(i,l);y&&(y!==l&&(this.children_.push(y),l=y),s.push(m))}this.declutter(i,s),Pz(this.element_,this.children_),this.dispatchRenderEvent(Oc.POSTCOMPOSE,i),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(i)}declutter(i,e){for(let n=e.length-1;n>=0;--n){let o=e[n],s=o.layer;s.getDeclutter()&&s.renderDeclutter(i,o)}e.forEach(n=>n.layer.renderDeferred(i))}},uZ=jR;var y2={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var VR=class extends km{constructor(i,e){super(i),this.map_=i,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;let n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=Vr(n,y2.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Vr(n,y2.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(mi.TOUCHMOVE,this.boundHandleTouchMove_,KA?{passive:!1}:!1)}emulateClick_(i){let e=new Qh(sn.CLICK,this.map_,i);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Qh(sn.DBLCLICK,this.map_,i),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;let n=new Qh(sn.SINGLECLICK,this.map_,i);this.dispatchEvent(n)},250)}updateActivePointers_(i){let e=i,n=e.pointerId;if(e.type==sn.POINTERUP||e.type==sn.POINTERCANCEL){delete this.trackedTouches_[n];for(let o in this.trackedTouches_)if(this.trackedTouches_[o].target!==e.target){delete this.trackedTouches_[o];break}}else(e.type==sn.POINTERDOWN||e.type==sn.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(i){this.updateActivePointers_(i);let e=new Qh(sn.POINTERUP,this.map_,i,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(i)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(wn),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(i){return i.button===0}handlePointerDown_(i){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(i);let e=new Qh(sn.POINTERDOWN,this.map_,i,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(i.type,i),Object.defineProperty(this.down_,"target",{writable:!1,value:i.target}),this.dragListenerKeys_.length===0){let n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Vr(n,sn.POINTERMOVE,this.handlePointerMove_,this),Vr(n,sn.POINTERUP,this.handlePointerUp_,this),Vr(this.element_,sn.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(Vr(this.element_.getRootNode(),sn.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(i){if(this.isMoving_(i)){this.updateActivePointers_(i),this.dragging_=!0;let e=new Qh(sn.POINTERDRAG,this.map_,i,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(i){this.originalPointerMoveEvent_=i;let e=!!(this.down_&&this.isMoving_(i));this.dispatchEvent(new Qh(sn.POINTERMOVE,this.map_,i,e))}handleTouchMove_(i){let e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof i.cancelable!="boolean"||i.cancelable===!0)&&i.preventDefault()}isMoving_(i){return this.dragging_||Math.abs(i.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(i.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(wn(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(mi.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(wn(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(wn),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}},dZ=VR;var Rc={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};var v2=1/0,UR=class{constructor(i,e){this.priorityFunction_=i,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Dh(this.queuedElements_)}dequeue(){let i=this.elements_,e=this.priorities_,n=i[0];i.length==1?(i.length=0,e.length=0):(i[0]=i.pop(),e[0]=e.pop(),this.siftUp_(0));let o=this.keyFunction_(n);return delete this.queuedElements_[o],n}enqueue(i){Hi(!(this.keyFunction_(i)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");let e=this.priorityFunction_(i);return e!=v2?(this.elements_.push(i),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(i)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(i){return i*2+1}getRightChildIndex_(i){return i*2+2}getParentIndex_(i){return i-1>>1}heapify_(){let i;for(i=(this.elements_.length>>1)-1;i>=0;i--)this.siftUp_(i)}isEmpty(){return this.elements_.length===0}isKeyQueued(i){return i in this.queuedElements_}isQueued(i){return this.isKeyQueued(this.keyFunction_(i))}siftUp_(i){let e=this.elements_,n=this.priorities_,o=e.length,s=e[i],l=n[i],h=i;for(;i<o>>1;){let p=this.getLeftChildIndex_(i),m=this.getRightChildIndex_(i),f=m<o&&n[m]<n[p]?m:p;e[i]=e[f],n[i]=n[f],i=f}e[i]=s,n[i]=l,this.siftDown_(h,i)}siftDown_(i,e){let n=this.elements_,o=this.priorities_,s=n[e],l=o[e];for(;e>i;){let h=this.getParentIndex_(e);if(o[h]>l)n[e]=n[h],o[e]=o[h],e=h;else break}n[e]=s,o[e]=l}reprioritize(){let i=this.priorityFunction_,e=this.elements_,n=this.priorities_,o=0,s=e.length,l,h,p;for(h=0;h<s;++h)l=e[h],p=i(l),p==v2?delete this.queuedElements_[this.keyFunction_(l)]:(n[o]=p,e[o++]=l);e.length=o,n.length=o,this.heapify_()}},hZ=UR;var zR=class extends hZ{constructor(i,e){super(function(n){return i.apply(null,n)},function(n){return n[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(i){let e=super.enqueue(i);return e&&i[0].addEventListener(mi.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(i){let e=i.target,n=e.getState();if(n===si.LOADED||n===si.ERROR||n===si.EMPTY){n!==si.ERROR&&e.removeEventListener(mi.CHANGE,this.boundHandleTileChange_);let o=e.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(i,e){let n=0,o,s,l;for(;this.tilesLoading_<i&&n<e&&this.getCount()>0;)s=this.dequeue()[0],l=s.getKey(),o=s.getState(),o===si.IDLE&&!(l in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[l]=!0,++this.tilesLoading_,++n,s.load())}},pZ=zR;function mZ(r,i,e,n,o){if(!r||!(e in r.wantedTiles))return v2;if(!r.wantedTiles[e][i.getKey()])return v2;let s=r.viewState.center,l=n[0]-s[0],h=n[1]-s[1];return 65536*Math.log(o)+Math.sqrt(l*l+h*h)/o}var $R=class extends ls{constructor(i){super();let e=i.element;e&&!i.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],i.render&&(this.render=i.render),i.target&&this.setTarget(i.target)}disposeInternal(){Cy(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(i){this.map_&&Cy(this.element);for(let e=0,n=this.listenerKeys.length;e<n;++e)wn(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=i,i&&((this.target_?this.target_:i.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Mp&&this.listenerKeys.push(Vr(i,Jh.POSTRENDER,this.render,this)),i.render())}render(i){}setTarget(i){this.target_=typeof i=="string"?document.getElementById(i):i}},s_=$R;var WR=class extends s_{constructor(i){i=i||{},super({element:document.createElement("div"),render:i.render,target:i.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=i.collapsed!==void 0?i.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=i.collapsible!==void 0,this.collapsible_=i.collapsible!==void 0?i.collapsible:!0,this.collapsible_||(this.collapsed_=!1);let e=i.className!==void 0?i.className:"ol-attribution",n=i.tipLabel!==void 0?i.tipLabel:"Attributions",o=i.expandClassName!==void 0?i.expandClassName:e+"-expand",s=i.collapseLabel!==void 0?i.collapseLabel:"\u203A",l=i.collapseClassName!==void 0?i.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=l):this.collapseLabel_=s;let h=i.label!==void 0?i.label:"i";typeof h=="string"?(this.label_=document.createElement("span"),this.label_.textContent=h,this.label_.className=o):this.label_=h;let p=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(p),this.toggleButton_.addEventListener(mi.CLICK,this.handleClick_.bind(this),!1);let m=e+" "+Rm+" "+kv+(this.collapsed_&&this.collapsible_?" "+Nk:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=m,f.appendChild(this.toggleButton_),f.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(i){let e=Array.from(new Set(this.getMap().getAllLayers().flatMap(o=>o.getAttributions(i)))),n=!this.getMap().getAllLayers().some(o=>o.getSource()&&o.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(n),e}updateElement_(i){return un(this,null,function*(){if(!i){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let e=yield Promise.all(this.collectSourceAttributions_(i).map(o=>yv(()=>o))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!pc(e,this.renderedAttributions_)){wI(this.ulElement_);for(let o=0,s=e.length;o<s;++o){let l=document.createElement("li");l.innerHTML=e[o],this.ulElement_.appendChild(l)}this.renderedAttributions_=e}})}handleClick_(i){i.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Nk),this.collapsed_?Lk(this.collapseLabel_,this.label_):Lk(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(i){this.collapsible_!==i&&(this.collapsible_=i,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(i){this.userCollapsed_=i,!(!this.collapsible_||this.collapsed_===i)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(i){this.updateElement_(i.frameState)}},l_=WR;var HR=class extends s_{constructor(i){i=i||{},super({element:document.createElement("div"),render:i.render,target:i.target});let e=i.className!==void 0?i.className:"ol-rotate",n=i.label!==void 0?i.label:"\u21E7",o=i.compassClassName!==void 0?i.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=o,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(o));let s=i.tipLabel?i.tipLabel:"Reset rotation",l=document.createElement("button");l.className=e+"-reset",l.setAttribute("type","button"),l.title=s,l.appendChild(this.label_),l.addEventListener(mi.CLICK,this.handleClick_.bind(this),!1);let h=e+" "+Rm+" "+kv,p=this.element;p.className=h,p.appendChild(l),this.callResetNorth_=i.resetNorth?i.resetNorth:void 0,this.duration_=i.duration!==void 0?i.duration:250,this.autoHide_=i.autoHide!==void 0?i.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(CS)}handleClick_(i){i.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){let e=this.getMap().getView();if(!e)return;let n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:$l}):e.setRotation(0))}render(i){let e=i.frameState;if(!e)return;let n=e.viewState.rotation;if(n!=this.rotation_){let o="rotate("+n+"rad)";if(this.autoHide_){let s=this.element.classList.contains(CS);!s&&n===0?this.element.classList.add(CS):s&&n!==0&&this.element.classList.remove(CS)}this.label_.style.transform=o}this.rotation_=n}},fZ=HR;var qR=class extends s_{constructor(i){i=i||{},super({element:document.createElement("div"),target:i.target});let e=i.className!==void 0?i.className:"ol-zoom",n=i.delta!==void 0?i.delta:1,o=i.zoomInClassName!==void 0?i.zoomInClassName:e+"-in",s=i.zoomOutClassName!==void 0?i.zoomOutClassName:e+"-out",l=i.zoomInLabel!==void 0?i.zoomInLabel:"+",h=i.zoomOutLabel!==void 0?i.zoomOutLabel:"\u2013",p=i.zoomInTipLabel!==void 0?i.zoomInTipLabel:"Zoom in",m=i.zoomOutTipLabel!==void 0?i.zoomOutTipLabel:"Zoom out",f=document.createElement("button");f.className=o,f.setAttribute("type","button"),f.title=p,f.appendChild(typeof l=="string"?document.createTextNode(l):l),f.addEventListener(mi.CLICK,this.handleClick_.bind(this,n),!1);let g=document.createElement("button");g.className=s,g.setAttribute("type","button"),g.title=m,g.appendChild(typeof h=="string"?document.createTextNode(h):h),g.addEventListener(mi.CLICK,this.handleClick_.bind(this,-n),!1);let y=e+" "+Rm+" "+kv,_=this.element;_.className=y,_.appendChild(f),_.appendChild(g),this.duration_=i.duration!==void 0?i.duration:250}handleClick_(i,e){e.preventDefault(),this.zoomByDelta_(i)}zoomByDelta_(i){let n=this.getMap().getView();if(!n)return;let o=n.getZoom();if(o!==void 0){let s=n.getConstrainedZoom(o+i);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:$l})):n.setZoom(s)}}},gZ=qR;function _Z(r){r=r||{};let i=new Ua;return(r.zoom!==void 0?r.zoom:!0)&&i.push(new gZ(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&i.push(new fZ(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&i.push(new l_(r.attributionOptions)),i}function yZ(r){if(r instanceof _g){r.setMapInternal(null);return}r instanceof Dp&&r.getLayers().forEach(yZ)}function vZ(r,i){if(r instanceof _g){r.setMapInternal(i);return}if(r instanceof Dp){let e=r.getLayers().getArray();for(let n=0,o=e.length;n<o;++n)vZ(e[n],i)}}var YR=class extends ls{constructor(i){super(),i=i||{},this.on,this.once,this.un;let e=$ge(i);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=i.maxTilesLoading!==void 0?i.maxTilesLoading:16,this.pixelRatio_=i.pixelRatio!==void 0?i.pixelRatio:YA,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=el(),this.pixelToCoordinateTransform_=el(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=i.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||_Z(),this.interactions=e.interactions||_2({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new pZ(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Rc.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Rc.VIEW,this.handleViewChanged_),this.addChangeListener(Rc.SIZE,this.handleSizeChanged_),this.addChangeListener(Rc.TARGET,this.handleTargetChanged_),this.setProperties(e.values);let n=this;i.view&&!(i.view instanceof th)&&i.view.then(function(o){n.setView(new th(o))}),this.controls.addEventListener(Va.ADD,o=>{o.element.setMap(this)}),this.controls.addEventListener(Va.REMOVE,o=>{o.element.setMap(null)}),this.interactions.addEventListener(Va.ADD,o=>{o.element.setMap(this)}),this.interactions.addEventListener(Va.REMOVE,o=>{o.element.setMap(null)}),this.overlays_.addEventListener(Va.ADD,o=>{this.addOverlayInternal_(o.element)}),this.overlays_.addEventListener(Va.REMOVE,o=>{let s=o.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],o.element.setMap(null)}),this.controls.forEach(o=>{o.setMap(this)}),this.interactions.forEach(o=>{o.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(i){this.getControls().push(i)}addInteraction(i){this.getInteractions().push(i)}addLayer(i){this.getLayerGroup().getLayers().push(i)}handleLayerAdd_(i){vZ(i.layer,this)}addOverlay(i){this.getOverlays().push(i)}addOverlayInternal_(i){let e=i.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=i),i.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(i,e,n){if(!this.frameState_||!this.renderer_)return;let o=this.getCoordinateFromPixelInternal(i);n=n!==void 0?n:{};let s=n.hitTolerance!==void 0?n.hitTolerance:0,l=n.layerFilter!==void 0?n.layerFilter:Tc,h=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,s,h,e,null,l,null)}getFeaturesAtPixel(i,e){let n=[];return this.forEachFeatureAtPixel(i,function(o){n.push(o)},e),n}getAllLayers(){let i=[];function e(n){n.forEach(function(o){o instanceof Dp?e(o.getLayers()):i.push(o)})}return e(this.getLayers()),i}hasFeatureAtPixel(i,e){if(!this.frameState_||!this.renderer_)return!1;let n=this.getCoordinateFromPixelInternal(i);e=e!==void 0?e:{};let o=e.layerFilter!==void 0?e.layerFilter:Tc,s=e.hitTolerance!==void 0?e.hitTolerance:0,l=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,l,o,null)}getEventCoordinate(i){return this.getCoordinateFromPixel(this.getEventPixel(i))}getEventCoordinateInternal(i){return this.getCoordinateFromPixelInternal(this.getEventPixel(i))}getEventPixel(i){let n=this.viewport_.getBoundingClientRect(),o=this.getSize(),s=n.width/o[0],l=n.height/o[1],h="changedTouches"in i?i.changedTouches[0]:i;return[(h.clientX-n.left)/s,(h.clientY-n.top)/l]}getTarget(){return this.get(Rc.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(i){return $f(this.getCoordinateFromPixelInternal(i),this.getView().getProjection())}getCoordinateFromPixelInternal(i){let e=this.frameState_;return e?$o(e.pixelToCoordinateTransform,i.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(i){let e=this.overlayIdIndex_[i.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Rc.LAYERGROUP)}setLayers(i){let e=this.getLayerGroup();if(i instanceof Ua){e.setLayers(i);return}let n=e.getLayers();n.clear(),n.extend(i)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){let i=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=i.length;e<n;++e){let o=i[e];if(!o.visible)continue;let s=o.layer.getRenderer();if(s&&!s.ready)return!0;let l=o.layer.getSource();if(l&&l.loading)return!0}return!1}getPixelFromCoordinate(i){let e=zo(i,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(i){let e=this.frameState_;return e?$o(e.coordinateToPixelTransform,i.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Rc.SIZE)}getView(){return this.get(Rc.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){let i=this.getTargetElement();return i?i.ownerDocument:document}getTilePriority(i,e,n,o){return mZ(this.frameState_,i,e,n,o)}handleBrowserEvent(i,e){e=e||i.type;let n=new Qh(e,this,i);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(i){if(!this.frameState_)return;let e=i.originalEvent,n=e.type;if(n===y2.POINTERDOWN||n===mi.WHEEL||n===mi.KEYDOWN){let o=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():o,l=e.target;if(this.overlayContainerStopEvent_.contains(l)||!(s===o?o.documentElement:s).contains(l))return}if(i.frameState=this.frameState_,this.dispatchEvent(i)!==!1){let o=this.getInteractions().getArray().slice();for(let s=o.length-1;s>=0;s--){let l=o[s];if(l.getMap()!==this||!l.getActive()||!this.getTargetElement())continue;if(!l.handleEvent(i)||i.propagationStopped)break}}}handlePostRender(){let i=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let o=this.maxTilesLoading_,s=o;if(i){let l=i.viewHints;if(l[Ro.ANIMATING]||l[Ro.INTERACTING]){let h=Date.now()-i.time>8;o=h?0:8,s=h?0:2}}e.getTilesLoading()<o&&(e.reprioritize(),e.loadMoreTiles(o,s))}i&&this.renderer_&&!i.animate&&(this.renderComplete_===!0?(this.hasListener(Oc.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Oc.RENDERCOMPLETE,i),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new o_(Jh.LOADEND,this,i)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new o_(Jh.LOADSTART,this,i))));let n=this.postRenderFunctions_;for(let o=0,s=n.length;o<s;++o)n[o](this,i);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,o=this.targetChangeHandlerKeys_.length;n<o;++n)wn(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(mi.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(mi.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Cy(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);let n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}let i=this.getTarget(),e=typeof i=="string"?document.getElementById(i):i;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new uZ(this)),this.mapBrowserEventHandler_=new dZ(this,this.moveTolerance_);for(let s in sn)this.mapBrowserEventHandler_.addEventListener(sn[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(mi.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(mi.WHEEL,this.boundHandleBrowserEvent_,KA?{passive:!1}:!1);let n=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.targetChangeHandlerKeys_=[Vr(n,mi.KEYDOWN,this.handleBrowserEvent,this),Vr(n,mi.KEYPRESS,this.handleBrowserEvent,this)];let o=e.getRootNode();o instanceof ShadowRoot&&this.resizeObserver_.observe(o.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(wn(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(wn(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);let i=this.getView();i&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=Vr(i,Ap.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Vr(i,mi.CHANGE,this.handleViewPropertyChanged_,this),i.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(wn),this.layerGroupPropertyListenerKeys_=null);let i=this.getLayerGroup();i&&(this.handleLayerAdd_(new Op("addlayer",i)),this.layerGroupPropertyListenerKeys_=[Vr(i,Ap.PROPERTYCHANGE,this.render,this),Vr(i,mi.CHANGE,this.render,this),Vr(i,"addlayer",this.handleLayerAdd_,this),Vr(i,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){let i=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=i.length;e<n;++e){let o=i[e].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(i){return this.getControls().remove(i)}removeInteraction(i){return this.getInteractions().remove(i)}removeLayer(i){return this.getLayerGroup().getLayers().remove(i)}handleLayerRemove_(i){yZ(i.layer)}removeOverlay(i){return this.getOverlays().remove(i)}renderFrame_(i){let e=this.getSize(),n=this.getView(),o=this.frameState_,s=null;if(e!==void 0&&Sk(e)&&n&&n.isDef()){let l=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),h=n.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:_p(h.center,h.resolution,h.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:i,usedTiles:{},viewState:h,viewHints:l,wantedTiles:{},mapId:fi(this),renderTargets:{}},h.nextCenter&&h.nextResolution){let p=isNaN(h.nextRotation)?h.rotation:h.nextRotation;s.nextExtent=_p(h.nextCenter,h.nextResolution,p,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),o&&(!this.previousExtent_||!nd(this.previousExtent_)&&!Wd(s.extent,this.previousExtent_))&&(this.dispatchEvent(new o_(Jh.MOVESTART,this,o)),this.previousExtent_=Uf(this.previousExtent_)),this.previousExtent_&&!s.viewHints[Ro.ANIMATING]&&!s.viewHints[Ro.INTERACTING]&&!Wd(s.extent,this.previousExtent_)&&(this.dispatchEvent(new o_(Jh.MOVEEND,this,s)),tM(s.extent,this.previousExtent_))),this.dispatchEvent(new o_(Jh.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Jh.LOADSTART)||this.hasListener(Jh.LOADEND)||this.hasListener(Oc.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(i){let e=this.getLayerGroup();e&&this.handleLayerRemove_(new Op("removelayer",e)),this.set(Rc.LAYERGROUP,i)}setSize(i){this.set(Rc.SIZE,i)}setTarget(i){this.set(Rc.TARGET,i)}setView(i){if(!i||i instanceof th){this.set(Rc.VIEW,i);return}this.set(Rc.VIEW,new th);let e=this;i.then(function(n){e.setView(new th(n))})}updateSize(){let i=this.getTargetElement(),e;if(i){let o=getComputedStyle(i),s=i.offsetWidth-parseFloat(o.borderLeftWidth)-parseFloat(o.paddingLeft)-parseFloat(o.paddingRight)-parseFloat(o.borderRightWidth),l=i.offsetHeight-parseFloat(o.borderTopWidth)-parseFloat(o.paddingTop)-parseFloat(o.paddingBottom)-parseFloat(o.borderBottomWidth);!isNaN(s)&&!isNaN(l)&&(e=[s,l],!Sk(e)&&(i.offsetWidth||i.offsetHeight||i.getClientRects().length)&&sM("No map visible because the map container's width or height are 0."))}let n=this.getSize();e&&(!n||!pc(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(i){let e=this.getView();e&&e.setViewportSize(i)}};function $ge(r){let i=null;r.keyboardEventTarget!==void 0&&(i=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);let e={},n=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new Dp({layers:r.layers});e[Rc.LAYERGROUP]=n,e[Rc.TARGET]=r.target,e[Rc.VIEW]=r.view instanceof th?r.view:new th;let o;r.controls!==void 0&&(Array.isArray(r.controls)?o=new Ua(r.controls.slice()):(Hi(typeof r.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),o=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new Ua(r.interactions.slice()):(Hi(typeof r.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=r.interactions));let l;return r.overlays!==void 0?Array.isArray(r.overlays)?l=new Ua(r.overlays.slice()):(Hi(typeof r.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),l=r.overlays):l=new Ua,{controls:o,interactions:s,keyboardEventTarget:i,overlays:l,values:e}}var dE=YR;var ZR="units",Wge=[1,2,5],b2=25.4/.28,XR=class extends s_{constructor(i){i=i||{};let e=document.createElement("div");e.style.pointerEvents="none",super({element:e,render:i.render,target:i.target}),this.on,this.once,this.un;let n=i.className!==void 0?i.className:i.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+Rm,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=i.minWidth!==void 0?i.minWidth:64,this.maxWidth_=i.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(ZR,this.handleUnitsChanged_),this.setUnits(i.units||"metric"),this.scaleBar_=i.bar||!1,this.scaleBarSteps_=i.steps||4,this.scaleBarText_=i.text||!1,this.dpi_=i.dpi||void 0}getUnits(){return this.get(ZR)}handleUnitsChanged_(){this.updateElement_()}setUnits(i){this.set(ZR,i)}setDpi(i){this.dpi_=i}updateElement_(){let i=this.viewState_;if(!i){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let e=i.center,n=i.projection,o=this.getUnits(),s=o=="degrees"?"degrees":"m",l=ly(n,i.resolution,e,s),h=this.minWidth_*(this.dpi_||b2)/b2,p=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||b2)/b2:void 0,m=h*l,f="";if(o=="degrees"){let X=Cu.degrees;m*=X,m<X/60?(f="\u2033",l*=3600):m<X?(f="\u2032",l*=60):f="\xB0"}else if(o=="imperial")m<.9144?(f="in",l/=.0254):m<1609.344?(f="ft",l/=.3048):(f="mi",l/=1609.344);else if(o=="nautical")l/=1852,f="NM";else if(o=="metric")m<1e-6?(f="nm",l*=1e9):m<.001?(f="\u03BCm",l*=1e6):m<1?(f="mm",l*=1e3):m<1e3?f="m":(f="km",l/=1e3);else if(o=="us")m<.9144?(f="in",l*=39.37):m<1609.344?(f="ft",l/=.30480061):(f="mi",l/=1609.3472);else throw new Error("Invalid units");let g=3*Math.floor(Math.log(h*l)/Math.log(10)),y,_,w,A,k,R;for(;;){w=Math.floor(g/3);let X=Math.pow(10,w);if(y=Wge[(g%3+3)%3]*X,_=Math.round(y/l),isNaN(_)){this.element.style.display="none",this.renderedVisible_=!1;return}if(p!==void 0&&_>=p){y=A,_=k,w=R;break}else if(_>=h)break;A=y,k=_,R=w,++g}let q=this.scaleBar_?this.createScaleBar(_,y,f):y.toFixed(w<0?-w:0)+" "+f;this.renderedHTML_!=q&&(this.innerElement_.innerHTML=q,this.renderedHTML_=q),this.renderedWidth_!=_&&(this.innerElement_.style.width=_+"px",this.renderedWidth_=_),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(i,e,n){let o=this.getScaleForResolution(),s=o<1?Math.round(1/o).toLocaleString()+" : 1":"1 : "+Math.round(o).toLocaleString(),l=this.scaleBarSteps_,h=i/l,p=[this.createMarker("absolute")];for(let f=0;f<l;++f){let g=f%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";p.push(`<div><div class="ol-scale-singlebar ${g}" style="width: ${h}px;"></div>`+this.createMarker("relative")+(f%2===0||l===2?this.createStepText(f,i,!1,e,n):"")+"</div>")}return p.push(this.createStepText(l,i,!0,e,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${i}px;">`+s+"</div>":"")+p.join("")}createMarker(i){return`<div class="ol-scale-step-marker" style="position: ${i}; top: ${i==="absolute"?3:-10}px;"></div>`}createStepText(i,e,n,o,s){let h=(i===0?0:Math.round(o/this.scaleBarSteps_*i*100)/100)+(i===0?"":" "+s),p=i===0?-3:e/this.scaleBarSteps_*-1,m=i===0?0:e/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${p}px;text-align: ${i===0?"left":"center"};min-width: ${m}px;left: ${n?e+"px":"unset"};">`+h+"</div>"}getScaleForResolution(){let i=ly(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),e=this.dpi_||b2,n=1e3/25.4;return i*n*e}render(i){let e=i.frameState;e?this.viewState_=e.viewState:this.viewState_=null,this.updateElement_()}},KR=XR;var Hge=null;function hE(r){Hge=r;let i=Object.keys(r.defs),e=i.length,n,o;for(n=0;n<e;++n){let s=i[n];if(!ni(s)){let l=r.defs(s),h=l.units;!h&&l.projName==="longlat"&&(h="degrees"),AP(new lc({code:s,axisOrientation:l.axis,metersPerUnit:l.to_meter,units:h}))}}for(n=0;n<e;++n){let s=i[n],l=ni(s);for(o=0;o<e;++o){let h=i[o],p=ni(h);if(!JA(s,h))if(r.defs[s]===r.defs[h])lM([l,p]);else{let m=r(s,h);j9(l,p,MP(l,p,m.forward),MP(p,l,m.inverse))}}}}function wZ(r){r("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),r("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),r("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var i=1;i<=60;++i)r("EPSG:"+(32600+i),"+proj=utm +zone="+i+" +datum=WGS84 +units=m"),r("EPSG:"+(32700+i),"+proj=utm +zone="+i+" +south +datum=WGS84 +units=m");r("EPSG:5041","+title=WGS 84 / UPS North (E,N) +proj=stere +lat_0=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),r("EPSG:5042","+title=WGS 84 / UPS South (E,N) +proj=stere +lat_0=-90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +datum=WGS84 +units=m"),r.WGS84=r["EPSG:4326"],r["EPSG:3785"]=r["EPSG:3857"],r.GOOGLE=r["EPSG:3857"],r["EPSG:900913"]=r["EPSG:3857"],r["EPSG:102113"]=r["EPSG:3857"]}var Np=1,Bp=2,Ag=3,xZ=4,w2=5,QR=6378137,SZ=6356752314e-3,JR=.0066943799901413165,Uy=484813681109536e-20,Ot=Math.PI/2,CZ=.16666666666666666,AZ=.04722222222222222,MZ=.022156084656084655,Yt=1e-10,qo=.017453292519943295,Yl=57.29577951308232,Yn=Math.PI/4,c_=Math.PI*2,bs=3.14159265359;var wd={};wd.greenwich=0;wd.lisbon=-9.131906111111;wd.paris=2.337229166667;wd.bogota=-74.080916666667;wd.madrid=-3.687938888889;wd.rome=12.452333333333;wd.bern=7.439583333333;wd.jakarta=106.807719444444;wd.ferro=-17.666666666667;wd.brussels=4.367975;wd.stockholm=18.058277777778;wd.athens=23.7163375;wd.oslo=10.722916666667;var IZ=wd;var EZ={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var TZ=/[\s_\-\/\(\)]/g;function nh(r,i){if(r[i])return r[i];for(var e=Object.keys(r),n=i.toLowerCase().replace(TZ,""),o=-1,s,l;++o<e.length;)if(s=e[o],l=s.toLowerCase().replace(TZ,""),l===n)return r[s]}function x2(r){var i={},e=r.split("+").map(function(h){return h.trim()}).filter(function(h){return h}).reduce(function(h,p){var m=p.split("=");return m.push(!0),h[m[0].toLowerCase()]=m[1],h},{}),n,o,s,l={proj:"projName",datum:"datumCode",rf:function(h){i.rf=parseFloat(h)},lat_0:function(h){i.lat0=h*qo},lat_1:function(h){i.lat1=h*qo},lat_2:function(h){i.lat2=h*qo},lat_ts:function(h){i.lat_ts=h*qo},lon_0:function(h){i.long0=h*qo},lon_1:function(h){i.long1=h*qo},lon_2:function(h){i.long2=h*qo},alpha:function(h){i.alpha=parseFloat(h)*qo},gamma:function(h){i.rectified_grid_angle=parseFloat(h)*qo},lonc:function(h){i.longc=h*qo},x_0:function(h){i.x0=parseFloat(h)},y_0:function(h){i.y0=parseFloat(h)},k_0:function(h){i.k0=parseFloat(h)},k:function(h){i.k0=parseFloat(h)},a:function(h){i.a=parseFloat(h)},b:function(h){i.b=parseFloat(h)},r:function(h){i.a=i.b=parseFloat(h)},r_a:function(){i.R_A=!0},zone:function(h){i.zone=parseInt(h,10)},south:function(){i.utmSouth=!0},towgs84:function(h){i.datum_params=h.split(",").map(function(p){return parseFloat(p)})},to_meter:function(h){i.to_meter=parseFloat(h)},units:function(h){i.units=h;var p=nh(EZ,h);p&&(i.to_meter=p.to_meter)},from_greenwich:function(h){i.from_greenwich=h*qo},pm:function(h){var p=nh(IZ,h);i.from_greenwich=(p||parseFloat(h))*qo},nadgrids:function(h){h==="@null"?i.datumCode="none":i.nadgrids=h},axis:function(h){var p="ewnsud";h.length===3&&p.indexOf(h.substr(0,1))!==-1&&p.indexOf(h.substr(1,1))!==-1&&p.indexOf(h.substr(2,1))!==-1&&(i.axis=h)},approx:function(){i.approx=!0},over:function(){i.over=!0}};for(n in e)o=e[n],n in l?(s=l[n],typeof s=="function"?s(o):i[s]=o):i[n]=o;return typeof i.datumCode=="string"&&i.datumCode!=="WGS84"&&(i.datumCode=i.datumCode.toLowerCase()),i.projStr=r,i}var e6=class{static getId(i){let e=i.find(n=>Array.isArray(n)&&n[0]==="ID");return e&&e.length>=3?{authority:e[1],code:parseInt(e[2],10)}:null}static convertUnit(i,e="unit"){if(!i||i.length<3)return{type:e,name:"unknown",conversion_factor:null};let n=i[1],o=parseFloat(i[2])||null,s=i.find(h=>Array.isArray(h)&&h[0]==="ID"),l=s?{authority:s[1],code:parseInt(s[2],10)}:null;return{type:e,name:n,conversion_factor:o,id:l}}static convertAxis(i){let e=i[1]||"Unknown",n,o=e.match(/^\((.)\)$/);if(o){let m=o[1].toUpperCase();if(m==="E")n="east";else if(m==="N")n="north";else if(m==="U")n="up";else throw new Error(`Unknown axis abbreviation: ${m}`)}else n=i[2]?i[2].toLowerCase():"unknown";let s=i.find(m=>Array.isArray(m)&&m[0]==="ORDER"),l=s?parseInt(s[1],10):null,h=i.find(m=>Array.isArray(m)&&(m[0]==="LENGTHUNIT"||m[0]==="ANGLEUNIT"||m[0]==="SCALEUNIT")),p=this.convertUnit(h);return{name:e,direction:n,unit:p,order:l}}static extractAxes(i){return i.filter(e=>Array.isArray(e)&&e[0]==="AXIS").map(e=>this.convertAxis(e)).sort((e,n)=>(e.order||0)-(n.order||0))}static convert(i,e={}){switch(i[0]){case"PROJCRS":e.type="ProjectedCRS",e.name=i[1],e.base_crs=i.find(_=>Array.isArray(_)&&_[0]==="BASEGEOGCRS")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="BASEGEOGCRS")):null,e.conversion=i.find(_=>Array.isArray(_)&&_[0]==="CONVERSION")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="CONVERSION")):null;let n=i.find(_=>Array.isArray(_)&&_[0]==="CS");n&&(e.coordinate_system={type:n[1],axis:this.extractAxes(i)});let o=i.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT");if(o){let _=this.convertUnit(o);e.coordinate_system.unit=_}e.id=this.getId(i);break;case"BASEGEOGCRS":case"GEOGCRS":e.type="GeographicCRS",e.name=i[1];let s=i.find(_=>Array.isArray(_)&&(_[0]==="DATUM"||_[0]==="ENSEMBLE"));if(s){let _=this.convert(s);s[0]==="ENSEMBLE"?e.datum_ensemble=_:e.datum=_;let w=i.find(A=>Array.isArray(A)&&A[0]==="PRIMEM");w&&w[1]!=="Greenwich"&&(_.prime_meridian={name:w[1],longitude:parseFloat(w[2])})}e.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(i)},e.id=this.getId(i);break;case"DATUM":e.type="GeodeticReferenceFrame",e.name=i[1],e.ellipsoid=i.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":e.type="DatumEnsemble",e.name=i[1],e.members=i.filter(_=>Array.isArray(_)&&_[0]==="MEMBER").map(_=>({type:"DatumEnsembleMember",name:_[1],id:this.getId(_)}));let l=i.find(_=>Array.isArray(_)&&_[0]==="ENSEMBLEACCURACY");l&&(e.accuracy=parseFloat(l[1]));let h=i.find(_=>Array.isArray(_)&&_[0]==="ELLIPSOID");h&&(e.ellipsoid=this.convert(h)),e.id=this.getId(i);break;case"ELLIPSOID":e.type="Ellipsoid",e.name=i[1],e.semi_major_axis=parseFloat(i[2]),e.inverse_flattening=parseFloat(i[3]);let p=i.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="LENGTHUNIT"),e):null;break;case"CONVERSION":e.type="Conversion",e.name=i[1],e.method=i.find(_=>Array.isArray(_)&&_[0]==="METHOD")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="METHOD")):null,e.parameters=i.filter(_=>Array.isArray(_)&&_[0]==="PARAMETER").map(_=>this.convert(_));break;case"METHOD":e.type="Method",e.name=i[1],e.id=this.getId(i);break;case"PARAMETER":e.type="Parameter",e.name=i[1],e.value=parseFloat(i[2]),e.unit=this.convertUnit(i.find(_=>Array.isArray(_)&&(_[0]==="LENGTHUNIT"||_[0]==="ANGLEUNIT"||_[0]==="SCALEUNIT"))),e.id=this.getId(i);break;case"BOUNDCRS":e.type="BoundCRS";let m=i.find(_=>Array.isArray(_)&&_[0]==="SOURCECRS");if(m){let _=m.find(w=>Array.isArray(w));e.source_crs=_?this.convert(_):null}let f=i.find(_=>Array.isArray(_)&&_[0]==="TARGETCRS");if(f){let _=f.find(w=>Array.isArray(w));e.target_crs=_?this.convert(_):null}let g=i.find(_=>Array.isArray(_)&&_[0]==="ABRIDGEDTRANSFORMATION");g?e.transformation=this.convert(g):e.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(e.type="Transformation",e.name=i[1],e.method=i.find(_=>Array.isArray(_)&&_[0]==="METHOD")?this.convert(i.find(_=>Array.isArray(_)&&_[0]==="METHOD")):null,e.parameters=i.filter(_=>Array.isArray(_)&&(_[0]==="PARAMETER"||_[0]==="PARAMETERFILE")).map(_=>{if(_[0]==="PARAMETER")return this.convert(_);if(_[0]==="PARAMETERFILE")return{name:_[1],value:_[2],id:{authority:"EPSG",code:8656}}}),e.parameters.length===7){let _=e.parameters[6];_.name==="Scale difference"&&(_.value=Math.round((_.value-1)*1e12)/1e6)}e.id=this.getId(i);break;case"AXIS":e.coordinate_system||(e.coordinate_system={type:"unspecified",axis:[]}),e.coordinate_system.axis.push(this.convertAxis(i));break;case"LENGTHUNIT":let y=this.convertUnit(i,"LinearUnit");e.coordinate_system&&e.coordinate_system.axis&&e.coordinate_system.axis.forEach(_=>{_.unit||(_.unit=y)}),y.conversion_factor&&y.conversion_factor!==1&&e.semi_major_axis&&(e.semi_major_axis={value:e.semi_major_axis,unit:y});break;default:e.keyword=i[0];break}return e}},pE=e6;var t6=class extends pE{static convert(i,e={}){return super.convert(i,e),e.coordinate_system&&e.coordinate_system.subtype==="Cartesian"&&delete e.coordinate_system,e.usage&&delete e.usage,e}},FZ=t6;var i6=class extends pE{static convert(i,e={}){super.convert(i,e);let n=i.find(s=>Array.isArray(s)&&s[0]==="CS");n&&(e.coordinate_system={subtype:n[1],axis:this.extractAxes(i)});let o=i.find(s=>Array.isArray(s)&&s[0]==="USAGE");if(o){let s=o.find(p=>Array.isArray(p)&&p[0]==="SCOPE"),l=o.find(p=>Array.isArray(p)&&p[0]==="AREA"),h=o.find(p=>Array.isArray(p)&&p[0]==="BBOX");e.usage={},s&&(e.usage.scope=s[1]),l&&(e.usage.area=l[1]),h&&(e.usage.bbox=h.slice(1))}return e}},PZ=i6;function qge(r){return r.find(i=>Array.isArray(i)&&i[0]==="USAGE")?"2019":(r.find(i=>Array.isArray(i)&&i[0]==="CS")||r[0]==="BOUNDCRS"||r[0]==="PROJCRS"||r[0]==="GEOGCRS","2015")}function LZ(r){return(qge(r)==="2019"?PZ:FZ).convert(r)}function kZ(r){let i=r.toUpperCase();return i.includes("PROJCRS")||i.includes("GEOGCRS")||i.includes("BOUNDCRS")||i.includes("VERTCRS")||i.includes("LENGTHUNIT")||i.includes("ANGLEUNIT")||i.includes("SCALEUNIT")?"WKT2":(i.includes("PROJCS")||i.includes("GEOGCS")||i.includes("LOCAL_CS")||i.includes("VERT_CS")||i.includes("UNIT"),"WKT1")}var OZ=Kge,S2=1,DZ=2,RZ=3,mE=4,NZ=5,r6=-1,Yge=/\s/,Zge=/[A-Za-z]/,Xge=/[A-Za-z84_]/,fE=/[,\]]/,BZ=/[\d\.E\-\+]/;function Mg(r){if(typeof r!="string")throw new Error("not a string");this.text=r.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=S2}Mg.prototype.readCharicter=function(){var r=this.text[this.place++];if(this.state!==mE)for(;Yge.test(r);){if(this.place>=this.text.length)return;r=this.text[this.place++]}switch(this.state){case S2:return this.neutral(r);case DZ:return this.keyword(r);case mE:return this.quoted(r);case NZ:return this.afterquote(r);case RZ:return this.number(r);case r6:return}};Mg.prototype.afterquote=function(r){if(r==='"'){this.word+='"',this.state=mE;return}if(fE.test(r)){this.word=this.word.trim(),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in afterquote yet, index '+this.place)};Mg.prototype.afterItem=function(r){if(r===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=S2;return}if(r==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=S2,this.currentObject=this.stack.pop(),this.currentObject||(this.state=r6);return}};Mg.prototype.number=function(r){if(BZ.test(r)){this.word+=r;return}if(fE.test(r)){this.word=parseFloat(this.word),this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in number yet, index '+this.place)};Mg.prototype.quoted=function(r){if(r==='"'){this.state=NZ;return}this.word+=r};Mg.prototype.keyword=function(r){if(Xge.test(r)){this.word+=r;return}if(r==="["){var i=[];i.push(this.word),this.level++,this.root===null?this.root=i:this.currentObject.push(i),this.stack.push(this.currentObject),this.currentObject=i,this.state=S2;return}if(fE.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in keyword yet, index '+this.place)};Mg.prototype.neutral=function(r){if(Zge.test(r)){this.word=r,this.state=DZ;return}if(r==='"'){this.word="",this.state=mE;return}if(BZ.test(r)){this.word=r,this.state=RZ;return}if(fE.test(r)){this.afterItem(r);return}throw new Error(`havn't handled "`+r+'" in neutral yet, index '+this.place)};Mg.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===r6)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function Kge(r){var i=new Mg(r);return i.output()}function n6(r,i,e){Array.isArray(i)&&(e.unshift(i),i=null);var n=i?{}:r,o=e.reduce(function(s,l){return zy(l,s),s},n);i&&(r[i]=o)}function zy(r,i){if(!Array.isArray(r)){i[r]=!0;return}var e=r.shift();if(e==="PARAMETER"&&(e=r.shift()),r.length===1){if(Array.isArray(r[0])){i[e]={},zy(r[0],i[e]);return}i[e]=r[0];return}if(!r.length){i[e]=!0;return}if(e==="TOWGS84"){i[e]=r;return}if(e==="AXIS"){e in i||(i[e]=[]),i[e].push(r);return}Array.isArray(e)||(i[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":i[e]={name:r[0].toLowerCase(),convert:r[1]},r.length===3&&zy(r[2],i[e]);return;case"SPHEROID":case"ELLIPSOID":i[e]={name:r[0],a:r[1],rf:r[2]},r.length===4&&zy(r[3],i[e]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":r[0]=["name",r[0]],n6(i,e,r);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":r[0]=["name",r[0]],n6(i,e,r),i[e].type=e;return;default:for(n=-1;++n<r.length;)if(!Array.isArray(r[n]))return zy(r,i[e]);return n6(i,e,r)}}var Qge=.017453292519943295;function ep(r){return r*Qge}function gE(r){let i=(r.projName||"").toLowerCase().replace(/_/g," ");!r.long0&&r.longc&&(i==="albers conic equal area"||i==="lambert azimuthal equal area")&&(r.long0=r.longc),!r.lat_ts&&r.lat1&&(i==="stereographic south pole"||i==="polar stereographic (variant b)")?(r.lat0=ep(r.lat1>0?90:-90),r.lat_ts=r.lat1,delete r.lat1):!r.lat_ts&&r.lat0&&(i==="polar stereographic"||i==="polar stereographic (variant a)")&&(r.lat_ts=r.lat0,r.lat0=ep(r.lat0>0?90:-90),delete r.lat1)}function GZ(r){let i={units:null,to_meter:void 0};return typeof r=="string"?(i.units=r.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.units==="meter"&&(i.to_meter=1)):r&&r.name&&(i.units=r.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.to_meter=r.conversion_factor),i}function jZ(r){return typeof r=="object"?r.value*r.unit.conversion_factor:r}function VZ(r,i){r.ellipsoid.radius?(i.a=r.ellipsoid.radius,i.rf=0):(i.a=jZ(r.ellipsoid.semi_major_axis),r.ellipsoid.inverse_flattening!==void 0?i.rf=r.ellipsoid.inverse_flattening:r.ellipsoid.semi_major_axis!==void 0&&r.ellipsoid.semi_minor_axis!==void 0&&(i.rf=i.a/(i.a-jZ(r.ellipsoid.semi_minor_axis))))}function C2(r,i={}){return!r||typeof r!="object"?r:r.type==="BoundCRS"?(C2(r.source_crs,i),r.transformation&&(r.transformation.method&&r.transformation.method.name==="NTv2"?i.nadgrids=r.transformation.parameters[0].value:i.datum_params=r.transformation.parameters.map(e=>e.value)),i):(Object.keys(r).forEach(e=>{let n=r[e];if(n!==null)switch(e){case"name":if(i.srsCode)break;i.name=n,i.srsCode=n;break;case"type":n==="GeographicCRS"?i.projName="longlat":n==="ProjectedCRS"&&r.conversion&&r.conversion.method&&(i.projName=r.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(i.ellps=n.ellipsoid.name,VZ(n,i)),n.prime_meridian&&(i.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":i.ellps=n.name,VZ(n,i);break;case"prime_meridian":i.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis){if(i.axis=n.axis.map(o=>{let s=o.direction;if(s==="east")return"e";if(s==="north")return"n";if(s==="west")return"w";if(s==="south")return"s";throw new Error(`Unknown axis direction: ${s}`)}).join("")+"u",n.unit){let{units:o,to_meter:s}=GZ(n.unit);i.units=o,i.to_meter=s}else if(n.axis[0]&&n.axis[0].unit){let{units:o,to_meter:s}=GZ(n.axis[0].unit);i.units=o,i.to_meter=s}}break;case"id":n.authority&&n.code&&(i.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(i.projName=n.method.name),n.parameters&&n.parameters.forEach(o=>{let s=o.name.toLowerCase().replace(/\s+/g,"_"),l=o.value;o.unit&&o.unit.conversion_factor?i[s]=l*o.unit.conversion_factor:o.unit==="degree"?i[s]=l*Math.PI/180:i[s]=l});break;case"unit":n.name&&(i.units=n.name.toLowerCase(),i.units==="metre"&&(i.units="meter")),n.conversion_factor&&(i.to_meter=n.conversion_factor);break;case"base_crs":C2(n,i),i.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name;break;default:break}}),i.latitude_of_false_origin!==void 0&&(i.lat0=i.latitude_of_false_origin),i.longitude_of_false_origin!==void 0&&(i.long0=i.longitude_of_false_origin),i.latitude_of_standard_parallel!==void 0&&(i.lat0=i.latitude_of_standard_parallel,i.lat1=i.latitude_of_standard_parallel),i.latitude_of_1st_standard_parallel!==void 0&&(i.lat1=i.latitude_of_1st_standard_parallel),i.latitude_of_2nd_standard_parallel!==void 0&&(i.lat2=i.latitude_of_2nd_standard_parallel),i.latitude_of_projection_centre!==void 0&&(i.lat0=i.latitude_of_projection_centre),i.longitude_of_projection_centre!==void 0&&(i.longc=i.longitude_of_projection_centre),i.easting_at_false_origin!==void 0&&(i.x0=i.easting_at_false_origin),i.northing_at_false_origin!==void 0&&(i.y0=i.northing_at_false_origin),i.latitude_of_natural_origin!==void 0&&(i.lat0=i.latitude_of_natural_origin),i.longitude_of_natural_origin!==void 0&&(i.long0=i.longitude_of_natural_origin),i.longitude_of_origin!==void 0&&(i.long0=i.longitude_of_origin),i.false_easting!==void 0&&(i.x0=i.false_easting),i.easting_at_projection_centre&&(i.x0=i.easting_at_projection_centre),i.false_northing!==void 0&&(i.y0=i.false_northing),i.northing_at_projection_centre&&(i.y0=i.northing_at_projection_centre),i.standard_parallel_1!==void 0&&(i.lat1=i.standard_parallel_1),i.standard_parallel_2!==void 0&&(i.lat2=i.standard_parallel_2),i.scale_factor_at_natural_origin!==void 0&&(i.k0=i.scale_factor_at_natural_origin),i.scale_factor_at_projection_centre!==void 0&&(i.k0=i.scale_factor_at_projection_centre),i.scale_factor_on_pseudo_standard_parallel!==void 0&&(i.k0=i.scale_factor_on_pseudo_standard_parallel),i.azimuth!==void 0&&(i.alpha=i.azimuth),i.azimuth_at_projection_centre!==void 0&&(i.alpha=i.azimuth_at_projection_centre),i.angle_from_rectified_to_skew_grid&&(i.rectified_grid_angle=i.angle_from_rectified_to_skew_grid),gE(i),i)}var Jge=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function e0e(r,i){var e=i[0],n=i[1];!(e in r)&&n in r&&(r[e]=r[n],i.length===3&&(r[e]=i[2](r[e])))}function UZ(r){for(var i=Object.keys(r),e=0,n=i.length;e<n;++e){var o=i[e];Jge.indexOf(o)!==-1&&t0e(r[o]),typeof r[o]=="object"&&UZ(r[o])}}function t0e(r){if(r.AUTHORITY){var i=Object.keys(r.AUTHORITY)[0];i&&i in r.AUTHORITY&&(r.title=i+":"+r.AUTHORITY[i])}if(r.type==="GEOGCS"?r.projName="longlat":r.type==="LOCAL_CS"?(r.projName="identity",r.local=!0):typeof r.PROJECTION=="object"?r.projName=Object.keys(r.PROJECTION)[0]:r.projName=r.PROJECTION,r.AXIS){for(var e="",n=0,o=r.AXIS.length;n<o;++n){var s=[r.AXIS[n][0].toLowerCase(),r.AXIS[n][1].toLowerCase()];s[0].indexOf("north")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="north"?e+="n":s[0].indexOf("south")!==-1||(s[0]==="y"||s[0]==="lat")&&s[1]==="south"?e+="s":s[0].indexOf("east")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="east"?e+="e":(s[0].indexOf("west")!==-1||(s[0]==="x"||s[0]==="lon")&&s[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(r.axis=e)}r.UNIT&&(r.units=r.UNIT.name.toLowerCase(),r.units==="metre"&&(r.units="meter"),r.UNIT.convert&&(r.type==="GEOGCS"?r.DATUM&&r.DATUM.SPHEROID&&(r.to_meter=r.UNIT.convert*r.DATUM.SPHEROID.a):r.to_meter=r.UNIT.convert));var l=r.GEOGCS;r.type==="GEOGCS"&&(l=r),l&&(l.DATUM?r.datumCode=l.DATUM.name.toLowerCase():r.datumCode=l.name.toLowerCase(),r.datumCode.slice(0,2)==="d_"&&(r.datumCode=r.datumCode.slice(2)),r.datumCode==="new_zealand_1949"&&(r.datumCode="nzgd49"),(r.datumCode==="wgs_1984"||r.datumCode==="world_geodetic_system_1984")&&(r.PROJECTION==="Mercator_Auxiliary_Sphere"&&(r.sphere=!0),r.datumCode="wgs84"),r.datumCode==="belge_1972"&&(r.datumCode="rnb72"),l.DATUM&&l.DATUM.SPHEROID&&(r.ellps=l.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),r.ellps.toLowerCase().slice(0,13)==="international"&&(r.ellps="intl"),r.a=l.DATUM.SPHEROID.a,r.rf=parseFloat(l.DATUM.SPHEROID.rf,10)),l.DATUM&&l.DATUM.TOWGS84&&(r.datum_params=l.DATUM.TOWGS84),~r.datumCode.indexOf("osgb_1936")&&(r.datumCode="osgb36"),~r.datumCode.indexOf("osni_1952")&&(r.datumCode="osni52"),(~r.datumCode.indexOf("tm65")||~r.datumCode.indexOf("geodetic_datum_of_1965"))&&(r.datumCode="ire65"),r.datumCode==="ch1903+"&&(r.datumCode="ch1903"),~r.datumCode.indexOf("israel")&&(r.datumCode="isr93")),r.b&&!isFinite(r.b)&&(r.b=r.a),r.rectified_grid_angle&&(r.rectified_grid_angle=ep(r.rectified_grid_angle));function h(f){var g=r.to_meter||1;return f*g}var p=function(f){return e0e(r,f)},m=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",ep],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",ep],["x0","false_easting",h],["y0","false_northing",h],["long0","central_meridian",ep],["lat0","latitude_of_origin",ep],["lat0","standard_parallel_1",ep],["lat1","standard_parallel_1",ep],["lat2","standard_parallel_2",ep],["azimuth","Azimuth"],["alpha","azimuth",ep],["srsCode","name"]];m.forEach(p),gE(r)}function Nb(r){if(typeof r=="object")return C2(r);let i=kZ(r);var e=OZ(r);if(i==="WKT2"){let s=LZ(e);return C2(s)}var n=e[0],o={};return zy(e,o),UZ(o),o[n]}function xd(r){var i=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?xd[r]=x2(arguments[1]):xd[r]=Nb(arguments[1]):e&&typeof e=="object"&&!("projName"in e)?xd[r]=Nb(arguments[1]):(xd[r]=e,e||delete xd[r])}else if(arguments.length===1){if(Array.isArray(r))return r.map(function(n){return Array.isArray(n)?xd.apply(i,n):xd(n)});if(typeof r=="string"){if(r in xd)return xd[r]}else"EPSG"in r?xd["EPSG:"+r.EPSG]=r:"ESRI"in r?xd["ESRI:"+r.ESRI]=r:"IAU2000"in r?xd["IAU2000:"+r.IAU2000]=r:console.log(r);return}}wZ(xd);var Bb=xd;function i0e(r){return typeof r=="string"}function r0e(r){return r in Bb}function n0e(r){return r.indexOf("+")!==0&&r.indexOf("[")!==-1||typeof r=="object"&&!("srsCode"in r)}var o0e=["3857","900913","3785","102113"];function a0e(r){var i=nh(r,"authority");if(i){var e=nh(i,"epsg");return e&&o0e.indexOf(e)>-1}}function s0e(r){var i=nh(r,"extension");if(i)return nh(i,"proj4")}function l0e(r){return r[0]==="+"}function c0e(r){if(i0e(r)){if(r0e(r))return Bb[r];if(n0e(r)){var i=Nb(r);if(a0e(i))return Bb["EPSG:3857"];var e=s0e(i);return e?x2(e):i}if(l0e(r))return x2(r)}else return"projName"in r?r:Nb(r)}var zZ=c0e;function o6(r,i){r=r||{};var e,n;if(!i)return r;for(n in i)e=i[n],e!==void 0&&(r[n]=e);return r}function cu(r,i,e){var n=r*i;return e/Math.sqrt(1-n*n)}function tf(r){return r<0?-1:1}function Zt(r,i){return i||Math.abs(r)<=bs?r:r-tf(r)*c_}function Nu(r,i,e){var n=r*e,o=.5*r;return n=Math.pow((1-n)/(1+n),o),Math.tan(.5*(Ot-i))/n}function Ig(r,i){for(var e=.5*r,n,o,s=Ot-2*Math.atan(i),l=0;l<=15;l++)if(n=r*Math.sin(s),o=Ot-2*Math.atan(i*Math.pow((1-n)/(1+n),e))-s,s+=o,Math.abs(o)<=1e-10)return s;return-9999}function u0e(){var r=this.b/this.a;this.es=1-r*r,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=cu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function d0e(r){var i=r.x,e=r.y;if(e*Yl>90&&e*Yl<-90&&i*Yl>180&&i*Yl<-180)return null;var n,o;if(Math.abs(Math.abs(e)-Ot)<=Yt)return null;if(this.sphere)n=this.x0+this.a*this.k0*Zt(i-this.long0,this.over),o=this.y0+this.a*this.k0*Math.log(Math.tan(Yn+.5*e));else{var s=Math.sin(e),l=Nu(this.e,e,s);n=this.x0+this.a*this.k0*Zt(i-this.long0,this.over),o=this.y0-this.a*this.k0*Math.log(l)}return r.x=n,r.y=o,r}function h0e(r){var i=r.x-this.x0,e=r.y-this.y0,n,o;if(this.sphere)o=Ot-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var s=Math.exp(-e/(this.a*this.k0));if(o=Ig(this.e,s),o===-9999)return null}return n=Zt(this.long0+i/(this.a*this.k0),this.over),r.x=n,r.y=o,r}var p0e=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"],$Z={init:u0e,forward:d0e,inverse:h0e,names:p0e};function m0e(){}function WZ(r){return r}var a6=["longlat","identity"],HZ={init:m0e,forward:WZ,inverse:WZ,names:a6};var f0e=[$Z,HZ],$y={},Gb=[];function qZ(r,i){var e=Gb.length;return r.names?(Gb[e]=r,r.names.forEach(function(n){$y[n.toLowerCase()]=e}),this):(console.log(i),!0)}function s6(r){return r.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function g0e(r){if(!r)return!1;var i=r.toLowerCase();if(typeof $y[i]<"u"&&Gb[$y[i]]||(i=s6(i),i in $y&&Gb[$y[i]]))return Gb[$y[i]]}function _0e(){f0e.forEach(qZ)}var YZ={start:_0e,add:qZ,get:g0e};var y0e={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},l6=y0e;var v0e=l6.WGS84;function ZZ(r,i,e,n){var o=r*r,s=i*i,l=(o-s)/o,h=0;n?(r*=1-l*(CZ+l*(AZ+l*MZ)),o=r*r,l=0):h=Math.sqrt(l);var p=(o-s)/s;return{es:l,e:h,ep2:p}}function XZ(r,i,e,n,o){if(!r){var s=nh(l6,n);s||(s=v0e),r=s.a,i=s.b,e=s.rf}return e&&!i&&(i=(1-1/e)*r),(e===0||Math.abs(r-i)<Yt)&&(o=!0,i=r),{a:r,b:i,rf:e,sphere:o}}var yE={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(KZ in yE)_E=yE[KZ],_E.datumName&&(yE[_E.datumName]=_E);var _E,KZ,QZ=yE;function b0e(r,i,e,n,o,s,l){var h={};return r===void 0||r==="none"?h.datum_type=w2:h.datum_type=xZ,i&&(h.datum_params=i.map(parseFloat),(h.datum_params[0]!==0||h.datum_params[1]!==0||h.datum_params[2]!==0)&&(h.datum_type=Np),h.datum_params.length>3&&(h.datum_params[3]!==0||h.datum_params[4]!==0||h.datum_params[5]!==0||h.datum_params[6]!==0)&&(h.datum_type=Bp,h.datum_params[3]*=Uy,h.datum_params[4]*=Uy,h.datum_params[5]*=Uy,h.datum_params[6]=h.datum_params[6]/1e6+1)),l&&(h.datum_type=Ag,h.grids=l),h.a=e,h.b=n,h.es=o,h.ep2=s,h}var JZ=b0e;var u6={};function d6(r,i,e){return i instanceof ArrayBuffer?w0e(r,i,e):{ready:x0e(r,i)}}function w0e(r,i,e){var n=!0;e!==void 0&&e.includeErrorFields===!1&&(n=!1);var o=new DataView(i),s=C0e(o),l=A0e(o,s),h=M0e(o,l,s,n),p={header:l,subgrids:h};return u6[r]=p,p}function x0e(r,i){return un(this,null,function*(){for(var e=[],n=yield i.getImageCount(),o=n-1;o>=0;o--){var s=yield i.getImage(o),l=yield s.readRasters(),h=l,p=[s.getWidth(),s.getHeight()],m=s.getBoundingBox().map(eX),f=[s.fileDirectory.ModelPixelScale[0],s.fileDirectory.ModelPixelScale[1]].map(eX),g=m[0]+(p[0]-1)*f[0],y=m[3]-(p[1]-1)*f[1],_=h[0],w=h[1],A=[];for(let q=p[1]-1;q>=0;q--)for(let X=p[0]-1;X>=0;X--){var k=q*p[0]+X;A.push([-u_(w[k]),u_(_[k])])}e.push({del:f,lim:p,ll:[-g,y],cvs:A})}var R={header:{nSubgrids:n},subgrids:e};return u6[r]=R,R})}function tX(r){if(r===void 0)return null;var i=r.split(",");return i.map(S0e)}function S0e(r){if(r.length===0)return null;var i=r[0]==="@";return i&&(r=r.slice(1)),r==="null"?{name:"null",mandatory:!i,grid:null,isNull:!0}:{name:r,mandatory:!i,grid:u6[r]||null,isNull:!1}}function eX(r){return r*Math.PI/180}function u_(r){return r/3600*Math.PI/180}function C0e(r){var i=r.getInt32(8,!1);return i===11?!1:(i=r.getInt32(8,!0),i!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function A0e(r,i){return{nFields:r.getInt32(8,i),nSubgridFields:r.getInt32(24,i),nSubgrids:r.getInt32(40,i),shiftType:c6(r,56,64).trim(),fromSemiMajorAxis:r.getFloat64(120,i),fromSemiMinorAxis:r.getFloat64(136,i),toSemiMajorAxis:r.getFloat64(152,i),toSemiMinorAxis:r.getFloat64(168,i)}}function c6(r,i,e){return String.fromCharCode.apply(null,new Uint8Array(r.buffer.slice(i,e)))}function M0e(r,i,e,n){for(var o=176,s=[],l=0;l<i.nSubgrids;l++){var h=E0e(r,o,e),p=T0e(r,o,h,e,n),m=Math.round(1+(h.upperLongitude-h.lowerLongitude)/h.longitudeInterval),f=Math.round(1+(h.upperLatitude-h.lowerLatitude)/h.latitudeInterval);s.push({ll:[u_(h.lowerLongitude),u_(h.lowerLatitude)],del:[u_(h.longitudeInterval),u_(h.latitudeInterval)],lim:[m,f],count:h.gridNodeCount,cvs:I0e(p)});var g=16;n===!1&&(g=8),o+=176+h.gridNodeCount*g}return s}function I0e(r){return r.map(function(i){return[u_(i.longitudeShift),u_(i.latitudeShift)]})}function E0e(r,i,e){return{name:c6(r,i+8,i+16).trim(),parent:c6(r,i+24,i+24+8).trim(),lowerLatitude:r.getFloat64(i+72,e),upperLatitude:r.getFloat64(i+88,e),lowerLongitude:r.getFloat64(i+104,e),upperLongitude:r.getFloat64(i+120,e),latitudeInterval:r.getFloat64(i+136,e),longitudeInterval:r.getFloat64(i+152,e),gridNodeCount:r.getInt32(i+168,e)}}function T0e(r,i,e,n,o){var s=i+176,l=16;o===!1&&(l=8);for(var h=[],p=0;p<e.gridNodeCount;p++){var m={latitudeShift:r.getFloat32(s+p*l,n),longitudeShift:r.getFloat32(s+p*l+4,n)};o!==!1&&(m.latitudeAccuracy=r.getFloat32(s+p*l+8,n),m.longitudeAccuracy=r.getFloat32(s+p*l+12,n)),h.push(m)}return h}function jb(r,i){if(!(this instanceof jb))return new jb(r);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,i=i||function(m){if(m)throw m};var e=zZ(r);if(typeof e!="object"){i("Could not parse to valid json: "+r);return}var n=jb.projections.get(e.projName);if(!n){i("Could not get projection name from: "+r);return}if(e.datumCode&&e.datumCode!=="none"){var o=nh(QZ,e.datumCode);o&&(e.datum_params=e.datum_params||(o.towgs84?o.towgs84.split(","):null),e.ellps=o.ellipse,e.datumName=o.datumName?o.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var s=XZ(e.a,e.b,e.rf,e.ellps,e.sphere),l=ZZ(s.a,s.b,s.rf,e.R_A),h=tX(e.nadgrids),p=e.datum||JZ(e.datumCode,e.datum_params,s.a,s.b,l.es,l.ep2,h);o6(this,e),o6(this,n),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=l.es,this.e=l.e,this.ep2=l.ep2,this.datum=p,"init"in this&&typeof this.init=="function"&&this.init(),i(null,this)}jb.projections=YZ;jb.projections.start();var Gp=jb;function iX(r,i){return r.datum_type!==i.datum_type||r.a!==i.a||Math.abs(r.es-i.es)>5e-11?!1:r.datum_type===Np?r.datum_params[0]===i.datum_params[0]&&r.datum_params[1]===i.datum_params[1]&&r.datum_params[2]===i.datum_params[2]:r.datum_type===Bp?r.datum_params[0]===i.datum_params[0]&&r.datum_params[1]===i.datum_params[1]&&r.datum_params[2]===i.datum_params[2]&&r.datum_params[3]===i.datum_params[3]&&r.datum_params[4]===i.datum_params[4]&&r.datum_params[5]===i.datum_params[5]&&r.datum_params[6]===i.datum_params[6]:!0}function vE(r,i,e){var n=r.x,o=r.y,s=r.z?r.z:0,l,h,p,m;if(o<-Ot&&o>-1.001*Ot)o=-Ot;else if(o>Ot&&o<1.001*Ot)o=Ot;else{if(o<-Ot)return{x:-1/0,y:-1/0,z:r.z};if(o>Ot)return{x:1/0,y:1/0,z:r.z}}return n>Math.PI&&(n-=2*Math.PI),h=Math.sin(o),m=Math.cos(o),p=h*h,l=e/Math.sqrt(1-i*p),{x:(l+s)*m*Math.cos(n),y:(l+s)*m*Math.sin(n),z:(l*(1-i)+s)*h}}function bE(r,i,e,n){var o=1e-12,s=o*o,l=30,h,p,m,f,g,y,_,w,A,k,R,q,X,ie=r.x,ae=r.y,be=r.z?r.z:0,me,fe,ge;if(h=Math.sqrt(ie*ie+ae*ae),p=Math.sqrt(ie*ie+ae*ae+be*be),h/e<o){if(me=0,p/e<o)return fe=Ot,ge=-n,{x:r.x,y:r.y,z:r.z}}else me=Math.atan2(ae,ie);m=be/p,f=h/p,g=1/Math.sqrt(1-i*(2-i)*f*f),w=f*(1-i)*g,A=m*g,X=0;do X++,_=e/Math.sqrt(1-i*A*A),ge=h*w+be*A-_*(1-i*A*A),y=i*_/(_+ge),g=1/Math.sqrt(1-y*(2-y)*f*f),k=f*(1-y)*g,R=m*g,q=R*w-k*A,w=k,A=R;while(q*q>s&&X<l);return fe=Math.atan(R/Math.abs(k)),{x:me,y:fe,z:ge}}function rX(r,i,e){if(i===Np)return{x:r.x+e[0],y:r.y+e[1],z:r.z+e[2]};if(i===Bp){var n=e[0],o=e[1],s=e[2],l=e[3],h=e[4],p=e[5],m=e[6];return{x:m*(r.x-p*r.y+h*r.z)+n,y:m*(p*r.x+r.y-l*r.z)+o,z:m*(-h*r.x+l*r.y+r.z)+s}}}function nX(r,i,e){if(i===Np)return{x:r.x-e[0],y:r.y-e[1],z:r.z-e[2]};if(i===Bp){var n=e[0],o=e[1],s=e[2],l=e[3],h=e[4],p=e[5],m=e[6],f=(r.x-n)/m,g=(r.y-o)/m,y=(r.z-s)/m;return{x:f+p*g-h*y,y:-p*f+g+l*y,z:h*f-l*g+y}}}function wE(r){return r===Np||r===Bp}function sX(r,i,e){if(iX(r,i)||r.datum_type===w2||i.datum_type===w2)return e;var n=r.a,o=r.es;if(r.datum_type===Ag){var s=oX(r,!1,e);if(s!==0)return;n=QR,o=JR}var l=i.a,h=i.b,p=i.es;if(i.datum_type===Ag&&(l=QR,h=SZ,p=JR),o===p&&n===l&&!wE(r.datum_type)&&!wE(i.datum_type))return e;if(e=vE(e,o,n),wE(r.datum_type)&&(e=rX(e,r.datum_type,r.datum_params)),wE(i.datum_type)&&(e=nX(e,i.datum_type,i.datum_params)),e=bE(e,p,l,h),i.datum_type===Ag){var m=oX(i,!0,e);if(m!==0)return}return e}function oX(r,i,e){if(r.grids===null||r.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},o={x:Number.NaN,y:Number.NaN},s=[];e:for(var l=0;l<r.grids.length;l++){var h=r.grids[l];if(s.push(h.name),h.isNull){o=n;break}if(h.grid===null){if(h.mandatory)return console.log("Unable to find mandatory grid '"+h.name+"'"),-1;continue}for(var p=h.grid.subgrids,m=0,f=p.length;m<f;m++){var g=p[m],y=(Math.abs(g.del[1])+Math.abs(g.del[0]))/1e4,_=g.ll[0]-y,w=g.ll[1]-y,A=g.ll[0]+(g.lim[0]-1)*g.del[0]+y,k=g.ll[1]+(g.lim[1]-1)*g.del[1]+y;if(!(w>n.y||_>n.x||k<n.y||A<n.x)&&(o=F0e(n,i,g),!isNaN(o.x)))break e}}return isNaN(o.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*Yl+" "+n.y*Yl+" tried: '"+s+"'"),-1):(e.x=-o.x,e.y=o.y,0)}function F0e(r,i,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(r.x))return n;var o={x:r.x,y:r.y};o.x-=e.ll[0],o.y-=e.ll[1],o.x=Zt(o.x-Math.PI)+Math.PI;var s=aX(o,e);if(i){if(isNaN(s.x))return n;s.x=o.x-s.x,s.y=o.y-s.y;var l=9,h=1e-12,p,m;do{if(m=aX(s,e),isNaN(m.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}p={x:o.x-(m.x+s.x),y:o.y-(m.y+s.y)},s.x+=p.x,s.y+=p.y}while(l--&&Math.abs(p.x)>h&&Math.abs(p.y)>h);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=Zt(s.x+e.ll[0]),n.y=s.y+e.ll[1]}else isNaN(s.x)||(n.x=r.x+s.x,n.y=r.y+s.y);return n}function aX(r,i){var e={x:r.x/i.del[0],y:r.y/i.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},o={x:e.x-1*n.x,y:e.y-1*n.y},s={x:Number.NaN,y:Number.NaN},l;if(n.x<0||n.x>=i.lim[0]||n.y<0||n.y>=i.lim[1])return s;l=n.y*i.lim[0]+n.x;var h={x:i.cvs[l][0],y:i.cvs[l][1]};l++;var p={x:i.cvs[l][0],y:i.cvs[l][1]};l+=i.lim[0];var m={x:i.cvs[l][0],y:i.cvs[l][1]};l--;var f={x:i.cvs[l][0],y:i.cvs[l][1]},g=o.x*o.y,y=o.x*(1-o.y),_=(1-o.x)*(1-o.y),w=(1-o.x)*o.y;return s.x=_*h.x+y*p.x+w*f.x+g*m.x,s.y=_*h.y+y*p.y+w*f.y+g*m.y,s}function h6(r,i,e){var n=e.x,o=e.y,s=e.z||0,l,h,p,m={};for(p=0;p<3;p++)if(!(i&&p===2&&e.z===void 0))switch(p===0?(l=n,"ew".indexOf(r.axis[p])!==-1?h="x":h="y"):p===1?(l=o,"ns".indexOf(r.axis[p])!==-1?h="y":h="x"):(l=s,h="z"),r.axis[p]){case"e":m[h]=l;break;case"w":m[h]=-l;break;case"n":m[h]=l;break;case"s":m[h]=-l;break;case"u":e[h]!==void 0&&(m.z=l);break;case"d":e[h]!==void 0&&(m.z=-l);break;default:return null}return m}function xE(r){var i={x:r[0],y:r[1]};return r.length>2&&(i.z=r[2]),r.length>3&&(i.m=r[3]),i}function cX(r){lX(r.x),lX(r.y)}function lX(r){if(typeof Number.isFinite=="function"){if(Number.isFinite(r))return;throw new TypeError("coordinates must be finite numbers")}if(typeof r!="number"||r!==r||!isFinite(r))throw new TypeError("coordinates must be finite numbers")}function P0e(r,i){return(r.datum.datum_type===Np||r.datum.datum_type===Bp||r.datum.datum_type===Ag)&&i.datumCode!=="WGS84"||(i.datum.datum_type===Np||i.datum.datum_type===Bp||i.datum.datum_type===Ag)&&r.datumCode!=="WGS84"}function Wy(r,i,e,n){var o;Array.isArray(e)?e=xE(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var s=e.z!==void 0;if(cX(e),r.datum&&i.datum&&P0e(r,i)&&(o=new Gp("WGS84"),e=Wy(r,o,e,n),r=o),n&&r.axis!=="enu"&&(e=h6(r,!1,e)),r.projName==="longlat")e={x:e.x*qo,y:e.y*qo,z:e.z||0};else if(r.to_meter&&(e={x:e.x*r.to_meter,y:e.y*r.to_meter,z:e.z||0}),e=r.inverse(e),!e)return;if(r.from_greenwich&&(e.x+=r.from_greenwich),e=sX(r.datum,i.datum,e),!!e)return e=e,i.from_greenwich&&(e={x:e.x-i.from_greenwich,y:e.y,z:e.z||0}),i.projName==="longlat"?e={x:e.x*Yl,y:e.y*Yl,z:e.z||0}:(e=i.forward(e),i.to_meter&&(e={x:e.x/i.to_meter,y:e.y/i.to_meter,z:e.z||0})),n&&i.axis!=="enu"?h6(i,!0,e):(e&&!s&&delete e.z,e)}var uX=Gp("WGS84");function p6(r,i,e,n){var o,s,l;return Array.isArray(e)?(o=Wy(r,i,e,n)||{x:NaN,y:NaN},e.length>2?typeof r.name<"u"&&r.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"?typeof o.z=="number"?[o.x,o.y,o.z].concat(e.slice(3)):[o.x,o.y,e[2]].concat(e.slice(3)):[o.x,o.y].concat(e.slice(2)):[o.x,o.y]):(s=Wy(r,i,e,n),l=Object.keys(e),l.length===2||l.forEach(function(h){if(typeof r.name<"u"&&r.name==="geocent"||typeof i.name<"u"&&i.name==="geocent"){if(h==="x"||h==="y"||h==="z")return}else if(h==="x"||h==="y")return;s[h]=e[h]}),s)}function SE(r){return r instanceof Gp?r:typeof r=="object"&&"oProj"in r?r.oProj:Gp(r)}function L0e(r,i,e){var n,o,s=!1,l;return typeof i>"u"?(o=SE(r),n=uX,s=!0):(typeof i.x<"u"||Array.isArray(i))&&(e=i,o=SE(r),n=uX,s=!0),n||(n=SE(r)),o||(o=SE(i)),e?p6(n,o,e):(l={forward:function(h,p){return p6(n,o,h,p)},inverse:function(h,p){return p6(o,n,h,p)}},s&&(l.oProj=o),l)}var dX=L0e;var hX=6,mX="AJSAJS",fX="AFAFAF",Vb=65,Sd=73,tp=79,A2=86,M2=90,gX={forward:f6,inverse:k0e,toPoint:g6};function f6(r,i){return i=i||5,R0e(O0e({lat:r[1],lon:r[0]}),i)}function k0e(r){var i=_6(yX(r.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat,i.lon,i.lat]:[i.left,i.bottom,i.right,i.top]}function g6(r){var i=_6(yX(r.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat]:[(i.left+i.right)/2,(i.top+i.bottom)/2]}function m6(r){return r*(Math.PI/180)}function pX(r){return 180*(r/Math.PI)}function O0e(r){var i=r.lat,e=r.lon,n=6378137,o=.00669438,s=.9996,l,h,p,m,f,g,y,_=m6(i),w=m6(e),A,k;k=Math.floor((e+180)/6)+1,e===180&&(k=60),i>=56&&i<64&&e>=3&&e<12&&(k=32),i>=72&&i<84&&(e>=0&&e<9?k=31:e>=9&&e<21?k=33:e>=21&&e<33?k=35:e>=33&&e<42&&(k=37)),l=(k-1)*6-180+3,A=m6(l),h=o/(1-o),p=n/Math.sqrt(1-o*Math.sin(_)*Math.sin(_)),m=Math.tan(_)*Math.tan(_),f=h*Math.cos(_)*Math.cos(_),g=Math.cos(_)*(w-A),y=n*((1-o/4-3*o*o/64-5*o*o*o/256)*_-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*_)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*_)-35*o*o*o/3072*Math.sin(6*_));var R=s*p*(g+(1-m+f)*g*g*g/6+(5-18*m+m*m+72*f-58*h)*g*g*g*g*g/120)+5e5,q=s*(y+p*Math.tan(_)*(g*g/2+(5-m+9*f+4*f*f)*g*g*g*g/24+(61-58*m+m*m+600*f-330*h)*g*g*g*g*g*g/720));return i<0&&(q+=1e7),{northing:Math.round(q),easting:Math.round(R),zoneNumber:k,zoneLetter:D0e(i)}}function _6(r){var i=r.northing,e=r.easting,n=r.zoneLetter,o=r.zoneNumber;if(o<0||o>60)return null;var s=.9996,l=6378137,h=.00669438,p,m=(1-Math.sqrt(1-h))/(1+Math.sqrt(1-h)),f,g,y,_,w,A,k,R,q,X=e-5e5,ie=i;n<"N"&&(ie-=1e7),k=(o-1)*6-180+3,p=h/(1-h),A=ie/s,R=A/(l*(1-h/4-3*h*h/64-5*h*h*h/256)),q=R+(3*m/2-27*m*m*m/32)*Math.sin(2*R)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*R)+151*m*m*m/96*Math.sin(6*R),f=l/Math.sqrt(1-h*Math.sin(q)*Math.sin(q)),g=Math.tan(q)*Math.tan(q),y=p*Math.cos(q)*Math.cos(q),_=l*(1-h)/Math.pow(1-h*Math.sin(q)*Math.sin(q),1.5),w=X/(f*s);var ae=q-f*Math.tan(q)/_*(w*w/2-(5+3*g+10*y-4*y*y-9*p)*w*w*w*w/24+(61+90*g+298*y+45*g*g-252*p-3*y*y)*w*w*w*w*w*w/720);ae=pX(ae);var be=(w-(1+2*g+y)*w*w*w/6+(5-2*y+28*g-3*y*y+8*p+24*g*g)*w*w*w*w*w/120)/Math.cos(q);be=k+pX(be);var me;if(r.accuracy){var fe=_6({northing:r.northing+r.accuracy,easting:r.easting+r.accuracy,zoneLetter:r.zoneLetter,zoneNumber:r.zoneNumber});me={top:fe.lat,right:fe.lon,bottom:ae,left:be}}else me={lat:ae,lon:be};return me}function D0e(r){var i="Z";return 84>=r&&r>=72?i="X":72>r&&r>=64?i="W":64>r&&r>=56?i="V":56>r&&r>=48?i="U":48>r&&r>=40?i="T":40>r&&r>=32?i="S":32>r&&r>=24?i="R":24>r&&r>=16?i="Q":16>r&&r>=8?i="P":8>r&&r>=0?i="N":0>r&&r>=-8?i="M":-8>r&&r>=-16?i="L":-16>r&&r>=-24?i="K":-24>r&&r>=-32?i="J":-32>r&&r>=-40?i="H":-40>r&&r>=-48?i="G":-48>r&&r>=-56?i="F":-56>r&&r>=-64?i="E":-64>r&&r>=-72?i="D":-72>r&&r>=-80&&(i="C"),i}function R0e(r,i){var e="00000"+r.easting,n="00000"+r.northing;return r.zoneNumber+r.zoneLetter+N0e(r.easting,r.northing,r.zoneNumber)+e.substr(e.length-5,i)+n.substr(n.length-5,i)}function N0e(r,i,e){var n=_X(e),o=Math.floor(r/1e5),s=Math.floor(i/1e5)%20;return B0e(o,s,n)}function _X(r){var i=r%hX;return i===0&&(i=hX),i}function B0e(r,i,e){var n=e-1,o=mX.charCodeAt(n),s=fX.charCodeAt(n),l=o+r-1,h=s+i,p=!1;l>M2&&(l=l-M2+Vb-1,p=!0),(l===Sd||o<Sd&&l>Sd||(l>Sd||o<Sd)&&p)&&l++,(l===tp||o<tp&&l>tp||(l>tp||o<tp)&&p)&&(l++,l===Sd&&l++),l>M2&&(l=l-M2+Vb-1),h>A2?(h=h-A2+Vb-1,p=!0):p=!1,(h===Sd||s<Sd&&h>Sd||(h>Sd||s<Sd)&&p)&&h++,(h===tp||s<tp&&h>tp||(h>tp||s<tp)&&p)&&(h++,h===Sd&&h++),h>A2&&(h=h-A2+Vb-1);var m=String.fromCharCode(l)+String.fromCharCode(h);return m}function yX(r){if(r&&r.length===0)throw"MGRSPoint coverting from nothing";for(var i=r.length,e=null,n="",o,s=0;!/[A-Z]/.test(o=r.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+r;n+=o,s++}var l=parseInt(n,10);if(s===0||s+3>i)throw"MGRSPoint bad conversion from: "+r;var h=r.charAt(s++);if(h<="A"||h==="B"||h==="Y"||h>="Z"||h==="I"||h==="O")throw"MGRSPoint zone letter "+h+" not handled: "+r;e=r.substring(s,s+=2);for(var p=_X(l),m=G0e(e.charAt(0),p),f=j0e(e.charAt(1),p);f<V0e(h);)f+=2e6;var g=i-s;if(g%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+r;var y=g/2,_=0,w=0,A,k,R,q,X;return y>0&&(A=1e5/Math.pow(10,y),k=r.substring(s,s+y),_=parseFloat(k)*A,R=r.substring(s+y),w=parseFloat(R)*A),q=_+m,X=w+f,{easting:q,northing:X,zoneLetter:h,zoneNumber:l,accuracy:A}}function G0e(r,i){for(var e=mX.charCodeAt(i-1),n=1e5,o=!1;e!==r.charCodeAt(0);){if(e++,e===Sd&&e++,e===tp&&e++,e>M2){if(o)throw"Bad character: "+r;e=Vb,o=!0}n+=1e5}return n}function j0e(r,i){if(r>"V")throw"MGRSPoint given invalid Northing "+r;for(var e=fX.charCodeAt(i-1),n=0,o=!1;e!==r.charCodeAt(0);){if(e++,e===Sd&&e++,e===tp&&e++,e>A2){if(o)throw"Bad character: "+r;e=Vb,o=!0}n+=1e5}return n}function V0e(r){var i;switch(r){case"C":i=11e5;break;case"D":i=2e6;break;case"E":i=28e5;break;case"F":i=37e5;break;case"G":i=46e5;break;case"H":i=55e5;break;case"J":i=64e5;break;case"K":i=73e5;break;case"L":i=82e5;break;case"M":i=91e5;break;case"N":i=0;break;case"P":i=8e5;break;case"Q":i=17e5;break;case"R":i=26e5;break;case"S":i=35e5;break;case"T":i=44e5;break;case"U":i=53e5;break;case"V":i=62e5;break;case"W":i=7e6;break;case"X":i=79e5;break;default:i=-1}if(i>=0)return i;throw"Invalid zone letter: "+r}function Ub(r,i,e){if(!(this instanceof Ub))return new Ub(r,i,e);if(Array.isArray(r))this.x=r[0],this.y=r[1],this.z=r[2]||0;else if(typeof r=="object")this.x=r.x,this.y=r.y,this.z=r.z||0;else if(typeof r=="string"&&typeof i>"u"){var n=r.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=r,this.y=i,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Ub.fromMGRS=function(r){return new Ub(g6(r))};Ub.prototype.toMGRS=function(r){return f6([this.x,this.y],r)};var vX=Ub;var U0e=1,z0e=.25,bX=.046875,wX=.01953125,xX=.01068115234375,$0e=.75,W0e=.46875,H0e=.013020833333333334,q0e=.007120768229166667,Y0e=.3645833333333333,Z0e=.005696614583333333,X0e=.3076171875;function zb(r){var i=[];i[0]=U0e-r*(z0e+r*(bX+r*(wX+r*xX))),i[1]=r*($0e-r*(bX+r*(wX+r*xX)));var e=r*r;return i[2]=e*(W0e-r*(H0e+r*q0e)),e*=r,i[3]=e*(Y0e-r*Z0e),i[4]=e*r*X0e,i}function rf(r,i,e,n){return e*=i,i*=i,n[0]*r-e*(n[1]+i*(n[2]+i*(n[3]+i*n[4])))}var K0e=20;function $b(r,i,e){for(var n=1/(1-i),o=r,s=K0e;s;--s){var l=Math.sin(o),h=1-i*l*l;if(h=(rf(o,l,Math.cos(o),e)-r)*(h*Math.sqrt(h))*n,o-=h,Math.abs(h)<Yt)return o}return o}function Q0e(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=zb(this.es),this.ml0=rf(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function J0e(r){var i=r.x,e=r.y,n=Zt(i-this.long0,this.over),o,s,l,h=Math.sin(e),p=Math.cos(e);if(this.es){var f=p*n,g=Math.pow(f,2),y=this.ep2*Math.pow(p,2),_=Math.pow(y,2),w=Math.abs(p)>Yt?Math.tan(e):0,A=Math.pow(w,2),k=Math.pow(A,2);o=1-this.es*Math.pow(h,2),f=f/Math.sqrt(o);var R=rf(e,h,p,this.en);s=this.a*(this.k0*f*(1+g/6*(1-A+y+g/20*(5-18*A+k+14*y-58*A*y+g/42*(61+179*k-k*A-479*A)))))+this.x0,l=this.a*(this.k0*(R-this.ml0+h*n*f/2*(1+g/12*(5-A+9*y+4*_+g/30*(61+k-58*A+270*y-330*A*y+g/56*(1385+543*k-k*A-3111*A))))))+this.y0}else{var m=p*Math.sin(n);if(Math.abs(Math.abs(m)-1)<Yt)return 93;if(s=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,l=p*Math.cos(n)/Math.sqrt(1-Math.pow(m,2)),m=Math.abs(l),m>=1){if(m-1>Yt)return 93;l=0}else l=Math.acos(l);e<0&&(l=-l),l=this.a*this.k0*(l-this.lat0)+this.y0}return r.x=s,r.y=l,r}function e_e(r){var i,e,n,o,s=(r.x-this.x0)*(1/this.a),l=(r.y-this.y0)*(1/this.a);if(this.es)if(i=this.ml0+l/this.k0,e=$b(i,this.es,this.en),Math.abs(e)<Ot){var g=Math.sin(e),y=Math.cos(e),_=Math.abs(y)>Yt?Math.tan(e):0,w=this.ep2*Math.pow(y,2),A=Math.pow(w,2),k=Math.pow(_,2),R=Math.pow(k,2);i=1-this.es*Math.pow(g,2);var q=s*Math.sqrt(i)/this.k0,X=Math.pow(q,2);i=i*_,n=e-i*X/(1-this.es)*.5*(1-X/12*(5+3*k-9*w*k+w-4*A-X/30*(61+90*k-252*w*k+45*R+46*w-X/56*(1385+3633*k+4095*R+1574*R*k)))),o=Zt(this.long0+q*(1-X/6*(1+2*k+w-X/20*(5+28*k+24*R+8*w*k+6*w-X/42*(61+662*k+1320*R+720*R*k))))/y,this.over)}else n=Ot*tf(l),o=0;else{var h=Math.exp(s/this.k0),p=.5*(h-1/h),m=this.lat0+l/this.k0,f=Math.cos(m);i=Math.sqrt((1-Math.pow(f,2))/(1+Math.pow(p,2))),n=Math.asin(i),l<0&&(n=-n),p===0&&f===0?o=0:o=Zt(Math.atan2(p,f)+this.long0,this.over)}return r.x=o,r.y=n,r}var t_e=["Fast_Transverse_Mercator","Fast Transverse Mercator"],Wb={init:Q0e,forward:J0e,inverse:e_e,names:t_e};function CE(r){var i=Math.exp(r);return i=(i-1/i)/2,i}function wl(r,i){r=Math.abs(r),i=Math.abs(i);var e=Math.max(r,i),n=Math.min(r,i)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function SX(r){var i=1+r,e=i-1;return e===0?r:r*Math.log(i)/e}function CX(r){var i=Math.abs(r);return i=SX(i*(1+i/(wl(1,i)+1))),r<0?-i:i}function AE(r,i){for(var e=2*Math.cos(2*i),n=r.length-1,o=r[n],s=0,l;--n>=0;)l=-s+e*o+r[n],s=o,o=l;return i+l*Math.sin(2*i)}function AX(r,i){for(var e=2*Math.cos(i),n=r.length-1,o=r[n],s=0,l;--n>=0;)l=-s+e*o+r[n],s=o,o=l;return Math.sin(i)*l}function MX(r){var i=Math.exp(r);return i=(i+1/i)/2,i}function y6(r,i,e){for(var n=Math.sin(i),o=Math.cos(i),s=CE(e),l=MX(e),h=2*o*l,p=-2*n*s,m=r.length-1,f=r[m],g=0,y=0,_=0,w,A;--m>=0;)w=y,A=g,y=f,g=_,f=-w+h*y-p*g+r[m],_=-A+p*y+h*g;return h=n*l,p=o*s,[h*f-p*_,h*_+p*f]}function i_e(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Wb.init.apply(this),this.forward=Wb.forward,this.inverse=Wb.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var r=this.es/(1+Math.sqrt(1-this.es)),i=r/(2-r),e=i;this.cgb[0]=i*(2+i*(-2/3+i*(-2+i*(116/45+i*(26/45+i*(-2854/675)))))),this.cbg[0]=i*(-2+i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))),e=e*i,this.cgb[1]=e*(7/3+i*(-8/5+i*(-227/45+i*(2704/315+i*(2323/945))))),this.cbg[1]=e*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),e=e*i,this.cgb[2]=e*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),this.cbg[2]=e*(-26/15+i*(34/21+i*(8/5+i*(-12686/2835)))),e=e*i,this.cgb[3]=e*(4279/630+i*(-332/35+i*(-399572/14175))),this.cbg[3]=e*(1237/630+i*(-12/5+i*(-24832/14175))),e=e*i,this.cgb[4]=e*(4174/315+i*(-144838/6237)),this.cbg[4]=e*(-734/315+i*(109598/31185)),e=e*i,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(i,2),this.Qn=this.k0/(1+i)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=i*(-.5+i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))),this.gtu[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),this.utg[1]=e*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),this.gtu[1]=e*(13/48+i*(-3/5+i*(557/1440+i*(281/630+i*(-1983433/1935360))))),e=e*i,this.utg[2]=e*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),this.gtu[2]=e*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),e=e*i,this.utg[3]=e*(-4397/161280+i*(11/504+i*(830251/7257600))),this.gtu[3]=e*(49561/161280+i*(-179/168+i*(6601661/7257600))),e=e*i,this.utg[4]=e*(-4583/161280+i*(108847/3991680)),this.gtu[4]=e*(34729/80640+i*(-3418889/1995840)),e=e*i,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=AE(this.cbg,this.lat0);this.Zb=-this.Qn*(n+AX(this.gtu,2*n))}function r_e(r){var i=Zt(r.x-this.long0,this.over),e=r.y;e=AE(this.cbg,e);var n=Math.sin(e),o=Math.cos(e),s=Math.sin(i),l=Math.cos(i);e=Math.atan2(n,l*o),i=Math.atan2(s*o,wl(n,o*l)),i=CX(Math.tan(i));var h=y6(this.gtu,2*e,2*i);e=e+h[0],i=i+h[1];var p,m;return Math.abs(i)<=2.623395162778?(p=this.a*(this.Qn*i)+this.x0,m=this.a*(this.Qn*e+this.Zb)+this.y0):(p=1/0,m=1/0),r.x=p,r.y=m,r}function n_e(r){var i=(r.x-this.x0)*(1/this.a),e=(r.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,i=i/this.Qn;var n,o;if(Math.abs(i)<=2.623395162778){var s=y6(this.utg,2*e,2*i);e=e+s[0],i=i+s[1],i=Math.atan(CE(i));var l=Math.sin(e),h=Math.cos(e),p=Math.sin(i),m=Math.cos(i);e=Math.atan2(l*m,wl(p,m*h)),i=Math.atan2(p,m*h),n=Zt(i+this.long0,this.over),o=AE(this.cgb,e)}else n=1/0,o=1/0;return r.x=n,r.y=o,r}var o_e=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"],Hb={init:i_e,forward:r_e,inverse:n_e,names:o_e};function IX(r,i){if(r===void 0){if(r=Math.floor((Zt(i)+Math.PI)*30/Math.PI)+1,r<0)return 0;if(r>60)return 60}return r}var a_e="etmerc";function s_e(){var r=IX(this.zone,this.long0);if(r===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(r)-183)*qo,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Hb.init.apply(this),this.forward=Hb.forward,this.inverse=Hb.inverse}var l_e=["Universal Transverse Mercator System","utm"],EX={init:s_e,names:l_e,dependsOn:a_e};function ME(r,i){return Math.pow((1-r)/(1+r),i)}var c_e=20;function u_e(){var r=Math.sin(this.lat0),i=Math.cos(this.lat0);i*=i,this.rc=Math.sqrt(1-this.es)/(1-this.es*r*r),this.C=Math.sqrt(1+this.es*i*i/(1-this.es)),this.phic0=Math.asin(r/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Yn)/(Math.pow(Math.tan(.5*this.lat0+Yn),this.C)*ME(this.e*r,this.ratexp))}function d_e(r){var i=r.x,e=r.y;return r.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+Yn),this.C)*ME(this.e*Math.sin(e),this.ratexp))-Ot,r.x=this.C*i,r}function h_e(r){for(var i=1e-14,e=r.x/this.C,n=r.y,o=Math.pow(Math.tan(.5*n+Yn)/this.K,1/this.C),s=c_e;s>0&&(n=2*Math.atan(o*ME(this.e*Math.sin(r.y),-.5*this.e))-Ot,!(Math.abs(n-r.y)<i));--s)r.y=n;return s?(r.x=e,r.y=n,r):null}var p_e=["gauss"],IE={init:u_e,forward:d_e,inverse:h_e,names:p_e};function m_e(){IE.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function f_e(r){var i,e,n,o;return r.x=Zt(r.x-this.long0,this.over),IE.forward.apply(this,[r]),i=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),o=this.k0*this.R2/(1+this.sinc0*i+this.cosc0*e*n),r.x=o*e*Math.sin(r.x),r.y=o*(this.cosc0*i-this.sinc0*e*n),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function g_e(r){var i,e,n,o,s;if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,s=wl(r.x,r.y)){var l=2*Math.atan2(s,this.R2);i=Math.sin(l),e=Math.cos(l),o=Math.asin(e*this.sinc0+r.y*i*this.cosc0/s),n=Math.atan2(r.x*i,s*this.cosc0*e-r.y*this.sinc0*i)}else o=this.phic0,n=0;return r.x=n,r.y=o,IE.inverse.apply(this,[r]),r.x=Zt(r.x+this.long0,this.over),r}var __e=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"],TX={init:m_e,forward:f_e,inverse:g_e,names:__e};function v6(r,i,e){return i*=e,Math.tan(.5*(Ot+r))*Math.pow((1-i)/(1+i),.5*e)}function y_e(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Yt&&(this.k0=.5*(1+tf(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Yt&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Yt&&Math.abs(Math.cos(this.lat_ts))>Yt&&(this.k0=.5*this.cons*cu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Nu(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=cu(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(v6(this.lat0,this.sinlat0,this.e))-Ot,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function v_e(r){var i=r.x,e=r.y,n=Math.sin(e),o=Math.cos(e),s,l,h,p,m,f,g=Zt(i-this.long0,this.over);return Math.abs(Math.abs(i-this.long0)-Math.PI)<=Yt&&Math.abs(e+this.lat0)<=Yt?(r.x=NaN,r.y=NaN,r):this.sphere?(s=2*this.k0/(1+this.sinlat0*n+this.coslat0*o*Math.cos(g)),r.x=this.a*s*o*Math.sin(g)+this.x0,r.y=this.a*s*(this.coslat0*n-this.sinlat0*o*Math.cos(g))+this.y0,r):(l=2*Math.atan(v6(e,n,this.e))-Ot,p=Math.cos(l),h=Math.sin(l),Math.abs(this.coslat0)<=Yt?(m=Nu(this.e,e*this.con,this.con*n),f=2*this.a*this.k0*m/this.cons,r.x=this.x0+f*Math.sin(i-this.long0),r.y=this.y0-this.con*f*Math.cos(i-this.long0),r):(Math.abs(this.sinlat0)<Yt?(s=2*this.a*this.k0/(1+p*Math.cos(g)),r.y=s*h):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*h+this.cosX0*p*Math.cos(g))),r.y=s*(this.cosX0*h-this.sinX0*p*Math.cos(g))+this.y0),r.x=s*p*Math.sin(g)+this.x0,r))}function b_e(r){r.x-=this.x0,r.y-=this.y0;var i,e,n,o,s,l=Math.sqrt(r.x*r.x+r.y*r.y);if(this.sphere){var h=2*Math.atan(l/(2*this.a*this.k0));return i=this.long0,e=this.lat0,l<=Yt?(r.x=i,r.y=e,r):(e=Math.asin(Math.cos(h)*this.sinlat0+r.y*Math.sin(h)*this.coslat0/l),Math.abs(this.coslat0)<Yt?this.lat0>0?i=Zt(this.long0+Math.atan2(r.x,-1*r.y),this.over):i=Zt(this.long0+Math.atan2(r.x,r.y),this.over):i=Zt(this.long0+Math.atan2(r.x*Math.sin(h),l*this.coslat0*Math.cos(h)-r.y*this.sinlat0*Math.sin(h)),this.over),r.x=i,r.y=e,r)}else if(Math.abs(this.coslat0)<=Yt){if(l<=Yt)return e=this.lat0,i=this.long0,r.x=i,r.y=e,r;r.x*=this.con,r.y*=this.con,n=l*this.cons/(2*this.a*this.k0),e=this.con*Ig(this.e,n),i=this.con*Zt(this.con*this.long0+Math.atan2(r.x,-1*r.y),this.over)}else o=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),i=this.long0,l<=Yt?s=this.X0:(s=Math.asin(Math.cos(o)*this.sinX0+r.y*Math.sin(o)*this.cosX0/l),i=Zt(this.long0+Math.atan2(r.x*Math.sin(o),l*this.cosX0*Math.cos(o)-r.y*this.sinX0*Math.sin(o)),this.over)),e=-1*Ig(this.e,Math.tan(.5*(Ot+s)));return r.x=i,r.y=e,r}var w_e=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"],FX={init:y_e,forward:v_e,inverse:b_e,names:w_e,ssfn_:v6};function x_e(){var r=this.lat0;this.lambda0=this.long0;var i=Math.sin(r),e=this.a,n=this.rf,o=1/n,s=2*o-Math.pow(o,2),l=this.e=Math.sqrt(s);this.R=this.k0*e*Math.sqrt(1-s)/(1-s*Math.pow(i,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(r),4)),this.b0=Math.asin(i/this.alpha);var h=Math.log(Math.tan(Math.PI/4+this.b0/2)),p=Math.log(Math.tan(Math.PI/4+r/2)),m=Math.log((1+l*i)/(1-l*i));this.K=h-this.alpha*p+this.alpha*l/2*m}function S_e(r){var i=Math.log(Math.tan(Math.PI/4-r.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(r.y))/(1-this.e*Math.sin(r.y))),n=-this.alpha*(i+e)+this.K,o=2*(Math.atan(Math.exp(n))-Math.PI/4),s=this.alpha*(r.x-this.lambda0),l=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(o)+Math.cos(this.b0)*Math.cos(s))),h=Math.asin(Math.cos(this.b0)*Math.sin(o)-Math.sin(this.b0)*Math.cos(o)*Math.cos(s));return r.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,r.x=this.R*l+this.x0,r}function C_e(r){for(var i=r.x-this.x0,e=r.y-this.y0,n=i/this.R,o=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(o)+Math.sin(this.b0)*Math.cos(o)*Math.cos(n)),l=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(o))),h=this.lambda0+l/this.alpha,p=0,m=s,f=-1e3,g=0;Math.abs(m-f)>1e-7;){if(++g>20)return;p=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(m))/2)),f=m,m=2*Math.atan(Math.exp(p))-Math.PI/2}return r.x=h,r.y=m,r}var A_e=["somerc"],PX={init:x_e,forward:S_e,inverse:C_e,names:A_e};var qb=1e-7;function M_e(r){var i=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof r.projName=="object"?Object.keys(r.projName)[0]:r.projName;return"no_uoff"in r||"no_off"in r||i.indexOf(e)!==-1||i.indexOf(s6(e))!==-1}function I_e(){var r,i,e,n,o,s,l,h,p,m,f=0,g,y=0,_=0,w=0,A=0,k=0,R=0;this.no_off=M_e(this),this.no_rot="no_rot"in this;var q=!1;"alpha"in this&&(q=!0);var X=!1;if("rectified_grid_angle"in this&&(X=!0),q&&(R=this.alpha),X&&(f=this.rectified_grid_angle),q||X)y=this.longc;else if(_=this.long1,A=this.lat1,w=this.long2,k=this.lat2,Math.abs(A-k)<=qb||(r=Math.abs(A))<=qb||Math.abs(r-Ot)<=qb||Math.abs(Math.abs(this.lat0)-Ot)<=qb||Math.abs(Math.abs(k)-Ot)<=qb)throw new Error;var ie=1-this.es;i=Math.sqrt(ie),Math.abs(this.lat0)>Yt?(h=Math.sin(this.lat0),e=Math.cos(this.lat0),r=1-this.es*h*h,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/ie),this.A=this.B*this.k0*i/r,n=this.B*i/(e*Math.sqrt(r)),o=n*n-1,o<=0?o=0:(o=Math.sqrt(o),this.lat0<0&&(o=-o)),this.E=o+=n,this.E*=Math.pow(Nu(this.e,this.lat0,h),this.B)):(this.B=1/i,this.A=this.k0,this.E=n=o=1),q||X?(q?(g=Math.asin(Math.sin(R)/n),X||(f=R)):(g=f,R=Math.asin(n*Math.sin(g))),this.lam0=y-Math.asin(.5*(o-1/o)*Math.tan(g))/this.B):(s=Math.pow(Nu(this.e,A,Math.sin(A)),this.B),l=Math.pow(Nu(this.e,k,Math.sin(k)),this.B),o=this.E/s,p=(l-s)/(l+s),m=this.E*this.E,m=(m-l*s)/(m+l*s),r=_-w,r<-Math.PI?w-=c_:r>Math.PI&&(w+=c_),this.lam0=Zt(.5*(_+w)-Math.atan(m*Math.tan(.5*this.B*(_-w))/p)/this.B,this.over),g=Math.atan(2*Math.sin(this.B*Zt(_-this.lam0,this.over))/(o-1/o)),f=R=Math.asin(n*Math.sin(g))),this.singam=Math.sin(g),this.cosgam=Math.cos(g),this.sinrot=Math.sin(f),this.cosrot=Math.cos(f),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(R))),this.lat0<0&&(this.u_0=-this.u_0)),o=.5*g,this.v_pole_n=this.ArB*Math.log(Math.tan(Yn-o)),this.v_pole_s=this.ArB*Math.log(Math.tan(Yn+o))}function E_e(r){var i={},e,n,o,s,l,h,p,m;if(r.x=r.x-this.lam0,Math.abs(Math.abs(r.y)-Ot)>Yt){if(l=this.E/Math.pow(Nu(this.e,r.y,Math.sin(r.y)),this.B),h=1/l,e=.5*(l-h),n=.5*(l+h),s=Math.sin(this.B*r.x),o=(e*this.singam-s*this.cosgam)/n,Math.abs(Math.abs(o)-1)<Yt)throw new Error;m=.5*this.ArB*Math.log((1-o)/(1+o)),h=Math.cos(this.B*r.x),Math.abs(h)<qb?p=this.A*r.x:p=this.ArB*Math.atan2(e*this.cosgam+s*this.singam,h)}else m=r.y>0?this.v_pole_n:this.v_pole_s,p=this.ArB*r.y;return this.no_rot?(i.x=p,i.y=m):(p-=this.u_0,i.x=m*this.cosrot+p*this.sinrot,i.y=p*this.cosrot-m*this.sinrot),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function T_e(r){var i,e,n,o,s,l,h,p={};if(r.x=(r.x-this.x0)*(1/this.a),r.y=(r.y-this.y0)*(1/this.a),this.no_rot?(e=r.y,i=r.x):(e=r.x*this.cosrot-r.y*this.sinrot,i=r.y*this.cosrot+r.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),o=.5*(n-1/n),s=.5*(n+1/n),l=Math.sin(this.BrA*i),h=(l*this.cosgam+o*this.singam)/s,Math.abs(Math.abs(h)-1)<Yt)p.x=0,p.y=h<0?-Ot:Ot;else{if(p.y=this.E/Math.sqrt((1+h)/(1-h)),p.y=Ig(this.e,Math.pow(p.y,1/this.B)),p.y===1/0)throw new Error;p.x=-this.rB*Math.atan2(o*this.cosgam-l*this.singam,Math.cos(this.BrA*i))}return p.x+=this.lam0,p}var F_e=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"],LX={init:I_e,forward:E_e,inverse:T_e,names:F_e};function P_e(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Yt)){var r=this.b/this.a;this.e=Math.sqrt(1-r*r);var i=Math.sin(this.lat1),e=Math.cos(this.lat1),n=cu(this.e,i,e),o=Nu(this.e,this.lat1,i),s=Math.sin(this.lat2),l=Math.cos(this.lat2),h=cu(this.e,s,l),p=Nu(this.e,this.lat2,s),m=Math.abs(Math.abs(this.lat0)-Ot)<Yt?0:Nu(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Yt?this.ns=Math.log(n/h)/Math.log(o/p):this.ns=i,isNaN(this.ns)&&(this.ns=i),this.f0=n/(this.ns*Math.pow(o,this.ns)),this.rh=this.a*this.f0*Math.pow(m,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function L_e(r){var i=r.x,e=r.y;Math.abs(2*Math.abs(e)-Math.PI)<=Yt&&(e=tf(e)*(Ot-2*Yt));var n=Math.abs(Math.abs(e)-Ot),o,s;if(n>Yt)o=Nu(this.e,e,Math.sin(e)),s=this.a*this.f0*Math.pow(o,this.ns);else{if(n=e*this.ns,n<=0)return null;s=0}var l=this.ns*Zt(i-this.long0,this.over);return r.x=this.k0*(s*Math.sin(l))+this.x0,r.y=this.k0*(this.rh-s*Math.cos(l))+this.y0,r}function k_e(r){var i,e,n,o,s,l=(r.x-this.x0)/this.k0,h=this.rh-(r.y-this.y0)/this.k0;this.ns>0?(i=Math.sqrt(l*l+h*h),e=1):(i=-Math.sqrt(l*l+h*h),e=-1);var p=0;if(i!==0&&(p=Math.atan2(e*l,e*h)),i!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(i/(this.a*this.f0),e),o=Ig(this.e,n),o===-9999)return null}else o=-Ot;return s=Zt(p/this.ns+this.long0,this.over),r.x=s,r.y=o,r}var O_e=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"],kX={init:P_e,forward:L_e,inverse:k_e,names:O_e};function D_e(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function R_e(r){var i,e,n,o,s,l,h,p=r.x,m=r.y,f=Zt(p-this.long0,this.over);return i=Math.pow((1+this.e*Math.sin(m))/(1-this.e*Math.sin(m)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(m/2+this.s45),this.alfa)/i)-this.s45),n=-f*this.alfa,o=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),s=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(o)),l=this.n*s,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(o/2+this.s45),this.n),r.y=h*Math.cos(l)/1,r.x=h*Math.sin(l)/1,this.czech||(r.y*=-1,r.x*=-1),r}function N_e(r){var i,e,n,o,s,l,h,p,m=r.x;r.x=r.y,r.y=m,this.czech||(r.y*=-1,r.x*=-1),l=Math.sqrt(r.x*r.x+r.y*r.y),s=Math.atan2(r.y,r.x),o=s/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/l,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),i=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(o)),e=Math.asin(Math.cos(n)*Math.sin(o)/Math.cos(i)),r.x=this.long0-e/this.alfa,h=i,p=0;var f=0;do r.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(i/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.e/2))-this.s45),Math.abs(h-r.y)<1e-10&&(p=1),h=r.y,f+=1;while(p===0&&f<15);return f>=15?null:r}var B_e=["Krovak","krovak"],OX={init:D_e,forward:R_e,inverse:N_e,names:B_e};function Zl(r,i,e,n,o){return r*o-i*Math.sin(2*o)+e*Math.sin(4*o)-n*Math.sin(6*o)}function Eg(r){return 1-.25*r*(1+r/16*(3+1.25*r))}function Tg(r){return .375*r*(1+.25*r*(1+.46875*r))}function Fg(r){return .05859375*r*r*(1+.75*r)}function Pg(r){return r*r*r*(35/3072)}function I2(r,i,e){var n=i*e;return r/Math.sqrt(1-n*n)}function Cd(r){return Math.abs(r)<Ot?r:r-tf(r)*Math.PI}function Hy(r,i,e,n,o){var s,l;s=r/i;for(var h=0;h<15;h++)if(l=(r-(i*s-e*Math.sin(2*s)+n*Math.sin(4*s)-o*Math.sin(6*s)))/(i-2*e*Math.cos(2*s)+4*n*Math.cos(4*s)-6*o*Math.cos(6*s)),s+=l,Math.abs(l)<=1e-10)return s;return NaN}function G_e(){this.sphere||(this.e0=Eg(this.es),this.e1=Tg(this.es),this.e2=Fg(this.es),this.e3=Pg(this.es),this.ml0=this.a*Zl(this.e0,this.e1,this.e2,this.e3,this.lat0))}function j_e(r){var i,e,n=r.x,o=r.y;if(n=Zt(n-this.long0,this.over),this.sphere)i=this.a*Math.asin(Math.cos(o)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(o),Math.cos(n))-this.lat0);else{var s=Math.sin(o),l=Math.cos(o),h=I2(this.a,this.e,s),p=Math.tan(o)*Math.tan(o),m=n*Math.cos(o),f=m*m,g=this.es*l*l/(1-this.es),y=this.a*Zl(this.e0,this.e1,this.e2,this.e3,o);i=h*m*(1-f*p*(1/6-(8-p+8*g)*f/120)),e=y-this.ml0+h*s/l*f*(.5+(5-p+6*g)*f/24)}return r.x=i+this.x0,r.y=e+this.y0,r}function V_e(r){r.x-=this.x0,r.y-=this.y0;var i=r.x/this.a,e=r.y/this.a,n,o;if(this.sphere){var s=e+this.lat0;n=Math.asin(Math.sin(s)*Math.cos(i)),o=Math.atan2(Math.tan(i),Math.cos(s))}else{var l=this.ml0/this.a+e,h=Hy(l,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(h)-Ot)<=Yt)return r.x=this.long0,r.y=Ot,e<0&&(r.y*=-1),r;var p=I2(this.a,this.e,Math.sin(h)),m=p*p*p/this.a/this.a*(1-this.es),f=Math.pow(Math.tan(h),2),g=i*this.a/p,y=g*g;n=h-p*Math.tan(h)/m*g*g*(.5-(1+3*f)*g*g/24),o=g*(1-y*(f/3+(1+3*f)*f*y/15))/Math.cos(h)}return r.x=Zt(o+this.long0,this.over),r.y=Cd(n),r}var U_e=["Cassini","Cassini_Soldner","cass"],DX={init:G_e,forward:j_e,inverse:V_e,names:U_e};function jp(r,i){var e;return r>1e-7?(e=r*i,(1-r*r)*(i/(1-e*e)-.5/r*Math.log((1-e)/(1+e)))):2*i}var b6=1,w6=2,x6=3,EE=4;function z_e(){var r=Math.abs(this.lat0);if(Math.abs(r-Ot)<Yt?this.mode=this.lat0<0?b6:w6:Math.abs(r)<Yt?this.mode=x6:this.mode=EE,this.es>0){var i;switch(this.qp=jp(this.e,1),this.mmf=.5/(1-this.es),this.apa=Q_e(this.es),this.mode){case w6:this.dd=1;break;case b6:this.dd=1;break;case x6:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case EE:this.rq=Math.sqrt(.5*this.qp),i=Math.sin(this.lat0),this.sinb1=jp(this.e,i)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*i*i)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===EE&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function $_e(r){var i,e,n,o,s,l,h,p,m,f,g=r.x,y=r.y;if(g=Zt(g-this.long0,this.over),this.sphere){if(s=Math.sin(y),f=Math.cos(y),n=Math.cos(g),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+f*n:1+this.sinph0*s+this.cosph0*f*n,e<=Yt)return null;e=Math.sqrt(2/e),i=e*f*Math.sin(g),e*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*f*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(y+this.lat0)<Yt)return null;e=Yn-y*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),i=e*Math.sin(g),e*=n}}else{switch(h=0,p=0,m=0,n=Math.cos(g),o=Math.sin(g),s=Math.sin(y),l=jp(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(h=l/this.qp,p=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:m=1+this.sinb1*h+this.cosb1*p*n;break;case this.EQUIT:m=1+p*n;break;case this.N_POLE:m=Ot+y,l=this.qp-l;break;case this.S_POLE:m=y-Ot,l=this.qp+l;break}if(Math.abs(m)<Yt)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),this.mode===this.OBLIQ?e=this.ymf*m*(this.cosb1*h-this.sinb1*p*n):e=(m=Math.sqrt(2/(1+p*n)))*h*this.ymf,i=this.xmf*m*p*o;break;case this.N_POLE:case this.S_POLE:l>=0?(i=(m=Math.sqrt(l))*o,e=n*(this.mode===this.S_POLE?m:-m)):i=e=0;break}}return r.x=this.a*i+this.x0,r.y=this.a*e+this.y0,r}function W_e(r){r.x-=this.x0,r.y-=this.y0;var i=r.x/this.a,e=r.y/this.a,n,o,s,l,h,p,m;if(this.sphere){var f=0,g,y=0;if(g=Math.sqrt(i*i+e*e),o=g*.5,o>1)return null;switch(o=2*Math.asin(o),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(y=Math.sin(o),f=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(g)<=Yt?0:Math.asin(e*y/g),i*=y,e=f*g;break;case this.OBLIQ:o=Math.abs(g)<=Yt?this.lat0:Math.asin(f*this.sinph0+e*y*this.cosph0/g),i*=y*this.cosph0,e=(f-Math.sin(o)*this.sinph0)*g;break;case this.N_POLE:e=-e,o=Ot-o;break;case this.S_POLE:o-=Ot;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(i,e)}else{if(m=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(i/=this.dd,e*=this.dd,p=Math.sqrt(i*i+e*e),p<Yt)return r.x=this.long0,r.y=this.lat0,r;l=2*Math.asin(.5*p/this.rq),s=Math.cos(l),i*=l=Math.sin(l),this.mode===this.OBLIQ?(m=s*this.sinb1+e*l*this.cosb1/p,h=this.qp*m,e=p*this.cosb1*s-e*this.sinb1*l):(m=e*l/p,h=this.qp*m,e=p*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),h=i*i+e*e,!h)return r.x=this.long0,r.y=this.lat0,r;m=1-h/this.qp,this.mode===this.S_POLE&&(m=-m)}n=Math.atan2(i,e),o=J_e(Math.asin(m),this.apa)}return r.x=Zt(this.long0+n,this.over),r.y=o,r}var H_e=.3333333333333333,q_e=.17222222222222222,Y_e=.10257936507936508,Z_e=.06388888888888888,X_e=.0664021164021164,K_e=.016415012942191543;function Q_e(r){var i,e=[];return e[0]=r*H_e,i=r*r,e[0]+=i*q_e,e[1]=i*Z_e,i*=r,e[0]+=i*Y_e,e[1]+=i*X_e,e[2]=i*K_e,e}function J_e(r,i){var e=r+r;return r+i[0]*Math.sin(e)+i[1]*Math.sin(e+e)+i[2]*Math.sin(e+e+e)}var eye=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],RX={init:z_e,forward:$_e,inverse:W_e,names:eye,S_POLE:b6,N_POLE:w6,EQUIT:x6,OBLIQ:EE};function Ad(r){return Math.abs(r)>1&&(r=r>1?1:-1),Math.asin(r)}function tye(){Math.abs(this.lat1+this.lat2)<Yt||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=cu(this.e3,this.sin_po,this.cos_po),this.qs1=jp(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=cu(this.e3,this.sin_po,this.cos_po),this.qs2=jp(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=jp(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>Yt?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function iye(r){var i=r.x,e=r.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=jp(this.e3,this.sin_phi),o=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*Zt(i-this.long0,this.over),l=o*Math.sin(s)+this.x0,h=this.rh-o*Math.cos(s)+this.y0;return r.x=l,r.y=h,r}function rye(r){var i,e,n,o,s,l;return r.x-=this.x0,r.y=this.rh-r.y+this.y0,this.ns0>=0?(i=Math.sqrt(r.x*r.x+r.y*r.y),n=1):(i=-Math.sqrt(r.x*r.x+r.y*r.y),n=-1),o=0,i!==0&&(o=Math.atan2(n*r.x,n*r.y)),n=i*this.ns0/this.a,this.sphere?l=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,l=this.phi1z(this.e3,e)),s=Zt(o/this.ns0+this.long0,this.over),r.x=s,r.y=l,r}function nye(r,i){var e,n,o,s,l,h=Ad(.5*i);if(r<Yt)return h;for(var p=r*r,m=1;m<=25;m++)if(e=Math.sin(h),n=Math.cos(h),o=r*e,s=1-o*o,l=.5*s*s/n*(i/(1-p)-e/s+.5/r*Math.log((1-o)/(1+o))),h=h+l,Math.abs(l)<=1e-7)return h;return null}var oye=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"],NX={init:tye,forward:iye,inverse:rye,names:oye,phi1z:nye};function aye(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function sye(r){var i,e,n,o,s,l,h,p,m=r.x,f=r.y;return n=Zt(m-this.long0,this.over),i=Math.sin(f),e=Math.cos(f),o=Math.cos(n),l=this.sin_p14*i+this.cos_p14*e*o,s=1,l>0||Math.abs(l)<=Yt?(h=this.x0+this.a*s*e*Math.sin(n)/l,p=this.y0+this.a*s*(this.cos_p14*i-this.sin_p14*e*o)/l):(h=this.x0+this.infinity_dist*e*Math.sin(n),p=this.y0+this.infinity_dist*(this.cos_p14*i-this.sin_p14*e*o)),r.x=h,r.y=p,r}function lye(r){var i,e,n,o,s,l;return r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,r.x/=this.k0,r.y/=this.k0,(i=Math.sqrt(r.x*r.x+r.y*r.y))?(o=Math.atan2(i,this.rc),e=Math.sin(o),n=Math.cos(o),l=Ad(n*this.sin_p14+r.y*e*this.cos_p14/i),s=Math.atan2(r.x*e,i*this.cos_p14*n-r.y*this.sin_p14*e),s=Zt(this.long0+s,this.over)):(l=this.phic0,s=0),r.x=s,r.y=l,r}var cye=["gnom"],BX={init:aye,forward:sye,inverse:lye,names:cye};function GX(r,i){var e=1-(1-r*r)/(2*r)*Math.log((1-r)/(1+r));if(Math.abs(Math.abs(i)-e)<1e-6)return i<0?-1*Ot:Ot;for(var n=Math.asin(.5*i),o,s,l,h,p=0;p<30;p++)if(s=Math.sin(n),l=Math.cos(n),h=r*s,o=Math.pow(1-h*h,2)/(2*l)*(i/(1-r*r)-s/(1-h*h)+.5/r*Math.log((1-h)/(1+h))),n+=o,Math.abs(o)<=1e-10)return n;return NaN}function uye(){this.sphere||(this.k0=cu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function dye(r){var i=r.x,e=r.y,n,o,s=Zt(i-this.long0,this.over);if(this.sphere)n=this.x0+this.a*s*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var l=jp(this.e,Math.sin(e));n=this.x0+this.a*this.k0*s,o=this.y0+this.a*l*.5/this.k0}return r.x=n,r.y=o,r}function hye(r){r.x-=this.x0,r.y-=this.y0;var i,e;return this.sphere?(i=Zt(this.long0+r.x/this.a/Math.cos(this.lat_ts),this.over),e=Math.asin(r.y/this.a*Math.cos(this.lat_ts))):(e=GX(this.e,2*r.y*this.k0/this.a),i=Zt(this.long0+r.x/(this.a*this.k0),this.over)),r.x=i,r.y=e,r}var pye=["cea"],jX={init:uye,forward:dye,inverse:hye,names:pye};function mye(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function fye(r){var i=r.x,e=r.y,n=Zt(i-this.long0,this.over),o=Cd(e-this.lat0);return r.x=this.x0+this.a*n*this.rc,r.y=this.y0+this.a*o,r}function gye(r){var i=r.x,e=r.y;return r.x=Zt(this.long0+(i-this.x0)/(this.a*this.rc),this.over),r.y=Cd(this.lat0+(e-this.y0)/this.a),r}var _ye=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"],VX={init:mye,forward:fye,inverse:gye,names:_ye};var UX=20;function yye(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Eg(this.es),this.e1=Tg(this.es),this.e2=Fg(this.es),this.e3=Pg(this.es),this.ml0=this.a*Zl(this.e0,this.e1,this.e2,this.e3,this.lat0)}function vye(r){var i=r.x,e=r.y,n,o,s,l=Zt(i-this.long0,this.over);if(s=l*Math.sin(e),this.sphere)Math.abs(e)<=Yt?(n=this.a*l,o=-1*this.a*this.lat0):(n=this.a*Math.sin(s)/Math.tan(e),o=this.a*(Cd(e-this.lat0)+(1-Math.cos(s))/Math.tan(e)));else if(Math.abs(e)<=Yt)n=this.a*l,o=-1*this.ml0;else{var h=I2(this.a,this.e,Math.sin(e))/Math.tan(e);n=h*Math.sin(s),o=this.a*Zl(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+h*(1-Math.cos(s))}return r.x=n+this.x0,r.y=o+this.y0,r}function bye(r){var i,e,n,o,s,l,h,p,m;if(n=r.x-this.x0,o=r.y-this.y0,this.sphere)if(Math.abs(o+this.a*this.lat0)<=Yt)i=Zt(n/this.a+this.long0,this.over),e=0;else{l=this.lat0+o/this.a,h=n*n/this.a/this.a+l*l,p=l;var f;for(s=UX;s;--s)if(f=Math.tan(p),m=-1*(l*(p*f+1)-p-.5*(p*p+h)*f)/((p-l)/f-1),p+=m,Math.abs(m)<=Yt){e=p;break}i=Zt(this.long0+Math.asin(n*Math.tan(p)/this.a)/Math.sin(e),this.over)}else if(Math.abs(o+this.ml0)<=Yt)e=0,i=Zt(this.long0+n/this.a,this.over);else{l=(this.ml0+o)/this.a,h=n*n/this.a/this.a+l*l,p=l;var g,y,_,w,A;for(s=UX;s;--s)if(A=this.e*Math.sin(p),g=Math.sqrt(1-A*A)*Math.tan(p),y=this.a*Zl(this.e0,this.e1,this.e2,this.e3,p),_=this.e0-2*this.e1*Math.cos(2*p)+4*this.e2*Math.cos(4*p)-6*this.e3*Math.cos(6*p),w=y/this.a,m=(l*(g*w+1)-w-.5*g*(w*w+h))/(this.es*Math.sin(2*p)*(w*w+h-2*l*w)/(4*g)+(l-w)*(g*_-2/Math.sin(2*p))-_),p-=m,Math.abs(m)<=Yt){e=p;break}g=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),i=Zt(this.long0+Math.asin(n*g/this.a)/Math.sin(e),this.over)}return r.x=i,r.y=e,r}var wye=["Polyconic","American_Polyconic","poly"],zX={init:yye,forward:vye,inverse:bye,names:wye};function xye(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function Sye(r){var i,e=r.x,n=r.y,o=n-this.lat0,s=e-this.long0,l=o/Uy*1e-5,h=s,p=1,m=0;for(i=1;i<=10;i++)p=p*l,m=m+this.A[i]*p;var f=m,g=h,y=1,_=0,w,A,k=0,R=0;for(i=1;i<=6;i++)w=y*f-_*g,A=_*f+y*g,y=w,_=A,k=k+this.B_re[i]*y-this.B_im[i]*_,R=R+this.B_im[i]*y+this.B_re[i]*_;return r.x=R*this.a+this.x0,r.y=k*this.a+this.y0,r}function Cye(r){var i,e=r.x,n=r.y,o=e-this.x0,s=n-this.y0,l=s/this.a,h=o/this.a,p=1,m=0,f,g,y=0,_=0;for(i=1;i<=6;i++)f=p*l-m*h,g=m*l+p*h,p=f,m=g,y=y+this.C_re[i]*p-this.C_im[i]*m,_=_+this.C_im[i]*p+this.C_re[i]*m;for(var w=0;w<this.iterations;w++){var A=y,k=_,R,q,X=l,ie=h;for(i=2;i<=6;i++)R=A*y-k*_,q=k*y+A*_,A=R,k=q,X=X+(i-1)*(this.B_re[i]*A-this.B_im[i]*k),ie=ie+(i-1)*(this.B_im[i]*A+this.B_re[i]*k);A=1,k=0;var ae=this.B_re[1],be=this.B_im[1];for(i=2;i<=6;i++)R=A*y-k*_,q=k*y+A*_,A=R,k=q,ae=ae+i*(this.B_re[i]*A-this.B_im[i]*k),be=be+i*(this.B_im[i]*A+this.B_re[i]*k);var me=ae*ae+be*be;y=(X*ae+ie*be)/me,_=(ie*ae-X*be)/me}var fe=y,ge=_,ue=1,se=0;for(i=1;i<=9;i++)ue=ue*fe,se=se+this.D[i]*ue;var te=this.lat0+se*Uy*1e5,Se=this.long0+ge;return r.x=Se,r.y=te,r}var Aye=["New_Zealand_Map_Grid","nzmg"],$X={init:xye,forward:Sye,inverse:Cye,names:Aye};function Mye(){}function Iye(r){var i=r.x,e=r.y,n=Zt(i-this.long0,this.over),o=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return r.x=o,r.y=s,r}function Eye(r){r.x-=this.x0,r.y-=this.y0;var i=Zt(this.long0+r.x/this.a,this.over),e=2.5*(Math.atan(Math.exp(.8*r.y/this.a))-Math.PI/4);return r.x=i,r.y=e,r}var Tye=["Miller_Cylindrical","mill"],WX={init:Mye,forward:Iye,inverse:Eye,names:Tye};var Fye=20;function Pye(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=zb(this.es)}function Lye(r){var i,e,n=r.x,o=r.y;if(n=Zt(n-this.long0,this.over),this.sphere){if(!this.m)o=this.n!==1?Math.asin(this.n*Math.sin(o)):o;else for(var s=this.n*Math.sin(o),l=Fye;l;--l){var h=(this.m*o+Math.sin(o)-s)/(this.m+Math.cos(o));if(o-=h,Math.abs(h)<Yt)break}i=this.a*this.C_x*n*(this.m+Math.cos(o)),e=this.a*this.C_y*o}else{var p=Math.sin(o),m=Math.cos(o);e=this.a*rf(o,p,m,this.en),i=this.a*n*m/Math.sqrt(1-this.es*p*p)}return r.x=i,r.y=e,r}function kye(r){var i,e,n,o;return r.x-=this.x0,n=r.x/this.a,r.y-=this.y0,i=r.y/this.a,this.sphere?(i/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(i))),this.m?i=Ad((this.m*i+Math.sin(i))/this.n):this.n!==1&&(i=Ad(Math.sin(i)/this.n)),n=Zt(n+this.long0,this.over),i=Cd(i)):(i=$b(r.y/this.a,this.es,this.en),o=Math.abs(i),o<Ot?(o=Math.sin(i),e=this.long0+r.x*Math.sqrt(1-this.es*o*o)/(this.a*Math.cos(i)),n=Zt(e,this.over)):o-Yt<Ot&&(n=this.long0)),r.x=n,r.y=i,r}var Oye=["Sinusoidal","sinu"],HX={init:Pye,forward:Lye,inverse:kye,names:Oye};function Dye(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0}function Rye(r){for(var i=r.x,e=r.y,n=Zt(i-this.long0,this.over),o=e,s=Math.PI*Math.sin(e);;){var l=-(o+Math.sin(o)-s)/(1+Math.cos(o));if(o+=l,Math.abs(l)<Yt)break}o/=2,Math.PI/2-Math.abs(e)<Yt&&(n=0);var h=.900316316158*this.a*n*Math.cos(o)+this.x0,p=1.4142135623731*this.a*Math.sin(o)+this.y0;return r.x=h,r.y=p,r}function Nye(r){var i,e;r.x-=this.x0,r.y-=this.y0,e=r.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),i=Math.asin(e);var n=Zt(this.long0+r.x/(.900316316158*this.a*Math.cos(i)),this.over);n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*i+Math.sin(2*i))/Math.PI,Math.abs(e)>1&&(e=1);var o=Math.asin(e);return r.x=n,r.y=o,r}var Bye=["Mollweide","moll"],qX={init:Dye,forward:Rye,inverse:Nye,names:Bye};function Gye(){Math.abs(this.lat1+this.lat2)<Yt||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Eg(this.es),this.e1=Tg(this.es),this.e2=Fg(this.es),this.e3=Pg(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=cu(this.e,this.sin_phi,this.cos_phi),this.ml1=Zl(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Yt?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=cu(this.e,this.sin_phi,this.cos_phi),this.ml2=Zl(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Zl(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function jye(r){var i=r.x,e=r.y,n;if(this.sphere)n=this.a*(this.g-e);else{var o=Zl(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-o)}var s=this.ns*Zt(i-this.long0,this.over),l=this.x0+n*Math.sin(s),h=this.y0+this.rh-n*Math.cos(s);return r.x=l,r.y=h,r}function Vye(r){r.x-=this.x0,r.y=this.rh-r.y+this.y0;var i,e,n,o;this.ns>=0?(e=Math.sqrt(r.x*r.x+r.y*r.y),i=1):(e=-Math.sqrt(r.x*r.x+r.y*r.y),i=-1);var s=0;if(e!==0&&(s=Math.atan2(i*r.x,i*r.y)),this.sphere)return o=Zt(this.long0+s/this.ns,this.over),n=Cd(this.g-e/this.a),r.x=o,r.y=n,r;var l=this.g-e/this.a;return n=Hy(l,this.e0,this.e1,this.e2,this.e3),o=Zt(this.long0+s/this.ns,this.over),r.x=o,r.y=n,r}var Uye=["Equidistant_Conic","eqdc"],YX={init:Gye,forward:jye,inverse:Vye,names:Uye};function zye(){this.R=this.a}function $ye(r){var i=r.x,e=r.y,n=Zt(i-this.long0,this.over),o,s;Math.abs(e)<=Yt&&(o=this.x0+this.R*n,s=this.y0);var l=Ad(2*Math.abs(e/Math.PI));(Math.abs(n)<=Yt||Math.abs(Math.abs(e)-Ot)<=Yt)&&(o=this.x0,e>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*l):s=this.y0+Math.PI*this.R*-Math.tan(.5*l));var h=.5*Math.abs(Math.PI/n-n/Math.PI),p=h*h,m=Math.sin(l),f=Math.cos(l),g=f/(m+f-1),y=g*g,_=g*(2/m-1),w=_*_,A=Math.PI*this.R*(h*(g-w)+Math.sqrt(p*(g-w)*(g-w)-(w+p)*(y-w)))/(w+p);n<0&&(A=-A),o=this.x0+A;var k=p+g;return A=Math.PI*this.R*(_*k-h*Math.sqrt((w+p)*(p+1)-k*k))/(w+p),e>=0?s=this.y0+A:s=this.y0-A,r.x=o,r.y=s,r}function Wye(r){var i,e,n,o,s,l,h,p,m,f,g,y,_;return r.x-=this.x0,r.y-=this.y0,g=Math.PI*this.R,n=r.x/g,o=r.y/g,s=n*n+o*o,l=-Math.abs(o)*(1+s),h=l-2*o*o+n*n,p=-2*l+1+2*o*o+s*s,_=o*o/p+(2*h*h*h/p/p/p-9*l*h/p/p)/27,m=(l-h*h/3/p)/p,f=2*Math.sqrt(-m/3),g=3*_/m/f,Math.abs(g)>1&&(g>=0?g=1:g=-1),y=Math.acos(g)/3,r.y>=0?e=(-f*Math.cos(y+Math.PI/3)-h/3/p)*Math.PI:e=-(-f*Math.cos(y+Math.PI/3)-h/3/p)*Math.PI,Math.abs(n)<Yt?i=this.long0:i=Zt(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(n*n-o*o)+s*s))/2/n,this.over),r.x=i,r.y=e,r}var Hye=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"],ZX={init:zye,forward:$ye,inverse:Wye,names:Hye};function XX(r,i,e,n,o,s){let l=n-i,h=Math.atan((1-s)*Math.tan(r)),p=Math.atan((1-s)*Math.tan(e)),m=Math.sin(h),f=Math.cos(h),g=Math.sin(p),y=Math.cos(p),_=l,w,A=100,k,R,q,X,ie,ae,be,me,fe,ge,ue,se,te,Se;do{if(k=Math.sin(_),R=Math.cos(_),q=Math.sqrt(y*k*(y*k)+(f*g-m*y*R)*(f*g-m*y*R)),q===0)return{azi1:0,s12:0};X=m*g+f*y*R,ie=Math.atan2(q,X),ae=f*y*k/q,be=1-ae*ae,me=be!==0?X-2*m*g/be:0,fe=s/16*be*(4+s*(4-3*be)),w=_,_=l+(1-fe)*s*ae*(ie+fe*q*(me+fe*X*(-1+2*me*me)))}while(Math.abs(_-w)>1e-12&&--A>0);return A===0?{azi1:NaN,s12:NaN}:(ge=be*(o*o-o*(1-s)*(o*(1-s)))/(o*(1-s)*(o*(1-s))),ue=1+ge/16384*(4096+ge*(-768+ge*(320-175*ge))),se=ge/1024*(256+ge*(-128+ge*(74-47*ge))),te=se*q*(me+se/4*(X*(-1+2*me*me)-se/6*me*(-3+4*q*q)*(-3+4*me*me))),Se=o*(1-s)*ue*(ie-te),{azi1:Math.atan2(y*k,f*g-m*y*R),s12:Se})}function KX(r,i,e,n,o,s){let l=Math.atan((1-s)*Math.tan(r)),h=Math.sin(l),p=Math.cos(l),m=Math.sin(e),f=Math.cos(e),g=Math.atan2(h,p*f),y=p*m,_=1-y*y,w=_*(o*o-o*(1-s)*(o*(1-s)))/(o*(1-s)*(o*(1-s))),A=1+w/16384*(4096+w*(-768+w*(320-175*w))),k=w/1024*(256+w*(-128+w*(74-47*w))),R=n/(o*(1-s)*A),q,X=100,ie,ae,be,me;do ie=Math.cos(2*g+R),ae=Math.sin(R),be=Math.cos(R),me=k*ae*(ie+k/4*(be*(-1+2*ie*ie)-k/6*ie*(-3+4*ae*ae)*(-3+4*ie*ie))),q=R,R=n/(o*(1-s)*A)+me;while(Math.abs(R-q)>1e-12&&--X>0);if(X===0)return{lat2:NaN,lon2:NaN};let fe=h*ae-p*be*f,ge=Math.atan2(h*be+p*ae*f,(1-s)*Math.sqrt(y*y+fe*fe)),ue=Math.atan2(ae*m,p*be-h*ae*f),se=s/16*_*(4+s*(4-3*_)),te=ue-(1-se)*s*y*(R+se*ae*(ie+se*be*(-1+2*ie*ie))),Se=i+te;return{lat2:ge,lon2:Se}}function qye(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function Yye(r){var i=r.x,e=r.y,n=Math.sin(r.y),o=Math.cos(r.y),s=Zt(i-this.long0,this.over),l,h,p,m,f,g,y,_,w,A,k;return this.sphere?Math.abs(this.sin_p12-1)<=Yt?(r.x=this.x0+this.a*(Ot-e)*Math.sin(s),r.y=this.y0-this.a*(Ot-e)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=Yt?(r.x=this.x0+this.a*(Ot+e)*Math.sin(s),r.y=this.y0+this.a*(Ot+e)*Math.cos(s),r):(w=this.sin_p12*n+this.cos_p12*o*Math.cos(s),y=Math.acos(w),_=y?y/Math.sin(y):1,r.x=this.x0+this.a*_*o*Math.sin(s),r.y=this.y0+this.a*_*(this.cos_p12*n-this.sin_p12*o*Math.cos(s)),r):(l=Eg(this.es),h=Tg(this.es),p=Fg(this.es),m=Pg(this.es),Math.abs(this.sin_p12-1)<=Yt?(f=this.a*Zl(l,h,p,m,Ot),g=this.a*Zl(l,h,p,m,e),r.x=this.x0+(f-g)*Math.sin(s),r.y=this.y0-(f-g)*Math.cos(s),r):Math.abs(this.sin_p12+1)<=Yt?(f=this.a*Zl(l,h,p,m,Ot),g=this.a*Zl(l,h,p,m,e),r.x=this.x0+(f+g)*Math.sin(s),r.y=this.y0+(f+g)*Math.cos(s),r):Math.abs(i)<Yt&&Math.abs(e-this.lat0)<Yt?(r.x=r.y=0,r):(A=XX(this.lat0,this.long0,e,i,this.a,this.f),k=A.azi1,r.x=A.s12*Math.sin(k),r.y=A.s12*Math.cos(k),r))}function Zye(r){r.x-=this.x0,r.y-=this.y0;var i,e,n,o,s,l,h,p,m,f,g,y,_,w,A,k;return this.sphere?(i=Math.sqrt(r.x*r.x+r.y*r.y),i>2*Ot*this.a?void 0:(e=i/this.a,n=Math.sin(e),o=Math.cos(e),s=this.long0,Math.abs(i)<=Yt?l=this.lat0:(l=Ad(o*this.sin_p12+r.y*n*this.cos_p12/i),h=Math.abs(this.lat0)-Ot,Math.abs(h)<=Yt?this.lat0>=0?s=Zt(this.long0+Math.atan2(r.x,-r.y),this.over):s=Zt(this.long0-Math.atan2(-r.x,r.y),this.over):s=Zt(this.long0+Math.atan2(r.x*n,i*this.cos_p12*o-r.y*this.sin_p12*n),this.over)),r.x=s,r.y=l,r)):(p=Eg(this.es),m=Tg(this.es),f=Fg(this.es),g=Pg(this.es),Math.abs(this.sin_p12-1)<=Yt?(y=this.a*Zl(p,m,f,g,Ot),i=Math.sqrt(r.x*r.x+r.y*r.y),_=y-i,l=Hy(_/this.a,p,m,f,g),s=Zt(this.long0+Math.atan2(r.x,-1*r.y),this.over),r.x=s,r.y=l,r):Math.abs(this.sin_p12+1)<=Yt?(y=this.a*Zl(p,m,f,g,Ot),i=Math.sqrt(r.x*r.x+r.y*r.y),_=i-y,l=Hy(_/this.a,p,m,f,g),s=Zt(this.long0+Math.atan2(r.x,r.y),this.over),r.x=s,r.y=l,r):(w=Math.atan2(r.x,r.y),A=Math.sqrt(r.x*r.x+r.y*r.y),k=KX(this.lat0,this.long0,w,A,this.a,this.f),r.x=k.lon2,r.y=k.lat2,r))}var Xye=["Azimuthal_Equidistant","aeqd"],QX={init:qye,forward:Yye,inverse:Zye,names:Xye};function Kye(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function Qye(r){var i,e,n,o,s,l,h,p,m=r.x,f=r.y;return n=Zt(m-this.long0,this.over),i=Math.sin(f),e=Math.cos(f),o=Math.cos(n),l=this.sin_p14*i+this.cos_p14*e*o,s=1,(l>0||Math.abs(l)<=Yt)&&(h=this.a*s*e*Math.sin(n),p=this.y0+this.a*s*(this.cos_p14*i-this.sin_p14*e*o)),r.x=h,r.y=p,r}function Jye(r){var i,e,n,o,s,l,h;return r.x-=this.x0,r.y-=this.y0,i=Math.sqrt(r.x*r.x+r.y*r.y),e=Ad(i/this.a),n=Math.sin(e),o=Math.cos(e),l=this.long0,Math.abs(i)<=Yt?(h=this.lat0,r.x=l,r.y=h,r):(h=Ad(o*this.sin_p14+r.y*n*this.cos_p14/i),s=Math.abs(this.lat0)-Ot,Math.abs(s)<=Yt?(this.lat0>=0?l=Zt(this.long0+Math.atan2(r.x,-r.y),this.over):l=Zt(this.long0-Math.atan2(-r.x,r.y),this.over),r.x=l,r.y=h,r):(l=Zt(this.long0+Math.atan2(r.x*n,i*this.cos_p14*o-r.y*this.sin_p14*n),this.over),r.x=l,r.y=h,r))}var e1e=["ortho"],JX={init:Kye,forward:Qye,inverse:Jye,names:e1e};var ws={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Lo={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function t1e(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Ot-Yn/2?this.face=ws.TOP:this.lat0<=-(Ot-Yn/2)?this.face=ws.BOTTOM:Math.abs(this.long0)<=Yn?this.face=ws.FRONT:Math.abs(this.long0)<=Ot+Yn?this.face=this.long0>0?ws.RIGHT:ws.LEFT:this.face=ws.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function i1e(r){var i={x:0,y:0},e,n,o,s,l,h,p={value:0};if(r.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(r.y)):e=r.y,n=r.x,this.face===ws.TOP)s=Ot-e,n>=Yn&&n<=Ot+Yn?(p.value=Lo.AREA_0,o=n-Ot):n>Ot+Yn||n<=-(Ot+Yn)?(p.value=Lo.AREA_1,o=n>0?n-bs:n+bs):n>-(Ot+Yn)&&n<=-Yn?(p.value=Lo.AREA_2,o=n+Ot):(p.value=Lo.AREA_3,o=n);else if(this.face===ws.BOTTOM)s=Ot+e,n>=Yn&&n<=Ot+Yn?(p.value=Lo.AREA_0,o=-n+Ot):n<Yn&&n>=-Yn?(p.value=Lo.AREA_1,o=-n):n<-Yn&&n>=-(Ot+Yn)?(p.value=Lo.AREA_2,o=-n-Ot):(p.value=Lo.AREA_3,o=n>0?-n+bs:-n-bs);else{var m,f,g,y,_,w,A;this.face===ws.RIGHT?n=Yb(n,+Ot):this.face===ws.BACK?n=Yb(n,+bs):this.face===ws.LEFT&&(n=Yb(n,-Ot)),y=Math.sin(e),_=Math.cos(e),w=Math.sin(n),A=Math.cos(n),m=_*A,f=_*w,g=y,this.face===ws.FRONT?(s=Math.acos(m),o=TE(s,g,f,p)):this.face===ws.RIGHT?(s=Math.acos(f),o=TE(s,g,-m,p)):this.face===ws.BACK?(s=Math.acos(-m),o=TE(s,g,-f,p)):this.face===ws.LEFT?(s=Math.acos(-f),o=TE(s,g,m,p)):(s=o=0,p.value=Lo.AREA_0)}return h=Math.atan(12/bs*(o+Math.acos(Math.sin(o)*Math.cos(Yn))-Ot)),l=Math.sqrt((1-Math.cos(s))/(Math.cos(h)*Math.cos(h))/(1-Math.cos(Math.atan(1/Math.cos(o))))),p.value===Lo.AREA_1?h+=Ot:p.value===Lo.AREA_2?h+=bs:p.value===Lo.AREA_3&&(h+=1.5*bs),i.x=l*Math.cos(h),i.y=l*Math.sin(h),i.x=i.x*this.a+this.x0,i.y=i.y*this.a+this.y0,r.x=i.x,r.y=i.y,r}function r1e(r){var i={lam:0,phi:0},e,n,o,s,l,h,p,m,f,g={value:0};if(r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a,n=Math.atan(Math.sqrt(r.x*r.x+r.y*r.y)),e=Math.atan2(r.y,r.x),r.x>=0&&r.x>=Math.abs(r.y)?g.value=Lo.AREA_0:r.y>=0&&r.y>=Math.abs(r.x)?(g.value=Lo.AREA_1,e-=Ot):r.x<0&&-r.x>=Math.abs(r.y)?(g.value=Lo.AREA_2,e=e<0?e+bs:e-bs):(g.value=Lo.AREA_3,e+=Ot),f=bs/12*Math.tan(e),l=Math.sin(f)/(Math.cos(f)-1/Math.sqrt(2)),h=Math.atan(l),o=Math.cos(e),s=Math.tan(n),p=1-o*o*s*s*(1-Math.cos(Math.atan(1/Math.cos(h)))),p<-1?p=-1:p>1&&(p=1),this.face===ws.TOP)m=Math.acos(p),i.phi=Ot-m,g.value===Lo.AREA_0?i.lam=h+Ot:g.value===Lo.AREA_1?i.lam=h<0?h+bs:h-bs:g.value===Lo.AREA_2?i.lam=h-Ot:i.lam=h;else if(this.face===ws.BOTTOM)m=Math.acos(p),i.phi=m-Ot,g.value===Lo.AREA_0?i.lam=-h+Ot:g.value===Lo.AREA_1?i.lam=-h:g.value===Lo.AREA_2?i.lam=-h-Ot:i.lam=h<0?-h-bs:-h+bs;else{var y,_,w;y=p,f=y*y,f>=1?w=0:w=Math.sqrt(1-f)*Math.sin(h),f+=w*w,f>=1?_=0:_=Math.sqrt(1-f),g.value===Lo.AREA_1?(f=_,_=-w,w=f):g.value===Lo.AREA_2?(_=-_,w=-w):g.value===Lo.AREA_3&&(f=_,_=w,w=-f),this.face===ws.RIGHT?(f=y,y=-_,_=f):this.face===ws.BACK?(y=-y,_=-_):this.face===ws.LEFT&&(f=y,y=_,_=-f),i.phi=Math.acos(-w)-Ot,i.lam=Math.atan2(_,y),this.face===ws.RIGHT?i.lam=Yb(i.lam,-Ot):this.face===ws.BACK?i.lam=Yb(i.lam,-bs):this.face===ws.LEFT&&(i.lam=Yb(i.lam,+Ot))}if(this.es!==0){var A,k,R;A=i.phi<0?1:0,k=Math.tan(i.phi),R=this.b/Math.sqrt(k*k+this.one_minus_f_squared),i.phi=Math.atan(Math.sqrt(this.a*this.a-R*R)/(this.one_minus_f*R)),A&&(i.phi=-i.phi)}return i.lam+=this.long0,r.x=i.lam,r.y=i.phi,r}function TE(r,i,e,n){var o;return r<Yt?(n.value=Lo.AREA_0,o=0):(o=Math.atan2(i,e),Math.abs(o)<=Yn?n.value=Lo.AREA_0:o>Yn&&o<=Ot+Yn?(n.value=Lo.AREA_1,o-=Ot):o>Ot+Yn||o<=-(Ot+Yn)?(n.value=Lo.AREA_2,o=o>=0?o-bs:o+bs):(n.value=Lo.AREA_3,o+=Ot)),o}function Yb(r,i){var e=r+i;return e<-bs?e+=c_:e>+bs&&(e-=c_),e}var n1e=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"],eK={init:t1e,forward:i1e,inverse:r1e,names:n1e};var S6=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],E2=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],tK=.8487,iK=1.3523,rK=Yl/5,o1e=1/rK,Zb=18,FE=function(r,i){return r[0]+i*(r[1]+i*(r[2]+i*r[3]))},a1e=function(r,i){return r[1]+i*(2*r[2]+i*3*r[3])};function s1e(r,i,e,n){for(var o=i;n;--n){var s=r(o);if(o-=s,Math.abs(s)<e)break}return o}function l1e(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function c1e(r){var i=Zt(r.x-this.long0,this.over),e=Math.abs(r.y),n=Math.floor(e*rK);n<0?n=0:n>=Zb&&(n=Zb-1),e=Yl*(e-o1e*n);var o={x:FE(S6[n],e)*i,y:FE(E2[n],e)};return r.y<0&&(o.y=-o.y),o.x=o.x*this.a*tK+this.x0,o.y=o.y*this.a*iK+this.y0,o}function u1e(r){var i={x:(r.x-this.x0)/(this.a*tK),y:Math.abs(r.y-this.y0)/(this.a*iK)};if(i.y>=1)i.x/=S6[Zb][0],i.y=r.y<0?-Ot:Ot;else{var e=Math.floor(i.y*Zb);for(e<0?e=0:e>=Zb&&(e=Zb-1);;)if(E2[e][0]>i.y)--e;else if(E2[e+1][0]<=i.y)++e;else break;var n=E2[e],o=5*(i.y-n[0])/(E2[e+1][0]-n[0]);o=s1e(function(s){return(FE(n,s)-i.y)/a1e(n,s)},o,Yt,100),i.x/=FE(S6[e],o),i.y=(5*e+o)*qo,r.y<0&&(i.y=-i.y)}return i.x=Zt(i.x+this.long0,this.over),i}var d1e=["Robinson","robin"],nK={init:l1e,forward:c1e,inverse:u1e,names:d1e};function h1e(){this.name="geocent"}function p1e(r){var i=vE(r,this.es,this.a);return i}function m1e(r){var i=bE(r,this.es,this.a,this.b);return i}var f1e=["Geocentric","geocentric","geocent","Geocent"],oK={init:h1e,forward:p1e,inverse:m1e,names:f1e};var uu={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},T2={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function g1e(){if(Object.keys(T2).forEach(function(e){if(typeof this[e]>"u")this[e]=T2[e].def;else{if(T2[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);T2[e].num&&(this[e]=parseFloat(this[e]))}T2[e].degrees&&(this[e]=this[e]*qo)}.bind(this)),Math.abs(Math.abs(this.lat0)-Ot)<Yt?this.mode=this.lat0<0?uu.S_POLE:uu.N_POLE:Math.abs(this.lat0)<Yt?this.mode=uu.EQUIT:(this.mode=uu.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var r=this.tilt,i=this.azi;this.cg=Math.cos(i),this.sg=Math.sin(i),this.cw=Math.cos(r),this.sw=Math.sin(r)}function _1e(r){r.x-=this.long0;var i=Math.sin(r.y),e=Math.cos(r.y),n=Math.cos(r.x),o,s;switch(this.mode){case uu.OBLIQ:s=this.sinph0*i+this.cosph0*e*n;break;case uu.EQUIT:s=e*n;break;case uu.S_POLE:s=-i;break;case uu.N_POLE:s=i;break}switch(s=this.pn1/(this.p-s),o=s*e*Math.sin(r.x),this.mode){case uu.OBLIQ:s*=this.cosph0*i-this.sinph0*e*n;break;case uu.EQUIT:s*=i;break;case uu.N_POLE:s*=-(e*n);break;case uu.S_POLE:s*=e*n;break}var l,h;return l=s*this.cg+o*this.sg,h=1/(l*this.sw*this.h1+this.cw),o=(o*this.cg-s*this.sg)*this.cw*h,s=l*h,r.x=o*this.a,r.y=s*this.a,r}function y1e(r){r.x/=this.a,r.y/=this.a;var i={x:r.x,y:r.y},e,n,o;o=1/(this.pn1-r.y*this.sw),e=this.pn1*r.x*o,n=this.pn1*r.y*this.cw*o,r.x=e*this.cg+n*this.sg,r.y=n*this.cg-e*this.sg;var s=wl(r.x,r.y);if(Math.abs(s)<Yt)i.x=0,i.y=r.y;else{var l,h;switch(h=1-s*s*this.pfact,h=(this.p-Math.sqrt(h))/(this.pn1/s+s/this.pn1),l=Math.sqrt(1-h*h),this.mode){case uu.OBLIQ:i.y=Math.asin(l*this.sinph0+r.y*h*this.cosph0/s),r.y=(l-this.sinph0*Math.sin(i.y))*s,r.x*=h*this.cosph0;break;case uu.EQUIT:i.y=Math.asin(r.y*h/s),r.y=l*s,r.x*=h;break;case uu.N_POLE:i.y=Math.asin(l),r.y=-r.y;break;case uu.S_POLE:i.y=-Math.asin(l);break}i.x=Math.atan2(r.x,r.y)}return r.x=i.x+this.long0,r.y=i.y,r}var v1e=["Tilted_Perspective","tpers"],aK={init:g1e,forward:_1e,inverse:y1e,names:v1e};function b1e(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var r=1-this.es,i=1/r;this.radius_p=Math.sqrt(r),this.radius_p2=r,this.radius_p_inv2=i,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function w1e(r){var i=r.x,e=r.y,n,o,s,l;if(i=i-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var h=this.radius_p/wl(this.radius_p*Math.cos(e),Math.sin(e));if(o=h*Math.cos(i)*Math.cos(e),s=h*Math.sin(i)*Math.cos(e),l=h*Math.sin(e),(this.radius_g-o)*o-s*s-l*l*this.radius_p_inv2<0)return r.x=Number.NaN,r.y=Number.NaN,r;n=this.radius_g-o,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/wl(l,n)),r.y=this.radius_g_1*Math.atan(l/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(l/wl(s,n)))}else this.shape==="sphere"&&(n=Math.cos(e),o=Math.cos(i)*n,s=Math.sin(i)*n,l=Math.sin(e),n=this.radius_g-o,this.flip_axis?(r.x=this.radius_g_1*Math.atan(s/wl(l,n)),r.y=this.radius_g_1*Math.atan(l/n)):(r.x=this.radius_g_1*Math.atan(s/n),r.y=this.radius_g_1*Math.atan(l/wl(s,n))));return r.x=r.x*this.a,r.y=r.y*this.a,r}function x1e(r){var i=-1,e=0,n=0,o,s,l,h;if(r.x=r.x/this.a,r.y=r.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*wl(1,n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*wl(1,e));var p=n/this.radius_p;if(o=e*e+p*p+i*i,s=2*this.radius_g*i,l=s*s-4*o*this.C,l<0)return r.x=Number.NaN,r.y=Number.NaN,r;h=(-s-Math.sqrt(l))/(2*o),i=this.radius_g+h*i,e*=h,n*=h,r.x=Math.atan2(e,i),r.y=Math.atan(n*Math.cos(r.x)/i),r.y=Math.atan(this.radius_p_inv2*Math.tan(r.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(r.y/this.radius_g_1),e=Math.tan(r.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(r.x/this.radius_g_1),n=Math.tan(r.y/this.radius_g_1)*Math.sqrt(1+e*e)),o=e*e+n*n+i*i,s=2*this.radius_g*i,l=s*s-4*o*this.C,l<0)return r.x=Number.NaN,r.y=Number.NaN,r;h=(-s-Math.sqrt(l))/(2*o),i=this.radius_g+h*i,e*=h,n*=h,r.x=Math.atan2(e,i),r.y=Math.atan(n*Math.cos(r.x)/i)}return r.x=r.x+this.long0,r}var S1e=["Geostationary Satellite View","Geostationary_Satellite","geos"],sK={init:b1e,forward:w1e,inverse:x1e,names:S1e};var F2=1.340264,P2=-.081106,L2=893e-6,k2=.003796,PE=Math.sqrt(3)/2;function C1e(){this.es=0,this.long0=this.long0!==void 0?this.long0:0,this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0}function A1e(r){var i=Zt(r.x-this.long0,this.over),e=r.y,n=Math.asin(PE*Math.sin(e)),o=n*n,s=o*o*o;return r.x=i*Math.cos(n)/(PE*(F2+3*P2*o+s*(7*L2+9*k2*o))),r.y=n*(F2+P2*o+s*(L2+k2*o)),r.x=this.a*r.x+this.x0,r.y=this.a*r.y+this.y0,r}function M1e(r){r.x=(r.x-this.x0)/this.a,r.y=(r.y-this.y0)/this.a;var i=1e-9,e=12,n=r.y,o,s,l,h,p,m;for(m=0;m<e&&(o=n*n,s=o*o*o,l=n*(F2+P2*o+s*(L2+k2*o))-r.y,h=F2+3*P2*o+s*(7*L2+9*k2*o),n-=p=l/h,!(Math.abs(p)<i));++m);return o=n*n,s=o*o*o,r.x=PE*r.x*(F2+3*P2*o+s*(7*L2+9*k2*o))/Math.cos(n),r.y=Math.asin(Math.sin(n)/PE),r.x=Zt(r.x+this.long0,this.over),r}var I1e=["eqearth","Equal Earth","Equal_Earth"],lK={init:C1e,forward:A1e,inverse:M1e,names:I1e};var O2=1e-10;function E1e(){var r;if(this.phi1=this.lat1,Math.abs(this.phi1)<O2)throw new Error;this.es?(this.en=zb(this.es),this.m1=rf(this.phi1,this.am1=Math.sin(this.phi1),r=Math.cos(this.phi1),this.en),this.am1=r/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=F1e,this.forward=T1e):(Math.abs(this.phi1)+O2>=Ot?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=L1e,this.forward=P1e)}function T1e(r){var i=Zt(r.x-(this.long0||0),this.over),e=r.y,n,o,s;return n=this.am1+this.m1-rf(e,o=Math.sin(e),s=Math.cos(e),this.en),o=s*i/(n*Math.sqrt(1-this.es*o*o)),r.x=n*Math.sin(o),r.y=this.am1-n*Math.cos(o),r.x=this.a*r.x+(this.x0||0),r.y=this.a*r.y+(this.y0||0),r}function F1e(r){r.x=(r.x-(this.x0||0))/this.a,r.y=(r.y-(this.y0||0))/this.a;var i,e,n,o;if(e=wl(r.x,r.y=this.am1-r.y),o=$b(this.am1+this.m1-e,this.es,this.en),(i=Math.abs(o))<Ot)i=Math.sin(o),n=e*Math.atan2(r.x,r.y)*Math.sqrt(1-this.es*i*i)/Math.cos(o);else if(Math.abs(i-Ot)<=O2)n=0;else throw new Error;return r.x=Zt(n+(this.long0||0),this.over),r.y=Cd(o),r}function P1e(r){var i=Zt(r.x-(this.long0||0),this.over),e=r.y,n,o;return o=this.cphi1+this.phi1-e,Math.abs(o)>O2?(r.x=o*Math.sin(n=i*Math.cos(e)/o),r.y=this.cphi1-o*Math.cos(n)):r.x=r.y=0,r.x=this.a*r.x+(this.x0||0),r.y=this.a*r.y+(this.y0||0),r}function L1e(r){r.x=(r.x-(this.x0||0))/this.a,r.y=(r.y-(this.y0||0))/this.a;var i,e,n=wl(r.x,r.y=this.cphi1-r.y);if(e=this.cphi1+this.phi1-n,Math.abs(e)>Ot)throw new Error;return Math.abs(Math.abs(e)-Ot)<=O2?i=0:i=n*Math.atan2(r.x,r.y)/Math.cos(e),r.x=Zt(i+(this.long0||0),this.over),r.y=Cd(e),r}var k1e=["bonne","Bonne (Werner lat_1=90)"],cK={init:E1e,names:k1e};var uK={OBLIQUE:{forward:B1e,inverse:j1e},TRANSVERSE:{forward:G1e,inverse:V1e}},LE={ROTATE:{o_alpha:"oAlpha",o_lon_c:"oLongC",o_lat_c:"oLatC"},NEW_POLE:{o_lat_p:"oLatP",o_lon_p:"oLongP"},NEW_EQUATOR:{o_lon_1:"oLong1",o_lat_1:"oLat1",o_lon_2:"oLong2",o_lat_2:"oLat2"}};function O1e(){if(this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.title=this.title||"General Oblique Transformation",this.isIdentity=a6.includes(this.o_proj),!this.o_proj)throw new Error("Missing parameter: o_proj");if(this.o_proj==="ob_tran")throw new Error("Invalid value for o_proj: "+this.o_proj);let r=this.projStr.replace("+proj=ob_tran","").replace("+o_proj=","+proj=").trim(),i=Gp(r);if(!i)throw new Error("Invalid parameter: o_proj. Unknown projection "+this.o_proj);i.long0=0,this.obliqueProjection=i;let e,n=Object.keys(LE),o=h=>{if(typeof this[h]>"u")return;let p=parseFloat(this[h])*qo;if(isNaN(p))throw new Error("Invalid value for "+h+": "+this[h]);return p};for(let h=0;h<n.length;h++){let p=n[h],m=LE[p],f=Object.entries(m);if(f.some(([y])=>typeof this[y]<"u")){e=m;for(let y=0;y<f.length;y++){let[_,w]=f[y],A=o(_);if(typeof A>"u")throw new Error("Missing parameter: "+_+".");this[w]=A}break}}if(!e)throw new Error("No valid parameters provided for ob_tran projection.");let{lamp:s,phip:l}=N1e(this,e);this.lamp=s,Math.abs(l)>Yt?(this.cphip=Math.cos(l),this.sphip=Math.sin(l),this.projectionType=uK.OBLIQUE):this.projectionType=uK.TRANSVERSE}function D1e(r){return this.projectionType.forward(this,r)}function R1e(r){return this.projectionType.inverse(this,r)}function N1e(r,i){let e,n;if(i===LE.ROTATE){let o=r.oLongC,s=r.oLatC,l=r.oAlpha;if(Math.abs(Math.abs(s)-Ot)<=Yt)throw new Error("Invalid value for o_lat_c: "+r.o_lat_c+" should be < 90\xB0");n=o+Math.atan2(-1*Math.cos(l),-1*Math.sin(l)*Math.sin(s)),e=Math.asin(Math.cos(s)*Math.sin(l))}else if(i===LE.NEW_POLE)n=r.oLongP,e=r.oLatP;else{let o=r.oLong1,s=r.oLat1,l=r.oLong2,h=r.oLat2,p=Math.abs(s);if(Math.abs(s)>Ot-Yt)throw new Error("Invalid value for o_lat_1: "+r.o_lat_1+" should be < 90\xB0");if(Math.abs(h)>Ot-Yt)throw new Error("Invalid value for o_lat_2: "+r.o_lat_2+" should be < 90\xB0");if(Math.abs(s-h)<Yt)throw new Error("Invalid value for o_lat_1 and o_lat_2: o_lat_1 should be different from o_lat_2");if(p<Yt)throw new Error("Invalid value for o_lat_1: o_lat_1 should be different from zero");n=Math.atan2(Math.cos(s)*Math.sin(h)*Math.cos(o)-Math.sin(s)*Math.cos(h)*Math.cos(l),Math.sin(s)*Math.cos(h)*Math.sin(l)-Math.cos(s)*Math.sin(h)*Math.sin(o)),e=Math.atan(-1*Math.cos(n-o)/Math.tan(s))}return{lamp:n,phip:e}}function B1e(r,i){let{x:e,y:n}=i;e+=r.long0;let o=Math.cos(e),s=Math.sin(n),l=Math.cos(n);i.x=Zt(Math.atan2(l*Math.sin(e),r.sphip*l*o+r.cphip*s)+r.lamp),i.y=Math.asin(r.sphip*s-r.cphip*l*o);let h=r.obliqueProjection.forward(i);return r.isIdentity&&(h.x*=Yl,h.y*=Yl),h}function G1e(r,i){let{x:e,y:n}=i;e+=r.long0;let o=Math.cos(n),s=Math.cos(e);i.x=Zt(Math.atan2(o*Math.sin(e),Math.sin(n))+r.lamp),i.y=Math.asin(-1*o*s);let l=r.obliqueProjection.forward(i);return r.isIdentity&&(l.x*=Yl,l.y*=Yl),l}function j1e(r,i){r.isIdentity&&(i.x*=qo,i.y*=qo);let e=r.obliqueProjection.inverse(i),{x:n,y:o}=e;if(n<Number.MAX_VALUE){n-=r.lamp;let s=Math.cos(n),l=Math.sin(o),h=Math.cos(o);i.x=Math.atan2(h*Math.sin(n),r.sphip*h*s-r.cphip*l),i.y=Math.asin(r.sphip*l+r.cphip*h*s)}return i.x=Zt(i.x+r.long0),i}function V1e(r,i){r.isIdentity&&(i.x*=qo,i.y*=qo);let e=r.obliqueProjection.inverse(i),{x:n,y:o}=e;if(n<Number.MAX_VALUE){let s=Math.cos(o);n-=r.lamp,i.x=Math.atan2(s*Math.sin(n),-1*Math.sin(o)),i.y=Math.asin(s*Math.cos(n))}return i.x=Zt(i.x+r.long0),i}var U1e=["General Oblique Transformation","General_Oblique_Transformation","ob_tran"],dK={init:O1e,forward:D1e,inverse:R1e,names:U1e};function hK(r){r.Proj.projections.add(Wb),r.Proj.projections.add(Hb),r.Proj.projections.add(EX),r.Proj.projections.add(TX),r.Proj.projections.add(FX),r.Proj.projections.add(PX),r.Proj.projections.add(LX),r.Proj.projections.add(kX),r.Proj.projections.add(OX),r.Proj.projections.add(DX),r.Proj.projections.add(RX),r.Proj.projections.add(NX),r.Proj.projections.add(BX),r.Proj.projections.add(jX),r.Proj.projections.add(VX),r.Proj.projections.add(zX),r.Proj.projections.add($X),r.Proj.projections.add(WX),r.Proj.projections.add(HX),r.Proj.projections.add(qX),r.Proj.projections.add(YX),r.Proj.projections.add(ZX),r.Proj.projections.add(QX),r.Proj.projections.add(JX),r.Proj.projections.add(eK),r.Proj.projections.add(nK),r.Proj.projections.add(oK),r.Proj.projections.add(aK),r.Proj.projections.add(sK),r.Proj.projections.add(lK),r.Proj.projections.add(cK),r.Proj.projections.add(dK)}var pK=Object.assign(dX,{defaultDatum:"WGS84",Proj:Gp,WGS84:new Gp("WGS84"),Point:vX,toPoint:xE,defs:Bb,nadgrid:d6,transform:Wy,mgrs:gX,version:"__VERSION__"});hK(pK);var D2=pK;var z1e=0,mK="mat-badge-content",C6=new Set,$1e=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=nt({type:r,selectors:[["ng-component"]],standalone:!0,features:[lt],decls:0,vars:0,template:function(n,o){},styles:[".mat-badge{position:relative}.mat-badge.mat-badge{overflow:visible}.mat-badge-content{position:absolute;text-align:center;display:inline-block;transition:transform 200ms ease-in-out;transform:scale(0.6);overflow:hidden;white-space:nowrap;text-overflow:ellipsis;box-sizing:border-box;pointer-events:none;background-color:var(--mat-badge-background-color, var(--mat-app-error));color:var(--mat-badge-text-color, var(--mat-app-on-error));font-family:var(--mat-badge-text-font, var(--mat-app-label-small-font));font-weight:var(--mat-badge-text-weight, var(--mat-app-label-small-weight));border-radius:var(--mat-badge-container-shape, var(--mat-app-corner-full))}.cdk-high-contrast-active .mat-badge-content{outline:solid 1px;border-radius:0}.mat-badge-above .mat-badge-content{bottom:100%}.mat-badge-below .mat-badge-content{top:100%}.mat-badge-before .mat-badge-content{right:100%}[dir=rtl] .mat-badge-before .mat-badge-content{right:auto;left:100%}.mat-badge-after .mat-badge-content{left:100%}[dir=rtl] .mat-badge-after .mat-badge-content{left:auto;right:100%}.mat-badge-disabled .mat-badge-content{background-color:var(--mat-badge-disabled-state-background-color);color:var(--mat-badge-disabled-state-text-color, var(--mat-app-on-error))}.mat-badge-hidden .mat-badge-content{display:none}.ng-animate-disabled .mat-badge-content,.mat-badge-content._mat-animation-noopable{transition:none}.mat-badge-content.mat-badge-active{transform:none}.mat-badge-small .mat-badge-content{width:var(--mat-badge-legacy-small-size-container-size);height:var(--mat-badge-legacy-small-size-container-size);min-width:var(--mat-badge-small-size-container-size);min-height:var(--mat-badge-small-size-container-size);line-height:var(--mat-badge-small-size-line-height);padding:var(--mat-badge-small-size-container-padding);font-size:var(--mat-badge-small-size-text-size);margin:var(--mat-badge-small-size-container-offset)}.mat-badge-small.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-small-size-container-overlap-offset)}.mat-badge-medium .mat-badge-content{width:var(--mat-badge-legacy-container-size);height:var(--mat-badge-legacy-container-size);min-width:var(--mat-badge-container-size);min-height:var(--mat-badge-container-size);line-height:var(--mat-badge-line-height);padding:var(--mat-badge-container-padding);font-size:var(--mat-badge-text-size, var(--mat-app-label-small-size));margin:var(--mat-badge-container-offset)}.mat-badge-medium.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-container-overlap-offset)}.mat-badge-large .mat-badge-content{width:var(--mat-badge-legacy-large-size-container-size);height:var(--mat-badge-legacy-large-size-container-size);min-width:var(--mat-badge-large-size-container-size);min-height:var(--mat-badge-large-size-container-size);line-height:var(--mat-badge-large-size-line-height);padding:var(--mat-badge-large-size-container-padding);font-size:var(--mat-badge-large-size-text-size, var(--mat-app-label-small-size));margin:var(--mat-badge-large-size-container-offset)}.mat-badge-large.mat-badge-overlap .mat-badge-content{margin:var(--mat-badge-large-size-container-overlap-offset)}"],encapsulation:2,changeDetection:0})}}return r})(),Md=(()=>{class r{get color(){return this._color}set color(e){this._setColor(e),this._color=e}get content(){return this._content}set content(e){this._updateRenderedContent(e)}get description(){return this._description}set description(e){this._updateDescription(e)}constructor(e,n,o,s,l){this._ngZone=e,this._elementRef=n,this._ariaDescriber=o,this._renderer=s,this._animationMode=l,this._color="primary",this.overlap=!0,this.position="above after",this.size="medium",this._id=z1e++,this._isInitialized=!1,this._interactivityChecker=ga(G7),this._document=ga(rc);let h=ga(I1);if(!C6.has(h)){C6.add(h);let p=IA($1e,{environmentInjector:ga(AA)});h.onDestroy(()=>{C6.delete(h),p.destroy()})}}isAbove(){return this.position.indexOf("below")===-1}isAfter(){return this.position.indexOf("before")===-1}getBadgeElement(){return this._badgeElement}ngOnInit(){this._clearExistingBadges(),this.content&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement(),this._updateRenderedContent(this.content)),this._isInitialized=!0}ngOnDestroy(){this._renderer.destroyNode&&(this._renderer.destroyNode(this._badgeElement),this._inlineBadgeDescription?.remove()),this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description)}_isHostInteractive(){return this._interactivityChecker.isFocusable(this._elementRef.nativeElement,{ignoreVisibility:!0})}_createBadgeElement(){let e=this._renderer.createElement("span"),n="mat-badge-active";return e.setAttribute("id",`mat-badge-content-${this._id}`),e.setAttribute("aria-hidden","true"),e.classList.add(mK),this._animationMode==="NoopAnimations"&&e.classList.add("_mat-animation-noopable"),this._elementRef.nativeElement.appendChild(e),typeof requestAnimationFrame=="function"&&this._animationMode!=="NoopAnimations"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{e.classList.add(n)})}):e.classList.add(n),e}_updateRenderedContent(e){let n=`${e??""}`.trim();this._isInitialized&&n&&!this._badgeElement&&(this._badgeElement=this._createBadgeElement()),this._badgeElement&&(this._badgeElement.textContent=n),this._content=n}_updateDescription(e){this._ariaDescriber.removeDescription(this._elementRef.nativeElement,this.description),(!e||this._isHostInteractive())&&this._removeInlineDescription(),this._description=e,this._isHostInteractive()?this._ariaDescriber.describe(this._elementRef.nativeElement,e):this._updateInlineDescription()}_updateInlineDescription(){this._inlineBadgeDescription||(this._inlineBadgeDescription=this._document.createElement("span"),this._inlineBadgeDescription.classList.add("cdk-visually-hidden")),this._inlineBadgeDescription.textContent=this.description,this._badgeElement?.appendChild(this._inlineBadgeDescription)}_removeInlineDescription(){this._inlineBadgeDescription?.remove(),this._inlineBadgeDescription=void 0}_setColor(e){let n=this._elementRef.nativeElement.classList;n.remove(`mat-badge-${this._color}`),e&&n.add(`mat-badge-${e}`)}_clearExistingBadges(){let e=this._elementRef.nativeElement.querySelectorAll(`:scope > .${mK}`);for(let n of Array.from(e))n!==this._badgeElement&&n.remove()}static{this.\u0275fac=function(n){return new(n||r)(Ie(tc),Ie(ar),Ie(N7),Ie(s0),Ie(Ah,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matBadge",""]],hostAttrs:[1,"mat-badge"],hostVars:20,hostBindings:function(n,o){n&2&&dr("mat-badge-overlap",o.overlap)("mat-badge-above",o.isAbove())("mat-badge-below",!o.isAbove())("mat-badge-before",!o.isAfter())("mat-badge-after",o.isAfter())("mat-badge-small",o.size==="small")("mat-badge-medium",o.size==="medium")("mat-badge-large",o.size==="large")("mat-badge-hidden",o.hidden||!o.content)("mat-badge-disabled",o.disabled)},inputs:{color:[0,"matBadgeColor","color"],overlap:[2,"matBadgeOverlap","overlap",Vi],disabled:[2,"matBadgeDisabled","disabled",Vi],position:[0,"matBadgePosition","position"],content:[0,"matBadge","content"],description:[0,"matBadgeDescription","description"],size:[0,"matBadgeSize","size"],hidden:[2,"matBadgeHidden","hidden",Vi]},standalone:!0,features:[$n]})}}return r})(),xl=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[LA,ul,ul]})}}return r})();var W1e=(r,i,e)=>({disabled:r,"out-of-range":i,"visibility-hidden":e}),H1e='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>eye-closed</title><path d="M12 17.5C8.2 17.5 4.8 15.4 3.2 12H1C2.7 16.4 7 19.5 12 19.5S21.3 16.4 23 12H20.8C19.2 15.4 15.8 17.5 12 17.5Z" /></svg>',R2=(()=>{class r{cdr;eyeClosedSvg={name:"eye-closed",svg:H1e};hiddenByParent;visible;layer;tooltip;disabled;showQueryBadge;inResolutionsRange;get defaultTooltip(){return this.layer.isInResolutionsRange?this.layer.visible&&this.disabled?"igo.geo.layer.group.hideChildren":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer":"igo.geo.layer.notInResolution"}visibilityChange=new Ke;constructor(e){this.cdr=e}ngOnInit(){this.layer.parent?.displayed$.subscribe(e=>{this.hiddenByParent=!e,this.cdr.markForCheck()}),this.layer.visible$.subscribe(e=>{this.visible=e,this.cdr.markForCheck()})}toggle(e){this.layer.visible=!this.layer.visible,this.visibilityChange.emit(e)}static \u0275fac=function(n){return new(n||r)(Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-visibility-button"]],inputs:{layer:"layer",tooltip:"tooltip",disabled:"disabled",showQueryBadge:"showQueryBadge",inResolutionsRange:"inResolutionsRange"},outputs:{visibilityChange:"visibilityChange"},standalone:!0,features:[lt],decls:3,vars:11,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","ngClass","color","matTooltip"],["matBadge","?","matBadgeColor","accent","matBadgeSize","small","matBadgePosition","after","iconPositionEnd","",3,"matBadgeHidden","icon"]],template:function(n,o){if(n&1&&($(0,"button",0),le(1,"translate"),ve("click",function(l){return o.toggle(l)}),ct(2,"igo-icon",1),ee()),n&2){let s;z("ngClass",E7(7,W1e,o.disabled,!o.inResolutionsRange,!o.visible))("color",o.visible?"primary":"default")("matTooltip",ce(1,5,(s=o.tooltip)!==null&&s!==void 0?s:o.defaultTooltip)),j(2),z("matBadgeHidden",!o.showQueryBadge)("icon",o.visible?o.hiddenByParent?o.eyeClosedSvg:"visibility":"visibility_off")}},dependencies:[_a,xl,Md,Vt,ci,jt,Qt,ti,Et,Tt,BA],styles:[`[_nghost-%COMP%]   .disabled.out-of-range[_ngcontent-%COMP%], [_nghost-%COMP%]   .visibility-hidden.out-of-range[_ngcontent-%COMP%]{opacity:.54}mat-icon[matBadge][_ngcontent-%COMP%]     .mat-badge-content{font-size:12px}
/*# sourceMappingURL=layer-visibility-button.component-QQFEGH3T.css.map */`],changeDetection:0})}return r})();var q1e=["*"];function Y1e(r,i){if(r&1){let e=We();$(0,"mat-checkbox",7),ve("change",function(o){we(e);let s=ne();return xe(s.handleSelect(o))}),ee()}if(r&2){let e=ne();z("checked",e.selected)("disabled",e.selectionDisabled)}}var A6=(()=>{class r{layer;viewerOptions;selected;selectionDisabled;action=new Ke(void 0);visibilityChange=new Ke(void 0);expand=new Ke(void 0);selectChange=new Ke;isDisabled;get title(){return this.layer.title}get collapsed(){return this.layer.collapsed}set collapsed(e){this.layer.collapsed=e}get tooltipMessage(){return this.layer.isInResolutionsRange?this.layer.visible&&this.isDisabled?"igo.geo.layer.group.hideChildren":this.layer.visible?"igo.geo.layer.group.hide":"igo.geo.layer.group.show":"igo.geo.layer.notInResolution"}ngOnInit(){this.layer.displayed$.subscribe(e=>{this.isDisabled=!e})}onToggle(){this.collapsed=!this.collapsed}toggleVisibility(e){e.stopPropagation(),this.visibilityChange.emit(e)}toggleLayerGroupTool(e){e.stopPropagation(),this.action.emit(this.layer)}toggleLayerTool(e){this.action.emit(e)}handleExpand(){this.expand.emit()}handleSelect(e){this.selectChange.emit(e.checked)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-layer-group"]],hostVars:2,hostBindings:function(n,o){n&2&&dr("disabled",o.isDisabled)},inputs:{layer:"layer",viewerOptions:"viewerOptions",selected:"selected",selectionDisabled:"selectionDisabled"},outputs:{action:"action",visibilityChange:"visibilityChange",expand:"expand",selectChange:"selectChange"},standalone:!0,features:[lt],ngContentSelectors:q1e,decls:13,vars:11,consts:[[1,"layer-content"],[3,"checked","disabled","change",4,"ngIf"],[1,"igo-layer-title",3,"click"],[1,"list-actions"],[1,"list-secondary-actions"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"click","matTooltip"],[3,"visibilityChange","layer","disabled","tooltip","inResolutionsRange"],[3,"change","checked","disabled"]],template:function(n,o){n&1&&(Kn(),$(0,"div",0),Pe(1,Y1e,1,2,"mat-checkbox",1),Tn(2),$(3,"span",2),ve("click",function(){return o.handleExpand()}),_e(4),ee()(),$(5,"div",3)(6,"div",4)(7,"button",5),le(8,"translate"),ve("click",function(l){return o.toggleLayerGroupTool(l)}),$(9,"mat-icon"),_e(10,"more_horiz"),ee()()(),$(11,"igo-layer-visibility-button",6),le(12,"async"),ve("visibilityChange",function(l){return o.toggleVisibility(l)}),ee()()),n&2&&(j(),z("ngIf",o.viewerOptions.mode==="selection"),j(3),bt(o.layer.title),j(3),z("matTooltip",ce(8,7,"igo.geo.layer.moreOptions")),j(4),z("layer",o.layer)("disabled",o.isDisabled)("tooltip",o.tooltipMessage)("inResolutionsRange",ce(12,9,o.layer.isInResolutionsRange$)))},dependencies:[Ei,Gt,Vt,ci,hl,ac,Qt,ti,jt,$t,R2,Et,Tt],styles:[`[_nghost-%COMP%]     .list-secondary-actions button{visibility:hidden}[_nghost-%COMP%]     .list-secondary-actions button.disabled{visibility:visible}[_nghost-%COMP%]:hover     .list-secondary-actions button{visibility:visible}.disabled[_nghost-%COMP%]     .igo-layer-title, .disabled[_nghost-%COMP%]     .list-secondary-actions{opacity:.54}.igo-layer-title[_ngcontent-%COMP%]{flex:1;font-weight:700;cursor:pointer;max-height:48px;white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;box-orient:vertical;-webkit-box-orient:vertical;line-clamp:2;-webkit-line-clamp:2}.layer-browser-group-carret[_ngcontent-%COMP%]{margin-right:10px}.layer-content[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between}.list-actions[_ngcontent-%COMP%]{display:flex;margin-left:4px;margin-right:4px}.child-list[_ngcontent-%COMP%]{padding-left:26px}
/*# sourceMappingURL=layer-group.component-VPJDSHXK.css.map */`],changeDetection:0})}return r})();function Xb(r){return An(r)?!1:r.dataSource.options.queryable===!0}function Z1e(r){let i=r.dataSource;return i.options.queryLayerFeatures!==void 0?i.options.queryLayerFeatures===!0:!0}function fK(r){let i=r.get("_layer");return i===void 0?!1:Xb(i)&&Z1e(i)}var Vp=(()=>{class r{renderer;el;get target(){return this._target}set target(e){this._target=e}_target;get collapsed(){return this._collapsed}set collapsed(e){e?this.collapseTarget():this.expandTarget(),this._collapsed=e,this.toggle.emit(e)}_collapsed=!1;toggle=new Ke;click(){this.collapsed=!this.collapsed}constructor(e,n){this.renderer=e,this.el=n}collapseTarget(){this.renderer.addClass(this.target,"igo-collapsed"),this.renderer.addClass(this.el.nativeElement,"collapsed")}expandTarget(){this.renderer.removeClass(this.target,"igo-collapsed"),this.renderer.removeClass(this.el.nativeElement,"collapsed")}static \u0275fac=function(n){return new(n||r)(Ie(s0),Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","igoCollapse",""]],hostBindings:function(n,o){n&1&&ve("click",function(){return o.click()})},inputs:{target:"target",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0})}return r})();var X1e=["*"],kE=(()=>{class r{get title(){return this._title}set title(e){this._title=e}_title="";get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e,this.toggle.emit(e)}_collapsed=!1;toggle=new Ke;static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-collapsible"]],inputs:{title:"title",collapsed:"collapsed"},outputs:{toggle:"toggle"},standalone:!0,features:[lt],ngContentSelectors:X1e,decls:8,vars:3,consts:[["content",""],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"toggle","target","collapsed"],["matListItemTitle",""]],template:function(n,o){if(n&1){let s=We();Kn(),$(0,"mat-list-item")(1,"mat-icon",1),ve("toggle",function(h){return we(s),xe(o.collapsed=h)}),_e(2," expand_less "),ee(),$(3,"span",2),_e(4),ee()(),$(5,"div",null,0),Tn(7),ee()}if(n&2){let s=Xt(6);j(),z("target",s)("collapsed",o.collapsed),j(3),bt(o.title)}},dependencies:[Io,ks,oc,Ta,jt,$t,Vp],styles:[`[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mat-mdc-list-item-avatar{height:auto;width:auto;padding:0}mat-list-item[_ngcontent-%COMP%]{overflow:hidden}
/*# sourceMappingURL=collapsible.component-7VJJSRPV.css.map */`]})}return r})();var rl=function(r){return r.DATE="date",r.TIME="time",r.DATETIME="datetime",r.YEAR="year",r}(rl||{}),Id=function(r){return r.CALENDAR="calendar",r.SLIDER="slider",r}(Id||{});var nf=(()=>{class r{map;getMap(){return this.map}setMap(e){this.map=e}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var OE=class r{_converters;_renderers;constructor(){this._converters={},this._converters.esriPMS=r._convertEsriPMS,this._converters.esriSFS=r._convertEsriSFS,this._converters.esriSLS=r._convertEsriSLS,this._converters.esriSMS=r._convertEsriSMS,this._converters.esriTS=r._convertEsriTS,this._renderers={},this._renderers.uniqueValue=this._renderUniqueValue,this._renderers.simple=this._renderSimple,this._renderers.classBreaks=this._renderClassBreaks}static _convertPointToPixel(i){return i/.75}static _transformColor(i){return[i[0],i[1],i[2],i[3]/255]}static _getResolutionForScale(i,e){let o=Cu[e];return parseFloat(i)/(o*39.3701*96)}static _convertEsriTS(i){let e=r._transformAngle(i.angle),n=i.text!==void 0?i.text:void 0;return new oi({text:new so({fill:new hi({color:r._transformColor(i.color)}),font:i.font.style+" "+i.font.weight+" "+i.font.size+" px "+i.font.family,textBaseline:i.verticalAlignment,textAlign:i.horizontalAlignment,offsetX:r._convertPointToPixel(i.xoffset),offsetY:r._convertPointToPixel(i.yoffset),rotation:e,text:n})})}static _convertEsriPMS(i){let e="data:"+i.contentType+";base64, "+i.imageData,n=r._transformAngle(i.angle);return new oi({image:new Bs({src:e,rotation:n})})}static _convertEsriSFS(i){let e=new hi({color:r._transformColor(i.color)}),n=i.outline?r._convertOutline(i.outline):void 0;return new oi({fill:e,stroke:n})}static _convertOutline(i){let e,n=r._transformColor(i.color);return i.style==="esriSLSDash"?e=[5]:i.style==="esriSLSDashDot"?e=[5,5,1,2]:i.style==="esriSLSDashDotDot"?e=[5,5,1,2,1,2]:i.style==="esriSLSDot"?e=[1,2]:i.style==="esriSLSNull"&&(n[3]=0),new ui({color:n,lineDash:e,width:r._convertPointToPixel(i.width)})}static _convertEsriSLS(i){return new oi({stroke:r._convertOutline(i)})}static _transformAngle(i){if(i===0||i===void 0)return;let n=-(i*Math.PI/180)+Math.PI/2;return n<0?2*Math.PI+n:n}static _convertEsriSMS(i){let e=new hi({color:r._transformColor(i.color)}),n=i.outline?r._convertOutline(i.outline):void 0,o=r._convertPointToPixel(i.size)/2,s=r._transformAngle(i.angle);if(i.style==="esriSMSCircle")return new oi({image:new an({radius:o,fill:e,stroke:n})});if(i.style==="esriSMSCross")return new oi({image:new ru({fill:e,stroke:n,points:4,radius:o,radius2:0,angle:0,rotation:s})});if(i.style==="esriSMSDiamond")return new oi({image:new ru({fill:e,stroke:n,points:4,radius:o,rotation:s})});if(i.style==="esriSMSSquare")return new oi({image:new ru({fill:e,stroke:n,points:4,radius:o,angle:Math.PI/4,rotation:s})});if(i.style==="esriSMSX")return new oi({image:new ru({fill:e,stroke:n,points:4,radius:o,radius2:0,angle:Math.PI/4,rotation:s})});if(i.style==="esriSMSTriangle")return new oi({image:new ru({fill:e,stroke:n,points:3,radius:o,angle:0,rotation:s})})}_convertLabelingInfo(i,e){let n=[];for(let o=0,s=i.length;o<s;++o){let l=i[o].labelExpression,h=l.substr(l.indexOf("[")+1,l.indexOf("]")-1),p=i[o].symbol,m=i[o].maxScale,f=i[o].minScale,g=null;m!==0&&(g=r._getResolutionForScale(m,e));let y=null;f!==0&&(y=r._getResolutionForScale(f,e));let _=this._converters[p.type].call(this,p);n.push(function(w,A){let k=!0;if(this.minResolution!==null&&this.maxResolution!==null?k=A<this.maxResolution&&A>=this.minResolution:this.minResolution!==null?k=A>=this.minResolution:this.maxResolution!==null&&(k=A<this.maxResolution),k){let R=w.get(this.field);return this.style.getText().setText(R),[this.style]}}.bind({minResolution:g,maxResolution:y,field:h,style:_}))}return n}_renderSimple(i){let e=this._converters[i.symbol.type].call(this,i.symbol);return()=>[e]}_renderClassBreaks(i){let e=i.defaultSymbol,n=this._converters[e.type].call(this,e),o=i.field,s=[];for(let l=0,h=i.classBreakInfos.length;l<h;++l){let p=i.classBreakInfos[l],m;p.classMinValue===null||p.classMinValue===void 0?l===0?m=i.minValue:m=i.classBreakInfos[l-1].classMaxValue:m=p.classMinValue;let f=p.classMaxValue,g=p.symbol,y=this._converters[g.type].call(this,g);s.push({min:m,max:f,style:y})}return l=>{let h=l.get(o);for(let p=0,m=s.length;p<m;++p){let f;if(p===0?f=h>=s[p].min&&h<=s[p].max:f=h>s[p].min&&h<=s[p].max,f)return[s[p].style]}return[n]}}_renderUniqueValue(i){let e=i.defaultSymbol,n=[];e&&(n=[this._converters[e.type].call(this,e)]);let o=i.field1,s=i.uniqueValueInfos,l=this;return(()=>{let h={};for(let p=0,m=s.length;p<m;++p){let f=s[p],g=f.symbol;h[f.value]=[l._converters[g.type].call(l,g)]}return p=>{let m=h[p.get(o)];return m||n}})()}generateStyle(i,e){let n=i.drawingInfo,o=[],s=this._renderers[n.renderer.type].call(this,n.renderer);if(s!==void 0&&o.push(s),i.labelingInfo){let l=this._convertLabelingInfo(i.labelingInfo,e);o=o.concat(l)}return o.length===1?o[0]:(l,h)=>{let p=[];for(let m=0,f=o.length;m<f;++m){let g=o[m].call(null,l,h);g&&(p=p.concat(g))}return p}}};var Kb=function(r){return r.wms="wms",r.wmts="wmts",r.arcgisrest="esriJSON",r.imagearcgisrest="esriJSON",r.tilearcgisrest="esriJSON",r}(Kb||{}),DE=function(r){return r.FeatureLayer="Feature Layer",r.RasterLayer="Raster Layer",r.GroupLayer="Group Layer",r}(DE||{});var Sl=class r{http;mapService;parsers={wms:new XI,wmts:new KI,esriJSON:new jm};constructor(i,e){this.http=i,this.mapService=e}getWMSOptions(i){let e=i.url,n=i.params.VERSION;return this.getCapabilities("wms",e,n).pipe(Nt(o=>o?this.parseWMSOptions(i,o):void 0))}getWMTSOptions(i){let e=i.url,n=i.version;return this.getCapabilities("wmts",e,n).pipe(Nt(s=>s?this.parseWMTSOptions(i,s):void 0))}getCartoOptions(i){let e="https://"+i.account+".carto.com/api/v2/viz/"+i.mapId+"/viz.json";return this.http.jsonp(e,"callback").pipe(Nt(n=>this.parseCartoOptions(i,n)))}getArcgisOptions(i){let e=i.url+"/"+i.layer+"?f=json",n=this.getCapabilities("arcgisrest",i.url),o=this.http.get(e);return mp([o,n]).pipe(Nt(s=>this.parseArcgisOptions(i,s[0],s[1])))}getImageArcgisOptions(i){let e=i.url+"/"+i.layer+"?f=json",n=i.url+"/legend?f=json",o=this.getCapabilities("imagearcgisrest",i.url),s=this.http.get(e),l=this.http.get(n).pipe(Nt(h=>h),qr(h=>(console.log("No legend associated with this Image Service"),ai(h))));return mp([s,l,o]).pipe(Nt(h=>this.parseTileOrImageArcgisOptions(i,h[0],h[1],h[2])))}getTileArcgisOptions(i){let e=i.url+"/"+i.layer+"?f=json",n=i.url+"/legend?f=json",o=this.getCapabilities("tilearcgisrest",i.url),s=this.http.get(e),l=this.http.get(n).pipe(Nt(h=>h),qr(h=>(console.log("No legend associated with this Tile Service"),ai(h))));return mp([s,l,o]).pipe(Nt(h=>this.parseTileOrImageArcgisOptions(i,h[0],h[1],h[2])))}getCapabilities(i,e,n){let o=new fs({fromObject:{request:"GetCapabilities",service:i.toUpperCase(),version:n||"1.3.0",_i:"true"}}),s;return Kb[i]==="esriJSON"?s=this.http.get(e+"?f=json"):s=this.http.get(e,{params:o,responseType:"text"}),s.pipe(Nt(l=>{if(Kb[i]==="esriJSON")return l;if(String(l).toLowerCase().includes("serviceexception")&&String(l).toLowerCase().includes("access denied"))throw{error:{message:"Service error getCapabilities: Access is denied"}};return this.parsers[i].read(l)}),qr(l=>{throw typeof l.error<"u"&&(l.error.caught=!0),l}))}parseWMSOptions(i,e){let n=i.params.LAYERS,o=this.findDataSourceInCapabilities(e.Capability.Layer,n);if(!o)throw{error:{message:"Layer not found"}};let s=o.DataURL?o.DataURL[0]:void 0,l=o.Abstract?o.Abstract:void 0,h=o.KeywordList?o.KeywordList:void 0,p=o.queryable,m=this.getTimeFilter(o),f=m&&Object.keys(m).length>0,g=o.Style?this.getStyle(o.Style):void 0,y=!0;o.EX_GeographicBoundingBox?o.EX_GeographicBoundingBox.forEach((R,q)=>{q<2&&(R>180||R<-180)&&(y=!1),q>=2&&(R>90||R<-90)&&(y=!1)}):y=!1;let _=y?Zs(o.EX_GeographicBoundingBox,"EPSG:4326",this.mapService.getMap().projection):void 0,w,A=[Yh.GEOJSON,Yh.GEOJSON2,Yh.GML3,Yh.GML2,Yh.JSON,Yh.HTML];for(let R of A)if(e.Capability.Request.GetFeatureInfo.Format.indexOf(R)!==-1){let q=Object.keys(Yh).find(X=>Yh[X]===R);w=Ya[q];break}w||(p=!1);let k=rr.removeUndefined({_layerOptionsFromSource:{title:o.Title,maxResolution:Oa(o.MaxScaleDenominator),minResolution:Oa(o.MinScaleDenominator),extent:_,metadata:{url:s?s.OnlineResource:void 0,extern:s?!0:void 0,abstract:l,keywordList:h},legendOptions:g},queryable:p,queryFormat:w,timeFilter:f?m:void 0,timeFilterable:f?!0:void 0,minDate:f?m.min:void 0,maxDate:f?m.max:void 0,stepDate:f?m.step:void 0});return rr.mergeDeep(k,i)}parseWMTSOptions(i,e){let n=e.Contents.Layer.find(h=>h.Identifier===i.layer),o=NH(e,i),s=Object.assign(o,i),l=rr.removeUndefined({_layerOptionsFromSource:{title:n.Title}});return rr.mergeDeep(l,s)}parseCartoOptions(i,e){let n=[],o=e.layers[1].options.layer_definition;o.layers.forEach(l=>{n.push({type:l.type.toLowerCase(),options:l.options,legend:l.legend})});let s=rr.removeUndefined({config:{version:o.version,layers:n}});return rr.mergeDeep(s,i)}parseArcgisOptions(i,e,n){let o=e.name,s;e.drawingInfo?.renderer?s=e.drawingInfo.renderer:s=void 0;let l;if(e.drawingInfo){let y=new OE,_=e.units==="esriMeters"?"m":"degrees";l=y.generateStyle(e,_)}let h=new l_({target:e.copyrightText}),p,m;if(e.timeInfo){let y=e.timeInfo.timeExtent;p=y[0]+","+y[1];let _=new Date;_.setTime(y[0]);let w=new Date;w.setTime(y[1]),m={min:_.toUTCString(),max:w.toUTCString(),range:!0,type:rl.DATETIME,style:Id.CALENDAR}}let f=Object.assign({},{style:l,LAYERS:i.layer?"show:"+i.layer:void 0,time:p}),g=rr.removeUndefined({params:f,_layerOptionsFromSource:{title:o,minResolution:Oa(e.maxScale),maxResolution:Oa(e.minScale),metadata:{extern:!1,abstract:e.description||n.serviceDescription}},legendInfo:s,timeFilter:m,sourceFields:e.fields,queryTitle:e.displayField});return g.attributions=h,rr.mergeDeep(g,i)}parseTileOrImageArcgisOptions(i,e,n,o){let s=e.name,l=n.layers?n.layers.find(y=>y.layerName===s):void 0,h=new l_({target:e.copyrightText}),p,m;if(e.timeInfo){let y=e.timeInfo.timeExtent;p=y[0]+","+y[1];let _=new Date;_.setTime(y[0]);let w=new Date;w.setTime(y[1]),m={min:_.toUTCString(),max:w.toUTCString(),range:!0,type:rl.DATETIME,style:Id.CALENDAR}}let f=Object.assign({},{LAYERS:i.layer?"show:"+i.layer:void 0,time:p}),g=rr.removeUndefined({params:f,_layerOptionsFromSource:{title:s,minResolution:Oa(e.maxScale),maxResolution:Oa(e.minScale),metadata:{extern:!1,abstract:e.description||o.serviceDescription}},legendInfo:l,timeFilter:m,sourceFields:e.fields,queryTitle:e.displayField});return g.attributions=h,rr.mergeDeep(g,i)}findDataSourceInCapabilities(i,e){if(Array.isArray(i)){let n;return i.find(o=>(n=this.findDataSourceInCapabilities(o,e),n!==void 0),this),n}else return i.Layer?this.findDataSourceInCapabilities(i.Layer,e):i.Name&&i.Name===e?i:void 0}getTimeFilter(i){let e;if(i.Dimension){let n={};if(e=i.Dimension[0],e.values){let o=e.values.split("/");n.min=o[0]!==void 0?o[0]:void 0,n.max=o[1]!==void 0?o[1]:void 0,n.step=o[2]!==void 0?o[2]:void 0}return e.default&&(n.value=e.default),n}}getStyle(i){return{stylesAvailable:i.map(o=>({name:o.Name,title:o.Title})).filter((o,s,l)=>l.findIndex(h=>h.name===o.name)===s)}}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(nf))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})};Hs([Nl({maxCacheCount:20}),Xr("design:type",Function),Xr("design:paramtypes",[Object]),Xr("design:returntype",$r)],Sl.prototype,"getArcgisOptions",null);Hs([Nl({maxCacheCount:20}),Xr("design:type",Function),Xr("design:paramtypes",[Object]),Xr("design:returntype",$r)],Sl.prototype,"getImageArcgisOptions",null);Hs([Nl({maxCacheCount:20}),Xr("design:type",Function),Xr("design:paramtypes",[Object]),Xr("design:returntype",$r)],Sl.prototype,"getTileArcgisOptions",null);Hs([Nl({maxCacheCount:20}),Xr("design:type",Function),Xr("design:paramtypes",[String,String,String]),Xr("design:returntype",$r)],Sl.prototype,"getCapabilities",null);var oh=function(r){return r.TITLE="title",r.ABSTRACT="abstract",r.CUSTOM="custom",r}(oh||{});var M6=class extends _g{constructor(i){i=i||{},super(i)}},gK=M6;var I6=class extends db{constructor(i){super(i),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(i){let e=i.layerStatesArray[i.layerIndex],n=i.pixelRatio,o=i.viewState,s=o.resolution,l=this.getLayer().getSource(),h=i.viewHints,p=i.extent;if(e.extent!==void 0&&(p=Xc(p,Kc(e.extent,o.projection))),!h[Ro.ANIMATING]&&!h[Ro.INTERACTING]&&!nd(p))if(l){let m=o.projection,f=l.getImage(p,s,n,m);f&&(this.loadImage(f)?this.image_=f:f.getState()===xi.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(i){let e=this.frameState;if(!e)return null;let n=this.getLayer(),o=$o(e.pixelToCoordinateTransform,i.slice()),s=n.getExtent();if(s&&!$d(s,o))return null;let l=this.image_.getExtent(),h=this.image_.getImage(),p=mr(l),m=Math.floor(h.width*((o[0]-l[0])/p));if(m<0||m>=h.width)return null;let f=Hn(l),g=Math.floor(h.height*((l[3]-o[1])/f));return g<0||g>=h.height?null:this.getImageData(h,m,g)}renderFrame(i,e){let n=this.image_,o=n.getExtent(),s=n.getResolution(),[l,h]=Array.isArray(s)?s:[s,s],p=n.getPixelRatio(),m=i.layerStatesArray[i.layerIndex],f=i.pixelRatio,g=i.viewState,y=g.center,_=g.resolution,w=f*l/(_*p),A=f*h/(_*p),k=i.extent,R=g.resolution,q=g.rotation,X=Math.round(mr(k)/R*f),ie=Math.round(Hn(k)/R*f);Ns(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/f,1/f,q,-X/2,-ie/2),D0(this.inversePixelTransform,this.pixelTransform);let ae=Sv(this.pixelTransform);this.useContainer(e,ae,this.getBackground(i));let be=this.getRenderContext(i),me=this.context.canvas;me.width!=X||me.height!=ie?(me.width=X,me.height=ie):this.containerReused||be.clearRect(0,0,X,ie);let fe=!1,ge=!0;if(m.extent){let Te=Kc(m.extent,g.projection);ge=On(Te,i.extent),fe=ge&&!Pa(Te,i.extent),fe&&this.clipUnrotated(be,i,Te)}let ue=n.getImage(),se=Ns(this.tempTransform,X/2,ie/2,w,A,0,p*(o[0]-y[0])/l,p*(y[1]-o[3])/h);this.renderedResolution=h*f/p;let te=ue.width*se[0],Se=ue.height*se[3];if(this.getLayer().getSource().getInterpolate()||(be.imageSmoothingEnabled=!1),this.preRender(be,i),ge&&te>=.5&&Se>=.5){let Te=se[4],Ee=se[5],je=m.opacity;je!==1&&(be.save(),be.globalAlpha=je),be.drawImage(ue,0,0,+ue.width,+ue.height,Te,Ee,te,Se),je!==1&&be.restore()}return this.postRender(this.context,i),fe&&be.restore(),be.imageSmoothingEnabled=!0,ae!==me.style.transform&&(me.style.transform=ae),this.container}},_K=I6;var E6=class extends gK{constructor(i){super(i)}createRenderer(){return new _K(this)}getData(i){return super.getData(i)}},yK=E6;var RE=class extends u0{id;loaded=0;loading=0;source;messageService;constructor(i,e){super(),this.source=i.options.source.ol,this.id=rn(),this.messageService=e}watch(){this.source.on("imageloadstart",i=>this.handleLoadStart(i)),this.source.on("imageloadend",i=>this.handleLoadEnd(i)),this.source.on("imageloaderror",i=>this.handleLoadEnd(i)),this.source.on("imageloaderror",i=>this.handleLoadError(i))}unwatch(){this.source.un("imageloadstart",i=>this.handleLoadStart(i)),this.source.un("imageloadend",i=>this.handleLoadEnd(i)),this.source.un("imageloaderror",i=>this.handleLoadEnd(i)),this.source.un("imageloaderror",i=>this.handleLoadError(i))}handleLoadStart(i){i.image.__watchers__||(i.image.__watchers__=[]),i.image.__watchers__.push(this.id),this.loading+=1,this.status=dn.Working}handleLoadEnd(i){if(!i.image.__watchers__)return;let e=i.image.__watchers__.indexOf(this.id);if(e<0)return;i.image.__watchers__.splice(e,1),this.loaded+=1;let n=this.loading;this.loaded>=n&&n===this.loading&&(this.status=dn.Done,this.loaded=this.loading=0)}handleLoadError(i){i.image.__watchers__&&(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:i.target.params_.LAYERS}),this.loaded=-1,this.loading=0,this.status=dn.Error)}};var NE=class extends Qm{messageService;authInterceptor;type="raster";watcher;constructor(i,e,n){super(i,e,n),this.messageService=e,this.authInterceptor=n,this.watcher=new RE(this,this.messageService),this.status$=this.watcher.status$,this.status$.subscribe(o=>{o===0&&(this.olLoadingProblem=!0)})}createOlLayer(){let i=Object.assign({},this.options,{source:this.options.source.ol}),e=new yK(i);return this.authInterceptor&&e.getSource().setImageLoadFunction((n,o)=>{this.customLoader(n,o,this.authInterceptor,this.messageService)}),e}init(i){i===void 0?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.init(i)}remove(){this.watcher.unsubscribe(),super.remove()}customLoader(i,e,n,o){let s=new XMLHttpRequest,l=n.alterUrlWithKeyAuth(e),h=e;if(l&&(h=l),s.open("GET",h),!n.interceptXhr(s,h)){s.abort(),i.getImage().src=h;return}s.responseType="arraybuffer",s.onload=function(){let m=new Uint8Array(this.response);new TextDecoder().decode(m).includes("ServiceExceptionReport")&&o.error("igo.geo.dataSource.optionsApiUnavailable","igo.geo.dataSource.unavailableTitle");let g=new Blob([m],{type:"image/png"}),_=window.URL.createObjectURL(g);i.getImage().src=_},s.send()}};var of={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var T6=class extends _g{constructor(i){i=i||{};let e=Object.assign({},i);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(i.preload!==void 0?i.preload:0),this.setUseInterimTilesOnError(i.useInterimTilesOnError!==void 0?i.useInterimTilesOnError:!0)}getPreload(){return this.get(of.PRELOAD)}setPreload(i){this.set(of.PRELOAD,i)}getUseInterimTilesOnError(){return this.get(of.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(i){this.set(of.USE_INTERIM_TILES_ON_ERROR,i)}getData(i){return super.getData(i)}},vK=T6;var F6=class extends db{constructor(i){super(i),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Wn(),this.tmpTileRange_=new c5(0,0,0,0)}isDrawableTile(i){let e=this.getLayer(),n=i.getState(),o=e.getUseInterimTilesOnError();return n==si.LOADED||n==si.EMPTY||n==si.ERROR&&!o}getTile(i,e,n,o){let s=o.pixelRatio,l=o.viewState.projection,h=this.getLayer(),m=h.getSource().getTile(i,e,n,s,l);return m.getState()==si.ERROR&&h.getUseInterimTilesOnError()&&h.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(m)||(m=m.getInterimTile()),m}getData(i){let e=this.frameState;if(!e)return null;let n=this.getLayer(),o=$o(e.pixelToCoordinateTransform,i.slice()),s=n.getExtent();if(s&&!$d(s,o))return null;let l=e.pixelRatio,h=e.viewState.projection,p=e.viewState,m=n.getRenderSource(),f=m.getTileGridForProjection(p.projection),g=m.getTilePixelRatio(e.pixelRatio);for(let y=f.getZForResolution(p.resolution);y>=f.getMinZoom();--y){let _=f.getTileCoordForCoordAndZ(o,y),w=m.getTile(y,_[1],_[2],l,h);if(!(w instanceof t5||w instanceof NS)||w instanceof NS&&w.getState()===si.EMPTY)return null;if(w.getState()!==si.LOADED)continue;let A=f.getOrigin(y),k=Wo(f.getTileSize(y)),R=f.getResolution(y),q=Math.floor(g*((o[0]-A[0])/R-_[1]*k[0])),X=Math.floor(g*((A[1]-o[1])/R-_[2]*k[1])),ie=Math.round(g*m.getGutterForProjection(p.projection));return this.getImageData(w.getImage(),q+ie,X+ie)}return null}loadedTileCallback(i,e,n){return this.isDrawableTile(n)?super.loadedTileCallback(i,e,n):!1}prepareFrame(i){return!!this.getLayer().getSource()}renderFrame(i,e){let n=i.layerStatesArray[i.layerIndex],o=i.viewState,s=o.projection,l=o.resolution,h=o.center,p=o.rotation,m=i.pixelRatio,f=this.getLayer(),g=f.getSource(),y=g.getRevision(),_=g.getTileGridForProjection(s),w=_.getZForResolution(l,g.zDirection),A=_.getResolution(w),k=i.extent,R=i.viewState.resolution,q=g.getTilePixelRatio(m),X=Math.round(mr(k)/R*m),ie=Math.round(Hn(k)/R*m),ae=n.extent&&Kc(n.extent,s);ae&&(k=Xc(k,Kc(n.extent,s)));let be=A*X/2/q,me=A*ie/2/q,fe=[h[0]-be,h[1]-me,h[0]+be,h[1]+me],ge=_.getTileRangeForExtentAndZ(k,w),ue={};ue[w]={};let se=this.createLoadedTileFinder(g,s,ue),te=this.tmpExtent,Se=this.tmpTileRange_;this.newTiles_=!1;let Te=p?iM(o.center,R,p,i.size):void 0;for(let Ae=ge.minX;Ae<=ge.maxX;++Ae)for(let Le=ge.minY;Le<=ge.maxY;++Le){if(p&&!_.tileCoordIntersectsViewport([w,Ae,Le],Te))continue;let Ye=this.getTile(w,Ae,Le,i);if(this.isDrawableTile(Ye)){let ft=fi(this);if(Ye.getState()==si.LOADED){ue[w][Ye.tileCoord.toString()]=Ye;let mt=Ye.inTransition(ft);mt&&n.opacity!==1&&(Ye.endTransition(ft),mt=!1),!this.newTiles_&&(mt||!this.renderedTiles.includes(Ye))&&(this.newTiles_=!0)}if(Ye.getAlpha(ft,i.time)===1)continue}let qe=_.getTileCoordChildTileRange(Ye.tileCoord,Se,te),et=!1;qe&&(et=se(w+1,qe)),et||_.forEachTileCoordParentTileRange(Ye.tileCoord,se,Se,te)}let Ee=A/l*m/q;Ns(this.pixelTransform,i.size[0]/2,i.size[1]/2,1/m,1/m,p,-X/2,-ie/2);let je=Sv(this.pixelTransform);this.useContainer(e,je,this.getBackground(i));let Ne=this.getRenderContext(i),ze=this.context.canvas;D0(this.inversePixelTransform,this.pixelTransform),Ns(this.tempTransform,X/2,ie/2,Ee,Ee,0,-X/2,-ie/2),ze.width!=X||ze.height!=ie?(ze.width=X,ze.height=ie):this.containerReused||Ne.clearRect(0,0,X,ie),ae&&this.clipUnrotated(Ne,i,ae),g.getInterpolate()||(Ne.imageSmoothingEnabled=!1),this.preRender(Ne,i),this.renderedTiles.length=0;let Re=Object.keys(ue).map(Number);Re.sort(iu);let Ge,He,ye;n.opacity===1&&(!this.containerReused||g.getOpaque(i.viewState.projection))?Re=Re.reverse():(Ge=[],He=[]);for(let Ae=Re.length-1;Ae>=0;--Ae){let Le=Re[Ae],Ye=g.getTilePixelSize(Le,m,s),et=_.getResolution(Le)/A,ft=Ye[0]*et*Ee,mt=Ye[1]*et*Ee,At=_.getTileCoordForCoordAndZ(Mc(fe),Le),ht=_.getTileCoordExtent(At),he=$o(this.tempTransform,[q*(ht[0]-fe[0])/A,q*(fe[3]-ht[3])/A]),st=q*g.getGutterForProjection(s),Je=ue[Le];for(let de in Je){let ke=Je[de],Ze=ke.tileCoord,vt=At[1]-Ze[1],tt=Math.round(he[0]-(vt-1)*ft),ot=At[2]-Ze[2],wt=Math.round(he[1]-(ot-1)*mt),Mt=Math.round(he[0]-vt*ft),St=Math.round(he[1]-ot*mt),ei=tt-Mt,Jt=wt-St,Ut=w===Le,pi=Ut&&ke.getAlpha(fi(this),i.time)!==1,yi=!1;if(!pi)if(Ge){ye=[Mt,St,Mt+ei,St,Mt+ei,St+Jt,Mt,St+Jt];for(let Kt=0,li=Ge.length;Kt<li;++Kt)if(w!==Le&&Le<He[Kt]){let Ft=Ge[Kt];On([Mt,St,Mt+ei,St+Jt],[Ft[0],Ft[3],Ft[4],Ft[7]])&&(yi||(Ne.save(),yi=!0),Ne.beginPath(),Ne.moveTo(ye[0],ye[1]),Ne.lineTo(ye[2],ye[3]),Ne.lineTo(ye[4],ye[5]),Ne.lineTo(ye[6],ye[7]),Ne.moveTo(Ft[6],Ft[7]),Ne.lineTo(Ft[4],Ft[5]),Ne.lineTo(Ft[2],Ft[3]),Ne.lineTo(Ft[0],Ft[1]),Ne.clip())}Ge.push(ye),He.push(Le)}else Ne.clearRect(Mt,St,ei,Jt);this.drawTileImage(ke,i,Mt,St,ei,Jt,st,Ut),Ge&&!pi?(yi&&Ne.restore(),this.renderedTiles.unshift(ke)):this.renderedTiles.push(ke),this.updateUsedTiles(i.usedTiles,g,ke)}}return this.renderedRevision=y,this.renderedResolution=A,this.extentChanged=!this.renderedExtent_||!Wd(this.renderedExtent_,fe),this.renderedExtent_=fe,this.renderedPixelRatio=m,this.renderedProjection=s,this.manageTilePyramid(i,g,_,m,s,k,w,f.getPreload()),this.scheduleExpireCache(i,g),this.postRender(this.context,i),n.extent&&Ne.restore(),Ne.imageSmoothingEnabled=!0,je!==ze.style.transform&&(ze.style.transform=je),this.container}drawTileImage(i,e,n,o,s,l,h,p){let m=this.getTileImage(i);if(!m)return;let f=this.getRenderContext(e),g=fi(this),y=e.layerStatesArray[e.layerIndex],_=y.opacity*(p?i.getAlpha(g,e.time):1),w=_!==f.globalAlpha;w&&(f.save(),f.globalAlpha=_),f.drawImage(m,h,h,m.width-2*h,m.height-2*h,n,o,s,l),w&&f.restore(),_!==y.opacity?e.animate=!0:p&&i.endTransition(g)}getImage(){let i=this.context;return i?i.canvas:null}getTileImage(i){return i.getImage()}scheduleExpireCache(i,e){if(e.canExpireCache()){let n=function(o,s,l){let h=fi(o);h in l.usedTiles&&o.expireCache(l.viewState.projection,l.usedTiles[h])}.bind(null,e);i.postRenderFunctions.push(n)}}updateUsedTiles(i,e,n){let o=fi(e);o in i||(i[o]={}),i[o][n.getKey()]=!0}manageTilePyramid(i,e,n,o,s,l,h,p,m){let f=fi(e);f in i.wantedTiles||(i.wantedTiles[f]={});let g=i.wantedTiles[f],y=i.tileQueue,_=n.getMinZoom(),w=i.viewState.rotation,A=w?iM(i.viewState.center,i.viewState.resolution,w,i.size):void 0,k=0,R,q,X,ie,ae,be;for(be=_;be<=h;++be)for(q=n.getTileRangeForExtentAndZ(l,be,q),X=n.getResolution(be),ie=q.minX;ie<=q.maxX;++ie)for(ae=q.minY;ae<=q.maxY;++ae)w&&!n.tileCoordIntersectsViewport([be,ie,ae],A)||(h-be<=p?(++k,R=e.getTile(be,ie,ae,o,s),R.getState()==si.IDLE&&(g[R.getKey()]=!0,y.isKeyQueued(R.getKey())||y.enqueue([R,f,n.getTileCoordCenter(R.tileCoord),X])),m!==void 0&&m(R)):e.useTile(be,ie,ae,s));e.updateCacheSize(k,s)}},BE=F6;var P6=class extends vK{constructor(i){super(i)}createRenderer(){return new BE(this)}},bK=P6;var Qb=class extends u0{id;loaded=0;loading=0;source;constructor(i){super(),this.source=i.options.source.ol,this.id=rn()}watch(){this.source.on("tileloadstart",i=>this.handleLoadStart(i)),this.source.on("tileloadend",i=>this.handleLoadEnd(i)),this.source.on("tileloaderror",i=>this.handleLoadEnd(i))}unwatch(){this.source.un("tileloadstart",i=>this.handleLoadStart(i)),this.source.un("tileloadend",i=>this.handleLoadEnd(i)),this.source.un("tileloaderror",i=>this.handleLoadEnd(i))}handleLoadStart(i){i.tile.__watchers__||(i.tile.__watchers__=[]),i.tile.__watchers__.push(this.id),this.loading+=1,this.status=dn.Working}handleLoadEnd(i){if(!i.tile.__watchers__)return;let e=i.tile.__watchers__.indexOf(this.id);if(e<0)return;i.tile.__watchers__.splice(e,1),this.loaded+=1;let n=this.loading;this.loaded>=n&&n===this.loading&&(this.status=dn.Done,this.loaded=this.loading=0)}};var GE=class extends Qm{messageService;authInterceptor;type="raster";watcher;constructor(i,e,n){super(i,e),this.messageService=e,this.authInterceptor=n,this.watcher=new Qb(this),this.status$=this.watcher.status$}createOlLayer(){let i=Object.assign({},this.options,{source:this.options.source.ol}),e=new bK(i);return e.getSource().setTileLoadFunction((o,s)=>{this.customLoader(o,s,this.authInterceptor)}),e}customLoader(i,e,n){let o=n.alterUrlWithKeyAuth(e),s=e;o&&(s=o),i.getImage().src=s}init(i){i===void 0?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.init(i)}remove(){this.watcher.unsubscribe(),super.remove()}};var K1e={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},wK={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},L6=class extends BE{constructor(i){super(i),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=el(),this.tileClipContexts_=null}prepareTile(i,e,n){let o,s=i.getState();return(s===si.LOADED||s===si.ERROR)&&(this.updateExecutorGroup_(i,e,n),this.tileImageNeedsRender_(i)&&(o=!0)),o}getTile(i,e,n,o){let s=o.pixelRatio,l=o.viewState,h=l.resolution,p=l.projection,m=this.getLayer(),f=m.getSource().getTile(i,e,n,s,p),g=o.viewHints,y=!(g[Ro.ANIMATING]||g[Ro.INTERACTING]);return(y||!f.wantedResolution)&&(f.wantedResolution=h),this.prepareTile(f,s,p)&&(y||Date.now()-o.time<8)&&m.getRenderMode()!=="vector"&&this.renderTileImage_(f,o),super.getTile(i,e,n,o)}isDrawableTile(i){let e=this.getLayer();return super.isDrawableTile(i)&&(e.getRenderMode()==="vector"?fi(e)in i.executorGroups:i.hasContext(e))}getTileImage(i){return i.getImage(this.getLayer())}prepareFrame(i){let e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(i)}updateExecutorGroup_(i,e,n){let o=this.getLayer(),s=o.getRevision(),l=o.getRenderOrder()||null,h=i.wantedResolution,p=i.getReplayState(o);if(!p.dirty&&p.renderedResolution===h&&p.renderedRevision==s&&p.renderedRenderOrder==l)return;let m=o.getSource(),f=!!o.getDeclutter(),g=m.getTileGrid(),_=m.getTileGridForProjection(n).getTileCoordExtent(i.wrappedTileCoord),w=m.getSourceTiles(e,n,i),A=fi(o);delete i.hitDetectionImageData[A],i.executorGroups[A]=[],p.dirty=!1;for(let k=0,R=w.length;k<R;++k){let q=w[k];if(q.getState()!=si.LOADED)continue;let X=q.tileCoord,ie=g.getTileCoordExtent(X),ae=Xc(_,ie),be=Gl(ae,o.getRenderBuffer()*h,this.tmpExtent),me=Wd(ie,ae)?null:be,fe=new F5(0,ae,h,e),ge=Ry(h,e),ue=function(Ee,je){let Ne,ze=Ee.getStyleFunction()||o.getStyleFunction();if(ze&&(Ne=ze(Ee,h)),Ne){let Re=this.renderFeature(Ee,ge,Ne,fe,f,je);p.dirty=p.dirty||Re}},se=q.getFeatures();l&&l!==p.renderedRenderOrder&&se.sort(l);for(let Ee=0,je=se.length;Ee<je;++Ee){let Ne=se[Ee];(!me||On(me,Ne.getGeometry().getExtent()))&&ue.call(this,Ne,Ee)}let te=fe.finish(),Se=o.getRenderMode()!=="vector"&&f&&w.length===1?null:ae,Te=new L5(Se,h,e,m.getOverlaps(),te,o.getRenderBuffer(),!!this.frameState?.declutter);i.executorGroups[A].push(Te)}p.renderedRevision=s,p.renderedRenderOrder=l,p.renderedResolution=h}forEachFeatureAtCoordinate(i,e,n,o,s){let l=e.viewState.resolution,h=e.viewState.rotation;n=n??0;let p=this.getLayer(),f=p.getSource().getTileGridForProjection(e.viewState.projection),g=Ds([i]);Gl(g,l*n,g);let y={},_=function(k,R,q){let X=k.getId();X===void 0&&(X=fi(k));let ie=y[X];if(ie){if(ie!==!0&&q<ie.distanceSq){if(q===0)return y[X]=!0,s.splice(s.lastIndexOf(ie),1),o(k,p,R);ie.geometry=R,ie.distanceSq=q}}else{if(q===0)return y[X]=!0,o(k,p,R);s.push(y[X]={feature:k,layer:p,geometry:R,distanceSq:q,callback:o})}},w=this.renderedTiles,A;for(let k=0,R=w.length;!A&&k<R;++k){let q=w[k],X=f.getTileCoordExtent(q.wrappedTileCoord);if(!On(X,g))continue;let ie=fi(p),ae=[q.executorGroups[ie]],be=p.getDeclutter();ae.some(me=>{let fe=be?e.declutter[be].all().map(ge=>ge.value):null;for(let ge=0,ue=me.length;ge<ue;++ge)if(A=me[ge].forEachFeatureAtCoordinate(i,l,h,n,_,fe),A)return!0})}return A}getFeatures(i){return new Promise((e,n)=>{let o=this.getLayer(),s=fi(o),l=o.getSource(),h=this.renderedProjection,p=h.getExtent(),m=this.renderedResolution,f=l.getTileGridForProjection(h),g=$o(this.renderedPixelToCoordinateTransform_,i.slice()),y=f.getTileCoordForCoordAndResolution(g,m),_;for(let X=0,ie=this.renderedTiles.length;X<ie;++X)if(y.toString()===this.renderedTiles[X].tileCoord.toString()){if(_=this.renderedTiles[X],_.getState()===si.LOADED){let ae=f.getTileCoordExtent(_.tileCoord);l.getWrapX()&&h.canWrapX()&&!Pa(p,ae)&&X1(g,h);break}_=void 0}if(!_||_.loadingSourceTiles>0){e([]);return}let w=f.getTileCoordExtent(_.wrappedTileCoord),A=Mc(w),k=[(g[0]-A[0])/m,(A[1]-g[1])/m],R=_.getSourceTiles().reduce(function(X,ie){return X.concat(ie.getFeatures())},[]),q=_.hitDetectionImageData[s];if(!q){let X=Wo(f.getTileSize(f.getZForResolution(m,l.zDirection))),ie=this.renderedRotation_,ae=[this.getRenderTransform(f.getTileCoordCenter(_.wrappedTileCoord),m,0,Lu,X[0]*Lu,X[1]*Lu,0)];q=O5(X,ae,R,o.getStyleFunction(),f.getTileCoordExtent(_.wrappedTileCoord),_.getReplayState(o).renderedResolution,ie),_.hitDetectionImageData[s]=q}e(D5(k,R,q))})}handleFontsChanged(){let i=this.getLayer();i.getVisible()&&this.renderedLayerRevision_!==void 0&&i.changed()}handleStyleImageChange_(i){this.renderIfReadyAndVisible()}renderDeclutter(i,e){let n=this.context,o=n.globalAlpha;n.globalAlpha=e.opacity;let s=i.viewHints,l=!(s[Ro.ANIMATING]||s[Ro.INTERACTING]),h=this.renderedTiles;for(let p=0,m=h.length;p<m;++p){let f=h[p],g=f.executorGroups[fi(this.getLayer())],y=this.getLayer().getDeclutter();if(g)for(let _=g.length-1;_>=0;--_)g[_].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(f,i),i.viewState.rotation,l,mb,y?i.declutter[y]:void 0)}n.globalAlpha=o}renderDeferredInternal(i){let n=this.renderedTiles.reduce((l,h,p)=>(h.executorGroups[fi(this.getLayer())].forEach(m=>l.push({executorGroup:m,index:p})),l),[]),o=n.map(({executorGroup:l})=>l.getDeferredZIndexContexts());o.map(l=>Object.keys(l)).flat().sort(iu).map(Number).forEach(l=>{o.forEach((h,p)=>{h[l]&&h[l].forEach(m=>{let{executorGroup:f,index:g}=n[p],y=f.getRenderedContext(),_=y.globalAlpha;y.globalAlpha=this.renderedOpacity_;let w=this.tileClipContexts_[g];w&&w.draw(y),m.draw(y),w&&y.restore(),y.globalAlpha=_,m.clear()})})})}getTileRenderTransform(i,e){let n=e.pixelRatio,o=e.viewState,s=o.center,l=o.resolution,h=o.rotation,p=e.size,m=Math.round(p[0]*n),f=Math.round(p[1]*n),y=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),_=i.tileCoord,w=y.getTileCoordExtent(i.wrappedTileCoord),A=y.getTileCoordExtent(_,this.tmpExtent)[0]-w[0];return wv(xv(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(s,l,h,n,m,f,A))}postRender(i,e){let n=e.viewHints,o=!(n[Ro.ANIMATING]||n[Ro.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;let s=this.getLayer(),l=s.getRenderMode(),h=i.globalAlpha;i.globalAlpha=this.renderedOpacity_;let p=s.getDeclutter(),m=p?wK[l].filter(ie=>!mb.includes(ie)):wK[l],f=e.viewState,g=f.rotation,y=s.getSource(),w=y.getTileGridForProjection(f.projection).getZForResolution(f.resolution,y.zDirection),A=this.renderedTiles,k=[],R=[],q=[],X=!0;for(let ie=A.length-1;ie>=0;--ie){let ae=A[ie];X=X&&!ae.getReplayState(s).dirty;let be=ae.executorGroups[fi(s)].filter(Se=>Se.hasExecutors(m));if(be.length===0)continue;let me=this.getTileRenderTransform(ae,e),fe=ae.tileCoord[0],ge=!1,ue=be[0].getClipCoords(me),se=i,te;if(ue){p&&(te=new cb,se=te.getContext());for(let Se=0,Te=k.length;Se<Te;++Se)if(w!==fe&&fe<R[Se]){let Ee=k[Se];On([ue[0],ue[3],ue[4],ue[7]],[Ee[0],Ee[3],Ee[4],Ee[7]])&&(ge||(se.save(),ge=!0),se.beginPath(),se.moveTo(ue[0],ue[1]),se.lineTo(ue[2],ue[3]),se.lineTo(ue[4],ue[5]),se.lineTo(ue[6],ue[7]),se.moveTo(Ee[6],Ee[7]),se.lineTo(Ee[4],Ee[5]),se.lineTo(Ee[2],Ee[3]),se.lineTo(Ee[0],Ee[1]),se.clip())}k.push(ue),R.push(fe)}for(let Se=0,Te=be.length;Se<Te;++Se)be[Se].execute(i,[i.canvas.width,i.canvas.height],me,g,o,m);ge&&(se===i?se.restore():q[ie]=te)}i.globalAlpha=h,this.ready=X,this.tileClipContexts_=q,super.postRender(i,e)}renderFeature(i,e,n,o,s,l){if(!n)return!1;let h=!1;if(Array.isArray(n))for(let p=0,m=n.length;p<m;++p)h=fb(o,i,n[p],e,this.boundHandleStyleImageChange_,void 0,s,l)||h;else h=fb(o,i,n,e,this.boundHandleStyleImageChange_,void 0,s,l);return h}tileImageNeedsRender_(i){let e=this.getLayer();if(e.getRenderMode()==="vector")return!1;let n=i.getReplayState(e),o=e.getRevision(),s=i.wantedResolution;return n.renderedTileResolution!==s||n.renderedTileRevision!==o}renderTileImage_(i,e){let n=this.getLayer(),o=i.getReplayState(n),s=n.getRevision(),l=i.executorGroups[fi(n)];o.renderedTileRevision=s;let h=i.wrappedTileCoord,p=h[0],m=n.getSource(),f=e.pixelRatio,y=e.viewState.projection,_=m.getTileGridForProjection(y),w=_.getResolution(i.tileCoord[0]),A=e.pixelRatio/i.wantedResolution*w,k=_.getResolution(p),R=i.getContext(n);f=Math.round(Math.max(f,A/f));let q=m.getTilePixelSize(p,f,y);R.canvas.width=q[0],R.canvas.height=q[1];let X=f/A;if(X!==1){let me=ek(this.tmpTransform_);xv(me,X,X),R.setTransform.apply(R,me)}let ie=_.getTileCoordExtent(h,this.tmpExtent),ae=A/k,be=ek(this.tmpTransform_);xv(be,ae,-ae),rz(be,-ie[0],-ie[3]);for(let me=0,fe=l.length;me<fe;++me)l[me].execute(R,[R.canvas.width*X,R.canvas.height*X],be,0,!0,K1e[n.getRenderMode()],null);o.renderedTileResolution=i.wantedResolution}},xK=L6;var k6=class extends lb{constructor(i){i=i||{};let e=Object.assign({},i);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un;let n=i.renderMode||"hybrid";Hi(n=="hybrid"||n=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=n,this.setPreload(i.preload?i.preload:0),this.setUseInterimTilesOnError(i.useInterimTilesOnError!==void 0?i.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new xK(this)}getFeatures(i){return super.getFeatures(i)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(of.PRELOAD)}getUseInterimTilesOnError(){return this.get(of.USE_INTERIM_TILES_ON_ERROR)}setPreload(i){this.set(of.PRELOAD,i)}setUseInterimTilesOnError(i){this.set(of.USE_INTERIM_TILES_ON_ERROR,i)}},Jb=k6;var B2=class extends Qm{messageService;authInterceptor;type="vector";watcher;constructor(i,e,n){super(i,e,n),this.messageService=e,this.authInterceptor=n,this.watcher=new Qb(this),this.status$=this.watcher.status$}createOlLayer(){let i=Object.assign({},this.options,{source:this.options.source.ol}),e=new Jb(i);return e.getSource().setTileLoadFunction((o,s)=>{let l=this.customLoader(s,o.getFormat(),this.authInterceptor,o.onLoad.bind(o));l&&o.setLoader(l)}),e}customLoader(i,e,n,o,s){return(l,h,p)=>{let m=new XMLHttpRequest,f=i;if(typeof i!="function"){let g=n.alterUrlWithKeyAuth(i);g&&(f=g)}else f=i(l,h,p);m.open("GET",f),n&&n.interceptXhr(m,f),e.getType()==="arraybuffer"&&(m.responseType="arraybuffer"),m.onload=()=>{if(!m.status||m.status>=200&&m.status<300){let g=e.getType(),y;g==="json"||g==="text"?y=m.responseText:g==="xml"?(y=m.responseXML,y||(y=new DOMParser().parseFromString(m.responseText,"application/xml"))):g==="arraybuffer"&&(y=m.response),y?o.call(this,e.readFeatures(y,{extent:l,featureProjection:p}),e.readProjection(y)):s.call(this)}else s.call(this)},m.onerror=()=>{s.call(this)},m.send()}}init(i){i===void 0?this.watcher.unsubscribe():this.watcher.subscribe(()=>{}),super.init(i)}remove(){this.watcher.unsubscribe(),super.remove()}};var SK="local-group_",jE=class r extends N5{children;options;parent;expanded;isInResolutionsRange$$;isInResolutionsRange$=new ut(!0);get saveableOptions(){return En(ur({},super.saveableOptions),{id:String(this.options.id).includes(SK)?null:this.options.id,type:this.options.type,children:[...this.children].map(i=>i.saveableOptions).filter(Boolean),expanded:this.expanded})}get descendants(){return this._getDescendants()}get descendantsLevel(){return this._getDescendantsLevel()}constructor(i,e){super(e),this.children=i,this.options=e,this.children=i??[],this.expanded=e.expanded===void 0?!1:e.expanded,e.id||(e.id=SK+rn()),this.ol=this.createOlLayer(),super.afterCreated()}init(i){super.init(i),this.children.forEach(e=>e.init(i))}add(i){super.add(i),this.setChildrenObserver(),this.children.forEach(e=>{e.add(this)})}addChild(...i){this.ol.getLayers().extend(i.map(e=>e.ol)),i.forEach(e=>{this.hasChildren(e)||(e.addParent(this),this.children.push(e))}),this.setChildrenObserver()}remove(){super.remove(),this.children.forEach(i=>i.remove())}removeChild(i){this.ol.getLayers().remove(i.ol);let e=this.children.indexOf(i);e>=0&&this.children.splice(e,1),i.parent=null,i.options.parentId=null,this.setChildrenObserver()}isDescendant(i){return this._getDescendants().some(e=>e.id===i.id)}setChildrenObserver(){if(this.isInResolutionsRange$$?.unsubscribe(),!this.children)return;let i=this.children.map(e=>e.isInResolutionsRange$);this.isInResolutionsRange$$=Ts(i).subscribe(e=>{this.isInResolutionsRange=e.some(n=>n)})}createOlLayer(){return new Dp({properties:{title:this.title}})}hasChildren(i){return this.children.some(e=>e.id===i.id)}_getDescendants(i=this.children){return i.reduce((e,n)=>n instanceof r?e.concat(n,...this._getDescendants(n.children)):e.concat(n),[])}_getDescendantsLevel(i=this.children){return i.reduce((e,n)=>{if(n instanceof r){e=e+1;let o=this._getDescendantsLevel(n.children);return e+o}return e},0)}};var Q1e=["renderedLegend"],J1e=r=>({"with-title":r});function eve(r,i){if(r&1){let e=We();$(0,"mat-list-item")(1,"mat-icon",9),ve("toggle",function(o){we(e);let s=ne(2).$implicit,l=ne(3);return xe(l.toggleLegendItem(o,s))}),_e(2,"expand_less "),ee(),$(3,"span",10),_e(4),le(5,"async"),ee()()}if(r&2){ne();let e=Xt(3),n=ne().$implicit,o=ne(3);j(),z("target",e)("collapsed",n.collapsed),j(3),Qe("",ce(5,3,o.computeItemTitle(n))," ")}}function tve(r,i){if(r&1&&($(0,"mat-option",14),_e(1),ee()),r&2){let e=i.$implicit;z("value",e.name),j(),bt(e.title)}}function ive(r,i){if(r&1){let e=We();$(0,"mat-form-field",11)(1,"mat-select",12),le(2,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(5);return Jn(s.currentStyle,o)||(s.currentStyle=o),xe(o)}),ve("selectionChange",function(){we(e);let o=ne(5);return xe(o.onChangeStyle())}),Pe(3,tve,2,2,"mat-option",13),ee()()}if(r&2){let e=ne(5);j(),z("matTooltip",ce(2,3,"igo.geo.layer.legend.selectStyle")),Qn("ngModel",e.currentStyle),j(2),z("ngForOf",e.styles)}}function rve(r,i){if(r&1){let e=We();$(0,"img",17,3),le(2,"translate"),ve("load",function(){we(e);let o=ne(4).$implicit,s=ne(3);return xe(s.onLoadImage(o.title))}),ee()}if(r&2){let e=ne(4).$implicit;sr("id",e.title),sr("alt",ce(2,4,"igo.geo.layer.legend.loadingLegendText")),z("hideError",!0)("src",e.imgGraphValue,Rf)}}function nve(r,i){r&1&&($(0,"small"),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLegendScale")," "))}function ove(r,i){if(r&1&&($(0,"div"),Pe(1,rve,3,6,"img",16)(2,nve,3,3,"small",4),ee()),r&2){let e=ne(3).$implicit,n=ne(3);j(),z("ngIf",e.imgGraphValue),j(),z("ngIf",n.imagesHeight[e.title]<16)}}function ave(r,i){if(r&1&&(ct(0,"div",18),le(1,"sanitizeHtml")),r&2){let e=ne(3).$implicit;z("ngStyle",e.style)("innerHTML",ce(1,2,e.html),hm)}}function sve(r,i){if(r&1&&($(0,"div"),Pe(1,ove,3,2,"div",4)(2,ave,2,4,"div",15),ee()),r&2){let e=ne(2).$implicit;j(),z("ngIf",e.url),j(),z("ngIf",e.html)}}function lve(r,i){if(r&1&&($(0,"div"),Pe(1,eve,6,5,"mat-list-item",4),$(2,"div",7,2),Pe(4,ive,4,5,"mat-form-field",8)(5,sve,3,2,"div",4),ee()()),r&2){let e=ne().$implicit,n=ne(3);j(),z("ngIf",e.title),j(),z("ngClass",fn(4,J1e,e.title)),j(2),z("ngIf",n.currentStyle!==void 0),j(),z("ngIf",!e.collapsed)}}function cve(r,i){if(r&1&&(Dr(0,null,1),Pe(2,lve,6,6,"div",5),Rr()),r&2){ne(2);let e=Xt(3),n=ne();j(2),z("ngIf",n.getLegend)("ngIfElse",e)}}function uve(r,i){if(r&1&&(Dr(0),Pe(1,cve,3,2,"ng-container",6),Rr()),r&2){let e=ne().ngIf;j(),z("ngForOf",e.slice().reverse())}}function dve(r,i){r&1&&($(0,"small"),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLegendText")," "))}function hve(r,i){if(r&1&&(Dr(0),Pe(1,uve,2,1,"ng-container",5)(2,dve,3,3,"ng-template",null,0,Ac),Rr()),r&2){let e=i.ngIf,n=Xt(3);j(),z("ngIf",e.length)("ngIfElse",n)}}var Up=(()=>{class r{capabilitiesService;languageService;configService;http;cdRef;updateLegendOnResolutionChange=!1;legendItems$=new ut([]);state$$;styles;currentStyle;scale=void 0;view=void 0;renderedLegends;imagesHeight={};layer;getLegend=!0;constructor(e,n,o,s,l){this.capabilitiesService=e,this.languageService=n,this.configService=o,this.http=s,this.cdRef=l}ngOnInit(){let e=this.layer.legend;this.styles=this.listStyles();let n=this.layer.options.source.options;if(n&&n.params&&n.params.STYLES?this.currentStyle=this.styles.find(o=>o.name===n.params.STYLES).name:e?this.styles&&this.styles.length>1&&(this.currentStyle=e[0].currentStyle):this.styles&&this.styles.length>1&&(this.currentStyle=this.styles[0].name),typeof this.layer.options.legendOptions<"u"&&this.layer.options.legendOptions.display===!1?e=[]:e=this.layer.dataSource.getLegend(this.currentStyle,this.view),this.updateLegendOnResolutionChange||n.contentDependentLegend){let o=this.layer.map.viewController.state$;this.state$$=o.subscribe(()=>this.onViewControllerStateChange())}else if(e&&e.length!==0){this.legendItems$.next(e);for(let o of e)this.getLegendGraphic(o)}}ngOnDestroy(){this.state$$!==void 0&&this.state$$.unsubscribe()}getLegendGraphic(e){e.url&&new R1(this.http,this.configService).transform(e.url).pipe(qr(o=>{if(o.error)return o.error.caught=!0,this.getLegend=!1,this.cdRef.detectChanges(),o})).subscribe(o=>{let s=this.legendItems$.value.findIndex(h=>h.title===e.title),l=o;this.legendItems$.value[s].imgGraphValue=l,this.cdRef.detectChanges()})}toggleLegendItem(e,n){n.collapsed=e}transfertToggleLegendItem(e){let n=e,o=this.layer.legend;for(let s=0;s<o.length;s++)n[s].collapsed=o[s].collapsed;return n}computeItemTitle(e){let n=this.layer.dataSource.options;if(n.type!=="wms")return ai(e.title);let o=n.params.LAYERS.split(","),s=JSON.parse(JSON.stringify(n));return s.params.LAYERS=o.find(l=>l===e.title),this.capabilitiesService.getWMSOptions(s).pipe(Nt(l=>l._layerOptionsFromSource.title))}onViewControllerStateChange(){this.view={resolution:this.layer.map.viewController.getResolution(),extent:this.layer.map.viewController.getExtent(),projection:this.layer.map.viewController.getOlProjection().getCode(),scale:this.layer.map.viewController.getScale(),size:this.layer.map.ol.getSize()},this.updateLegend()}updateLegend(){let e=this.layer.dataSource.getLegend(this.currentStyle,this.view);if(this.layer.legend&&this.layer.legend.length>1&&(e=this.transfertToggleLegendItem(e)),this.layer.legend=e,!(e.length===0&&this.legendItems$.value.length===0)){this.legendItems$.next(e);for(let n of this.legendItems$.value)this.getLegendGraphic(n)}}listStyles(){let e=this.layer.options;if(e&&e.legendOptions){let s=[{name:"",title:this.languageService.translate.instant("igo.geo.layer.legend.default")}];return e.legendOptions.stylesAvailable&&(s=s.concat(e.legendOptions.stylesAvailable.filter(l=>l.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")!=="default"&&l.name.normalize("NFD").replace(/[\u0300-\u036f]/gi,"")!=="defaut"))),s.filter(l=>!l.title).map(l=>l.title=l.name),s.map(l=>l.title=l.title.charAt(0).toUpperCase()+l.title.slice(1).replace(/_/g," ")),s}}onChangeStyle(){this.updateLegend();let e="";this.layer.dataSource instanceof _l&&(this.layer.dataSource.ol.getParams().LAYERS.split(",").map(()=>e+=this.currentStyle+","),e=e.slice(0,-1),this.layer.dataSource.ol.updateParams({STYLES:e}))}onLoadImage(e){let n;this.renderedLegends.length===1?n=this.renderedLegends.first.nativeElement:n=this.renderedLegends.find(o=>o.nativeElement.id===e).nativeElement,this.imagesHeight[e]=n.height}static \u0275fac=function(n){return new(n||r)(Ie(Sl),Ie(Di),Ie(Oi),Ie(Er),Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-legend"]],viewQuery:function(n,o){if(n&1&&Ir(Q1e,5),n&2){let s;bi(s=wi())&&(o.renderedLegends=s)}},inputs:{updateLegendOnResolutionChange:"updateLegendOnResolutionChange",layer:"layer"},standalone:!0,features:[lt],decls:2,vars:3,consts:[["noItems",""],["renderedLegends",""],["legend",""],["renderedLegend",""],[4,"ngIf"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[1,"igo-layer-legend",3,"ngClass"],["subscriptSizing","dynamic",4,"ngIf"],["id","legend-toggle","matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"toggle","target","collapsed"],["matListItemTitle",""],["subscriptSizing","dynamic"],["tooltip-position","below","matTooltipShowDelay","500",3,"ngModelChange","selectionChange","matTooltip","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[3,"ngStyle","innerHTML",4,"ngIf"],["igoImageError","",3,"hideError","id","src","alt","load",4,"ngIf"],["igoImageError","",3,"load","hideError","id","src","alt"],[3,"ngStyle","innerHTML"]],template:function(n,o){n&1&&(Pe(0,hve,4,2,"ng-container",4),le(1,"async")),n&2&&z("ngIf",ce(1,1,o.legendItems$))},dependencies:[Gt,Li,Io,ks,oc,Ta,jt,$t,Vp,_a,jr,Gr,ho,uo,Nn,Qt,ti,Sn,kn,nc,Bn,GA,cl,Ei,Et,Tt,JG],styles:[`[_nghost-%COMP%]   .igo-layer-legend.with-title[_ngcontent-%COMP%]{padding-left:18px}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%}[_nghost-%COMP%]   img[_ngcontent-%COMP%]:after{content:" ";position:relative;height:17px;float:left;width:17px;top:-3px;right:19px;background-color:#fff;border:3px solid #f3f3f3;border-radius:50%;animation:2s linear infinite _ngcontent-%COMP%_spin}@-moz-document url-prefix(){-shadowcsshost-no-combinator img:after{margin-left:19px}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}mat-form-field[_ngcontent-%COMP%]{margin-bottom:4px}
/*# sourceMappingURL=layer-legend.component-QIILJQVE.css.map */`],changeDetection:0})}return r})();var pve=["*"];function mve(r,i){if(r&1){let e=We();$(0,"mat-checkbox",9),ve("change",function(o){we(e);let s=ne();return xe(s.handleSelect(o))}),ee()}if(r&2){let e=ne();z("checked",e.selected)("disabled",e.selectionDisabled)}}function fve(r,i){if(r&1){let e=We();$(0,"button",10),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.toggleLayerTool())}),$(2,"mat-icon"),_e(3,"more_horiz"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.layer.moreOptions"))}function gve(r,i){if(r&1&&($(0,"div",11),ct(1,"igo-layer-legend",12),ee()),r&2){let e=ne();j(),z("layer",e.layer)("updateLegendOnResolutionChange",e.viewerOptions.legend.updateOnResolutionChange)}}var O6=(()=>{class r{networkService;showLegend$=new ut(!0);inResolutionRange$=new ut(!0);queryBadgeHidden$=new ut(!0);tooltipText;state;resolution$$;network$$;layer;visible;selected;selectionDisabled;viewerOptions;action=new Ke;selectChange=new Ke;visibilityChange=new Ke(void 0);isDisabled;get opacity(){return this.layer.opacity*100}set opacity(e){this.layer.opacity=e/100}get visibilityTooltip(){return this.viewerOptions.mode!=="selection"&&this.inResolutionRange$.getValue()===!1?"igo.geo.layer.notInResolution":this.layer.visible&&this.isDisabled?"igo.geo.layer.group.hideChildren":this.layer.visible?"igo.geo.layer.hideLayer":"igo.geo.layer.showLayer"}constructor(e){this.networkService=e}ngOnInit(){this.layer.displayed$.subscribe(n=>{this.isDisabled=!n}),this.layer.visible&&this.viewerOptions?.legend?.showForVisibleLayers&&this.layer.firstLoadComponent===!0&&(this.layer.firstLoadComponent=!1,this.layer.legendCollapsed=!1),this.toggleLegend(this.layer.legendCollapsed),this.updateQueryBadge();let e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(n=>{this.state=n,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$?.unsubscribe(),this.network$$?.unsubscribe()}toggleLegend(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)}toggleLegendOnClick(){this.toggleLegend(this.showLegend$.value)}handleVisibilityChange(e){e.stopPropagation(),this.viewerOptions.legend.showOnVisibilityChange&&this.toggleLegend(!this.layer.visible),this.updateQueryBadge(),this.visibilityChange.emit(e)}computeTooltip(){let e=this.layer.options;if(!e.tooltip)return this.layer.title;let n=e.tooltip,o=e.metadata;switch(e.tooltip.type){case oh.TITLE:return this.layer.title;case oh.ABSTRACT:return o&&o.abstract?o.abstract:this.layer.title;case oh.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){let e=this.layer.isInResolutionsRange;e===!1&&this.viewerOptions.legend.updateOnResolutionChange===!0&&this.toggleLegend(!0),this.inResolutionRange$.next(e)}updateQueryBadge(){let e=this.viewerOptions.queryBadge===!1||this.layer.visible===!1||!Xb(this.layer);this.queryBadgeHidden$.next(e)}toggleLayerTool(){this.action.emit(this.layer)}handleSelect(e){this.selectChange.emit(e.checked)}static \u0275fac=function(n){return new(n||r)(Ie(jf))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-item"]],hostVars:2,hostBindings:function(n,o){n&2&&dr("disabled",o.isDisabled)},inputs:{layer:"layer",visible:"visible",selected:"selected",selectionDisabled:"selectionDisabled",viewerOptions:"viewerOptions"},outputs:{action:"action",selectChange:"selectChange",visibilityChange:"visibilityChange"},standalone:!0,features:[lt],ngContentSelectors:pve,decls:14,vars:16,consts:[[1,"igo-layer-list-item"],[1,"layer-content"],[3,"checked","disabled","change",4,"ngIf"],["matTooltipShowDelay","500",1,"igo-layer-title",3,"click","matTooltip"],[1,"list-actions"],[1,"list-secondary-actions"],["class","actions-button","tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[3,"visibilityChange","layer","tooltip","disabled","inResolutionsRange","showQueryBadge"],["class","igo-layer-legend-container",4,"ngIf"],[3,"change","checked","disabled"],["tooltip-position","below","matTooltipShowDelay","500","mat-icon-button","","color","primary",1,"actions-button",3,"click","matTooltip"],[1,"igo-layer-legend-container"],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,o){n&1&&(Kn(),$(0,"div",0)(1,"div",1),Pe(2,mve,1,2,"mat-checkbox",2),Tn(3),$(4,"span",3),ve("click",function(){return o.toggleLegendOnClick()}),_e(5),ee()(),$(6,"div",4)(7,"div",5),Pe(8,fve,4,3,"button",6),ee(),$(9,"igo-layer-visibility-button",7),le(10,"async"),le(11,"async"),ve("visibilityChange",function(l){return o.handleVisibilityChange(l)}),ee()()(),Pe(12,gve,2,2,"div",8),le(13,"async")),n&2&&(j(2),z("ngIf",o.viewerOptions.mode==="selection"),j(2),z("matTooltip",o.tooltipText),j(),Qe(" ",o.layer.title," "),j(3),z("ngIf",o.viewerOptions.mode!=="selection"),j(),z("layer",o.layer)("tooltip",o.visibilityTooltip)("disabled",o.isDisabled)("inResolutionsRange",ce(10,10,o.layer.isInResolutionsRange$))("showQueryBadge",ce(11,12,o.queryBadgeHidden$)===!1),j(3),z("ngIf",ce(13,14,o.showLegend$)))},dependencies:[Io,Gt,hl,ac,Qt,ti,Vt,ci,jt,$t,xl,Up,Ei,Et,Tt,R2],styles:[`[_nghost-%COMP%]     .list-secondary-actions button{visibility:hidden}[_nghost-%COMP%]     .list-secondary-actions button.disabled{visibility:visible}[_nghost-%COMP%]:hover     .list-secondary-actions button{visibility:visible}.disabled[_nghost-%COMP%]     .igo-layer-title, .disabled[_nghost-%COMP%]     .list-secondary-actions{opacity:.54}[_nghost-%COMP%]{overflow:hidden}.list-actions[_ngcontent-%COMP%]{display:flex;margin-left:4px;margin-right:4px}.layer-content[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.igo-layer-title[_ngcontent-%COMP%]{display:block;cursor:pointer;max-height:48px;white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;box-orient:vertical;-webkit-box-orient:vertical;line-clamp:2;-webkit-line-clamp:2}.igo-layer-list-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.igo-layer-legend-container[_ngcontent-%COMP%]{padding-top:4px;width:calc(100% - 12px)}
/*# sourceMappingURL=layer-item.component-52DC2H2R.css.map */`],changeDetection:0})}return r})();var D6=(()=>{class r{networkService;inResolutionRange$=new ut(!0);tooltipText;state;resolution$$;network$$;layer;updateLegendOnResolutionChange=!1;constructor(e){this.networkService=e}ngOnInit(){let e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(()=>{this.onResolutionChange()}),this.tooltipText=this.computeTooltip(),this.network$$=this.networkService.currentState().subscribe(n=>{this.state=n,this.onResolutionChange()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.network$$.unsubscribe()}computeTooltip(){let e=this.layer.options;if(!e.tooltip)return this.layer.title;let n=e.tooltip,o=e.metadata;switch(e.tooltip.type){case oh.TITLE:return this.layer.title;case oh.ABSTRACT:return o&&o.abstract?o.abstract:this.layer.title;case oh.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onResolutionChange(){let e=this.layer.isInResolutionsRange;this.inResolutionRange$.next(e)}static \u0275fac=function(n){return new(n||r)(Ie(jf))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-legend-item"]],inputs:{layer:"layer",updateLegendOnResolutionChange:"updateLegendOnResolutionChange"},standalone:!0,features:[lt],decls:6,vars:4,consts:[["legend",""],[1,"igo-layer-list-item"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-layer-title",3,"matTooltip"],[1,"igo-layer-legend-container"],[3,"layer","updateLegendOnResolutionChange"]],template:function(n,o){n&1&&($(0,"mat-list-item",1)(1,"span",2),_e(2),ee()(),$(3,"div",3,0),ct(5,"igo-layer-legend",4),ee()),n&2&&(j(),z("matTooltip",o.tooltipText),j(),bt(o.layer.title),j(3),z("layer",o.layer)("updateLegendOnResolutionChange",o.updateLegendOnResolutionChange))},dependencies:[Io,ks,Ta,Qt,ti,Up],styles:[`[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-layer-list-item[_ngcontent-%COMP%]{height:48px;clear:both}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px)}
/*# sourceMappingURL=layer-legend-item.component-TO3RGBZA.css.map */`],changeDetection:0})}return r})();var Qo=(()=>{class r{renderer;el;static focusedCls="igo-list-item-focused";static selectedCls="igo-list-item-selected";static disabledCls="igo-list-item-disabled";get color(){return this._color}set color(e){this._color=e}_color="primary";get focused(){return this._focused}set focused(e){e!==this._focused&&(this.disabled||(e?this.beforeFocus.emit(this):this.beforeUnfocus.emit(this),this._focused=e,this.selected!==!0&&this.toggleFocusedClass(),e?this.focus.emit(this):this.unfocus.emit(this)))}_focused=!1;get selected(){return this._selected}set selected(e){e!==this._selected&&(this.disabled||(e?this.beforeSelect.emit(this):this.beforeUnselect.emit(this),this._selected=e,this._focused=e,this.toggleSelectedClass(),e?this.select.emit(this):this.unselect.emit(this)))}_selected=!1;get disabled(){return this._disabled}set disabled(e){e!==this._disabled&&(e===!0&&(this.selected=!1),e?this.beforeDisable.emit(this):this.beforeEnable.emit(this),this._disabled=e,this.toggleDisabledClass(),e?this.disable.emit(this):this.enable.emit(this))}_disabled=!1;beforeSelect=new Ke;beforeFocus=new Ke;beforeUnselect=new Ke;beforeUnfocus=new Ke;beforeDisable=new Ke;beforeEnable=new Ke;focus=new Ke;unfocus=new Ke;select=new Ke;unselect=new Ke;disable=new Ke;enable=new Ke;onClick(){this.selected=!0}constructor(e,n){this.renderer=e,this.el=n}getOffsetTop(){return this.el.nativeElement.offsetTop-5}toggleFocusedClass(){this.focused?this.addCls(r.focusedCls):this.removeCls(r.focusedCls)}toggleSelectedClass(){this.selected?(this.addCls(r.selectedCls),this.removeCls(r.focusedCls)):this.removeCls(r.selectedCls)}toggleDisabledClass(){this.disabled?this.addCls(r.disabledCls):this.removeCls(r.disabledCls)}addCls(e){this.renderer.addClass(this.el.nativeElement,e)}removeCls(e){this.renderer.removeClass(this.el.nativeElement,e)}static \u0275fac=function(n){return new(n||r)(Ie(s0),Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","igoListItem",""]],hostBindings:function(n,o){n&1&&ve("click",function(){return o.onClick()})},inputs:{color:"color",focused:"focused",selected:"selected",disabled:"disabled"},outputs:{beforeSelect:"beforeSelect",beforeFocus:"beforeFocus",beforeUnselect:"beforeUnselect",beforeUnfocus:"beforeUnfocus",beforeDisable:"beforeDisable",beforeEnable:"beforeEnable",focus:"focus",unfocus:"unfocus",select:"select",unselect:"unselect",disable:"disable",enable:"enable"},standalone:!0})}return r})();var CK=(()=>{class r{el;clickout=new Ke;handleMouseClick(e,n){n&&(this.el.nativeElement.contains(n)||this.clickout.emit(e))}constructor(e){this.el=e}static \u0275fac=function(n){return new(n||r)(Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","igoClickout",""]],hostBindings:function(n,o){n&1&&ve("click",function(l){return o.handleMouseClick(l,l.target)},!1,X_)},outputs:{clickout:"clickout"},standalone:!0})}return r})();var _ve=["*"],yve=r=>({selectable:r}),yc=(()=>{class r{el;get navigation(){return this._navigation}set navigation(e){this._navigation=e}_navigation=!0;get selection(){return this._selection}set selection(e){this._selection=e}_selection=!0;get selectedItem(){return this._selectedItem}set selectedItem(e){this.focusedItem=e,this._selectedItem=e}_selectedItem;get focusedItem(){return this._focusedItem}set focusedItem(e){this._focusedItem=e}_focusedItem;navigationEnabled;listItems$$;subscriptions=[];listItems;handleKeyboardEvent(e){this.navigationEnabled&&(e.key==="ArrowUp"||e.key==="ArrowDown"?(e.preventDefault(),this.navigate(e.key)):e.key==="Enter"&&this.select(this.focusedItem))}constructor(e){this.el=e}ngOnInit(){this.enableNavigation()}ngAfterViewInit(){this.listItems.length&&this.init(),this.listItems$$=this.listItems.changes.subscribe(()=>this.init())}ngOnDestroy(){this.listItems$$.unsubscribe()}focus(e){this.selection&&(this.unfocus(),e!==void 0&&(e.focused=!0))}unfocus(){this.focusedItem!==void 0&&(this.focusedItem.focused=!1),this.focusedItem=void 0}focusNext(){let e=this.listItems.toArray(),n,o=this.el.nativeElement,s=!0,l=this.getFocusedIndex();for(l===void 0&&(l=-1);s&&l<e.length-1;)l+=1,n=e[l],s=n.disabled;if(n!==void 0&&this.focus(n),!e[l+1]){o.scrollTop=o.scrollHeight-o.clientHeight;return}n!==void 0&&!this.isScrolledIntoView(n.el.nativeElement)&&(o.scrollTop=n.el.nativeElement.offsetTop+n.el.nativeElement.children[0].offsetHeight-o.clientHeight)}focusPrevious(){let e=this.listItems.toArray(),n,o=this.el.nativeElement,s=!0,l=this.getFocusedIndex();for(;s&&l>0;)l-=1,n=e[l],s=n.disabled;if(n!==void 0&&this.focus(n),!e[l-1]){o.scrollTop=0;return}n!==void 0&&!this.isScrolledIntoView(n.el.nativeElement)&&(o.scrollTop=n.el.nativeElement.offsetTop-3)}select(e){this.selection&&(this.unselect(),e!==void 0&&(e.selected=!0))}unselect(){this.unfocus(),this.selectedItem!==void 0&&(this.selectedItem.selected=!1),this.selectedItem=void 0}enableNavigation(){this.navigation&&(this.navigationEnabled=!0)}disableNavigation(){this.navigationEnabled=!1}scrollToItem(e){this.el.nativeElement.scrollTop=e.getOffsetTop()}isScrolledIntoView(e){let n=this.el.nativeElement.scrollTop+this.el.nativeElement.offsetTop,o=n+this.el.nativeElement.clientHeight,s=e.offsetTop;return s+e.children[0].offsetHeight<=o&&s>=n}init(){this.subscribe(),this.selectedItem=this.findSelectedItem(),this.focusedItem=this.findFocusedItem(),this.enableNavigation()}subscribe(){this.unsubscribe(),this.listItems.toArray().forEach(e=>{this.subscriptions.push(e.beforeSelect.subscribe(n=>this.handleItemBeforeSelect(n))),this.subscriptions.push(e.select.subscribe(n=>this.handleItemSelect(n))),this.subscriptions.push(e.beforeFocus.subscribe(n=>this.handleItemBeforeFocus(n))),this.subscriptions.push(e.focus.subscribe(n=>this.handleItemFocus(n)))},this)}unsubscribe(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[]}handleItemBeforeFocus(e){e!==this.focusedItem&&this.unfocus()}handleItemFocus(e){this.focusedItem=e}handleItemBeforeSelect(e){e!==this.focusedItem&&this.unselect()}handleItemSelect(e){this.selectedItem=e}findSelectedItem(){return this.listItems.toArray().find(e=>e.selected)}findFocusedItem(){return this.listItems.toArray().find(e=>e.focused)}getFocusedIndex(){return this.listItems.toArray().findIndex(e=>e===this.focusedItem)}navigate(e){switch(e){case"ArrowUp":this.focusPrevious();break;case"ArrowDown":this.focusNext();break;default:break}}static \u0275fac=function(n){return new(n||r)(Ie(ar))};static \u0275cmp=nt({type:r,selectors:[["igo-list"]],contentQueries:function(n,o,s){if(n&1&&Do(s,Qo,5),n&2){let l;bi(l=wi())&&(o.listItems=l)}},hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o.handleKeyboardEvent(l)},!1,X_)("enter",function(l){return o.handleKeyboardEvent(l)},!1,X_)},inputs:{navigation:"navigation",selection:"selection"},standalone:!0,features:[lt],ngContentSelectors:_ve,decls:2,vars:3,consts:[["igoClickout","",3,"clickout","click","ngClass"]],template:function(n,o){n&1&&(Kn(),$(0,"mat-list",0),ve("clickout",function(){return o.disableNavigation()})("click",function(){return o.enableNavigation()}),Tn(1),ee()),n&2&&z("ngClass",fn(1,yve,o.selection))},dependencies:[Io,RA,CK,_a],styles:[`[_nghost-%COMP%]{display:block;height:100%;overflow:auto;position:relative}[_nghost-%COMP%]   mat-list[_ngcontent-%COMP%]{padding-top:0}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item .mdc-list-item__primary-text{white-space:normal;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;max-height:36px;line-height:18px;-webkit-box-orient:vertical;-webkit-line-clamp:2}[_nghost-%COMP%]     .mat-mdc-list .mat-mdc-list-item.mdc-list-item--with-leading-icon{height:48px}[_nghost-%COMP%]     .mat-mdc-list   igo-collapsible>.mat-mdc-list-item>.mdc-list-item__primary-text>.mat-mdc-list-item{font-weight:700;opacity:.9}[_nghost-%COMP%]   mat-list.selectable[_ngcontent-%COMP%]     [igolistitem]:not(.igo-list-item-disabled) mat-list-item:hover{cursor:pointer}[_nghost-%COMP%]     [igolistitem]:focus{outline:none}
/*# sourceMappingURL=list.component-6C5LDK3W.css.map */`]})}return r})();function vve(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",6),le(1,"translate"),ve("change",function(o){we(e);let s=ne();return xe(s.toggleShowAllLegends(o.checked))}),_e(2),le(3,"translate"),ee()}if(r&2){let e=ne();z("matTooltip",ce(1,4,"igo.geo.layer.legend.showAll"))("checked",e.showAllLegendsValue)("labelPosition","before"),j(2),Qe(" ",ce(3,6,"igo.geo.layer.legend.showAll")," ")}}function bve(r,i){r&1&&ct(0,"mat-divider")}function wve(r,i){if(r&1&&ct(0,"igo-layer-legend-item",8),r&2){let e=ne().$implicit,n=ne();z("layer",e)("updateLegendOnResolutionChange",n.updateLegendOnResolutionChange)}}function xve(r,i){if(r&1&&Pe(0,wve,1,2,"igo-layer-legend-item",7),r&2){let e=i.$implicit,n=ne();z("ngIf",!(n.excludeBaseLayers&&n.isLayerItem(e)&&e.baseLayer))}}function Sve(r,i){r&1&&($(0,"p",9),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButton")," "))}function Cve(r,i){r&1&&($(0,"p",9),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLayersVisibleWithShowAllButtonButZoom")," "))}function Ave(r,i){r&1&&($(0,"p",9),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLayersVisible")," "))}function Mve(r,i){r&1&&($(0,"p",9),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.layer.legend.noLayersVisibleButZoom")," "))}var R6=(()=>{class r{orderable=!0;hasVisibleOrInRangeLayers$=new ut(!0);hasVisibleAndNotInRangeLayers$=new ut(!0);layersInUi$=new ut([]);layers$=new ut([]);showAllLegend=!1;change$=new g7(1);change$$;layers;excludeBaseLayers=!1;updateLegendOnResolutionChange=!1;allowShowAllLegends=!1;showAllLegendsValue=!1;allLegendsShown=new Ke(!1);isLayerItem=jn;ngOnInit(){this.change$$=this.change$.pipe(o0(()=>this.layers.length===0?Gd:dm(50))).subscribe(()=>{let e=this.computeShownLayers(this.layers.slice(0));this.layers$.next(e),this.hasVisibleOrInRangeLayers$.next(this.layers.slice(0).filter(n=>!cd(n)).filter(n=>n.displayed).length>0),this.hasVisibleAndNotInRangeLayers$.next(this.layers.slice(0).filter(n=>!cd(n)).filter(n=>n.visible&&!n.isInResolutionsRange).length>0),this.layersInUi$.next(this.layers.slice(0).filter(n=>n.showInLayerList!==!1&&(!this.excludeBaseLayers||!cd(n))))})}ngOnDestroy(){this.change$$.unsubscribe()}next(){this.change$.next()}computeShownLayers(e){let n=e.filter(o=>o.displayed);return this.showAllLegendsValue&&(n=e),F0(n,"desc")}toggleShowAllLegends(e){this.showAllLegendsValue=e,this.next(),this.allLegendsShown.emit(e)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-layer-legend-list"]],inputs:{layers:"layers",excludeBaseLayers:"excludeBaseLayers",updateLegendOnResolutionChange:"updateLegendOnResolutionChange",allowShowAllLegends:"allowShowAllLegends",showAllLegendsValue:"showAllLegendsValue"},outputs:{allLegendsShown:"allLegendsShown"},standalone:!0,features:[lt],decls:24,vars:39,consts:[[1,"layer-legend-list-container"],["tooltip-position","above","matTooltipShowDelay","500","class","mat-typography",3,"matTooltip","checked","labelPosition","change",4,"ngIf"],[4,"ngIf"],[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["class","layers-empty mat-typography",4,"ngIf"],["tooltip-position","above","matTooltipShowDelay","500",1,"mat-typography",3,"change","matTooltip","checked","labelPosition"],["igoListItem","",3,"layer","updateLegendOnResolutionChange",4,"ngIf"],["igoListItem","",3,"layer","updateLegendOnResolutionChange"],[1,"layers-empty","mat-typography"]],template:function(n,o){n&1&&($(0,"div",0),Pe(1,vve,4,8,"mat-slide-toggle",1),le(2,"async"),Pe(3,bve,1,0,"mat-divider",2),le(4,"async"),$(5,"igo-list",3),Pe(6,xve,1,1,"ng-template",4),le(7,"async"),ee(),Pe(8,Sve,3,3,"p",5),le(9,"async"),le(10,"async"),le(11,"async"),Pe(12,Cve,3,3,"p",5),le(13,"async"),le(14,"async"),le(15,"async"),Pe(16,Ave,3,3,"p",5),le(17,"async"),le(18,"async"),le(19,"async"),Pe(20,Mve,3,3,"p",5),le(21,"async"),le(22,"async"),le(23,"async"),ee()),n&2&&(j(),z("ngIf",ce(2,9,o.layersInUi$).length&&o.allowShowAllLegends),j(2),z("ngIf",ce(4,11,o.layersInUi$).length&&o.allowShowAllLegends),j(2),z("navigation",!1)("selection",!1),j(),z("ngForOf",ce(7,13,o.layers$)),j(2),z("ngIf",!o.showAllLegendsValue&&ce(9,15,o.layersInUi$).length&&ce(10,17,o.hasVisibleOrInRangeLayers$)===!1&&ce(11,19,o.hasVisibleAndNotInRangeLayers$)===!1&&o.allowShowAllLegends),j(4),z("ngIf",!o.showAllLegendsValue&&ce(13,21,o.layersInUi$).length&&ce(14,23,o.hasVisibleOrInRangeLayers$)===!1&&ce(15,25,o.hasVisibleAndNotInRangeLayers$)&&o.allowShowAllLegends),j(4),z("ngIf",ce(17,27,o.layersInUi$).length&&ce(18,29,o.hasVisibleOrInRangeLayers$)===!1&&ce(19,31,o.hasVisibleAndNotInRangeLayers$)===!1&&!o.allowShowAllLegends),j(4),z("ngIf",ce(21,33,o.layersInUi$).length&&ce(22,35,o.hasVisibleOrInRangeLayers$)===!1&&ce(23,37,o.hasVisibleAndNotInRangeLayers$)&&!o.allowShowAllLegends))},dependencies:[Gt,bl,js,Qt,ti,dl,Uc,yc,Li,D6,Qo,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{display:contents}[_nghost-%COMP%]   .layers-empty[_ngcontent-%COMP%]{text-align:justify;margin:10px}[_nghost-%COMP%]   .layer-legend-list-container[_ngcontent-%COMP%]{max-height:100%;overflow:auto}
/*# sourceMappingURL=layer-legend-list.component-34FYO2KJ.css.map */`],changeDetection:0})}return r})();var Eve=(()=>{class r{mapService;component;layersOrResolutionChange$$;layersVisibility$$;constructor(e,n){this.mapService=n,this.component=e}ngOnInit(){this.component.layers=[],this.layersOrResolutionChange$$=Ts([this.mapService.getMap().layerController.all$,this.mapService.getMap().viewController.resolution$]).pipe(Br(10)).subscribe(e=>{let n=e[0].filter(o=>jn(o)&&o.showInLayerList===!0);this.component.layers=n,this.layersVisibility$$=Ts(n.map(o=>o.visible$)).subscribe(()=>this.component.change$.next())})}ngOnDestroy(){this.layersOrResolutionChange$$.unsubscribe(),this.layersVisibility$$!==void 0&&(this.layersVisibility$$.unsubscribe(),this.layersVisibility$$=void 0)}static \u0275fac=function(n){return new(n||r)(Ie(R6,2),Ie(nf))};static \u0275dir=Fi({type:r,selectors:[["","igoLayerLegendListBinding",""]],standalone:!0})}return r})();var VE=(()=>{class r{el;set igoMatBadgeIcon(e){this.html=`
      <mat-icon class="mat-icon material-symbols-outlined" style="height: 16px; width: 16px; font-size: 16px;">${e}</mat-icon>
    `,this.updateHtml()}html;set matBadgeHidden(e){this.hidden=e,this.updateHidden()}hidden=!1;set matBadgeDisabled(e){this.disabled=e,this.updateDisabled()}disabled=!1;set igoMatBadgeInverseColor(e){this.inverseColor=e,this.updateColor()}inverseColor=!1;set igoMatBadgeInheritColor(e){this.inheritColor=e,this.updateColor()}inheritColor=!1;set igoMatBadgeColor(e){this.color=e,this.updateColor()}color;set igoMatBadgeBackgroundColor(e){this.backgroundColor=e,this.updateColor()}backgroundColor;get badge(){return this.el.nativeElement.querySelector(".mat-badge-content")}originalColor;constructor(e){this.el=e}ngOnInit(){this.badge.style.alignItems="center",this.badge.style.justifyContent="center",this.updateHidden(),this.updateColor(),this.updateHtml()}updateHtml(){this.badge&&(this.badge.innerHTML="",this.html&&(this.badge.innerHTML=this.html))}updateColor(){this.badge&&(this.color||this.backgroundColor?(this.badge.style.color=this.color?this.color:"",this.badge.style.background=this.backgroundColor?this.backgroundColor:""):this.inheritColor?this.inverseColor?(this.badge.style.color="currentColor",this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="currentColor"):this.inheritColor||(this.inverseColor?(this.badge.style.color=window.getComputedStyle(this.badge,null).getPropertyValue("background-color"),this.badge.style.background="none"):(this.badge.style.color="",this.badge.style.background="")),this.originalColor=this.badge.style.color,this.updateDisabled())}updateHidden(){this.badge&&(this.badge.style.display=this.hidden?"none":"flex")}updateDisabled(){!this.badge||!this.inverseColor||(this.disabled?(this.originalColor=this.badge.style.color,this.badge.style.color="#b9b9b9"):this.badge.style.color=this.originalColor)}static \u0275fac=function(n){return new(n||r)(Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","igoMatBadgeIcon",""]],inputs:{igoMatBadgeIcon:"igoMatBadgeIcon",matBadgeHidden:"matBadgeHidden",matBadgeDisabled:"matBadgeDisabled",igoMatBadgeInverseColor:"igoMatBadgeInverseColor",igoMatBadgeInheritColor:"igoMatBadgeInheritColor",igoMatBadgeColor:"igoMatBadgeColor",igoMatBadgeBackgroundColor:"igoMatBadgeBackgroundColor"},standalone:!0,features:[Xi([jt])]})}return r})();function Tve(r,i){if(r&1){let e=We();$(0,"button",3),ve("click",function(){we(e);let o=ne();return xe(o.clearTerm())}),$(1,"mat-icon"),_e(2,"close"),ee()()}}var N6=(()=>{class r{control=new xx;initialValue;floatLabel;placeholder;tooltip;searchChange=new Ke;ngOnInit(){this.initialValue&&this.control.setValue(this.initialValue,{emitEvent:!1}),this.control.valueChanges.pipe(Br(300)).subscribe(e=>{this.searchChange.emit(e)})}clearTerm(){this.control.reset()}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-layer-search"]],inputs:{initialValue:"initialValue",floatLabel:"floatLabel",placeholder:"placeholder",tooltip:"tooltip"},outputs:{searchChange:"searchChange"},standalone:!0,features:[lt],decls:5,vars:10,consts:[["subscriptSizing","dynamic",3,"floatLabel"],["matInput","","matTooltipShowDelay","500","type","text",3,"placeholder","matTooltip","matTooltipDisabled","formControl"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click",4,"ngIf"],["matSuffix","","mat-icon-button","","aria-label","Clear","color","warn",3,"click"]],template:function(n,o){n&1&&($(0,"mat-form-field",0),ct(1,"input",1),le(2,"translate"),le(3,"translate"),Pe(4,Tve,3,0,"button",2),ee()),n&2&&(z("floatLabel",o.floatLabel),j(),z("placeholder",ce(2,6,o.placeholder))("matTooltip",ce(3,8,o.tooltip))("matTooltipDisabled",!o.tooltip)("formControl",o.control),j(3),z("ngIf",o.control.value))},dependencies:[Gt,Sa,os,kn,Th,jr,Gr,Vc,Vt,ci,gn,Cn,Qt,ti,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]{flex:1}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:auto!important}
/*# sourceMappingURL=layer-search.component-MOS4GVJN.css.map */`]})}return r})();var Fve=8,Pve={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},Lve={"*":{type:"source"}},kve=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],Ove={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Dve={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Rve={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Nve={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},Bve={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Gve={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},jve={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},Vve=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],Uve={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},zve={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},$ve={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Wve={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Hve={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},qve={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Yve={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Zve={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},Xve={type:"array",value:"*"},Kve={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},Qve={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},Jve={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},ebe={type:"array",value:"*",minimum:1},tbe={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},ibe={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},rbe={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},nbe={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},obe=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],abe={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},sbe={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},lbe={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},cbe={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},ube={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},dbe={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},hbe={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},pbe={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},mbe={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},fbe={"*":{type:"string"}},HK={$version:Fve,$root:Pve,sources:Lve,source:kve,source_vector:Ove,source_raster:Dve,source_raster_dem:Rve,source_geojson:Nve,source_video:Bve,source_image:Gve,layer:jve,layout:Vve,layout_background:Uve,layout_fill:zve,layout_circle:$ve,layout_heatmap:Wve,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:Hve,layout_symbol:qve,layout_raster:Yve,layout_hillshade:Zve,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:Xve,filter_operator:Kve,geometry_type:Qve,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:Jve,expression:ebe,light:tbe,sky:ibe,terrain:rbe,projection:nbe,paint:obe,paint_fill:abe,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:sbe,paint_circle:lbe,paint_heatmap:cbe,paint_symbol:ube,paint_raster:dbe,paint_hillshade:hbe,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:pbe,transition:mbe,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:fbe},gbe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function _be(r,i){let e={};for(let n in r)n!=="ref"&&(e[n]=r[n]);return gbe.forEach(n=>{n in i&&(e[n]=i[n])}),e}function qK(r){r=r.slice();let i=Object.create(null);for(let e=0;e<r.length;e++)i[r[e].id]=r[e];for(let e=0;e<r.length;e++)"ref"in r[e]&&(r[e]=_be(r[e],i[r[e].ref]));return r}var ri=class{constructor(i,e,n,o){this.message=(i?`${i}: `:"")+n,o&&(this.identifier=o),e!=null&&e.__line__&&(this.line=e.__line__)}};function qE(r,...i){for(let e of i)for(let n in e)r[n]=e[n];return r}var ip=class extends Error{constructor(i,e){super(e),this.message=e,this.key=i}},q6=class r{constructor(i,e=[]){this.parent=i,this.bindings={};for(let[n,o]of e)this.bindings[n]=o}concat(i){return new r(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return this.bindings[i]?!0:this.parent?this.parent.has(i):!1}},dT={kind:"null"},di={kind:"number"},In={kind:"string"},yn={kind:"boolean"},af={kind:"color"},hT={kind:"projectionDefinition"},Qy={kind:"object"},pn={kind:"value"},ybe={kind:"error"},pT={kind:"collator"},mT={kind:"formatted"},fT={kind:"padding"},U2={kind:"colorArray"},gT={kind:"numberArray"},tC={kind:"resolvedImage"},_T={kind:"variableAnchorOffsetCollection"};function ah(r,i){return{kind:"array",itemType:r,N:i}}function ds(r){if(r.kind==="array"){let i=ds(r.itemType);return typeof r.N=="number"?`array<${i}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${i}>`}else return r.kind}var vbe=[dT,di,In,yn,af,hT,mT,Qy,ah(pn),fT,gT,U2,tC,_T];function z2(r,i){if(i.kind==="error")return null;if(r.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!z2(r.itemType,i.itemType))&&(typeof r.N!="number"||r.N===i.N))return null}else{if(r.kind===i.kind)return null;if(r.kind==="value"){for(let e of vbe)if(!z2(e,i))return null}}return`Expected ${ds(r)} but found ${ds(i)} instead.`}function pN(r,i){return i.some(e=>e.kind===r.kind)}function Jy(r,i){return i.some(e=>e==="null"?r===null:e==="array"?Array.isArray(r):e==="object"?r&&!Array.isArray(r)&&typeof r=="object":e===typeof r)}function h_(r,i){return r.kind==="array"&&i.kind==="array"?r.itemType.kind===i.itemType.kind&&typeof r.N=="number":r.kind===i.kind}var YK=.96422,ZK=1,XK=.82521,KK=4/29,iw=6/29,QK=3*iw*iw,bbe=iw*iw*iw,wbe=Math.PI/180,xbe=180/Math.PI;function JK(r){return r=r%360,r<0&&(r+=360),r}function eQ([r,i,e,n]){r=B6(r),i=B6(i),e=B6(e);let o,s,l=G6((.2225045*r+.7168786*i+.0606169*e)/ZK);r===i&&i===e?o=s=l:(o=G6((.4360747*r+.3850649*i+.1430804*e)/YK),s=G6((.0139322*r+.0971045*i+.7141733*e)/XK));let h=116*l-16;return[h<0?0:h,500*(o-l),200*(l-s),n]}function B6(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function G6(r){return r>bbe?Math.pow(r,1/3):r/QK+KK}function tQ([r,i,e,n]){let o=(r+16)/116,s=isNaN(i)?o:o+i/500,l=isNaN(e)?o:o-e/200;return o=ZK*V6(o),s=YK*V6(s),l=XK*V6(l),[j6(3.1338561*s-1.6168667*o-.4906146*l),j6(-.9787684*s+1.9161415*o+.033454*l),j6(.0719453*s-.2289914*o+1.4052427*l),n]}function j6(r){return r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055,r<0?0:r>1?1:r}function V6(r){return r>iw?r*r*r:QK*(r-KK)}function Sbe(r){let[i,e,n,o]=eQ(r),s=Math.sqrt(e*e+n*n);return[Math.round(s*1e4)?JK(Math.atan2(n,e)*xbe):NaN,s,i,o]}function Cbe([r,i,e,n]){return r=isNaN(r)?0:r*wbe,tQ([e,Math.cos(r)*i,Math.sin(r)*i,n])}function Abe([r,i,e,n]){r=JK(r),i/=100,e/=100;function o(s){let l=(s+r/30)%12,h=i*Math.min(e,1-e);return e-h*Math.max(-1,Math.min(l-3,9-l,1))}return[o(0),o(8),o(4),n]}var Mbe=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function j2(r,i){return Mbe(r,i)?r[i]:void 0}function Ibe(r){if(r=r.toLowerCase().trim(),r==="transparent")return[0,0,0,0];let i=j2(Ebe,r);if(i){let[o,s,l]=i;return[o/255,s/255,l/255,1]}if(r.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(r)){let s=r.length<6?1:2,l=1;return[UE(r.slice(l,l+=s)),UE(r.slice(l,l+=s)),UE(r.slice(l,l+=s)),UE(r.slice(l,l+s)||"ff")]}if(r.startsWith("rgb")){let o=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,s=r.match(o);if(s){let[l,h,p,m,f,g,y,_,w,A,k,R]=s,q=[m||" ",y||" ",A].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){let X=[p,g,w].join(""),ie=X==="%%%"?100:X===""?255:0;if(ie){let ae=[ew(+h/ie,0,1),ew(+f/ie,0,1),ew(+_/ie,0,1),k?AK(+k,R):1];if(MK(ae))return ae}}return}}let e=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,n=r.match(e);if(n){let[o,s,l,h,p,m,f,g,y]=n,_=[l||" ",p||" ",f].join("");if(_==="  "||_==="  /"||_===",,"||_===",,,"){let w=[+s,ew(+h,0,100),ew(+m,0,100),g?AK(+g,y):1];if(MK(w))return Abe(w)}}}function UE(r){return parseInt(r.padEnd(2,r),16)/255}function AK(r,i){return ew(i?r/100:r,0,1)}function ew(r,i,e){return Math.min(Math.max(i,r),e)}function MK(r){return!r.some(Number.isNaN)}var Ebe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function m_(r,i,e){return r+e*(i-r)}function nw(r,i,e){return r.map((n,o)=>m_(n,i[o],e))}var No=class r{constructor(i,e,n,o=1,s=!0){this.r=i,this.g=e,this.b=n,this.a=o,s||(this.r*=o,this.g*=o,this.b*=o,o||this.overwriteGetter("rgb",[i,e,n,o]))}static parse(i){if(i instanceof r)return i;if(typeof i!="string")return;let e=Ibe(i);if(e)return new r(...e,!1)}get rgb(){let{r:i,g:e,b:n,a:o}=this,s=o||1/0;return this.overwriteGetter("rgb",[i/s,e/s,n/s,o])}get hcl(){return this.overwriteGetter("hcl",Sbe(this.rgb))}get lab(){return this.overwriteGetter("lab",eQ(this.rgb))}overwriteGetter(i,e){return Object.defineProperty(this,i,{value:e}),e}toString(){let[i,e,n,o]=this.rgb;return`rgba(${[i,e,n].map(s=>Math.round(s*255)).join(",")},${o})`}static interpolate(i,e,n,o="rgb"){switch(o){case"rgb":{let[s,l,h,p]=nw(i.rgb,e.rgb,n);return new r(s,l,h,p,!1)}case"hcl":{let[s,l,h,p]=i.hcl,[m,f,g,y]=e.hcl,_,w;if(!isNaN(s)&&!isNaN(m)){let X=m-s;m>s&&X>180?X-=360:m<s&&s-m>180&&(X+=360),_=s+n*X}else isNaN(s)?isNaN(m)?_=NaN:(_=m,(h===1||h===0)&&(w=f)):(_=s,(g===1||g===0)&&(w=l));let[A,k,R,q]=Cbe([_,w??m_(l,f,n),m_(h,g,n),m_(p,y,n)]);return new r(A,k,R,q,!1)}case"lab":{let[s,l,h,p]=tQ(nw(i.lab,e.lab,n));return new r(s,l,h,p,!1)}}}};No.black=new No(0,0,0,1);No.white=new No(1,1,1,1);No.transparent=new No(0,0,0,0);No.red=new No(1,0,0,1);var $2=class{constructor(i,e,n){i?this.sensitivity=e?"variant":"case":this.sensitivity=e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,e){return this.collator.compare(i,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},Tbe=["bottom","center","top"],W2=class{constructor(i,e,n,o,s,l){this.text=i,this.image=e,this.scale=n,this.fontStack=o,this.textColor=s,this.verticalAlign=l}},e1=class r{constructor(i){this.sections=i}static fromString(i){return new r([new W2(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof r?i:r.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}},kg=class r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof r)return i;if(typeof i=="number")return new r([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(let e of i)if(typeof e!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]];break}return new r(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,e,n){return new r(nw(i.values,e.values,n))}},Og=class r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof r)return i;if(typeof i=="number")return new r([i]);if(Array.isArray(i)){for(let e of i)if(typeof e!="number")return;return new r(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,e,n){return new r(nw(i.values,e.values,n))}},$p=class r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof r)return i;if(typeof i=="string"){let n=No.parse(i);return n?new r([n]):void 0}if(!Array.isArray(i))return;let e=[];for(let n of i){if(typeof n!="string")return;let o=No.parse(n);if(!o)return;e.push(o)}return new r(e)}toString(){return JSON.stringify(this.values)}static interpolate(i,e,n,o="rgb"){let s=[];if(i.values.length!=e.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${e.values.length}), cannot interpolate.`);for(let l=0;l<i.values.length;l++)s.push(No.interpolate(i.values[l],e.values[l],n,o));return new r(s)}},ns=class extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}},Fbe=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]),Dg=class r{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof r)return i;if(!(!Array.isArray(i)||i.length<1||i.length%2!==0)){for(let e=0;e<i.length;e+=2){let n=i[e],o=i[e+1];if(typeof n!="string"||!Fbe.has(n)||!Array.isArray(o)||o.length!==2||typeof o[0]!="number"||typeof o[1]!="number")return}return new r(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,e,n){let o=i.values,s=e.values;if(o.length!==s.length)throw new ns(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${e.toString()}`);let l=[];for(let h=0;h<o.length;h+=2){if(o[h]!==s[h])throw new ns(`Cannot interpolate values containing mismatched anchors. from[${h}]: ${o[h]}, to[${h}]: ${s[h]}`);l.push(o[h]);let[p,m]=o[h+1],[f,g]=s[h+1];l.push([m_(p,f,n),m_(m,g,n)])}return new r(l)}},f_=class r{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new r({name:i,available:!1}):null}},t1=class r{constructor(i,e,n){this.from=i,this.to=e,this.transition=n}static interpolate(i,e,n){return new r(i,e,n)}static parse(i){if(i instanceof r)return i;if(Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number")return new r(i[0],i[1],i[2]);if(typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number")return new r(i.from,i.to,i.transition);if(typeof i=="string")return new r(i,i,1)}};function iQ(r,i,e,n){return typeof r=="number"&&r>=0&&r<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255?typeof n>"u"||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[r,i,e,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[r,i,e,n]:[r,i,e]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function H2(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof t1||r instanceof No||r instanceof $2||r instanceof e1||r instanceof kg||r instanceof Og||r instanceof $p||r instanceof Dg||r instanceof f_)return!0;if(Array.isArray(r)){for(let i of r)if(!H2(i))return!1;return!0}else if(typeof r=="object"){for(let i in r)if(!H2(r[i]))return!1;return!0}else return!1}function Cl(r){if(r===null)return dT;if(typeof r=="string")return In;if(typeof r=="boolean")return yn;if(typeof r=="number")return di;if(r instanceof No)return af;if(r instanceof t1)return hT;if(r instanceof $2)return pT;if(r instanceof e1)return mT;if(r instanceof kg)return fT;if(r instanceof Og)return gT;if(r instanceof $p)return U2;if(r instanceof Dg)return _T;if(r instanceof f_)return tC;if(Array.isArray(r)){let i=r.length,e;for(let n of r){let o=Cl(n);if(!e)e=o;else{if(e===o)continue;e=pn;break}}return ah(e||pn,i)}else return Qy}function V2(r){let i=typeof r;return r===null?"":i==="string"||i==="number"||i==="boolean"?String(r):r instanceof No||r instanceof t1||r instanceof e1||r instanceof kg||r instanceof Og||r instanceof $p||r instanceof Dg||r instanceof f_?r.toString():JSON.stringify(r)}var ow=class r{constructor(i,e){this.type=i,this.value=e}static parse(i,e){if(i.length!==2)return e.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!H2(i[1]))return e.error("invalid value");let n=i[1],o=Cl(n),s=e.expectedType;return o.kind==="array"&&o.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(o=s),new r(o,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}},zE={string:In,number:di,boolean:yn,object:Qy},zp=class r{constructor(i,e){this.type=i,this.args=e}static parse(i,e){if(i.length<2)return e.error("Expected at least one argument.");let n=1,o,s=i[0];if(s==="array"){let h;if(i.length>2){let m=i[1];if(typeof m!="string"||!(m in zE)||m==="object")return e.error('The item type argument of "array" must be one of string, number, boolean',1);h=zE[m],n++}else h=pn;let p;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return e.error('The length argument to "array" must be a positive integer literal',2);p=i[2],n++}o=ah(h,p)}else{if(!zE[s])throw new Error(`Types doesn't contain name = ${s}`);o=zE[s]}let l=[];for(;n<i.length;n++){let h=e.parse(i[n],n,pn);if(!h)return null;l.push(h)}return new r(o,l)}evaluate(i){for(let e=0;e<this.args.length;e++){let n=this.args[e].evaluate(i);if(z2(this.type,Cl(n))){if(e===this.args.length-1)throw new ns(`Expected value to be of type ${ds(this.type)}, but found ${ds(Cl(n))} instead.`)}else return n}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},IK={"to-boolean":yn,"to-color":af,"to-number":di,"to-string":In},p_=class r{constructor(i,e){this.type=i,this.args=e}static parse(i,e){if(i.length<2)return e.error("Expected at least one argument.");let n=i[0];if(!IK[n])throw new Error(`Can't parse ${n} as it is not part of the known types`);if((n==="to-boolean"||n==="to-string")&&i.length!==2)return e.error("Expected one argument.");let o=IK[n],s=[];for(let l=1;l<i.length;l++){let h=e.parse(i[l],l,pn);if(!h)return null;s.push(h)}return new r(o,s)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let e,n;for(let o of this.args){if(e=o.evaluate(i),n=null,e instanceof No)return e;if(typeof e=="string"){let s=i.parseColor(e);if(s)return s}else if(Array.isArray(e)&&(e.length<3||e.length>4?n=`Invalid rgba value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:n=iQ(e[0],e[1],e[2],e[3]),!n))return new No(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ns(n||`Could not parse color from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"padding":{let e;for(let n of this.args){e=n.evaluate(i);let o=kg.parse(e);if(o)return o}throw new ns(`Could not parse padding from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"numberArray":{let e;for(let n of this.args){e=n.evaluate(i);let o=Og.parse(e);if(o)return o}throw new ns(`Could not parse numberArray from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"colorArray":{let e;for(let n of this.args){e=n.evaluate(i);let o=$p.parse(e);if(o)return o}throw new ns(`Could not parse colorArray from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"variableAnchorOffsetCollection":{let e;for(let n of this.args){e=n.evaluate(i);let o=Dg.parse(e);if(o)return o}throw new ns(`Could not parse variableAnchorOffsetCollection from value '${typeof e=="string"?e:JSON.stringify(e)}'`)}case"number":{let e=null;for(let n of this.args){if(e=n.evaluate(i),e===null)return 0;let o=Number(e);if(!isNaN(o))return o}throw new ns(`Could not convert ${JSON.stringify(e)} to number.`)}case"formatted":return e1.fromString(V2(this.args[0].evaluate(i)));case"resolvedImage":return f_.fromString(V2(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return V2(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}},Pbe=["Unknown","Point","LineString","Polygon"],YE=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Pbe[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let e=this._parseColorCache.get(i);return e||(e=No.parse(i),this._parseColorCache.set(i,e)),e}},ZE=class r{constructor(i,e,n=[],o,s=new q6,l=[]){this.registry=i,this.path=n,this.key=n.map(h=>`[${h}]`).join(""),this.scope=s,this.errors=l,this.expectedType=o,this._isConstant=e}parse(i,e,n,o,s={}){return e?this.concat(e,n,o)._parse(i,s):this._parse(i,s)}_parse(i,e){(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number")&&(i=["literal",i]);function n(o,s,l){return l==="assert"?new zp(s,[o]):l==="coerce"?new p_(s,[o]):o}if(Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let o=i[0];if(typeof o!="string")return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let s=this.registry[o];if(s){let l=s.parse(i,this);if(!l)return null;if(this.expectedType){let h=this.expectedType,p=l.type;if((h.kind==="string"||h.kind==="number"||h.kind==="boolean"||h.kind==="object"||h.kind==="array")&&p.kind==="value")l=n(l,h,e.typeAnnotation||"assert");else if(h.kind==="projectionDefinition"&&["string","array"].includes(p.kind)||["color","formatted","resolvedImage"].includes(h.kind)&&["value","string"].includes(p.kind)||["padding","numberArray"].includes(h.kind)&&["value","number","array"].includes(p.kind)||h.kind==="colorArray"&&["value","string","array"].includes(p.kind)||h.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(p.kind))l=n(l,h,e.typeAnnotation||"coerce");else if(this.checkSubtype(h,p))return null}if(!(l instanceof ow)&&l.type.kind!=="resolvedImage"&&this._isConstant(l)){let h=new YE;try{l=new ow(l.type,l.evaluate(h))}catch(p){return this.error(p.message),null}}return l}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof i>"u"?this.error("'undefined' value invalid. Use null instead."):typeof i=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof i} instead.`)}concat(i,e,n){let o=typeof i=="number"?this.path.concat(i):this.path,s=n?this.scope.concat(n):this.scope;return new r(this.registry,this._isConstant,o,e||null,s,this.errors)}error(i,...e){let n=`${this.key}${e.map(o=>`[${o}]`).join("")}`;this.errors.push(new ip(n,i))}checkSubtype(i,e){let n=z2(i,e);return n&&this.error(n),n}},XE=class r{constructor(i,e){this.type=e.type,this.bindings=[].concat(i),this.result=e}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(let e of this.bindings)i(e[1]);i(this.result)}static parse(i,e){if(i.length<4)return e.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);let n=[];for(let s=1;s<i.length-1;s+=2){let l=i[s];if(typeof l!="string")return e.error(`Expected string, but found ${typeof l} instead.`,s);if(/[^a-zA-Z0-9_]/.test(l))return e.error("Variable names must contain only alphanumeric characters or '_'.",s);let h=e.parse(i[s+1],s+1);if(!h)return null;n.push([l,h])}let o=e.parse(i[i.length-1],i.length-1,e.expectedType,n);return o?new r(n,o):null}outputDefined(){return this.result.outputDefined()}},KE=class r{constructor(i,e){this.type=e.type,this.name=i,this.boundExpression=e}static parse(i,e){if(i.length!==2||typeof i[1]!="string")return e.error("'var' expression requires exactly one string literal argument.");let n=i[1];return e.scope.has(n)?new r(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}},Y6=class r{constructor(i,e,n){this.type=i,this.index=e,this.input=n}static parse(i,e){if(i.length!==3)return e.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let n=e.parse(i[1],1,di),o=e.parse(i[2],2,ah(e.expectedType||pn));if(!n||!o)return null;let s=o.type;return new r(s.itemType,n,o)}evaluate(i){let e=this.index.evaluate(i),n=this.input.evaluate(i);if(e<0)throw new ns(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new ns(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new ns(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}},Z6=class r{constructor(i,e){this.type=yn,this.needle=i,this.haystack=e}static parse(i,e){if(i.length!==3)return e.error(`Expected 2 arguments, but found ${i.length-1} instead.`);let n=e.parse(i[1],1,pn),o=e.parse(i[2],2,pn);return!n||!o?null:pN(n.type,[yn,In,di,dT,pn])?new r(n,o):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ds(n.type)} instead`)}evaluate(i){let e=this.needle.evaluate(i),n=this.haystack.evaluate(i);if(!n)return!1;if(!Jy(e,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${ds(Cl(e))} instead.`);if(!Jy(n,["string","array"]))throw new ns(`Expected second argument to be of type array or string, but found ${ds(Cl(n))} instead.`);return n.indexOf(e)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}},X6=class r{constructor(i,e,n){this.type=di,this.needle=i,this.haystack=e,this.fromIndex=n}static parse(i,e){if(i.length<=2||i.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let n=e.parse(i[1],1,pn),o=e.parse(i[2],2,pn);if(!n||!o)return null;if(!pN(n.type,[yn,In,di,dT,pn]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${ds(n.type)} instead`);if(i.length===4){let s=e.parse(i[3],3,di);return s?new r(n,o,s):null}else return new r(n,o)}evaluate(i){let e=this.needle.evaluate(i),n=this.haystack.evaluate(i);if(!Jy(e,["boolean","string","number","null"]))throw new ns(`Expected first argument to be of type boolean, string, number or null, but found ${ds(Cl(e))} instead.`);let o;if(this.fromIndex&&(o=this.fromIndex.evaluate(i)),Jy(n,["string"])){let s=n.indexOf(e,o);return s===-1?-1:[...n.slice(0,s)].length}else{if(Jy(n,["array"]))return n.indexOf(e,o);throw new ns(`Expected second argument to be of type array or string, but found ${ds(Cl(n))} instead.`)}}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}},K6=class r{constructor(i,e,n,o,s,l){this.inputType=i,this.type=e,this.input=n,this.cases=o,this.outputs=s,this.otherwise=l}static parse(i,e){if(i.length<5)return e.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!==1)return e.error("Expected an even number of arguments.");let n,o;e.expectedType&&e.expectedType.kind!=="value"&&(o=e.expectedType);let s={},l=[];for(let m=2;m<i.length-1;m+=2){let f=i[m],g=i[m+1];Array.isArray(f)||(f=[f]);let y=e.concat(m);if(f.length===0)return y.error("Expected at least one branch label.");for(let w of f){if(typeof w!="number"&&typeof w!="string")return y.error("Branch labels must be numbers or strings.");if(typeof w=="number"&&Math.abs(w)>Number.MAX_SAFE_INTEGER)return y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof w=="number"&&Math.floor(w)!==w)return y.error("Numeric branch labels must be integer values.");if(!n)n=Cl(w);else if(y.checkSubtype(n,Cl(w)))return null;if(typeof s[String(w)]<"u")return y.error("Branch labels must be unique.");s[String(w)]=l.length}let _=e.parse(g,m,o);if(!_)return null;o=o||_.type,l.push(_)}let h=e.parse(i[1],1,pn);if(!h)return null;let p=e.parse(i[i.length-1],i.length-1,o);return!p||h.type.kind!=="value"&&e.concat(1).checkSubtype(n,h.type)?null:new r(n,o,h,s,l,p)}evaluate(i){let e=this.input.evaluate(i);return(Cl(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}},Q6=class r{constructor(i,e,n){this.type=i,this.branches=e,this.otherwise=n}static parse(i,e){if(i.length<4)return e.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!==0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&e.expectedType.kind!=="value"&&(n=e.expectedType);let o=[];for(let l=1;l<i.length-1;l+=2){let h=e.parse(i[l],l,yn);if(!h)return null;let p=e.parse(i[l+1],l+1,n);if(!p)return null;o.push([h,p]),n=n||p.type}let s=e.parse(i[i.length-1],i.length-1,n);if(!s)return null;if(!n)throw new Error("Can't infer output type");return new r(n,o,s)}evaluate(i){for(let[e,n]of this.branches)if(e.evaluate(i))return n.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(let[e,n]of this.branches)i(e),i(n);i(this.otherwise)}outputDefined(){return this.branches.every(([i,e])=>e.outputDefined())&&this.otherwise.outputDefined()}},J6=class r{constructor(i,e,n,o){this.type=i,this.input=e,this.beginIndex=n,this.endIndex=o}static parse(i,e){if(i.length<=2||i.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);let n=e.parse(i[1],1,pn),o=e.parse(i[2],2,di);if(!n||!o)return null;if(!pN(n.type,[ah(pn),In,pn]))return e.error(`Expected first argument to be of type array or string, but found ${ds(n.type)} instead`);if(i.length===4){let s=e.parse(i[3],3,di);return s?new r(n.type,n,o,s):null}else return new r(n.type,n,o)}evaluate(i){let e=this.input.evaluate(i),n=this.beginIndex.evaluate(i),o;if(this.endIndex&&(o=this.endIndex.evaluate(i)),Jy(e,["string"]))return[...e].slice(n,o).join("");if(Jy(e,["array"]))return e.slice(n,o);throw new ns(`Expected first argument to be of type array or string, but found ${ds(Cl(e))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}};function rQ(r,i){let e=r.length-1,n=0,o=e,s=0,l,h;for(;n<=o;)if(s=Math.floor((n+o)/2),l=r[s],h=r[s+1],l<=i){if(s===e||i<h)return s;n=s+1}else if(l>i)o=s-1;else throw new ns("Input is not a number.");return 0}var QE=class r{constructor(i,e,n){this.type=i,this.input=e,this.labels=[],this.outputs=[];for(let[o,s]of n)this.labels.push(o),this.outputs.push(s)}static parse(i,e){if(i.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return e.error("Expected an even number of arguments.");let n=e.parse(i[1],1,di);if(!n)return null;let o=[],s=null;e.expectedType&&e.expectedType.kind!=="value"&&(s=e.expectedType);for(let l=1;l<i.length;l+=2){let h=l===1?-1/0:i[l],p=i[l+1],m=l,f=l+1;if(typeof h!="number")return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',m);if(o.length&&o[o.length-1][0]>=h)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',m);let g=e.parse(p,f,s);if(!g)return null;s=s||g.type,o.push([h,g])}return new r(s,n,o)}evaluate(i){let e=this.labels,n=this.outputs;if(e.length===1)return n[0].evaluate(i);let o=this.input.evaluate(i);if(o<=e[0])return n[0].evaluate(i);let s=e.length;if(o>=e[s-1])return n[s-1].evaluate(i);let l=rQ(e,o);return n[l].evaluate(i)}eachChild(i){i(this.input);for(let e of this.outputs)i(e)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function Lbe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var U6,EK;function kbe(){if(EK)return U6;EK=1,U6=r;function r(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=e,this.p2x=n,this.p2y=o}return r.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,e){if(e===void 0&&(e=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var s=this.sampleCurveX(n)-i;if(Math.abs(s)<e)return n;var l=this.sampleCurveDerivativeX(n);if(Math.abs(l)<1e-6)break;n=n-s/l}var h=0,p=1;for(n=i,o=0;o<20&&(s=this.sampleCurveX(n),!(Math.abs(s-i)<e));o++)i>s?h=n:p=n,n=(p-h)*.5+h;return n},solve:function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))}},U6}var Obe=kbe(),Dbe=Lbe(Obe),Lg=class r{constructor(i,e,n,o,s){this.type=i,this.operator=e,this.interpolation=n,this.input=o,this.labels=[],this.outputs=[];for(let[l,h]of s)this.labels.push(l),this.outputs.push(h)}static interpolationFactor(i,e,n,o){let s=0;if(i.name==="exponential")s=z6(e,i.base,n,o);else if(i.name==="linear")s=z6(e,1,n,o);else if(i.name==="cubic-bezier"){let l=i.controlPoints;s=new Dbe(l[0],l[1],l[2],l[3]).solve(z6(e,1,n,o))}return s}static parse(i,e){let[n,o,s,...l]=i;if(!Array.isArray(o)||o.length===0)return e.error("Expected an interpolation type expression.",1);if(o[0]==="linear")o={name:"linear"};else if(o[0]==="exponential"){let m=o[1];if(typeof m!="number")return e.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:m}}else if(o[0]==="cubic-bezier"){let m=o.slice(1);if(m.length!==4||m.some(f=>typeof f!="number"||f<0||f>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:m}}else return e.error(`Unknown interpolation type ${String(o[0])}`,1,0);if(i.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!==0)return e.error("Expected an even number of arguments.");if(s=e.parse(s,2,di),!s)return null;let h=[],p=null;(n==="interpolate-hcl"||n==="interpolate-lab")&&e.expectedType!=U2?p=af:e.expectedType&&e.expectedType.kind!=="value"&&(p=e.expectedType);for(let m=0;m<l.length;m+=2){let f=l[m],g=l[m+1],y=m+3,_=m+4;if(typeof f!="number")return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(h.length&&h[h.length-1][0]>=f)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',y);let w=e.parse(g,_,p);if(!w)return null;p=p||w.type,h.push([f,w])}return!h_(p,di)&&!h_(p,hT)&&!h_(p,af)&&!h_(p,fT)&&!h_(p,gT)&&!h_(p,U2)&&!h_(p,_T)&&!h_(p,ah(di))?e.error(`Type ${ds(p)} is not interpolatable.`):new r(p,n,o,s,h)}evaluate(i){let e=this.labels,n=this.outputs;if(e.length===1)return n[0].evaluate(i);let o=this.input.evaluate(i);if(o<=e[0])return n[0].evaluate(i);let s=e.length;if(o>=e[s-1])return n[s-1].evaluate(i);let l=rQ(e,o),h=e[l],p=e[l+1],m=r.interpolationFactor(this.interpolation,o,h,p),f=n[l].evaluate(i),g=n[l+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return m_(f,g,m);case"color":return No.interpolate(f,g,m);case"padding":return kg.interpolate(f,g,m);case"colorArray":return $p.interpolate(f,g,m);case"numberArray":return Og.interpolate(f,g,m);case"variableAnchorOffsetCollection":return Dg.interpolate(f,g,m);case"array":return nw(f,g,m);case"projectionDefinition":return t1.interpolate(f,g,m)}case"interpolate-hcl":switch(this.type.kind){case"color":return No.interpolate(f,g,m,"hcl");case"colorArray":return $p.interpolate(f,g,m,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return No.interpolate(f,g,m,"lab");case"colorArray":return $p.interpolate(f,g,m,"lab")}}}eachChild(i){i(this.input);for(let e of this.outputs)i(e)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}};function z6(r,i,e,n){let o=n-e,s=r-e;return o===0?0:i===1?s/o:(Math.pow(i,s)-1)/(Math.pow(i,o)-1)}var Pyt={color:No.interpolate,number:m_,padding:kg.interpolate,numberArray:Og.interpolate,colorArray:$p.interpolate,variableAnchorOffsetCollection:Dg.interpolate,array:nw},JE=class r{constructor(i,e){this.type=i,this.args=e}static parse(i,e){if(i.length<2)return e.error("Expected at least one argument.");let n=null,o=e.expectedType;o&&o.kind!=="value"&&(n=o);let s=[];for(let h of i.slice(1)){let p=e.parse(h,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!p)return null;n=n||p.type,s.push(p)}if(!n)throw new Error("No output type");return o&&s.some(h=>z2(o,h.type))?new r(pn,s):new r(n,s)}evaluate(i){let e=null,n=0,o;for(let s of this.args)if(n++,e=s.evaluate(i),e&&e instanceof f_&&!e.available&&(o||(o=e.name),e=null,n===this.args.length&&(e=o)),e!==null)break;return e}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}};function TK(r,i){return r==="=="||r==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Rbe(r,i,e){return i===e}function Nbe(r,i,e){return i!==e}function Bbe(r,i,e){return i<e}function Gbe(r,i,e){return i>e}function jbe(r,i,e){return i<=e}function Vbe(r,i,e){return i>=e}function nQ(r,i,e,n){return n.compare(i,e)===0}function Ube(r,i,e,n){return!nQ(r,i,e,n)}function zbe(r,i,e,n){return n.compare(i,e)<0}function $be(r,i,e,n){return n.compare(i,e)>0}function Wbe(r,i,e,n){return n.compare(i,e)<=0}function Hbe(r,i,e,n){return n.compare(i,e)>=0}function sw(r,i,e){let n=r!=="=="&&r!=="!=";return class oQ{constructor(s,l,h){this.type=yn,this.lhs=s,this.rhs=l,this.collator=h,this.hasUntypedArgument=s.type.kind==="value"||l.type.kind==="value"}static parse(s,l){if(s.length!==3&&s.length!==4)return l.error("Expected two or three arguments.");let h=s[0],p=l.parse(s[1],1,pn);if(!p)return null;if(!TK(h,p.type))return l.concat(1).error(`"${h}" comparisons are not supported for type '${ds(p.type)}'.`);let m=l.parse(s[2],2,pn);if(!m)return null;if(!TK(h,m.type))return l.concat(2).error(`"${h}" comparisons are not supported for type '${ds(m.type)}'.`);if(p.type.kind!==m.type.kind&&p.type.kind!=="value"&&m.type.kind!=="value")return l.error(`Cannot compare types '${ds(p.type)}' and '${ds(m.type)}'.`);n&&(p.type.kind==="value"&&m.type.kind!=="value"?p=new zp(m.type,[p]):p.type.kind!=="value"&&m.type.kind==="value"&&(m=new zp(p.type,[m])));let f=null;if(s.length===4){if(p.type.kind!=="string"&&m.type.kind!=="string"&&p.type.kind!=="value"&&m.type.kind!=="value")return l.error("Cannot use collator to compare non-string types.");if(f=l.parse(s[3],3,pT),!f)return null}return new oQ(p,m,f)}evaluate(s){let l=this.lhs.evaluate(s),h=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){let p=Cl(l),m=Cl(h);if(p.kind!==m.kind||!(p.kind==="string"||p.kind==="number"))throw new ns(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${p.kind}, ${m.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let p=Cl(l),m=Cl(h);if(p.kind!=="string"||m.kind!=="string")return i(s,l,h)}return this.collator?e(s,l,h,this.collator.evaluate(s)):i(s,l,h)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}}}var qbe=sw("==",Rbe,nQ),Ybe=sw("!=",Nbe,Ube),Zbe=sw("<",Bbe,zbe),Xbe=sw(">",Gbe,$be),Kbe=sw("<=",jbe,Wbe),Qbe=sw(">=",Vbe,Hbe),eT=class r{constructor(i,e,n){this.type=pT,this.locale=n,this.caseSensitive=i,this.diacriticSensitive=e}static parse(i,e){if(i.length!==2)return e.error("Expected one argument.");let n=i[1];if(typeof n!="object"||Array.isArray(n))return e.error("Collator options argument must be an object.");let o=e.parse(n["case-sensitive"]===void 0?!1:n["case-sensitive"],1,yn);if(!o)return null;let s=e.parse(n["diacritic-sensitive"]===void 0?!1:n["diacritic-sensitive"],1,yn);if(!s)return null;let l=null;return n.locale&&(l=e.parse(n.locale,1,In),!l)?null:new r(o,s,l)}evaluate(i){return new $2(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}},eN=class r{constructor(i,e,n,o,s){this.type=In,this.number=i,this.locale=e,this.currency=n,this.minFractionDigits=o,this.maxFractionDigits=s}static parse(i,e){if(i.length!==3)return e.error("Expected two arguments.");let n=e.parse(i[1],1,di);if(!n)return null;let o=i[2];if(typeof o!="object"||Array.isArray(o))return e.error("NumberFormat options argument must be an object.");let s=null;if(o.locale&&(s=e.parse(o.locale,1,In),!s))return null;let l=null;if(o.currency&&(l=e.parse(o.currency,1,In),!l))return null;let h=null;if(o["min-fraction-digits"]&&(h=e.parse(o["min-fraction-digits"],1,di),!h))return null;let p=null;return o["max-fraction-digits"]&&(p=e.parse(o["max-fraction-digits"],1,di),!p)?null:new r(n,s,l,h,p)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}},tN=class r{constructor(i){this.type=mT,this.sections=i}static parse(i,e){if(i.length<2)return e.error("Expected at least one argument.");let n=i[1];if(!Array.isArray(n)&&typeof n=="object")return e.error("First argument must be an image or text section.");let o=[],s=!1;for(let l=1;l<=i.length-1;++l){let h=i[l];if(s&&typeof h=="object"&&!Array.isArray(h)){s=!1;let p=null;if(h["font-scale"]&&(p=e.parse(h["font-scale"],1,di),!p))return null;let m=null;if(h["text-font"]&&(m=e.parse(h["text-font"],1,ah(In)),!m))return null;let f=null;if(h["text-color"]&&(f=e.parse(h["text-color"],1,af),!f))return null;let g=null;if(h["vertical-align"]){if(typeof h["vertical-align"]=="string"&&!Tbe.includes(h["vertical-align"]))return e.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${h["vertical-align"]}' instead.`);if(g=e.parse(h["vertical-align"],1,In),!g)return null}let y=o[o.length-1];y.scale=p,y.font=m,y.textColor=f,y.verticalAlign=g}else{let p=e.parse(i[l],1,pn);if(!p)return null;let m=p.type.kind;if(m!=="string"&&m!=="value"&&m!=="null"&&m!=="resolvedImage")return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,o.push({content:p,scale:null,font:null,textColor:null,verticalAlign:null})}}return new r(o)}evaluate(i){let e=n=>{let o=n.content.evaluate(i);return Cl(o)===tC?new W2("",o,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(i):null):new W2(V2(o),null,n.scale?n.scale.evaluate(i):null,n.font?n.font.evaluate(i).join(","):null,n.textColor?n.textColor.evaluate(i):null,n.verticalAlign?n.verticalAlign.evaluate(i):null)};return new e1(this.sections.map(e))}eachChild(i){for(let e of this.sections)i(e.content),e.scale&&i(e.scale),e.font&&i(e.font),e.textColor&&i(e.textColor),e.verticalAlign&&i(e.verticalAlign)}outputDefined(){return!1}},iN=class r{constructor(i){this.type=tC,this.input=i}static parse(i,e){if(i.length!==2)return e.error("Expected two arguments.");let n=e.parse(i[1],1,In);return n?new r(n):e.error("No image name provided.")}evaluate(i){let e=this.input.evaluate(i),n=f_.fromString(e);return n&&i.availableImages&&(n.available=i.availableImages.indexOf(e)>-1),n}eachChild(i){i(this.input)}outputDefined(){return!1}},rN=class r{constructor(i){this.type=di,this.input=i}static parse(i,e){if(i.length!==2)return e.error(`Expected 1 argument, but found ${i.length-1} instead.`);let n=e.parse(i[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?e.error(`Expected argument of type string or array, but found ${ds(n.type)} instead.`):new r(n):null}evaluate(i){let e=this.input.evaluate(i);if(typeof e=="string")return[...e].length;if(Array.isArray(e))return e.length;throw new ns(`Expected value to be of type string or array, but found ${ds(Cl(e))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}},sf=8192;function Jbe(r,i){let e=ewe(r[0]),n=iwe(r[1]),o=Math.pow(2,i.z);return[Math.round(e*o*sf),Math.round(n*o*sf)]}function mN(r,i){let e=Math.pow(2,i.z),n=(r[0]/sf+i.x)/e,o=(r[1]/sf+i.y)/e;return[twe(n),rwe(o)]}function ewe(r){return(180+r)/360}function twe(r){return r*360-180}function iwe(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function rwe(r){return 360/Math.PI*Math.atan(Math.exp((180-r*360)*Math.PI/180))-90}function iC(r,i){r[0]=Math.min(r[0],i[0]),r[1]=Math.min(r[1],i[1]),r[2]=Math.max(r[2],i[0]),r[3]=Math.max(r[3],i[1])}function q2(r,i){return!(r[0]<=i[0]||r[2]>=i[2]||r[1]<=i[1]||r[3]>=i[3])}function nwe(r,i,e){return i[1]>r[1]!=e[1]>r[1]&&r[0]<(e[0]-i[0])*(r[1]-i[1])/(e[1]-i[1])+i[0]}function owe(r,i,e){let n=r[0]-i[0],o=r[1]-i[1],s=r[0]-e[0],l=r[1]-e[1];return n*l-s*o===0&&n*s<=0&&o*l<=0}function yT(r,i,e,n){let o=[i[0]-r[0],i[1]-r[1]],s=[n[0]-e[0],n[1]-e[1]];return cwe(s,o)===0?!1:!!(FK(r,i,e,n)&&FK(e,n,r,i))}function awe(r,i,e){for(let n of e)for(let o=0;o<n.length-1;++o)if(yT(r,i,n[o],n[o+1]))return!0;return!1}function lw(r,i,e=!1){let n=!1;for(let o of i)for(let s=0;s<o.length-1;s++){if(owe(r,o[s],o[s+1]))return e;nwe(r,o[s],o[s+1])&&(n=!n)}return n}function swe(r,i){for(let e of i)if(lw(r,e))return!0;return!1}function aQ(r,i){for(let e of r)if(!lw(e,i))return!1;for(let e=0;e<r.length-1;++e)if(awe(r[e],r[e+1],i))return!1;return!0}function lwe(r,i){for(let e of i)if(aQ(r,e))return!0;return!1}function cwe(r,i){return r[0]*i[1]-r[1]*i[0]}function FK(r,i,e,n){let o=r[0]-e[0],s=r[1]-e[1],l=i[0]-e[0],h=i[1]-e[1],p=n[0]-e[0],m=n[1]-e[1],f=o*m-p*s,g=l*m-p*h;return f>0&&g<0||f<0&&g>0}function fN(r,i,e){let n=[];for(let o=0;o<r.length;o++){let s=[];for(let l=0;l<r[o].length;l++){let h=Jbe(r[o][l],e);iC(i,h),s.push(h)}n.push(s)}return n}function sQ(r,i,e){let n=[];for(let o=0;o<r.length;o++){let s=fN(r[o],i,e);n.push(s)}return n}function lQ(r,i,e,n){if(r[0]<e[0]||r[0]>e[2]){let o=n*.5,s=r[0]-e[0]>o?-n:e[0]-r[0]>o?n:0;s===0&&(s=r[0]-e[2]>o?-n:e[2]-r[0]>o?n:0),r[0]+=s}iC(i,r)}function uwe(r){r[0]=r[1]=1/0,r[2]=r[3]=-1/0}function PK(r,i,e,n){let o=Math.pow(2,n.z)*sf,s=[n.x*sf,n.y*sf],l=[];for(let h of r)for(let p of h){let m=[p.x+s[0],p.y+s[1]];lQ(m,i,e,o),l.push(m)}return l}function LK(r,i,e,n){let o=Math.pow(2,n.z)*sf,s=[n.x*sf,n.y*sf],l=[];for(let h of r){let p=[];for(let m of h){let f=[m.x+s[0],m.y+s[1]];iC(i,f),p.push(f)}l.push(p)}if(i[2]-i[0]<=o/2){uwe(i);for(let h of l)for(let p of h)lQ(p,i,e,o)}return l}function dwe(r,i){let e=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=r.canonicalID();if(i.type==="Polygon"){let s=fN(i.coordinates,n,o),l=PK(r.geometry(),e,n,o);if(!q2(e,n))return!1;for(let h of l)if(!lw(h,s))return!1}if(i.type==="MultiPolygon"){let s=sQ(i.coordinates,n,o),l=PK(r.geometry(),e,n,o);if(!q2(e,n))return!1;for(let h of l)if(!swe(h,s))return!1}return!0}function hwe(r,i){let e=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],o=r.canonicalID();if(i.type==="Polygon"){let s=fN(i.coordinates,n,o),l=LK(r.geometry(),e,n,o);if(!q2(e,n))return!1;for(let h of l)if(!aQ(h,s))return!1}if(i.type==="MultiPolygon"){let s=sQ(i.coordinates,n,o),l=LK(r.geometry(),e,n,o);if(!q2(e,n))return!1;for(let h of l)if(!lwe(h,s))return!1}return!0}var Y2=class r{constructor(i,e){this.type=yn,this.geojson=i,this.geometries=e}static parse(i,e){if(i.length!==2)return e.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(H2(i[1])){let n=i[1];if(n.type==="FeatureCollection"){let o=[];for(let s of n.features){let{type:l,coordinates:h}=s.geometry;l==="Polygon"&&o.push(h),l==="MultiPolygon"&&o.push(...h)}if(o.length){let s={type:"MultiPolygon",coordinates:o};return new r(n,s)}}else if(n.type==="Feature"){let o=n.geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new r(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new r(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return dwe(i,this.geometries);if(i.geometryType()==="LineString")return hwe(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}},tT=class{constructor(i=[],e=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;let i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){let{data:e,compare:n}=this,o=e[i];for(;i>0;){let s=i-1>>1,l=e[s];if(n(o,l)>=0)break;e[i]=l,i=s}e[i]=o}_down(i){let{data:e,compare:n}=this,o=this.length>>1,s=e[i];for(;i<o;){let l=(i<<1)+1,h=l+1;if(h<this.length&&n(e[h],e[l])<0&&(l=h),n(e[l],s)>=0)break;e[i]=e[l],i=l}e[i]=s}};function cQ(r,i,e=0,n=r.length-1,o=pwe){for(;n>e;){if(n-e>600){let p=n-e+1,m=i-e+1,f=Math.log(p),g=.5*Math.exp(2*f/3),y=.5*Math.sqrt(f*g*(p-g)/p)*(m-p/2<0?-1:1),_=Math.max(e,Math.floor(i-m*g/p+y)),w=Math.min(n,Math.floor(i+(p-m)*g/p+y));cQ(r,i,_,w,o)}let s=r[i],l=e,h=n;for(G2(r,e,i),o(r[n],s)>0&&G2(r,e,n);l<h;){for(G2(r,l,h),l++,h--;o(r[l],s)<0;)l++;for(;o(r[h],s)>0;)h--}o(r[e],s)===0?G2(r,e,h):(h++,G2(r,h,n)),h<=i&&(e=h+1),i<=h&&(n=h-1)}}function G2(r,i,e){let n=r[i];r[i]=r[e],r[e]=n}function pwe(r,i){return r<i?-1:r>i?1:0}function mwe(r,i){if(r.length<=1)return[r];let n=[],o,s;for(let l of r){let h=gwe(l);h!==0&&(l.area=Math.abs(h),s===void 0&&(s=h<0),s===h<0?(o&&n.push(o),o=[l]):o.push(l))}if(o&&n.push(o),i>1)for(let l=0;l<n.length;l++)n[l].length<=i||(cQ(n[l],i,1,n[l].length-1,fwe),n[l]=n[l].slice(0,i));return n}function fwe(r,i){return i.area-r.area}function gwe(r){let i=0;for(let e=0,n=r.length,o=n-1,s,l;e<n;o=e++)s=r[e],l=r[o],i+=(l.x-s.x)*(s.y+l.y);return i}var _we=6378.137,kK=1/298.257223563,OK=kK*(2-kK),DK=Math.PI/180,Z2=class{constructor(i){let e=DK*_we*1e3,n=Math.cos(i*DK),o=1/(1-OK*(1-n*n)),s=Math.sqrt(o);this.kx=e*s*n,this.ky=e*s*o*(1-OK)}distance(i,e){let n=this.wrap(i[0]-e[0])*this.kx,o=(i[1]-e[1])*this.ky;return Math.sqrt(n*n+o*o)}pointOnLine(i,e){let n=1/0,o,s,l,h;for(let p=0;p<i.length-1;p++){let m=i[p][0],f=i[p][1],g=this.wrap(i[p+1][0]-m)*this.kx,y=(i[p+1][1]-f)*this.ky,_=0;(g!==0||y!==0)&&(_=(this.wrap(e[0]-m)*this.kx*g+(e[1]-f)*this.ky*y)/(g*g+y*y),_>1?(m=i[p+1][0],f=i[p+1][1]):_>0&&(m+=g/this.kx*_,f+=y/this.ky*_)),g=this.wrap(e[0]-m)*this.kx,y=(e[1]-f)*this.ky;let w=g*g+y*y;w<n&&(n=w,o=m,s=f,l=p,h=_)}return{point:[o,s],index:l,t:Math.max(0,Math.min(1,h))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}},nN=100,oN=50;function uQ(r,i){return i[0]-r[0]}function iT(r){return r[1]-r[0]+1}function Rg(r,i){return r[1]>=r[0]&&r[1]<i}function aN(r,i){if(r[0]>r[1])return[null,null];let e=iT(r);if(i){if(e===2)return[r,null];let o=Math.floor(e/2);return[[r[0],r[0]+o],[r[0]+o,r[1]]]}if(e===1)return[r,null];let n=Math.floor(e/2)-1;return[[r[0],r[0]+n],[r[0]+n+1,r[1]]]}function sN(r,i){if(!Rg(i,r.length))return[1/0,1/0,-1/0,-1/0];let e=[1/0,1/0,-1/0,-1/0];for(let n=i[0];n<=i[1];++n)iC(e,r[n]);return e}function lN(r){let i=[1/0,1/0,-1/0,-1/0];for(let e of r)for(let n of e)iC(i,n);return i}function RK(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function gN(r,i,e){if(!RK(r)||!RK(i))return NaN;let n=0,o=0;return r[2]<i[0]&&(n=i[0]-r[2]),r[0]>i[2]&&(n=r[0]-i[2]),r[1]>i[3]&&(o=r[1]-i[3]),r[3]<i[1]&&(o=i[1]-r[3]),e.distance([0,0],[n,o])}function Ky(r,i,e){let n=e.pointOnLine(i,r);return e.distance(r,n.point)}function _N(r,i,e,n,o){let s=Math.min(Ky(r,[e,n],o),Ky(i,[e,n],o)),l=Math.min(Ky(e,[r,i],o),Ky(n,[r,i],o));return Math.min(s,l)}function ywe(r,i,e,n,o){if(!(Rg(i,r.length)&&Rg(n,e.length)))return 1/0;let l=1/0;for(let h=i[0];h<i[1];++h){let p=r[h],m=r[h+1];for(let f=n[0];f<n[1];++f){let g=e[f],y=e[f+1];if(yT(p,m,g,y))return 0;l=Math.min(l,_N(p,m,g,y,o))}}return l}function vwe(r,i,e,n,o){if(!(Rg(i,r.length)&&Rg(n,e.length)))return NaN;let l=1/0;for(let h=i[0];h<=i[1];++h)for(let p=n[0];p<=n[1];++p)if(l=Math.min(l,o.distance(r[h],e[p])),l===0)return l;return l}function bwe(r,i,e){if(lw(r,i,!0))return 0;let n=1/0;for(let o of i){let s=o[0],l=o[o.length-1];if(s!==l&&(n=Math.min(n,Ky(r,[l,s],e)),n===0))return n;let h=e.pointOnLine(o,r);if(n=Math.min(n,e.distance(r,h.point)),n===0)return n}return n}function wwe(r,i,e,n){if(!Rg(i,r.length))return NaN;for(let s=i[0];s<=i[1];++s)if(lw(r[s],e,!0))return 0;let o=1/0;for(let s=i[0];s<i[1];++s){let l=r[s],h=r[s+1];for(let p of e)for(let m=0,f=p.length,g=f-1;m<f;g=m++){let y=p[g],_=p[m];if(yT(l,h,y,_))return 0;o=Math.min(o,_N(l,h,y,_,n))}}return o}function NK(r,i){for(let e of r)for(let n of e)if(lw(n,i,!0))return!0;return!1}function xwe(r,i,e,n=1/0){let o=lN(r),s=lN(i);if(n!==1/0&&gN(o,s,e)>=n)return n;if(q2(o,s)){if(NK(r,i))return 0}else if(NK(i,r))return 0;let l=1/0;for(let h of r)for(let p=0,m=h.length,f=m-1;p<m;f=p++){let g=h[f],y=h[p];for(let _ of i)for(let w=0,A=_.length,k=A-1;w<A;k=w++){let R=_[k],q=_[w];if(yT(g,y,R,q))return 0;l=Math.min(l,_N(g,y,R,q,e))}}return l}function BK(r,i,e,n,o,s){if(!s)return;let l=gN(sN(n,s),o,e);l<i&&r.push([l,s,[0,0]])}function $E(r,i,e,n,o,s,l){if(!s||!l)return;let h=gN(sN(n,s),sN(o,l),e);h<i&&r.push([h,s,l])}function rT(r,i,e,n,o=1/0){let s=Math.min(n.distance(r[0],e[0][0]),o);if(s===0)return s;let l=new tT([[0,[0,r.length-1],[0,0]]],uQ),h=lN(e);for(;l.length>0;){let p=l.pop();if(p[0]>=s)continue;let m=p[1],f=i?oN:nN;if(iT(m)<=f){if(!Rg(m,r.length))return NaN;if(i){let g=wwe(r,m,e,n);if(isNaN(g)||g===0)return g;s=Math.min(s,g)}else for(let g=m[0];g<=m[1];++g){let y=bwe(r[g],e,n);if(s=Math.min(s,y),s===0)return 0}}else{let g=aN(m,i);BK(l,s,n,r,h,g[0]),BK(l,s,n,r,h,g[1])}}return s}function nT(r,i,e,n,o,s=1/0){let l=Math.min(s,o.distance(r[0],e[0]));if(l===0)return l;let h=new tT([[0,[0,r.length-1],[0,e.length-1]]],uQ);for(;h.length>0;){let p=h.pop();if(p[0]>=l)continue;let m=p[1],f=p[2],g=i?oN:nN,y=n?oN:nN;if(iT(m)<=g&&iT(f)<=y){if(!Rg(m,r.length)&&Rg(f,e.length))return NaN;let _;if(i&&n)_=ywe(r,m,e,f,o),l=Math.min(l,_);else if(i&&!n){let w=r.slice(m[0],m[1]+1);for(let A=f[0];A<=f[1];++A)if(_=Ky(e[A],w,o),l=Math.min(l,_),l===0)return l}else if(!i&&n){let w=e.slice(f[0],f[1]+1);for(let A=m[0];A<=m[1];++A)if(_=Ky(r[A],w,o),l=Math.min(l,_),l===0)return l}else _=vwe(r,m,e,f,o),l=Math.min(l,_)}else{let _=aN(m,i),w=aN(f,n);$E(h,l,o,r,e,_[0],w[0]),$E(h,l,o,r,e,_[0],w[1]),$E(h,l,o,r,e,_[1],w[0]),$E(h,l,o,r,e,_[1],w[1])}}return l}function Swe(r,i){let e=r.geometry(),n=e.flat().map(l=>mN([l.x,l.y],r.canonical));if(e.length===0)return NaN;let o=new Z2(n[0][1]),s=1/0;for(let l of i){switch(l.type){case"Point":s=Math.min(s,nT(n,!1,[l.coordinates],!1,o,s));break;case"LineString":s=Math.min(s,nT(n,!1,l.coordinates,!0,o,s));break;case"Polygon":s=Math.min(s,rT(n,!1,l.coordinates,o,s));break}if(s===0)return s}return s}function Cwe(r,i){let e=r.geometry(),n=e.flat().map(l=>mN([l.x,l.y],r.canonical));if(e.length===0)return NaN;let o=new Z2(n[0][1]),s=1/0;for(let l of i){switch(l.type){case"Point":s=Math.min(s,nT(n,!0,[l.coordinates],!1,o,s));break;case"LineString":s=Math.min(s,nT(n,!0,l.coordinates,!0,o,s));break;case"Polygon":s=Math.min(s,rT(n,!0,l.coordinates,o,s));break}if(s===0)return s}return s}function Awe(r,i){let e=r.geometry();if(e.length===0||e[0].length===0)return NaN;let n=mwe(e,0).map(l=>l.map(h=>h.map(p=>mN([p.x,p.y],r.canonical)))),o=new Z2(n[0][0][0][1]),s=1/0;for(let l of i)for(let h of n){switch(l.type){case"Point":s=Math.min(s,rT([l.coordinates],!1,h,o,s));break;case"LineString":s=Math.min(s,rT(l.coordinates,!0,h,o,s));break;case"Polygon":s=Math.min(s,xwe(h,l.coordinates,o,s));break}if(s===0)return s}return s}function $6(r){return r.type==="MultiPolygon"?r.coordinates.map(i=>({type:"Polygon",coordinates:i})):r.type==="MultiLineString"?r.coordinates.map(i=>({type:"LineString",coordinates:i})):r.type==="MultiPoint"?r.coordinates.map(i=>({type:"Point",coordinates:i})):[r]}var X2=class r{constructor(i,e){this.type=di,this.geojson=i,this.geometries=e}static parse(i,e){if(i.length!==2)return e.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(H2(i[1])){let n=i[1];if(n.type==="FeatureCollection")return new r(n,n.features.map(o=>$6(o.geometry)).flat());if(n.type==="Feature")return new r(n,$6(n.geometry));if("type"in n&&"coordinates"in n)return new r(n,$6(n))}return e.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return Swe(i,this.geometries);if(i.geometryType()==="LineString")return Cwe(i,this.geometries);if(i.geometryType()==="Polygon")return Awe(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},K2=class r{constructor(i){this.type=pn,this.key=i}static parse(i,e){if(i.length!==2)return e.error(`Expected 1 argument, but found ${i.length-1} instead.`);let n=i[1];return n==null?e.error("Global state property must be defined."):typeof n!="string"?e.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new r(n)}evaluate(i){var e;let n=(e=i.globals)===null||e===void 0?void 0:e.globalState;return!n||Object.keys(n).length===0?null:j2(n,this.key)}eachChild(){}outputDefined(){return!1}},rC={"==":qbe,"!=":Ybe,">":Xbe,"<":Zbe,">=":Qbe,"<=":Kbe,array:zp,at:Y6,boolean:zp,case:Q6,coalesce:JE,collator:eT,format:tN,image:iN,in:Z6,"index-of":X6,interpolate:Lg,"interpolate-hcl":Lg,"interpolate-lab":Lg,length:rN,let:XE,literal:ow,match:K6,number:zp,"number-format":eN,object:zp,slice:J6,step:QE,string:zp,"to-boolean":p_,"to-color":p_,"to-number":p_,"to-string":p_,var:KE,within:Y2,distance:X2,"global-state":K2},Wp=class r{constructor(i,e,n,o){this.name=i,this.type=e,this._evaluate=n,this.args=o}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,e){let n=i[0],o=r.definitions[n];if(!o)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let s=Array.isArray(o)?o[0]:o.type,l=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,h=l.filter(([m])=>!Array.isArray(m)||m.length===i.length-1),p=null;for(let[m,f]of h){p=new ZE(e.registry,oT,e.path,null,e.scope);let g=[],y=!1;for(let _=1;_<i.length;_++){let w=i[_],A=Array.isArray(m)?m[_-1]:m.type,k=p.parse(w,1+g.length,A);if(!k){y=!0;break}g.push(k)}if(!y){if(Array.isArray(m)&&m.length!==g.length){p.error(`Expected ${m.length} arguments, but found ${g.length} instead.`);continue}for(let _=0;_<g.length;_++){let w=Array.isArray(m)?m[_]:m.type,A=g[_];p.concat(_+1).checkSubtype(w,A.type)}if(p.errors.length===0)return new r(n,s,f,g)}}if(h.length===1)e.errors.push(...p.errors);else{let f=(h.length?h:l).map(([y])=>Iwe(y)).join(" | "),g=[];for(let y=1;y<i.length;y++){let _=e.parse(i[y],1+g.length);if(!_)return null;g.push(ds(_.type))}e.error(`Expected arguments of type ${f}, but found (${g.join(", ")}) instead.`)}return null}static register(i,e){r.definitions=e;for(let n in e)i[n]=r}};function GK(r,[i,e,n,o]){i=i.evaluate(r),e=e.evaluate(r),n=n.evaluate(r);let s=o?o.evaluate(r):1,l=iQ(i,e,n,s);if(l)throw new ns(l);return new No(i/255,e/255,n/255,s,!1)}function jK(r,i){return r in i}function W6(r,i){let e=i[r];return typeof e>"u"?null:e}function Mwe(r,i,e,n){for(;e<=n;){let o=e+n>>1;if(i[o]===r)return!0;i[o]>r?n=o-1:e=o+1}return!1}function Xy(r){return{type:r}}Wp.register(rC,{error:[ybe,[In],(r,[i])=>{throw new ns(i.evaluate(r))}],typeof:[In,[pn],(r,[i])=>ds(Cl(i.evaluate(r)))],"to-rgba":[ah(di,4),[af],(r,[i])=>{let[e,n,o,s]=i.evaluate(r).rgb;return[e*255,n*255,o*255,s]}],rgb:[af,[di,di,di],GK],rgba:[af,[di,di,di,di],GK],has:{type:yn,overloads:[[[In],(r,[i])=>jK(i.evaluate(r),r.properties())],[[In,Qy],(r,[i,e])=>jK(i.evaluate(r),e.evaluate(r))]]},get:{type:pn,overloads:[[[In],(r,[i])=>W6(i.evaluate(r),r.properties())],[[In,Qy],(r,[i,e])=>W6(i.evaluate(r),e.evaluate(r))]]},"feature-state":[pn,[In],(r,[i])=>W6(i.evaluate(r),r.featureState||{})],properties:[Qy,[],r=>r.properties()],"geometry-type":[In,[],r=>r.geometryType()],id:[pn,[],r=>r.id()],zoom:[di,[],r=>r.globals.zoom],"heatmap-density":[di,[],r=>r.globals.heatmapDensity||0],elevation:[di,[],r=>r.globals.elevation||0],"line-progress":[di,[],r=>r.globals.lineProgress||0],accumulated:[pn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[di,Xy(di),(r,i)=>{let e=0;for(let n of i)e+=n.evaluate(r);return e}],"*":[di,Xy(di),(r,i)=>{let e=1;for(let n of i)e*=n.evaluate(r);return e}],"-":{type:di,overloads:[[[di,di],(r,[i,e])=>i.evaluate(r)-e.evaluate(r)],[[di],(r,[i])=>-i.evaluate(r)]]},"/":[di,[di,di],(r,[i,e])=>i.evaluate(r)/e.evaluate(r)],"%":[di,[di,di],(r,[i,e])=>i.evaluate(r)%e.evaluate(r)],ln2:[di,[],()=>Math.LN2],pi:[di,[],()=>Math.PI],e:[di,[],()=>Math.E],"^":[di,[di,di],(r,[i,e])=>Math.pow(i.evaluate(r),e.evaluate(r))],sqrt:[di,[di],(r,[i])=>Math.sqrt(i.evaluate(r))],log10:[di,[di],(r,[i])=>Math.log(i.evaluate(r))/Math.LN10],ln:[di,[di],(r,[i])=>Math.log(i.evaluate(r))],log2:[di,[di],(r,[i])=>Math.log(i.evaluate(r))/Math.LN2],sin:[di,[di],(r,[i])=>Math.sin(i.evaluate(r))],cos:[di,[di],(r,[i])=>Math.cos(i.evaluate(r))],tan:[di,[di],(r,[i])=>Math.tan(i.evaluate(r))],asin:[di,[di],(r,[i])=>Math.asin(i.evaluate(r))],acos:[di,[di],(r,[i])=>Math.acos(i.evaluate(r))],atan:[di,[di],(r,[i])=>Math.atan(i.evaluate(r))],min:[di,Xy(di),(r,i)=>Math.min(...i.map(e=>e.evaluate(r)))],max:[di,Xy(di),(r,i)=>Math.max(...i.map(e=>e.evaluate(r)))],abs:[di,[di],(r,[i])=>Math.abs(i.evaluate(r))],round:[di,[di],(r,[i])=>{let e=i.evaluate(r);return e<0?-Math.round(-e):Math.round(e)}],floor:[di,[di],(r,[i])=>Math.floor(i.evaluate(r))],ceil:[di,[di],(r,[i])=>Math.ceil(i.evaluate(r))],"filter-==":[yn,[In,pn],(r,[i,e])=>r.properties()[i.value]===e.value],"filter-id-==":[yn,[pn],(r,[i])=>r.id()===i.value],"filter-type-==":[yn,[In],(r,[i])=>r.geometryType()===i.value],"filter-<":[yn,[In,pn],(r,[i,e])=>{let n=r.properties()[i.value],o=e.value;return typeof n==typeof o&&n<o}],"filter-id-<":[yn,[pn],(r,[i])=>{let e=r.id(),n=i.value;return typeof e==typeof n&&e<n}],"filter->":[yn,[In,pn],(r,[i,e])=>{let n=r.properties()[i.value],o=e.value;return typeof n==typeof o&&n>o}],"filter-id->":[yn,[pn],(r,[i])=>{let e=r.id(),n=i.value;return typeof e==typeof n&&e>n}],"filter-<=":[yn,[In,pn],(r,[i,e])=>{let n=r.properties()[i.value],o=e.value;return typeof n==typeof o&&n<=o}],"filter-id-<=":[yn,[pn],(r,[i])=>{let e=r.id(),n=i.value;return typeof e==typeof n&&e<=n}],"filter->=":[yn,[In,pn],(r,[i,e])=>{let n=r.properties()[i.value],o=e.value;return typeof n==typeof o&&n>=o}],"filter-id->=":[yn,[pn],(r,[i])=>{let e=r.id(),n=i.value;return typeof e==typeof n&&e>=n}],"filter-has":[yn,[pn],(r,[i])=>i.value in r.properties()],"filter-has-id":[yn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[yn,[ah(In)],(r,[i])=>i.value.indexOf(r.geometryType())>=0],"filter-id-in":[yn,[ah(pn)],(r,[i])=>i.value.indexOf(r.id())>=0],"filter-in-small":[yn,[In,ah(pn)],(r,[i,e])=>e.value.indexOf(r.properties()[i.value])>=0],"filter-in-large":[yn,[In,ah(pn)],(r,[i,e])=>Mwe(r.properties()[i.value],e.value,0,e.value.length-1)],all:{type:yn,overloads:[[[yn,yn],(r,[i,e])=>i.evaluate(r)&&e.evaluate(r)],[Xy(yn),(r,i)=>{for(let e of i)if(!e.evaluate(r))return!1;return!0}]]},any:{type:yn,overloads:[[[yn,yn],(r,[i,e])=>i.evaluate(r)||e.evaluate(r)],[Xy(yn),(r,i)=>{for(let e of i)if(e.evaluate(r))return!0;return!1}]]},"!":[yn,[yn],(r,[i])=>!i.evaluate(r)],"is-supported-script":[yn,[In],(r,[i])=>{let e=r.globals&&r.globals.isSupportedScript;return e?e(i.evaluate(r)):!0}],upcase:[In,[In],(r,[i])=>i.evaluate(r).toUpperCase()],downcase:[In,[In],(r,[i])=>i.evaluate(r).toLowerCase()],concat:[In,Xy(pn),(r,i)=>i.map(e=>V2(e.evaluate(r))).join("")],"resolved-locale":[In,[pT],(r,[i])=>i.evaluate(r).resolvedLocale()]});function Iwe(r){return Array.isArray(r)?`(${r.map(ds).join(", ")})`:`(${ds(r.type)}...)`}function oT(r){if(r instanceof KE)return oT(r.boundExpression);if(r instanceof Wp&&r.name==="error")return!1;if(r instanceof eT)return!1;if(r instanceof Y2)return!1;if(r instanceof X2)return!1;if(r instanceof K2)return!1;let i=r instanceof p_||r instanceof zp,e=!0;return r.eachChild(n=>{i?e=e&&oT(n):e=e&&n instanceof ow}),e?vT(r)&&bT(r,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function vT(r){if(r instanceof Wp){if(r.name==="get"&&r.args.length===1)return!1;if(r.name==="feature-state")return!1;if(r.name==="has"&&r.args.length===1)return!1;if(r.name==="properties"||r.name==="geometry-type"||r.name==="id")return!1;if(/^filter-/.test(r.name))return!1}if(r instanceof Y2||r instanceof X2)return!1;let i=!0;return r.eachChild(e=>{i&&!vT(e)&&(i=!1)}),i}function Q2(r){if(r instanceof Wp&&r.name==="feature-state")return!1;let i=!0;return r.eachChild(e=>{i&&!Q2(e)&&(i=!1)}),i}function bT(r,i){if(r instanceof Wp&&i.indexOf(r.name)>=0)return!1;let e=!0;return r.eachChild(n=>{e&&!bT(n,i)&&(e=!1)}),e}function cN(r){return{result:"success",value:r}}function tw(r){return{result:"error",value:r}}function aT(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function dQ(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function hQ(r){return!!r.expression&&r.expression.interpolated}function Rn(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function nC(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&Cl(r)===Qy}var uN=class{constructor(i,e){this.expression=i,this._warningHistory={},this._evaluator=new YE,this._defaultValue=e?Twe(e):null,this._enumValues=e&&e.type==="enum"?e.values:null}evaluateWithoutErrorHandling(i,e,n,o,s,l){return this._evaluator.globals=i,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=o,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=l,this.expression.evaluate(this._evaluator)}evaluate(i,e,n,o,s,l){this._evaluator.globals=i,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=o,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=l||null;try{let h=this.expression.evaluate(this._evaluator);if(h==null||typeof h=="number"&&h!==h)return this._defaultValue;if(this._enumValues&&!(h in this._enumValues))throw new ns(`Expected value to be one of ${Object.keys(this._enumValues).map(p=>JSON.stringify(p)).join(", ")}, but found ${JSON.stringify(h)} instead.`);return h}catch(h){return this._warningHistory[h.message]||(this._warningHistory[h.message]=!0,typeof console<"u"&&console.warn(h.message)),this._defaultValue}}};function wT(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in rC}function yN(r,i){let e=new ZE(rC,oT,[],i?Ewe(i):void 0),n=e.parse(r,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?cN(new uN(n,i)):tw(e.errors)}var sT=class{constructor(i,e){this.kind=i,this._styleExpression=e,this.isStateDependent=i!=="constant"&&!Q2(e.expression),this.globalStateRefs=xT(e.expression)}evaluateWithoutErrorHandling(i,e,n,o,s,l){return this._styleExpression.evaluateWithoutErrorHandling(i,e,n,o,s,l)}evaluate(i,e,n,o,s,l){return this._styleExpression.evaluate(i,e,n,o,s,l)}},lT=class{constructor(i,e,n,o){this.kind=i,this.zoomStops=n,this._styleExpression=e,this.isStateDependent=i!=="camera"&&!Q2(e.expression),this.globalStateRefs=xT(e.expression),this.interpolationType=o}evaluateWithoutErrorHandling(i,e,n,o,s,l){return this._styleExpression.evaluateWithoutErrorHandling(i,e,n,o,s,l)}evaluate(i,e,n,o,s,l){return this._styleExpression.evaluate(i,e,n,o,s,l)}interpolationFactor(i,e,n){return this.interpolationType?Lg.interpolationFactor(this.interpolationType,i,e,n):0}};function vN(r,i){let e=yN(r,i);if(e.result==="error")return e;let n=e.value.expression,o=vT(n);if(!o&&!aT(i))return tw([new ip("","data expressions not supported")]);let s=bT(n,["zoom"]);if(!s&&!dQ(i))return tw([new ip("","zoom expressions not supported")]);let l=HE(n);if(!l&&!s)return tw([new ip("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(l instanceof ip)return tw([l]);if(l instanceof Lg&&!hQ(i))return tw([new ip("",'"interpolate" expressions cannot be used with this property')]);if(!l)return cN(o?new sT("constant",e.value):new sT("source",e.value));let h=l instanceof Lg?l.interpolation:void 0;return cN(o?new lT("camera",e.value,l.labels,h):new lT("composite",e.value,l.labels,h))}function HE(r){let i=null;if(r instanceof XE)i=HE(r.result);else if(r instanceof JE){for(let e of r.args)if(i=HE(e),i)break}else(r instanceof QE||r instanceof Lg)&&r.input instanceof Wp&&r.input.name==="zoom"&&(i=r);return i instanceof ip||r.eachChild(e=>{let n=HE(e);n instanceof ip?i=n:!i&&n?i=new ip("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&n&&i!==n&&(i=new ip("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function xT(r,i=new Set){return r instanceof K2&&i.add(r.key),r.eachChild(e=>{xT(e,i)}),i}function Ewe(r){let i={color:af,string:In,number:di,enum:In,boolean:yn,formatted:mT,padding:fT,numberArray:gT,colorArray:U2,projectionDefinition:hT,resolvedImage:tC,variableAnchorOffsetCollection:_T};return r.type==="array"?ah(i[r.value]||pn,r.length):i[r.type]}function Twe(r){if(r.type==="color"&&nC(r.default))return new No(0,0,0,0);switch(r.type){case"color":return No.parse(r.default)||null;case"padding":return kg.parse(r.default)||null;case"numberArray":return Og.parse(r.default)||null;case"colorArray":return $p.parse(r.default)||null;case"variableAnchorOffsetCollection":return Dg.parse(r.default)||null;case"projectionDefinition":return t1.parse(r.default)||null;default:return r.default===void 0?null:r.default}}function bN(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(let i of r.slice(1))if(!bN(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}var Fwe={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function pQ(r){if(r==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};bN(r)||(r=cT(r));let i=yN(r,Fwe);if(i.result==="error")throw new Error(i.value.map(e=>`${e.key}: ${e.message}`).join(", "));{let e=mQ(r);return{filter:(n,o,s)=>i.value.evaluate(n,o,{},s),needGeometry:e,getGlobalStateRefs:()=>xT(i.value.expression)}}}function Pwe(r,i){return r<i?-1:r>i?1:0}function mQ(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let i=1;i<r.length;i++)if(mQ(r[i]))return!0;return!1}function cT(r){if(!r)return!0;let i=r[0];return r.length<=1?i!=="any":i==="=="?H6(r[1],r[2],"=="):i==="!="?WE(H6(r[1],r[2],"==")):i==="<"||i===">"||i==="<="||i===">="?H6(r[1],r[2],i):i==="any"?Lwe(r.slice(1)):i==="all"?["all"].concat(r.slice(1).map(cT)):i==="none"?["all"].concat(r.slice(1).map(cT).map(WE)):i==="in"?VK(r[1],r.slice(2)):i==="!in"?WE(VK(r[1],r.slice(2))):i==="has"?UK(r[1]):i==="!has"?WE(UK(r[1])):!0}function H6(r,i,e){switch(r){case"$type":return[`filter-type-${e}`,i];case"$id":return[`filter-id-${e}`,i];default:return[`filter-${e}`,r,i]}}function Lwe(r){return["any"].concat(r.map(cT))}function VK(r,i){if(i.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(e=>typeof e!=typeof i[0])?["filter-in-large",r,["literal",i.sort(Pwe)]]:["filter-in-small",r,["literal",i]]}}function UK(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function WE(r){return["!",r]}function J2(r){return typeof r=="object"?["literal",r]:r}function fQ(r,i){let e=r.stops;if(!e)return kwe(r,i);let n=e&&typeof e[0][0]=="object",o=n||r.property!==void 0,s=n||!o;return e=e.map(l=>!o&&i.tokens&&typeof l[1]=="string"?[l[0],Nwe(l[1])]:[l[0],J2(l[1])]),n?Owe(r,i,e):s?Rwe(r,i,e):dN(r,i,e)}function kwe(r,i){let e=["get",r.property];if(r.default===void 0)return i.type==="string"?["string",e]:e;if(i.type==="enum")return["match",e,Object.keys(i.values),e,r.default];{let n=[i.type==="color"?"to-color":i.type,e,J2(r.default)];return i.type==="array"&&n.splice(1,0,i.value,i.length||null),n}}function wN(r){switch(r.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function Owe(r,i,e){let n={},o={},s=[];for(let h=0;h<e.length;h++){let p=e[h],m=p[0].zoom;n[m]===void 0&&(n[m]={zoom:m,type:r.type,property:r.property,default:r.default},o[m]=[],s.push(m)),o[m].push([p[0].value,p[1]])}if(SN({},i)==="exponential"){let h=[wN(r),["linear"],["zoom"]];for(let p of s){let m=dN(n[p],i,o[p]);rw(h,p,m,!1)}return h}else{let h=["step",["zoom"]];for(let p of s){let m=dN(n[p],i,o[p]);rw(h,p,m,!0)}return xN(h),h}}function Dwe(r,i){if(r!==void 0)return r;if(i!==void 0)return i}function zK(r,i){let e=J2(Dwe(r.default,i.default));return e===void 0&&i.type==="resolvedImage"?"":e}function dN(r,i,e){let n=SN(r,i),o=["get",r.property];if(n==="categorical"&&typeof e[0][0]=="boolean"){let s=["case"];for(let l of e)s.push(["==",o,l[0]],l[1]);return s.push(zK(r,i)),s}else if(n==="categorical"){let s=["match",o];for(let l of e)rw(s,l[0],l[1],!1);return s.push(zK(r,i)),s}else if(n==="interval"){let s=["step",["number",o]];for(let l of e)rw(s,l[0],l[1],!0);return xN(s),r.default===void 0?s:["case",["==",["typeof",o],"number"],s,J2(r.default)]}else if(n==="exponential"){let s=r.base!==void 0?r.base:1,l=[wN(r),s===1?["linear"]:["exponential",s],["number",o]];for(let h of e)rw(l,h[0],h[1],!1);return r.default===void 0?l:["case",["==",["typeof",o],"number"],l,J2(r.default)]}else throw new Error(`Unknown property function type ${n}`)}function Rwe(r,i,e,n=["zoom"]){let o=SN(r,i),s,l=!1;if(o==="interval")s=["step",n],l=!0;else if(o==="exponential"){let h=r.base!==void 0?r.base:1;s=[wN(r),h===1?["linear"]:["exponential",h],n]}else throw new Error(`Unknown zoom function type "${o}"`);for(let h of e)rw(s,h[0],h[1],l);return xN(s),s}function xN(r){r[0]==="step"&&r.length===3&&(r.push(0),r.push(r[3]))}function rw(r,i,e,n){r.length>3&&i===r[r.length-2]||(n&&r.length===2||r.push(i),r.push(e))}function SN(r,i){return r.type?r.type:i.expression.interpolated?"exponential":"interval"}function Nwe(r){let i=["concat"],e=/{([^{}]+)}/g,n=0;for(let o=e.exec(r);o!==null;o=e.exec(r)){let s=r.slice(n,e.lastIndex-o[0].length);n=e.lastIndex,s.length>0&&i.push(s),i.push(["get",o[1]])}if(i.length===1)return r;if(n<r.length)i.push(r.slice(n));else if(i.length===2)return["to-string",i[1]];return i}function gQ(r){let i=r.key,e=r.value;return e?[new ri(i,e,"constants have been deprecated as of v8")]:[]}function Vs(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function i1(r){if(Array.isArray(r))return r.map(i1);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){let i={};for(let e in r)i[e]=i1(r[e]);return i}return Vs(r)}function rp(r){let i=r.key,e=r.value,n=r.valueSpec||{},o=r.objectElementValidators||{},s=r.style,l=r.styleSpec,h=r.validateSpec,p=[],m=Rn(e);if(m!=="object")return[new ri(i,e,`object expected, ${m} found`)];for(let f in e){let g=f.split(".")[0],y=j2(n,g)||n["*"],_;if(j2(o,g))_=o[g];else if(j2(n,g))_=h;else if(o["*"])_=o["*"];else if(n["*"])_=h;else{p.push(new ri(i,e[f],`unknown property "${f}"`));continue}p=p.concat(_({key:(i&&`${i}.`)+f,value:e[f],valueSpec:y,style:s,styleSpec:l,object:e,objectKey:f,validateSpec:h},e))}for(let f in n)o[f]||n[f].required&&n[f].default===void 0&&e[f]===void 0&&p.push(new ri(i,e,`missing required property "${f}"`));return p}function CN(r){let i=r.value,e=r.valueSpec,n=r.validateSpec,o=r.style,s=r.styleSpec,l=r.key,h=r.arrayElementValidator||n;if(Rn(i)!=="array")return[new ri(l,i,`array expected, ${Rn(i)} found`)];if(e.length&&i.length!==e.length)return[new ri(l,i,`array length ${e.length} expected, length ${i.length} found`)];if(e["min-length"]&&i.length<e["min-length"])return[new ri(l,i,`array length at least ${e["min-length"]} expected, length ${i.length} found`)];let p={type:e.value,values:e.values};s.$version<7&&(p.function=e.function),Rn(e.value)==="object"&&(p=e.value);let m=[];for(let f=0;f<i.length;f++)m=m.concat(h({array:i,arrayIndex:f,value:i[f],valueSpec:p,validateSpec:r.validateSpec,style:o,styleSpec:s,key:`${l}[${f}]`}));return m}function ST(r){let i=r.key,e=r.value,n=r.valueSpec,o=Rn(e);return o==="number"&&e!==e&&(o="NaN"),o!=="number"?[new ri(i,e,`number expected, ${o} found`)]:"minimum"in n&&e<n.minimum?[new ri(i,e,`${e} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&e>n.maximum?[new ri(i,e,`${e} is greater than the maximum value ${n.maximum}`)]:[]}function _Q(r){let i=r.valueSpec,e=Vs(r.value.type),n,o={},s,l,h=e!=="categorical"&&r.value.property===void 0,p=!h,m=Rn(r.value.stops)==="array"&&Rn(r.value.stops[0])==="array"&&Rn(r.value.stops[0][0])==="object",f=rp({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:g,default:w}});return e==="identity"&&h&&f.push(new ri(r.key,r.value,'missing required property "property"')),e!=="identity"&&!r.value.stops&&f.push(new ri(r.key,r.value,'missing required property "stops"')),e==="exponential"&&r.valueSpec.expression&&!hQ(r.valueSpec)&&f.push(new ri(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(p&&!aT(r.valueSpec)?f.push(new ri(r.key,r.value,"property functions not supported")):h&&!dQ(r.valueSpec)&&f.push(new ri(r.key,r.value,"zoom functions not supported"))),(e==="categorical"||m)&&r.value.property===void 0&&f.push(new ri(r.key,r.value,'"property" property is required')),f;function g(A){if(e==="identity")return[new ri(A.key,A.value,'identity function may not have a "stops" property')];let k=[],R=A.value;return k=k.concat(CN({key:A.key,value:R,valueSpec:A.valueSpec,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,arrayElementValidator:y})),Rn(R)==="array"&&R.length===0&&k.push(new ri(A.key,R,"array must have at least one stop")),k}function y(A){let k=[],R=A.value,q=A.key;if(Rn(R)!=="array")return[new ri(q,R,`array expected, ${Rn(R)} found`)];if(R.length!==2)return[new ri(q,R,`array length 2 expected, length ${R.length} found`)];if(m){if(Rn(R[0])!=="object")return[new ri(q,R,`object expected, ${Rn(R[0])} found`)];if(R[0].zoom===void 0)return[new ri(q,R,"object stop key must have zoom")];if(R[0].value===void 0)return[new ri(q,R,"object stop key must have value")];if(l&&l>Vs(R[0].zoom))return[new ri(q,R[0].zoom,"stop zoom values must appear in ascending order")];Vs(R[0].zoom)!==l&&(l=Vs(R[0].zoom),s=void 0,o={}),k=k.concat(rp({key:`${q}[0]`,value:R[0],valueSpec:{zoom:{}},validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec,objectElementValidators:{zoom:ST,value:_}}))}else k=k.concat(_({key:`${q}[0]`,value:R[0],validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec},R));return wT(i1(R[1]))?k.concat([new ri(`${q}[1]`,R[1],"expressions are not allowed in function stops.")]):k.concat(A.validateSpec({key:`${q}[1]`,value:R[1],valueSpec:i,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec}))}function _(A,k){let R=Rn(A.value),q=Vs(A.value),X=A.value!==null?A.value:k;if(!n)n=R;else if(R!==n)return[new ri(A.key,X,`${R} stop domain type must match previous stop domain type ${n}`)];if(R!=="number"&&R!=="string"&&R!=="boolean")return[new ri(A.key,X,"stop domain value must be a number, string, or boolean")];if(R!=="number"&&e!=="categorical"){let ie=`number expected, ${R} found`;return aT(i)&&e===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ri(A.key,X,ie)]}return e==="categorical"&&R==="number"&&(!isFinite(q)||Math.floor(q)!==q)?[new ri(A.key,X,`integer expected, found ${q}`)]:e!=="categorical"&&R==="number"&&s!==void 0&&q<s?[new ri(A.key,X,"stop domain values must appear in ascending order")]:(s=q,e==="categorical"&&q in o?[new ri(A.key,X,"stop domain values must be unique")]:(o[q]=!0,[]))}function w(A){return A.validateSpec({key:A.key,value:A.value,valueSpec:i,validateSpec:A.validateSpec,style:A.style,styleSpec:A.styleSpec})}}function aw(r){let i=(r.expressionContext==="property"?vN:yN)(i1(r.value),r.valueSpec);if(i.result==="error")return i.value.map(n=>new ri(`${r.key}${n.key}`,r.value,n.message));let e=i.value.expression||i.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!e.outputDefined())return[new ri(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Q2(e))return[new ri(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Q2(e))return[new ri(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!bT(e,["zoom","feature-state"]))return[new ri(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!vT(e))return[new ri(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bwe(r){let i=r.value,e=r.key,n=Rn(i);return n!=="boolean"?[new ri(e,i,`boolean expected, ${n} found`)]:[]}function hN(r){let i=r.key,e=r.value,n=Rn(e);return n!=="string"?[new ri(i,e,`color expected, ${n} found`)]:No.parse(String(e))?[]:[new ri(i,e,`color expected, "${e}" found`)]}function eC(r){let i=r.key,e=r.value,n=r.valueSpec,o=[];return Array.isArray(n.values)?n.values.indexOf(Vs(e))===-1&&o.push(new ri(i,e,`expected one of [${n.values.join(", ")}], ${JSON.stringify(e)} found`)):Object.keys(n.values).indexOf(Vs(e))===-1&&o.push(new ri(i,e,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(e)} found`)),o}function AN(r){return bN(i1(r.value))?aw(qE({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):yQ(r)}function yQ(r){let i=r.value,e=r.key;if(Rn(i)!=="array")return[new ri(e,i,`array expected, ${Rn(i)} found`)];let n=r.styleSpec,o,s=[];if(i.length<1)return[new ri(e,i,"filter array must have at least 1 element")];switch(s=s.concat(eC({key:`${e}[0]`,value:i[0],valueSpec:n.filter_operator,style:r.style,styleSpec:r.styleSpec})),Vs(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Vs(i[1])==="$type"&&s.push(new ri(e,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&s.push(new ri(e,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(o=Rn(i[1]),o!=="string"&&s.push(new ri(`${e}[1]`,i[1],`string expected, ${o} found`)));for(let l=2;l<i.length;l++)o=Rn(i[l]),Vs(i[1])==="$type"?s=s.concat(eC({key:`${e}[${l}]`,value:i[l],valueSpec:n.geometry_type,style:r.style,styleSpec:r.styleSpec})):o!=="string"&&o!=="number"&&o!=="boolean"&&s.push(new ri(`${e}[${l}]`,i[l],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let l=1;l<i.length;l++)s=s.concat(yQ({key:`${e}[${l}]`,value:i[l],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":o=Rn(i[1]),i.length!==2?s.push(new ri(e,i,`filter array for "${i[0]}" operator must have 2 elements`)):o!=="string"&&s.push(new ri(`${e}[1]`,i[1],`string expected, ${o} found`));break}return s}function vQ(r,i){let e=r.key,n=r.validateSpec,o=r.style,s=r.styleSpec,l=r.value,h=r.objectKey,p=s[`${i}_${r.layerType}`];if(!p)return[];let m=h.match(/^(.*)-transition$/);if(i==="paint"&&m&&p[m[1]]&&p[m[1]].transition)return n({key:e,value:l,valueSpec:s.transition,style:o,styleSpec:s});let f=r.valueSpec||p[h];if(!f)return[new ri(e,l,`unknown property "${h}"`)];let g;if(Rn(l)==="string"&&aT(f)&&!f.tokens&&(g=/^{([^}]+)}$/.exec(l)))return[new ri(e,l,`"${h}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(g[1])} }\`.`)];let y=[];return r.layerType==="symbol"&&(h==="text-field"&&o&&!o.glyphs&&y.push(new ri(e,l,'use of "text-field" requires a style "glyphs" property')),h==="text-font"&&nC(i1(l))&&Vs(l.type)==="identity"&&y.push(new ri(e,l,'"text-font" does not support identity functions'))),y.concat(n({key:r.key,value:l,valueSpec:f,style:o,styleSpec:s,expressionContext:"property",propertyType:i,propertyKey:h}))}function bQ(r){return vQ(r,"paint")}function wQ(r){return vQ(r,"layout")}function xQ(r){let i=[],e=r.value,n=r.key,o=r.style,s=r.styleSpec;if(Rn(e)!=="object")return[new ri(n,e,`object expected, ${Rn(e)} found`)];!e.type&&!e.ref&&i.push(new ri(n,e,'either "type" or "ref" is required'));let l=Vs(e.type),h=Vs(e.ref);if(e.id){let p=Vs(e.id);for(let m=0;m<r.arrayIndex;m++){let f=o.layers[m];Vs(f.id)===p&&i.push(new ri(n,e.id,`duplicate layer id "${e.id}", previously used at line ${f.id.__line__}`))}}if("ref"in e){["type","source","source-layer","filter","layout"].forEach(m=>{m in e&&i.push(new ri(n,e[m],`"${m}" is prohibited for ref layers`))});let p;o.layers.forEach(m=>{Vs(m.id)===h&&(p=m)}),p?p.ref?i.push(new ri(n,e.ref,"ref cannot reference another ref layer")):l=Vs(p.type):i.push(new ri(n,e.ref,`ref layer "${h}" not found`))}else if(l!=="background")if(!e.source)i.push(new ri(n,e,'missing required property "source"'));else{let p=o.sources&&o.sources[e.source],m=p&&Vs(p.type);p?m==="vector"&&l==="raster"?i.push(new ri(n,e.source,`layer "${e.id}" requires a raster source`)):m!=="raster-dem"&&l==="hillshade"?i.push(new ri(n,e.source,`layer "${e.id}" requires a raster-dem source`)):m!=="raster-dem"&&l==="color-relief"?i.push(new ri(n,e.source,`layer "${e.id}" requires a raster-dem source`)):m==="raster"&&l!=="raster"?i.push(new ri(n,e.source,`layer "${e.id}" requires a vector source`)):m==="vector"&&!e["source-layer"]?i.push(new ri(n,e,`layer "${e.id}" must specify a "source-layer"`)):m==="raster-dem"&&l!=="hillshade"&&l!=="color-relief"?i.push(new ri(n,e.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):l==="line"&&e.paint&&e.paint["line-gradient"]&&(m!=="geojson"||!p.lineMetrics)&&i.push(new ri(n,e,`layer "${e.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new ri(n,e.source,`source "${e.source}" not found`))}return i=i.concat(rp({key:n,value:e,valueSpec:s.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*"(){return[]},type(){return r.validateSpec({key:`${n}.type`,value:e.type,valueSpec:s.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:e,objectKey:"type"})},filter:AN,layout(p){return rp({layer:e,key:p.key,value:p.value,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*"(m){return wQ(qE({layerType:l},m))}}})},paint(p){return rp({layer:e,key:p.key,value:p.value,style:p.style,styleSpec:p.styleSpec,validateSpec:p.validateSpec,objectElementValidators:{"*"(m){return bQ(qE({layerType:l},m))}}})}}})),i}function r1(r){let i=r.value,e=r.key,n=Rn(i);return n!=="string"?[new ri(e,i,`string expected, ${n} found`)]:[]}function Gwe(r){var i;let e=(i=r.sourceName)!==null&&i!==void 0?i:"",n=r.value,o=r.styleSpec,s=o.source_raster_dem,l=r.style,h=[],p=Rn(n);if(n===void 0)return h;if(p!=="object")return h.push(new ri("source_raster_dem",n,`object expected, ${p} found`)),h;let f=Vs(n.encoding)==="custom",g=["redFactor","greenFactor","blueFactor","baseShift"],y=r.value.encoding?`"${r.value.encoding}"`:"Default";for(let _ in n)!f&&g.includes(_)?h.push(new ri(_,n[_],`In "${e}": "${_}" is only valid when "encoding" is set to "custom". ${y} encoding found`)):s[_]?h=h.concat(r.validateSpec({key:_,value:n[_],valueSpec:s[_],validateSpec:r.validateSpec,style:l,styleSpec:o})):h.push(new ri(_,n[_],`unknown property "${_}"`));return h}var $K={promoteId:jwe};function SQ(r){let i=r.value,e=r.key,n=r.styleSpec,o=r.style,s=r.validateSpec;if(!i.type)return[new ri(e,i,'"type" is required')];let l=Vs(i.type),h;switch(l){case"vector":case"raster":return h=rp({key:e,value:i,valueSpec:n[`source_${l.replace("-","_")}`],style:r.style,styleSpec:n,objectElementValidators:$K,validateSpec:s}),h;case"raster-dem":return h=Gwe({sourceName:e,value:i,style:r.style,styleSpec:n,validateSpec:s}),h;case"geojson":if(h=rp({key:e,value:i,valueSpec:n.source_geojson,style:o,styleSpec:n,validateSpec:s,objectElementValidators:$K}),i.cluster)for(let p in i.clusterProperties){let[m,f]=i.clusterProperties[p],g=typeof m=="string"?[m,["accumulated"],["get",p]]:m;h.push(...aw({key:`${e}.${p}.map`,value:f,expressionContext:"cluster-map"})),h.push(...aw({key:`${e}.${p}.reduce`,value:g,expressionContext:"cluster-reduce"}))}return h;case"video":return rp({key:e,value:i,valueSpec:n.source_video,style:o,validateSpec:s,styleSpec:n});case"image":return rp({key:e,value:i,valueSpec:n.source_image,style:o,validateSpec:s,styleSpec:n});case"canvas":return[new ri(e,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return eC({key:`${e}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function jwe({key:r,value:i}){if(Rn(i)==="string")return r1({key:r,value:i});{let e=[];for(let n in i)e.push(...r1({key:`${r}.${n}`,value:i[n]}));return e}}function CQ(r){let i=r.value,e=r.styleSpec,n=e.light,o=r.style,s=[],l=Rn(i);if(i===void 0)return s;if(l!=="object")return s=s.concat([new ri("light",i,`object expected, ${l} found`)]),s;for(let h in i){let p=h.match(/^(.*)-transition$/);p&&n[p[1]]&&n[p[1]].transition?s=s.concat(r.validateSpec({key:h,value:i[h],valueSpec:e.transition,validateSpec:r.validateSpec,style:o,styleSpec:e})):n[h]?s=s.concat(r.validateSpec({key:h,value:i[h],valueSpec:n[h],validateSpec:r.validateSpec,style:o,styleSpec:e})):s=s.concat([new ri(h,i[h],`unknown property "${h}"`)])}return s}function AQ(r){let i=r.value,e=r.styleSpec,n=e.sky,o=r.style,s=Rn(i);if(i===void 0)return[];if(s!=="object")return[new ri("sky",i,`object expected, ${s} found`)];let l=[];for(let h in i)n[h]?l=l.concat(r.validateSpec({key:h,value:i[h],valueSpec:n[h],style:o,styleSpec:e})):l=l.concat([new ri(h,i[h],`unknown property "${h}"`)]);return l}function MQ(r){let i=r.value,e=r.styleSpec,n=e.terrain,o=r.style,s=[],l=Rn(i);if(i===void 0)return s;if(l!=="object")return s=s.concat([new ri("terrain",i,`object expected, ${l} found`)]),s;for(let h in i)n[h]?s=s.concat(r.validateSpec({key:h,value:i[h],valueSpec:n[h],validateSpec:r.validateSpec,style:o,styleSpec:e})):s=s.concat([new ri(h,i[h],`unknown property "${h}"`)]);return s}function Vwe(r){return r1(r).length===0?[]:aw(r)}function Uwe(r){return r1(r).length===0?[]:aw(r)}function zwe(r){let i=r.key,e=r.value;if(Rn(e)==="array"){if(e.length<1||e.length>4)return[new ri(i,e,`padding requires 1 to 4 values; ${e.length} values found`)];let o={type:"number"},s=[];for(let l=0;l<e.length;l++)s=s.concat(r.validateSpec({key:`${i}[${l}]`,value:e[l],validateSpec:r.validateSpec,valueSpec:o}));return s}else return ST({key:i,value:e,valueSpec:{}})}function $we(r){let i=r.key,e=r.value;if(Rn(e)==="array"){let o={type:"number"};if(e.length<1)return[new ri(i,e,"array length at least 1 expected, length 0 found")];let s=[];for(let l=0;l<e.length;l++)s=s.concat(r.validateSpec({key:`${i}[${l}]`,value:e[l],validateSpec:r.validateSpec,valueSpec:o}));return s}else return ST({key:i,value:e,valueSpec:{}})}function Wwe(r){let i=r.key,e=r.value;if(Rn(e)==="array"){if(e.length<1)return[new ri(i,e,"array length at least 1 expected, length 0 found")];let o=[];for(let s=0;s<e.length;s++)o=o.concat(hN({key:`${i}[${s}]`,value:e[s]}));return o}else return hN({key:i,value:e})}function Hwe(r){let i=r.key,e=r.value,n=Rn(e),o=r.styleSpec;if(n!=="array"||e.length<1||e.length%2!==0)return[new ri(i,e,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let l=0;l<e.length;l+=2)s=s.concat(eC({key:`${i}[${l}]`,value:e[l],valueSpec:o.layout_symbol["text-anchor"]})),s=s.concat(CN({key:`${i}[${l+1}]`,value:e[l+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:o}));return s}function IQ(r){let i=[],e=r.value,n=r.key;if(Array.isArray(e)){let o=[],s=[];for(let l in e){e[l].id&&o.includes(e[l].id)&&i.push(new ri(n,e,`all the sprites' ids must be unique, but ${e[l].id} is duplicated`)),o.push(e[l].id),e[l].url&&s.includes(e[l].url)&&i.push(new ri(n,e,`all the sprites' URLs must be unique, but ${e[l].url} is duplicated`)),s.push(e[l].url);let h={id:{type:"string",required:!0},url:{type:"string",required:!0}};i=i.concat(rp({key:`${n}[${l}]`,value:e[l],valueSpec:h,validateSpec:r.validateSpec}))}return i}else return r1({key:n,value:e})}function qwe(r){let i=r.value,e=r.styleSpec,n=e.projection,o=r.style,s=Rn(i);if(i===void 0)return[];if(s!=="object")return[new ri("projection",i,`object expected, ${s} found`)];let l=[];for(let h in i)n[h]?l=l.concat(r.validateSpec({key:h,value:i[h],valueSpec:n[h],style:o,styleSpec:e})):l=l.concat([new ri(h,i[h],`unknown property "${h}"`)]);return l}function Ywe(r){let i=r.key,e=r.value;e=e instanceof String?e.valueOf():e;let n=Rn(e);return n==="array"&&!Xwe(e)&&!Zwe(e)?[new ri(i,e,`projection expected, invalid array ${JSON.stringify(e)} found`)]:["array","string"].includes(n)?[]:[new ri(i,e,`projection expected, invalid type "${n}" found`)]}function Zwe(r){return!!["interpolate","step","literal"].includes(r[0])}function Xwe(r){return Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number"}function Kwe(r){return!!r&&r.constructor===Object}function EQ(r){return Kwe(r.value)?[]:[new ri(r.key,r.value,`object expected, ${Rn(r.value)} found`)]}var WK={"*"(){return[]},array:CN,boolean:Bwe,number:ST,color:hN,constants:gQ,enum:eC,filter:AN,function:_Q,layer:xQ,object:rp,source:SQ,light:CQ,sky:AQ,terrain:MQ,projection:qwe,projectionDefinition:Ywe,string:r1,formatted:Vwe,resolvedImage:Uwe,padding:zwe,numberArray:$we,colorArray:Wwe,variableAnchorOffsetCollection:Hwe,sprite:IQ,state:EQ};function uT(r){let i=r.value,e=r.valueSpec,n=r.styleSpec;return r.validateSpec=uT,e.expression&&nC(Vs(i))?_Q(r):e.expression&&wT(i1(i))?aw(r):e.type&&WK[e.type]?WK[e.type](r):rp(qE({},r,{valueSpec:e.type?n[e.type]:e}))}function TQ(r){let i=r.value,e=r.key,n=r1(r);return n.length||(i.indexOf("{fontstack}")===-1&&n.push(new ri(e,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&n.push(new ri(e,i,'"glyphs" url must include a "{range}" token'))),n}function Hp(r,i=HK){let e=[];return e=e.concat(uT({key:"",value:r,valueSpec:i.$root,styleSpec:i,style:r,validateSpec:uT,objectElementValidators:{glyphs:TQ,"*"(){return[]}}})),r.constants&&(e=e.concat(gQ({key:"constants",value:r.constants}))),FQ(e)}Hp.source=Yp(qp(SQ));Hp.sprite=Yp(qp(IQ));Hp.glyphs=Yp(qp(TQ));Hp.light=Yp(qp(CQ));Hp.sky=Yp(qp(AQ));Hp.terrain=Yp(qp(MQ));Hp.state=Yp(qp(EQ));Hp.layer=Yp(qp(xQ));Hp.filter=Yp(qp(AN));Hp.paintProperty=Yp(qp(bQ));Hp.layoutProperty=Yp(qp(wQ));function qp(r){return function(i){return r(En(ur({},i),{validateSpec:uT}))}}function FQ(r){return[].concat(r).sort((i,e)=>i.line-e.line)}function Yp(r){return function(...i){return FQ(r.apply(this,i))}}var PQ=HK;var LQ={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},oC=" ",kQ=/(italic|oblique)$/i,OQ={};function CT(r,i,e){var n=OQ[r];if(!n){Array.isArray(r)||(r=[r]);for(var o=400,s="normal",l=[],h,p,m=0,f=r.length;m<f;++m){var g=r[m],y=g.split(" "),_=y[y.length-1].toLowerCase();_=="normal"||_=="italic"||_=="oblique"?(s=p?s:_,p=!0,y.pop(),_=y[y.length-1].toLowerCase()):kQ.test(_)&&(_=_.replace(kQ,""),s=p?s:y[y.length-1].replace(_,""),p=!0);for(var w in LQ){var A=y.length>1?y[y.length-2].toLowerCase():"";if(_==w||_==w.replace("-","")||A+"-"+_==w){o=h?o:LQ[w],y.pop(),A&&w.startsWith(A)&&y.pop();break}}!h&&typeof _=="number"&&(o=_,h=!0);var k=y.join(oC).replace("Klokantech Noto Sans","Noto Sans").replace("DIN Pro","Barlow").replace("Arial Unicode MS","Arial");k.indexOf(oC)!==-1&&(k='"'+k+'"'),l.push(k)}n=OQ[r]=[s,o,l]}return n[0]+oC+n[1]+oC+i+"px"+(e?"/"+e:"")+oC+n[2]}var xs={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Qwe={ERROR:"error"},MN=class extends To{constructor(i){super(Qwe.ERROR),this.code=i.code,this.message=i.message}},IN=class extends ls{constructor(i){super(),this.on,this.once,this.un,i=i||{},this.position_=null,this.transform_=cM,this.watchId_=void 0,this.addChangeListener(xs.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(xs.TRACKING,this.handleTrackingChanged_),i.projection!==void 0&&this.setProjection(i.projection),i.trackingOptions!==void 0&&this.setTrackingOptions(i.trackingOptions),this.setTracking(i.tracking!==void 0?i.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){let i=this.getProjection();i&&(this.transform_=vp(ni("EPSG:4326"),i),this.position_&&this.set(xs.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){let i=this.getTracking();i&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!i&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(i){let e=i.coords;this.set(xs.ACCURACY,e.accuracy),this.set(xs.ALTITUDE,e.altitude===null?void 0:e.altitude),this.set(xs.ALTITUDE_ACCURACY,e.altitudeAccuracy===null?void 0:e.altitudeAccuracy),this.set(xs.HEADING,e.heading===null?void 0:Au(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];let n=this.transform_(this.position_);this.set(xs.POSITION,n.slice()),this.set(xs.SPEED,e.speed===null?void 0:e.speed);let o=pI(this.position_,e.accuracy);o.applyTransform(this.transform_),this.set(xs.ACCURACY_GEOMETRY,o),this.changed()}positionError_(i){this.dispatchEvent(new MN(i))}getAccuracy(){return this.get(xs.ACCURACY)}getAccuracyGeometry(){return this.get(xs.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(xs.ALTITUDE)}getAltitudeAccuracy(){return this.get(xs.ALTITUDE_ACCURACY)}getHeading(){return this.get(xs.HEADING)}getPosition(){return this.get(xs.POSITION)}getProjection(){return this.get(xs.PROJECTION)}getSpeed(){return this.get(xs.SPEED)}getTracking(){return this.get(xs.TRACKING)}getTrackingOptions(){return this.get(xs.TRACKING_OPTIONS)}setProjection(i){this.set(xs.PROJECTION,ni(i))}setTracking(i){this.set(xs.TRACKING,i)}setTrackingOptions(i){this.set(xs.TRACKING_OPTIONS,i)}},DQ=IN;var du={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},EN=class extends ls{constructor(i){super(),this.on,this.once,this.un,this.options=i,this.id=i.id,this.insertFirst=i.insertFirst!==void 0?i.insertFirst:!0,this.stopEvent=i.stopEvent!==void 0?i.stopEvent:!0,this.element=document.createElement("div"),this.element.className=i.className!==void 0?i.className:"ol-overlay-container "+Dz,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=i.autoPan===!0?{}:i.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(du.ELEMENT,this.handleElementChanged),this.addChangeListener(du.MAP,this.handleMapChanged),this.addChangeListener(du.OFFSET,this.handleOffsetChanged),this.addChangeListener(du.POSITION,this.handlePositionChanged),this.addChangeListener(du.POSITIONING,this.handlePositioningChanged),i.element!==void 0&&this.setElement(i.element),this.setOffset(i.offset!==void 0?i.offset:[0,0]),this.setPositioning(i.positioning||"top-left"),i.position!==void 0&&this.setPosition(i.position)}getElement(){return this.get(du.ELEMENT)}getId(){return this.id}getMap(){return this.get(du.MAP)||null}getOffset(){return this.get(du.OFFSET)}getPosition(){return this.get(du.POSITION)}getPositioning(){return this.get(du.POSITIONING)}handleElementChanged(){wI(this.element);let i=this.getElement();i&&this.element.appendChild(i)}handleMapChanged(){this.mapPostrenderListenerKey&&(Cy(this.element),wn(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let i=this.getMap();if(i){this.mapPostrenderListenerKey=Vr(i,Jh.POSTRENDER,this.render,this),this.updatePixelPosition();let e=this.stopEvent?i.getOverlayContainerStopEvent():i.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(i){this.set(du.ELEMENT,i)}setMap(i){this.set(du.MAP,i)}setOffset(i){this.set(du.OFFSET,i)}setPosition(i){this.set(du.POSITION,i)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(i){let e=this.getMap();if(!e||!e.getTargetElement()||!this.get(du.POSITION))return;let n=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),s=this.getRect(o,[Tz(o),Fz(o)]);i=i||{};let l=i.margin===void 0?20:i.margin;if(!Pa(n,s)){let h=s[0]-n[0],p=n[2]-s[2],m=s[1]-n[1],f=n[3]-s[3],g=[0,0];if(h<0?g[0]=h-l:p<0&&(g[0]=Math.abs(p)+l),m<0?g[1]=m-l:f<0&&(g[1]=Math.abs(f)+l),g[0]!==0||g[1]!==0){let y=e.getView().getCenterInternal(),_=e.getPixelFromCoordinateInternal(y);if(!_)return;let w=[_[0]+g[0],_[1]+g[1]],A=i.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(w),duration:A.duration,easing:A.easing})}}}getRect(i,e){let n=i.getBoundingClientRect(),o=n.left+window.pageXOffset,s=n.top+window.pageYOffset;return[o,s,o+e[0],s+e[1]]}setPositioning(i){this.set(du.POSITIONING,i)}setVisible(i){this.rendered.visible!==i&&(this.element.style.display=i?"":"none",this.rendered.visible=i)}updatePixelPosition(){let i=this.getMap(),e=this.getPosition();if(!i||!i.isRendered()||!e){this.setVisible(!1);return}let n=i.getPixelFromCoordinate(e),o=i.getSize();this.updateRenderedPosition(n,o)}updateRenderedPosition(i,e){let n=this.element.style,o=this.getOffset(),s=this.getPositioning();this.setVisible(!0);let l=Math.round(i[0]+o[0])+"px",h=Math.round(i[1]+o[1])+"px",p="0%",m="0%";s=="bottom-right"||s=="center-right"||s=="top-right"?p="-100%":(s=="bottom-center"||s=="center-center"||s=="top-center")&&(p="-50%"),s=="bottom-left"||s=="bottom-center"||s=="bottom-right"?m="-100%":(s=="center-left"||s=="center-center"||s=="center-right")&&(m="-50%");let f=`translate(${p}, ${m}) translate(${l}, ${h})`;this.rendered.transform_!=f&&(this.rendered.transform_=f,n.transform=f)}getOptions(){return this.options}},AT=EN;var aC=Object.freeze({}),RQ={},NQ={},txe=0;function TN(r){return r.id||(r.id=txe++),r.id}function FN(r,i){return TN(r)+"."+fi(i)}function PN(r){let i=RQ[r.id];return i||(i={},RQ[TN(r)]=i),i}function LN(r){let i=NQ[r.id];return i||(i={},NQ[TN(r)]=i),i}function MT(r){return r*Math.PI/180}var kN=function(){let r=[];for(let i=78271.51696402048;r.length<=24;i/=2)r.push(i);return r}();function cw(r,i){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(r,i);let e=document.createElement("canvas");return e.width=r,e.height=i,e}function ON(r,i){let e=0,n=i.length;for(;e<n;++e)if(i[e]<r&&e+1<n){let s=i[e]/i[e+1];return e+Math.log(i[e]/r)/Math.log(s)}return n-1}function DN(r,i,e,n){let o=[2*e*i.pixelRatio+i.width,2*e*i.pixelRatio+i.height],s=cw(o[0],o[1]),l=s.getContext("2d");l.drawImage(r,i.x,i.y,i.width,i.height,e*i.pixelRatio,e*i.pixelRatio,i.width,i.height);let h=l.getImageData(0,0,o[0],o[1]);l.globalCompositeOperation="destination-over",l.fillStyle=`rgba(${n.r*255},${n.g*255},${n.b*255},${n.a})`;let p=h.data;for(let m=0,f=h.width;m<f;++m)for(let g=0,y=h.height;g<y;++g){let _=(g*f+m)*4;p[_+3]>0&&l.arc(m,g,e*i.pixelRatio,0,2*Math.PI)}return l.fill(),s}function ixe(r,i,e){let n=Math.max(0,Math.min(1,(e-r)/(i-r)));return n*n*(3-2*n)}function RN(r,i,e){let n=cw(i.width,i.height),o=n.getContext("2d");o.drawImage(r,i.x,i.y,i.width,i.height,0,0,i.width,i.height);let s=o.getImageData(0,0,i.width,i.height),l=s.data;for(let h=0,p=s.width;h<p;++h)for(let m=0,f=s.height;m<f;++m){let g=(m*p+h)*4,y=l[g+3]/255,_=.75,w=.1,A=ixe(_-w,_+w,y);A>0?(l[g+0]=Math.round(255*e.r*A),l[g+1]=Math.round(255*e.g*A),l[g+2]=Math.round(255*e.b*A),l[g+3]=Math.round(255*A)):l[g+3]=0}return o.putImageData(s,0,0),n}var rxe=Array(256).join("\u200A");function IT(r,i){if(i>=.05){let e="",n=r.split(`
`),o=rxe.slice(0,Math.round(i/.1));for(let s=0,l=n.length;s<l;++s)s>0&&(e+=`
`),e+=n[s].split("").join(o);return e}return r}var NN;function GQ(){return NN||(NN=cw(1,1).getContext("2d")),NN}function n1(r,i){return GQ().measureText(r).width+(r.length-1)*i}var BQ={};function ET(r,i,e,n){if(r.indexOf(`
`)!==-1){let l=r.split(`
`),h=[];for(let p=0,m=l.length;p<m;++p)h.push(ET(l[p],i,e,n));return h.join(`
`)}let o=e+","+i+","+r+","+n,s=BQ[o];if(!s){let l=r.split(" ");if(l.length>1){let h=GQ();h.font=i;let m=h.measureText("M").width*e,f="",g=[];for(let y=0,_=l.length;y<_;++y){let w=l[y],A=f+(f?" ":"")+w;n1(A,n)<=m?f=A:(f&&g.push(f),f=w)}f&&g.push(f);for(let y=0,_=g.length;y<_&&_>1;++y){let w=g[y];if(n1(w,n)<m*.35){let A=y>0?n1(g[y-1],n):1/0,k=y<_-1?n1(g[y+1],n):1/0;g.splice(y,1),_-=1,A<k?(g[y-1]+=" "+w,y-=1):g[y]=w+" "+g[y]}}for(let y=0,_=g.length-1;y<_;++y){let w=g[y],A=g[y+1];if(n1(w,n)>m*.7&&n1(A,n)<m*.6){let k=w.split(" "),R=k.pop();n1(R,n)<m*.2&&(g[y]=k.join(" "),g[y+1]=R+" "+A),_-=1}}s=g.join(`
`)}else s=r;s=IT(s,n),BQ[o]=s}return s}var nxe={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},oxe={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},axe=function(r,i){let e=vN(r,i);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return e.value},__={zoom:0,distanceFromCenter:0};Wp.register(rC,En(ur({},Wp.definitions),{pitch:[{kind:"number"},[],r=>__.pitch||90],"distance-from-center":[{kind:"number"},[],r=>__.distanceFromCenter||0]}));var TT,BN;function wr(r,i,e,n,o,s){let l=r.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[l]||(o[l]={});let h=o[l];if(!h[e]){let p=(r[i]||aC)[e],m=PQ[`${i}_${r.type}`][e];p===void 0&&(p=m.default);let f=wT(p);if(!f&&nC(p)&&(p=fQ(p,m),f=!0),f){let g=axe(p,m);h[e]=g.evaluate.bind(g)}else m.type=="color"&&(p=No.parse(p)),h[e]=function(){return p}}return h[e](__,n,s)}function jQ(r,i,e,n){return wr(r,"layout",`${e}-allow-overlap`,i,n)?wr(r,"layout",`${e}-ignore-placement`,i,n)?"none":"obstacle":"declutter"}function sxe(r,i,e,n){if(n||console.warn("No filterCache provided to evaluateFilter()"),!(r in n))try{n[r]=pQ(i).filter}catch(o){console.warn("Filter will evaluate to false: "+o.message),n[r]=function(){return!1}}return n[r](__,e)}var lxe=!1;function g_(r,i){if(r){if(!lxe&&(r.a===0||i===0))return;let e=r.a;return i=i===void 0?1:i,e===0?"transparent":"rgba("+Math.round(r.r*255/e)+","+Math.round(r.g*255/e)+","+Math.round(r.b*255/e)+","+e*i+")"}return r}var cxe=/\{[^{}}]*\}/g;function GN(r,i){return r.replace(cxe,function(e){return i[e.slice(1,-1)]||""})}function VQ(r,i){let e=r.split(":")[0];return e===r&&(e="default"),i[e]}var uxe=!1;var UQ={};function sC(r,i,e,n=kN,o=void 0,s=void 0,l=void 0,h=void 0){if(typeof i=="string"&&(i=JSON.parse(i)),i.version!=8)throw new Error("glStyle version 8 required.");UQ[FN(i,r)]=Array.from(arguments);let p={};(typeof s=="string"||s instanceof Request||s instanceof Response||s instanceof Promise)&&(s={default:s});for(let ae in s){let be=s[ae];yv(()=>be).then(me=>un(this,null,function*(){let fe;if(typeof Image<"u"){let ge=new Image;if(typeof me=="string")ge.crossOrigin="anonymous",ge.src=me;else{let ue;me instanceof Request?ue=yield fetch(me):me instanceof Response&&(ue=me);let se=yield ue.blob();fe=URL.createObjectURL(se),ge.src=fe}ge.addEventListener("load",function ue(){ge.removeEventListener("load",ue),p[ae]={image:ge,size:[ge.width,ge.height]},r.changed(),fe&&URL.revokeObjectURL(fe)}),ge.addEventListener("error",function ue(){URL.revokeObjectURL(fe),ge.removeEventListener("error",ue)})}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){let ge=self;ge.postMessage({action:"loadImage",src:me}),ge.addEventListener("message",function(se){se.data.action==="imageLoaded"&&se.data.src===me&&(p[ae]={image:se.data.image,size:[se.data.image.width,se.data.image.height]})})}}))}let m=qK(i.layers),f={},g=[],y={},_={},w=PN(i),A=LN(i),k;for(let ae=0,be=m.length;ae<be;++ae){let me=m[ae],fe=me.id;if(typeof e=="string"&&me.source==e||Array.isArray(e)&&e.indexOf(fe)!==-1){let ge=me["source-layer"];if(k){if(me.source!==k)throw new Error(`Layer "${fe}" does not use source "${k}`)}else{k=me.source;let se=i.sources[k];if(!se)throw new Error(`Source "${k}" is not defined`);let te=se.type;if(te!=="vector"&&te!=="geojson")throw new Error(`Source "${k}" is not of type "vector" or "geojson", but "${te}"`)}let ue=f[ge];ue||(ue=[],f[ge]=ue),ue.push({layer:me,index:ae}),g.push(fe)}}let R=new ui,q=new hi,X=[],ie=function(ae,be,me){let fe=ae.getProperties(),ge=f[fe.layer];if(!ge)return;let ue=n.indexOf(be);ue==-1&&(ue=ON(be,n)),__.zoom=ue,__.distanceFromCenter=0;let se=ae.getGeometry(),te=nxe[se.getType()],Se=r.get("map");if(Se&&Se instanceof dE&&te===1){let ze=Se.getSize();if(ze){let Re=Se.getView().getCenter(),Ge=as(se.getExtent());__.distanceFromCenter=v0(Re,Ge)/be/ze[1]}}let Te={id:ae.getId(),properties:fe,type:te},Ee=r.get("mapbox-featurestate")[ae.getId()],je=-1,Ne;for(let ze=0,Re=ge.length;ze<Re;++ze){let Ge=ge[ze],He=Ge.layer,ye=He.id;if(me!==void 0&&me!==ye)continue;let Ae=He.layout||aC,Le=He.paint||aC;if(Ae.visibility==="none"||"minzoom"in He&&ue<He.minzoom||"maxzoom"in He&&ue>=He.maxzoom)continue;let Ye=He.filter;if(!Ye||sxe(ye,Ye,Te,A)){Ne=He;let qe,et,ft,mt,At,ht,he=Ge.index;if(te==3&&(He.type=="fill"||He.type=="fill-extrusion"))if(et=wr(He,"paint",He.type+"-opacity",Te,w,Ee),He.type+"-pattern"in Le){let Jt=wr(He,"paint",He.type+"-pattern",Te,w,Ee);if(Jt){let Ut=typeof Jt=="string"?GN(Jt,fe):Jt.toString(),pi=VQ(Ut,p);if(o&&o[Ut]&&pi){++je,ht=X[je],(!ht||!ht.getFill()||ht.getStroke()||ht.getText())&&(ht=new oi({fill:new hi}),X[je]=ht),ft=ht.getFill(),ht.setZIndex(he);let yi=Ut+"."+et,Kt=_[yi];if(!Kt){let li=o[Ut],Ft=cw(li.width,li.height),Nr=Ft.getContext("2d");Nr.globalAlpha=et,Nr.drawImage(pi.image,li.x,li.y,li.width,li.height,0,0,li.width,li.height),Kt=Nr.createPattern(Ft,"repeat"),_[yi]=Kt}ft.setColor(Kt)}}}else qe=g_(wr(He,"paint",He.type+"-color",Te,w,Ee),et),He.type+"-outline-color"in Le&&(At=g_(wr(He,"paint",He.type+"-outline-color",Te,w,Ee),et)),At||(At=qe),(qe||At)&&(++je,ht=X[je],(!ht||qe&&!ht.getFill()||!qe&&ht.getFill()||At&&!ht.getStroke()||!At&&ht.getStroke()||ht.getText())&&(ht=new oi({fill:qe?new hi:void 0,stroke:At?new ui:void 0}),X[je]=ht),qe&&(ft=ht.getFill(),ft.setColor(qe)),At&&(mt=ht.getStroke(),mt.setColor(At),mt.setWidth(.5)),ht.setZIndex(he));if(te!=1&&He.type=="line"){"line-pattern"in Le?qe=void 0:qe=g_(wr(He,"paint","line-color",Te,w,Ee),wr(He,"paint","line-opacity",Te,w,Ee));let Jt=wr(He,"paint","line-width",Te,w,Ee);qe&&Jt>0&&(++je,ht=X[je],(!ht||!ht.getStroke()||ht.getFill()||ht.getText())&&(ht=new oi({stroke:new ui}),X[je]=ht),mt=ht.getStroke(),mt.setLineCap(wr(He,"layout","line-cap",Te,w,Ee)),mt.setLineJoin(wr(He,"layout","line-join",Te,w,Ee)),mt.setMiterLimit(wr(He,"layout","line-miter-limit",Te,w,Ee)),mt.setColor(qe),mt.setWidth(Jt),mt.setLineDash(Le["line-dasharray"]?wr(He,"paint","line-dasharray",Te,w,Ee).map(function(Ut){return Ut*Jt}):null),ht.setZIndex(he))}let st=!1,Je=null,de=0,ke,Ze,vt;if((te==1||te==2)&&"icon-image"in Ae){let Jt=wr(He,"layout","icon-image",Te,w,Ee);if(Jt){ke=typeof Jt=="string"?GN(Jt,fe):Jt.toString();let Ut,pi=h?h(r,ke):void 0,yi=VQ(ke,p);if(o&&o[ke]&&yi||pi){let Kt=wr(He,"layout","icon-rotation-alignment",Te,w,Ee);if(te==2){let li=ae.getGeometry();if(li.getFlatMidpoint||li.getFlatMidpoints){let Ft=li.getExtent();if(Math.sqrt(Math.max(Math.pow((Ft[2]-Ft[0])/be,2),Math.pow((Ft[3]-Ft[1])/be,2)))>150){let Qi=li.getType()==="MultiLineString"?li.getFlatMidpoints():li.getFlatMidpoint();if(BN||(TT=[NaN,NaN],BN=new il("Point",TT,[],2,{},void 0)),Ut=BN,TT[0]=Qi[0],TT[1]=Qi[1],wr(He,"layout","symbol-placement",Te,w,Ee)==="line"&&Kt==="map"){let cr=li.getStride(),Yr=li.getFlatCoordinates();for(let Ci=0,pr=Yr.length-cr;Ci<pr;Ci+=cr){let Ai=Yr[Ci],Pi=Yr[Ci+1],er=Yr[Ci+cr],xr=Yr[Ci+cr+1],tr=Math.min(Ai,er),Vn=Math.max(Ai,er),Vu=Qi[0],mo=Qi[1],Al=(xr-Pi)*(Vu-Ai)-(er-Ai)*(mo-Pi);if(Math.abs(Al)<.001&&Vu<=Vn&&Vu>=tr){de=Math.atan2(Pi-xr,er-Ai);break}}}}}}if(te!==2||Ut){let li=wr(He,"layout","icon-size",Te,w,Ee),Ft=Le["icon-color"]!==void 0?wr(He,"paint","icon-color",Te,w,Ee):null;if(!Ft||Ft.a!==0){let Nr=wr(He,"paint","icon-halo-color",Te,w,Ee),Qi=wr(He,"paint","icon-halo-width",Te,w,Ee),ji=`${ke}.${li}.${Qi}.${Nr}`;if(Ft!==null&&(ji+=`.${Ft}`),Ze=y[ji],!Ze){let cr=jQ(He,Te,"icon",w),Yr;"icon-offset"in Ae&&(Yr=wr(He,"layout","icon-offset",Te,w,Ee).slice(0),Yr[0]*=li,Yr[1]*=-li);let Ci=Ft?[Ft.r*255,Ft.g*255,Ft.b*255,Ft.a]:void 0;if(pi){let pr={color:Ci,rotateWithView:Kt==="map",displacement:Yr,declutterMode:cr,scale:li};typeof pi=="string"?pr.src=pi:(pr.img=pi,pr.imgSize=[pi.width,pi.height]),Ze=new Bs(pr)}else{let pr=o[ke],Ai,Pi,er;if(Qi)pr.sdf?(Ai=DN(RN(yi.image,pr,Ft||[0,0,0,1]),{x:0,y:0,width:pr.width,height:pr.height,pixelRatio:pr.pixelRatio},Qi,Nr),Ci=void 0):Ai=DN(yi.image,pr,Qi,Nr);else{if(pr.sdf&&!yi.unSDFed){let xr=RN(yi.image,{x:0,y:0,width:yi.size[0],height:yi.size[1]},{r:1,g:1,b:1,a:1});yi.image=xr,yi.unSDFed=!0}Ai=yi.image,Pi=[pr.width,pr.height],er=[pr.x,pr.y]}Ze=new Bs({color:Ci,img:Ai,imgSize:yi.size,size:Pi,offset:er,rotateWithView:Kt==="map",scale:li/pr.pixelRatio,displacement:Yr,declutterMode:cr})}y[ji]=Ze}}Ze&&(++je,ht=X[je],(!ht||!ht.getImage()||ht.getFill()||ht.getStroke())&&(ht=new oi,X[je]=ht),ht.setGeometry(Ut),Ze.setRotation(de+MT(wr(He,"layout","icon-rotate",Te,w,Ee))),Ze.setOpacity(wr(He,"paint","icon-opacity",Te,w,Ee)),Ze.setAnchor(oxe[wr(He,"layout","icon-anchor",Te,w,Ee)]),ht.setImage(Ze),Je=ht.getText(),ht.setText(void 0),ht.setZIndex(he),st=!0,vt=!1)}else vt=!0}}}if(te==1&&He.type==="circle"){++je,ht=X[je],(!ht||!ht.getImage()||ht.getFill()||ht.getStroke())&&(ht=new oi,X[je]=ht);let Jt="circle-radius"in Le?wr(He,"paint","circle-radius",Te,w,Ee):5,Ut=g_(wr(He,"paint","circle-stroke-color",Te,w,Ee),wr(He,"paint","circle-stroke-opacity",Te,w,Ee)),pi=wr(He,"paint","circle-translate",Te,w,Ee),yi=g_(wr(He,"paint","circle-color",Te,w,Ee),wr(He,"paint","circle-opacity",Te,w,Ee)),Kt=wr(He,"paint","circle-stroke-width",Te,w,Ee),li=Jt+"."+Ut+"."+yi+"."+Kt+"."+pi[0]+"."+pi[1];Ze=y[li],Ze||(Ze=new an({radius:Jt,displacement:[pi[0],-pi[1]],stroke:Ut&&Kt>0?new ui({width:Kt,color:Ut}):void 0,fill:yi?new hi({color:yi}):void 0,declutterMode:"none"}),y[li]=Ze),ht.setImage(Ze),Je=ht.getText(),ht.setText(void 0),ht.setGeometry(void 0),ht.setZIndex(he),st=!0}let tt,ot,wt,Mt,St,ei;if("text-field"in Ae){Mt=Math.round(wr(He,"layout","text-size",Te,w,Ee));let Jt=wr(He,"layout","text-font",Te,w,Ee);wt=wr(He,"layout","text-line-height",Te,w,Ee),ot=CT(l?l(Jt,i.metadata?i.metadata["ol:webfonts"]:void 0):Jt,Mt,wt),ot.includes("sans-serif")||(ot+=",sans-serif"),St=wr(He,"layout","text-letter-spacing",Te,w,Ee),ei=wr(He,"layout","text-max-width",Te,w,Ee);let Ut=wr(He,"layout","text-field",Te,w,Ee);typeof Ut=="object"&&Ut.sections?Ut.sections.length===1?tt=Ut.toString():tt=Ut.sections.reduce((pi,yi,Kt)=>{let li=yi.fontStack?yi.fontStack.split(","):Jt,Ft=CT(l?l(li):li,Mt*(yi.scale||1),wt),Nr=yi.text;if(Nr===`
`)return pi.push(`
`,""),pi;if(te==2)return pi.push(IT(Nr,St),Ft),pi;Nr=ET(Nr,Ft,ei,St).split(`
`);for(let Qi=0,ji=Nr.length;Qi<ji;++Qi)Qi>0&&pi.push(`
`,""),pi.push(Nr[Qi],Ft);return pi},[]):tt=GN(Ut,fe).trim(),et=wr(He,"paint","text-opacity",Te,w,Ee)}if(tt&&et&&!vt){st||(++je,ht=X[je],(!ht||!ht.getText()||ht.getFill()||ht.getStroke())&&(ht=new oi,X[je]=ht),ht.setImage(void 0),ht.setGeometry(void 0));let Jt=jQ(He,Te,"text",w);ht.getText()||ht.setText(Je),Je=ht.getText(),(!Je||"getDeclutterMode"in Je&&Je.getDeclutterMode()!==Jt)&&(Je=new so({padding:[2,2,2,2],declutterMode:Jt}),ht.setText(Je));let Ut=wr(He,"layout","text-transform",Te,w,Ee);Ut=="uppercase"?tt=Array.isArray(tt)?tt.map((er,xr)=>xr%2?er:er.toUpperCase()):tt.toUpperCase():Ut=="lowercase"&&(tt=Array.isArray(tt)?tt.map((er,xr)=>xr%2?er:er.toLowerCase()):tt.toLowerCase());let pi=Array.isArray(tt)?tt:te==2?IT(tt,St):ET(tt,ot,ei,St);if(Je.setText(pi),Je.setFont(ot),Je.setRotation(MT(wr(He,"layout","text-rotate",Te,w,Ee))),typeof Je.setKeepUpright=="function"){let er=wr(He,"layout","text-keep-upright",Te,w,Ee);Je.setKeepUpright(er)}let yi=wr(He,"layout","text-anchor",Te,w,Ee),Kt=st||te==1?"point":wr(He,"layout","symbol-placement",Te,w,Ee),li;if(Kt==="line-center"?(Je.setPlacement("line"),li="center"):Je.setPlacement(Kt),Kt==="line"&&typeof Je.setRepeat=="function"){let er=wr(He,"layout","symbol-spacing",Te,w,Ee);Je.setRepeat(er*2)}Je.setOverflow(Kt==="point");let Ft=wr(He,"paint","text-halo-width",Te,w,Ee),Nr=wr(He,"layout","text-offset",Te,w,Ee),Qi=wr(He,"paint","text-translate",Te,w,Ee),ji=0,cr=0;if(Kt=="point"){li="center",yi.indexOf("left")!==-1?(li="left",cr=Ft):yi.indexOf("right")!==-1&&(li="right",cr=-Ft);let er=wr(He,"layout","text-rotation-alignment",Te,w,Ee);Je.setRotateWithView(er=="map")}else Je.setMaxAngle(MT(wr(He,"layout","text-max-angle",Te,w,Ee))*tt.length/pi.length),Je.setRotateWithView(!1);Je.setTextAlign(li);let Yr="middle";yi.indexOf("bottom")==0?(Yr="bottom",ji=-Ft-.5*(wt-1)*Mt):yi.indexOf("top")==0&&(Yr="top",ji=Ft+.5*(wt-1)*Mt),Je.setTextBaseline(Yr);let Ci=wr(He,"layout","text-justify",Te,w,Ee);Je.setJustify(Ci==="auto"?void 0:Ci),Je.setOffsetX(Nr[0]*Mt+cr+Qi[0]),Je.setOffsetY(Nr[1]*Mt+ji+Qi[1]),q.setColor(g_(wr(He,"paint","text-color",Te,w,Ee),et)),Je.setFill(q);let pr=g_(wr(He,"paint","text-halo-color",Te,w,Ee),et);if(pr&&Ft>0){R.setColor(pr),Ft*=2;let er=.5*Mt;R.setWidth(Ft<=er?Ft:er),Je.setStroke(R)}else Je.setStroke(void 0);let Ai=wr(He,"layout","text-padding",Te,w,Ee),Pi=Je.getPadding();Ai!==Pi[0]&&(Pi[0]=Ai,Pi[1]=Ai,Pi[2]=Ai,Pi[3]=Ai),ht.setZIndex(he)}}}if(je>-1)return X.length=je+1,uxe&&("set"in ae?ae.set("mapbox-layer",Ne):ae.getProperties()["mapbox-layer"]=Ne),X};return r.setStyle(ie),r.set("mapbox-layers",g),r.set("mapbox-source",k),r.set("mapbox-featurestate",r.get("mapbox-featurestate")||{}),ie}var uw=class{};var FT=(()=>{class r{capabilitiesService;optionsService;wfsDataSourceService;languageService;messageService;authInterceptor;datasources$=new ut([]);constructor(e,n,o,s,l,h){this.capabilitiesService=e,this.optionsService=n,this.wfsDataSourceService=o,this.languageService=s,this.messageService=l,this.authInterceptor=h}createAsyncDataSource(e,n){if(!e.type)throw console.error(e),new Error("Datasource needs a type");let o;switch(e.type.toLowerCase()){case"osm":o=this.createOSMDataSource(e);break;case"vector":o=this.createFeatureDataSource(e);break;case"wfs":o=this.createWFSDataSource(e);break;case"wms":{let s=e;rr.removeDuplicateCaseInsensitive(s.params),o=this.createWMSDataSource(s,n);break}case"wmts":o=this.createWMTSDataSource(e);break;case"xyz":o=this.createXYZDataSource(e);break;case"tiledebug":o=this.createTileDebugDataSource(e);break;case"carto":o=this.createCartoDataSource(e);break;case"arcgisrest":o=this.createArcGISRestDataSource(e,n);break;case"imagearcgisrest":o=this.createArcGISRestImageDataSource(e,n);break;case"websocket":o=this.createWebSocketDataSource(e);break;case"mvt":o=this.createMVTDataSource(e);break;case"tilearcgisrest":o=this.createTileArcGISRestDataSource(e,n);break;case"cluster":o=this.createClusterDataSource(e);break;default:throw console.error(e),new Error("Invalid datasource type")}return this.datasources$.next(this.datasources$.value.concat([o])),o}createOSMDataSource(e){return new $r(n=>n.next(new eb(e)))}createFeatureDataSource(e){return new $r(n=>n.next(new kr(e)))}createWebSocketDataSource(e){return new $r(n=>n.next(new rb(e)))}createWFSDataSource(e){return new $r(n=>n.next(new qh(e,this.wfsDataSourceService,this.authInterceptor)))}createWMSDataSource(e,n){let o=[];return e.optionsFromCapabilities&&window.navigator.onLine&&o.push(this.capabilitiesService.getWMSOptions(e).pipe(qr(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:e.params.LAYERS}),s}))),this.optionsService&&e.optionsFromApi&&window.navigator.onLine&&o.push(this.optionsService.getWMSOptions(e,n).pipe(qr(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),ai({}))))),o.push(ai(e)),mp(o).pipe(Nt(s=>{let l=s.reduce((h,p)=>rr.mergeDeep(h,p));return new _l(l,this.wfsDataSourceService)}),qr(()=>ai(void 0)))}createWMTSDataSource(e){return e.optionsFromCapabilities&&window.navigator.onLine?this.capabilitiesService.getWMTSOptions(e).pipe(Nt(n=>n?new Oy(n):void 0),qr(()=>(this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:e.layer}),ai(void 0)))):new $r(n=>n.next(new Oy(e)))}createXYZDataSource(e){return new $r(n=>n.next(new tb(e)))}createTileDebugDataSource(e){return new $r(n=>n.next(new ib(e)))}createCartoDataSource(e){return e.mapId?this.capabilitiesService.getCartoOptions(e).pipe(Nt(n=>new gg(n))):new $r(n=>n.next(new gg(e)))}createArcGISRestDataSource(e,n){let o=[];return window.navigator.onLine&&o.push(this.capabilitiesService.getArcgisOptions(e).pipe(qr(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:e.layer}),s}))),this.optionsService&&e.optionsFromApi&&window.navigator.onLine&&o.push(this.optionsService.getArcgisRestOptions(e,n).pipe(qr(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),ai({}))))),o.push(ai(e)),mp(o).pipe(Nt(s=>{let l=s.reduce((h,p)=>rr.mergeDeep(h,p));return new Dy(l)}),qr(()=>ai(void 0)))}createArcGISRestImageDataSource(e,n){let o=[];return window.navigator.onLine&&o.push(this.capabilitiesService.getImageArcgisOptions(e).pipe(qr(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:e.params.LAYERS}),s}))),this.optionsService&&e.optionsFromApi&&window.navigator.onLine&&o.push(this.optionsService.getArcgisRestOptions(e,n).pipe(qr(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),ai({}))))),o.push(ai(e)),mp(o).pipe(Nt(s=>{let l=s.reduce((h,p)=>rr.mergeDeep(h,p));return new K0(l)}),qr(()=>ai(void 0)))}createTileArcGISRestDataSource(e,n){let o=[];return window.navigator.onLine&&o.push(this.capabilitiesService.getImageArcgisOptions(e).pipe(qr(s=>{throw this.messageService.error("igo.geo.dataSource.unavailable","igo.geo.dataSource.unavailableTitle",void 0,{value:e.params.LAYERS}),s}))),this.optionsService&&e.optionsFromApi&&window.navigator.onLine&&o.push(this.optionsService.getArcgisRestOptions(e,n).pipe(qr(s=>(s.error.toDisplay=!0,s.error.title=this.languageService.translate.instant("igo.geo.dataSource.unavailableTitle"),s.error.message=this.languageService.translate.instant("igo.geo.dataSource.optionsApiUnavailable"),ai({}))))),o.push(ai(e)),mp(o).pipe(Nt(s=>{let l=s.reduce((h,p)=>rr.mergeDeep(h,p));return new Tp(l)}),qr(()=>ai(void 0)))}createMVTDataSource(e){return new $r(n=>n.next(new nb(e)))}createClusterDataSource(e){return new $r(n=>n.next(new kc(e)))}static \u0275fac=function(n){return new(n||r)(pt(Sl),pt(uw,8),pt(MH),pt(Di),pt(Gn),pt(O1))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Nc=(()=>{class r{style;createStyle(e,n,o){if(!e)return t_();if(typeof e=="function"||e instanceof oi)return e;let s=this.parseStyle("style",e);if(s.getText()){let l=0,h=1/0;if(e.text){let p=e.text?.minScaleDenom?Oa(Number(e.text.minScaleDenom)):void 0,m=e.text?.maxScaleDenom?Oa(Number(e.text.maxScaleDenom)):void 0,f=e.text?.minResolution?e.text.minResolution:0,g=e.text?.maxResolution?e.text.maxResolution:1/0;l=p||f,h=m||g}(e.text?.minScaleDenom||e.text?.maxScaleDenom||e.text?.minResolution||e.text?.maxResolution)&&(n&&o>=l&&o<=h?n&&e.text.attribute&&s.getText().setText(this.getLabel(n,e.text.attribute)):s.setText())}return s}parseStyle(e,n){let o={},s=this.getOlCls(e);return s&&n instanceof Object?(Object.keys(n).forEach(l=>{let h=this.getOlKey(l);o[h]=this.parseStyle(l,n[l])}),new s(o)):n}getOlKey(e){let n;switch(e.toLowerCase()){case"circle":case"regularshape":case"icon":n="image";break;default:break}return n||e}getOlCls(e){let n=mc[e.charAt(0).toUpperCase()+e.slice(1)];return e==="regularshape"&&(n=ru),e==="backgroundFill"&&(n=hi),e==="backgroundStroke"&&(n=ui),n}createStyleByAttribute(e,n,o){let s,l=n.type?n.type:this.guessTypeFeature(e),h=n.attribute,p=n.data,m=n.stroke,f=n.width,g=n.fill,y=n.anchor,_=n.radius,w=n.icon,A=n.scale,k=p?p.length:0,R=n.label?n.label.attribute:void 0,q=n.label?.minScaleDenom?Oa(Number(n.label.minScaleDenom)):void 0,X=n.label?.maxScaleDenom?Oa(Number(n.label.maxScaleDenom)):void 0,ie=n.label?.minResolution?n.label.minResolution:0,ae=n.label?.maxResolution?n.label.maxResolution:1/0,be=q||ie,me=X||ae,fe=n.label?.style?this.parseStyle("text",n.label.style):void 0;!fe&&R&&(fe=new so);let ge=n.baseStyle;if(fe&&(o>=be&&o<=me?fe.setText(this.getLabel(e,R)):fe.setText("")),l==="circle"){for(let ue=0;ue<k;ue++){let se=typeof e.get(h)<"u"&&e.get(h)!==null?e.get(h):"";if(se===p[ue]||se.toString().match(new RegExp(p[ue],"gmi")))return w?(s=[new oi({image:new Bs({color:g?g[ue]:void 0,src:w[ue],scale:A?A[ue]:1,anchor:y?y[ue]:[.5,.5]}),text:fe instanceof so?fe:void 0})],s):(s=[new oi({image:new an({radius:_?_[ue]:4,stroke:new ui({color:m?m[ue]:"black",width:f?f[ue]:1}),fill:new hi({color:g?g[ue]:"black"})}),text:fe instanceof so?fe:void 0})],s)}if(!e.getStyle())return ge?(s=this.createStyle(ge,e,o),fe&&s.setText(fe),s):(s=[new oi({image:new an({radius:4,stroke:new ui({color:"black"}),fill:new hi({color:"#bbbbf2"})})})],s)}else if(l==="regular"){for(let ue=0;ue<k;ue++){let se=typeof e.get(h)<"u"&&e.get(h)!==null?e.get(h):"";if(se===p[ue]||se.toString().match(new RegExp(p[ue],"gmi")))return s=[new oi({stroke:new ui({color:m?m[ue]:"black",width:f?f[ue]:1}),fill:new hi({color:g?g[ue]:"rgba(255,255,255,0.4)"}),text:fe instanceof so?fe:void 0})],s}if(e instanceof gi&&!e.getStyle())return ge?(s=this.createStyle(ge,e,o),fe&&s.setText(fe),s):(s=[new oi({stroke:new ui({color:"black"}),fill:new hi({color:"#bbbbf2"})})],s)}}createClusterStyle(e,n,o={},s){let l,h=e.get("features").length;if(h!==1){if(o.clusterRanges){for(let p of o.clusterRanges)if((!p.minRadius||p.minRadius<=h)&&(!p.maxRadius||p.maxRadius>=h)){if(l=this.createStyle(p.style),p.showRange){let m=new so({text:h.toString(),fill:new hi({color:"#fff"})});l.setText(m)}if(p.dynamicRadius){let m,f=l.getRadius();m=5*Math.log(h),m<f&&(m=f),l.image_.setRadius(m)}break}}if(!l){let p;o.radiusCalc?p=o.radiusCalc(h):(p=5*Math.log(h),p<6&&(p=6)),l=[new oi({image:new an({radius:p,stroke:new ui({color:"black"}),fill:new hi({color:"rgba(24, 134, 45, 0.5)"})}),text:new so({text:h.toString(),fill:new hi({color:"#fff"})})})]}}else l=this.createStyle(s,e,n);return l}getLabel(e,n){let o=n;if(!o)return;let s=Array.from(n.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(l=>{o=o.replace(l[0],e.get(l[1]))}),s.length===0&&o===n&&(o=e.get(n)||n),o}guessTypeFeature(e){switch(e.getGeometry().getType()){case"Point":case"MultiPoint":case"Circle":return"circle";default:return"regular"}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Za=(()=>{class r{http;styleService;dataSourceService;messageService;geoNetworkService;authInterceptor;unavailableLayers=[];constructor(e,n,o,s,l,h){this.http=e,this.styleService=n,this.dataSourceService=o,this.messageService=s,this.geoNetworkService=l,this.authInterceptor=h}createLayers(e,n){let o=e.map(s=>zU(s)?this.createAsyncGroup(s):this.createAsyncLayer(s,n));return Ts(o)}createLayer(e){e.source?.options?._layerOptionsFromSource&&(e=rr.mergeDeep(e.source.options._layerOptionsFromSource,e||{}));let n;switch(e.source.constructor){case eb:case Oy:case tb:case ib:case gg:case Tp:n=this.createTileLayer(e);break;case kr:case qh:case Dy:case rb:case kc:n=this.createVectorLayer(e);break;case K0:case _l:n=this.createImageLayer(e);break;case nb:{let o=$L(e);n=this.createVectorTileLayer(o);break}default:break}return n}createAsyncLayer(e,n){let o=ur({},e);return $L(o),o.source?new $r(s=>s.next(this.createLayer(o))):this.dataSourceService.createAsyncDataSource(o.sourceOptions,n).pipe(Nt(s=>{if(s===void 0){this.unavailableLayers.some(h=>h===o)||this.unavailableLayers.push(o);return}return this.createLayer(Object.assign(o,{source:s}))}))}createAsyncGroup(e,n){return e.children?.length?this.createLayers(e.children,n).pipe(Nt(o=>this.createGroup(o.filter(Boolean),e))):ai(this.createGroup(null,e))}createGroup(e,n){return new jE(e,n)}createImageLayer(e){return new NE(e,this.messageService,this.authInterceptor)}createTileLayer(e){return new GE(e,this.messageService,this.authInterceptor)}createVectorLayer(e){let n=e.style,o;e.igoStyle||(e.igoStyle={});let s=["styleByAttribute","hoverStyle","mapboxStyle","clusterBaseStyle","style"];if(this.handleLegacyStyles(e,s),e.igoStyle.igoStyleObject&&!e.idbInfo?.storeToIdb?n=(h,p)=>this.styleService.createStyle(e.igoStyle.igoStyleObject,h,p):e.igoStyle.igoStyleObject&&e.idbInfo?.storeToIdb&&(n=this.styleService.parseStyle("style",e.igoStyle.igoStyleObject)),e.source instanceof Dy)n=e.source.options.params.style;else if(e.igoStyle?.styleByAttribute){let h=this.styleService;e.style=(p,m)=>h.createStyleByAttribute(p,e.igoStyle.styleByAttribute,m),o=new Fr(e,this.messageService,this.authInterceptor,this.geoNetworkService)}if(e.source instanceof kc){let h=this.styleService,p=e.igoStyle.clusterBaseStyle;e.style=(m,f)=>h.createClusterStyle(m,f,e.clusterParam,p),o=new Fr(e,this.messageService,this.authInterceptor,this.geoNetworkService)}let l=Object.assign({},e,{style:n});return o||(o=new Fr(l,this.messageService,this.authInterceptor,this.geoNetworkService)),this.applyMapboxStyle(o,l),o}handleLegacyStyles(e,n){n.map(o=>{if(e[o]){let s=o;if(o==="style"){if(e[o]instanceof oi)return;if(typeof e[o]=="object")s="igoStyleObject";else return}e.igoStyle[s]=e[o],delete e[o],console.warn(`
        The location of this style option (${o}) is deprecated.
        Please move this property within igoStyle property.
        Ex: ${o}: {...} must be transfered to igoStyle: { ${s}: {...} }
        This legacy conversion will be deleted in 2024.
        `)}})}createVectorTileLayer(e){let n,o;e.igoStyle||(e.igoStyle={});let s=["styleByAttribute","hoverStyle","mapboxStyle","style"];if(this.handleLegacyStyles(e,s),e.igoStyle.igoStyleObject&&(n=(h,p)=>this.styleService.createStyle(e.igoStyle.igoStyleObject,h,p)),e.igoStyle.styleByAttribute){let h=this.styleService;e.style=(p,m)=>h.createStyleByAttribute(p,e.igoStyle.styleByAttribute,m),o=new B2(e,this.messageService,this.authInterceptor)}let l=Object.assign({},e,{style:n});return o||(o=new B2(l,this.messageService,this.authInterceptor)),this.applyMapboxStyle(o,l),o}applyMapboxStyle(e,n){n.igoStyle?.mapboxStyle&&this.getStuff(n.igoStyle.mapboxStyle.url).subscribe(o=>{if(o.sprite){let s=this.getAbsoluteUrl(n.igoStyle.mapboxStyle.url,o.sprite);this.getStuff(s+".json").subscribe(l=>{sC(e.ol,o,n.igoStyle.mapboxStyle.source,void 0,l,s+".png")})}else sC(e.ol,o,n.igoStyle.mapboxStyle.source)})}getStuff(e){return this.http.get(e).pipe(Nt(n=>n),qr(n=>(console.log("No style was found"),ai(n))))}getAbsoluteUrl(e,n){return new RegExp("^http|//","i").test(n)?n:e.substr(e.length-1)==="/"?e+n:e+"/"+n}createAsyncIdbLayers(e="*"){return new xm().getAll().pipe(qs(o=>{let l=(e!=="*"?o.filter(h=>h.detailedContextUri===e):o).map(h=>Object.assign({},h.layerOptions,{sourceOptions:h.sourceOptions}));return Ts(l.map(h=>this.createAsyncLayer(h)))}))}deleteUnavailableLayers(e){let n=e.sourceOptions,o=this.unavailableLayers.findIndex(s=>{let l=s.sourceOptions;if(this.sourceOptionsWithParams(l)&&this.sourceOptionsWithParams(n))return l.params.LAYERS===n.params.LAYERS;if(this.sourceOptionsWithLayer(l)&&this.sourceOptionsWithLayer(n))return l.layer===n.layer});this.unavailableLayers.splice(o,o>=0?1:0)}sourceOptionsWithParams(e){return"params"in e}sourceOptionsWithLayer(e){return"layer"in e}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Nc),pt(FT),pt(Gn),pt(qA,8),pt(O1,8))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var WQ={formFieldConfigs:[{name:"name",title:"igo.geo.layer.group.name",type:"text",options:{validator:Fn.required,errors:{required:"igo.common.form.errors.required"}}}]},Ng=(()=>{class r{layerService;formDialogService;constructor(e,n){this.layerService=e,this.formDialogService=n}createGroup(){return this.formDialogService.open(WQ,{title:"igo.geo.layer.group.create",minWidth:"25%"}).pipe(Xn(e=>e?this.layerService.createAsyncGroup({type:"group",title:e.name}):ai(void 0)))}renameGroup(e){let n=ur({},WQ),o=n.formFieldConfigs.find(s=>s.name==="name");return o.options.initialValue=e.title,this.formDialogService.open(n,{title:"igo.geo.layer.group.rename",minWidth:"25%"}).pipe(Nt(s=>s?.name))}static \u0275fac=function(n){return new(n||r)(pt(Za),pt(J_))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function gxe(r,i){if(r&1){let e=We();$(0,"button",4),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.createGroup())}),$(2,"mat-icon"),_e(3,"create_new_folder"),ee()()}if(r&2){let e=ne();z("disabled",!e.viewerOptions.group.enable)("matTooltip",ce(1,2,"igo.geo.layer.group.create"))}}var jN=(()=>{class r{layerListToolService;mode;viewerOptions;floatLabel="auto";onlyVisible;term;searchChange=new Ke;visibilityOnlyChange=new Ke;modeChange=new Ke;addedLayer=new Ke;get selectionActive(){return this.mode==="selection"}constructor(e){this.layerListToolService=e}handleTermChange(e){this.searchChange.emit(e)}toggleSelectionMode(){this.modeChange.emit(!this.selectionActive)}createGroup(){this.layerListToolService.createGroup().subscribe(e=>{e&&this.addedLayer.emit(e)})}static \u0275fac=function(n){return new(n||r)(Ie(Ng))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-list-tool"]],inputs:{mode:"mode",viewerOptions:"viewerOptions",floatLabel:"floatLabel",onlyVisible:"onlyVisible",term:"term"},outputs:{searchChange:"searchChange",visibilityOnlyChange:"visibilityOnlyChange",modeChange:"modeChange",addedLayer:"addedLayer"},standalone:!0,features:[Xi([Ng,J_]),lt],decls:8,vars:10,consts:[["placeholder","igo.geo.layer.filterPlaceholder","tooltip","igo.geo.layer.subsetLayersListKeyword",3,"searchChange","initialValue","floatLabel"],[1,"actions-container"],["mat-icon-button","","matTooltipShowDelay","500",3,"click","color","matTooltip"],["mat-icon-button","","matTooltipShowDelay","500","type","button","color","primary",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","matTooltipShowDelay","500","type","button","color","primary",3,"click","disabled","matTooltip"]],template:function(n,o){n&1&&($(0,"igo-layer-search",0),ve("searchChange",function(l){return o.handleTermChange(l)}),ee(),$(1,"div",1)(2,"button",2),le(3,"translate"),le(4,"translate"),ve("click",function(){return o.toggleSelectionMode()}),$(5,"mat-icon"),_e(6),ee()(),Pe(7,gxe,4,4,"button",3),ee()),n&2&&(z("initialValue",o.term)("floatLabel",o.floatLabel),j(2),z("color",o.selectionActive?"warn":"primary")("matTooltip",o.selectionActive?ce(3,6,"igo.geo.layer.deactivateSelectionMode"):ce(4,8,"igo.geo.layer.activateSelectionMode")),j(4),bt(o.selectionActive?"remove_done":"library_add_check"),j(),z("ngIf",o.viewerOptions==null||o.viewerOptions.group==null?null:o.viewerOptions.group.canCreate))},dependencies:[Sn,Gt,jr,gn,Qt,ti,Vt,ci,ym,jt,$t,xl,Et,Tt,N6],styles:[`[_nghost-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}.sort-alpha.--active[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:red}
/*# sourceMappingURL=layer-list-tool.component-5KUWCOIX.css.map */`],changeDetection:0})}return r})();var VN=function(r){return r.always="always",r.never="never",r.default="default",r}(VN||{});var PT=class{constructor(){this.expansionModel=new Eh(!0)}toggle(i){this.expansionModel.toggle(this._trackByValue(i))}expand(i){this.expansionModel.select(this._trackByValue(i))}collapse(i){this.expansionModel.deselect(this._trackByValue(i))}isExpanded(i){return this.expansionModel.isSelected(this._trackByValue(i))}toggleDescendants(i){this.expansionModel.isSelected(this._trackByValue(i))?this.collapseDescendants(i):this.expandDescendants(i)}collapseAll(){this.expansionModel.clear()}expandDescendants(i){let e=[i];e.push(...this.getDescendants(i)),this.expansionModel.select(...e.map(n=>this._trackByValue(n)))}collapseDescendants(i){let e=[i];e.push(...this.getDescendants(i)),this.expansionModel.deselect(...e.map(n=>this._trackByValue(n)))}_trackByValue(i){return this.trackBy?this.trackBy(i):i}},LT=class extends PT{constructor(i,e,n){super(),this.getLevel=i,this.isExpandable=e,this.options=n,this.options&&(this.trackBy=this.options.trackBy)}getDescendants(i){let e=this.dataNodes.indexOf(i),n=[];for(let o=e+1;o<this.dataNodes.length&&this.getLevel(i)<this.getLevel(this.dataNodes[o]);o++)n.push(this.dataNodes[o]);return n}expandAll(){this.expansionModel.select(...this.dataNodes.map(i=>this._trackByValue(i)))}},kT=class extends PT{constructor(i,e){super(),this.getChildren=i,this.options=e,this.options&&(this.trackBy=this.options.trackBy),this.options?.isExpandable&&(this.isExpandable=this.options.isExpandable)}expandAll(){this.expansionModel.clear();let i=this.dataNodes.reduce((e,n)=>[...e,...this.getDescendants(n),n],[]);this.expansionModel.select(...i.map(e=>this._trackByValue(e)))}getDescendants(i){let e=[];return this._getDescendants(e,i),e.splice(1)}_getDescendants(i,e){i.push(e);let n=this.getChildren(e);Array.isArray(n)?n.forEach(o=>this._getDescendants(i,o)):jF(n)&&n.pipe(Ol(1),SA(Boolean)).subscribe(o=>{for(let s of o)this._getDescendants(i,s)})}},cC=new Ln("CDK_TREE_NODE_OUTLET_NODE"),lC=(()=>{class r{constructor(e,n){this.viewContainer=e,this._node=n}static{this.\u0275fac=function(n){return new(n||r)(Ie(Mh),Ie(cC,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkTreeNodeOutlet",""]],standalone:!0})}}return r})(),UN=class{constructor(i){this.$implicit=i}},OT=(()=>{class r{constructor(e){this.template=e}static{this.\u0275fac=function(n){return new(n||r)(Ie(gp))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkTreeNodeDef",""]],inputs:{when:[0,"cdkTreeNodeDefWhen","when"]},standalone:!0})}}return r})();function HQ(){return Error("Could not find a tree control, levelAccessor, or childrenAccessor for the tree.")}var cf=(()=>{class r{get dataSource(){return this._dataSource}set dataSource(e){this._dataSource!==e&&this._switchDataSource(e)}constructor(e,n){this._differs=e,this._changeDetectorRef=n,this._elementRef=ga(ar),this._dir=ga(Rl),this._onDestroy=new Si,this._levels=new Map,this._parents=new Map,this._ariaSets=new Map,this.viewChange=new ut({start:0,end:Number.MAX_VALUE}),this._flattenedNodes=new ut([]),this._nodeType=new ut(null),this._nodes=new ut(new Map),this._keyManagerNodes=new ut([]),this._keyManagerFactory=ga(B7),this._viewInit=!1}ngAfterContentInit(){this._initializeKeyManager()}ngAfterContentChecked(){this._updateDefaultNodeDefinition(),this._subscribeToDataChanges()}ngOnDestroy(){this._nodeOutlet.viewContainer.clear(),this.viewChange.complete(),this._onDestroy.next(),this._onDestroy.complete(),this._dataSource&&typeof this._dataSource.disconnect=="function"&&this.dataSource.disconnect(this),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null),this._keyManager?.destroy()}ngOnInit(){this._checkTreeControlUsage(),this._initializeDataDiffer()}ngAfterViewInit(){this._viewInit=!0}_updateDefaultNodeDefinition(){let e=this._nodeDefs.filter(n=>!n.when);e.length>1,this._defaultNodeDef=e[0]}_setNodeTypeIfUnset(e){this._nodeType.value===null&&this._nodeType.next(e)}_switchDataSource(e){this._dataSource&&typeof this._dataSource.disconnect=="function"&&this.dataSource.disconnect(this),this._dataSubscription&&(this._dataSubscription.unsubscribe(),this._dataSubscription=null),e||this._nodeOutlet.viewContainer.clear(),this._dataSource=e,this._nodeDefs&&this._subscribeToDataChanges()}_getExpansionModel(){return this.treeControl?this.treeControl.expansionModel:(this._expansionModel??=new Eh(!0),this._expansionModel)}_subscribeToDataChanges(){if(this._dataSubscription)return;let e;eG(this._dataSource)?e=this._dataSource.connect(this):jF(this._dataSource)?e=this._dataSource:Array.isArray(this._dataSource)&&(e=ai(this._dataSource)),e&&(this._dataSubscription=this._getRenderData(e).pipe(Vo(this._onDestroy)).subscribe(n=>{this._renderDataChanges(n)}))}_getRenderData(e){let n=this._getExpansionModel();return Ts([e,this._nodeType,n.changed.pipe(ec(null),bu(o=>{this._emitExpansionChanges(o)}))]).pipe(Xn(([o,s])=>s===null?ai({renderNodes:o,flattenedNodes:null,nodeType:s}):this._computeRenderingData(o,s).pipe(Nt(l=>En(ur({},l),{nodeType:s})))))}_renderDataChanges(e){if(e.nodeType===null){this.renderNodeChanges(e.renderNodes);return}this._updateCachedData(e.flattenedNodes),this.renderNodeChanges(e.renderNodes),this._updateKeyManagerItems(e.flattenedNodes)}_emitExpansionChanges(e){if(!e)return;let n=this._nodes.value;for(let o of e.added)n.get(o)?._emitExpansionState(!0);for(let o of e.removed)n.get(o)?._emitExpansionState(!1)}_initializeKeyManager(){let e=Ts([this._keyManagerNodes,this._nodes]).pipe(Nt(([o,s])=>o.reduce((l,h)=>{let p=s.get(this._getExpansionKey(h));return p&&l.push(p),l},[]))),n={trackBy:o=>this._getExpansionKey(o.data),skipPredicate:o=>!!o.isDisabled,typeAheadDebounceInterval:!0,horizontalOrientation:this._dir.value};this._keyManager=this._keyManagerFactory(e,n)}_initializeDataDiffer(){let e=this.trackBy??((n,o)=>this._getExpansionKey(o));this._dataDiffer=this._differs.find([]).create(e)}_checkTreeControlUsage(){}renderNodeChanges(e,n=this._dataDiffer,o=this._nodeOutlet.viewContainer,s){let l=n.diff(e);!l&&!this._viewInit||(l?.forEachOperation((h,p,m)=>{if(h.previousIndex==null)this.insertNode(e[m],m,o,s);else if(m==null)o.remove(p);else{let f=o.get(p);o.move(f,m)}}),l?.forEachIdentityChange(h=>{let p=h.item;if(h.currentIndex!=null){let m=o.get(h.currentIndex);m.context.$implicit=p}}),s?this._changeDetectorRef.markForCheck():this._changeDetectorRef.detectChanges())}_getNodeDef(e,n){if(this._nodeDefs.length===1)return this._nodeDefs.first;let o=this._nodeDefs.find(s=>s.when&&s.when(n,e))||this._defaultNodeDef;return o}insertNode(e,n,o,s){let l=this._getLevelAccessor(),h=this._getNodeDef(e,n),p=this._getExpansionKey(e),m=new UN(e);s??=this._parents.get(p)??void 0,l?m.level=l(e):s!==void 0&&this._levels.has(this._getExpansionKey(s))?m.level=this._levels.get(this._getExpansionKey(s))+1:m.level=0,this._levels.set(p,m.level),(o||this._nodeOutlet.viewContainer).createEmbeddedView(h.template,m,n),lf.mostRecentTreeNode&&(lf.mostRecentTreeNode.data=e)}isExpanded(e){return!!(this.treeControl?.isExpanded(e)||this._expansionModel?.isSelected(this._getExpansionKey(e)))}toggle(e){this.treeControl?this.treeControl.toggle(e):this._expansionModel&&this._expansionModel.toggle(this._getExpansionKey(e))}expand(e){this.treeControl?this.treeControl.expand(e):this._expansionModel&&this._expansionModel.select(this._getExpansionKey(e))}collapse(e){this.treeControl?this.treeControl.collapse(e):this._expansionModel&&this._expansionModel.deselect(this._getExpansionKey(e))}toggleDescendants(e){this.treeControl?this.treeControl.toggleDescendants(e):this._expansionModel&&(this.isExpanded(e)?this.collapseDescendants(e):this.expandDescendants(e))}expandDescendants(e){if(this.treeControl)this.treeControl.expandDescendants(e);else if(this._expansionModel){let n=this._expansionModel;n.select(this._getExpansionKey(e)),this._getDescendants(e).pipe(Ol(1),Vo(this._onDestroy)).subscribe(o=>{n.select(...o.map(s=>this._getExpansionKey(s)))})}}collapseDescendants(e){if(this.treeControl)this.treeControl.collapseDescendants(e);else if(this._expansionModel){let n=this._expansionModel;n.deselect(this._getExpansionKey(e)),this._getDescendants(e).pipe(Ol(1),Vo(this._onDestroy)).subscribe(o=>{n.deselect(...o.map(s=>this._getExpansionKey(s)))})}}expandAll(){this.treeControl?this.treeControl.expandAll():this._expansionModel&&this._expansionModel.select(...this._flattenedNodes.value.map(n=>this._getExpansionKey(n)))}collapseAll(){this.treeControl?this.treeControl.collapseAll():this._expansionModel&&this._expansionModel.deselect(...this._flattenedNodes.value.map(n=>this._getExpansionKey(n)))}_getLevelAccessor(){return this.treeControl?.getLevel?.bind(this.treeControl)??this.levelAccessor}_getChildrenAccessor(){return this.treeControl?.getChildren?.bind(this.treeControl)??this.childrenAccessor}_getDirectChildren(e){let n=this._getLevelAccessor(),o=this._expansionModel??this.treeControl?.expansionModel;if(!o)return ai([]);let s=this._getExpansionKey(e),l=o.changed.pipe(Xn(p=>p.added.includes(s)?ai(!0):p.removed.includes(s)?ai(!1):Gd),ec(this.isExpanded(e)));if(n)return Ts([l,this._flattenedNodes]).pipe(Nt(([p,m])=>p?this._findChildrenByLevel(n,m,e,1):[]));let h=this._getChildrenAccessor();if(h)return FA(h(e)??[]);throw HQ()}_findChildrenByLevel(e,n,o,s){let l=this._getExpansionKey(o),h=n.findIndex(g=>this._getExpansionKey(g)===l),p=e(o),m=p+s,f=[];for(let g=h+1;g<n.length;g++){let y=e(n[g]);if(y<=p)break;y<=m&&f.push(n[g])}return f}_registerNode(e){this._nodes.value.set(this._getExpansionKey(e.data),e),this._nodes.next(this._nodes.value)}_unregisterNode(e){this._nodes.value.delete(this._getExpansionKey(e.data)),this._nodes.next(this._nodes.value)}_getLevel(e){return this._levels.get(this._getExpansionKey(e))}_getSetSize(e){return this._getAriaSet(e).length}_getPositionInSet(e){let n=this._getAriaSet(e),o=this._getExpansionKey(e);return n.findIndex(s=>this._getExpansionKey(s)===o)+1}_getNodeParent(e){let n=this._parents.get(this._getExpansionKey(e.data));return n&&this._nodes.value.get(this._getExpansionKey(n))}_getNodeChildren(e){return this._getDirectChildren(e.data).pipe(Nt(n=>n.reduce((o,s)=>{let l=this._nodes.value.get(this._getExpansionKey(s));return l&&o.push(l),o},[])))}_sendKeydownToKeyManager(e){if(e.target===this._elementRef.nativeElement)this._keyManager.onKeydown(e);else{let n=this._nodes.getValue();for(let[,o]of n)if(e.target===o._elementRef.nativeElement){this._keyManager.onKeydown(e);break}}}_getDescendants(e){if(this.treeControl)return ai(this.treeControl.getDescendants(e));if(this.levelAccessor){let n=this._findChildrenByLevel(this.levelAccessor,this._flattenedNodes.value,e,1/0);return ai(n)}if(this.childrenAccessor)return this._getAllChildrenRecursively(e).pipe(UF((n,o)=>(n.push(...o),n),[]));throw HQ()}_getAllChildrenRecursively(e){return this.childrenAccessor?FA(this.childrenAccessor(e)).pipe(Ol(1),Xn(n=>{for(let o of n)this._parents.set(this._getExpansionKey(o),e);return ai(...n).pipe(qs(o=>VF(ai([o]),this._getAllChildrenRecursively(o))))})):ai([])}_getExpansionKey(e){return this.expansionKey?.(e)??e}_getAriaSet(e){let n=this._getExpansionKey(e),o=this._parents.get(n),s=o?this._getExpansionKey(o):null;return this._ariaSets.get(s)??[e]}_findParentForNode(e,n,o){if(!o.length)return null;let s=this._levels.get(this._getExpansionKey(e))??0;for(let l=n-1;l>=0;l--){let h=o[l];if((this._levels.get(this._getExpansionKey(h))??0)<s)return h}return null}_flattenNestedNodesWithExpansion(e,n=0){let o=this._getChildrenAccessor();return o?ai(...e).pipe(qs(s=>{let l=this._getExpansionKey(s);this._parents.has(l)||this._parents.set(l,null),this._levels.set(l,n);let h=FA(o(s));return VF(ai([s]),h.pipe(Ol(1),bu(p=>{this._ariaSets.set(l,[...p??[]]);for(let m of p??[]){let f=this._getExpansionKey(m);this._parents.set(f,s),this._levels.set(f,n+1)}}),Xn(p=>p?this._flattenNestedNodesWithExpansion(p,n+1).pipe(Nt(m=>this.isExpanded(s)?m:[])):ai([]))))}),UF((s,l)=>(s.push(...l),s),[])):ai([...e])}_computeRenderingData(e,n){if(this.childrenAccessor&&n==="flat")return this._ariaSets.set(null,[...e]),this._flattenNestedNodesWithExpansion(e).pipe(Nt(o=>({renderNodes:o,flattenedNodes:o})));if(this.levelAccessor&&n==="nested"){let o=this.levelAccessor;return ai(e.filter(s=>o(s)===0)).pipe(Nt(s=>({renderNodes:s,flattenedNodes:e})),bu(({flattenedNodes:s})=>{this._calculateParents(s)}))}else return n==="flat"?ai({renderNodes:e,flattenedNodes:e}).pipe(bu(({flattenedNodes:o})=>{this._calculateParents(o)})):(this._ariaSets.set(null,[...e]),this._flattenNestedNodesWithExpansion(e).pipe(Nt(o=>({renderNodes:e,flattenedNodes:o}))))}_updateCachedData(e){this._flattenedNodes.next(e)}_updateKeyManagerItems(e){this._keyManagerNodes.next(e)}_calculateParents(e){let n=this._getLevelAccessor();if(n){this._parents.clear(),this._ariaSets.clear();for(let o=0;o<e.length;o++){let s=e[o],l=this._getExpansionKey(s);this._levels.set(l,n(s));let h=this._findParentForNode(s,o,e);this._parents.set(l,h);let p=h?this._getExpansionKey(h):null,m=this._ariaSets.get(p)??[];m.splice(o,0,s),this._ariaSets.set(p,m)}}}static{this.\u0275fac=function(n){return new(n||r)(Ie(gx),Ie(lr))}}static{this.\u0275cmp=nt({type:r,selectors:[["cdk-tree"]],contentQueries:function(n,o,s){if(n&1&&Do(s,OT,5),n&2){let l;bi(l=wi())&&(o._nodeDefs=l)}},viewQuery:function(n,o){if(n&1&&Ir(lC,7),n&2){let s;bi(s=wi())&&(o._nodeOutlet=s.first)}},hostAttrs:["role","tree",1,"cdk-tree"],hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._sendKeydownToKeyManager(l)})},inputs:{dataSource:"dataSource",treeControl:"treeControl",levelAccessor:"levelAccessor",childrenAccessor:"childrenAccessor",trackBy:"trackBy",expansionKey:"expansionKey"},exportAs:["cdkTree"],standalone:!0,features:[lt],decls:1,vars:0,consts:[["cdkTreeNodeOutlet",""]],template:function(n,o){n&1&&ic(0,0)},dependencies:[lC],encapsulation:2})}}return r})(),lf=(()=>{class r{get role(){return"treeitem"}set role(e){}get isExpandable(){return this._isExpandable()}set isExpandable(e){this._inputIsExpandable=e,!(this.data&&!this._isExpandable||!this._inputIsExpandable)&&(this._inputIsExpanded?this.expand():this._inputIsExpanded===!1&&this.collapse())}get isExpanded(){return this._tree.isExpanded(this._data)}set isExpanded(e){this._inputIsExpanded=e,e?this.expand():this.collapse()}getLabel(){return this.typeaheadLabel||this._elementRef.nativeElement.textContent?.trim()||""}static{this.mostRecentTreeNode=null}get data(){return this._data}set data(e){e!==this._data&&(this._data=e,this._dataChanges.next())}get isLeafNode(){return this._tree.treeControl?.isExpandable!==void 0&&!this._tree.treeControl.isExpandable(this._data)?!0:this._tree.treeControl?.isExpandable===void 0&&this._tree.treeControl?.getDescendants(this._data).length===0}get level(){return this._tree._getLevel(this._data)??this._parentNodeAriaLevel}_isExpandable(){return this._tree.treeControl?!this.isLeafNode:this._inputIsExpandable}_getAriaExpanded(){return this._isExpandable()?String(this.isExpanded):null}_getSetSize(){return this._tree._getSetSize(this._data)}_getPositionInSet(){return this._tree._getPositionInSet(this._data)}constructor(e,n){this._elementRef=e,this._tree=n,this._tabindex=-1,this.activation=new Ke,this.expandedChange=new Ke,this._destroyed=new Si,this._dataChanges=new Si,this._inputIsExpandable=!1,this._inputIsExpanded=void 0,this._shouldFocus=!0,this._changeDetectorRef=ga(lr),r.mostRecentTreeNode=this}ngOnInit(){this._parentNodeAriaLevel=yxe(this._elementRef.nativeElement),this._tree._getExpansionModel().changed.pipe(Nt(()=>this.isExpanded),$u()).subscribe(()=>{this._changeDetectorRef.markForCheck()}),this._tree._setNodeTypeIfUnset("flat"),this._tree._registerNode(this)}ngOnDestroy(){r.mostRecentTreeNode===this&&(r.mostRecentTreeNode=null),this._dataChanges.complete(),this._destroyed.next(),this._destroyed.complete()}getParent(){return this._tree._getNodeParent(this)??null}getChildren(){return this._tree._getNodeChildren(this)}focus(){this._tabindex=0,this._shouldFocus&&this._elementRef.nativeElement.focus(),this._changeDetectorRef.markForCheck()}unfocus(){this._tabindex=-1,this._changeDetectorRef.markForCheck()}activate(){this.isDisabled||this.activation.next(this._data)}collapse(){this.isExpandable&&this._tree.collapse(this._data)}expand(){this.isExpandable&&this._tree.expand(this._data)}makeFocusable(){this._tabindex=0,this._changeDetectorRef.markForCheck()}_focusItem(){this.isDisabled||this._tree._keyManager.focusItem(this)}_setActiveItem(){this.isDisabled||(this._shouldFocus=!1,this._tree._keyManager.focusItem(this),this._shouldFocus=!0)}_emitExpansionState(e){this.expandedChange.emit(e)}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(cf))}}static{this.\u0275dir=Fi({type:r,selectors:[["cdk-tree-node"]],hostAttrs:["role","treeitem",1,"cdk-tree-node"],hostVars:5,hostBindings:function(n,o){n&1&&ve("click",function(){return o._setActiveItem()})("focus",function(){return o._focusItem()}),n&2&&(mm("tabindex",o._tabindex),Or("aria-expanded",o._getAriaExpanded())("aria-level",o.level+1)("aria-posinset",o._getPositionInSet())("aria-setsize",o._getSetSize()))},inputs:{role:"role",isExpandable:[2,"isExpandable","isExpandable",Vi],isExpanded:"isExpanded",isDisabled:[2,"isDisabled","isDisabled",Vi],typeaheadLabel:[0,"cdkTreeNodeTypeaheadLabel","typeaheadLabel"]},outputs:{activation:"activation",expandedChange:"expandedChange"},exportAs:["cdkTreeNode"],standalone:!0,features:[$n]})}}return r})();function yxe(r){let i=r.parentElement;for(;i&&!vxe(i);)i=i.parentElement;return i?i.classList.contains("cdk-nested-tree-node")?Uo(i.getAttribute("aria-level")):0:-1}function vxe(r){let i=r.classList;return!!(i?.contains("cdk-nested-tree-node")||i?.contains("cdk-tree"))}var zN=(()=>{class r extends lf{constructor(e,n,o){super(e,n),this._differs=o}ngAfterContentInit(){this._dataDiffer=this._differs.find([]).create(this._tree.trackBy),this._tree._getDirectChildren(this.data).pipe(Vo(this._destroyed)).subscribe(e=>this.updateChildrenNodes(e)),this.nodeOutlet.changes.pipe(Vo(this._destroyed)).subscribe(()=>this.updateChildrenNodes())}ngOnInit(){this._tree._setNodeTypeIfUnset("nested"),super.ngOnInit()}ngOnDestroy(){this._clear(),super.ngOnDestroy()}updateChildrenNodes(e){let n=this._getNodeOutlet();if(e&&(this._children=e),n&&this._children){let o=n.viewContainer;this._tree.renderNodeChanges(this._children,this._dataDiffer,o,this._data)}else this._dataDiffer.diff([])}_clear(){let e=this._getNodeOutlet();e&&(e.viewContainer.clear(),this._dataDiffer.diff([]))}_getNodeOutlet(){let e=this.nodeOutlet;return e&&e.find(n=>!n._node||n._node===this)}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(cf),Ie(gx))}}static{this.\u0275dir=Fi({type:r,selectors:[["cdk-nested-tree-node"]],contentQueries:function(n,o,s){if(n&1&&Do(s,lC,5),n&2){let l;bi(l=wi())&&(o.nodeOutlet=l)}},hostAttrs:[1,"cdk-nested-tree-node"],exportAs:["cdkNestedTreeNode"],standalone:!0,features:[Xi([{provide:lf,useExisting:r},{provide:cC,useExisting:r}]),ll]})}}return r})(),bxe=/([A-Za-z%]+)$/,$N=(()=>{class r{get level(){return this._level}set level(e){this._setLevelInput(e)}get indent(){return this._indent}set indent(e){this._setIndentInput(e)}constructor(e,n,o,s){this._treeNode=e,this._tree=n,this._element=o,this._dir=s,this._destroyed=new Si,this.indentUnits="px",this._indent=40,this._setPadding(),s&&s.change.pipe(Vo(this._destroyed)).subscribe(()=>this._setPadding(!0)),e._dataChanges.subscribe(()=>this._setPadding())}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}_paddingIndent(){let e=(this._treeNode.data&&this._tree._getLevel(this._treeNode.data))??null,n=this._level==null?e:this._level;return typeof n=="number"?`${n*this._indent}${this.indentUnits}`:null}_setPadding(e=!1){let n=this._paddingIndent();if(n!==this._currentPadding||e){let o=this._element.nativeElement,s=this._dir&&this._dir.value==="rtl"?"paddingRight":"paddingLeft",l=s==="paddingLeft"?"paddingRight":"paddingLeft";o.style[s]=n||"",o.style[l]="",this._currentPadding=n}}_setLevelInput(e){this._level=isNaN(e)?null:e,this._setPadding()}_setIndentInput(e){let n=e,o="px";if(typeof e=="string"){let s=e.split(bxe);n=s[0],o=s[1]||o}this.indentUnits=o,this._indent=Uo(n),this._setPadding()}static{this.\u0275fac=function(n){return new(n||r)(Ie(lf),Ie(cf),Ie(ar),Ie(Rl,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkTreeNodePadding",""]],inputs:{level:[2,"cdkTreeNodePadding","level",Uo],indent:[0,"cdkTreeNodePaddingIndent","indent"]},standalone:!0,features:[$n]})}}return r})(),WN=(()=>{class r{constructor(e,n){this._tree=e,this._treeNode=n,this.recursive=!1}_toggle(){this.recursive?this._tree.toggleDescendants(this._treeNode.data):this._tree.toggle(this._treeNode.data),this._tree._keyManager.focusItem(this._treeNode)}static{this.\u0275fac=function(n){return new(n||r)(Ie(cf),Ie(lf))}}static{this.\u0275dir=Fi({type:r,selectors:[["","cdkTreeNodeToggle",""]],hostAttrs:["tabindex","-1"],hostBindings:function(n,o){n&1&&ve("click",function(l){return o._toggle(),l.stopPropagation()})("keydown.Enter",function(l){return o._toggle(),l.preventDefault()})("keydown.Space",function(l){return o._toggle(),l.preventDefault()})},inputs:{recursive:[2,"cdkTreeNodeToggleRecursive","recursive",Vi]},standalone:!0,features:[$n]})}}return r})();var qQ=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({})}}return r})();var xxe=["knob"],Sxe=["valueIndicatorContainer"];function Cxe(r,i){if(r&1&&($(0,"div",2,1)(2,"div",5)(3,"span",6),_e(4),ee()()()),r&2){let e=ne();j(4),bt(e.valueIndicatorText)}}var Axe=["trackActive"],Mxe=["*"];function Ixe(r,i){if(r&1&&ct(0,"div"),r&2){let e=i.$implicit,n=i.$index,o=ne(3);Vd(e===0?"mdc-slider__tick-mark--active":"mdc-slider__tick-mark--inactive"),fo("transform",o._calcTickMarkTransform(n))}}function Exe(r,i){if(r&1&&mx(0,Ixe,1,4,"div",8,M7),r&2){let e=ne(2);fx(e._tickMarks)}}function Txe(r,i){if(r&1&&($(0,"div",6,1),Pe(2,Exe,2,0),ee()),r&2){let e=ne();j(2),jc(e._cachedWidth?2:-1)}}function Fxe(r,i){if(r&1&&ct(0,"mat-slider-visual-thumb",7),r&2){let e=ne();z("discrete",e.discrete)("thumbPosition",1)("valueIndicatorText",e.startValueIndicatorText)}}var tn=function(r){return r[r.START=1]="START",r[r.END=2]="END",r}(tn||{}),hw=function(r){return r[r.ACTIVE=0]="ACTIVE",r[r.INACTIVE=1]="INACTIVE",r}(hw||{}),HN=new Ln("_MatSlider"),YQ=new Ln("_MatSliderThumb"),Pxe=new Ln("_MatSliderRangeThumb"),ZQ=new Ln("_MatSliderVisualThumb");var Lxe=(()=>{class r{constructor(e,n,o,s){this._cdr=e,this._ngZone=n,this._slider=s,this._isHovered=!1,this._isActive=!1,this._isValueIndicatorVisible=!1,this._platform=ga(Bf),this._onPointerMove=l=>{if(this._sliderInput._isFocused)return;let h=this._hostElement.getBoundingClientRect(),p=this._slider._isCursorOnSliderThumb(l,h);this._isHovered=p,p?this._showHoverRipple():this._hideRipple(this._hoverRippleRef)},this._onMouseLeave=()=>{this._isHovered=!1,this._hideRipple(this._hoverRippleRef)},this._onFocus=()=>{this._hideRipple(this._hoverRippleRef),this._showFocusRipple(),this._hostElement.classList.add("mdc-slider__thumb--focused")},this._onBlur=()=>{this._isActive||this._hideRipple(this._focusRippleRef),this._isHovered&&this._showHoverRipple(),this._hostElement.classList.remove("mdc-slider__thumb--focused")},this._onDragStart=l=>{l.button===0&&(this._isActive=!0,this._showActiveRipple())},this._onDragEnd=()=>{this._isActive=!1,this._hideRipple(this._activeRippleRef),this._sliderInput._isFocused||this._hideRipple(this._focusRippleRef),this._platform.SAFARI&&this._showHoverRipple()},this._hostElement=o.nativeElement}ngAfterViewInit(){let e=this._slider._getInput(this.thumbPosition);e&&(this._ripple.radius=24,this._sliderInput=e,this._sliderInputEl=this._sliderInput._hostElement,this._ngZone.runOutsideAngular(()=>{let n=this._sliderInputEl;n.addEventListener("pointermove",this._onPointerMove),n.addEventListener("pointerdown",this._onDragStart),n.addEventListener("pointerup",this._onDragEnd),n.addEventListener("pointerleave",this._onMouseLeave),n.addEventListener("focus",this._onFocus),n.addEventListener("blur",this._onBlur)}))}ngOnDestroy(){let e=this._sliderInputEl;e&&(e.removeEventListener("pointermove",this._onPointerMove),e.removeEventListener("pointerdown",this._onDragStart),e.removeEventListener("pointerup",this._onDragEnd),e.removeEventListener("pointerleave",this._onMouseLeave),e.removeEventListener("focus",this._onFocus),e.removeEventListener("blur",this._onBlur))}_showHoverRipple(){this._isShowingRipple(this._hoverRippleRef)||(this._hoverRippleRef=this._showRipple({enterDuration:0,exitDuration:0}),this._hoverRippleRef?.element.classList.add("mat-mdc-slider-hover-ripple"))}_showFocusRipple(){this._isShowingRipple(this._focusRippleRef)||(this._focusRippleRef=this._showRipple({enterDuration:0,exitDuration:0},!0),this._focusRippleRef?.element.classList.add("mat-mdc-slider-focus-ripple"))}_showActiveRipple(){this._isShowingRipple(this._activeRippleRef)||(this._activeRippleRef=this._showRipple({enterDuration:225,exitDuration:400}),this._activeRippleRef?.element.classList.add("mat-mdc-slider-active-ripple"))}_isShowingRipple(e){return e?.state===qF.FADING_IN||e?.state===qF.VISIBLE}_showRipple(e,n){if(!this._slider.disabled&&(this._showValueIndicator(),this._slider._isRange&&this._slider._getThumb(this.thumbPosition===tn.START?tn.END:tn.START)._showValueIndicator(),!(this._slider._globalRippleOptions?.disabled&&!n)))return this._ripple.launch({animation:this._slider._noopAnimations?{enterDuration:0,exitDuration:0}:e,centered:!0,persistent:!0})}_hideRipple(e){if(e?.fadeOut(),this._isShowingAnyRipple())return;this._slider._isRange||this._hideValueIndicator();let n=this._getSibling();n._isShowingAnyRipple()||(this._hideValueIndicator(),n._hideValueIndicator())}_showValueIndicator(){this._hostElement.classList.add("mdc-slider__thumb--with-indicator")}_hideValueIndicator(){this._hostElement.classList.remove("mdc-slider__thumb--with-indicator")}_getSibling(){return this._slider._getThumb(this.thumbPosition===tn.START?tn.END:tn.START)}_getValueIndicatorContainer(){return this._valueIndicatorContainer?.nativeElement}_getKnob(){return this._knob.nativeElement}_isShowingAnyRipple(){return this._isShowingRipple(this._hoverRippleRef)||this._isShowingRipple(this._focusRippleRef)||this._isShowingRipple(this._activeRippleRef)}static{this.\u0275fac=function(n){return new(n||r)(Ie(lr),Ie(tc),Ie(ar),Ie(HN))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-slider-visual-thumb"]],viewQuery:function(n,o){if(n&1&&(Ir(fm,5),Ir(xxe,5),Ir(Sxe,5)),n&2){let s;bi(s=wi())&&(o._ripple=s.first),bi(s=wi())&&(o._knob=s.first),bi(s=wi())&&(o._valueIndicatorContainer=s.first)}},hostAttrs:[1,"mdc-slider__thumb","mat-mdc-slider-visual-thumb"],inputs:{discrete:"discrete",thumbPosition:"thumbPosition",valueIndicatorText:"valueIndicatorText"},standalone:!0,features:[Xi([{provide:ZQ,useExisting:r}]),lt],decls:4,vars:2,consts:[["knob",""],["valueIndicatorContainer",""],[1,"mdc-slider__value-indicator-container"],[1,"mdc-slider__thumb-knob"],["matRipple","",1,"mat-mdc-focus-indicator",3,"matRippleDisabled"],[1,"mdc-slider__value-indicator"],[1,"mdc-slider__value-indicator-text"]],template:function(n,o){n&1&&(Pe(0,Cxe,5,1,"div",2),ct(1,"div",3,0)(3,"div",4)),n&2&&(jc(o.discrete?0:-1),j(3),z("matRippleDisabled",!0))},dependencies:[fm],styles:[".mat-mdc-slider-visual-thumb .mat-ripple{height:100%;width:100%}.mat-mdc-slider .mdc-slider__tick-marks{justify-content:start}.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--active,.mat-mdc-slider .mdc-slider__tick-marks .mdc-slider__tick-mark--inactive{position:absolute;left:2px}"],encapsulation:2,changeDetection:0})}}return r})(),uf=(()=>{class r{get disabled(){return this._disabled}set disabled(e){this._disabled=e;let n=this._getInput(tn.END),o=this._getInput(tn.START);n&&(n.disabled=this._disabled),o&&(o.disabled=this._disabled)}get discrete(){return this._discrete}set discrete(e){this._discrete=e,this._updateValueIndicatorUIs()}get min(){return this._min}set min(e){let n=isNaN(e)?this._min:e;this._min!==n&&this._updateMin(n)}_updateMin(e){let n=this._min;this._min=e,this._isRange?this._updateMinRange({old:n,new:e}):this._updateMinNonRange(e),this._onMinMaxOrStepChange()}_updateMinRange(e){let n=this._getInput(tn.END),o=this._getInput(tn.START),s=n.value,l=o.value;o.min=e.new,n.min=Math.max(e.new,o.value),o.max=Math.min(n.max,n.value),o._updateWidthInactive(),n._updateWidthInactive(),e.new<e.old?this._onTranslateXChangeBySideEffect(n,o):this._onTranslateXChangeBySideEffect(o,n),s!==n.value&&this._onValueChange(n),l!==o.value&&this._onValueChange(o)}_updateMinNonRange(e){let n=this._getInput(tn.END);if(n){let o=n.value;n.min=e,n._updateThumbUIByValue(),this._updateTrackUI(n),o!==n.value&&this._onValueChange(n)}}get max(){return this._max}set max(e){let n=isNaN(e)?this._max:e;this._max!==n&&this._updateMax(n)}_updateMax(e){let n=this._max;this._max=e,this._isRange?this._updateMaxRange({old:n,new:e}):this._updateMaxNonRange(e),this._onMinMaxOrStepChange()}_updateMaxRange(e){let n=this._getInput(tn.END),o=this._getInput(tn.START),s=n.value,l=o.value;n.max=e.new,o.max=Math.min(e.new,n.value),n.min=o.value,n._updateWidthInactive(),o._updateWidthInactive(),e.new>e.old?this._onTranslateXChangeBySideEffect(o,n):this._onTranslateXChangeBySideEffect(n,o),s!==n.value&&this._onValueChange(n),l!==o.value&&this._onValueChange(o)}_updateMaxNonRange(e){let n=this._getInput(tn.END);if(n){let o=n.value;n.max=e,n._updateThumbUIByValue(),this._updateTrackUI(n),o!==n.value&&this._onValueChange(n)}}get step(){return this._step}set step(e){let n=isNaN(e)?this._step:e;this._step!==n&&this._updateStep(n)}_updateStep(e){this._step=e,this._isRange?this._updateStepRange():this._updateStepNonRange(),this._onMinMaxOrStepChange()}_updateStepRange(){let e=this._getInput(tn.END),n=this._getInput(tn.START),o=e.value,s=n.value,l=n.value;e.min=this._min,n.max=this._max,e.step=this._step,n.step=this._step,this._platform.SAFARI&&(e.value=e.value,n.value=n.value),e.min=Math.max(this._min,n.value),n.max=Math.min(this._max,e.value),n._updateWidthInactive(),e._updateWidthInactive(),e.value<l?this._onTranslateXChangeBySideEffect(n,e):this._onTranslateXChangeBySideEffect(e,n),o!==e.value&&this._onValueChange(e),s!==n.value&&this._onValueChange(n)}_updateStepNonRange(){let e=this._getInput(tn.END);if(e){let n=e.value;e.step=this._step,this._platform.SAFARI&&(e.value=e.value),e._updateThumbUIByValue(),n!==e.value&&this._onValueChange(e)}}constructor(e,n,o,s,l,h){this._ngZone=e,this._cdr=n,this._elementRef=o,this._dir=s,this._globalRippleOptions=l,this._disabled=!1,this._discrete=!1,this.showTickMarks=!1,this._min=0,this.disableRipple=!1,this._max=100,this._step=1,this.displayWith=p=>`${p}`,this._rippleRadius=24,this.startValueIndicatorText="",this.endValueIndicatorText="",this._isRange=!1,this._isRtl=!1,this._hasViewInitialized=!1,this._tickMarkTrackWidth=0,this._hasAnimation=!1,this._resizeTimer=null,this._platform=ga(Bf),this._knobRadius=8,this._thumbsOverlap=!1,this._noopAnimations=h==="NoopAnimations",this._dirChangeSubscription=this._dir.change.subscribe(()=>this._onDirChange()),this._isRtl=this._dir.value==="rtl"}ngAfterViewInit(){this._platform.isBrowser&&this._updateDimensions();let e=this._getInput(tn.END),n=this._getInput(tn.START);this._isRange=!!e&&!!n,this._cdr.detectChanges();let o=this._getThumb(tn.END);this._rippleRadius=o._ripple.radius,this._inputPadding=this._rippleRadius-this._knobRadius,this._isRange?this._initUIRange(e,n):this._initUINonRange(e),this._updateTrackUI(e),this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._observeHostResize(),this._cdr.detectChanges()}_initUINonRange(e){e.initProps(),e.initUI(),this._updateValueIndicatorUI(e),this._hasViewInitialized=!0,e._updateThumbUIByValue()}_initUIRange(e,n){e.initProps(),e.initUI(),n.initProps(),n.initUI(),e._updateMinMax(),n._updateMinMax(),e._updateStaticStyles(),n._updateStaticStyles(),this._updateValueIndicatorUIs(),this._hasViewInitialized=!0,e._updateThumbUIByValue(),n._updateThumbUIByValue()}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._resizeObserver?.disconnect(),this._resizeObserver=null}_onDirChange(){this._isRtl=this._dir.value==="rtl",this._isRange?this._onDirChangeRange():this._onDirChangeNonRange(),this._updateTickMarkUI()}_onDirChangeRange(){let e=this._getInput(tn.END),n=this._getInput(tn.START);e._setIsLeftThumb(),n._setIsLeftThumb(),e.translateX=e._calcTranslateXByValue(),n.translateX=n._calcTranslateXByValue(),e._updateStaticStyles(),n._updateStaticStyles(),e._updateWidthInactive(),n._updateWidthInactive(),e._updateThumbUIByValue(),n._updateThumbUIByValue()}_onDirChangeNonRange(){this._getInput(tn.END)._updateThumbUIByValue()}_observeHostResize(){typeof ResizeObserver>"u"||!ResizeObserver||this._ngZone.runOutsideAngular(()=>{this._resizeObserver=new ResizeObserver(()=>{this._isActive()||(this._resizeTimer&&clearTimeout(this._resizeTimer),this._onResize())}),this._resizeObserver.observe(this._elementRef.nativeElement)})}_isActive(){return this._getThumb(tn.START)._isActive||this._getThumb(tn.END)._isActive}_getValue(e=tn.END){let n=this._getInput(e);return n?n.value:this.min}_skipUpdate(){return!!(this._getInput(tn.START)?._skipUIUpdate||this._getInput(tn.END)?._skipUIUpdate)}_updateDimensions(){this._cachedWidth=this._elementRef.nativeElement.offsetWidth,this._cachedLeft=this._elementRef.nativeElement.getBoundingClientRect().left}_setTrackActiveStyles(e){let n=this._trackActive.nativeElement.style;n.left=e.left,n.right=e.right,n.transformOrigin=e.transformOrigin,n.transform=e.transform}_calcTickMarkTransform(e){return`translateX(${e*(this._tickMarkTrackWidth/(this._tickMarks.length-1))}px`}_onTranslateXChange(e){this._hasViewInitialized&&(this._updateThumbUI(e),this._updateTrackUI(e),this._updateOverlappingThumbUI(e))}_onTranslateXChangeBySideEffect(e,n){this._hasViewInitialized&&(e._updateThumbUIByValue(),n._updateThumbUIByValue())}_onValueChange(e){this._hasViewInitialized&&(this._updateValueIndicatorUI(e),this._updateTickMarkUI(),this._cdr.detectChanges())}_onMinMaxOrStepChange(){this._hasViewInitialized&&(this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.markForCheck())}_onResize(){if(this._hasViewInitialized){if(this._updateDimensions(),this._isRange){let e=this._getInput(tn.END),n=this._getInput(tn.START);e._updateThumbUIByValue(),n._updateThumbUIByValue(),e._updateStaticStyles(),n._updateStaticStyles(),e._updateMinMax(),n._updateMinMax(),e._updateWidthInactive(),n._updateWidthInactive()}else{let e=this._getInput(tn.END);e&&e._updateThumbUIByValue()}this._updateTickMarkUI(),this._updateTickMarkTrackUI(),this._cdr.detectChanges()}}_areThumbsOverlapping(){let e=this._getInput(tn.START),n=this._getInput(tn.END);return!e||!n?!1:n.translateX-e.translateX<20}_updateOverlappingThumbClassNames(e){let n=e.getSibling(),o=this._getThumb(e.thumbPosition);this._getThumb(n.thumbPosition)._hostElement.classList.remove("mdc-slider__thumb--top"),o._hostElement.classList.toggle("mdc-slider__thumb--top",this._thumbsOverlap)}_updateOverlappingThumbUI(e){!this._isRange||this._skipUpdate()||this._thumbsOverlap!==this._areThumbsOverlapping()&&(this._thumbsOverlap=!this._thumbsOverlap,this._updateOverlappingThumbClassNames(e))}_updateThumbUI(e){if(this._skipUpdate())return;let n=this._getThumb(e.thumbPosition===tn.END?tn.END:tn.START);n._hostElement.style.transform=`translateX(${e.translateX}px)`}_updateValueIndicatorUI(e){if(this._skipUpdate())return;let n=this.displayWith(e.value);if(this._hasViewInitialized?e._valuetext.set(n):e._hostElement.setAttribute("aria-valuetext",n),this.discrete){e.thumbPosition===tn.START?this.startValueIndicatorText=n:this.endValueIndicatorText=n;let o=this._getThumb(e.thumbPosition);n.length<3?o._hostElement.classList.add("mdc-slider__thumb--short-value"):o._hostElement.classList.remove("mdc-slider__thumb--short-value")}}_updateValueIndicatorUIs(){let e=this._getInput(tn.END),n=this._getInput(tn.START);e&&this._updateValueIndicatorUI(e),n&&this._updateValueIndicatorUI(n)}_updateTickMarkTrackUI(){if(!this.showTickMarks||this._skipUpdate())return;let e=this._step&&this._step>0?this._step:1,o=(Math.floor(this.max/e)*e-this.min)/(this.max-this.min);this._tickMarkTrackWidth=this._cachedWidth*o-6}_updateTrackUI(e){this._skipUpdate()||(this._isRange?this._updateTrackUIRange(e):this._updateTrackUINonRange(e))}_updateTrackUIRange(e){let n=e.getSibling();if(!n||!this._cachedWidth)return;let o=Math.abs(n.translateX-e.translateX)/this._cachedWidth;e._isLeftThumb&&this._cachedWidth?this._setTrackActiveStyles({left:"auto",right:`${this._cachedWidth-n.translateX}px`,transformOrigin:"right",transform:`scaleX(${o})`}):this._setTrackActiveStyles({left:`${n.translateX}px`,right:"auto",transformOrigin:"left",transform:`scaleX(${o})`})}_updateTrackUINonRange(e){this._isRtl?this._setTrackActiveStyles({left:"auto",right:"0px",transformOrigin:"right",transform:`scaleX(${1-e.fillPercentage})`}):this._setTrackActiveStyles({left:"0px",right:"auto",transformOrigin:"left",transform:`scaleX(${e.fillPercentage})`})}_updateTickMarkUI(){if(!this.showTickMarks||this.step===void 0||this.min===void 0||this.max===void 0)return;let e=this.step>0?this.step:1;this._isRange?this._updateTickMarkUIRange(e):this._updateTickMarkUINonRange(e),this._isRtl&&this._tickMarks.reverse()}_updateTickMarkUINonRange(e){let n=this._getValue(),o=Math.max(Math.round((n-this.min)/e),0),s=Math.max(Math.round((this.max-n)/e),0);this._isRtl?o++:s++,this._tickMarks=Array(o).fill(hw.ACTIVE).concat(Array(s).fill(hw.INACTIVE))}_updateTickMarkUIRange(e){let n=this._getValue(),o=this._getValue(tn.START),s=Math.max(Math.round((o-this.min)/e),0),l=Math.max(Math.round((n-o)/e)+1,0),h=Math.max(Math.round((this.max-n)/e),0);this._tickMarks=Array(s).fill(hw.INACTIVE).concat(Array(l).fill(hw.ACTIVE),Array(h).fill(hw.INACTIVE))}_getInput(e){if(e===tn.END&&this._input)return this._input;if(this._inputs?.length)return e===tn.START?this._inputs.first:this._inputs.last}_getThumb(e){return e===tn.END?this._thumbs?.last:this._thumbs?.first}_setTransition(e){this._hasAnimation=!this._platform.IOS&&e&&!this._noopAnimations,this._elementRef.nativeElement.classList.toggle("mat-mdc-slider-with-animation",this._hasAnimation)}_isCursorOnSliderThumb(e,n){let o=n.width/2,s=n.x+o,l=n.y+o,h=e.clientX-s,p=e.clientY-l;return Math.pow(h,2)+Math.pow(p,2)<Math.pow(o,2)}static{this.\u0275fac=function(n){return new(n||r)(Ie(tc),Ie(lr),Ie(ar),Ie(Rl,8),Ie(wx,8),Ie(Ah,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-slider"]],contentQueries:function(n,o,s){if(n&1&&(Do(s,YQ,5),Do(s,Pxe,4)),n&2){let l;bi(l=wi())&&(o._input=l.first),bi(l=wi())&&(o._inputs=l)}},viewQuery:function(n,o){if(n&1&&(Ir(Axe,5),Ir(ZQ,5)),n&2){let s;bi(s=wi())&&(o._trackActive=s.first),bi(s=wi())&&(o._thumbs=s)}},hostAttrs:[1,"mat-mdc-slider","mdc-slider"],hostVars:12,hostBindings:function(n,o){n&2&&(Vd("mat-"+(o.color||"primary")),dr("mdc-slider--range",o._isRange)("mdc-slider--disabled",o.disabled)("mdc-slider--discrete",o.discrete)("mdc-slider--tick-marks",o.showTickMarks)("_mat-animation-noopable",o._noopAnimations))},inputs:{disabled:[2,"disabled","disabled",Vi],discrete:[2,"discrete","discrete",Vi],showTickMarks:[2,"showTickMarks","showTickMarks",Vi],min:[2,"min","min",Uo],color:"color",disableRipple:[2,"disableRipple","disableRipple",Vi],max:[2,"max","max",Uo],step:[2,"step","step",Uo],displayWith:"displayWith"},exportAs:["matSlider"],standalone:!0,features:[Xi([{provide:HN,useExisting:r}]),$n,lt],ngContentSelectors:Mxe,decls:9,vars:5,consts:[["trackActive",""],["tickMarkContainer",""],[1,"mdc-slider__track"],[1,"mdc-slider__track--inactive"],[1,"mdc-slider__track--active"],[1,"mdc-slider__track--active_fill"],[1,"mdc-slider__tick-marks"],[3,"discrete","thumbPosition","valueIndicatorText"],[3,"class","transform"]],template:function(n,o){n&1&&(Kn(),Tn(0),$(1,"div",2),ct(2,"div",3),$(3,"div",4),ct(4,"div",5,0),ee(),Pe(6,Txe,3,1,"div",6),ee(),Pe(7,Fxe,1,3,"mat-slider-visual-thumb",7),ct(8,"mat-slider-visual-thumb",7)),n&2&&(j(6),jc(o.showTickMarks?6:-1),j(),jc(o._isRange?7:-1),j(),z("discrete",o.discrete)("thumbPosition",2)("valueIndicatorText",o.endValueIndicatorText))},dependencies:[Lxe],styles:['.mdc-slider__track{position:absolute;top:50%;transform:translateY(-50%);width:100%;pointer-events:none;height:var(--mdc-slider-inactive-track-height)}.mdc-slider__track--active,.mdc-slider__track--inactive{display:flex;height:100%;position:absolute;width:100%}.mdc-slider__track--active{overflow:hidden;border-radius:var(--mdc-slider-active-track-shape, var(--mat-app-corner-full));height:var(--mdc-slider-active-track-height);top:calc((var(--mdc-slider-inactive-track-height) - var(--mdc-slider-active-track-height))/2)}.mdc-slider__track--active_fill{border-top-style:solid;box-sizing:border-box;height:100%;width:100%;position:relative;transform-origin:left;transition:transform 80ms ease;border-color:var(--mdc-slider-active-track-color, var(--mat-app-primary));border-top-width:var(--mdc-slider-active-track-height)}.mdc-slider--disabled .mdc-slider__track--active_fill{border-color:var(--mdc-slider-disabled-active-track-color, var(--mat-app-on-surface))}[dir=rtl] .mdc-slider__track--active_fill{-webkit-transform-origin:right;transform-origin:right}.mdc-slider__track--inactive{left:0;top:0;opacity:.24;background-color:var(--mdc-slider-inactive-track-color, var(--mat-app-surface-variant));height:var(--mdc-slider-inactive-track-height);border-radius:var(--mdc-slider-inactive-track-shape, var(--mat-app-corner-full))}.mdc-slider--disabled .mdc-slider__track--inactive{background-color:var(--mdc-slider-disabled-inactive-track-color, var(--mat-app-on-surface));opacity:.24}.mdc-slider__track--inactive::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.cdk-high-contrast-active .mdc-slider__track--inactive::before{border-color:CanvasText}.mdc-slider__value-indicator-container{bottom:44px;left:50%;pointer-events:none;position:absolute;transform:translateX(-50%);transform:var(--mat-slider-value-indicator-container-transform)}.mdc-slider__thumb--with-indicator .mdc-slider__value-indicator-container{pointer-events:auto}.mdc-slider__value-indicator{display:flex;align-items:center;border-radius:4px;height:32px;padding:0 12px;transform:scale(0);transform-origin:bottom;opacity:1;transition:transform 100ms cubic-bezier(0.4, 0, 1, 1);word-break:normal;background-color:var(--mdc-slider-label-container-color, var(--mat-app-primary));color:var(--mdc-slider-label-label-text-color, var(--mat-app-on-primary));width:var(--mat-slider-value-indicator-width);height:var(--mat-slider-value-indicator-height);padding:var(--mat-slider-value-indicator-padding);opacity:var(--mat-slider-value-indicator-opacity);border-radius:var(--mat-slider-value-indicator-border-radius)}.mdc-slider__thumb--with-indicator .mdc-slider__value-indicator{transition:transform 100ms cubic-bezier(0, 0, 0.2, 1);transform:scale(1)}.mdc-slider__value-indicator::before{border-left:6px solid rgba(0,0,0,0);border-right:6px solid rgba(0,0,0,0);border-top:6px solid;bottom:-5px;content:"";height:0;left:50%;position:absolute;transform:translateX(-50%);width:0;display:var(--mat-slider-value-indicator-caret-display);border-top-color:var(--mdc-slider-label-container-color, var(--mat-app-primary))}.mdc-slider__value-indicator::after{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.cdk-high-contrast-active .mdc-slider__value-indicator::after{border-color:CanvasText}.mdc-slider__value-indicator-text{text-align:center;width:var(--mat-slider-value-indicator-width);transform:var(--mat-slider-value-indicator-text-transform);font-family:var(--mdc-slider-label-label-text-font, var(--mat-app-label-medium-font));font-size:var(--mdc-slider-label-label-text-size, var(--mat-app-label-medium-size));font-weight:var(--mdc-slider-label-label-text-weight, var(--mat-app-label-medium-weight));line-height:var(--mdc-slider-label-label-text-line-height, var(--mat-app-label-medium-line-height));letter-spacing:var(--mdc-slider-label-label-text-tracking, var(--mat-app-label-medium-tracking))}.mdc-slider__thumb{-webkit-user-select:none;user-select:none;display:flex;left:-24px;outline:none;position:absolute;height:48px;width:48px;pointer-events:none}.mdc-slider--discrete .mdc-slider__thumb{transition:transform 80ms ease}.mdc-slider--disabled .mdc-slider__thumb{pointer-events:none}.mdc-slider__thumb--top{z-index:1}.mdc-slider__thumb-knob{position:absolute;box-sizing:border-box;left:50%;top:50%;transform:translate(-50%, -50%);border-style:solid;width:var(--mdc-slider-handle-width);height:var(--mdc-slider-handle-height);border-width:calc(var(--mdc-slider-handle-height)/2) calc(var(--mdc-slider-handle-width)/2);box-shadow:var(--mdc-slider-handle-elevation, var(--mat-app-level1));background-color:var(--mdc-slider-handle-color, var(--mat-app-primary));border-color:var(--mdc-slider-handle-color, var(--mat-app-primary));border-radius:var(--mdc-slider-handle-shape, var(--mat-app-corner-full))}.mdc-slider__thumb:hover .mdc-slider__thumb-knob{background-color:var(--mdc-slider-hover-handle-color, var(--mat-app-primary));border-color:var(--mdc-slider-hover-handle-color, var(--mat-app-primary))}.mdc-slider__thumb--focused .mdc-slider__thumb-knob{background-color:var(--mdc-slider-focus-handle-color, var(--mat-app-primary));border-color:var(--mdc-slider-focus-handle-color, var(--mat-app-primary))}.mdc-slider--disabled .mdc-slider__thumb-knob{background-color:var(--mdc-slider-disabled-handle-color, var(--mat-app-on-surface));border-color:var(--mdc-slider-disabled-handle-color, var(--mat-app-on-surface))}.mdc-slider__thumb--top .mdc-slider__thumb-knob,.mdc-slider__thumb--top.mdc-slider__thumb:hover .mdc-slider__thumb-knob,.mdc-slider__thumb--top.mdc-slider__thumb--focused .mdc-slider__thumb-knob{border:solid 1px #fff;box-sizing:content-box;border-color:var(--mdc-slider-with-overlap-handle-outline-color, var(--mat-app-on-primary));border-width:var(--mdc-slider-with-overlap-handle-outline-width)}.mdc-slider__tick-marks{align-items:center;box-sizing:border-box;display:flex;height:100%;justify-content:space-between;padding:0 1px;position:absolute;width:100%}.mdc-slider__tick-mark--active,.mdc-slider__tick-mark--inactive{width:var(--mdc-slider-with-tick-marks-container-size);height:var(--mdc-slider-with-tick-marks-container-size);border-radius:var(--mdc-slider-with-tick-marks-container-shape, var(--mat-app-corner-full))}.mdc-slider__tick-mark--inactive{opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity);background-color:var(--mdc-slider-with-tick-marks-inactive-container-color, var(--mat-app-on-surface-variant))}.mdc-slider--disabled .mdc-slider__tick-mark--inactive{opacity:var(--mdc-slider-with-tick-marks-inactive-container-opacity);background-color:var(--mdc-slider-with-tick-marks-disabled-container-color, var(--mat-app-on-surface))}.mdc-slider__tick-mark--active{opacity:var(--mdc-slider-with-tick-marks-active-container-opacity);background-color:var(--mdc-slider-with-tick-marks-active-container-color, var(--mat-app-on-primary))}.mdc-slider__input{cursor:pointer;left:2px;margin:0;height:44px;opacity:0;position:absolute;top:2px;width:44px;box-sizing:content-box}.mdc-slider__input.mat-mdc-slider-input-no-pointer-events{pointer-events:none}.mdc-slider__input.mat-slider__right-input{left:auto;right:0}.mat-mdc-slider{display:inline-block;box-sizing:border-box;outline:none;vertical-align:middle;cursor:pointer;height:48px;margin:0 8px;position:relative;touch-action:pan-y;width:auto;min-width:112px;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-slider.mdc-slider--disabled{cursor:auto;opacity:.38}.mat-mdc-slider .mdc-slider__thumb,.mat-mdc-slider .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider.mdc-slider--discrete .mdc-slider__track--active_fill{transition-duration:0ms}.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__thumb,.mat-mdc-slider.mat-mdc-slider-with-animation .mdc-slider__track--active_fill{transition-duration:80ms}.mat-mdc-slider .mat-ripple .mat-ripple-element{background-color:var(--mat-slider-ripple-color, var(--mat-app-primary))}.mat-mdc-slider .mat-ripple .mat-mdc-slider-hover-ripple{background-color:var(--mat-slider-hover-state-layer-color)}.mat-mdc-slider .mat-ripple .mat-mdc-slider-focus-ripple,.mat-mdc-slider .mat-ripple .mat-mdc-slider-active-ripple{background-color:var(--mat-slider-focus-state-layer-color)}.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__thumb,.mat-mdc-slider._mat-animation-noopable.mdc-slider--discrete .mdc-slider__track--active_fill,.mat-mdc-slider._mat-animation-noopable .mdc-slider__value-indicator{transition:none}.mat-mdc-slider .mat-mdc-focus-indicator::before{border-radius:50%}.mdc-slider__thumb--focused .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}}return r})();var kxe={provide:Yu,useExisting:Dl(()=>o1),multi:!0};var o1=(()=>{class r{get value(){return Uo(this._hostElement.value,0)}set value(e){e=isNaN(e)?0:e;let n=e+"";if(!this._hasSetInitialValue){this._initialValue=n;return}this._isActive||this._setValue(n)}_setValue(e){this._hostElement.value=e,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges(),this._slider._cdr.markForCheck()}get translateX(){return this._slider.min>=this._slider.max?(this._translateX=this._tickMarkOffset,this._translateX):(this._translateX===void 0&&(this._translateX=this._calcTranslateXByValue()),this._translateX)}set translateX(e){this._translateX=e}get min(){return Uo(this._hostElement.min,0)}set min(e){this._hostElement.min=e+"",this._cdr.detectChanges()}get max(){return Uo(this._hostElement.max,0)}set max(e){this._hostElement.max=e+"",this._cdr.detectChanges()}get step(){return Uo(this._hostElement.step,0)}set step(e){this._hostElement.step=e+"",this._cdr.detectChanges()}get disabled(){return Vi(this._hostElement.disabled)}set disabled(e){this._hostElement.disabled=e,this._cdr.detectChanges(),this._slider.disabled!==this.disabled&&(this._slider.disabled=this.disabled)}get percentage(){return this._slider.min>=this._slider.max?this._slider._isRtl?1:0:(this.value-this._slider.min)/(this._slider.max-this._slider.min)}get fillPercentage(){return this._slider._cachedWidth?this._translateX===0?0:this.translateX/this._slider._cachedWidth:this._slider._isRtl?1:0}_setIsFocused(e){this._isFocused=e}constructor(e,n,o,s){this._ngZone=e,this._elementRef=n,this._cdr=o,this._slider=s,this.valueChange=new Ke,this.dragStart=new Ke,this.dragEnd=new Ke,this.thumbPosition=tn.END,this._valuetext=K_(""),this._knobRadius=8,this._tickMarkOffset=3,this._isActive=!1,this._isFocused=!1,this._hasSetInitialValue=!1,this._destroyed=new Si,this._skipUIUpdate=!1,this._onTouchedFn=()=>{},this._isControlInitialized=!1,this._platform=ga(Bf),this._hostElement=n.nativeElement,this._ngZone.runOutsideAngular(()=>{this._hostElement.addEventListener("pointerdown",this._onPointerDown.bind(this)),this._hostElement.addEventListener("pointermove",this._onPointerMove.bind(this)),this._hostElement.addEventListener("pointerup",this._onPointerUp.bind(this))})}ngOnDestroy(){this._hostElement.removeEventListener("pointerdown",this._onPointerDown),this._hostElement.removeEventListener("pointermove",this._onPointerMove),this._hostElement.removeEventListener("pointerup",this._onPointerUp),this._destroyed.next(),this._destroyed.complete(),this.dragStart.complete(),this.dragEnd.complete()}initProps(){this._updateWidthInactive(),this.disabled!==this._slider.disabled&&(this._slider.disabled=!0),this.step=this._slider.step,this.min=this._slider.min,this.max=this._slider.max,this._initValue()}initUI(){this._updateThumbUIByValue()}_initValue(){this._hasSetInitialValue=!0,this._initialValue===void 0?this.value=this._getDefaultValue():(this._hostElement.value=this._initialValue,this._updateThumbUIByValue(),this._slider._onValueChange(this),this._cdr.detectChanges())}_getDefaultValue(){return this.min}_onBlur(){this._setIsFocused(!1),this._onTouchedFn()}_onFocus(){this._slider._setTransition(!1),this._slider._updateTrackUI(this),this._setIsFocused(!0)}_onChange(){this.valueChange.emit(this.value),this._isActive&&this._updateThumbUIByValue({withAnimation:!0})}_onInput(){this._onChangeFn?.(this.value),(this._slider.step||!this._isActive)&&this._updateThumbUIByValue({withAnimation:!0}),this._slider._onValueChange(this)}_onNgControlValueChange(){(!this._isActive||!this._isFocused)&&(this._slider._onValueChange(this),this._updateThumbUIByValue()),this._slider.disabled=this._formControl.disabled}_onPointerDown(e){if(!(this.disabled||e.button!==0)){if(this._platform.IOS){let n=this._slider._isCursorOnSliderThumb(e,this._slider._getThumb(this.thumbPosition)._hostElement.getBoundingClientRect());this._isActive=n,this._updateWidthActive(),this._slider._updateDimensions();return}this._isActive=!0,this._setIsFocused(!0),this._updateWidthActive(),this._slider._updateDimensions(),this._slider.step||this._updateThumbUIByPointerEvent(e,{withAnimation:!0}),this.disabled||(this._handleValueCorrection(e),this.dragStart.emit({source:this,parent:this._slider,value:this.value}))}}_handleValueCorrection(e){this._skipUIUpdate=!0,setTimeout(()=>{this._skipUIUpdate=!1,this._fixValue(e)},0)}_fixValue(e){let n=e.clientX-this._slider._cachedLeft,o=this._slider._cachedWidth,s=this._slider.step===0?1:this._slider.step,l=Math.floor((this._slider.max-this._slider.min)/s),h=this._slider._isRtl?1-n/o:n/o,m=Math.round(h*l)/l*(this._slider.max-this._slider.min)+this._slider.min,f=Math.round(m/s)*s,g=this.value;if(f===g){this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(e,{withAnimation:this._slider._hasAnimation});return}this.value=f,this.valueChange.emit(this.value),this._onChangeFn?.(this.value),this._slider._onValueChange(this),this._slider.step>0?this._updateThumbUIByValue():this._updateThumbUIByPointerEvent(e,{withAnimation:this._slider._hasAnimation})}_onPointerMove(e){!this._slider.step&&this._isActive&&this._updateThumbUIByPointerEvent(e)}_onPointerUp(){this._isActive&&(this._isActive=!1,this._platform.SAFARI&&this._setIsFocused(!1),this.dragEnd.emit({source:this,parent:this._slider,value:this.value}),setTimeout(()=>this._updateWidthInactive(),this._platform.IOS?10:0))}_clamp(e){let n=this._tickMarkOffset,o=this._slider._cachedWidth-this._tickMarkOffset;return Math.max(Math.min(e,o),n)}_calcTranslateXByValue(){return this._slider._isRtl?(1-this.percentage)*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset:this.percentage*(this._slider._cachedWidth-this._tickMarkOffset*2)+this._tickMarkOffset}_calcTranslateXByPointerEvent(e){return e.clientX-this._slider._cachedLeft}_updateWidthActive(){}_updateWidthInactive(){this._hostElement.style.padding=`0 ${this._slider._inputPadding}px`,this._hostElement.style.width=`calc(100% + ${this._slider._inputPadding-this._tickMarkOffset*2}px)`,this._hostElement.style.left=`-${this._slider._rippleRadius-this._tickMarkOffset}px`}_updateThumbUIByValue(e){this.translateX=this._clamp(this._calcTranslateXByValue()),this._updateThumbUI(e)}_updateThumbUIByPointerEvent(e,n){this.translateX=this._clamp(this._calcTranslateXByPointerEvent(e)),this._updateThumbUI(n)}_updateThumbUI(e){this._slider._setTransition(!!e?.withAnimation),this._slider._onTranslateXChange(this)}writeValue(e){(this._isControlInitialized||e!==null)&&(this.value=e)}registerOnChange(e){this._onChangeFn=e,this._isControlInitialized=!0}registerOnTouched(e){this._onTouchedFn=e}setDisabledState(e){this.disabled=e}focus(){this._hostElement.focus()}blur(){this._hostElement.blur()}static{this.\u0275fac=function(n){return new(n||r)(Ie(tc),Ie(ar),Ie(lr),Ie(HN))}}static{this.\u0275dir=Fi({type:r,selectors:[["input","matSliderThumb",""]],hostAttrs:["type","range",1,"mdc-slider__input"],hostVars:1,hostBindings:function(n,o){n&1&&ve("change",function(){return o._onChange()})("input",function(){return o._onInput()})("blur",function(){return o._onBlur()})("focus",function(){return o._onFocus()}),n&2&&Or("aria-valuetext",o._valuetext())},inputs:{value:[2,"value","value",Uo]},outputs:{valueChange:"valueChange",dragStart:"dragStart",dragEnd:"dragEnd"},exportAs:["matSliderThumb"],standalone:!0,features:[Xi([kxe,{provide:YQ,useExisting:r}]),$n]})}}return r})();var v_=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[ul,L1]})}}return r})();function Oxe(r){return!!r._isNoopTreeKeyManager}var pw=(()=>{class r extends lf{get tabIndexInputBinding(){return this._tabIndexInputBinding}set tabIndexInputBinding(e){this._tabIndexInputBinding=e}_getTabindexAttribute(){return Oxe(this._tree._keyManager)?this.tabIndexInputBinding:this._tabindex}get disabled(){return this.isDisabled}set disabled(e){this.isDisabled=e}constructor(e,n,o){super(e,n),this.defaultTabIndex=0,this.tabIndexInputBinding=Number(o)||this.defaultTabIndex}ngOnInit(){super.ngOnInit()}ngOnDestroy(){super.ngOnDestroy()}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(cf),Df("tabindex"))}}static{this.\u0275dir=Fi({type:r,selectors:[["mat-tree-node"]],hostAttrs:[1,"mat-tree-node"],hostVars:5,hostBindings:function(n,o){n&1&&ve("click",function(){return o._focusItem()}),n&2&&(mm("tabindex",o._getTabindexAttribute()),Or("aria-expanded",o._getAriaExpanded())("aria-level",o.level+1)("aria-posinset",o._getPositionInSet())("aria-setsize",o._getSetSize()))},inputs:{tabIndexInputBinding:[2,"tabIndex","tabIndexInputBinding",e=>e==null?0:Uo(e)],disabled:[2,"disabled","disabled",Vi]},outputs:{activation:"activation",expandedChange:"expandedChange"},exportAs:["matTreeNode"],standalone:!0,features:[Xi([{provide:lf,useExisting:r}]),$n,ll]})}}return r})(),GT=(()=>{class r extends OT{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=a0(r)))(o||r)}})()}static{this.\u0275dir=Fi({type:r,selectors:[["","matTreeNodeDef",""]],inputs:{when:[0,"matTreeNodeDefWhen","when"],data:[0,"matTreeNode","data"]},standalone:!0,features:[Xi([{provide:OT,useExisting:r}]),ll]})}}return r})(),XQ=(()=>{class r extends zN{get disabled(){return this.isDisabled}set disabled(e){this.isDisabled=e}get tabIndex(){return this.isDisabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=e}constructor(e,n,o,s){super(e,n,o)}ngOnInit(){super.ngOnInit()}ngAfterContentInit(){super.ngAfterContentInit()}ngOnDestroy(){super.ngOnDestroy()}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(cf),Ie(gx),Df("tabindex"))}}static{this.\u0275dir=Fi({type:r,selectors:[["mat-nested-tree-node"]],hostAttrs:[1,"mat-nested-tree-node"],inputs:{node:[0,"matNestedTreeNode","node"],disabled:[2,"disabled","disabled",Vi],tabIndex:[2,"tabIndex","tabIndex",e=>e==null?0:Uo(e)]},outputs:{activation:"activation",expandedChange:"expandedChange"},exportAs:["matNestedTreeNode"],standalone:!0,features:[Xi([{provide:zN,useExisting:r},{provide:lf,useExisting:r},{provide:cC,useExisting:r}]),$n,ll]})}}return r})(),KQ=(()=>{class r extends $N{get level(){return this._level}set level(e){this._setLevelInput(e)}get indent(){return this._indent}set indent(e){this._setIndentInput(e)}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=a0(r)))(o||r)}})()}static{this.\u0275dir=Fi({type:r,selectors:[["","matTreeNodePadding",""]],inputs:{level:[2,"matTreeNodePadding","level",Uo],indent:[0,"matTreeNodePaddingIndent","indent"]},standalone:!0,features:[Xi([{provide:$N,useExisting:r}]),$n,ll]})}}return r})(),DT=(()=>{class r{constructor(e,n){this.viewContainer=e,this._node=n}static{this.\u0275fac=function(n){return new(n||r)(Ie(Mh),Ie(cC,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matTreeNodeOutlet",""]],standalone:!0,features:[Xi([{provide:lC,useExisting:r}])]})}}return r})(),jT=(()=>{class r extends cf{constructor(){super(...arguments),this._nodeOutlet=void 0}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=a0(r)))(o||r)}})()}static{this.\u0275cmp=nt({type:r,selectors:[["mat-tree"]],viewQuery:function(n,o){if(n&1&&Ir(DT,7),n&2){let s;bi(s=wi())&&(o._nodeOutlet=s.first)}},hostAttrs:[1,"mat-tree"],exportAs:["matTree"],standalone:!0,features:[Xi([{provide:cf,useExisting:r}]),ll,lt],decls:1,vars:0,consts:[["matTreeNodeOutlet",""]],template:function(n,o){n&1&&ic(0,0)},dependencies:[DT],styles:[".mat-tree{display:block;background-color:var(--mat-tree-container-background-color, var(--mat-app-surface))}.mat-tree-node,.mat-nested-tree-node{color:var(--mat-tree-node-text-color, var(--mat-app-on-surface));font-family:var(--mat-tree-node-text-font, var(--mat-app-body-large-font));font-size:var(--mat-tree-node-text-size, var(--mat-app-body-large-size));font-weight:var(--mat-tree-node-text-weight, var(--mat-app-body-large-weight))}.mat-tree-node{display:flex;align-items:center;flex:1;word-wrap:break-word;min-height:var(--mat-tree-node-min-height)}.mat-nested-tree-node{border-bottom-width:0}"],encapsulation:2})}}return r})(),VT=(()=>{class r extends WN{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=a0(r)))(o||r)}})()}static{this.\u0275dir=Fi({type:r,selectors:[["","matTreeNodeToggle",""]],inputs:{recursive:[0,"matTreeNodeToggleRecursive","recursive"]},standalone:!0,features:[Xi([{provide:WN,useExisting:r}]),ll]})}}return r})();var UT=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[qQ,ul,ul]})}}return r})(),RT=class{constructor(i,e,n,o){this.transformFunction=i,this.getLevel=e,this.isExpandable=n,this.getChildren=o}_flattenNode(i,e,n,o){let s=this.transformFunction(i,e);if(n.push(s),this.isExpandable(s)){let l=this.getChildren(i);l&&(Array.isArray(l)?this._flattenChildren(l,e,n,o):l.pipe(Ol(1)).subscribe(h=>{this._flattenChildren(h,e,n,o)}))}return n}_flattenChildren(i,e,n,o){i.forEach((s,l)=>{let h=o.slice();h.push(l!=i.length-1),this._flattenNode(s,e+1,n,h)})}flattenNodes(i){let e=[];return i.forEach(n=>this._flattenNode(n,0,e,[])),e}expandFlattenedNodes(i,e){let n=[],o=[];return o[0]=!0,i.forEach(s=>{let l=!0;for(let h=0;h<=this.getLevel(s);h++)l=l&&o[h];l&&n.push(s),this.isExpandable(s)&&(o[this.getLevel(s)+1]=e.isExpanded(s))}),n}},NT=class extends ZF{get data(){return this._data.value}set data(i){this._data.next(i),this._flattenedData.next(this._treeFlattener.flattenNodes(this.data)),this._treeControl.dataNodes=this._flattenedData.value}constructor(i,e,n){super(),this._treeControl=i,this._treeFlattener=e,this._flattenedData=new ut([]),this._expandedData=new ut([]),this._data=new ut([]),n&&(this.data=n)}connect(i){return Fs(i.viewChange,this._treeControl.expansionModel.changed,this._flattenedData).pipe(Nt(()=>(this._expandedData.next(this._treeFlattener.expandFlattenedNodes(this._flattenedData.value,this._treeControl)),this._expandedData.value)))}disconnect(){}},BT=class extends ZF{constructor(){super(...arguments),this._data=new ut([])}get data(){return this._data.value}set data(i){this._data.next(i)}connect(i){return Fs(i.viewChange,this._data).pipe(Nt(()=>this.data))}disconnect(){}};var JQ=(()=>{class r{elementRef;renderer;draggedNode;dropNodeTarget;expandTimeout;nodesListeners;dropLineTarget;highlightedNode=new Eh;treeControl;maxLevel=5;set treeDragDropIsDisabled(e){this.isDisabled=e,e?this.removeAllListener():this.addAllListener()}isDisabled=!1;dragStart=new Ke;onDrop=new Ke(null);onDropError=new Ke;hostDragOver(e){e.preventDefault()}hostDrop(e){this.drop(e)}dragging;nodes;constructor(e,n){this.elementRef=e,this.renderer=n,this.onDrop.subscribe(()=>this.dragEnd()),this.highlightedNode.changed.subscribe(o=>{o.removed.length&&this.removeNodeClass(o.removed[0].id,"--drag-hover"),o.added.length&&this.addNodeClass(o.added[0].id,"--drag-hover")})}ngAfterContentInit(){this.nodes.changes.subscribe(()=>{this.addAllListener()})}ngOnDestroy(){this.removeAllListener()}onDragStart(e){this.dragging=!0,this.draggedNode=e,this.addNodeClass(e.id,"--dragged"),this.dragStart.emit(e)}dragEnd(){this.dragging=!1,this.draggedNode&&(this.removeNodeClass(this.draggedNode.id,"--dragged"),this.draggedNode=null),this.dragLeave(),this.removeDropTargetLine()}dragOver(e,n){n.preventDefault(),n.stopPropagation(),this.dropNodeTarget=e;let o=this.getPosition(n,e);this.updateDropTargetLinePosition(o),this.setHighlightedNode(e),this.handleGroupExpansion(e,o.type==="inside")}dragLeave(){clearTimeout(this.expandTimeout),this.expandTimeout=null,this.highlightedNode.clear()}drop(e){if(!this.dropNodeTarget||this.isDisabled)return;let n=this.getPosition(e,this.dropNodeTarget),o=this.canDropNode(this.dropNodeTarget,n);if(!o.canDrop){this.onDropError.emit(o);return}if(n.type==="below"&&n.level!==this.dropNodeTarget.level&&(this.dropNodeTarget=this.getNodeAncestors(this.dropNodeTarget.id,n.level)),this.dropNodeTarget.isGroup&&n.type==="inside")return this.treeControl.isExpanded(this.dropNodeTarget)&&this.getDirectDescendants(this.dropNodeTarget)[0]?.id===this.draggedNode.id?void 0:(this.treeControl.expand(this.dropNodeTarget),this.onDrop.emit({node:this.draggedNode,ref:this.dropNodeTarget,position:n.type}));if(n.type==="below"&&n.level!==this.dropNodeTarget.level){let s=this.getNodeAncestors(this.dropNodeTarget.id);return this.onDrop.emit({node:this.draggedNode,ref:s,position:n.type})}this.onDrop.emit({node:this.draggedNode,ref:this.dropNodeTarget,position:n.type})}addNodeClass(e,n){let o=this.nodes.find(s=>s.data.id===e);this.renderer.addClass(o._elementRef.nativeElement,n)}removeNodeClass(e,n){let o=this.nodes.find(s=>s.data.id===e);this.renderer.removeClass(o._elementRef.nativeElement,n)}addAllListener(){if(this.isDisabled)return;let e=this.nodes?.toArray();this.nodesListeners&&this.removeAllListener(),this.nodesListeners=e?.map(n=>this.addListener(n))}addListener(e){let n=e._elementRef.nativeElement,o=[["dragstart",()=>this.onDragStart(e.data)],["dragend",()=>this.dragEnd()],["dragover",s=>this.dragOver(e.data,s)],["dragleave",()=>this.dragLeave()]];return n.setAttribute("draggable","true"),o.forEach(([s,l])=>n.addEventListener(s,l)),{element:n,listeners:o}}removeAllListener(){this.nodesListeners?.forEach(({element:e,listeners:n})=>{n.forEach(([o,s])=>{e.setAttribute("draggable","false"),e.removeEventListener(o,s)})}),this.nodesListeners=null}setHighlightedNode(e){let n=e.isGroup?e:this.getNodeAncestors(e.id);n?this.highlightedNode.select(n):this.highlightedNode.clear()}addDropTargetLine(){let e=this.renderer.createElement("div");e.classList.add("drop-target-line"),e.setAttribute("style","position: absolute; top: 0; width: 100%; pointer-events: none; z-index: 4; height: 2px; background-color: black; transition: margin-left 150ms;"),this.dropLineTarget=e,this.renderer.appendChild(this.elementRef.nativeElement.parentElement,this.dropLineTarget)}removeDropTargetLine(){this.dropLineTarget&&(this.renderer.removeChild(this.elementRef.nativeElement.parentElement,this.dropLineTarget),this.dropLineTarget=null)}updateDropTargetLinePosition(e){if(this.dropLineTarget||this.addDropTargetLine(),e.type==="inside")return this.removeDropTargetLine();this.renderer.setStyle(this.dropLineTarget,"margin-left",e.level*24+20+"px"),this.renderer.setStyle(this.dropLineTarget,"transform","translate3d(0,"+e.y+"px, 0)")}handleGroupExpansion(e,n){if(!n)return this.dragLeave();!this.treeControl.isExpanded(e)&&!this.expandTimeout&&(this.expandTimeout=window.setTimeout(()=>{this.treeControl.expand(e)},1200))}getNodeElement(e){return this.nodes.find(o=>o.data.id===e.id)?._elementRef.nativeElement}canDropNode(e,n){if(this.draggedNode.isGroup)return this.canDropGroup(e,n);let o=this.validateMaxHierarchyLevel(n);return o||{canDrop:!0}}canDropGroup(e,n){if(e.id===this.draggedNode.id)return{canDrop:!1,message:"igo.common.dragDrop.cannot.dropInsideItself"};let o=this.validateMaxHierarchyLevel(n);if(o)return o;let s=this.isHoverDescendant(e.id);return{canDrop:!s,message:s&&"igo.common.dragDrop.cannot.dropInsideItself"}}validateMaxHierarchyLevel(e){if(!this.maxLevel)return;let n=e.type==="inside"?e.level+1:e.level;if(this.draggedNode.isGroup&&(n=n+(this.draggedNode.descendantLevels??0)+1),n>this.maxLevel)return{canDrop:!1,message:"igo.common.dragDrop.cannot.maxLevel",params:{value:this.maxLevel}}}isHoverDescendant(e){return this.treeControl.getDescendants(this.draggedNode).some(n=>n.id===e)}getPosition(e,n){this.draggedNode.isGroup&&this.isHoverDescendant(n.id)&&(n=this.draggedNode);let o=this.getPositionType(e,n);return n.isGroup&&o==="below"&&this.treeControl.isExpanded(n)&&(o="inside"),{x:e.x,y:this.getPositionY(n,o),level:this.getPositionLevel(n,o,e.x),type:o}}getPositionY(e,n){let o=this.getNodeElement(e),s=o.getBoundingClientRect();return n==="below"?o.offsetTop+s.height-1:o.offsetTop+1}getPositionType(e,n){let s=this.getNodeElement(n).getBoundingClientRect(),l=s.top+s.height/2,h=e.y,p=this.draggedNode.id===n.id;return n.isGroup&&!p&&h<=l+5&&h>=l-5?"inside":h>l?"below":"above"}getPositionLevel(e,n,o){if(e.level===0)return 0;let s=this.getNodeAncestors(e.id),h=[...this.getDirectDescendants(s)].pop();if(n==="below"&&h.id===e.id){let m=this.getNodeElement(e).getBoundingClientRect(),f=24,y=m.x+f+f*e.level;if(!(o>y)){let w=Math.round((y-o)/f);return Math.max(0,e.level-w)}}return e.level}getNodeAncestors(e,n){let o=this.treeControl.dataNodes,s=o.findIndex(h=>h.id===e),l=n??Math.max(0,o[s].level-1);return o.slice(0,s).reverse().find(h=>h.level===l)}getDirectDescendants(e){let n=e.level+1;return this.treeControl.getDescendants(e).filter(o=>o.level===n)}static \u0275fac=function(n){return new(n||r)(Ie(ar),Ie(s0))};static \u0275dir=Fi({type:r,selectors:[["","igoTreeDragDrop",""]],contentQueries:function(n,o,s){if(n&1&&Do(s,pw,5),n&2){let l;bi(l=wi())&&(o.nodes=l)}},hostVars:2,hostBindings:function(n,o){n&1&&ve("dragover",function(l){return o.hostDragOver(l)})("drop",function(l){return o.hostDrop(l)}),n&2&&dr("--dragging",o.dragging)},inputs:{treeControl:"treeControl",maxLevel:"maxLevel",treeDragDropIsDisabled:[2,"treeDragDropIsDisabled","treeDragDropIsDisabled",Vi]},outputs:{dragStart:"dragStart",onDrop:"onDrop",onDropError:"onDropError"},standalone:!0,features:[$n]})}return r})();function Dxe(r,i){if(r&1){let e=We();$(0,"mat-tree-node")(1,"igo-layer-item",3),ve("action",function(o){we(e);let s=ne();return xe(s.toggleActive(o))})("selectChange",function(o){let s=we(e).$implicit,l=ne();return xe(l.handleSelect(o,s.data))}),ee()()}if(r&2){let e=i.$implicit,n=ne();dr("--selected",n.isSelected(e.data))("--children-selected",n.isDescendantSelection(e.data)),j(),z("matTreeNodePadding",e.level===0?1:e.level)("matTreeNodePaddingIndent",e.level===0?16:24+16/e.level)("layer",e.data)("visible",e.data.visible)("viewerOptions",n.viewerOptions)("selected",n.isSelected(e.data)||n.isDescendantSelection(e.data))("selectionDisabled",n.isDescendantSelection(e.data))}}function Rxe(r,i){if(r&1){let e=We();$(0,"mat-tree-node")(1,"igo-layer-group",4),ve("action",function(o){we(e);let s=ne();return xe(s.toggleActive(o))})("expand",function(){let o=we(e).$implicit,s=ne();return s.treeControl.toggle(o),xe(s.handleNodeToggle(o))})("selectChange",function(o){let s=we(e).$implicit,l=ne();return xe(l.handleSelect(o,s.data))}),$(2,"button",5),ve("click",function(){let o=we(e).$implicit,s=ne();return xe(s.handleNodeToggle(o))}),$(3,"mat-icon",6),_e(4),ee()()()()}if(r&2){let e=i.$implicit,n=ne();dr("--selected",n.isSelected(e.data))("--children-selected",n.isDescendantSelection(e.data)),j(),z("matTreeNodePaddingIndent",24)("layer",e.data)("viewerOptions",n.viewerOptions)("selected",n.isSelected(e.data)||n.isDescendantSelection(e.data))("selectionDisabled",n.isDescendantSelection(e.data)),j(),Or("aria-label","Toggle "+e.data.title),j(2),Qe(" ",n.treeControl.isExpanded(e)?"keyboard_arrow_down":"keyboard_arrow_right"," ")}}var YN=(()=>{class r{messageService;toggleOpacity=!1;isInit;controller;set layers(e){this._layers=e,this.updateDatasource(e??[])}get layers(){return this._layers}_layers;isDesktop;isDragDropDisabled;selectAll;viewerOptions;activeChange=new Ke;_transformer=(e,n)=>({id:e.id||e.options.name,isGroup:!!An(e),descendantLevels:An(e)?e.descendantsLevel:void 0,level:n,data:e,disabled:!1});treeControl=new LT(e=>e.level,e=>e.isGroup);treeFlattener=new RT(this._transformer,e=>e.level,e=>e.isGroup,e=>e.children.filter(n=>n.showInLayerList).sort((n,o)=>n.zIndex+o.zIndex));dataSource;constructor(e){this.messageService=e,this.dataSource=new NT(this.treeControl,this.treeFlattener,[])}isGroup=(e,n)=>n.isGroup;isLayerGroup=An;isLayerItem=jn;isSelected=e=>this.controller.isSelected(e);isDescendantSelection=e=>this.controller.isDescendantSelection(e);toggleActive(e){let n=this.controller.isSelected(e);this.controller.clearSelection(),n||this.controller.select(e),this.activeChange.emit(e)}handleSelect(e,n){e?this.controller.select(n):this.controller.deselect(n)}getLayerType(e){return e.type==="raster"?"raster":e.id.includes("measure")?"measure":e.id.includes("draw")?"draw":"vector"}getLayerIcon(e){let n=this.getLayerType(e);return n==="raster"?e.baseLayer?"wallpaper":"image":n==="measure"?"square_foot":n==="draw"?"draw":FG}dropNode({node:e,ref:n,position:o}){let s=[e.data];switch(this.controller.hasSelection&&(s=this.controller.selected.filter(l=>!!this.findNodeByLayerId(l.id))),e.isGroup&&(s=s.filter(l=>!e.data.isDescendant(l))),n.isGroup&&s.some(h=>h.id===n.id)&&(s=s.filter(h=>h.id!==n.id)),s.includes(e.data)||s.push(e.data),o){case"above":this.controller.moveAbove(n.data,...s);break;case"inside":this.controller.moveInside(n.data,...s);break;default:this.controller.moveBelow(n.data,...s);break}}dropNodeError(e){this.messageService.alert(e.message,"igo.geo.layer.layer",null,e.params)}dragStart(){this.viewerOptions.mode!=="selection"&&this.controller.clearSelection()}handleNodeToggle(e){e.data.expanded=this.treeControl.isExpanded(e)}findNodeByLayerId(e){return this.treeControl.dataNodes.find(n=>n.id===e)}updateDatasource(e){let n=this.treeControl.expansionModel;this.dataSource.data=e,this.isInit?this.restoreModel(n,o=>this.treeControl.expand(o)):this.expandGroup(e),!this.isInit&&e.length&&(this.isInit=!0)}expandGroup(e){e.forEach(n=>{if(An(n)){if(n.expanded){let o=this.findNodeByLayerId(n.id);if(!o)return;this.treeControl.expand(o)}this.expandGroup(n.children)}})}restoreModel(e,n){let o=Array.from(e._selection).map(s=>s.id);e.clear(),this.treeControl.dataNodes.forEach(s=>{(e.isSelected(s)||o.includes(s.id))&&n(s)})}static \u0275fac=function(n){return new(n||r)(Ie(Gn))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-list"]],inputs:{controller:"controller",layers:"layers",isDesktop:"isDesktop",isDragDropDisabled:"isDragDropDisabled",selectAll:"selectAll",viewerOptions:"viewerOptions"},outputs:{activeChange:"activeChange"},standalone:!0,features:[lt],decls:3,vars:7,consts:[["igoTreeDragDrop","",3,"dragStart","onDrop","onDropError","treeDragDropIsDisabled","maxLevel","dataSource","treeControl"],[3,"--selected","--children-selected",4,"matTreeNodeDef"],[3,"--selected","--children-selected",4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"tree-node-item",3,"action","selectChange","matTreeNodePadding","matTreeNodePaddingIndent","layer","visible","viewerOptions","selected","selectionDisabled"],["matTreeNodePadding","",1,"tree-node-item",3,"action","expand","selectChange","matTreeNodePaddingIndent","layer","viewerOptions","selected","selectionDisabled"],["mat-icon-button","","matTreeNodeToggle","",1,"layer-indicator",3,"click"],[1,"mat-icon-rtl-mirror"]],template:function(n,o){n&1&&($(0,"mat-tree",0),ve("dragStart",function(){return o.dragStart()})("onDrop",function(l){return o.dropNode(l)})("onDropError",function(l){return o.dropNodeError(l)}),Pe(1,Dxe,2,11,"mat-tree-node",1)(2,Rxe,5,11,"mat-tree-node",2),ee()),n&2&&(dr("--not-desktop",!o.isDesktop),z("treeDragDropIsDisabled",o.isDragDropDisabled)("maxLevel",o.viewerOptions==null||o.viewerOptions.group==null?null:o.viewerOptions.group.maxHierarchyLevel)("dataSource",o.dataSource)("treeControl",o.treeControl),j(2),z("matTreeNodeDefWhen",o.isGroup))},dependencies:[Sn,xl,Vt,ci,hl,dl,jt,$t,ym,v_,UT,GT,KQ,VT,jT,pw,Qt,JQ,A6,O6,Et],styles:[`.--not-desktop[_ngcontent-%COMP%]   igo-layer-group[_ngcontent-%COMP%]     .list-secondary-actions button, .--not-desktop[_ngcontent-%COMP%]   igo-layer-item[_ngcontent-%COMP%]     .list-secondary-actions button{visibility:visible!important}.tree-node-item[_ngcontent-%COMP%]{flex:1}mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:40px}mat-tree-node[_ngcontent-%COMP%]:hover:after, mat-tree-node.--drag-hover[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;border-style:solid;border-width:1px;border-color:transparent;pointer-events:none}
/*# sourceMappingURL=layer-list.component-XGA7UGQW.css.map */`],changeDetection:0})}return r})();var ZN=(()=>{class r{layerOptions;remove=new Ke;get title(){let e=this.layerOptions.sourceOptions;return this.layerOptions.title??e?.params?.LAYERS??e?.params?.layers??e?.layer}handleRemove(e){this.remove.emit(e)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-layer-unavailable"]],inputs:{layerOptions:"layerOptions"},outputs:{remove:"remove"},standalone:!0,features:[lt],decls:13,vars:8,consts:[["mat-icon-button","","disabled","",1,"layer-indicator"],["aria-hidden","false","color","warn"],["matListItemTitle","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip"],["matListItemMeta",""],["tooltip-position","below","matTooltipShowDelay","500",1,"align-disabled-button-with-tooltip",3,"matTooltip"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip"],["aria-hidden","false"]],template:function(n,o){n&1&&($(0,"mat-list-item")(1,"button",0)(2,"mat-icon",1),_e(3,"warning"),ee()(),$(4,"span",2),_e(5),ee(),$(6,"div",3),ct(7,"div",4),le(8,"translate"),$(9,"button",5),le(10,"translate"),ve("click",function(){return o.handleRemove(o.layerOptions)}),$(11,"mat-icon",6),_e(12,"delete"),ee()()()()),n&2&&(j(4),z("matTooltip",o.title),j(),Qe(" ",o.title," "),j(2),z("matTooltip",ce(8,4,"igo.geo.layer.unavailableLayer")),j(2),z("matTooltip",ce(10,6,"igo.geo.layer.deleteLayer")))},dependencies:[Io,ks,Ta,Ju,jt,$t,Qt,ti,Et,Tt],styles:[`[_nghost-%COMP%]   mat-list-item[_ngcontent-%COMP%]{padding-left:1px}[_nghost-%COMP%]     .mdc-list-item__content{display:flex;align-items:center;flex-direction:row-reverse;justify-content:flex-end}[_nghost-%COMP%]     .mat-mdc-list-item-title{font-size:12px!important}[_nghost-%COMP%]     .mdc-list-item__end{margin-left:8px;margin-right:4px}.align-disabled-button-with-tooltip[_ngcontent-%COMP%]{display:inline-block}
/*# sourceMappingURL=layer-unavailable.component-WQKRWKC7.css.map */`],changeDetection:0})}return r})();var b_="Layer";var zT=class{selection=new Eh(!0);descendantSelection=new Eh(!0);get selected(){return this.selection.selected}get hasSelection(){return this.selection.hasValue()}get isSelectionEmpty(){return this.selection.isEmpty()}clearSelection(){this.selection.clear(),this.descendantSelection.clear()}select(...i){this.selection.select(...i),this.descendantSelection.select(...this.getDescendants(...i))}deselect(...i){this.selection.deselect(...i),this.descendantSelection.deselect(...this.getDescendants(...i))}isSelected=i=>this.selection.isSelected(i);isDescendantSelection=i=>this.descendantSelection.isSelected(i);getDescendants(...i){return i.reduce((e,n)=>An(n)?e.concat(n.descendants):e,[])}};var XN=10,$T=class extends zT{_map;tree;_systemLayers=[];_otherLayers=[];layersFlattened=[];_layers$=new ut(void 0);layers$=this._layers$.asObservable();layersFlattened$=this._layers$.asObservable().pipe(Nt(()=>this.layersFlattened));_baseLayers=[];_baseLayers$=new ut(void 0);baseLayers$=this._baseLayers$.asObservable();baseLayerSelection;all$;constructor(i,e){super(),this._map=i,this.all$=Ts([this.layersFlattened$,this.baseLayers$]).pipe(Br(10),Nt(()=>this.all)),this.tree=new MG(e,{getChildren:n=>An(n)&&n.children,getId:n=>n.id,getLevel:n=>n.zIndex,reverse:!0})}get all(){return[...this.baseLayers,...this.layersFlattened,...this._systemLayers,...this._otherLayers]}get baseLayers(){return this._baseLayers}get baseLayer(){return this.baseLayers.find(i=>i.visible)}get treeLayers(){return this.tree.data}add(...i){let n=i.map(o=>this.handleAdd(o,0)).filter(Boolean);if(!n.length){this.notify();return}this.tree.add(...n),this.layersFlattened=[...this.tree.flattened],n.forEach(o=>o.add()),this.recalculateZindex(),this.notify()}selectBaseLayer(i){cd(i)&&(this.baseLayerSelection&&(this.baseLayerSelection.visible=!1),i.visible=!0,this.baseLayerSelection=i,this._map.viewController.olView.setMinZoom(i.dataSource.options.minZoom||(this._map.options.view||{}).minZoom),this._map.viewController.olView.setMaxZoom(i.dataSource.options.maxZoom||(this._map.options.view||{}).maxZoom))}remove(...i){let e=i.reduce((n,o)=>{this.isSelected(o)&&this.deselect(o);let s=this._remove(o);return Array.isArray(s)?n.push(...s):n.push(s),n},[]);this.tree.remove(...e),this.notify()}moveTo(i,...e){let n=this.tree.moveTo(i,...e);if(n?.length)return n}moveBelow(i,...e){let n=this.getPosition(i,"below"),o=this.moveTo(n,...e);this.handleMove(o,i.parent)}moveAbove(i,...e){let n=this.getPosition(i),o=this.moveTo(n,...e);this.handleMove(o,i.parent)}moveInside(i,...e){let n=this.getPosition(i),o=this.moveTo(n.concat(0),...e);this.handleMove(o,i)}raise(...i){let e=this.getPosition(i[0]),n=this.findLowestVisiblePostion(e,-1);this.moveTo(n,...i),this.handleMove(i,null,!0)}lower(...i){let e=this.getPosition(i[i.length-1]),n=this.findLowestVisiblePostion(e,2);this.moveTo(n,...i),this.handleMove(i,null,!0)}reset(){this.clearBaselayers(),this.clearTree(),this.clearOther(),this.clearSelection(),this.notify()}getById(i){return this.all.find(e=>e.id&&e.id===i)}getBySourceId(i){return this.all.find(e=>e.dataSource?.id&&e.dataSource.id===i)}getPosition(i,e="above"){let n=this.tree.getPosition(i);if(e==="below"){let o=n.pop();return n.concat(++o)}return n}getLayerRecipient(i){return i.parent?this.tree.getChildren(i.parent):[...this.treeLayers]}findLowestVisiblePostion(i,e){let n=i.pop(),o=i.concat(n+e),s=this.tree.getNodeByPosition(o);if(s&&!s.showInLayerList){let l=e>1?1:e;return this.findLowestVisiblePostion(o,l)}return o}handleMove(i,e,n){i?.length&&(i.forEach(o=>{o.moveTo(n?o.parent:e)}),this._internalMove())}_internalMove(){this.recalculateZindex(),this.notify()}getBefore(i){return this.treeLayers.find(e=>e.zIndex<=i.zIndex)}recalculateZindex(i=this.baseLayers.length,e=this.treeLayers){return[...e].reverse().reduce((n,o)=>{let s=++n;return o.zIndex=s,An(o)&&(s=this.recalculateZindex(s,o.children)),s},i)}handleAdd(i,e){let n=this.getById(i.id);if(n!==void 0){n.visible=!0;return}let o=this.getZindexOffset(i,e);if(this.setZindex(i,o),i.init(this._map),cd(i))i.visible&&this.selectBaseLayer(i),this._baseLayers.push(i);else if(this.isOtherLayer(i))this._otherLayers.push(i);else if(this.isSystemLayer(i)&&!i.showInLayerList)this._systemLayers.push(i);else{if(i.showInLayerList)return i;this._otherLayers.push(i)}let s=i.parentId?this.getById(i.parentId.split(AG).pop()):void 0;i.add(s)}_remove(i){return cd(i)?this.removeBaselayer(i):this.isOtherLayer(i)?this.removeOtherLayer(i):this.isSystemLayer(i)&&this.removeSystemLayer(i),i.remove(),i}removeBaselayer(i){this.removeIn(i,this._baseLayers)}removeSystemLayer(i){this.removeIn(i,this._systemLayers)}removeOtherLayer(i){this.removeIn(i,this._otherLayers)}removeIn(i,e){let n=e.findIndex(o=>o.id===i.id);n!==-1&&e.splice(n,1)}isSystemLayer(i){return jn(i)&&i.isIgoInternalLayer}isOtherLayer(i){return kp(i)&&!i.showInLayerList}clearBaselayers(){this.baseLayers.forEach(i=>this._remove(i)),this._baseLayers=[]}clearTree(){this.treeLayers.forEach(i=>this._remove(i)),this.tree.clear()}clearSystems(){this._systemLayers.forEach(i=>this._remove(i)),this._systemLayers=[]}clearOther(){this._otherLayers.forEach(i=>this._remove(i)),this._otherLayers=[]}getZindexOffset(i,e=0){return i.zIndex?0:e++}setZindex(i,e){if(cd(i))return this.handleBaselayerZIndex(i,e);if(i.zIndex===void 0||i.zIndex===0){let n=Math.max(XN,...this.treeLayers.map(o=>o.zIndex));i.zIndex=n+1+(e??0)}}handleBaselayerZIndex(i,e){let o=Math.max(0,...this.baseLayers.map(s=>s.zIndex))+1+(e??0);i.zIndex=o>XN?XN:o}notify(){this.layersFlattened=[...this.tree.flattened],this._layers$.next([...this.treeLayers]),this._baseLayers$.next([...this.baseLayers])}};function Nxe(r,i){if(r&1){let e=We();$(0,"igo-layer-unavailable",2),ve("remove",function(o){we(e);let s=ne();return xe(s.deleteUnavailableLayer(o))}),ee()}if(r&2){let e=i.$implicit;z("layerOptions",e)}}var KN=(()=>{class r{layerService;layersOptions;constructor(e){this.layerService=e}deleteUnavailableLayer(e){this.layerService.deleteUnavailableLayers(e)}static \u0275fac=function(n){return new(n||r)(Ie(Za))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-unavailable-list"]],inputs:{layersOptions:"layersOptions"},standalone:!0,features:[lt],decls:2,vars:3,consts:[[3,"navigation","selection"],["igoListItem","",3,"layerOptions","remove",4,"ngFor","ngForOf"],["igoListItem","",3,"remove","layerOptions"]],template:function(n,o){n&1&&($(0,"igo-list",0),Pe(1,Nxe,1,1,"igo-layer-unavailable",1),ee()),n&2&&(z("navigation",!1)("selection",!1),j(),z("ngForOf",o.layersOptions))},dependencies:[Li,yc,Qo,ZN],styles:[`igo-list[_ngcontent-%COMP%]{height:auto}igo-list[_ngcontent-%COMP%]     mat-list{padding-bottom:0}
/*# sourceMappingURL=layer-unavailable-list.component-BR23H436.css.map */`],changeDetection:0})}return r})();var Bxe=["*"];function Gxe(r,i){if(r&1){let e=We();$(0,"button",13),le(1,"translate"),le(2,"translate"),le(3,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.removeLayers())}),$(4,"mat-icon",8),_e(5,"delete"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(3,7,e.hasMultipleSelection?e.isLayersRemovable(e.selected)?ce(1,3,"igo.geo.layer.removeSelectedLayers"):ce(2,5,"igo.geo.layer.removeSelectedLayersRestriction"):"igo.geo.layer.removeLayer")),j(4),z("matBadge","!")("matBadgeHidden",!e.hasMultipleSelection||e.isLayersRemovable(e.selected))}}function jxe(r,i){if(r&1){let e=We();$(0,"button",14),le(1,"translate"),le(2,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.toggleSelectionVisibility())}),$(3,"mat-icon"),_e(4),ee()()}if(r&2){let e=ne();z("disabled",e.selected.length===0)("matTooltip",e.allSelectionVisibilityHidden?ce(1,3,"igo.geo.layer.showSelectedLayers"):ce(2,5,"igo.geo.layer.hideSelectedLayers")),j(4),bt(e.allSelectionVisibilityHidden?"visibility_off":"visibility")}}function Vxe(r,i){if(r&1){let e=We();Dr(0),$(1,"button",15),le(2,"translate"),$(3,"mat-icon",16),_e(4,"opacity"),ee()(),$(5,"mat-menu",17,0)(7,"mat-slider",18,1),le(9,"translate"),ve("click",function(o){return we(e),xe(o.stopPropagation())}),$(10,"input",19,2),ve("input",function(){we(e);let o=Xt(8),s=Xt(11),l=ne();return xe(l.changeOpacity({source:s,parent:o,value:s.value}))}),ee()()(),Rr()}if(r&2){let e=Xt(6),n=ne();j(),z("matMenuTriggerFor",e)("matTooltip",ce(2,7,"igo.geo.layer.opacity")),j(2),z("matBadge",n.opacity===100?null:n.opacity),j(4),z("min",0)("max",100)("matTooltip",ce(9,9,"igo.geo.layer.opacity")),j(3),z("value",n.opacity)}}function Uxe(r,i){if(r&1){let e=We();$(0,"button",20),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.zoomLayersExtents())}),$(2,"mat-icon",21),_e(3,"frame_inspect"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,1,e.hasMultipleSelection?"igo.geo.layer.zoomLayers":"igo.geo.layer.zoomLayer"))}}function zxe(r,i){if(r&1){let e=We();$(0,"button",22),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.handleRename())}),$(2,"mat-icon"),_e(3,"edit"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.layer.group.rename"))}var QN=(()=>{class r{layerListToolService;orderable=!0;map;controller;searchTerm;viewerOptions;layerChange=new Ke;get layersFlattened(){return this.controller.layersFlattened}get hasMultipleSelection(){return this.controller.selected.length>1}get selected(){return this.controller.selected}get opacity(){return Math.round(this.selected[0].opacity*100)}set opacity(e){this.selected[0].opacity=e/100}get allSelectionVisibilityHidden(){return this.controller.selected.every(e=>!e.visible)}get isSelectionRaisable(){return this.controller.selected.every(e=>this.isRaisable(e))}get isSelectionLowerable(){return this.controller.selected.every(e=>this.isLowerable(e))}get canRename(){if(!this.viewerOptions.group.canRename||this.selected.length>1)return!1;let e=this.selected[0];return An(e)}constructor(e){this.layerListToolService=e}isLayerItem=jn;handleRename(){let e=this.selected[0];this.layerListToolService.renameGroup(e).subscribe(n=>{n&&(e.title=n,this.layerChange.emit())})}isLayersRemovable(e){return e.length===1?this.isLayerRemovable(e[0]):e?.every(n=>this.isLayerRemovable(n))}removeLayers(){this.controller.remove(...this.selected),this.controller.clearSelection()}isExtentsValid(){let e=!1,n=Wn(),o=this.map.viewController.maxLayerZoomExtent;if(this.selected.some(s=>jn(s)&&s.options.showButtonZoomToExtent===!1))return!1;for(let s of this.selected){let l=s.options.extent;l&&!l.includes(1/0)&&Hd(n,l)}return nd(n)||(o?e=Pa(o,n):e=!0),e}zoomLayersExtents(){let e=Wn();for(let n of this.selected){let o=n.options.extent;o&&Hd(e,o)}this.map.viewController.zoomToExtent(e)}raiseSelection(){this.map.layerController.raise(...this.selected)}lowerSelection(){this.map.layerController.lower(...this.selected)}changeOpacity(e){this.opacity=e.value}toggleSelectionVisibility(e=this.selected,n=this.allSelectionVisibilityHidden){e.forEach(o=>{o.visible=n,An(o)&&this.toggleSelectionVisibility(o.children,n)}),this.layerChange.emit()}isLowerable(e){if(cd(e))return!1;let n=this.getRecipientOfVisibleLayer(e),o=n.findIndex(s=>s.id===e.id);if(o>=n.length-1)return!1;if(kp(e)){let s=n[o+1];return!q4(e,s,this.controller.layersFlattened,_n.ZINDEX)}return!0}isRaisable(e){if(cd(e))return!1;let n=this.getRecipientOfVisibleLayer(e),o=n.findIndex(s=>s.id===e.id);if(o<=0)return!1;if(kp(e)){let s=n[o-1];return!q4(e,s,this.controller.layersFlattened,_n.ZINDEX)}return!0}getRecipientOfVisibleLayer(e){return[...this.controller.getLayerRecipient(e)].filter(n=>n.showInLayerList)}isLayerRemovable(e){return An(e)?!0:e.options.removable!==!1}static \u0275fac=function(n){return new(n||r)(Ie(Ng))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-viewer-bottom-actions"]],inputs:{map:"map",controller:"controller",searchTerm:"searchTerm",viewerOptions:"viewerOptions"},outputs:{layerChange:"layerChange"},standalone:!0,features:[Xi([Ng,J_]),lt],ngContentSelectors:Bxe,decls:19,vars:24,consts:[["opacityMenu","matMenu"],["ngSlider",""],["ngSliderThumb","matSliderThumb"],[1,"igo-layer-actions-container",3,"title"],[1,"igo-layer-button-group"],["class","delete-button","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","eye-button","mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"down-button",3,"click","matTooltip","disabled"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge","matBadgeHidden"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"up-button",3,"click","matTooltip","disabled"],[4,"ngIf"],["class","zoomLayer-button","color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"delete-button",3,"click","matTooltip"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"eye-button",3,"click","disabled","matTooltip"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"opacity-button",3,"matMenuTriggerFor","matTooltip"],["aria-hidden","false","matBadgeColor","primary","matBadgeSize","medium",3,"matBadge"],[1,"panel-opacity-menu"],["id","opacity-slider","color","primary","discrete","","step","5","matTooltipShowDelay","500","tooltip-position","below",3,"click","min","max","matTooltip"],["matSliderThumb","",3,"input","value"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",1,"zoomLayer-button",3,"click","matTooltip"],["matBadgeColor","primary","matBadgeSize","medium"],["color","primary","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip"]],template:function(n,o){n&1&&(Kn(),$(0,"igo-panel",3),le(1,"translate"),$(2,"div",4),Pe(3,Gxe,6,9,"button",5)(4,jxe,5,7,"button",6),$(5,"button",7),le(6,"translate"),le(7,"translate"),ve("click",function(){return o.lowerSelection()}),$(8,"mat-icon",8),_e(9,"arrow_downward"),ee()(),$(10,"button",9),le(11,"translate"),le(12,"translate"),ve("click",function(){return o.raiseSelection()}),$(13,"mat-icon",8),_e(14,"arrow_upward"),ee()(),Pe(15,Vxe,12,11,"ng-container",10)(16,Uxe,4,3,"button",11)(17,zxe,4,3,"button",12),Tn(18),ee()()),n&2&&(z("title",o.hasMultipleSelection?ce(1,14,"igo.geo.layer.tools"):o.selected[0].title),j(3),z("ngIf",o.isLayersRemovable(o.selected)),j(),z("ngIf",o.hasMultipleSelection),j(),z("matTooltip",o.searchTerm?ce(6,16,"igo.geo.layer.filterLowerLayer"):ce(7,18,"igo.geo.layer.lowerLayer"))("disabled",!o.isSelectionLowerable),j(3),z("matBadge",o.searchTerm?"!":"")("matBadgeHidden",!o.isSelectionLowerable),j(2),z("matTooltip",o.searchTerm?ce(11,20,"igo.geo.layer.filterRaiseLayer"):ce(12,22,"igo.geo.layer.raiseLayer"))("disabled",!o.isSelectionRaisable),j(3),z("matBadge",o.searchTerm?"!":"")("matBadgeHidden",!o.isSelectionRaisable),j(2),z("ngIf",o.controller.selected.length===1),j(),z("ngIf",o.isExtentsValid()),j(),z("ngIf",o.canRename))},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,xl,Md,ym,G1,j1,v_,uf,o1,Et,Tt,eP],styles:[`.igo-layer-actions-container[_ngcontent-%COMP%]{padding:0 6px 0 4px}.igo-layer-actions-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center}.igo-layer-button-group[_ngcontent-%COMP%], .actions-buttons-multi[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row-reverse;overflow-x:auto;overflow-y:hidden}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-track, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}.igo-layer-button-group[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover, .actions-buttons-multi[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}.igo-layer-button-group[_ngcontent-%COMP%]{padding-top:4px}igo-panel[_ngcontent-%COMP%]{height:unset}  .panel-opacity-menu{overflow:visible!important}  .panel-opacity-menu #opacity-slider{margin:0 16px}
/*# sourceMappingURL=layer-viewer-bottom-actions.component-AW4TTIUG.css.map */`]})}return r})();var $xe=["customBottomActions"],Wxe=["*",[["","emptyList",""]]],Hxe=["*","[emptyList]"],qxe=r=>({layer:r});function Yxe(r,i){if(r&1){let e=We();Dr(0),ct(1,"mat-divider"),$(2,"div",6)(3,"mat-checkbox",7),ve("change",function(){we(e);let o=ne();return xe(o.toggleAllRows())}),_e(4),le(5,"translate"),le(6,"translate"),ee(),$(7,"button",8),ve("click",function(){we(e);let o=ne();return xe(o.toggleSelectionMode(!1))}),$(8,"mat-icon"),_e(9,"close"),ee()()(),Rr()}if(r&2){let e=ne();j(3),z("color",e.isAllSelected()?"primary":"accent")("checked",e.isAllSelected())("indeterminate",!e.isAllSelected()&&e.layerController.selected.length>0),j(),Qe(" ",e.isAllSelected()?ce(5,4,"igo.geo.layer.deselectAll"):ce(6,6,"igo.geo.layer.selectAll")," ")}}function Zxe(r,i){if(r&1&&ct(0,"igo-layer-unavailable-list",12),r&2){let e=ne(2);z("layersOptions",e.unavailableLayers)}}function Xxe(r,i){if(r&1&&($(0,"div"),ct(1,"mat-divider")(2,"igo-layer-list",11),ee()),r&2){let e=ne(2);j(2),z("controller",e.map.layerController)("layers",e.baselayers)("viewerOptions",e.layerViewerOptions)("isDragDropDisabled",!0)("isDesktop",e.isDesktop)}}function Kxe(r,i){if(r&1&&(Dr(0),$(1,"div",9),Pe(2,Zxe,1,1,"igo-layer-unavailable-list",10),ct(3,"igo-layer-list",11),Pe(4,Xxe,3,5,"div",2),ee(),Rr()),r&2){let e=ne();j(2),z("ngIf",e.unavailableLayers==null?null:e.unavailableLayers.length),j(),z("controller",e.map.layerController)("layers",e.layers)("viewerOptions",e.layerViewerOptions)("isDragDropDisabled",e.isDragDropDisabled)("isDesktop",e.isDesktop),j(),z("ngIf",!e.excludeBaseLayers&&(e.baselayers==null?null:e.baselayers.length))}}function Qxe(r,i){r&1&&Tn(0,1)}function Jxe(r,i){if(r&1&&ic(0,15),r&2){let e=ne(2);z("ngTemplateOutlet",e.customBottomActions)("ngTemplateOutletContext",fn(2,qxe,e.layerController.selected[0]))}}function eSe(r,i){if(r&1){let e=We();$(0,"igo-layer-viewer-bottom-actions",13),ve("layerChange",function(){we(e);let o=ne();return xe(o.onLayerChange())}),Pe(1,Jxe,1,4,"ng-container",14),ee()}if(r&2){let e=ne();z("map",e.map)("viewerOptions",e.layerViewerOptions)("controller",e.layerController)("searchTerm",e.keyword$.value),j(),z("ngIf",e.layerController.selected.length===1&&e.isLayerItem(e.layerController.selected[0]))}}var tSe=(()=>{class r{cdr;layerService;layers;baselayers;keyword$=new ut(void 0);mode;isDragDropDisabled;map;options;isDesktop;excludeBaseLayers;appliedFilterAndSort=new Ke;customBottomActions;get layerViewerOptions(){return En(ur({},this.options),{mode:this.mode})}get layerController(){return this.map.layerController}get unavailableLayers(){return this.layerService.unavailableLayers}constructor(e,n){this.cdr=e,this.layerService=n}isLayerItem=jn;ngOnInit(){let e=[this.layerController.layers$,this.keyword$],n=[];this.excludeBaseLayers||n.push(this.layerController.baseLayers$),Ts([...e,...n]).pipe(Br(10)).subscribe(([o,s,l])=>{if(o&&(this.layers=this.computeLayers(o,s)),l){let h=l.filter(p=>p.showInLayerList);this.baselayers=this.computeLayers(h,s)}this.cdr.markForCheck()}),this.keyword$.pipe(o0(()=>this.layers?.length===0?Gd:dm(50))).subscribe(o=>{this.isDragDropDisabled=!!o,this.appliedFilterAndSort.emit({keyword:o})})}clearKeyword(){this.keyword$.next(void 0)}onVisibilityOnlyChange(){this.layers=this.computeLayers([...this.layerController.treeLayers],this.keyword$.value)}onLayerChange(){this.layers=[...this.layers]}onSearchChange(e){this.keyword$.next(e)}toggleSelectionMode(e){e||this.layerController.clearSelection(),this.mode=e?"selection":void 0}toggleAllRows(){let e=this.isAllSelected();this.layerController.clearSelection(),!e&&this.layerController.select(...this.layerController.treeLayers)}isAllSelected(){let e=this.layerController.selected.length,n=this.layerController.treeLayers.length;return e>=n&&this.layerController.treeLayers.every(o=>this.layerController.isSelected(o))}isScrolledIntoView(e,n){let o=e.scrollTop,s=o+e.clientHeight,l=n.offsetTop;return l+n.clientHeight<=s&&l>=o}createGroup(e){this.map.layerController.add(e),this.cdr.markForCheck()}computeLayers(e,n){let o=this.filterLayers([...e],n);return F0(o,"desc")}filterLayers(e,n){return this.options?.filterAndSortOptions?.showToolbar===VN.never||n&&(e=this.filterSearch(n,e)),e}filterSearch(e,n){return e?[...n].reduce((o,s)=>{let l=s.clone();return An(l)&&(this.layerHasTerm(e,l)||(l.children=this.filterSearch(e,[...l.children]),l.children.length))||this.layerHasTerm(e,l)?o.concat(l):o},[]):n}layerHasTerm(e,n){let l=((n.options.metadata??{}).keywordList||[]).map(y=>y.normalize("NFD").replace(/[\u0300-\u036f]/g,"")),h=this.normalizeString(e),p=this.normalizeString(n.title),m=An(n)?"":n.dataSource.options.type||"",f=new RegExp(h,"gi"),g=l.find(y=>f.test(y))!==void 0;return f.test(p)||e.toLowerCase()===m.toLowerCase()||g}normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}static \u0275fac=function(n){return new(n||r)(Ie(lr),Ie(Za))};static \u0275cmp=nt({type:r,selectors:[["igo-layer-viewer"]],contentQueries:function(n,o,s){if(n&1&&Do(s,$xe,5,gp),n&2){let l;bi(l=wi())&&(o.customBottomActions=l.first)}},inputs:{map:"map",options:"options",isDesktop:"isDesktop",excludeBaseLayers:"excludeBaseLayers"},outputs:{appliedFilterAndSort:"appliedFilterAndSort"},standalone:!0,features:[lt],ngContentSelectors:Hxe,decls:9,vars:7,consts:[["showEmptyList",""],["floatLabel","auto",3,"addedLayer","modeChange","searchChange","visibilityOnlyChange","viewerOptions","term","mode"],[4,"ngIf"],[1,"layer-view"],[4,"ngIf","ngIfElse"],[3,"map","viewerOptions","controller","searchTerm","layerChange",4,"ngIf"],[1,"header-item","active-background"],[1,"select-all-checkbox",3,"change","color","checked","indeterminate"],["mat-icon-button","","color","warn",3,"click"],[1,"layer-list-container"],[3,"layersOptions",4,"ngIf"],[3,"controller","layers","viewerOptions","isDragDropDisabled","isDesktop"],[3,"layersOptions"],[3,"layerChange","map","viewerOptions","controller","searchTerm"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){if(n&1){let s=We();Kn(Wxe),$(0,"igo-layer-list-tool",1),ve("addedLayer",function(h){return we(s),xe(o.createGroup(h))})("modeChange",function(h){return we(s),xe(o.toggleSelectionMode(h))})("searchChange",function(h){return we(s),xe(o.onSearchChange(h))})("visibilityOnlyChange",function(){return we(s),xe(o.onVisibilityOnlyChange())}),ee(),Pe(1,Yxe,10,8,"ng-container",2),ct(2,"mat-divider"),$(3,"div",3),Pe(4,Kxe,5,7,"ng-container",4)(5,Qxe,1,0,"ng-template",null,0,Ac),ee(),Pe(7,eSe,2,5,"igo-layer-viewer-bottom-actions",5),Tn(8)}if(n&2){let s=Xt(6);z("viewerOptions",o.layerViewerOptions)("term",o.options==null||o.options.filterAndSortOptions==null?null:o.options.filterAndSortOptions.keyword)("mode",o.mode),j(),z("ngIf",o.mode==="selection"),j(3),z("ngIf",(o.layers==null?null:o.layers.length)>0||(o.unavailableLayers==null?null:o.unavailableLayers.length)>0||(o.baselayers==null?null:o.baselayers.length)>0)("ngIfElse",s),j(3),z("ngIf",o.layerController.hasSelection)}},dependencies:[Gt,EA,Vt,ci,hl,ac,dl,Uc,jt,$t,YN,KN,QN,Et,Tt,jN],styles:[`[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}.layer-view[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;overflow-y:auto}.layer-list-container[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;flex:1;overflow-x:hidden}.header-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;height:48px;padding:0 16px}.header-item[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-left:-16px}  .layer-indicator{color:#00000061!important}  .layer-indicator igo-icon,   .layer-indicator.mdc-icon-button{display:flex;align-items:center;justify-content:center}  .layer-indicator mat-icon{height:18px;width:18px;font-size:18px;font-variation-settings:"fill" 0}  .layer-indicator mat-icon   svg{height:18px;width:18px}
/*# sourceMappingURL=layer-viewer.component-H7HDPG5N.css.map */`],changeDetection:0})}return r})();function iSe(r,i){if(r&1){let e=We();$(0,"button",1),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.toggleTrackFeature())}),$(2,"mat-icon"),_e(3,"my_location"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.layer.trackFeature"))("color",e.color)}}var rSe=(()=>{class r{layer;trackFeature=!1;get options(){if(this.layer)return this.layer.options}color="primary";ngOnInit(){this.color=this.trackFeature?"primary":"basic"}toggleTrackFeature(){this.trackFeature?(this.layer.disableTrackFeature(),this.color="basic"):(this.layer.enableTrackFeature(this.layer.options.trackFeature),this.color="primary"),this.trackFeature=!this.trackFeature}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-track-feature-button"]],inputs:{layer:"layer",trackFeature:"trackFeature"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,o){n&1&&Pe(0,iSe,4,4,"button",0),n&2&&z("ngIf",o.options.trackFeature)},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,Et,Tt],changeDetection:0})}return r})();function tJ(){let r=JN(),i=t_(),e;return(n,o)=>{if(n.getId()==="bufferFeature")return e=nSe(n.get("bufferStroke"),2,n.get("bufferFill"),n.get("bufferText")),e;{let s=n.get("_style");return s?new Nc().createStyle(s,n,o):(e=n.getGeometry().getType()==="Point"?i:r,e.getText().setText(n.get("_mapTitle")),e)}}}function JN({text:r,strokeWidth:i=2,fillColor:e=[0,161,222,.3],strokeColor:n=[0,161,222,.9]}={}){let o=Ra(e).slice(0),s=Ra(n).slice(0),l=new ui({width:i,color:s}),h=new hi({color:o});return new oi({stroke:l,fill:h,image:new an({radius:5,stroke:l,fill:h}),text:new so({text:r,font:"12px Calibri,sans-serif",fill:new hi({color:"#000"}),stroke:new ui({color:"#fff",width:3}),overflow:!0})})}function nSe(r=[0,161,222,1],i=2,e=[0,161,222,.15],n){let o=new ui({width:i,color:r}),s=new hi({color:e});return new oi({stroke:o,fill:s,image:new an({radius:5,stroke:o,fill:s}),text:new so({font:"12px Calibri,sans-serif",text:n,fill:new hi({color:"#000"}),stroke:new ui({color:"#fff",width:3}),overflow:!0})})}function iJ(){let r=new kr;return new Fr({title:"Overlay",zIndex:300,source:r,style:tJ()})}var w_=class{map;layer;get dataSource(){return this.layer.dataSource}constructor(i){this.layer=iJ(),this.setMap(i)}setMap(i){i===void 0?this.map!==void 0&&this.map.ol.removeLayer(this.layer.ol):i.ol.addLayer(this.layer.ol),this.map=i}setFeatures(i,e=Yi.Default,n){if(n)for(let o of this.dataSource.ol.getFeatures())o.get("_sourceId")===n&&this.removeOlFeature(o);else this.clear();this.addFeatures(i,e)}addFeature(i,e=Yi.Default){this.addFeatures([i],e)}addFeatures(i,e=Yi.Default){let n=[];i.forEach(o=>{let s=ku(o,this.map.projection);s.getGeometry()!==null&&n.push(s)}),this.addOlFeatures(n,e)}addOlFeature(i,e=Yi.Default){this.addOlFeatures([i],e)}addOlFeatures(i,e=Yi.Default){this.dataSource.ol.addFeatures(i),ih(this.map.viewController,i,e)}removeFeature(i){this.removeFeatures([i])}removeFeatures(i){i.forEach(e=>{e.meta&&this.dataSource.ol.getFeatureById(e.meta.id)&&this.removeOlFeature(this.dataSource.ol.getFeatureById(e.meta.id))})}removeOlFeature(i){this.dataSource.ol.removeFeature(i)}clear(){this.dataSource.ol.clear()}};var mw=class{olMap;observerKeys=[];getOlMap(){return this.olMap}setOlMap(i){if(i!==void 0&&this.getOlMap()!==void 0)throw new Error("This controller is already bound to a map.");if(i===void 0){this.teardownObservers(),this.olMap=i;return}this.olMap=i}teardownObservers(){this.observerKeys.forEach(i=>io(i)),this.observerKeys=[]}};var Xl=function(r){return r.Position="position",r.PositionDirection="positionDirection",r.Accuracy="accuracy",r.Buffer="buffer",r}(Xl||{});var WT=class extends mw{map;options;storageService;configService;arrowRotation;subscriptions$$=[];geolocationOverlay;positionFeatureStyle=new oi({image:new an({radius:6,fill:new hi({color:"#3399CC"}),stroke:new ui({color:"#fff",width:2})})});accuracyFeatureStyle=new oi({stroke:new ui({color:"rgba(120, 120, 120, 0.4)",width:1}),fill:new hi({color:"rgba(120, 120, 120, 0.4)"})});get bufferStyle(){return new oi({stroke:new ui({width:2,color:this.buffer.bufferStroke}),fill:new hi({color:this.buffer.bufferFill}),text:new so({textAlign:"left",offsetX:10,offsetY:-10,font:"12px Calibri,sans-serif",text:this.buffer.showBufferRadius?`${this.buffer.bufferRadius}m`:"",fill:new hi({color:"#000"}),stroke:new ui({color:"#fff",width:3})})})}get arrowStyle(){return new oi({image:new ru({radius:5.5,fill:new hi({color:"rgba(0, 132, 202)"}),stroke:new ui({color:"#fff",width:1.5}),points:3,displacement:[0,9],rotation:this.arrowRotation,rotateWithView:!0})})}geolocation;emissionIntervalSeconds$=new ut(5);position$=new ut(void 0);tracking$=new ut(void 0);followPosition$=new ut(void 0);lastPosition;set buffer(i){this._buffer=i,this.handleFeatureCreation(this.position$.value)}get buffer(){return this._buffer}_buffer;set accuracyThreshold(i){this._accuracyThreshold=i,this.handleFeatureCreation(this.position$.value)}get accuracyThreshold(){return this._accuracyThreshold}_accuracyThreshold;get olGeolocation(){return this.geolocation}get tracking(){return this.geolocation.getTracking()}set tracking(i){this.geolocation.setTracking(i||!1),this.tracking$.next(i),this.storageService&&i!==void 0&&this.storageService.set("geolocation.tracking",i),i||this.position$.next(void 0)}set followPosition(i){this._followPosition=i,this.followPosition$.next(i),this.configService?.getConfig("geolocate.followPosition")===!1&&(this._followPosition=!1,this.followPosition$.next(!1)),this.handleFeatureCreation(this.position$.value),this.storageService&&i!==void 0&&this.storageService.set("geolocation.followPosition",i)}get followPosition(){return this._followPosition}_followPosition;constructor(i,e,n,o){super(),this.map=i,this.options=e,this.storageService=n,this.configService=o,this.geolocationOverlay=new w_(this.map),this._followPosition=this.options&&this.options.followPosition?this.options.followPosition:!1,this._buffer=this.options&&this.options.buffer?this.options.buffer:void 0,this._accuracyThreshold=this.options&&this.options.accuracyThreshold?this.options.accuracyThreshold:5e3}setOlMap(i){super.setOlMap(i),this.setupObservers()}deleteGeolocationFeatures(){this.deleteFeatureByType(Xl.Position),this.deleteFeatureByType(Xl.PositionDirection),this.deleteFeatureByType(Xl.Accuracy),this.deleteFeatureByType(Xl.Buffer)}setupObservers(){this.tracking$.subscribe(e=>{e?this.onPositionChange(!0,!0):this.deleteGeolocationFeatures()}),this.geolocation=new DQ({trackingOptions:{enableHighAccuracy:!0,maximumAge:1e4,timeout:6e5},projection:this.options.projection});let i=!1;this.subscriptions$$.push(this.emissionIntervalSeconds$.pipe(Xn(e=>xA(e*1e3))).subscribe(()=>{i===this.tracking?this.onPositionChange(!0):(i=this.tracking,this.onPositionChange(!0,!0))})),this.geolocation.on("change",()=>{this.onPositionChange(!1,!1)})}updateArrowFeatureOrientation(i){let e=Sr(i.position,i.projection,"EPSG:4326");if(!this.lastPosition){this.lastPosition={coordinates:e,dateTime:new Date};return}let n=this.getFeatureByType(Xl.PositionDirection),o=i?.speed>1.25&&this.distanceBetweenPoints(this.lastPosition.coordinates,e)>.003;if(i.accuracy<=this.accuracyThreshold&&o){let s=e[1]-this.lastPosition.coordinates[1],l=e[0]-this.lastPosition.coordinates[0],h=Math.atan2(l,s);h<0&&(h=2*Math.PI+h),this.arrowRotation=h,n&&n.setStyle(this.arrowStyle),this.lastPosition={coordinates:e,dateTime:new Date}}else n&&new Date().getTime()-this.lastPosition.dateTime.getTime()>3e3&&tR(n)}distanceBetweenPoints(i,e){return b0(i,e)/1e3}addOnChangedListener(i){let e=()=>{i(this.geolocation)};return this.geolocation.on("change",e),e}deleteChangedListener(i){this.geolocation.un("change",i)}updateGeolocationOptions(i){if(!i)return;let e=i.geolocate,n=i.alwaysTracking;if(this.storageService){let o=this.storageService.get("geolocation.tracking");o!=null&&(e=o);let s=this.storageService.get("geolocation.followPosition");s!=null&&(n=s)}this.tracking=e,this.followPosition=n,this.buffer=i.buffer}teardownObservers(){this.subscriptions$$.length&&this.subscriptions$$.map(i=>i.unsubscribe()),super.teardownObservers()}onPositionChange(i=!1,e=!1){if(!this.tracking)return;let n=this.geolocation.getProperties();if(n.accuracy>this.accuracyThreshold){console.warn("Poor geolocation accuracy. No position are stored/shown"),this.position$.next(void 0);return}let o={position:n.position,projection:this.geolocation.getProjection().getCode(),accuracy:n.accuracy,altitude:n.altitude,altitudeAccuracy:n.altitudeAccuracy,heading:n.heading,speed:n.speed,enableHighAccuracy:!!n.trackingOptions?.enableHighAccuracy,timestamp:new Date};this.handleFeatureCreation(o),this.handleViewFromFeatures(o,e),i&&this.position$.next(o)}getFeatureByType(i){return this.geolocationOverlay.dataSource.ol.getFeatureById(i)}deleteFeatureByType(i){let e=this.geolocationOverlay?.dataSource.ol.getFeatureById(i);e&&this.geolocationOverlay.dataSource.ol.removeFeature(e)}handleFeatureCreation(i){if(!i||!i.position)return;let e=new Ii(i.position),n=Kd(new Tu(i.position,i.accuracy||0)),o=this.getFeatureByType(Xl.Position),s=this.getFeatureByType(Xl.PositionDirection),l=this.getFeatureByType(Xl.Accuracy),h=!!o,p=!!s,m=!!l;if(p||(s=new gi({geometry:e}),s.setId(Xl.PositionDirection),tR(s)),h||(o=new gi({geometry:e}),o.setId(Xl.Position),o.setStyle(this.positionFeatureStyle)),m||(l=new gi({geometry:n}),l.setId(Xl.Accuracy),l.setStyle(this.accuracyFeatureStyle)),e&&(h?o.setGeometry(e):this.geolocationOverlay.addOlFeature(o,Yi.None),p?s.setGeometry(e):this.geolocationOverlay.addOlFeature(s,Yi.None),this.updateArrowFeatureOrientation(i),m?l.setGeometry(n):this.geolocationOverlay.addOlFeature(l,Yi.None),this.buffer)){let f=this.getFeatureByType(Xl.Buffer),g=!!f,y=new Tu(i.position,this.buffer.bufferRadius);g||(f=new gi(y),f.setId(Xl.Buffer),f.setStyle(this.positionFeatureStyle)),f.setStyle(this.bufferStyle),g?f.setGeometry(y):this.geolocationOverlay.addOlFeature(f,Yi.None)}}handleViewFromFeatures(i,e=!1){let n=this.getFeatureByType(Xl.Position),o=this.getFeatureByType(Xl.PositionDirection),s=this.getFeatureByType(Xl.Accuracy),l=this.getFeatureByType(Xl.Buffer),h=[n,o,s,l].filter(p=>p);if(h.length>0){let p=By(h,this.map.viewProjection),m=i?.speed>12.5?[.25,.25,.25,.25]:[.15,.1,.1,.1],f=eR(this.map.getExtent(),p,m),g=this.followPosition&&f?Yi.Move:Yi.None;e&&(g=Yi.Zoom),g!==Yi.None&&ih(this.map.viewController,h,g)}}};var dC=function(r){return r[r.Move=0]="Move",r[r.Zoom=1]="Zoom",r}(dC||{});var HT=class extends mw{options;rotation$=new ut(0);resolution$=new ut(void 0);state$=new ut(void 0);padding=[0,0,0,0];maxZoomOnExtent=19;maxLayerZoomExtent;extent$=new Si;extent$$;states=[];stateIndex=0;get stateHistory(){return this.options?this.options.stateHistory===!0:!1}get olView(){return this.olMap.getView()}constructor(i){super(),this.options=i}setPadding(i){(i.top||i.top===0)&&(this.padding[0]=i.top),(i.right||i.right===0)&&(this.padding[1]=i.right),(i.bottom||i.bottom===0)&&(this.padding[2]=i.bottom),(i.left||i.left===0)&&(this.padding[3]=i.left)}setOlMap(i){super.setOlMap(i),this.setupObservers()}setupObservers(){this.stateHistory===!0&&this.observerKeys.push(this.olMap.on("moveend",()=>this.onMoveEnd())),this.extent$$=this.extent$.pipe(Br(25)).subscribe(i=>{this.setExtent(i.extent,i.action)})}monitorRotation(){this.observerKeys.push(this.olMap.getView().on("change:rotation",i=>{this.rotation$.next(i.target.getRotation())})),this.rotation$.next(this.getRotation())}teardownObservers(){super.teardownObservers(),this.extent$$!==void 0&&(this.extent$$.unsubscribe(),this.extent$$=void 0)}getOlProjection(){return this.olView.getProjection()}getCenter(i){let e=this.olView.getCenter();return i&&e&&(e=Sr(e,this.getOlProjection(),i)),e}getExtent(i){let e=this.olView.calculateExtent(this.olMap.getSize());return i&&e&&(e=Zs(e,this.getOlProjection(),i)),e}getScale(i=96){return z9(this.getResolution(),this.getOlProjection().getUnits(),i)}getResolution(){return this.olView.getResolution()}getZoom(){return Math.round(this.olView.getZoom())}zoomIn(){this.zoomTo(this.olView.getZoom()+1)}zoomOut(){this.zoomTo(this.olView.getZoom()-1)}zoomTo(i){this.olView.cancelAnimations(),this.olView.animate({zoom:i,duration:250,easing:$l})}moveToExtent(i){this.extent$.next({extent:i,action:dC.Move})}zoomToExtent(i){this.extent$.next({extent:i,action:dC.Zoom})}getRotation(){return this.olView.getRotation()}resetRotation(){this.olView.animate({rotation:0})}hasPreviousState(){return this.states.length>1&&this.stateIndex>0}hasNextState(){return this.states.length>1&&this.stateIndex<this.states.length-1}previousState(){this.hasPreviousState()&&this.setStateIndex(this.stateIndex-1)}nextState(){this.hasNextState()&&this.setStateIndex(this.stateIndex+1)}clearStateHistory(){this.states=[],this.stateIndex=0}setInitialState(){this.states.length>0&&this.setStateIndex(0)}setExtent(i,e,n=!0){let o=this.olView;o.cancelAnimations();let s=n?500:0,l=o.getZoom(),h=o.getCenter(),p=[i[0]+(i[2]-i[0])/2,i[1]+(i[3]-i[1])/2],m=Math.sqrt(Math.pow(h[0]-p[0],2)+Math.pow(h[1]-p[1],2)),f=o.calculateExtent(),g=Math.sqrt(Math.pow(f[2]-f[0],2)+Math.pow(f[3]-f[1],2)),_=(Math.sqrt(Math.pow(i[2]-i[0],2)+Math.pow(i[3]-i[1],2))+g)/2,w=m/_,A=e===dC.Move||l>this.maxZoomOnExtent?l:this.maxZoomOnExtent;o.fit(i,{size:this.olMap.getSize(),maxZoom:A,padding:this.padding,duration:w>4?0:s,callback:k=>{k||o.fit(i,{size:this.olMap.getSize(),maxZoom:A,padding:this.padding,duration:w>4?0:s})}})}setStateIndex(i){this.stateIndex=i,this.setState(this.states[i])}setState(i){this.olView.animate({resolution:i.resolution,center:i.center,duration:0})}onMoveEnd(){let i=this.getResolution();this.resolution$.value!==i&&this.resolution$.next(i);let e={resolution:i,center:this.getCenter(),zoom:this.getZoom()};if(this.stateHistory===!0){let n=this.stateIndex,o=this.states.length===0?void 0:this.states[n];U9(e,o)||(this.states=this.states.slice(0,n+1).concat([e]),this.stateIndex=this.states.length-1)}this.state$.next(e)}};var qT=class{storageService;configService;ol;forcedOffline$=new ut(!1);layersAddedByClick$=new ut(void 0);status$;propertyChange$;overlay;queryResultsOverlay;searchResultsOverlay;viewController;layerController;geolocationController;swipeEnabled$=new ut(!1);mapCenter$=new ut(!1);selectedFeatures$=new ut(null);bufferDataSource;layerWatcher;options;mapViewOptions;defaultOptions={controls:{attribution:!1}};get projection(){return this.projectionCode}get viewProjection(){return this.viewController.getOlProjection()}get projectionCode(){return this.viewProjection.getCode()}constructor(i,e,n){this.storageService=e,this.configService=n,this.options=Object.assign({},this.defaultOptions,i),this.layerController=new $T(this,[]),this.layerWatcher=new _b,this.status$=this.layerWatcher.status$,this.propertyChange$=this.layerWatcher.propertyChange$,hE(D2),this.init()}init(){let i=[];if(this.options.controls){if(this.options.controls.attribution){let n=this.options.controls.attribution===!0?{}:this.options.controls.attribution;i.push(new l_(n))}if(this.options.controls.scaleLine){let n=this.options.controls.scaleLine===!0?{}:this.options.controls.scaleLine;i.push(new KR(n))}}let e={};this.options.interactions===!1&&(e={altShiftDragRotate:!1,doubleClickZoom:!1,keyboard:!1,mouseWheelZoom:!1,shiftDragZoom:!1,dragPan:!1,pinchRotate:!1,pinchZoom:!1}),this.ol=new dE({interactions:_2(e),controls:i}),this.setView(this.options.view||{}),this.viewController=new HT({stateHistory:!0}),this.viewController.setOlMap(this.ol),this.overlay=new w_(this),this.queryResultsOverlay=new w_(this),this.searchResultsOverlay=new w_(this),this.ol.once("rendercomplete",()=>{this.geolocationController=new WT(this,{projection:this.viewController.getOlProjection()},this.storageService,this.configService),this.geolocationController.setOlMap(this.ol),this.geolocationController&&this.geolocationController.updateGeolocationOptions(this.mapViewOptions),this.viewController.monitorRotation()})}setTarget(i){this.ol.setTarget(i),i!==void 0?this.layerWatcher.subscribe(()=>{},null):this.layerWatcher.unsubscribe()}updateView(i){let e=this.ol.getView(),n=ur(ur({},e.getProperties()),i);i.zoom&&i.resolution==null&&(n.resolution=void 0),this.setView(n),i.maxZoomOnExtent&&(this.viewController.maxZoomOnExtent=i.maxZoomOnExtent),this.mapViewOptions=i}setView(i){this.viewController!==void 0&&this.viewController.clearStateHistory();let e=ur({constrainResolution:!0},i);i.center&&(e.center=kx(i.center,i.projection)),this.ol.setView(new th(e)),i.maxLayerZoomExtent&&(this.viewController.maxLayerZoomExtent=i.maxLayerZoomExtent)}updateControls(i){if(i===void 0)return;let e=[];if(i.attribution){let o=i.attribution===!0?{}:i.attribution;e.push(new l_(o))}if(i.scaleLine){let o=i.scaleLine===!0?{}:i.scaleLine;e.push(new KR(o))}Object.assign([],this.ol.getControls().getArray()).forEach(o=>{this.ol.removeControl(o)}),e.forEach(o=>{this.ol.addControl(o)})}getCenter(i){return this.viewController.getCenter(i)}getExtent(i){return this.viewController.getExtent(i)}getZoom(){return this.viewController.getZoom()}getLayerByOlUId(i){return this.layerController.all.find(e=>fi(e.ol)&&fi(e.ol)===i)}};var oSe=["*"],sh=(()=>{class r{activityService;activityId;status$$;map;get view(){return this._view}set view(e){this._view=e,this.map!==void 0&&this.map.updateView(e)}_view;get controls(){return this._controls}set controls(e){this._controls=e,this.map!==void 0&&this.map.updateControls(e)}_controls;id=`igo-map-target-${rn()}`;constructor(e){this.activityService=e}ngOnInit(){this.status$$=this.map.status$.subscribe(e=>this.handleStatusChange(e))}ngAfterViewInit(){this.map.setTarget(this.id)}ngOnDestroy(){this.map.setTarget(void 0),this.activityService.unregister(this.activityId),this.status$$.unsubscribe()}handleStatusChange(e){e===dn.Working&&this.activityId===void 0?this.activityId=this.activityService.register():e===dn.Done&&this.activityId!==void 0&&(this.activityService.unregister(this.activityId),this.activityId=void 0)}static \u0275fac=function(n){return new(n||r)(Ie(Wf))};static \u0275cmp=nt({type:r,selectors:[["igo-map-browser"]],inputs:{map:"map",view:"view"},standalone:!0,features:[lt],ngContentSelectors:oSe,decls:2,vars:1,consts:[[1,"igo-map-browser-target",3,"id"]],template:function(n,o){n&1&&(Kn(),ct(0,"div",0),Tn(1)),n&2&&z("id",o.id)},styles:[`[_nghost-%COMP%]{position:relative;display:block}[_nghost-%COMP%], .igo-map-browser-target[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]     .ol-attribution{flex-flow:row;left:50px;bottom:5px;text-align:left;padding:0;margin-right:90px;background-color:#fff0;width:calc(100% - 100px)}[_nghost-%COMP%]     .ol-attribution.ol-logo-only{height:inherit}[_nghost-%COMP%]     .ol-attribution.ol-collapsed{background:none}[_nghost-%COMP%]     .ol-attribution.ol-collapsed button{transform:none}[_nghost-%COMP%]     .ol-attribution button{transform:rotate(180deg);background-color:#fff;cursor:pointer;outline:none}[_nghost-%COMP%]     .ol-scale-line-inner{color:#000;border-color:#000;text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px;box-shadow:0 1px 0 1px #fff9}[_nghost-%COMP%]     .ol-scale-line{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-bar{background-color:#fff0;bottom:4px;transform:translate(-50%);left:50%}[_nghost-%COMP%]     .ol-scale-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     .ol-scale-step-text{text-shadow:rgb(255,255,255) -1px -1px 3px,rgb(255,255,255) 1px -1px 3px,rgb(255,255,255) -1px 1px 3px,rgb(255,255,255) 1px 1px 4px}[_nghost-%COMP%]     canvas{display:block}
/*# sourceMappingURL=map-browser.component-EEHRAHCM.css.map */`]})}return r})();var aSe=(()=>{class r{component;mediaService;lastTimeoutRequest;pointerMoveListener;mapClickListener;pointerPositionDelay=1e3;pointerPositionCoord=new Ke;get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(e,n){this.component=e,this.mediaService=n}ngOnInit(){this.listenToMapPointerMove(),this.listenToMapClick()}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unlistenToMapClick()}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",e=>this.onPointerEvent(e,this.pointerPositionDelay))}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",e=>this.onPointerEvent(e,0))}unlistenToMapPointerMove(){io(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapClick(){this.mapClickListener=void 0}onPointerEvent(e,n){if(e.dragging||this.mediaService.isTouchScreen())return;typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let o=Sr(e.coordinate,this.mapProjection,"EPSG:4326");this.lastTimeoutRequest=setTimeout(()=>{this.pointerPositionCoord.emit(o)},n)}static \u0275fac=function(n){return new(n||r)(Ie(sh,2),Ie(Wc))};static \u0275dir=Fi({type:r,selectors:[["","igoPointerPosition",""]],inputs:{pointerPositionDelay:"pointerPositionDelay"},outputs:{pointerPositionCoord:"pointerPositionCoord"},standalone:!0})}return r})();function rJ(){let r=Math.floor(Math.random()*255),i=Math.floor(Math.random()*255),e=Math.floor(Math.random()*255),n=new ui({color:[r,i,e,1],width:2}),o=new hi({color:[r,i,e,.4]});return(s,l)=>{let h=s.get("_style");if(h&&CG(h)){if(h.circle&&s.get("rad")&&s.get("longitude")&&s.get("latitude")){let f=[s.get("longitude"),s.get("latitude")],g=s.get("rad")/Math.cos(Math.PI/180*f[1])/l;h.circle.radius=g}return new Nc().createStyle(h,void 0,l)}return new oi({stroke:n,fill:o,image:new an({radius:5,stroke:n,fill:o}),text:s.get("_mapTitle")?new so({text:s.get("_mapTitle").toString(),offsetX:5,offsetY:-5,font:"12px Calibri,sans-serif",fill:new hi({color:"#000"}),stroke:new ui({color:"#fff",width:3}),overflow:!0}):void 0})}}function nJ(){let r=Math.floor(Math.random()*255),i=Math.floor(Math.random()*255),e=Math.floor(Math.random()*255),n=new ui({color:[r,i,e,1],width:2}),o=new hi({color:[r,i,e,.4]});return new oi({stroke:n,fill:o,image:new an({radius:5,stroke:n,fill:o})})}function oJ(r){let e=[new oi({text:new so({text:r.get("hoverSummary"),textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:new hi({color:"#000"}),backgroundFill:new hi({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new ui({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new ui({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]})})];switch(r.getGeometry().getType()){case"Point":e.push(new oi({image:new an({radius:10,stroke:new ui({color:"blue",width:3})})}));break;default:e.push(new oi({stroke:new ui({color:"white",width:5})})),e.push(new oi({stroke:new ui({color:"blue",width:3})}))}return e}function aJ(r){return new oi({image:new Bs({src:"./assets/igo2/geo/icons/cross_black_18px.svg"}),text:new so({text:r.get("pointerSummary"),textAlign:"left",textBaseline:"bottom",font:"12px Calibri,sans-serif",fill:new hi({color:"#000"}),backgroundFill:new hi({color:"rgba(255, 255, 255, 0.5)"}),backgroundStroke:new ui({color:"rgba(200, 200, 200, 0.75)",width:2}),stroke:new ui({color:"#fff",width:3}),overflow:!0,offsetX:10,offsetY:-10,padding:[2.5,2.5,2.5,2.5]})})}var sSe=(()=>{class r{component;mediaService;styleService;store;pointerHoverFeatureStore=new Lh([]);lastTimeoutRequest;store$$;selectionLayer;selectionMVT={};mvtStyleOptions;pointerMoveListener;singleClickMapListener;hoverFeatureId="hoverFeatureId";igoHoverFeatureDelay=1e3;igoHoverFeatureEnabled=!1;mouseout(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(e,n,o){this.component=e,this.mediaService=n,this.styleService=o}ngOnInit(){this.map.status$.pipe(Ps(e=>e===dn.Done)).subscribe(()=>{this.store=new is([],{map:this.map}),this.initStore(),this.listenToMapPointerMove(),this.subscribeToPointerStore(),this.listenToMapClick()})}initStore(){let e=this.store,n=new Fr({isIgoInternalLayer:!0,id:"hoverFeatureId",title:"hoverFeature",zIndex:900,source:new kr,showInLayerList:!1,exportable:!1,browsable:!1,style:oJ});bd(e,n),this.selectionLayer=new Jb({map:this.map.ol,zIndex:901,renderMode:"vector",declutter:!0,source:new w5({projection:this.map.projection}),style:(o,s)=>{if(this.mvtStyleOptions&&o.getId()in this.selectionMVT)return this.createHoverStyle(o,this.mvtStyleOptions,s)}})}createHoverStyle(e,n,o){let s=ur({},n),l=n.label?n.label.attribute:void 0,h=!!n.label?.style;if(!e.get("_isLabel"))s.label=void 0,h=!1,l=void 0;else{let p=s.data?s.data.length:0,m=[],f=[],g=[],y=[];for(let _=0;_<p;_++)m.push(0),f.push("rgba(255, 255, 255, 0)"),g.push(0),y.push("rgba(255, 255, 255, 0)");s.radius=m,s.stroke=f,s.width=g,s.fill=y}return!h&&l&&(s.label.style={textAlign:"left",textBaseline:"top",font:"12px Calibri,sans-serif",fill:{color:"#000"},backgroundFill:{color:"rgba(255, 255, 255, 0.5)"},backgroundStroke:{color:"rgba(200, 200, 200, 0.75)",width:2},stroke:{color:"#fff",width:3},overflow:!0,offsetX:10,offsetY:20,padding:[2.5,2.5,2.5,2.5]}),this.styleService.createStyleByAttribute(e,s,o)}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unlistenToMapSingleClick()}subscribeToPointerStore(){this.store$$=this.pointerHoverFeatureStore.entities$.subscribe(e=>{this.addFeatureOverlay(e)})}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",e=>this.onMapEvent(e))}listenToMapClick(){this.singleClickMapListener=this.map.ol.on("singleclick",()=>this.onMapSingleClickEvent())}unsubscribeToPointerStore(){this.store$$?.unsubscribe()}unlistenToMapPointerMove(){io(this.pointerMoveListener),this.pointerMoveListener=void 0}unlistenToMapSingleClick(){io(this.singleClickMapListener),this.singleClickMapListener=void 0}onMapSingleClickEvent(){this.clearLayer()}onMapEvent(e){if(e.dragging||!this.igoHoverFeatureEnabled||this.mediaService.isTouchScreen()){this.clearLayer();return}typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let n=-1/0,o,s=this.map.ol.getPixelFromCoordinate(e.coordinate);this.lastTimeoutRequest=setTimeout(()=>{if(this.map.ol.forEachFeatureAtPixel(s,(l,h)=>{if(!h)return;let p=this.map.getLayerByOlUId(h.ol_uid);this.canProcessHover(p)&&(p.zIndex<=n||(n=p.zIndex,o=h))},{hitTolerance:10,layerFilter:l=>l instanceof fc||l instanceof Jb}),!o){this.clearLayer(),this.pointerHoverFeatureStore.clear();return}this.map.ol.forEachFeatureAtPixel(s,(l,h)=>{if(l.get("hoverSummary")===void 0&&l.getProperties()!==this.pointerHoverFeatureStore.all()[0]?.getProperties()){if(this.clearLayer(),h instanceof fc){let p=this.map.getLayerByOlUId(h.ol_uid);if(!this.canProcessHover(p))return;let m=this.handleRenderFeature(l);this.setLayerStyleFromOptions(p,m);let f=[m];m.set("_isLabel",!1);let g=new gi;g.setProperties(m.getProperties());let y=m.getGeometry().getType()==="Point"?m.getGeometry():new Ii(e.coordinate);return g.setGeometry(y),g.setId(m.getId()),g.set("_isLabel",!0),this.setLayerStyleFromOptions(p,g),f.push(g),this.pointerHoverFeatureStore.load(f),!0}if(h instanceof Jb){let p=this.map.getLayerByOlUId(h.ol_uid);if(!this.canProcessHover(p))return;p?.options?.igoStyle?.styleByAttribute?.hoverStyle?this.mvtStyleOptions=p.options.igoStyle.styleByAttribute.hoverStyle:p?.options?.igoStyle?.hoverStyle&&(this.mvtStyleOptions=p.options.igoStyle.hoverStyle),this.selectionLayer.setSource(h.getSource()),h.getFeatures(e.pixel).then(m=>{if(!m.length){this.selectionMVT={},this.selectionLayer.changed(),this.clearLayer();return}let f=m[0];if(!f){this.clearLayer();return}let g=this.handleRenderFeature(f);g.set("_isLabel",!1);let y=new gi;y.setProperties(g.getProperties());let _=g.getGeometry().getType()==="Point"?g.getGeometry():new Ii(e.coordinate);y.setGeometry(_),y.setId(g.getId()),y.set("_isLabel",!0),this.setLayerStyleFromOptions(p,y),this.pointerHoverFeatureStore.load([y]),this.selectionMVT[f.getId()]=g,this.selectionLayer.changed()})}}},{hitTolerance:10,layerFilter:l=>l===o})},this.igoHoverFeatureDelay)}canProcessHover(e){return!(!e||!e.visible||!e.options||!e.options.igoStyle?.styleByAttribute&&!e.options.igoStyle?.hoverStyle||e.options.igoStyle?.styleByAttribute&&!e.options.igoStyle?.styleByAttribute.hoverStyle&&!e.options.igoStyle?.hoverStyle)}handleRenderFeature(e){let n;return e instanceof il?(n=new gi({geometry:this.getGeometry(e)}),n.setId(e.getId())):e instanceof gi&&(n=e),n.setProperties(e.getProperties()),n}addFeatureOverlay(e){if(e.length>0){let n=e[0];this.clearLayer();let o=new gi({geometry:n.getGeometry(),meta:{id:this.hoverFeatureId},hoverSummary:this.getHoverSummary(n.getProperties())});this.store.setLayerOlFeatures([o],Yi.None)}}setLayerStyleFromOptions(e,n){let o=this.store.layer.map.viewController.getResolution();if(e?.options?.igoStyle?.styleByAttribute?.hoverStyle){this.store.layer.ol.setStyle(this.createHoverStyle(n,e.options.igoStyle.styleByAttribute.hoverStyle,o));return}e?.options?.igoStyle?.hoverStyle&&this.store.layer.ol.setStyle(this.createHoverStyle(n,e.options.igoStyle.hoverStyle,o))}getHoverSummary(e){let n="";for(let[o,s]of Object.entries(e))!o.startsWith("_")&&o!=="geometry"&&(n+=`${o}: ${s}
`);return n.length>=2?n.slice(0,-2):n}getGeometry(e){let n;if(!e.getOrientedFlatCoordinates)n=e.getGeometry();else{let o=e.getOrientedFlatCoordinates(),s=[];switch(o.forEach((l,h)=>{h%2===0&&s.push([parseFloat(o[h]),parseFloat(o[h+1])])}),e.getType()){case"Point":n=new Ii(s);break;case"Polygon":n=new on([s]);break;case"LineString":n=new Tr([s]);break}}return n}clearLayer(){this.selectionMVT={},this.selectionLayer&&this.selectionLayer.changed(),this.store&&this.store.clearLayer()}static \u0275fac=function(n){return new(n||r)(Ie(sh,2),Ie(Wc),Ie(Nc))};static \u0275dir=Fi({type:r,selectors:[["","igoHoverFeature",""]],hostBindings:function(n,o){n&1&&ve("mouseout",function(){return o.mouseout()})},inputs:{igoHoverFeatureDelay:"igoHoverFeatureDelay",igoHoverFeatureEnabled:"igoHoverFeatureEnabled"},standalone:!0})}return r})();var lSe=(()=>{class r{config;constructor(e){this.config=e,(this.config.getConfig("projections")||[]).forEach(o=>{o.alias=o.alias?o.alias:o.code,this.registerProjection(o)});for(let o=1;o<61;o++){let s=o<10?`EPSG:3260${o}`:`EPSG:326${o}`,l=`+proj=utm +zone=${o} +datum=WGS84 +units=m +no_defs`,h={code:s,def:l,extent:void 0};this.registerProjection(h)}for(let o=1;o<11;o++){let s=o<10?`EPSG:3218${o}`:`EPSG:321${80+o}`,l;Number(o)<=2?l=-50-Number(o)*3:Number(o)>=12?l=-81-(Number(o)-12)*3:l=-49.5-Number(o)*3;let h=`+proj=tmerc +lat_0=0 +lon_0=${l} +k=0.9999 +x_0=304800 +y_0=0 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"`,p={code:s,def:h,extent:void 0};this.registerProjection(p)}}registerProjection(e){D2.defs(e.code,e.def),hE(D2),e.extent&&ni(e.code).setExtent(e.extent)}static \u0275fac=function(n){return new(n||r)(pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function LAt(r){let i=-54;if(r<-81||r>i)return 0;{let o=2;for(;Math.abs(r-i)>3;)i=i-3,o++;return o}}function kAt(r){let i=-180,e=6,n=1;for(;Math.abs(r-i)>e;)i=i+e,n++;return n}function sJ(r){let i=r.mtmZone,e=r.utmZone;return{projFromConfig:r.projFromConfig!==!1,nad83:r.nad83!==!1,wgs84:r.wgs84!==!1,webMercator:r.webMercator!==!1,utm:r.utm!==!1,mtm:r.mtm!==!1,utmZone:{minZone:e&&e.minZone?e.minZone:17,maxZone:e&&e.maxZone?e.maxZone:21},mtmZone:{minZone:i&&i.minZone?i.minZone:2,maxZone:i&&i.maxZone?i.maxZone:10}}}var lJ=r=>({zoom:r}),cJ=(()=>{class r{map;color;get zoom(){return this.map.viewController.getZoom()}get minZoom(){return this.map.viewController.olView.getMinZoom()||1}get maxZoom(){return this.map.viewController.olView.getMaxZoom()}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-zoom-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[lt],decls:9,vars:16,consts:[[1,"igo-zoom-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color","disabled"]],template:function(n,o){n&1&&($(0,"div",0)(1,"button",1),le(2,"translate"),ve("click",function(){return o.map.viewController.zoomIn()}),$(3,"mat-icon"),_e(4,"add"),ee()(),$(5,"button",1),le(6,"translate"),ve("click",function(){return o.map.viewController.zoomOut()}),$(7,"mat-icon"),_e(8,"remove"),ee()()()),n&2&&(j(),z("matTooltip",Ao(2,6,"igo.geo.mapButtons.zoomIn",fn(12,lJ,o.zoom+1)))("color",o.color)("disabled",o.zoom>=o.maxZoom),j(4),z("matTooltip",Ao(6,9,"igo.geo.mapButtons.zoomOut",fn(14,lJ,o.zoom-1)))("color",o.color)("disabled",o.zoom<=o.minZoom))},dependencies:[Vt,ci,Qt,ti,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:#fff}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .igo-zoom-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{margin-bottom:2px}
/*# sourceMappingURL=zoom-button.component-FOUUQ7ZM.css.map */`]})}return r})();var uJ=(()=>{class r{configService;get sidenavOpened(){return this._sidenavOpenend}set sidenavOpened(e){this._sidenavOpenend=e,this.getClassMenuButton()}_sidenavOpenend;openSidenav=new Ke;useThemeColor;menuButtonClass;constructor(e){this.configService=e;let n=this.configService.getConfig("menu.button.useThemeColor");this.useThemeColor=n!==void 0?n:!1}getClassMenuButton(){this.menuButtonClass={"menu-button-white-background":!this.useThemeColor}}onToggleSidenavClick(){this.openSidenav.emit()}static \u0275fac=function(n){return new(n||r)(Ie(Oi))};static \u0275cmp=nt({type:r,selectors:[["igo-menu-button"]],inputs:{sidenavOpened:"sidenavOpened"},outputs:{openSidenav:"openSidenav"},standalone:!0,features:[lt],decls:4,vars:4,consts:[["mat-icon-button","","id","menu-button","tooltip-position","below","matTooltipShowDelay","500",3,"click","ngClass","matTooltip"]],template:function(n,o){n&1&&($(0,"button",0),le(1,"translate"),ve("click",function(){return o.onToggleSidenavClick()}),$(2,"mat-icon"),_e(3,"menu"),ee()()),n&2&&z("ngClass",o.menuButtonClass)("matTooltip",ce(1,2,o.sidenavOpened?"menu.close":"menu.open"))},dependencies:[Vt,ci,_a,Qt,ti,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}
/*# sourceMappingURL=menu-button.component-JFSLI247.css.map */`]})}return r})();function cSe(r,i){if(r&1){let e=We();$(0,"div",1)(1,"button",2),le(2,"translate"),le(3,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.onGeolocationClick())}),$(4,"mat-icon"),_e(5),le(6,"async"),ee()()()}if(r&2){let e=ne();j(),z("matTooltip",e.map.geolocationController.tracking?ce(2,3,"igo.geo.mapButtons.geolocateInactive"):ce(3,5,"igo.geo.mapButtons.geolocate"))("color",e.color),j(4),bt(ce(6,7,e.icon$))}}var dJ=(()=>{class r{configService;tracking$$;icon$=new ut("my_location");get map(){return this._map}set map(e){this._map=e}_map;get color(){return this._color}set color(e){this._color=e}_color;constructor(e){this.configService=e}ngAfterContentInit(){this.map.ol.once("rendercomplete",()=>{this.tracking$$=this.map.geolocationController.tracking$.subscribe(e=>{e?this.icon$.next("my_location"):this.icon$.next(this.configService.getConfig("geolocate.basic")?"my_location":"location_searching")})})}ngOnDestroy(){this.tracking$$&&this.tracking$$.unsubscribe()}onGeolocationClick(){let e=this.map.geolocationController.tracking;this.map.geolocationController.tracking=!e}static \u0275fac=function(n){return new(n||r)(Ie(Oi))};static \u0275cmp=nt({type:r,selectors:[["igo-geolocate-button"]],inputs:{map:"map",color:"color"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["class","igo-geolocate-button-container",4,"ngIf"],[1,"igo-geolocate-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color"]],template:function(n,o){n&1&&Pe(0,cSe,7,9,"div",0),n&2&&z("ngIf",o.map.geolocationController)},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-geolocate-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}
/*# sourceMappingURL=geolocate-button.component-Q4GRSWI6.css.map */`]})}return r})();var hJ=(()=>{class r{configService;map;color;extentOverride;centerOverride;zoomOverride;homeExtentButtonExtent;homeExtentButtonCenter;homeExtentButtonZoom;constructor(e){this.configService=e,this.computeHomeExtent()}computeHomeExtent(){let e=this.configService.getConfig("homeExtentButton");this.homeExtentButtonExtent=this.extentOverride||e?.homeExtButtonExtent,this.homeExtentButtonCenter=this.centerOverride||e?.homeExtButtonCenter,this.homeExtentButtonZoom=this.zoomOverride||e?.homeExtButtonZoom,this.centerOverride&&this.zoomOverride&&(this.homeExtentButtonExtent=void 0)}onToggleClick(){if(this.computeHomeExtent(),this.homeExtentButtonExtent)this.map.viewController.zoomToExtent(this.homeExtentButtonExtent);else if(this.homeExtentButtonCenter&&this.homeExtentButtonZoom){let e=kx(this.homeExtentButtonCenter,this.map.viewController.olView.getProjection().getCode());this.map.viewController.olView.setCenter(e),this.map.viewController.zoomTo(this.homeExtentButtonZoom)}}static \u0275fac=function(n){return new(n||r)(Ie(Oi))};static \u0275cmp=nt({type:r,selectors:[["igo-home-extent-button"]],inputs:{map:"map",color:"color",extentOverride:"extentOverride",centerOverride:"centerOverride",zoomOverride:"zoomOverride"},standalone:!0,features:[lt],decls:5,vars:4,consts:[[1,"igo-home-extent-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","color"]],template:function(n,o){n&1&&($(0,"div",0)(1,"button",1),le(2,"translate"),ve("click",function(){return o.onToggleClick()}),$(3,"mat-icon"),_e(4,"home"),ee()()()),n&2&&(j(),z("matTooltip",ce(2,2,"igo.geo.mapButtons.home-extent"))("color",o.color))},dependencies:[Vt,ci,Qt,ti,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-home-extent-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}
/*# sourceMappingURL=home-extent-button.component-5KT7WLG3.css.map */`]})}return r})();var uSe=r=>[r],pJ=(()=>{class r{btnStyle="onlineStyle";map;color;enabled=!1;ngOnInit(){this.map.forcedOffline$.next(this.enabled)}onClick(){this.enabled=!this.enabled,this.handleButtonStyle(),this.map.forcedOffline$.next(this.enabled)}handleButtonStyle(){this.enabled?this.btnStyle="offlineStyle":this.btnStyle="onlineStyle"}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-offline-button"]],inputs:{map:"map",color:"color",enabled:"enabled"},standalone:!0,features:[lt],decls:6,vars:9,consts:[[1,"igo-user-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","matTooltip","ngClass","color"]],template:function(n,o){n&1&&($(0,"div",0)(1,"button",1),le(2,"translate"),le(3,"translate"),ve("click",function(){return o.onClick()}),$(4,"mat-icon"),_e(5,"wifi_off"),ee()()()),n&2&&(j(),z("matTooltip",o.enabled?ce(2,3,"igo.geo.mapButtons.online"):ce(3,5,"igo.geo.mapButtons.offline"))("ngClass",fn(7,uSe,o.btnStyle))("color",o.enabled?o.color:null))},dependencies:[Vt,ci,Qt,ti,_a,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .onlineStyle[_ngcontent-%COMP%]:hover{background-color:#efefef}[_nghost-%COMP%]   .offlineStyle[_ngcontent-%COMP%]{width:40px;background-color:#b9b9b9}
/*# sourceMappingURL=offline-button.component-MHPQN5J2.css.map */`]})}return r})();var yJ=Jl(_J());var vJ=(()=>{class r{storageService;color="primary";get enabled(){return this.storageService.get("wakeLockEnabled")}set enabled(e){this.storageService.set("wakeLockEnabled",e)}noSleep;icon$=new ut("bedtime");visible=!1;constructor(e){this.storageService=e,this.noSleep=new yJ.default,gG.satisfies({ie:">0",edge:"<84",chrome:"<84",firefox:">0",opera:"<70",safari:">0"})&&(this.disableWakeLock(),this.enabled=!1,window.addEventListener("blur",()=>{this.disableWakeLock(),this.enabled=!1})),this.enabled?this.enableWakeLock():this.disableWakeLock()}enableWakeLock(){this.noSleep.enable(),this.enabled=!0,this.icon$.next("bedtime_off")}disableWakeLock(){this.noSleep.disable(),this.enabled=!1,this.icon$.next("bedtime")}toggleWakeLock(){this.enabled?this.disableWakeLock():this.enableWakeLock()}static \u0275fac=function(n){return new(n||r)(Ie(Kr))};static \u0275cmp=nt({type:r,selectors:[["igo-wake-lock-button"]],inputs:{color:"color",enabled:"enabled"},standalone:!0,features:[lt],decls:7,vars:9,consts:[[1,"igo-wake-lock-button-container"],["mat-icon-button","","matTooltipPosition","left",3,"click","color","matTooltip"]],template:function(n,o){n&1&&($(0,"div",0)(1,"button",1),le(2,"translate"),le(3,"translate"),ve("click",function(){return o.toggleWakeLock()}),$(4,"mat-icon"),_e(5),le(6,"async"),ee()()()),n&2&&(j(),z("color",o.color)("matTooltip",o.enabled?ce(2,3,"igo.geo.mapButtons.preventScreenLock"):ce(3,5,"igo.geo.mapButtons.letScreenLock")),j(4),bt(ce(6,7,o.icon$)))},dependencies:[Vt,ci,Qt,ti,jt,$t,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-wake-lock-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}
/*# sourceMappingURL=wake-lock-button.component-MQPCUZKX.css.map */`]})}return r})();function bJ(){return Gf("baseLayerSwitcherState",[Ud("collapseIcon",Ls({height:"40px",width:"40px",overflow:"hidden"})),Ud("collapseMap",Ls({height:"80px",overflow:"hidden"})),Ud("expand",Ls({overflow:"hidden"})),qu("collapse => expand",Hu("200ms")),qu("expand => collapse",Hu("200ms"))])}function pSe(r,i){if(r&1&&($(0,"div",5),_e(1),ee()),r&2){let e=ne(2);j(),bt(e.title)}}function mSe(r,i){if(r&1){let e=We();$(0,"div",2),ve("click",function(){we(e);let o=ne();return xe(o.changeBaseLayer(o.baseLayer))}),ct(1,"igo-map-browser",3),Pe(2,pSe,2,1,"div",4),ee()}if(r&2){let e=ne();j(),z("map",e.basemap),j(),z("ngIf",e.title)}}var r8=(()=>{class r{layerService;appRef;map;disabled;title;get display(){return this._display}set display(e){this._display=e,this.basemap.ol.getView().changed()}_display;get baseLayer(){return this._baseLayer}set baseLayer(e){this._baseLayer=e,this.handleBaseLayerChanged(e)}_baseLayer;basemap=new qT({controls:{},interactions:!1});constructor(e,n){this.layerService=e,this.appRef=n}ngAfterViewInit(){this.handleMainMapViewChange(this.map.ol.getView()),this.map.viewController.olView.on("change",e=>{this.handleMainMapViewChange(e.target)}),this.map.ol.on("pointerdrag",e=>{this.handleMainMapViewChange(e.target.getView())})}ngOnDestroy(){this.map.viewController.olView.un("change",e=>{this.handleMainMapViewChange(e.target)}),this.map.ol.un("pointerdrag",e=>{this.handleMainMapViewChange(e.target.getView())})}changeBaseLayer(e){this.disabled||(this.map.layerController.selectBaseLayer(e),this.appRef.tick())}handleMainMapViewChange(e){let n=e.getProperties();this.basemap.viewController.olView.setResolution(n.resolution),this.basemap.viewController.olView.setRotation(n.rotation),this.basemap.viewController.olView.setCenter(this.map.viewController.getCenter())}handleBaseLayerChanged(e){this.basemap.layerController.reset();let n=Object.assign(Object.create(e.options),e.options,{visible:!0,baseLayer:!1}),o=this.layerService.createLayer(n);this.basemap.layerController.add(o),this.handleLinkedBaseLayer(o)}handleLinkedBaseLayer(e){let n=e.options.linkedLayers;if(!n)return;let o=n.links;!!o&&o.map(l=>{l.linkedIds.map(h=>{let p=this.map.layerController.all.find(m=>jn(m)&&m.options.linkedLayers?.linkId===h);if(p){let m=Object.assign(Object.create(p.options),p.options,{zIndex:9e3,visible:p.options.linkedLayers?.showInMiniBaseMap??!0,baseLayer:!1});this.basemap.layerController.add(this.layerService.createLayer(m))}})})}static \u0275fac=function(n){return new(n||r)(Ie(Za),Ie(I1))};static \u0275cmp=nt({type:r,selectors:[["igo-mini-basemap"]],inputs:{map:"map",disabled:"disabled",title:"title",display:"display",baseLayer:"baseLayer"},standalone:!0,features:[lt],decls:2,vars:1,consts:[[1,"igo-mini-basemap-container"],[3,"click",4,"ngIf"],[3,"click"],[3,"map"],["class","igo-mini-basemap-title",4,"ngIf"],[1,"igo-mini-basemap-title"]],template:function(n,o){n&1&&($(0,"div",0),Pe(1,mSe,3,2,"div",1),ee()),n&2&&(j(),z("ngIf",o.display))},dependencies:[Gt,sh],styles:[`.igo-mini-basemap-container[_ngcontent-%COMP%]{width:80px;height:80px;background-color:#ffffff03;border:2px solid white;box-shadow:0 1px 4px #0000004d;cursor:pointer}.igo-mini-basemap-container[_ngcontent-%COMP%]:hover   .igo-mini-basemap-title[_ngcontent-%COMP%]{color:#000;text-shadow:0 0 5px white}.igo-mini-basemap-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.igo-mini-basemap-title[_ngcontent-%COMP%]{position:relative;top:-76px;height:76px;width:76px;text-align:center;vertical-align:bottom;color:#fff;text-shadow:0 0 5px black;white-space:normal;display:flex;align-items:flex-end;justify-content:center}
/*# sourceMappingURL=mini-basemap.component-FL6YY7DN.css.map */`],changeDetection:0})}return r})();var fSe=r=>({"container-expand":r});function gSe(r,i){r&1&&($(0,"div",6)(1,"button",7),le(2,"translate"),$(3,"mat-icon"),_e(4,"photo_library"),ee()()()),r&2&&(j(),z("matTooltip",ce(2,1,"igo.geo.mapButtons.baselayerSwitcher")))}function _Se(r,i){if(r&1&&(ct(0,"igo-mini-basemap",8),le(1,"translate")),r&2){let e=i.$implicit,n=i.index,o=ne(2);z("map",o.map)("baseLayer",e)("title",o.baseLayers.length>2&&!o.expand?ce(1,5,"igo.geo.baselayersSwitcher.title"):e.title)("display",o.expand||n===0&&!o.useStaticIcon)("disabled",!o.expand&&o.baseLayers.length>1)}}function ySe(r,i){r&1&&($(0,"div",9)(1,"mat-icon",10),_e(2,"arrow_drop_down"),ee()())}function vSe(r,i){if(r&1){let e=We();$(0,"div",1),ve("@baseLayerSwitcherState.start",function(){we(e);let o=ne();return xe(o.showButton=!1)})("@baseLayerSwitcherState.done",function(){we(e);let o=ne();return xe(o.showButton=!0)})("click",function(){we(e);let o=ne();return xe(o.collapseOrExpand())}),Pe(1,gSe,5,3,"div",2),$(2,"div",3),Pe(3,_Se,2,7,"igo-mini-basemap",4),ee(),Pe(4,ySe,3,0,"div",5),ee()}if(r&2){let e=ne();z("ngClass",fn(5,fSe,e.expand))("@baseLayerSwitcherState",e.expand?"expand":e.useStaticIcon?"collapseIcon":"collapseMap"),j(),z("ngIf",e.useStaticIcon&&!e.expand&&e.showButton),j(2),z("ngForOf",e.baseLayers),j(),z("ngIf",e.hasMoreThanTwo)}}var wJ=(()=>{class r{mediaService;map;useStaticIcon;_baseLayers=[];expand=!1;showButton=!0;layers$$;get hasMoreThanTwo(){return this.baseLayers.length>1}constructor(e){this.mediaService=e,this.mediaService.media$.value===$A.Mobile&&this.useStaticIcon===void 0&&(this.useStaticIcon=!0)}ngAfterViewInit(){this.layers$$=this.map.layerController.baseLayers$.subscribe(e=>{this._baseLayers=e??[]})}ngOnDestroy(){this.layers$$.unsubscribe()}collapseOrExpand(){this.hasMoreThanTwo||this.useStaticIcon?this.expand=!this.expand:this.expand=!1}get baseLayers(){let e=this.map.viewController.getResolution(),n=this.map.viewController.getZoom(),o=this._baseLayers.filter(l=>(!l.options.maxResolution||e<=l.options.maxResolution)&&(!l.options.minResolution||e>=l.options.minResolution)&&(!l.options.source.options.maxZoom||n<=l.options.source.options.maxZoom)&&(!l.options.source.options.minZoom||n>=l.options.source.options.minZoom)),s=o.filter(l=>!l.visible);return s.length+1===o.length?s:o}static \u0275fac=function(n){return new(n||r)(Ie(Wc))};static \u0275cmp=nt({type:r,selectors:[["igo-baselayers-switcher"]],inputs:{map:"map",useStaticIcon:"useStaticIcon"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["class","igo-baselayers-switcher-container",3,"ngClass","click",4,"ngIf"],[1,"igo-baselayers-switcher-container",3,"click","ngClass"],["class","igo-baselayers-switcher-button-container",4,"ngIf"],[1,"basemap-list"],[3,"map","baseLayer","title","display","disabled",4,"ngFor","ngForOf"],["class","more-baselayers",4,"ngIf"],[1,"igo-baselayers-switcher-button-container"],["mat-icon-button","","matTooltipPosition","right","color","primary",3,"matTooltip"],[3,"map","baseLayer","title","display","disabled"],[1,"more-baselayers"],["color","primary",1,"material-icons","mat-icon"]],template:function(n,o){n&1&&Pe(0,vSe,5,7,"div",0),n&2&&z("ngIf",o.baseLayers.length>0)},dependencies:[Gt,_a,Vt,ci,Qt,ti,jt,$t,Li,r8,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]{display:block}.basemap-list[_ngcontent-%COMP%]   igo-mini-basemap[_ngcontent-%COMP%]:not(:first-child){margin-top:4px}.igo-baselayers-switcher-container[_ngcontent-%COMP%]{height:auto;position:relative}.container-expand[_ngcontent-%COMP%]{overflow:hidden;border-width:0}.more-baselayers[_ngcontent-%COMP%]{width:80px;height:20px;background-color:#fff;text-align:center;cursor:pointer}.more-baselayers[_ngcontent-%COMP%]:hover{background-color:#efefef}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}.igo-baselayers-switcher-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}
/*# sourceMappingURL=baselayers-switcher.component-5W2J3AWG.css.map */`],data:{animation:[bJ()]}})}return r})();var bSe=(r,i)=>({azimuth:r,rotation:i});function wSe(r,i){if(r&1){let e=We();$(0,"div",1),le(1,"async"),le(2,"translate"),le(3,"translate"),$(4,"button",2),le(5,"async"),ve("click",function(){we(e);let o=ne();return xe(o.map.viewController.resetRotation())}),$(6,"mat-icon",3),le(7,"async"),_e(8,"navigation "),ee()()()}if(r&2){let e=ne();z("matTooltip",ce(1,4,e.rotated$)?Ao(2,6,"igo.geo.mapButtons.resetRotation",Ys(15,bSe,e.azimuthRounded,e.rotationRounded)):ce(3,9,"igo.geo.mapButtons.tipRotation")),j(4),z("color",e.color)("disabled",ce(5,11,e.rotated$)===!1),j(2),z("ngStyle",ce(7,13,e.currentStyle$))}}var xJ=(()=>{class r{rotated$=new ut(!1);azimuthRounded=0;rotationRounded=0;currentStyle$=new ut({transform:"rotate(0rad)"});map;showIfNoRotation;color;ngAfterContentInit(){this.map.viewController.rotation$.subscribe(e=>{let n=e||0,o=n*180/Math.PI;this.rotationRounded=Math.round(o),this.azimuthRounded=Math.round(LY(o*-1)),this.currentStyle$.next({transform:"rotate("+n+"rad)"}),this.rotated$.next(n!==0)})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-rotation-button"]],inputs:{map:"map",showIfNoRotation:"showIfNoRotation",color:"color"},standalone:!0,features:[lt],decls:2,vars:3,consts:[["class","igo-rotation-button-container","matTooltipPosition","left",3,"matTooltip",4,"ngIf"],["matTooltipPosition","left",1,"igo-rotation-button-container",3,"matTooltip"],["mat-icon-button","","matTooltipPosition","left",3,"click","color","disabled"],[3,"ngStyle"]],template:function(n,o){n&1&&(Pe(0,wSe,9,18,"div",0),le(1,"async")),n&2&&z("ngIf",ce(1,1,o.rotated$)&&!o.showIfNoRotation||o.showIfNoRotation)},dependencies:[Gt,Qt,ti,Vt,ci,jt,$t,cl,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]{width:40px;background-color:#fff}[_nghost-%COMP%]   .igo-rotation-button-container[_ngcontent-%COMP%]:hover{background-color:#efefef}
/*# sourceMappingURL=rotation-button.component-4LJ76XQQ.css.map */`]})}return r})();function xSe(r,i){if(r&1&&($(0,"div",1)(1,"pre"),_e(2),ee()()),r&2){let e=ne();j(2),bt(e.infoContent)}}var SSe=(()=>{class r{infoContent="";static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-info-section"]],inputs:{infoContent:"infoContent"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["class","infoSection",4,"ngIf"],[1,"infoSection"]],template:function(n,o){n&1&&Pe(0,xSe,3,1,"div",0),n&2&&z("ngIf",o.infoContent&&o.infoContent.length)},dependencies:[Gt],styles:[`.infoSection[_ngcontent-%COMP%]{border-radius:10px;background-color:#6e6e6e66;padding:2.5px;position:absolute;text-align:center;top:5px;left:50%;text-shadow:0 0 5px white,0 0 10px white,0 0 15px white}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){.infoSection[_ngcontent-%COMP%]{top:50px;left:10%}}
/*# sourceMappingURL=info-section.component-IM4K6T4T.css.map */`]})}return r})();var AJ=Jl(CJ());var gw=(()=>{class r{http;messageService;queryEnabled=!0;defaultFeatureCount=20;featureCount=20;previousMessageIds=[];constructor(e,n){this.http=e,this.messageService=n}query(e,n){this.previousMessageIds.length&&this.previousMessageIds.forEach(l=>{this.messageService.remove(l)});let o=e.filter(l=>l.displayed===!0).map(l=>this.queryLayer(l,n));return[].concat.apply([],o)}queryLayer(e,n){let o=this.getQueryUrl(e.dataSource,n,!1,e.map.viewController.getExtent());if(!o)return ai([]);let s=e.map.viewController.getResolution(),l=e.map.viewController.getScale();if(e.dataSource.options.queryFormat===Ya.HTMLGML2){if(typeof o=="string"){let m=this.getQueryUrl(e.dataSource,n,!0);return this.http.get(m,{responseType:"text"}).pipe(kf(f=>{let g=this.mergeGML(f,o,e),y=g[0],_=g[1];return this.http.get(o,{responseType:"text"}).pipe(Nt(w=>this.extractData(w,e,n,o,y,_)))}))}let h=this.getQueryUrl(e.dataSource,n,!0),p=[];for(let m=0;m<h.length;m++){let f=h[m];this.checkScaleAndResolution(s,l,f)&&p.push(this.requestDataForHTMLGML2(f.url,o[m].url,e,n))}return p}else{if(typeof o=="string")return this.http.get(o,{responseType:"text"}).pipe(Nt(m=>this.extractData(m,e,n,o)));let h=[];for(let p=0;p<o.length;p++){let m=o[p];if(this.checkScaleAndResolution(s,l,m)){let f=this.http.get(m.url,{responseType:"text"});h.push(f.pipe(Nt(g=>this.extractData(g,e,n,m.url))))}}return h}}requestDataForHTMLGML2(e,n,o,s){return this.http.get(e,{responseType:"text"}).pipe(kf(l=>{let h=this.mergeGML(l,n,o),p=h[0],m=h[1];return this.http.get(n,{responseType:"text"}).pipe(Nt(f=>this.extractData(f,o,s,n,p,m)))}))}checkScaleAndResolution(e,n,o){let s,l;return!o.minResolution&&!o.maxResolution&&!o.minScale&&!o.maxScale?!0:(o.minResolution&&o.maxResolution?e>=o.minResolution&&e<=o.maxResolution&&(l=!0):(o.minResolution&&e>=o.minResolution&&(l=!0),o.maxResolution&&e<=o.maxResolution&&(l=!0)),o.minScale&&o.maxScale?n>o.minScale&&n<o.maxScale&&(s=!0):(o.maxScale&&n<=o.maxScale&&(s=!0),o.minScale&&n>=o.minScale&&(s=!0)),s===!0&&l===!0?!0:l===!0&&!s||s===!0&&!l)}mergeGML(e,n,o){let l=new Fu().readFeatures(e);l.length===0&&(l=new DS().readFeatures(e));let h=new Ko([]),p,m=[],f=new es([]),g,y=l.length,A=this.getQueryParams(n.toLowerCase()).bbox.split(","),k=Wn();Hd(k,A);let R=!1,q,X;if(o.options?.source?.options){let me=o.options.source.options;me.queryTitle&&(X=me.queryTitle)}l.map(me=>{if(X){let ue=me.getProperties()[X];ue&&(q=q?`${q},${ue}`:ue)}let fe=me.getGeometry().getCoordinates(),ge=me.getGeometry().getType();if(!g&&!R&&(g=ge),!R)switch(ge){case"Point":y===1?p=new Ii(fe,"XY"):m.push(fe);break;case"LineString":h.appendLineString(new Tr(fe,"XY"));break;case"Polygon":f.appendPolygon(new on(fe,"XY"));break;case"MultiPolygon":f=new es(fe,"XY");break;default:return}});let ie;m.length===0&&p?ie={type:p.getType(),coordinates:p.getCoordinates()}:ie={type:"Polygon",coordinates:[this.convexHull(m)]};let ae;switch(g){case"LineString":ae={type:h.getType(),coordinates:h.getCoordinates()};break;case"Point":ae=ie;break;case"Polygon":ae={type:f.getType(),coordinates:f.getCoordinates()};break;case"MultiPolygon":ae={type:f.getType(),coordinates:f.getCoordinates()};break}let be={};return X&&(be[X]=q),[ae,be]}cross(e,n,o){return(e[0]-o[0])*(n[1]-o[1])-(e[1]-o[1])*(n[0]-o[0])}convexHull(e){e.sort((s,l)=>s[0]===l[0]?s[1]-l[1]:s[0]-l[0]);let n=[];for(let s of e){for(;n.length>=2&&this.cross(n[n.length-2],n[n.length-1],s)<=0;)n.pop();n.push(s)}let o=[];for(let s=e.length-1;s>=0;s--){for(;o.length>=2&&this.cross(o[o.length-2],o[o.length-1],e[s])<=0;)o.pop();o.push(e[s])}return o.pop(),n.pop(),n.concat(o)}extractData(e,n,o,s,l,h){let p=n.dataSource,m=this.getAllowedFieldsAndAlias(n),f=[];switch(p.options.queryFormat){case Ya.GML3:f=this.extractGML3Data(e,n.zIndex,m);break;case Ya.JSON:case Ya.GEOJSON:case Ya.GEOJSON2:f=this.extractGeoJSONData(e,n.zIndex,m);break;case Ya.ESRIJSON:f=this.extractEsriJSONData(e,n.zIndex,m);break;case Ya.TEXT:break;case Ya.HTML:f=this.extractHtmlData(e,p.queryHtmlTarget,s);break;case Ya.HTMLGML2:f=this.extractHtmlData(e,p.queryHtmlTarget,s,l,h);break;case Ya.GML2:default:f=this.extractGML2Data(e,n,m);break}if(f.length>0&&(f[0].geometry===null||!f[0].geometry)){let _=this.createGeometryFromUrlClick(s);for(let w of f)w.geometry=_}let g=n.dataSource;if((g.params?.FEATURE_COUNT?new RegExp("FEATURE_COUNT="+this.featureCount):new RegExp("FEATURE_COUNT="+this.defaultFeatureCount)).test(s)&&(g.params?.FEATURE_COUNT&&this.featureCount>1&&f.length===this.featureCount||!g.params?.FEATURE_COUNT&&f.length===this.defaultFeatureCount)){let _=this.messageService.info("igo.geo.query.featureCountMax",void 0,void 0,{value:n.title});this.previousMessageIds.push(_.toastId)}return f.map((_,w)=>{let A=_.properties[p.mapLabel],k;if(n.options.sourceOptions?.type==="wms"){let X=n.options.sourceOptions;k=X?X.excludeAttribute:void 0}let R=this.getQueryTitle(_,n);!R&&f.length>1?R=`${n.title} (${w+1})`:R||(R=n.title);let q=Object.assign({},_.meta||{},{id:rn(),title:R,mapTitle:A,sourceTitle:n.title,order:1e3-n.zIndex,excludeAttribute:k});return Object.assign(_,{meta:q,projection:p.options.type==="carto"?"EPSG:4326":o.projection})})}createGeometryFromUrlClick(e){let n=this.getQueryParams(e.toLowerCase()),o=n.bbox,s=parseInt(n.width,10),l=parseInt(n.height,10),h=parseInt(n.i||n.x,10),p=parseInt(n.j||n.y,10),m=o.split(","),f=(Math.abs(parseFloat(m[0]))-Math.abs(parseFloat(m[2])))*.05;Math.abs(parseFloat(m[0]))<180&&(f=.045);let g=parseFloat(m[0])+Math.abs(parseFloat(m[0])-parseFloat(m[2]))*h/s-f,y=parseFloat(m[1])+Math.abs(parseFloat(m[1])-parseFloat(m[3]))*p/l-f,_=g+f*2,w=y+f*2,A="POLYGON(("+g+" "+y+", "+g+" "+w+", "+_+" "+w+", "+_+" "+y+", "+g+" "+y+"))",q=new _d().readFeature(A).getGeometry();return{type:q.getType(),coordinates:q.getCoordinates()}}extractGML2Data(e,n,o){let l=new Fu().readFeatures(e);if(l.length===0){let h=new DS;try{l=h.readFeatures(e)}catch{console.warn("query.service: Multipolygons are badly managed in mapserver in GML2. Use another format.")}}return l.map(h=>this.featureToResult(h,n,o))}extractGML3Data(e,n,o){let s=new Ur,l=[];try{l=s.readFeatures(e)}catch{console.warn("query.service: GML3 is not well supported")}return l.map(h=>this.featureToResult(h,n,o))}extractGeoJSONData(e,n,o){let s=[];try{s=JSON.parse(e.replace(/(\r|\n)/g," ")).features}catch{console.warn("query.service: Unable to parse geojson",`
`,e)}return s.map(l=>l.meta={id:rn(),order:1e3-n,alias:o}),s}extractEsriJSONData(e,n,o){if(e)try{if(JSON.parse(e).error)return[]}catch{}return new jm().readFeatures(e).map(h=>this.featureToResult(h,n,o))}extractHtmlData(e,n,o,s,l){let h=this.getQueryParams(o.toLowerCase()),p=h.crs||h.srs||"EPSG:3857",m=this.createGeometryFromUrlClick(o);n!==eh.BLANK&&n!==eh.IFRAME&&(n=eh.IFRAME);let f=e.toLowerCase().indexOf("<body>"),g=e.toLowerCase().lastIndexOf("</body>")+7;return(0,AJ.default)(e.slice(f,g).replace(/(\r|\n|\s)/g,""))===""||e===""?[]:[{type:vr,projection:p,properties:Object.assign({target:n,body:e,url:o},l),geometry:s||m}]}getQueryParams(e){let n=e.split("?");if(!n[1])return;let o=n[1].split("&"),s={};return o.forEach(l=>{l=l.split("="),s[l[0]]=decodeURIComponent(l[1]||"")}),s}featureToResult(e,n,o){let s=e.getGeometry(),l=Object.assign({},e.getProperties());delete l.geometry,delete l.GEOMETRIE,delete l.boundedBy,delete l.shape,delete l.SHAPE,delete l.SHAPE_S,delete l.SHAPE_L,delete l.SHAPE_P,delete l.the_geom,delete l.geom,delete l.geom32198;let h;return s&&(h={type:s.getType(),coordinates:s.getCoordinates()}),{type:vr,projection:void 0,properties:l,geometry:h,meta:{id:rn(),order:1e3-n,alias:o}}}getQueryUrl(e,n,o=!1,s){let l;if(e.options.queryUrls)return this.getCustomQueryUrl(e,n,s);switch(e.constructor){case _l:{let h=e,p={INFO_FORMAT:h.params.INFO_FORMAT||this.getMimeInfoFormat(e.options.queryFormat),QUERY_LAYERS:h.params.LAYERS,FEATURE_COUNT:h.params.FEATURE_COUNT||this.defaultFeatureCount};h.params.FEATURE_COUNT&&(this.featureCount=h.params.FEATURE_COUNT),o&&(p.INFO_FORMAT=this.getMimeInfoFormat(Ya.GML2)),l=h.ol.getFeatureInfoUrl(n.coordinates,n.resolution,n.projection,p);break}case gg:{let h=e,p="https://"+h.options.account+".carto.com/api/v2/sql?",m="format=GeoJSON",f="&q="+h.options.config.layers[0].options.sql,g=" WHERE ST_Intersects(the_geom_webmercator,ST_BUFFER(ST_SetSRID(ST_POINT(",y=h.options.queryPrecision?h.options.queryPrecision:"1000",_=n.coordinates[0]+","+n.coordinates[1]+"),3857),"+y+"))";l=`${p}${m}${f}${g}${_}`;break}case K0:case Tp:{let h=e,p=Math.abs(s[0]-s[2]),m=Math.abs(s[1]-s[3]),g=(p>m?p:m)*.005,y=h.options.queryPrecision?h.options.queryPrecision:g,_=Gl(Ds([n.coordinates]),y),w=h.options.url+"/"+h.options.layer+"/query/",k=["f=json",`geometry=${encodeURIComponent('{"xmin":'+_[0]+',"ymin":'+_[1]+',"xmax":'+_[2]+',"ymax":'+_[3]+',"spatialReference":{"wkid":102100}}')}`,"geometryType=esriGeometryEnvelope","inSR=102100","spatialRel=esriSpatialRelIntersects","outFields=*","returnGeometry=true","outSR=102100"];l=`${w}?${k.join("&")}`;break}default:break}return l}getMimeInfoFormat(e){let n="application/vnd.ogc.gml",o=Object.keys(Ya).find(s=>Ya[s]===e);return o&&(n=Yh[o]),n}getAllowedFieldsAndAlias(e){let n;return e.options?.source?.options?.sourceFields&&e.options.source.options.sourceFields.length>=1&&(n={},e.options.source.options.sourceFields.forEach(o=>{let s=o.alias?o.alias:o.name;n[o.name]=s})),n}getQueryTitle(e,n){let o;if(n.options?.source?.options){let s=n.options.source.options;s.queryTitle&&(o=this.getLabelMatch(e,s.queryTitle))}return o}getLabelMatch(e,n){let o=n,s=Array.from(n.matchAll(/\$\{([^\{\}]+)\}/g));return s.forEach(l=>{o=o.replace(l[0],e.properties[l[1]])}),s.length===0&&o===n&&(o=e.properties[n]||n),o}getCustomQueryUrl(e,n,o){let s=_p(n.coordinates,n.resolution,0,[101,101]);return e.options.queryUrls.map(l=>{let h={url:l.url.replace(/\{bbox\}/g,s.join(",")).replace(/\{x\}/g,n.coordinates[0].toString()).replace(/\{y\}/g,n.coordinates[1].toString()).replace(/\{resolution\}/g,n.resolution.toString()).replace(/\{srid\}/g,n.projection.replace("EPSG:",""))};return o&&h.url.replace(/\{xmin\}/g,o[0].toString()).replace(/\{ymin\}/g,o[1].toString()).replace(/\{xmax\}/g,o[2].toString()).replace(/\{ymax\}/g,o[3].toString()),l.maxResolution&&(h.maxResolution=l.maxResolution),l.minResolution&&(h.minResolution=l.minResolution),l.minScale&&(h.minScale=l.minScale),l.maxScale&&(h.maxScale=l.maxScale),h})}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Gn))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var IJ=(()=>{class r{config;options;get paq(){return window._paq=window._paq||[]}constructor(e){this.config=e,this.options=this.config.getConfig("analytics")||{},this.options.provider==="matomo"&&this.initMatomo()}initMatomo(){if(!this.options.url||!this.options.id)return;let e=this.options.url.substr(-1)==="/"?this.options.url+"matomo":this.options.url;(()=>{this.paq.push(["setTrackerUrl",e+".php"]),this.paq.push(["setSiteId",this.options.id]),this.paq.push(["setSecureCookie",location.protocol==="https:"]);let n=document.createElement("script"),o=document.getElementsByTagName("script")[0];n.type="text/javascript",n.async=!0,n.defer=!0,n.src=e+".js",o.parentNode.insertBefore(n,o)})()}setUser(e,n){if(this.options.provider==="matomo"){if(!e)this.paq.push(["resetUserId"]),this.paq.push(["deleteCustomVariable",1,"user"]),this.paq.push(["deleteCustomVariable",2,"name"]),this.paq.push(["deleteCustomVariable",3,"profils"]);else{this.paq.push(["setUserId",e.id]);let o=`${e.firstName} ${e.lastName}`;this.paq.push(["setCustomVariable",1,"user",e.sourceId,"visit"]),this.paq.push(["setCustomVariable",2,"name",o,"visit"]),this.paq.push(["setCustomVariable",3,"profils",n,"visit"])}this.paq.push(["trackPageView"]),this.paq.push(["enableLinkTracking"])}}trackSearch(e,n){this.options.provider==="matomo"&&this.paq.push(["trackSiteSearch",e,!1,n])}trackEvent(e,n,o){this.options.provider==="matomo"&&this.paq.push(["trackEvent",e,n,o])}trackLayer(e,n,o){this.options.provider==="matomo"&&this.paq.push(["trackEvent",e,n,o])}static \u0275fac=function(n){return new(n||r)(pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Bu=class{sources;constructor(i){this.sources=i}getSources(){return this.sources}getEnabledSources(){return this.getSources().filter(i=>i.enabled===!0)}enableSourcesByType(i){this.getSources().forEach(e=>{e.constructor.type===i?e.enabled=!0:e.enabled=!1})}setParamFromSetting(i,e){i.setParamFromSetting(e)}setWorkspaces(i,e){i.setWorkspaces(e)}};function ZT(r){return r.search!==void 0}function XT(r){return r.reverseSearch!==void 0}function _w(r){return r.reverseSearch!==void 0&&r.showInPointerSummary===!0}function EJ(r,i){let e="";return i.split("").forEach((n,o)=>{n!==r.charAt(o)&&(e+=n)}),e}function lh(r,i,e=!1){if(!r||!i)return 0;let n=e?r:r.toString().toLowerCase(),o=e?i:i.toString().toLowerCase(),s=EJ(n,o),l=EJ(o,n),h=s+l,p=0;return h.length&&(p=h.length/n.length*100),100-Math.floor(p)}var ch=(()=>{class r{searchSourceService;mapService;storageService;analyticsService;searchTerm=K_(null);constructor(e,n,o,s,l){this.searchSourceService=e,this.mapService=n,this.storageService=o,this.analyticsService=s,l&&this.handleAnalytics()}handleAnalytics(){F7(()=>{let e=this.searchTerm();e!=null&&this.analyticsService.trackSearch(e,null)})}search(e,n={}){if(!this.termIsValid(e))return[];this.searchTerm.set(e);let o=this.mapService.getMap()?.projection||"EPSG:3857",s=dM(e,o,{forceNA:n.forceNA});if(s.lonLat)return this.reverseSearch(s.lonLat,{distance:s.radius,conf:s.conf});s.message&&console.log(s.message),n.extent=this.mapService.getMap()?.viewController.getExtent("EPSG:4326");let l;return n.getEnabledOnly||n.getEnabledOnly===void 0?l=this.searchSourceService.getEnabledSources():l=this.searchSourceService.getSources(),n.sourceId?l=l.filter(h=>h.getId()===n.sourceId):n.searchType&&(l=l.filter(h=>h.getType()===n.searchType)),l=l.filter(ZT),this.searchSources(l,e,n)}reverseSearch(e,n,o=!1){let s=o?_w:XT,l=this.searchSourceService.getEnabledSources().filter(s),h=this.storageService.get("reverseSearchCoordsFormatEnabled")||!1;return this.reverseSearchSources(l,e,n||{},h)}searchSources(e,n,o){return e.map(s=>({request:s.search(n,o),reverse:!1,source:s}))}reverseSearchSources(e,n,o,s){return e.map(l=>({request:l.reverseSearch(n,o,s),reverse:!0,source:l}))}termIsValid(e){return typeof e=="string"&&e!==""}static \u0275fac=function(n){return new(n||r)(pt(Bu),pt(nf),pt(Kr),pt(IJ),pt("searchAnalytics",8))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function ASe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",1),ve("change",function(o){we(e);let s=ne();return xe(s.onTogglePrivateModeControl(o.checked))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.enabledProfileHasAuthorization)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.directions.toggle.type")," ")}}function MSe(r,i){if(r&1&&ct(0,"igo-directions-buttons",6),r&2){let e=ne();z("stepsFeatureStore",e.stepsFeatureStore)("contextUri",e.contextUri)("zoomOnActiveRoute$",e.zoomOnActiveRoute$)("routesFeatureStore",e.routesFeatureStore)("stopsStore",e.stopsStore)}}var TJ=(()=>{class r{cdRef;http;languageService;directionsService;directionsSourceService;searchService;queryService;messageService;watcher;projection="EPSG:4326";hasOsrmPrivateAccess=!1;twoSourcesAvailable=!1;zoomOnActiveRoute$$;storeEmpty$$;storeChange$$;routesQueries$$=[];selectStopInteraction;translateStop;selectedRoute;focusOnStop=!1;isTranslating=!1;previousStops=[];searchs$$=[];authenticated$$;contextUri;stopsStore;stopsFeatureStore;routesFeatureStore;stepsFeatureStore;debounce=200;length=2;coordRoundedDecimals=6;zoomOnActiveRoute$=new Si;authenticated$;get directionControlIsActive(){return!this.queryService.queryEnabled}get interactions(){return[this.selectStopInteraction,this.translateStop,this.selectedRoute]}get enabledProfileHasAuthorization(){return this.directionsSourceService.sources[0].getEnabledProfile().authorization}constructor(e,n,o,s,l,h,p,m){this.cdRef=e,this.http=n,this.languageService=o,this.directionsService=s,this.directionsSourceService=l,this.searchService=h,this.queryService=p,this.messageService=m}ngOnInit(){this.authenticated$$=this.authenticated$.subscribe(e=>{if(e){let n=this.directionsSourceService.sources[0].getProfileWithAuthorization();n&&this.http.get(n.authorization.url).subscribe(o=>{this.hasOsrmPrivateAccess=o[n.authorization.property]})}}),this.twoSourcesAvailable=this.directionsSourceService.sources[0].profiles.length===2,this.queryService.queryEnabled=!1,this.initEntityStores(),setTimeout(()=>{Hq(this.stopsFeatureStore,this.languageService),qq(this.routesFeatureStore,this.languageService),Yq(this.stepsFeatureStore),this.initOlInteraction()},1)}ngOnDestroy(){this.queryService.queryEnabled=!0,this.storeEmpty$$.unsubscribe(),this.storeChange$$.unsubscribe(),this.routesQueries$$.map(e=>e.unsubscribe()),this.zoomOnActiveRoute$$.unsubscribe(),this.authenticated$$.unsubscribe(),this.freezeStores(),this.stopsFeatureStore.empty&&this.stopsFeatureStore.map.layerController.remove(this.stopsFeatureStore.layer),this.routesFeatureStore.empty&&this.routesFeatureStore.map.layerController.remove(this.routesFeatureStore.layer)}freezeStores(){this.interactions.map(e=>this.routesFeatureStore.layer.map.ol.removeInteraction(e)),this.stopsFeatureStore.deactivateStrategyOfType(vl),this.routesFeatureStore.deactivateStrategyOfType(vl),this.stepsFeatureStore.deactivateStrategyOfType(vl)}initEntityStores(){this.watcher=new N1(this.stopsStore,this.cdRef),this.monitorEmptyEntityStore(),this.monitorEntityStoreChange(),this.monitorActiveRouteZoom()}monitorActiveRouteZoom(){this.zoomOnActiveRoute$$=this.zoomOnActiveRoute$.subscribe(()=>{if(this.routesFeatureStore.count>=1){let e=this.routesFeatureStore.all().find(n=>n.properties.active);if(e){let n=this.stopsStore.all().map(h=>Sr(h.coordinates,"EPSG:4326","EPSG:3857")),o=e.geometry.coordinates,l=[...n,...o].reduce(([h,p,m,f],[g,y])=>[Math.min(h,g),Math.min(p,y),Math.max(m,g),Math.max(f,y)],[1/0,1/0,-1/0,-1/0]);this.routesFeatureStore.layer.map.viewController.zoomToExtent(l)}}})}initOlInteraction(){this.selectStopInteraction=new Rb({layers:[this.stopsFeatureStore.layer.ol],hitTolerance:7,condition:e=>e.type==="pointermove"&&!e.dragging}),this.translateStop=new g2({features:this.selectStopInteraction.getFeatures()}),this.translateStop.on("translating",e=>{this.isTranslating=!0,this.executeStopTranslation(e.features)}),this.translateStop.on("translateend",e=>{this.isTranslating=!1,this.executeStopTranslation(e.features)}),this.selectedRoute=new Rb({layers:[this.routesFeatureStore.layer.ol],condition:Gq,hitTolerance:7,filter:e=>e.get("type")===Rp.Route&&e.get("active")&&!this.isTranslating}),this.selectedRoute.on("select",e=>{if(this.focusOnStop===!1){let n=Sr(e.mapBrowserEvent.coordinate,this.routesFeatureStore.layer.map.projection,this.projection),o=o2(this.stopsStore);o.text=Rh(n,this.coordRoundedDecimals).join(", "),o.coordinates=[n[0],n[1]]}}),this.interactions.map(e=>this.routesFeatureStore.layer.map.ol.addInteraction(e))}onStopInputHasFocusChange(e){e?this.routesFeatureStore.layer.map.ol.removeInteraction(this.selectedRoute):this.routesFeatureStore.layer.map.ol.addInteraction(this.selectedRoute)}executeStopTranslation(e){if(e.getLength()===0)return;let n=e.getArray()[0],o=n.getId(),s=Sr(n.getGeometry().getCoordinates(),this.stopsFeatureStore.layer.map.projection,this.projection),l=this.stopsStore.get(o),h=uc(s,this.coordRoundedDecimals);l.coordinates=h,l.text=Rh(s,this.coordRoundedDecimals).join(", "),this.stopsStore.update(l)}monitorEmptyEntityStore(){this.storeEmpty$$=this.stopsStore.count$.pipe($u()).subscribe(e=>{if(e<2){if(o2(this.stopsStore),this.stopsStore.count===2){this.stopsStore.storeInitialized$.next(!0);return}this.stopsStore.storeInitialized$.next(!1)}this.routesQueries$$.map(n=>n.unsubscribe())})}monitorEntityStoreChange(){this.storeChange$$=this.stopsStore.entities$.pipe(Br(this.debounce)).subscribe(e=>{this.handleStopDiff(e),n2(this.stopsStore),this.handleStopsFeature(),this.getRoutes(this.isTranslating)})}cancelSearch(){this.searchs$$.map(e=>e.unsubscribe())}handleStopDiff(e){let n=e.map(l=>rr.removeUndefined({id:l.id,text:l.text,coordinates:l.coordinates})),o=yG.findChanges(this.previousStops,n,["coordinates"]),s=o.added.concat(o.modified);s&&s.map(l=>{let h=l.newValue;if(h){let p=this.stopsStore.get(h.id),m=p.text;if(!m||m.length===0)return;let f=dM(m,this.stopsFeatureStore.layer.map.projection),g=!1;f.lonLat&&(g=!0);let y=this.searchService.search(m,{searchType:"Feature"});this.cancelSearch();let _=y.map(w=>w.request.pipe(Nt(A=>A.filter(k=>g?k.data.geometry.type==="Point"&&k.data.geometry:k.data.geometry))));this.searchs$$=_.map(w=>w.pipe(Nt(A=>A.filter(k=>g?k.data.geometry.type==="Point"&&k.data.geometry:k.data.geometry))).subscribe(A=>{if(A.length>0){let k=A[0].source,R=A[0].meta,q=A.map(ie=>ie.data);p.searchProposals||(p.searchProposals=[]),p.searchProposals=p.searchProposals.filter(ie=>ie.type===(g?Ab.Coord:Ab.Text));let X=p.searchProposals.find(ie=>ie.source===k);X?X.results=q:p.searchProposals.push({type:g?Ab.Coord:Ab.Text,source:k,meta:R,results:q})}this.cdRef.detectChanges()}))}}),this.previousStops=n}handleStopsFeature(){let e=this.stopsStore.all();e.filter(s=>s.coordinates).map(s=>this.addStopOverlay(s)),this.stopsFeatureStore.all().map(s=>{this.stopsStore.get(s.properties.id)||this.stopsFeatureStore.delete(s)}),e.filter(s=>!s.coordinates).map(s=>{let l=this.stopsFeatureStore.get(s.id);l&&this.stopsFeatureStore.delete(l)})}getRoutes(e=!1){let n=this.stopsStore.view.all().filter(h=>h.coordinates);if(n.length<2){this.routesFeatureStore.deleteMany(this.routesFeatureStore.all());return}let o=n.map(h=>uc(h.coordinates,this.coordRoundedDecimals)),s={overview:!0,steps:!1,alternatives:!1,continue_straight:!1};this.routesQueries$$.map(h=>h.unsubscribe());let l=this.directionsService.route(o,e?s:void 0);l&&this.routesQueries$$.push(l.subscribe(h=>{this.routesFeatureStore.deleteMany(this.routesFeatureStore.all()),h.map(p=>Xq(this.routesFeatureStore,p,this.projection,p===h[0]))}))}addStopOverlay(e){Zq(e,this.stopsFeatureStore,this.projection,this.languageService)}onToggleDirectionsControl(e){this.queryService.queryEnabled=!e;let n=this.routesFeatureStore.layer.map.ol;this.interactions.map(o=>e?n.addInteraction(o):n.removeInteraction(o))}onTogglePrivateModeControl(e){this.directionsSourceService.sources[0].profiles.forEach(n=>n.enabled=!1),e?(this.directionsSourceService.sources[0].profiles.find(n=>n.authorization).enabled=!0,this.messageService.alert(this.languageService.translate.instant("igo.geo.directions.forestRoadsWarning.text"),this.languageService.translate.instant("igo.geo.directions.forestRoadsWarning.title"))):this.directionsSourceService.sources[0].profiles.find(n=>!n.authorization).enabled=!0,this.getRoutes()}static \u0275fac=function(n){return new(n||r)(Ie(lr),Ie(Er),Ie(Di),Ie(jy),Ie(k0),Ie(ch),Ie(gw),Ie(Gn))};static \u0275cmp=nt({type:r,selectors:[["igo-directions"]],inputs:{contextUri:"contextUri",stopsStore:"stopsStore",stopsFeatureStore:"stopsFeatureStore",routesFeatureStore:"routesFeatureStore",stepsFeatureStore:"stepsFeatureStore",debounce:"debounce",length:"length",coordRoundedDecimals:"coordRoundedDecimals",zoomOnActiveRoute$:"zoomOnActiveRoute$",authenticated$:"authenticated$"},standalone:!0,features:[lt],decls:8,vars:15,consts:[[1,"directions-options"],[3,"change","checked","labelPosition"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"stopInputHasFocus","coordRoundedDecimals","projection","stopsFeatureStore","stopsStore","debounce","length"],[3,"stepsFeatureStore","contextUri","zoomOnActiveRoute$","routesFeatureStore","stopsStore",4,"ngIf"],[3,"stepsFeatureStore","routesFeatureStore"],[3,"stepsFeatureStore","contextUri","zoomOnActiveRoute$","routesFeatureStore","stopsStore"]],template:function(n,o){n&1&&($(0,"div",0)(1,"mat-slide-toggle",1),ve("change",function(l){return o.onToggleDirectionsControl(l.checked)}),_e(2),le(3,"translate"),ee(),Pe(4,ASe,3,5,"mat-slide-toggle",2),ee(),$(5,"igo-directions-inputs",3),ve("stopInputHasFocus",function(l){return o.onStopInputHasFocusChange(l)}),ee(),Pe(6,MSe,1,5,"igo-directions-buttons",4),ct(7,"igo-directions-results",5)),n&2&&(j(),z("checked",o.directionControlIsActive)("labelPosition","before"),j(),Qe(" ",ce(3,13,"igo.geo.directions.toggle.activateControl")," "),j(2),z("ngIf",o.hasOsrmPrivateAccess&&o.twoSourcesAvailable),j(),z("coordRoundedDecimals",o.coordRoundedDecimals)("projection",o.projection)("stopsFeatureStore",o.stopsFeatureStore)("stopsStore",o.stopsStore)("debounce",o.debounce)("length",o.length),j(),z("ngIf",o.routesFeatureStore.all().length>0),j(),z("stepsFeatureStore",o.stepsFeatureStore)("routesFeatureStore",o.routesFeatureStore))},dependencies:[Wu,Gt,bl,js,q5,iE,rE,Et,Tt],styles:[`.directions-options[_ngcontent-%COMP%]{display:flex;flex-flow:column;align-items:center;margin:0 12px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;margin-right:auto;width:auto;padding-right:0}.directions-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-slide-toggle{margin-left:auto;margin-right:0}
/*# sourceMappingURL=directions.component-J5I4ANYA.css.map */`]})}return r})();var ISe=(()=>{class r{static forRoot(){return{ngModule:r}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[TJ,iE,q5,rE]})}return r})();var pC=(()=>{class r{transform(e,n){let o;return n==="time"&&(o=e.filter(s=>{if(An(s))return!1;let l=s.dataSource;return this.isTimeFilterable(l)&&l.options.timeFilter!==void 0&&Object.keys(l.options.timeFilter).length})),n==="ogc"&&(o=e.filter(s=>{if(An(s))return!1;let l=s.dataSource;return this.isOgcFilterable(l)})),o}isTimeFilterable(e){return e.options.type!=="wms"?!1:e.options.timeFilterable}isOgcFilterable(e){let n=!1;return e.options.ogcFilters&&e.options.ogcFilters.enabled&&e.options.ogcFilters.editable&&(n=!0),e.options.ogcFilters&&e.options.ogcFilters.enabled&&(e.options.ogcFilters.pushButtons||e.options.ogcFilters.checkboxes||e.options.ogcFilters.radioButtons||e.options.ogcFilters.select||e.options.ogcFilters.autocomplete)&&(n=!0),n}static \u0275fac=function(n){return new(n||r)};static \u0275pipe=CA({name:"filterableDataSource",type:r,pure:!0,standalone:!0})}return r})();var mC=(()=>{class r{filterByDate(e,n){let o,s,l,h;if(Array.isArray(n)){let m=[];n[0]&&(l=this.reformatDateTime(n[0]),m.push(n[0])),n[1]&&(h=this.reformatDateTime(n[1]),m.push(n[1])),m.length===2&&l!==h&&(e instanceof Tp?o=l+","+h:o=l+"/"+h),l===h&&(o=l)}else n&&(s=this.reformatDateTime(n),o=s);let p={TIME:o};if(e.ol.updateParams(p),e instanceof _l){let m=e;m.setTimeFilter(m.timeFilter,!0)}}filterByYear(e,n){let o,s,l;if(Array.isArray(n)){let p=[];n[0]&&(s=n[0],p.push(n[0])),n[1]&&(l=n[1],p.push(n[1])),p.length===2&&s!==l&&(e instanceof Tp?o=s+","+l:o=s+"/"+l),s===l&&(o=s)}else o=n;let h={TIME:o};if(e.ol.updateParams(h),e instanceof _l){let p=e;p.setTimeFilter(p.timeFilter,!0)}}reformatDateTime(e){let n=e.getFullYear(),o=e.getMonth()+1,s=e.getUTCDate(),l=e.getUTCHours(),h=e.getUTCMinutes();return Number(o)<10&&(o="0"+o),Number(s)<10&&(s="0"+s),Number(l)<10&&(l="0"+l),Number(h)<10&&(h="0"+h),n+"-"+o+"-"+s+"T"+l+":"+h+":00Z"}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var s1=(()=>{class r{filterByOgc(e,n){let o=new us().formatProcessedOgcFilter(n,e.options.params.LAYERS);e.ol.updateParams({FILTER:o})}setOgcWFSFiltersOptions(e){let n=e.options,o=new us;n.ogcFilters.enabled&&n.ogcFilters.filters&&(n.ogcFilters.filters=o.checkIgoFiltersProperties(n.ogcFilters.filters,n.paramsWFS.fieldNameGeometry,new lc({code:n.paramsWFS.srsName}),!0),n.ogcFilters.interfaceOgcFilters||(n.ogcFilters.interfaceOgcFilters=o.defineInterfaceFilterSequence(n.ogcFilters.filters,n.paramsWFS.fieldNameGeometry)))}setOgcWMSFiltersOptions(e){let n=e.options,o=new us;n.ogcFilters.enabled&&n.ogcFilters.filters?(n.ogcFilters.filters=o.checkIgoFiltersProperties(n.ogcFilters.filters,n.fieldNameGeometry,void 0,!0),n.ogcFilters.interfaceOgcFilters||(n.ogcFilters.interfaceOgcFilters=o.defineInterfaceFilterSequence(n.ogcFilters.filters,n.fieldNameGeometry)),this.filterByOgc(e,o.buildFilter(n.ogcFilters.filters,void 0,void 0,void 0,e.options)),n.filtered=!0):(n.ogcFilters.filters=void 0,n.ogcFilters.interfaceOgcFilters=[],n.filtered=!1)}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var nl=function(r){return r.Predefined="Predefined",r.Polygon="Polygon",r.Point="Point",r}(nl||{}),uh=function(r){return r.Address="Address",r.Thematics="Thematics",r}(uh||{});var fC=(()=>{class r{http;languageService;configService;baseUrl="https://geoegl.msp.gouv.qc.ca/apis/terrapi/";urlFilterList={AdmRegion:"regadmin",Arrond:"arrondissements",CircFed:"circ-fed",CircProv:"circ-prov",DirReg:"dir-reg",MRC:"mrc",Mun:"municipalites",RegTour:"tourisme",bornes:"bornes-sumi",hydro:"hydro",routes:"routes"};constructor(e,n,o){this.http=e,this.languageService=n,this.configService=o,this.baseUrl=this.configService.getConfig("spatialFilter.url")||this.baseUrl}getKeyByValue(e,n){return Object.keys(e).find(o=>e[o]===n)}loadFilterList(e){let n=e;if(n)return this.http.get(this.baseUrl+this.urlFilterList[n]).pipe(Nt(o=>o.features.map(s=>(s.meta={id:s.properties.code},s))))}loadThematicsList(){let e="types",n=[];return this.http.get(this.baseUrl+e).pipe(Nt(o=>(o.forEach(s=>{if(s.startsWith("lieux")){let l={name:void 0,source:s},h=s.substring(6,s.length),p=h;if(h.includes(".")){let m=h.indexOf(".");p=h.substring(m+1,h.length),h=h.substring(0,m)}try{l.name=this.languageService.translate.instant("igo.geo.terrapi."+p)}catch{l.name=p.substring(0,1).toUpperCase()+p.substring(1,p.length-1)}try{l.group=this.languageService.translate.instant("igo.geo.spatialFilter.group."+h)}catch{l.group=h.substring(0,1).toUpperCase()+h.substring(1,p.length-1)}n.push(l)}else if(this.getKeyByValue(this.urlFilterList,s)){let l={name:void 0,source:s},h=this.getKeyByValue(this.urlFilterList,s);try{l.name=this.languageService.translate.instant("igo.geo.terrapi."+h)}catch{l.name=h.substring(0,1).toUpperCase()+h.substring(1,h.length-1)}l.source=s,n.push(l)}}),n)))}loadFilterItem(e,n,o,s,l){if(o){let h=o,p=this.baseUrl+this.urlFilterList[h],m="";return n===uh.Address?(m="adresses",this.http.get(p+"/"+e.properties.code+"/"+m,{params:{geometry:"true",icon:"true",bufferInput:l.toString(),simplified:"100"}}).pipe(Nt(f=>f.features.map(g=>(g.meta={id:g.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:g.icon},g))))):(m=s.source,this.http.get(p+"/"+e.properties.code+"/"+m,{params:{geometry:"true",icon:"true",bufferInput:l.toString(),simplified:"100"}}).pipe(Nt(f=>f.features.map(g=>(g.meta={id:g.properties.code,title:s.name,icon:g.icon},g)))))}else{let h=this.baseUrl+"locate";if(n===uh.Address)return this.http.post(h+"?type=adresses",{geometry:"true",icon:"true",loc:JSON.stringify(e),bufferInput:l.toString(),simplified:"100"}).pipe(Nt(m=>m.features.map(f=>(f.meta={id:f.properties.code,title:this.languageService.translate.instant("igo.geo.spatialFilter.Address"),icon:f.icon},f))));{let p="?type="+s.source;return this.http.post(h+p,{geometry:"true",icon:"true",loc:JSON.stringify(e),bufferInput:l.toString(),simplified:"100"}).pipe(Nt(m=>m.features.map(f=>(f.meta={id:f.properties.code,title:s.name,icon:f.icon},f))))}}}loadItemById(e,n){let o=this.urlFilterList[n],s="/"+e.properties.code;if(o&&s)return this.http.get(this.baseUrl+o+s,{params:{geometry:"true"}}).pipe(Nt(l=>(l.meta={id:l.properties.code,alias:l.properties.nom,title:l.properties.nom},l)))}loadBufferGeometry(e,n,o,s){if(n===nl.Predefined){let l=this.urlFilterList[s],h="/"+e.properties.code;if(l&&h)return this.http.get(this.baseUrl+l+h,{params:{geometry:"100",bufferOutput:o.toString()}}).pipe(Nt(p=>(p.meta={id:p.properties.code,alias:p.properties.nom,title:p.properties.nom},p)))}else return this.http.post(this.baseUrl+"geospatial/buffer?",{buffer:o,loc:JSON.stringify(e)}).pipe(Nt(l=>l))}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Di),pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var QT=(()=>{class r{messageService;constructor(e){this.messageService=e}open(e){this.messageService.success("igo.geo.download.start","igo.geo.download.title");let n=e.dataSource.options;if(Object.keys(n.download).length>0)if(n.download.dynamicUrl&&n.download.url===void 0){let o,s=new lc({code:e.map.projection}),l=e.dataSource.options.paramsWFS;l&&Object.keys(l).length>0?(s=l.srsName?new lc({code:l.srsName}):s,o=e.dataSource.options.paramsWFS):o=e.dataSource.options.params;let h=Zs(e.map.viewController.getExtent(),new lc({code:e.map.projection}),s),p=o.outputFormatDownload===void 0?o.outputFormat===void 0?"":"outputformat="+o.outputFormat:"outputformat="+o.outputFormatDownload,m=n.download.dynamicUrl.replace(/&?outputformat=[^&]*/gi,"").replace(/&?filter=[^&]*/gi,"").replace(/&?bbox=[^&]*/gi,""),f=e.dataSource.options.ogcFilters,g;g=new us().handleOgcFiltersAppliedValue(e.dataSource.options,f.geometryName,h,s),g?g="filter="+encodeURIComponent(g):g=new us().buildFilter(void 0,h,s,f.geometryName),window.open(`${m}&${g}&${p}`,"_blank")}else n.download&&window.open(n.download.url,"_blank")}static \u0275fac=function(n){return new(n||r)(pt(Gn))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function TSe(r,i){if(r&1){let e=We();$(0,"button",1),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.openDownload())}),$(2,"mat-icon"),_e(3,"download"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.download.action"))("color",e.color)}}var FSe=(()=>{class r{downloadService;layer;color="primary";constructor(e){this.downloadService=e}openDownload(){this.downloadService.open(this.layer)}get options(){if(this.layer)return this.layer.dataSource.options}static \u0275fac=function(n){return new(n||r)(Ie(QT))};static \u0275cmp=nt({type:r,selectors:[["igo-download-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,o){n&1&&Pe(0,TSe,4,4,"button",0),n&2&&z("ngIf",o.options&&o.options.download&&(o.options.download.dynamicUrl||o.options.download.url))},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,Et,Tt],changeDetection:0})}return r})();var kJ=(()=>{class r{wktToFeature(e,n,o){return new _d().readFeature(e,{dataProjection:n,featureProjection:o})}extentToWkt(e,n,o){let s=Zs(n,o,e);this.roundCoordinateArray(s,e,0);let l=`POLYGON((
      ${n[0]} ${n[1]},
      ${n[0]} ${n[3]},
      ${n[2]} ${n[3]},
      ${n[2]} ${n[1]},
      ${n[0]} ${n[1]}))`,h=`LINESTRING(
      ${n[0]} ${n[1]},
      ${n[0]} ${n[3]},
      ${n[2]} ${n[3]},
      ${n[2]} ${n[1]},
      ${n[0]} ${n[1]})`,p=`MULTIPOINT(
        ${n[0]} ${n[1]},
        ${n[0]} ${n[3]},
        ${n[2]} ${n[3]},
        ${n[2]} ${n[1]})`;return{wktPoly:l,wktLine:h,wktMultiPoints:p}}roundCoordinateArray(e,n,o=0){let l=ni(n).getUnits();return["ft","m","us-ft"].indexOf(l)!==-1&&(e=this.roundArray(e,o)),e}roundArray(e,n=0){let o=0;for(;o<e.length;)e[o]=e[o].toFixed(n),o++;return e}snrcToWkt(e,n){e=e.toLowerCase();let o,s={1:{from:-56,to:-64},2:{from:-64,to:-72},3:{from:-72,to:-80},4:{from:-80,to:-88},5:{from:-88,to:-96},6:{from:-96,to:-104},7:{from:-104,to:-112},8:{from:-112,to:-120},9:{from:-120,to:-128},10:{from:-128,to:-136}},l={1:{from:44,to:48},2:{from:48,to:52},3:{from:52,to:56},4:{from:56,to:60},5:{from:60,to:64},6:{from:64,to:68},7:{from:68,to:72},8:{from:72,to:76},9:{from:76,to:-128}},h=[["m","n","o","p"],["l","k","j","i"],["e","f","g","h"],["d","c","b","a"]],p=[["13","14","15","16"],["12","11","10","09"],["05","06","07","08"],["04","03","02","01"]],m=/\d{2,3}[a-p][0,1][0-9]/gi,f=/\d{2,3}[a-p]/gi,g=/\d{2,3}/gi,y=!1,_=!1,w=!1;if(m.test(e)?w=!0:f.test(e)?_=!0:g.test(e)&&(y=!0),y?e+="a01":_&&(e+="01"),/\d{2,3}[a-p][0,1][0-9]/gi.test(e)){let A=/(?=[a-p])/gi,k=e.split(A),R=k[0],q=k[1][0],X=k[1].split(q)[1],ie=1;R.length===3&&(ie=2);let ae=R.substring(0,ie),be=R.substring(ie),me=8,fe=4,ge=2,ue=1,se=.5,te=.25,Se=0,Te=0,Ee=0,je=0;h.forEach(qe=>{qe.indexOf(q)!==-1&&(Te=h.indexOf(qe),Se=qe.indexOf(q))}),p.forEach(qe=>{qe.indexOf(X)!==-1&&(je=p.indexOf(qe),Ee=qe.indexOf(X))});let Ne=0,ze=0,Re=0,Ge=0,He=me,ye=fe;_?(Ne=Se*ge,ze=Te*ue,Re=0,Ge=0,He=ge,ye=ue):w&&(Ne=Se*ge,ze=Te*ue,Re=Ee*se,Ge=je*te,He=se,ye=te);let Ae={ul:[s[ae].to+Ne+Re,l[be].to-ze-Ge]};Ae.lr=[Ae.ul[0]+He,Ae.ul[1]-ye],Ae.ur=[Ae.ul[0],Ae.ul[1]-ye],Ae.ll=[Ae.ul[0]+He,Ae.ul[1]],Ae.ul=Sr([Ae.ul[0],Ae.ul[1]],"EPSG:4326",n),Ae.lr=Sr([Ae.lr[0],Ae.lr[1]],"EPSG:4326",n),Ae.ur=Sr([Ae.ur[0],Ae.ur[1]],"EPSG:4326",n),Ae.ll=Sr([Ae.ll[0],Ae.ll[1]],"EPSG:4326",n),Ae.ul=this.roundCoordinateArray(Ae.ul,n,0),Ae.lr=this.roundCoordinateArray(Ae.lr,n,0),Ae.ur=this.roundCoordinateArray(Ae.ur,n,0),Ae.ll=this.roundCoordinateArray(Ae.ll,n,0),o="POLYGON(("+[Ae.ul.join(" "),Ae.ur.join(" "),Ae.lr.join(" "),Ae.ll.join(" "),Ae.ul.join(" ")].join(",")+"))";let Le="LINESTRING("+[Ae.ul.join(" "),Ae.ur.join(" "),Ae.lr.join(" "),Ae.ll.join(" "),Ae.ul.join(" ")].join(",")+")",Ye="MULTIPOINT("+[Ae.ul.join(" "),Ae.ur.join(" "),Ae.lr.join(" "),Ae.ll.join(" ")].join(",")+")";return{wktPoly:o,wktLine:Le,wktMultiPoints:Ye}}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var ln=Jl(D1());var df=Jl(D1());var Bg=(()=>{class r{defaultStepMillisecond=6e4;step(e,n){return e.options.stepDate?e.options.stepDate:n.step}stepMillisecond(e,n){let o=df.default.duration(this.step(e,n)).asMilliseconds();return o===0?this.defaultStepMillisecond:o}stepIsYearDuration(e){let n=df.default.duration(e);return n.years()!==0&&n.months()===0&&n.weeks()===0&&n.days()===0&&n.hours()===0&&n.minutes()===0}stepIsMonthDuration(e){let n=df.default.duration(e);return n.months()!==0&&n.weeks()===0&&n.days()===0&&n.hours()===0&&n.minutes()===0}stepIsWeekDuration(e){let n=df.default.duration(e);return n.weeks()!==0&&n.days()===7&&n.hours()===0&&n.minutes()===0}stepIsDayDuration(e){let n=df.default.duration(e);return n.days()!==0&&n.hours()===0&&n.minutes()===0}stepIsHourDuration(e){let n=df.default.duration(e);return n.hours()!==0&&n.minutes()===0}stepIsMinuteDuration(e){return df.default.duration(e).minutes()!==0}dateToNumber(e){let n=new Date;return e&&(n=new Date(e)),n.getTime()}addStep(e,n){return(0,df.default)(e).add(n,"milliseconds").toDate()}subtractStep(e,n){return(0,df.default)(e).subtract(n,"milliseconds").toDate()}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();var pu=Jl(D1());var o8=(()=>{class r{ogcFilterTimeService;currentFilter;begin;max;datasource;changeProperty=new Ke;slider;interval;sliderValue=1;calculatedStep=0;_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderInterval=2e3;playIcon="play_circle";resetIcon="replay";get sliderInterval(){return this.currentFilter.sliderInterval===void 0?this._defaultSliderInterval:this.currentFilter.sliderInterval}get displayFormat(){return this.currentFilter.sliderOptions?.displayFormat?this.currentFilter.sliderOptions.displayFormat:this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}get beginMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.begin)}get maxMillisecond(){return this.ogcFilterTimeService.dateToNumber(this.max)}get stepMillisecond(){return this.ogcFilterTimeService.stepMillisecond(this.datasource,this.currentFilter)}constructor(e){this.ogcFilterTimeService=e,this.sliderDisplayWith=this.sliderDisplayWith.bind(this)}ngOnInit(){this.calculateStep(),this.handleSliderInput({value:1})}sliderDisplayWith(e){let n=new Date(this.beginMillisecond+(e-1)*this.stepMillisecond);if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){let o=pu.default.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years();n=(0,pu.default)(this.beginMillisecond).add((e-1)*o,"year").toDate()}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){let o=pu.default.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months();n=(0,pu.default)(this.beginMillisecond).add((e-1)*o,"month").toDate()}return(0,pu.default)(n).format(this.displayFormat)}playFilter(){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(()=>{if(this.slider.step<this.calculatedStep){let e="_increment",n="_emitInputEvent";this.slider[e](1),this.slider[n]()}else this.stopFilter()},this.sliderInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}resetFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle",this.slider.step=1,this.slider["_emitInputEvent"]()}handleSliderInput(e){if(e){if(this.ogcFilterTimeService.stepIsYearDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){let n=pu.default.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).years(),o=(0,pu.default)(this.beginMillisecond).add((e.value-1)*n,"year").toDate(),s=(0,pu.default)(o).add(n,"year").toDate();this.changeProperty.next({value:(0,pu.default)(o).toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:(0,pu.default)(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){let n=pu.default.duration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter)).months(),o=(0,pu.default)(this.beginMillisecond).add((e.value-1)*n,"month").toDate(),s=(0,pu.default)(o).add(n,"month").toDate();this.changeProperty.next({value:(0,pu.default)(o).startOf("month").toDate().toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:(0,pu.default)(s).toDate().toISOString(),pos:2,refreshFilter:!0})}else if(this.ogcFilterTimeService.stepIsDayDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsHourDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))||this.ogcFilterTimeService.stepIsMinuteDuration(this.ogcFilterTimeService.step(this.datasource,this.currentFilter))){let n=new Date(this.beginMillisecond+this.stepMillisecond*(e.value-1));this.changeProperty.next({value:n.toISOString(),pos:1,refreshFilter:!1}),this.changeProperty.next({value:new Date(this.ogcFilterTimeService.addStep(n.toISOString(),this.stepMillisecond)).toISOString(),pos:2,refreshFilter:!0})}}}calculateStep(){for(let e=1;this.maxMillisecond-(this.beginMillisecond+e*this.stepMillisecond)>=-1;e++)this.calculatedStep=e}static \u0275fac=function(n){return new(n||r)(Ie(Bg))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter-time-slider"]],viewQuery:function(n,o){if(n&1&&Ir(uf,5),n&2){let s;bi(s=wi())&&(o.slider=s.first)}},inputs:{currentFilter:"currentFilter",begin:"begin",max:"max",datasource:"datasource"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[Xi([Bg]),lt],decls:11,vars:7,consts:[["ngSlider",""],["ngSliderThumb","matSliderThumb"],[1,"slider-container"],["id","time-slider","thumbLabel","",3,"ngModelChange","step","min","max","ngModel","displayWith"],["matSliderThumb","",3,"input"],["mat-icon-button","","color","primary",3,"click"]],template:function(n,o){if(n&1){let s=We();$(0,"div",2)(1,"mat-slider",3,0),eo("ngModelChange",function(h){return we(s),Jn(o.sliderValue,h)||(o.sliderValue=h),xe(h)}),$(3,"input",4,1),ve("input",function(){we(s);let h=Xt(2),p=Xt(4);return xe(o.handleSliderInput({source:p,parent:h,value:p.value}))}),ee()(),$(5,"button",5),ve("click",function(){return we(s),xe(o.playFilter())}),$(6,"mat-icon"),_e(7),ee()(),$(8,"button",5),ve("click",function(){return we(s),xe(o.resetFilter())}),$(9,"mat-icon"),_e(10),ee()()()}n&2&&(j(),z("step",1)("min",1)("max",o.calculatedStep),Qn("ngModel",o.sliderValue),z("displayWith",o.sliderDisplayWith),j(6),bt(o.playIcon),j(3),bt(o.resetIcon))},dependencies:[v_,uf,o1,Sn,kn,nc,Vt,ci,jt,$t],styles:[`[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .datetime-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:inline-block;margin:5px 25px}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:120px;margin-right:25px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{display:inherit;margin-right:25px}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:40px}[_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{margin-left:10px}
/*# sourceMappingURL=ogc-filter-time-slider.component-SVT4PUPC.css.map */`]})}return r})();var kSe=["endDatepickerTime"],OSe=["beginDatepickerTime"],DSe=["beginTime"],RSe=["endTime"];function NSe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",10),eo("ngModelChange",function(o){we(e);let s=ne();return Jn(s.sliderMode,o)||(s.sliderMode=o),xe(o)}),ve("change",function(o){we(e);let s=ne();return xe(s.modeChange(o))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();Qn("ngModel",e.sliderMode),j(),Qe(" ",ce(2,2,"igo.geo.filter.sliderModeTitle")," ")}}function BSe(r,i){if(r&1){let e=We();$(0,"div",11)(1,"igo-ogc-filter-time-slider",12),ve("changeProperty",function(o){we(e);let s=ne();return xe(s.changePropertyByPass(o))}),ee()()}if(r&2){let e=ne();j(),z("begin",e.beginValue)("max",e.restrictedToStep()?e.maxDate:e.endValue)("currentFilter",e.currentFilter)("datasource",e.datasource)}}function GSe(r,i){if(r&1){let e=We();$(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),_e(3),le(4,"translate"),ee(),$(5,"input",17),ve("change",function(o){we(e);let s=Xt(8),l=ne(2);return xe(l.yearOnlyInputChange(o,s,"begin"))}),ee(),ct(6,"mat-datepicker-toggle",18),$(7,"mat-datepicker",19,0),ve("yearSelected",function(o){we(e);let s=Xt(8),l=ne(2);return xe(l.yearSelected(o,s,"begin"))}),ee(),ct(9,"input",20,1),ee(),$(11,"mat-form-field",16)(12,"mat-label"),_e(13),le(14,"translate"),ee(),$(15,"input",17),ve("change",function(o){we(e);let s=Xt(18),l=ne(2);return xe(l.yearOnlyInputChange(o,s,"end"))}),ee(),ct(16,"mat-datepicker-toggle",18),$(17,"mat-datepicker",19,2),ve("yearSelected",function(o){we(e);let s=Xt(18),l=ne(2);return xe(l.yearSelected(o,s,"end"))}),ee(),ct(19,"input",20,3),ee(),$(21,"div",21)(22,"button",22),le(23,"translate"),ve("click",function(){we(e);let o=ne(2);return xe(o.resetFilter())}),$(24,"mat-icon"),_e(25),ee()(),$(26,"mat-slide-toggle",23),le(27,"translate"),ve("change",function(){we(e);let o=ne(2);return xe(o.toggleFilterState())}),ee()()()}if(r&2){let e=Xt(8),n=Xt(18),o=ne(2);j(3),bt(ce(4,27,"igo.geo.timeFilter.startYear")),j(2),sr("value",o.onlyYearBegin),z("disabled",o.filterStateDisable),j(),z("for",e)("disabled",o.filterStateDisable),j(),z("startView",o.calendarView())("startAt",o.beginValue),j(2),z("matDatepicker",e)("value",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("min",o.handleDate(o.datasource.options.minDate))("max",o.endValue&&!o.restrictedToStep()?o.endValue:o.handleDate(o.datasource.options.maxDate)),j(4),bt(ce(14,29,"igo.geo.timeFilter.endYear")),j(2),sr("value",o.onlyYearEnd),z("disabled",o.filterStateDisable),j(),z("for",n)("disabled",o.filterStateDisable),j(),z("startView",o.calendarView())("startAt",o.endValue),j(2),z("matDatepicker",n)("value",o.endValue?o.endValue:o.handleDate(o.datasource.options.maxDate))("min",o.beginValue?o.beginValue:o.handleDate(o.datasource.options.minDate))("max",o.handleDate(o.datasource.options.maxDate)),j(3),z("matTooltip",ce(23,31,"igo.geo.filter.resetFilters"))("disabled",o.filterStateDisable),j(3),bt(o.resetIcon),j(),z("matTooltip",ce(27,33,"igo.geo.filter.toggleFilterState"))("checked",!o.filterStateDisable)}}function jSe(r,i){if(r&1&&($(0,"mat-option",37),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function VSe(r,i){if(r&1&&($(0,"mat-option",37),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function USe(r,i){if(r&1){let e=We();$(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),_e(3),le(4,"translate"),ee(),$(5,"mat-select",34),ve("selectionChange",function(){we(e),ne();let o=Xt(5),s=ne(2);return xe(s.changeTemporalProperty(o.value,1))}),Pe(6,jSe,2,2,"mat-option",35),ee()(),$(7,"mat-form-field",36)(8,"mat-label"),_e(9),le(10,"translate"),ee(),$(11,"mat-select",34),ve("selectionChange",function(){we(e),ne();let o=Xt(5),s=ne(2);return xe(s.changeTemporalProperty(o.value,1))}),Pe(12,VSe,2,2,"mat-option",35),ee()()()}if(r&2){let e=ne(3);j(3),bt(ce(4,8,"igo.geo.timeFilter.hour")),j(2),z("formControl",e.beginHourFormControl),Or("disabled",!e.currentFilter.active),j(),z("ngForOf",e.beginHours),j(3),bt(ce(10,10,"igo.geo.timeFilter.minute")),j(2),z("formControl",e.beginMinuteFormControl),Or("disabled",!e.currentFilter.active),j(),z("ngForOf",e.beginMinutes)}}function zSe(r,i){if(r&1&&($(0,"mat-option",37),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function $Se(r,i){if(r&1&&($(0,"mat-option",37),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function WSe(r,i){if(r&1){let e=We();$(0,"div",32)(1,"mat-form-field",33)(2,"mat-label"),_e(3),le(4,"translate"),ee(),$(5,"mat-select",34),ve("selectionChange",function(){we(e),ne();let o=Xt(4),s=ne(3);return xe(s.changeTemporalProperty(o.value,2))}),Pe(6,zSe,2,2,"mat-option",35),ee()(),$(7,"mat-form-field",36)(8,"mat-label"),_e(9),le(10,"translate"),ee(),$(11,"mat-select",34),ve("selectionChange",function(){we(e),ne();let o=Xt(4),s=ne(3);return xe(s.changeTemporalProperty(o.value,2))}),Pe(12,$Se,2,2,"mat-option",35),ee()()()}if(r&2){let e=ne(4);j(3),bt(ce(4,8,"igo.geo.timeFilter.hour")),j(2),z("formControl",e.endHourFormControl),Or("disabled",!e.currentFilter.active),j(),z("ngForOf",e.endHours),j(3),bt(ce(10,10,"igo.geo.timeFilter.minute")),j(2),z("formControl",e.endMinuteFormControl),Or("disabled",!e.currentFilter.active),j(),z("ngForOf",e.endMinutes)}}function HSe(r,i){if(r&1){let e=We();$(0,"div",25)(1,"mat-form-field",26),ct(2,"mat-datepicker-toggle",18),$(3,"input",27,5),le(5,"translate"),ve("dateChange",function(){we(e);let o=Xt(4),s=ne(3);return xe(s.changeTemporalProperty(o.value,2))}),ee(),ct(6,"span",28),$(7,"mat-datepicker",29,2),ve("yearSelected",function(o){we(e);let s=Xt(8),l=ne(3);return xe(l.yearSelected(o,s,"end"))})("monthSelected",function(o){we(e);let s=Xt(8),l=ne(3);return xe(l.monthSelected(o,s,"end"))}),ee()(),Pe(9,WSe,13,12,"div",30),ee()}if(r&2){let e=Xt(8),n=ne(3);j(2),z("for",e)("disabled",n.filterStateDisable),j(),z("matDatepicker",e)("placeholder",ce(5,13,"igo.geo.timeFilter.endDate"))("matDatepickerFilter",n.filterEndFunction)("value",n.endValue?n.endValue:n.handleDate(n.datasource.options.maxDate))("min",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("max",n.handleDate(n.datasource.options.maxDate))("disabled",n.filterStateDisable),Or("disabled",!n.currentFilter.active),j(4),z("startView",n.calendarView())("startAt",n.endValue),j(2),z("ngIf",n.calendarType()==="datetime")}}function qSe(r,i){if(r&1){let e=We();$(0,"div",24)(1,"div",25)(2,"mat-form-field",26),ct(3,"mat-datepicker-toggle",18),$(4,"input",27,4),le(6,"translate"),ve("dateChange",function(){we(e);let o=Xt(5),s=ne(2);return xe(s.changeTemporalProperty(o.value,1))}),ee(),ct(7,"span",28),$(8,"mat-datepicker",29,0),ve("yearSelected",function(o){we(e);let s=Xt(9),l=ne(2);return xe(l.yearSelected(o,s,"begin"))})("monthSelected",function(o){we(e);let s=Xt(9),l=ne(2);return xe(l.monthSelected(o,s,"begin"))}),ee()(),Pe(10,USe,13,12,"div",30),ee(),Pe(11,HSe,10,15,"div",31),$(12,"div",21)(13,"button",22),le(14,"translate"),ve("click",function(){we(e);let o=ne(2);return xe(o.resetFilter())}),$(15,"mat-icon"),_e(16),ee()(),$(17,"mat-slide-toggle",23),le(18,"translate"),ve("change",function(){we(e);let o=ne(2);return xe(o.toggleFilterState())}),ee()()()}if(r&2){let e=Xt(9),n=ne(2);j(3),z("for",e)("disabled",n.filterStateDisable),j(),z("matDatepicker",e)("placeholder",ce(6,19,"igo.geo.timeFilter.startDate"))("matDatepickerFilter",n.filterBeginFunction)("value",n.beginValue?n.beginValue:n.handleDate(n.datasource.options.minDate))("min",n.handleDate(n.datasource.options.minDate))("max",n.endValue&&!n.restrictedToStep()?n.endValue:n.handleDate(n.datasource.options.maxDate))("disabled",n.filterStateDisable),Or("disabled",!n.currentFilter.active),j(4),z("startView",n.calendarView())("startAt",n.beginValue),j(2),z("ngIf",n.calendarType()==="datetime"),j(),z("ngIf",!n.restrictedToStep()),j(2),z("matTooltip",ce(14,21,"igo.geo.filter.resetFilters"))("disabled",n.filterStateDisable),j(3),bt(n.resetIcon),j(),z("matTooltip",ce(18,23,"igo.geo.filter.toggleFilterState"))("checked",!n.filterStateDisable)}}function YSe(r,i){if(r&1&&($(0,"div"),Pe(1,GSe,28,35,"div",13)(2,qSe,19,25,"div",14),ee()),r&2){let e=ne();j(),z("ngIf",e.calendarTypeYear),j(),z("ngIf",e.calendarType()!=="year")}}var gC=(()=>{class r{ogcFilterTimeService;datasource;currentFilter;changeProperty=new Ke;beginHours;endHours;beginMinutes;endMinutes;beginHourFormControl=new zc;beginMinuteFormControl=new zc;endHourFormControl=new zc;endMinuteFormControl=new zc;_beginValue;_endValue;_defaultMin="1900-01-01";_defaultMax="2052-01-06";_defaultDisplayFormat="DD/MM/YYYY HH:mm A";_defaultSliderModeEnabled=!0;ogcFilterOperator=_i;sliderMode=!1;defaultStepMillisecond=6e4;options;onlyYearBegin;onlyYearEnd;calendarTypeYear=!1;resetIcon="replay";filterStateDisable;endDatepickerTime;beginDatepickerTime;beginTime;endTime;filterOriginConfig;get step(){return this.datasource.options.stepDate?this.datasource.options.stepDate:this.currentFilter.step}get stepMilliseconds(){let e=ln.default.duration(this.step).asMilliseconds();return e===0?this.defaultStepMillisecond:e}set beginValue(e){this._beginValue=e}get beginValue(){return this._beginValue}set endValue(e){this._endValue=e}get endValue(){return this._endValue}get sliderInterval(){return this.currentFilter.sliderInterval===void 0?2e3:this.currentFilter.sliderInterval}get maxDate(){return this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}get displayFormat(){return this.currentFilter.displayFormat?this.currentFilter.displayFormat:this._defaultDisplayFormat}filterBeginFunction;filterEndFunction;constructor(e){this.ogcFilterTimeService=e}ngOnInit(){this.filterOriginConfig=this.datasource.options.ogcFilters.filters,this.currentFilter.sliderOptions&&(this.currentFilter.sliderOptions.enabled=this.currentFilter.sliderOptions.enabled!==void 0?this.currentFilter.sliderOptions.enabled:this._defaultSliderModeEnabled),this.beginValue=this.parseFilter(this.handleMin()),this.endValue=this.parseFilter(this.handleMax()),this.onlyYearBegin=this.beginValue.getUTCFullYear(),this.onlyYearEnd=this.endValue.getUTCFullYear(),this.calendarTypeYear=this.isCalendarYearMode(),this.setFilterStateDisable(),this.updateHoursMinutesArray(),this.updateValues(),this.dateFilter(this.filterBeginFunction,"begin"),this.dateFilter(this.filterEndFunction,"end")}parseFilter(e){if(e){if(isNaN(new Date(e).getTime())){if(e.search("now")>=0){let n=e.match(/years|months|weeks|days|hours|seconds/);if(e.match(/\+/)){let o=parseInt(e.substring(e.indexOf("+")+1,n.index),10);return(0,ln.default)().add(o,n[0]).toDate()}if(e.match(/\-/)){let o=parseInt(e.substring(e.indexOf("-")+1,n.index),10);return(0,ln.default)().subtract(o,n[0]).toDate()}return new Date}if(e.search("today")>=0){let n=(0,ln.default)().endOf("day").toDate(),o=e.match(/years|months|weeks|days|hours|seconds/);if(e.match(/\+/)){let s=parseInt(e.substring(e.indexOf("+")+1,o.index),10);return(0,ln.default)(n).add(s,o[0]).toDate()}if(e.match(/\-/)){let s=parseInt(e.substring(e.indexOf("-")+1,o.index),10);return(0,ln.default)(n).subtract(s,o[0]).toDate()}return n}return new Date}}else return new Date;return this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(e):e?new Date(e):new Date}changeTemporalProperty(e,n,o=!0){typeof e=="string"&&(e=new Date(e));let s=this.getDateTime(e,n);if(this.isCalendarYearMode()){let l;n===1?(this.beginValue=e,this.onlyYearBegin=this.beginValue.getFullYear(),l=`${this.onlyYearBegin}-01-01`):(this.endValue=e,this.onlyYearEnd=this.endValue.getFullYear(),l=`${this.onlyYearEnd}-12-31`),this.changeProperty.next({value:l,pos:n,refreshFilter:o});return}n===2&&this.calendarType()==="date"&&!this.sliderMode&&(s=(0,ln.default)(s).endOf("day").toDate()),n===1?(this.beginValue=s,this.restrictedToStep()&&this.changeTemporalProperty(this.ogcFilterTimeService.addStep(s,this.stepMilliseconds),2,o)):this.endValue=s,this.updateHoursMinutesArray(),this.changeProperty.next({value:s.toISOString(),pos:n,refreshFilter:o})}handleDate(e){if(!(!e||e===""))return typeof e=="string"&&this.currentFilter.calendarModeYear?this.getDateFromStringWithoutTime(e):new Date(e)}calendarType(){return this.currentFilter.calendarModeYear?"year":this.stepMilliseconds<864e5?"datetime":"date"}isCalendarYearMode(){return this.calendarType()==="year"}yearOnlyInputChange(e,n,o){let s=e.target.value,l=this.getDateFromStringWithoutTime(s);this.yearSelected(l,n,o)}yearSelected(e,n,o,s=!0){this.ogcFilterTimeService.stepIsYearDuration(this.step)&&(n&&n.close(),o==="end"?e=(0,ln.default)(e).endOf("year").toDate():o==="begin"&&this.restrictedToStep()&&!this.calendarTypeYear&&this.yearSelected(e,void 0,"end"),this.changeTemporalProperty(e,o==="begin"?1:2,s))}monthSelected(e,n,o,s=!0){this.ogcFilterTimeService.stepIsMonthDuration(this.step)&&(n&&n.close(),o==="end"?e=(0,ln.default)(e).endOf("month").toDate():o==="begin"&&this.restrictedToStep()&&this.monthSelected(e,void 0,"end"),this.changeTemporalProperty(e,o==="begin"?1:2,s))}calendarView(){let e=this.stepMilliseconds,n=Math.abs(this.parseFilter(this.currentFilter.end).getTime()-this.parseFilter(this.currentFilter.begin).getTime());return this.ogcFilterTimeService.stepIsYearDuration(this.step)?"multi-year":this.ogcFilterTimeService.stepIsMonthDuration(this.step)?"year":e<864e5&&n<864e5?"clock":"month"}dateFilter(e,n){let o=new Date(n),s=o.getTime()-new Date(this.handleMin()).getTime();if(this.ogcFilterTimeService.stepIsYearDuration(this.step)){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"years",!0);if(e==="end"){let h=(0,ln.default)(o).add(1,"d"),p=(0,ln.default)(h).diff((0,ln.default)(this.handleMin()),"years",!0);this.filterEndFunction=p%ln.default.duration(this.step).asYears()===0;return}else if(e==="begin"){this.filterBeginFunction=l%ln.default.duration(this.step).asYears()===0;return}}else if(this.ogcFilterTimeService.stepIsMonthDuration(this.step)){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"months",!0);if(e==="end"){let h=(0,ln.default)(o).add(1,"d"),p=(0,ln.default)(h).diff((0,ln.default)(this.handleMin()),"months",!0);this.filterEndFunction=p%ln.default.duration(this.step).asMonths()===0;return}else if(e==="begin"){this.filterBeginFunction=l%ln.default.duration(this.step).asMonths()===0;return}}else if(this.ogcFilterTimeService.stepIsWeekDuration(this.step)){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"weeks",!0);if(e==="end"){let h=(0,ln.default)(o).add(1,"d"),p=(0,ln.default)(h).diff((0,ln.default)(this.handleMin()),"weeks",!0);this.filterEndFunction=p%ln.default.duration(this.step).asWeeks()===0;return}else if(e==="begin"){this.filterBeginFunction=l%ln.default.duration(this.step).asWeeks()===0;return}}else if(this.ogcFilterTimeService.stepIsDayDuration(this.step)){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"days",!0);if(e==="end"){let h=(0,ln.default)(o).add(1,"d"),m=(0,ln.default)(h).diff((0,ln.default)(this.handleMin()),"days",!0)%ln.default.duration(this.step).asDays();this.filterEndFunction=m<1e-7&&m>-1e-7||m===0;return}else if(e==="begin"){let h=l%ln.default.duration(this.step).asDays()+1;this.filterBeginFunction=h<1e-7&&h>-1e-7&&h!==0||h===1;return}}else if(this.ogcFilterTimeService.stepIsHourDuration(this.step)){if(e==="end"){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"hours",!0);this.filterEndFunction=l%ln.default.duration(this.step).asHours()===0;return}else if(e==="begin"){let l=(0,ln.default)(o).diff((0,ln.default)(this.handleMin()),"hours",!0);this.filterBeginFunction=l%ln.default.duration(this.step).asHours()===0;return}}else if(this.ogcFilterTimeService.stepIsMinuteDuration(this.step)){if(e==="end"){this.filterEndFunction=!0;return}else if(e==="begin"){this.filterBeginFunction=!0;return}}this.filterEndFunction=s%this.stepMilliseconds===0,this.filterBeginFunction=s%this.stepMilliseconds===0}getDateTime(e,n){let o=new Date(e),s;if(!this.sliderMode)switch(n){case 1:if(this.currentFilter.calendarModeYear){s=o.setHours(0,0);break}else{s=o.setHours(this.beginHourFormControl.value,this.beginMinuteFormControl.value);break}case 2:if(this.currentFilter.calendarModeYear){s=o.setHours(0,0);break}else{s=o.setHours(this.endHourFormControl.value,this.endMinuteFormControl.value);break}}return new Date(s||o)}handleMinuteIncrement(){return this.ogcFilterTimeService.stepIsMinuteDuration(this.step)?this.stepMilliseconds<36e5?this.stepMilliseconds/1e3===60?1:this.stepMilliseconds/1e3:this.stepMilliseconds%36e5/60:this.ogcFilterTimeService.stepIsHourDuration(this.step)?60:1}handleHourIncrement(){return this.ogcFilterTimeService.stepIsHourDuration(this.step)?this.stepMilliseconds/1e3/60/60:1}fullBeginHoursArray(e){e?this.beginHours=Array.from({length:(this.endHourFormControl.value-0)/this.handleHourIncrement()+1},(n,o)=>0+o*this.handleHourIncrement()):this.beginHours=Array.from({length:23/this.handleHourIncrement()+1},(n,o)=>0+o*this.handleHourIncrement()),this.beginHourFormControl.setValue(this.beginValue.getHours())}fullEndHoursArray(e){e?this.endHours=Array.from({length:(23-this.beginHourFormControl.value)/this.handleHourIncrement()+1},(n,o)=>this.beginHourFormControl.value+o*this.handleHourIncrement()):this.endHours=Array.from({length:23/this.handleHourIncrement()+1},(n,o)=>0+o*this.handleHourIncrement()),this.endHourFormControl.setValue(this.endValue.getHours())}fullBeginMinutesArray(e){e?this.beginMinutes=Array.from({length:(this.endMinuteFormControl.value-0)/this.handleMinuteIncrement()+1},(n,o)=>0+o*this.handleMinuteIncrement()):this.beginMinutes=Array.from({length:59/this.handleMinuteIncrement()+1},(n,o)=>0+o*this.handleMinuteIncrement()),this.beginMinuteFormControl.setValue(this.beginValue.getMinutes())}fullEndMinutesArray(e){e?this.endMinutes=Array.from({length:(59-this.beginMinuteFormControl.value)/this.handleMinuteIncrement()+1},(n,o)=>this.beginMinuteFormControl.value+o*this.handleMinuteIncrement()):this.endMinutes=Array.from({length:59/this.handleMinuteIncrement()+1},(n,o)=>0+o*this.handleMinuteIncrement()),this.endMinuteFormControl.setValue(this.endValue.getMinutes())}updateHoursMinutesArray(){let e=new Date(this.beginValue),n=new Date(this.endValue);e.setHours(0,0)===n.setHours(0,0)?(this.fullBeginHoursArray(!0),this.fullEndHoursArray(!0),this.beginValue.getHours()===this.endValue.getHours()&&(this.fullBeginMinutesArray(!0),this.fullEndMinutesArray(!0))):(this.fullBeginHoursArray(),this.fullEndHoursArray(),this.fullBeginMinutesArray(),this.fullEndMinutesArray())}updateValues(){this.changeTemporalProperty(this.beginValue,1,!1),this.changeTemporalProperty(this.endValue,2,!0)}restrictedToStep(){return this.currentFilter.restrictToStep?this.currentFilter.restrictToStep:!1}handleMin(){return this.currentFilter.begin?this.currentFilter.begin:this.datasource.options.minDate?this.datasource.options.minDate:this._defaultMin}handleMax(){return this.currentFilter.end?this.currentFilter.end:this.datasource.options.maxDate?this.datasource.options.maxDate:this._defaultMax}changePropertyByPass(e){this.changeProperty.next(e)}modeChange(e){e.checked||this.updateValues()}setFilterStateDisable(){this.currentFilter?this.filterStateDisable=!this.currentFilter.active:this.filterStateDisable=!1,this.calendarType()==="datetime"&&(this.filterStateDisable===!0?(this.beginHourFormControl.disable(),this.beginMinuteFormControl.disable(),this.endHourFormControl.disable(),this.endMinuteFormControl.disable()):(this.beginHourFormControl.enable(),this.beginMinuteFormControl.enable(),this.endHourFormControl.enable(),this.endMinuteFormControl.enable()))}getDateFromStringWithoutTime(e){let n,o="01",s="01";if(e.length===10){let l=e.split("-");if(l.length!==3)throw new Error("Error in config date begin-end for ogcFilter: Date without time format need to be YYYY-MM-DD or YYYY");n=l[0],o=l[1],s=l[2]}else if(e.length===4)n=e;else return new Date(e);return new Date(`${n}-${o}-${s} 00:00:00`)}resetFilter(){let e,n,o,s;this.calendarTypeYear?(this.filterOriginConfig.end==="today"?s=`${new Date().toLocaleDateString("en-CA").substring(0,4)}-01-01`:s=`${this.filterOriginConfig.end.substring(0,4)}-01-01`,o=`${this.filterOriginConfig.begin.substring(0,4)}-01-01`,e=this.getDateFromStringWithoutTime(o),n=this.getDateFromStringWithoutTime(s)):(e=this.parseFilter(this.filterOriginConfig.begin),n=this.parseFilter(this.filterOriginConfig.end),o=e.toISOString(),s=n.toISOString()),(this.currentFilter.begin!==o||this.currentFilter.end!==s)&&(this.beginValue=e,this.endValue=n,this.updateValues())}toggleFilterState(){this.currentFilter.active===!0?this.currentFilter.active=!1:this.currentFilter.active=!0,this.setFilterStateDisable(),this.updateValues()}static \u0275fac=function(n){return new(n||r)(Ie(Bg))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter-time"]],viewQuery:function(n,o){if(n&1&&(Ir(kSe,5),Ir(OSe,5),Ir(DSe,5),Ir(RSe,5)),n&2){let s;bi(s=wi())&&(o.endDatepickerTime=s.first),bi(s=wi())&&(o.beginDatepickerTime=s.first),bi(s=wi())&&(o.beginTime=s.first),bi(s=wi())&&(o.endTime=s.first)}},inputs:{datasource:"datasource",currentFilter:"currentFilter"},outputs:{changeProperty:"changeProperty"},standalone:!0,features:[Xi([Bg,RG()]),lt],decls:4,vars:3,consts:[["beginDatepicker",""],["beginYear",""],["endDatepicker",""],["endYear",""],["begin",""],["end",""],[1,"datetime-container"],[3,"ngModel","ngModelChange","change",4,"ngIf"],["class","slider-container",4,"ngIf"],[4,"ngIf"],[3,"ngModelChange","change","ngModel"],[1,"slider-container"],[3,"changeProperty","begin","max","currentFilter","datasource"],["class","year-input-container",4,"ngIf"],["class","datetime-input-container",4,"ngIf"],[1,"year-input-container"],["subscriptSizing","dynamic",1,"year-input"],["matInput","",1,"year-input-only-year",3,"change","value","disabled"],["matSuffix","",3,"for","disabled"],["panelClass","datepicker-year",3,"yearSelected","startView","startAt"],["matInput","","enabled","false","readonly","true",1,"year-input-hide",3,"matDatepicker","value","min","max"],[1,"actions-container"],["mat-icon-button","","color","primary",1,"reset-button",3,"click","matTooltip","disabled"],["tooltip-position","below","matTooltipShowDelay","500",1,"toggle-filter-state",3,"change","matTooltip","checked"],[1,"datetime-input-container"],[1,"datetime-input"],["subscriptSizing","dynamic",1,"date-input"],["matInput","",3,"dateChange","matDatepicker","placeholder","matDatepickerFilter","value","min","max","disabled"],[1,"filler"],[3,"yearSelected","monthSelected","startView","startAt"],["class","time-input",4,"ngIf"],["class","datetime-input",4,"ngIf"],[1,"time-input"],["subscriptSizing","dynamic",1,"hour-input"],[3,"selectionChange","formControl"],[3,"value",4,"ngFor","ngForOf"],["subscriptSizing","dynamic",1,"minute-input"],[3,"value"]],template:function(n,o){n&1&&($(0,"div",6),Pe(1,NSe,3,4,"mat-slide-toggle",7)(2,BSe,2,4,"div",8)(3,YSe,3,2,"div",9),ee()),n&2&&(j(),z("ngIf",o.currentFilter.sliderOptions==null?null:o.currentFilter.sliderOptions.enabled),j(),z("ngIf",o.sliderMode),j(),z("ngIf",!o.sliderMode))},dependencies:[Gt,bl,js,Sn,kn,nc,o8,jr,Gr,Mo,Vc,gn,Cn,zG,jG,VG,UG,Vt,ci,Qt,ti,jt,$t,ho,uo,Nn,Sa,Th,Li,Bn,Et,Tt],styles:[`[_nghost-%COMP%]     input{text-align:center!important;margin:auto 5px!important}[_nghost-%COMP%]   .slider-container[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex-wrap:wrap}[_nghost-%COMP%]   .datetime-input-container[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}[_nghost-%COMP%]   .datetime-input[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .date-input[_ngcontent-%COMP%]{width:154px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:16px}[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%] > [_ngcontent-%COMP%]:not(:last-child){margin-right:8px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .time-input[_ngcontent-%COMP%]{margin-top:4px}}[_nghost-%COMP%]   .hour-input[_ngcontent-%COMP%], [_nghost-%COMP%]   .minute-input[_ngcontent-%COMP%]{width:100px}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .year-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]:not(:last-child){margin-right:4px}[_nghost-%COMP%]   .year-input-hide[_ngcontent-%COMP%]{width:120px;margin-right:25px;display:none}[_nghost-%COMP%]   .year-input-only-year[_ngcontent-%COMP%]{width:120px;margin-right:25px;text-align:left!important}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-arrow{display:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-period-button{pointer-events:none}[_nghost-%COMP%]     .datepicker-year   .mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover{background-color:#0000001f;border-radius:999px}
/*# sourceMappingURL=ogc-filter-time.component-DI7CYQF4.css.map */`]})}return r})();var ZSe=(r,i)=>({logical:r,logicalHidden:i}),XSe=(r,i)=>({operator:r,dualInput:i}),KSe=()=>["expression","pattern"],QSe=()=>["lowerBoundary","begin"],JSe=()=>["upperBoundary","end"];function e2e(r,i){if(r&1&&($(0,"mat-option",26),_e(1),ee()),r&2){let e=i.$implicit;z("value",e.alias)("id",e.name)("matTooltip",e.alias),j(),Qe(" ",e.alias," ")}}function t2e(r,i){if(r&1){let e=We();$(0,"button",27),ve("click",function(){we(e);let o=ne(2);return xe(o.clearSelectedField())}),$(1,"mat-icon"),_e(2,"close"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active)}}function i2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",21),ve("mouseenter",function(){we(e);let o=ne();return xe(o.inputClearable="selectField")})("mouseleave",function(){we(e);let o=ne();return xe(o.inputClearable=void 0)}),$(1,"input",22),le(2,"translate"),le(3,"async"),le(4,"async"),le(5,"async"),le(6,"async"),le(7,"translate"),ve("input",function(o){we(e);let s=ne();return xe(s.updateFieldsList(o.target.value))}),ee(),$(8,"mat-autocomplete",23,0),ve("optionSelected",function(o){we(e);let s=ne();return xe(s.changeField(o.option.id))}),Pe(10,e2e,2,4,"mat-option",24),le(11,"async"),ee(),Pe(12,t2e,3,1,"button",25),ee()}if(r&2){let e=Xt(9),n=ne();z("floatLabel",n.floatLabel),j(),z("placeholder",ce(2,8,"igo.geo.sourceFields.selectField"))("disabled",!n.currentFilter.active)("matAutocomplete",e)("value",ce(3,10,n.selectedField$)?ce(4,12,n.selectedField$).alias:"")("matTooltip",ce(5,14,n.selectedField$)?ce(6,16,n.selectedField$).alias:ce(7,18,"igo.geo.sourceFields.selectField")),j(9),z("ngForOf",ce(11,20,n.filteredFields$)),j(2),z("ngIf",n.currentFilter.propertyName&&n.inputClearable==="selectField"&&n.currentFilter.active)}}function r2e(r,i){if(r&1&&($(0,"mat-option",8),le(1,"translate"),_e(2),le(3,"translate"),ee()),r&2){let e=i.$implicit;z("value",e.key)("matTooltip",ce(1,3,"igo.geo.operators.tooltip."+e.key)),j(2),Qe(" ",ce(3,5,"igo.geo.operators."+e.key)," ")}}function n2e(r,i){if(r&1&&($(0,"mat-option",31),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e.type),j(),Qe(" ",ce(2,2,"igo.geo.spatialSelector."+e.type)," ")}}function o2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",28)(1,"mat-select",29),ve("selectionChange",function(o){we(e);let s=ne();return xe(s.changeSpatialSelector(o.value))}),Pe(2,n2e,3,4,"mat-option",30),ee()()}if(r&2){let e=ne();j(),z("disabled",!e.currentFilter.active)("value",e.currentFilter.igoSpatialSelector),j(),z("ngForOf",e.igoSpatialSelectors)}}function a2e(r,i){if(r&1&&($(0,"mat-option",34),_e(1),ee()),r&2){let e=i.$implicit;z("value",e)("matTooltip",e),j(),Qe(" ",e," ")}}function s2e(r,i){if(r&1){let e=We();$(0,"button",27),ve("click",function(){we(e);let o=ne(2);return xe(o.clearProperty())}),$(1,"mat-icon"),_e(2,"close"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active)}}function l2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",32),ve("mouseenter",function(){we(e);let o=ne();return xe(o.inputClearable="selectProperty")})("mouseleave",function(){we(e);let o=ne();return xe(o.inputClearable=void 0)}),$(1,"input",22),le(2,"translate"),ve("input",function(o){we(e);let s=ne();return xe(s.updateValuesList(o.target.value))}),ee(),$(3,"mat-autocomplete",23,1),ve("optionSelected",function(o){we(e);let s=ne();return xe(s.changeProperty(o.option.value))}),Pe(5,a2e,2,3,"mat-option",33),le(6,"async"),ee(),Pe(7,s2e,3,1,"button",25),ee()}if(r&2){let e=Xt(4),n=ne();z("floatLabel",n.floatLabel),j(),z("placeholder",ce(2,8,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",e)("value",n.detectProperty()==="expression"?n.currentFilter.expression:n.currentFilter.pattern)("matTooltip",n.detectProperty()==="expression"?n.currentFilter.expression||"":n.currentFilter.pattern||""),j(4),z("ngForOf",ce(6,10,n.filteredValues$)),j(2),z("ngIf",n.isClearable()&&n.inputClearable==="selectProperty"&&n.currentFilter.active)}}function c2e(r,i){if(r&1){let e=We();$(0,"button",27),ve("click",function(){we(e);let o=ne(2);return xe(o.currentFilter.igoSNRC="")}),$(1,"mat-icon"),_e(2,"close"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active&&e.inputClearable==="selectSNRC"&&e.currentFilter.active)}}function u2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",35),ve("mouseenter",function(){we(e);let o=ne();return xe(o.inputClearable="selectSNRC")})("mouseleave",function(){we(e);let o=ne();return xe(o.inputClearable=void 0)}),$(1,"input",36),le(2,"translate"),ve("input",function(o){we(e);let s=ne();return xe(s.changeSNRC(o.target.value))}),ee(),Pe(3,c2e,3,1,"button",25),ee()}if(r&2){let e=ne();z("floatLabel",e.floatLabel),j(),z("placeholder",ce(2,5,"igo.geo.filter.placeholderSnrc"))("value",e.currentFilter.igoSNRC)("matTooltip",e.currentFilter.igoSNRC?e.currentFilter.igoSNRC:""),j(2),z("ngIf",e.currentFilter.igoSNRC)}}function d2e(r,i){if(r&1){let e=We();$(0,"button",38),le(1,"translate"),ve("click",function(){we(e);let o=ne(2);return xe(o.changeMapExtentGeometry())}),$(2,"mat-icon"),_e(3,"zoom_out_map"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active)("disabled",!e.currentFilter.active)("matTooltip",ce(1,3,"igo.geo.spatialSelector.btnSetExtent"))}}function h2e(r,i){if(r&1&&(Dr(0),Pe(1,d2e,4,5,"button",37),Rr()),r&2){let e=ne();j(),z("ngIf",e.currentFilter.igoSpatialSelector==="fixedExtent")}}function p2e(r,i){if(r&1&&($(0,"mat-option",34),_e(1),ee()),r&2){let e=i.$implicit;z("value",e)("matTooltip",e),j(),Qe(" ",e," ")}}function m2e(r,i){if(r&1){let e=We();$(0,"button",27),ve("click",function(){we(e);let o=ne(2);return xe(o.clearProperty(1))}),$(1,"mat-icon"),_e(2,"close"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active)}}function f2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",39),ve("mouseenter",function(){we(e);let o=ne();return xe(o.inputClearable="selectProperty1")})("mouseleave",function(){we(e);let o=ne();return xe(o.inputClearable=void 0)}),$(1,"input",40),le(2,"translate"),ve("input",function(o){we(e);let s=ne();return xe(s.updateValuesList(o.target.value,1))}),ee(),$(3,"mat-autocomplete",23,2),ve("optionSelected",function(o){we(e);let s=ne();return xe(s.changeNumericProperty(o.option.value,1))}),Pe(5,p2e,2,3,"mat-option",33),le(6,"async"),ee(),Pe(7,m2e,3,1,"button",25),ee()}if(r&2){let e=Xt(4),n=ne();z("floatLabel",n.floatLabel),j(),z("placeholder",ce(2,7,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",e)("value",n.detectProperty(1)==="lowerBoundary"?n.currentFilter.lowerBoundary:n.currentFilter.begin),j(4),z("ngForOf",ce(6,9,n.filteredValues$)),j(2),z("ngIf",n.isClearable(1)&&n.inputClearable==="selectProperty1"&&n.currentFilter.active)}}function g2e(r,i){if(r&1&&($(0,"mat-option",34),_e(1),ee()),r&2){let e=i.$implicit;z("value",e)("matTooltip",e),j(),Qe(" ",e," ")}}function _2e(r,i){if(r&1){let e=We();$(0,"button",27),ve("click",function(){we(e);let o=ne(2);return xe(o.clearProperty(2))}),$(1,"mat-icon"),_e(2,"close"),ee()()}if(r&2){let e=ne(2);z("disabled",!e.currentFilter.active)}}function y2e(r,i){if(r&1){let e=We();$(0,"mat-form-field",39),ve("mouseenter",function(){we(e);let o=ne();return xe(o.inputClearable="selectProperty2")})("mouseleave",function(){we(e);let o=ne();return xe(o.inputClearable=void 0)}),$(1,"input",40),le(2,"translate"),ve("input",function(o){we(e);let s=ne();return xe(s.updateValuesList(o.target.value,2))}),ee(),$(3,"mat-autocomplete",23,3),ve("optionSelected",function(o){we(e);let s=ne();return xe(s.changeNumericProperty(o.option.value,2))}),Pe(5,g2e,2,3,"mat-option",33),le(6,"async"),ee(),Pe(7,_2e,3,1,"button",25),ee()}if(r&2){let e=Xt(4),n=ne();z("floatLabel",n.floatLabel),j(),z("placeholder",ce(2,7,"igo.geo.filter.placeholder"))("disabled",!n.currentFilter.active)("matAutocomplete",e)("value",n.detectProperty(2)==="upperBoundary"?n.currentFilter.upperBoundary:n.currentFilter.end),j(4),z("ngForOf",ce(6,9,n.filteredValues$)),j(2),z("ngIf",n.isClearable(2)&&n.inputClearable==="selectProperty2"&&n.currentFilter.active)}}function v2e(r,i){if(r&1){let e=We();$(0,"igo-ogc-filter-time",41),ve("changeProperty",function(o){we(e);let s=ne();return xe(s.changeProperty(o.value,o.pos))}),ee()}if(r&2){let e=ne();z("datasource",e.datasource)("currentFilter",e.currentFilter)}}var a8=(()=>{class r{wktService;ogcFilterOperator=_i;filteredValues$;filteredFields$;allOgcFilterOperators;ogcFilterOperators$=new ut(void 0);igoSpatialSelectors;value="";inputOperator;selectedField$=new ut(void 0);fields$=new ut([]);color="primary";disabled;currentFilterIsSpatial$=new ut(!1);defaultStepMillisecond=6e3;inputClearable;refreshFilters;datasource;map;currentFilter;set snrc(e){let n=/^\d{2}[a-l][0,1][0-9]$/gi,o=/^\d{2}[a-p]$/gi;(/^\d{2}$/gi.test(e)||o.test(e)||n.test(e))&&(this._snrc=e,this.currentFilter.igoSNRC=e)}get snrc(){return this._snrc}_snrc="";floatLabel;get activeFilters(){return this.datasource.options.ogcFilters.interfaceOgcFilters.filter(e=>e.active===!0)}get allowedOperators(){return new us().computeAllowedOperators(this.fields$.value,this.currentFilter.propertyName,this.datasource.options.ogcFilters.allowedOperatorsType)}constructor(e){this.wktService=e,this.allOgcFilterOperators=new us().operators,this.ogcFilterOperators$.next(this.allOgcFilterOperators),this.igoSpatialSelectors=[{type:"fixedExtent"},{type:"snrc"}]}ngOnInit(){if(this.datasource.options.sourceFields){let e=this.datasource.options.sourceFields.filter(n=>n.excludeFromOgcFilters===void 0||!n.excludeFromOgcFilters);e.map(n=>{n.values&&n.values.sort()}),this.fields$.next(e)}this.updateFieldsList(),this.selectedField$.next(this.fields$.value.find(e=>e.name===this.currentFilter.propertyName)),this.updateValuesList(),this.selectedField$.subscribe(()=>{this.ogcFilterOperators$.next(this.allowedOperators),Object.keys(this.allowedOperators).indexOf(this.currentFilter.operator)===-1&&(this.currentFilter.operator=Object.keys(this.allowedOperators)[0],this.currentFilter.operator=Object.keys(this.allowedOperators)[0]),this.updateValuesList()}),this.currentFilterIsSpatial()}updateFieldsList(e){this.filteredFields$=e&&e.length>0?ai(this._filterFields(e)):this.fields$,this.fields$.value.find(n=>n.name===e)&&this.changeField(e)}updateValuesList(e,n){this.filteredValues$=e&&e.length>0?ai(this._filterValues(e)):this.selectedField$.value?ai(this.selectedField$.value.values):ai([]),e&&e.length>=1&&this.changeProperty(e,n)}_filterFields(e){let n=new RegExp(e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.fields$.value.filter(o=>n.test(o.alias.normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}_filterValues(e){let n=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"").toString().normalize("NFD").replace(/[\u0300-\u036f]/g,""),"gi");return this.selectedField$.value?.values?.filter(o=>o&&n.test(o.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"")))}clearSelectedField(){this.currentFilter.propertyName="",this.selectedField$.next(void 0),this.clearProperty()}isClearable(e){let n=this.detectProperty(e);if(n)return this.currentFilter[n]}clearProperty(e){let n=this.detectProperty(e);if(n)return this.currentFilter[n]=""}toggleFilterState(e){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid).active=e.checked,this.refreshFilters()}deleteFilter(){let e=this.datasource.options.ogcFilters;e.interfaceOgcFilters=e.interfaceOgcFilters.filter(n=>n.filterid!==this.currentFilter.filterid),this.refreshFilters()}changeLogical(e){this.currentFilter.parentLogical=e,this.refreshFilters()}changeOperator(e){this.currentFilter.operator=e,this.currentFilterIsSpatial(),this.currentFilterIsSpatial$.value&&this.currentFilter.wkt_geometry.length===0?this.changeSpatialSelector(this.currentFilter.igoSpatialSelector):this.refreshFilters()}changeField(e){this.currentFilter.propertyName=e,this.selectedField$.next(this.fields$.value.find(n=>n.name===this.currentFilter.propertyName)),this.refreshFilters()}changeCaseSensitive(e){this.currentFilter.matchCase=e.checked,this.refreshFilters()}changeProperty(e,n,o=!0){let s=this.detectProperty(n);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(l=>l.filterid===this.currentFilter.filterid)[s]=e,o&&this.refreshFilters())}changeNumericProperty(e,n){this.changeProperty(parseFloat(e),n)}changeSpatialSelector(e){this.currentFilter.igoSpatialSelector=e,e==="fixedExtent"&&this.changeMapExtentGeometry(!1),this.currentFilterIsSpatial(),this.refreshFilters()}changeSNRC(e){this.snrc=e,this.changeSNRCGeometry()}changeSNRCGeometry(){this.datasource.options.ogcFilters.interfaceOgcFilters.find(n=>n.filterid===this.currentFilter.filterid)&&(this.snrc&&this.currentFilter.igoSpatialSelector==="snrc"&&(this.currentFilter.wkt_geometry=this.wktService.snrcToWkt(this.snrc,this.map.projection).wktPoly),this.refreshFilters())}changeMapExtentGeometry(e=!0){this.datasource.options.ogcFilters.interfaceOgcFilters.find(o=>o.filterid===this.currentFilter.filterid)&&(this.currentFilter.igoSpatialSelector==="fixedExtent"&&(this.currentFilter.wkt_geometry=this.wktService.extentToWkt(this.map.projection,this.map.viewController.getExtent(),this.map.projection).wktPoly),e&&this.refreshFilters())}detectProperty(e){switch(this.currentFilter.operator){case _i.PropertyIsNotEqualTo:case _i.PropertyIsEqualTo:case _i.PropertyIsGreaterThan:case _i.PropertyIsGreaterThanOrEqualTo:case _i.PropertyIsLessThan:case _i.PropertyIsLessThanOrEqualTo:return"expression";case _i.PropertyIsLike:return"pattern";case _i.PropertyIsBetween:return e&&e===1?"lowerBoundary":e&&e===2?"upperBoundary":void 0;case _i.During:return e&&e===1?"begin":e&&e===2?"end":void 0;default:return}}currentFilterIsSpatial(){let e=!1;this.currentFilter&&(e=[_i.Contains,_i.Intersects,_i.Within].indexOf(this.currentFilter.operator)!==-1),this.currentFilterIsSpatial$.next(e)}isTemporalOperator(){return this.currentFilter.operator.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}static \u0275fac=function(n){return new(n||r)(Ie(kJ))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter-form"]],inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",currentFilter:"currentFilter",floatLabel:"floatLabel"},standalone:!0,features:[lt],decls:44,vars:76,consts:[["autoCompleteField","matAutocomplete"],["autoCompleteValues","matAutocomplete"],["autoDualValueOperator1","matAutocomplete"],["autoDualValueOperator2","matAutocomplete"],[1,"ogc-filter-form-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"click","change","matTooltip","checked"],[3,"ngClass"],["tooltip-position","above","matTooltipShowDelay","500",3,"selectionChange","disabled","value","matTooltip"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip"],["class","field",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"ngClass","floatLabel"],["tooltip-position","below","matTooltipShowDelay","500",3,"selectionChange","matTooltip","disabled","value"],["tooltip-position","above","matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["class","spatialSelector",4,"ngIf"],["class","singleInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[1,"igo-layer-button-group"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"],["class","snrc",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[4,"ngIf"],["class","dualInput",3,"floatLabel","mouseenter","mouseleave",4,"ngIf"],[3,"datasource","currentFilter","changeProperty",4,"ngIf"],[1,"field",3,"mouseenter","mouseleave","floatLabel"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"input","placeholder","disabled","matAutocomplete","value","matTooltip"],[3,"optionSelected"],["matTooltipShowDelay","500",3,"value","id","matTooltip",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"disabled","click",4,"ngIf"],["matTooltipShowDelay","500",3,"value","id","matTooltip"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click","disabled"],[1,"spatialSelector"],[3,"selectionChange","disabled","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"singleInput",3,"mouseenter","mouseleave","floatLabel"],["matTooltipShowDelay","500",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipShowDelay","500",3,"value","matTooltip"],[1,"snrc",3,"mouseenter","mouseleave","floatLabel"],["matInput","","tooltip-position","above","matTooltipShowDelay","500",3,"input","placeholder","value","matTooltip"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","click",4,"ngIf"],["matSuffix","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","disabled","matTooltip"],[1,"dualInput",3,"mouseenter","mouseleave","floatLabel"],["matInput","","type","number",3,"input","placeholder","disabled","matAutocomplete","value"],[3,"changeProperty","datasource","currentFilter"]],template:function(n,o){n&1&&($(0,"div",4)(1,"mat-checkbox",5),le(2,"translate"),ve("click",function(l){return l.stopPropagation()})("change",function(l){return o.toggleFilterState(l)}),ee(),$(3,"mat-form-field",6)(4,"mat-select",7),le(5,"translate"),ve("selectionChange",function(l){return o.changeLogical(l.value)}),$(6,"mat-option",8),le(7,"translate"),_e(8),le(9,"translate"),ee(),$(10,"mat-option",8),le(11,"translate"),_e(12),le(13,"translate"),ee()()(),Pe(14,i2e,13,22,"mat-form-field",9),le(15,"async"),le(16,"async"),le(17,"async"),le(18,"async"),$(19,"mat-form-field",10),le(20,"async"),le(21,"async"),$(22,"mat-select",11),le(23,"translate"),le(24,"translate"),ve("selectionChange",function(l){return o.changeOperator(l.value)}),Pe(25,r2e,4,7,"mat-option",12),le(26,"async"),le(27,"keyvalue"),ee()(),Pe(28,o2e,3,3,"mat-form-field",13),le(29,"async"),Pe(30,l2e,8,12,"mat-form-field",14),$(31,"div",15)(32,"button",16),le(33,"translate"),ve("click",function(){return o.deleteFilter()}),$(34,"mat-icon"),_e(35,"delete"),ee()()(),Pe(36,u2e,4,7,"mat-form-field",17),le(37,"async"),Pe(38,h2e,2,1,"ng-container",18),le(39,"async"),ee(),$(40,"div",4),Pe(41,f2e,8,11,"mat-form-field",19)(42,y2e,8,11,"mat-form-field",19),ee(),Pe(43,v2e,1,2,"igo-ogc-filter-time",20)),n&2&&(j(),z("matTooltip",ce(2,27,"igo.geo.filter.toggleFilterState"))("checked",o.currentFilter.active),j(2),z("ngClass",Ys(67,ZSe,o.activeFilters.indexOf(o.currentFilter)!==0&&o.currentFilter.active===!0,o.activeFilters.indexOf(o.currentFilter)===0||o.currentFilter.active!==!0)),j(),z("disabled",!o.currentFilter.active)("value",o.currentFilter.parentLogical)("matTooltip",o.currentFilter.parentLogical?ce(5,29,"igo.geo.operators.tooltip."+o.currentFilter.parentLogical):""),j(2),z("value",o.ogcFilterOperator.And)("matTooltip",ce(7,31,"igo.geo.operators.tooltip.And")),j(2),Qe(" ",ce(9,33,"igo.geo.operators.And")," "),j(2),z("value",o.ogcFilterOperator.Or)("matTooltip",ce(11,35,"igo.geo.operators.tooltip.Or")),j(2),Qe(" ",ce(13,37,"igo.geo.operators.Or")," "),j(2),z("ngIf",ce(15,39,o.currentFilterIsSpatial$)===!1&&ce(16,41,o.fields$)&&ce(17,43,o.fields$).length>0&&ce(18,45,o.fields$)[0].name!==""),j(5),z("ngClass",Ys(70,XSe,ce(20,47,o.currentFilterIsSpatial$)===!1,ce(21,49,o.currentFilterIsSpatial$)))("floatLabel",o.floatLabel),j(3),z("matTooltip",o.currentFilter.operator?ce(23,51,"igo.geo.operators.tooltip."+o.currentFilter.operator):ce(24,53,"igo.geo.filter.selectOperator"))("disabled",!o.currentFilter.active)("value",o.currentFilter.operator),j(3),z("ngForOf",ce(27,57,ce(26,55,o.ogcFilterOperators$))),j(3),z("ngIf",ce(29,59,o.currentFilterIsSpatial$)),j(2),z("ngIf",Ih(73,KSe).indexOf(o.detectProperty())!==-1),j(2),z("matTooltip",ce(33,61,"igo.geo.filter.removeFilter")),j(4),z("ngIf",ce(37,63,o.currentFilterIsSpatial$)&&o.currentFilter.igoSpatialSelector==="snrc"),j(2),z("ngIf",ce(39,65,o.currentFilterIsSpatial$)&&o.currentFilter.igoSpatialSelector==="fixedExtent"),j(3),z("ngIf",!o.isTemporalOperator()&&Ih(74,QSe).indexOf(o.detectProperty(1))!==-1),j(),z("ngIf",!o.isTemporalOperator()&&Ih(75,JSe).indexOf(o.detectProperty(2))!==-1),j(),z("ngIf",o.isTemporalOperator()))},dependencies:[hl,ac,Qt,ti,jr,Gr,Vc,_a,ho,uo,Nn,Bn,Gt,gn,Cn,Oh,kh,Su,Li,Vt,ci,jt,$t,gC,Ei,E1,Et,Tt],styles:[`[_nghost-%COMP%]{width:100%;padding:5px 10px}[_nghost-%COMP%]     .mat-mdc-form-field .mat-icon svg{width:1em;height:1em;color:#d3d3d3}[_nghost-%COMP%]   .ogc-filter-form-container[_ngcontent-%COMP%]{display:flex}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-select-arrow[_ngcontent-%COMP%]{visibility:hidden}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{margin-top:10px}[_nghost-%COMP%]   .logical[_ngcontent-%COMP%]{flex-flow:column nowrap;width:100%;max-width:60px;margin-right:5px}[_nghost-%COMP%]   .logicalHidden[_ngcontent-%COMP%]{width:0px;visibility:hidden;max-width:0px}[_nghost-%COMP%]     .logical .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]     .logicalHidden .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .field[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .field .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .operator[_ngcontent-%COMP%]{width:150px;margin-right:5px;text-align:center}[_nghost-%COMP%]     .operator .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .spatialSelector[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .spatialSelector .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   .singleInput[_ngcontent-%COMP%]{width:27%}}[_nghost-%COMP%]   .snrc[_ngcontent-%COMP%]{width:110px;margin-right:5px}[_nghost-%COMP%]     .singleInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .dualInput[_ngcontent-%COMP%]{width:150px;margin-right:5px}[_nghost-%COMP%]     .dualInput .mat-mdc-select-arrow{visibility:hidden}[_nghost-%COMP%]   .igo-layer-button-group[_ngcontent-%COMP%]{display:flex;padding-top:5px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{display:flex}
/*# sourceMappingURL=ogc-filter-form.component-APKYG7JK.css.map */`]})}return r})();var b2e=["button"],w2e=["*"];function x2e(r,i){if(r&1&&ct(0,"mat-pseudo-checkbox",3),r&2){let e=ne();z("disabled",e.disabled)}}function S2e(r,i){if(r&1&&ct(0,"mat-pseudo-checkbox",3),r&2){let e=ne();z("disabled",e.disabled)}}var i3=new Ln("MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS",{providedIn:"root",factory:C2e});function C2e(){return{hideSingleSelectionIndicator:!1,hideMultipleSelectionIndicator:!1,disabledInteractive:!1}}var DJ=new Ln("MatButtonToggleGroup"),A2e={provide:Yu,useExisting:Dl(()=>Gu),multi:!0},RJ=0,JT=class{constructor(i,e){this.source=i,this.value=e}},Gu=(()=>{class r{get name(){return this._name}set name(e){this._name=e,this._markButtonsForCheck()}get value(){let e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e.map(n=>n.value):e[0]?e[0].value:void 0}set value(e){this._setSelectionByValue(e),this.valueChange.emit(this.value)}get selected(){let e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e:e[0]||null}get multiple(){return this._multiple}set multiple(e){this._multiple=e,this._markButtonsForCheck()}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._markButtonsForCheck()}get disabledInteractive(){return this._disabledInteractive}set disabledInteractive(e){this._disabledInteractive=e,this._markButtonsForCheck()}get dir(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}get hideSingleSelectionIndicator(){return this._hideSingleSelectionIndicator}set hideSingleSelectionIndicator(e){this._hideSingleSelectionIndicator=e,this._markButtonsForCheck()}get hideMultipleSelectionIndicator(){return this._hideMultipleSelectionIndicator}set hideMultipleSelectionIndicator(e){this._hideMultipleSelectionIndicator=e,this._markButtonsForCheck()}constructor(e,n,o){this._changeDetector=e,this._dir=o,this._multiple=!1,this._disabled=!1,this._disabledInteractive=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{},this._name=`mat-button-toggle-group-${RJ++}`,this.valueChange=new Ke,this.change=new Ke,this.appearance=n&&n.appearance?n.appearance:"standard",this.hideSingleSelectionIndicator=n?.hideSingleSelectionIndicator??!1,this.hideMultipleSelectionIndicator=n?.hideMultipleSelectionIndicator??!1}ngOnInit(){this._selectionModel=new Eh(this.multiple,void 0,!1)}ngAfterContentInit(){this._selectionModel.select(...this._buttonToggles.filter(e=>e.checked)),this.multiple||this._initializeTabIndex()}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_keydown(e){if(this.multiple||this.disabled)return;let o=e.target.id,s=this._buttonToggles.toArray().findIndex(h=>h.buttonId===o),l=null;switch(e.keyCode){case 32:case 13:l=this._buttonToggles.get(s)||null;break;case 38:l=this._getNextButton(s,-1);break;case 37:l=this._getNextButton(s,this.dir==="ltr"?-1:1);break;case 40:l=this._getNextButton(s,1);break;case 39:l=this._getNextButton(s,this.dir==="ltr"?1:-1);break;default:return}l&&(e.preventDefault(),l._onButtonClick(),l.focus())}_emitChangeEvent(e){let n=new JT(e,this.value);this._rawValue=n.value,this._controlValueAccessorChangeFn(n.value),this.change.emit(n)}_syncButtonToggle(e,n,o=!1,s=!1){!this.multiple&&this.selected&&!e.checked&&(this.selected.checked=!1),this._selectionModel?n?this._selectionModel.select(e):this._selectionModel.deselect(e):s=!0,s?Promise.resolve().then(()=>this._updateModelValue(e,o)):this._updateModelValue(e,o)}_isSelected(e){return this._selectionModel&&this._selectionModel.isSelected(e)}_isPrechecked(e){return typeof this._rawValue>"u"?!1:this.multiple&&Array.isArray(this._rawValue)?this._rawValue.some(n=>e.value!=null&&n===e.value):e.value===this._rawValue}_initializeTabIndex(){if(this._buttonToggles.forEach(e=>{e.tabIndex=-1}),this.selected)this.selected.tabIndex=0;else for(let e=0;e<this._buttonToggles.length;e++){let n=this._buttonToggles.get(e);if(!n.disabled){n.tabIndex=0;break}}this._markButtonsForCheck()}_getNextButton(e,n){let o=this._buttonToggles;for(let s=1;s<=o.length;s++){let l=(e+n*s+o.length)%o.length,h=o.get(l);if(h&&!h.disabled)return h}return null}_setSelectionByValue(e){this._rawValue=e,this._buttonToggles&&(this.multiple&&e?(Array.isArray(e),this._clearSelection(),e.forEach(n=>this._selectValue(n))):(this._clearSelection(),this._selectValue(e)))}_clearSelection(){this._selectionModel.clear(),this._buttonToggles.forEach(e=>{e.checked=!1,this.multiple||(e.tabIndex=-1)})}_selectValue(e){let n=this._buttonToggles.find(o=>o.value!=null&&o.value===e);n&&(n.checked=!0,this._selectionModel.select(n),this.multiple||(n.tabIndex=0))}_updateModelValue(e,n){n&&this._emitChangeEvent(e),this.valueChange.emit(this.value)}_markButtonsForCheck(){this._buttonToggles?.forEach(e=>e._markForCheck())}static{this.\u0275fac=function(n){return new(n||r)(Ie(lr),Ie(i3,8),Ie(Rl,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["mat-button-toggle-group"]],contentQueries:function(n,o,s){if(n&1&&Do(s,mu,5),n&2){let l;bi(l=wi())&&(o._buttonToggles=l)}},hostAttrs:[1,"mat-button-toggle-group"],hostVars:6,hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._keydown(l)}),n&2&&(Or("role",o.multiple?"group":"radiogroup")("aria-disabled",o.disabled),dr("mat-button-toggle-vertical",o.vertical)("mat-button-toggle-group-appearance-standard",o.appearance==="standard"))},inputs:{appearance:"appearance",name:"name",vertical:[2,"vertical","vertical",Vi],value:"value",multiple:[2,"multiple","multiple",Vi],disabled:[2,"disabled","disabled",Vi],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Vi],hideSingleSelectionIndicator:[2,"hideSingleSelectionIndicator","hideSingleSelectionIndicator",Vi],hideMultipleSelectionIndicator:[2,"hideMultipleSelectionIndicator","hideMultipleSelectionIndicator",Vi]},outputs:{valueChange:"valueChange",change:"change"},exportAs:["matButtonToggleGroup"],standalone:!0,features:[Xi([A2e,{provide:DJ,useExisting:r}]),$n]})}}return r})(),mu=(()=>{class r{get buttonId(){return`${this.id}-button`}get tabIndex(){return this._tabIndex}set tabIndex(e){this._tabIndex=e,this._markForCheck()}get appearance(){return this.buttonToggleGroup?this.buttonToggleGroup.appearance:this._appearance}set appearance(e){this._appearance=e}get checked(){return this.buttonToggleGroup?this.buttonToggleGroup._isSelected(this):this._checked}set checked(e){e!==this._checked&&(this._checked=e,this.buttonToggleGroup&&this.buttonToggleGroup._syncButtonToggle(this,this._checked),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled||this.buttonToggleGroup&&this.buttonToggleGroup.disabled}set disabled(e){this._disabled=e}get disabledInteractive(){return this._disabledInteractive||this.buttonToggleGroup!==null&&this.buttonToggleGroup.disabledInteractive}set disabledInteractive(e){this._disabledInteractive=e}constructor(e,n,o,s,l,h){this._changeDetectorRef=n,this._elementRef=o,this._focusMonitor=s,this._checked=!1,this.ariaLabelledby=null,this._disabled=!1,this.change=new Ke;let p=Number(l);this.tabIndex=p||p===0?p:null,this.buttonToggleGroup=e,this.appearance=h&&h.appearance?h.appearance:"standard",this.disabledInteractive=h?.disabledInteractive??!1}ngOnInit(){let e=this.buttonToggleGroup;this.id=this.id||`mat-button-toggle-${RJ++}`,e&&(e._isPrechecked(this)?this.checked=!0:e._isSelected(this)!==this._checked&&e._syncButtonToggle(this,this._checked))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){let e=this.buttonToggleGroup;this._focusMonitor.stopMonitoring(this._elementRef),e&&e._isSelected(this)&&e._syncButtonToggle(this,!1,!1,!0)}focus(e){this._buttonElement.nativeElement.focus(e)}_onButtonClick(){if(this.disabled)return;let e=this.isSingleSelector()?!0:!this._checked;if(e!==this._checked&&(this._checked=e,this.buttonToggleGroup&&(this.buttonToggleGroup._syncButtonToggle(this,this._checked,!0),this.buttonToggleGroup._onTouched())),this.isSingleSelector()){let n=this.buttonToggleGroup._buttonToggles.find(o=>o.tabIndex===0);n&&(n.tabIndex=-1),this.tabIndex=0}this.change.emit(new JT(this,this.value))}_markForCheck(){this._changeDetectorRef.markForCheck()}_getButtonName(){return this.isSingleSelector()?this.buttonToggleGroup.name:this.name||null}isSingleSelector(){return this.buttonToggleGroup&&!this.buttonToggleGroup.multiple}static{this.\u0275fac=function(n){return new(n||r)(Ie(DJ,8),Ie(lr),Ie(ar),Ie(F1),Df("tabindex"),Ie(i3,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-button-toggle"]],viewQuery:function(n,o){if(n&1&&Ir(b2e,5),n&2){let s;bi(s=wi())&&(o._buttonElement=s.first)}},hostAttrs:["role","presentation",1,"mat-button-toggle"],hostVars:14,hostBindings:function(n,o){n&1&&ve("focus",function(){return o.focus()}),n&2&&(Or("aria-label",null)("aria-labelledby",null)("id",o.id)("name",null),dr("mat-button-toggle-standalone",!o.buttonToggleGroup)("mat-button-toggle-checked",o.checked)("mat-button-toggle-disabled",o.disabled)("mat-button-toggle-disabled-interactive",o.disabledInteractive)("mat-button-toggle-appearance-standard",o.appearance==="standard"))},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],id:"id",name:"name",value:"value",tabIndex:"tabIndex",disableRipple:[2,"disableRipple","disableRipple",Vi],appearance:"appearance",checked:[2,"checked","checked",Vi],disabled:[2,"disabled","disabled",Vi],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Vi]},outputs:{change:"change"},exportAs:["matButtonToggle"],standalone:!0,features:[$n,lt],ngContentSelectors:w2e,decls:8,vars:14,consts:[["button",""],["type","button",1,"mat-button-toggle-button","mat-focus-indicator",3,"click","id","disabled"],[1,"mat-button-toggle-label-content"],["state","checked","aria-hidden","true","appearance","minimal",1,"mat-mdc-option-pseudo-checkbox",3,"disabled"],[1,"mat-button-toggle-focus-overlay"],["matRipple","",1,"mat-button-toggle-ripple",3,"matRippleTrigger","matRippleDisabled"]],template:function(n,o){if(n&1){let s=We();Kn(),$(0,"button",1,0),ve("click",function(){return we(s),xe(o._onButtonClick())}),$(2,"span",2),Pe(3,x2e,1,1,"mat-pseudo-checkbox",3)(4,S2e,1,1,"mat-pseudo-checkbox",3),Tn(5),ee()(),ct(6,"span",4)(7,"span",5)}if(n&2){let s=Xt(1);z("id",o.buttonId)("disabled",o.disabled&&!o.disabledInteractive||null),Or("role",o.isSingleSelector()?"radio":"button")("tabindex",o.disabled&&!o.disabledInteractive?-1:o.tabIndex)("aria-pressed",o.isSingleSelector()?null:o.checked)("aria-checked",o.isSingleSelector()?o.checked:null)("name",o._getButtonName())("aria-label",o.ariaLabel)("aria-labelledby",o.ariaLabelledby)("aria-disabled",o.disabled&&o.disabledInteractive?"true":null),j(3),jc(o.buttonToggleGroup&&o.checked&&!o.buttonToggleGroup.multiple&&!o.buttonToggleGroup.hideSingleSelectionIndicator?3:-1),j(),jc(o.buttonToggleGroup&&o.checked&&o.buttonToggleGroup.multiple&&!o.buttonToggleGroup.hideMultipleSelectionIndicator?4:-1),j(3),z("matRippleTrigger",s)("matRippleDisabled",o.disableRipple||o.disabled)}},dependencies:[fm,q7],styles:[".mat-button-toggle-standalone,.mat-button-toggle-group{position:relative;display:inline-flex;flex-direction:row;white-space:nowrap;overflow:hidden;-webkit-tap-highlight-color:rgba(0,0,0,0);transform:translateZ(0);border-radius:var(--mat-legacy-button-toggle-shape)}.mat-button-toggle-standalone:not([class*=mat-elevation-z]),.mat-button-toggle-group:not([class*=mat-elevation-z]){box-shadow:0px 3px 1px -2px rgba(0, 0, 0, 0.2), 0px 2px 2px 0px rgba(0, 0, 0, 0.14), 0px 1px 5px 0px rgba(0, 0, 0, 0.12)}.cdk-high-contrast-active .mat-button-toggle-standalone,.cdk-high-contrast-active .mat-button-toggle-group{outline:solid 1px}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{border-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full));border:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-app-outline))}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard .mat-pseudo-checkbox,.mat-button-toggle-group-appearance-standard .mat-pseudo-checkbox{--mat-minimal-pseudo-checkbox-selected-checkmark-color: var(--mat-standard-button-toggle-selected-state-text-color, var(--mat-app-on-secondary-container))}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard:not([class*=mat-elevation-z]),.mat-button-toggle-group-appearance-standard:not([class*=mat-elevation-z]){box-shadow:none}.cdk-high-contrast-active .mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.cdk-high-contrast-active .mat-button-toggle-group-appearance-standard{outline:0}.mat-button-toggle-vertical{flex-direction:column}.mat-button-toggle-vertical .mat-button-toggle-label-content{display:block}.mat-button-toggle{white-space:nowrap;position:relative;color:var(--mat-legacy-button-toggle-text-color);font-family:var(--mat-legacy-button-toggle-label-text-font);font-size:var(--mat-legacy-button-toggle-label-text-size);line-height:var(--mat-legacy-button-toggle-label-text-line-height);font-weight:var(--mat-legacy-button-toggle-label-text-weight);letter-spacing:var(--mat-legacy-button-toggle-label-text-tracking);--mat-minimal-pseudo-checkbox-selected-checkmark-color: var(--mat-legacy-button-toggle-selected-state-text-color)}.mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:var(--mat-legacy-button-toggle-focus-state-layer-opacity)}.mat-button-toggle .mat-icon svg{vertical-align:top}.mat-button-toggle .mat-pseudo-checkbox{margin-right:12px}[dir=rtl] .mat-button-toggle .mat-pseudo-checkbox{margin-right:0;margin-left:12px}.mat-button-toggle-checked{color:var(--mat-legacy-button-toggle-selected-state-text-color);background-color:var(--mat-legacy-button-toggle-selected-state-background-color)}.mat-button-toggle-disabled{pointer-events:none;color:var(--mat-legacy-button-toggle-disabled-state-text-color);background-color:var(--mat-legacy-button-toggle-disabled-state-background-color);--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color: var(--mat-legacy-button-toggle-disabled-state-text-color)}.mat-button-toggle-disabled.mat-button-toggle-checked{background-color:var(--mat-legacy-button-toggle-disabled-selected-state-background-color)}.mat-button-toggle-disabled-interactive{pointer-events:auto}.mat-button-toggle-appearance-standard{color:var(--mat-standard-button-toggle-text-color, var(--mat-app-on-surface));background-color:var(--mat-standard-button-toggle-background-color);font-family:var(--mat-standard-button-toggle-label-text-font, var(--mat-app-label-large-font));font-size:var(--mat-standard-button-toggle-label-text-size, var(--mat-app-label-large-size));line-height:var(--mat-standard-button-toggle-label-text-line-height, var(--mat-app-label-large-line-height));font-weight:var(--mat-standard-button-toggle-label-text-weight, var(--mat-app-label-large-weight));letter-spacing:var(--mat-standard-button-toggle-label-text-tracking, var(--mat-app-label-large-tracking))}.mat-button-toggle-group-appearance-standard .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-app-outline))}[dir=rtl] .mat-button-toggle-group-appearance-standard .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:none;border-right:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-app-outline))}.mat-button-toggle-group-appearance-standard.mat-button-toggle-vertical .mat-button-toggle-appearance-standard+.mat-button-toggle-appearance-standard{border-left:none;border-right:none;border-top:solid 1px var(--mat-standard-button-toggle-divider-color, var(--mat-app-outline))}.mat-button-toggle-appearance-standard.mat-button-toggle-checked{color:var(--mat-standard-button-toggle-selected-state-text-color, var(--mat-app-on-secondary-container));background-color:var(--mat-standard-button-toggle-selected-state-background-color, var(--mat-app-secondary-container))}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled{color:var(--mat-standard-button-toggle-disabled-state-text-color);background-color:var(--mat-standard-button-toggle-disabled-state-background-color)}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled .mat-pseudo-checkbox{--mat-minimal-pseudo-checkbox-disabled-selected-checkmark-color: var(--mat-standard-button-toggle-disabled-selected-state-text-color)}.mat-button-toggle-appearance-standard.mat-button-toggle-disabled.mat-button-toggle-checked{color:var(--mat-standard-button-toggle-disabled-selected-state-text-color);background-color:var(--mat-standard-button-toggle-disabled-selected-state-background-color)}.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{background-color:var(--mat-standard-button-toggle-state-layer-color, var(--mat-app-on-surface))}.mat-button-toggle-appearance-standard:hover .mat-button-toggle-focus-overlay{opacity:var(--mat-standard-button-toggle-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-button-toggle-appearance-standard.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:var(--mat-standard-button-toggle-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}@media(hover: none){.mat-button-toggle-appearance-standard:hover .mat-button-toggle-focus-overlay{display:none}}.mat-button-toggle-label-content{-webkit-user-select:none;user-select:none;display:inline-block;padding:0 16px;line-height:var(--mat-legacy-button-toggle-height);position:relative}.mat-button-toggle-appearance-standard .mat-button-toggle-label-content{padding:0 12px;line-height:var(--mat-standard-button-toggle-height)}.mat-button-toggle-label-content>*{vertical-align:middle}.mat-button-toggle-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:inherit;pointer-events:none;opacity:0;background-color:var(--mat-legacy-button-toggle-state-layer-color)}.cdk-high-contrast-active .mat-button-toggle-checked .mat-button-toggle-focus-overlay{border-bottom:solid 500px;opacity:.5;height:0}.cdk-high-contrast-active .mat-button-toggle-checked:hover .mat-button-toggle-focus-overlay{opacity:.6}.cdk-high-contrast-active .mat-button-toggle-checked.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{border-bottom:solid 500px}.mat-button-toggle .mat-button-toggle-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-button-toggle-button{border:0;background:none;color:inherit;padding:0;margin:0;font:inherit;outline:none;width:100%;cursor:pointer}.mat-button-toggle-disabled .mat-button-toggle-button{cursor:default}.mat-button-toggle-button::-moz-focus-inner{border:0}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard{--mat-focus-indicator-border-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full))}.mat-button-toggle-group-appearance-standard .mat-button-toggle:last-of-type .mat-button-toggle-button::before{border-top-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full));border-bottom-right-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full))}.mat-button-toggle-group-appearance-standard .mat-button-toggle:first-of-type .mat-button-toggle-button::before{border-top-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full));border-bottom-left-radius:var(--mat-standard-button-toggle-shape, var(--mat-app-corner-full))}"],encapsulation:2,changeDetection:0})}}return r})(),Ed=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[ul,L1,mu,ul]})}}return r})();var M2e=["*",[["mat-chip-avatar"],["","matChipAvatar",""]],[["mat-chip-trailing-icon"],["","matChipRemove",""],["","matChipTrailingIcon",""]]],I2e=["*","mat-chip-avatar, [matChipAvatar]","mat-chip-trailing-icon,[matChipRemove],[matChipTrailingIcon]"];function E2e(r,i){r&1&&($(0,"span",3),Tn(1,1),ee())}function T2e(r,i){r&1&&($(0,"span",6),Tn(1,2),ee())}var F2e=["*"];var P2e=new Ln("mat-chips-default-options",{providedIn:"root",factory:()=>({separatorKeyCodes:[13]})}),NJ=new Ln("MatChipAvatar"),BJ=new Ln("MatChipTrailingIcon"),c8=new Ln("MatChipRemove"),GJ=new Ln("MatChip"),u8=(()=>{class r{get disabled(){return this._disabled||this._parentChip.disabled}set disabled(e){this._disabled=e}_getDisabledAttribute(){return this.disabled&&!this._allowFocusWhenDisabled?"":null}_getTabindex(){return this.disabled&&!this._allowFocusWhenDisabled||!this.isInteractive?null:this.tabIndex.toString()}constructor(e,n){this._elementRef=e,this._parentChip=n,this.isInteractive=!0,this._isPrimary=!0,this._disabled=!1,this.tabIndex=-1,this._allowFocusWhenDisabled=!1,e.nativeElement.nodeName==="BUTTON"&&e.nativeElement.setAttribute("type","button")}focus(){this._elementRef.nativeElement.focus()}_handleClick(e){!this.disabled&&this.isInteractive&&this._isPrimary&&(e.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!this.disabled&&this.isInteractive&&this._isPrimary&&!this._parentChip._isEditing&&(e.preventDefault(),this._parentChip._handlePrimaryActionInteraction())}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(GJ))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matChipAction",""]],hostAttrs:[1,"mdc-evolution-chip__action","mat-mdc-chip-action"],hostVars:9,hostBindings:function(n,o){n&1&&ve("click",function(l){return o._handleClick(l)})("keydown",function(l){return o._handleKeydown(l)}),n&2&&(Or("tabindex",o._getTabindex())("disabled",o._getDisabledAttribute())("aria-disabled",o.disabled),dr("mdc-evolution-chip__action--primary",o._isPrimary)("mdc-evolution-chip__action--presentational",!o.isInteractive)("mdc-evolution-chip__action--trailing",!o._isPrimary))},inputs:{isInteractive:"isInteractive",disabled:[2,"disabled","disabled",Vi],tabIndex:[2,"tabIndex","tabIndex",e=>e==null?-1:Uo(e)],_allowFocusWhenDisabled:"_allowFocusWhenDisabled"},standalone:!0,features:[$n]})}}return r})();var jJ=(()=>{class r extends u8{constructor(){super(...arguments),this._isPrimary=!1}_handleClick(e){this.disabled||(e.stopPropagation(),e.preventDefault(),this._parentChip.remove())}_handleKeydown(e){(e.keyCode===13||e.keyCode===32)&&!this.disabled&&(e.stopPropagation(),e.preventDefault(),this._parentChip.remove())}static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=a0(r)))(o||r)}})()}static{this.\u0275dir=Fi({type:r,selectors:[["","matChipRemove",""]],hostAttrs:["role","button",1,"mat-mdc-chip-remove","mat-mdc-chip-trailing-icon","mat-mdc-focus-indicator","mdc-evolution-chip__icon","mdc-evolution-chip__icon--trailing"],hostVars:1,hostBindings:function(n,o){n&2&&Or("aria-hidden",null)},standalone:!0,features:[Xi([{provide:c8,useExisting:r}]),ll]})}}return r})(),L2e=0,d8=(()=>{class r{_hasFocus(){return this._hasFocusInternal}get value(){return this._value!==void 0?this._value:this._textElement.textContent.trim()}set value(e){this._value=e}get disabled(){return this._disabled||this._chipListDisabled}set disabled(e){this._disabled=e}get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(e){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,e)}constructor(e,n,o,s,l,h,p){this._changeDetectorRef=e,this._elementRef=n,this._ngZone=o,this._focusMonitor=s,this._globalRippleOptions=p,this._onFocus=new Si,this._onBlur=new Si,this.role=null,this._hasFocusInternal=!1,this.id=`mat-mdc-chip-${L2e++}`,this.ariaLabel=null,this.ariaDescription=null,this._ariaDescriptionId=`${this.id}-aria-description`,this._chipListDisabled=!1,this.removable=!0,this.highlighted=!1,this.disableRipple=!1,this._disabled=!1,this.removed=new Ke,this.destroyed=new Ke,this.basicChipAttrName="mat-basic-chip",this._rippleLoader=ga(Z7),this._injector=ga(jd),this._document=l,this._animationsDisabled=h==="NoopAnimations",this._monitorFocus(),this._rippleLoader?.configureRipple(this._elementRef.nativeElement,{className:"mat-mdc-chip-ripple",disabled:this._isRippleDisabled()})}ngOnInit(){let e=this._elementRef.nativeElement;this._isBasicChip=e.hasAttribute(this.basicChipAttrName)||e.tagName.toLowerCase()===this.basicChipAttrName}ngAfterViewInit(){this._textElement=this._elementRef.nativeElement.querySelector(".mat-mdc-chip-action-label"),this._pendingFocus&&(this._pendingFocus=!1,this.focus())}ngAfterContentInit(){this._actionChanges=Fs(this._allLeadingIcons.changes,this._allTrailingIcons.changes,this._allRemoveIcons.changes).subscribe(()=>this._changeDetectorRef.markForCheck())}ngDoCheck(){this._rippleLoader.setDisabled(this._elementRef.nativeElement,this._isRippleDisabled())}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement),this._actionChanges?.unsubscribe(),this.destroyed.emit({chip:this}),this.destroyed.complete()}remove(){this.removable&&this.removed.emit({chip:this})}_isRippleDisabled(){return this.disabled||this.disableRipple||this._animationsDisabled||this._isBasicChip||!!this._globalRippleOptions?.disabled}_hasTrailingIcon(){return!!(this.trailingIcon||this.removeIcon)}_handleKeydown(e){(e.keyCode===8&&!e.repeat||e.keyCode===46)&&(e.preventDefault(),this.remove())}focus(){this.disabled||(this.primaryAction?this.primaryAction.focus():this._pendingFocus=!0)}_getSourceAction(e){return this._getActions().find(n=>{let o=n._elementRef.nativeElement;return o===e||o.contains(e)})}_getActions(){let e=[];return this.primaryAction&&e.push(this.primaryAction),this.removeIcon&&e.push(this.removeIcon),this.trailingIcon&&e.push(this.trailingIcon),e}_handlePrimaryActionInteraction(){}_monitorFocus(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(e=>{let n=e!==null;n!==this._hasFocusInternal&&(this._hasFocusInternal=n,n?this._onFocus.next({chip:this}):M1(()=>this._ngZone.run(()=>this._onBlur.next({chip:this})),{injector:this._injector}))})}static{this.\u0275fac=function(n){return new(n||r)(Ie(lr),Ie(ar),Ie(tc),Ie(F1),Ie(rc),Ie(Ah,8),Ie(wx,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-basic-chip"],["","mat-basic-chip",""],["mat-chip"],["","mat-chip",""]],contentQueries:function(n,o,s){if(n&1&&(Do(s,NJ,5),Do(s,BJ,5),Do(s,c8,5),Do(s,NJ,5),Do(s,BJ,5),Do(s,c8,5)),n&2){let l;bi(l=wi())&&(o.leadingIcon=l.first),bi(l=wi())&&(o.trailingIcon=l.first),bi(l=wi())&&(o.removeIcon=l.first),bi(l=wi())&&(o._allLeadingIcons=l),bi(l=wi())&&(o._allTrailingIcons=l),bi(l=wi())&&(o._allRemoveIcons=l)}},viewQuery:function(n,o){if(n&1&&Ir(u8,5),n&2){let s;bi(s=wi())&&(o.primaryAction=s.first)}},hostAttrs:[1,"mat-mdc-chip"],hostVars:31,hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._handleKeydown(l)}),n&2&&(mm("id",o.id),Or("role",o.role)("aria-label",o.ariaLabel),Vd("mat-"+(o.color||"primary")),dr("mdc-evolution-chip",!o._isBasicChip)("mdc-evolution-chip--disabled",o.disabled)("mdc-evolution-chip--with-trailing-action",o._hasTrailingIcon())("mdc-evolution-chip--with-primary-graphic",o.leadingIcon)("mdc-evolution-chip--with-primary-icon",o.leadingIcon)("mdc-evolution-chip--with-avatar",o.leadingIcon)("mat-mdc-chip-with-avatar",o.leadingIcon)("mat-mdc-chip-highlighted",o.highlighted)("mat-mdc-chip-disabled",o.disabled)("mat-mdc-basic-chip",o._isBasicChip)("mat-mdc-standard-chip",!o._isBasicChip)("mat-mdc-chip-with-trailing-icon",o._hasTrailingIcon())("_mat-animation-noopable",o._animationsDisabled))},inputs:{role:"role",id:"id",ariaLabel:[0,"aria-label","ariaLabel"],ariaDescription:[0,"aria-description","ariaDescription"],value:"value",color:"color",removable:[2,"removable","removable",Vi],highlighted:[2,"highlighted","highlighted",Vi],disableRipple:[2,"disableRipple","disableRipple",Vi],disabled:[2,"disabled","disabled",Vi]},outputs:{removed:"removed",destroyed:"destroyed"},exportAs:["matChip"],standalone:!0,features:[Xi([{provide:GJ,useExisting:r}]),$n,lt],ngContentSelectors:I2e,decls:8,vars:3,consts:[[1,"mat-mdc-chip-focus-overlay"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--primary"],["matChipAction","",3,"isInteractive"],[1,"mdc-evolution-chip__graphic","mat-mdc-chip-graphic"],[1,"mdc-evolution-chip__text-label","mat-mdc-chip-action-label"],[1,"mat-mdc-chip-primary-focus-indicator","mat-mdc-focus-indicator"],[1,"mdc-evolution-chip__cell","mdc-evolution-chip__cell--trailing"]],template:function(n,o){n&1&&(Kn(M2e),ct(0,"span",0),$(1,"span",1)(2,"span",2),Pe(3,E2e,2,0,"span",3),$(4,"span",4),Tn(5),ct(6,"span",5),ee()()(),Pe(7,T2e,2,0,"span",6)),n&2&&(j(2),z("isInteractive",!1),j(),jc(o.leadingIcon?3:-1),j(4),jc(o._hasTrailingIcon()?7:-1))},dependencies:[u8],styles:['.mdc-evolution-chip,.mdc-evolution-chip__cell,.mdc-evolution-chip__action{display:inline-flex;align-items:center}.mdc-evolution-chip{position:relative;max-width:100%}.mdc-evolution-chip__cell,.mdc-evolution-chip__action{height:100%}.mdc-evolution-chip__cell--primary{flex-basis:100%;overflow-x:hidden}.mdc-evolution-chip__cell--trailing{flex:1 0 auto}.mdc-evolution-chip__action{align-items:center;background:none;border:none;box-sizing:content-box;cursor:pointer;display:inline-flex;justify-content:center;outline:none;padding:0;text-decoration:none;color:inherit}.mdc-evolution-chip__action--presentational{cursor:auto}.mdc-evolution-chip--disabled,.mdc-evolution-chip__action:disabled{pointer-events:none}.mdc-evolution-chip__action--primary{font:inherit;letter-spacing:inherit;white-space:inherit;overflow-x:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-outline-width);border-radius:var(--mdc-chip-container-shape-radius);box-sizing:border-box;content:"";height:100%;left:0;position:absolute;pointer-events:none;top:0;width:100%;z-index:1;border-style:solid}.mat-mdc-standard-chip .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-outline-color, var(--mat-app-outline))}.mdc-evolution-chip__action--primary:not(.mdc-evolution-chip__action--presentational):not(.mdc-ripple-upgraded):focus::before{border-color:var(--mdc-chip-focus-outline-color, var(--mat-app-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--primary::before{border-color:var(--mdc-chip-disabled-outline-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__action--primary::before{border-width:var(--mdc-chip-flat-selected-outline-width)}.mat-mdc-basic-chip .mdc-evolution-chip__action--primary{font:inherit}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:0;padding-right:12px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__action--primary{padding-left:12px;padding-right:0}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--primary{padding-left:0;padding-right:0}.mdc-evolution-chip__action--trailing{position:relative;overflow:visible}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-trailing-icon-color, var(--mat-app-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__action--trailing{color:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-color, var(--mat-app-on-surface))}.mat-mdc-standard-chip.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__action--trailing{padding-left:8px;padding-right:8px}.mdc-evolution-chip__text-label{-webkit-user-select:none;user-select:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.mat-mdc-standard-chip .mdc-evolution-chip__text-label{font-family:var(--mdc-chip-label-text-font, var(--mat-app-label-large-font));line-height:var(--mdc-chip-label-text-line-height, var(--mat-app-label-large-line-height));font-size:var(--mdc-chip-label-text-size, var(--mat-app-label-large-size));font-weight:var(--mdc-chip-label-text-weight, var(--mat-app-label-large-weight));letter-spacing:var(--mdc-chip-label-text-tracking, var(--mat-app-label-large-tracking))}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-label-text-color, var(--mat-app-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__text-label{color:var(--mdc-chip-selected-label-text-color, var(--mat-app-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label,.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__text-label{color:var(--mdc-chip-disabled-label-text-color)}.mdc-evolution-chip__graphic{align-items:center;display:inline-flex;justify-content:center;overflow:hidden;pointer-events:none;position:relative;flex:1 0 auto}.mat-mdc-standard-chip .mdc-evolution-chip__graphic{width:var(--mdc-chip-with-avatar-avatar-size);height:var(--mdc-chip-with-avatar-avatar-size);font-size:var(--mdc-chip-with-avatar-avatar-size)}.mdc-evolution-chip--selecting .mdc-evolution-chip__graphic{transition:width 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selectable:not(.mdc-evolution-chip--selected):not(.mdc-evolution-chip--with-primary-icon) .mdc-evolution-chip__graphic{width:0}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mat-mdc-standard-chip.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:6px;padding-right:6px}.mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:4px;padding-right:8px}[dir=rtl] .mdc-evolution-chip--with-avatar.mdc-evolution-chip--with-primary-graphic.mdc-evolution-chip--with-trailing-action .mdc-evolution-chip__graphic{padding-left:8px;padding-right:4px}.mdc-evolution-chip__checkmark{position:absolute;opacity:0;top:50%;left:50%;height:20px;width:20px}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-app-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__checkmark{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-app-on-surface))}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark{transition:transform 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1);transform:translate(-75%, -50%)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{transform:translate(-50%, -50%);opacity:1}.mdc-evolution-chip__checkmark-svg{display:block}.mdc-evolution-chip__checkmark-path{stroke-width:2px;stroke-dasharray:29.7833385;stroke-dashoffset:29.7833385;stroke:currentColor}.mdc-evolution-chip--selecting .mdc-evolution-chip__checkmark-path{transition:stroke-dashoffset 150ms 45ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark-path{stroke-dashoffset:0}.cdk-high-contrast-active .mdc-evolution-chip__checkmark-path{stroke:CanvasText !important}.mat-mdc-standard-chip .mdc-evolution-chip__icon--trailing{height:18px;width:18px;font-size:18px}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove{opacity:calc(var(--mat-chip-trailing-action-opacity)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity))}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing.mat-mdc-chip-remove:focus{opacity:calc(var(--mat-chip-trailing-action-focus-opacity)*var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity))}.mat-mdc-standard-chip{border-radius:var(--mdc-chip-container-shape-radius);height:var(--mdc-chip-container-height)}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-elevated-disabled-container-color)}.mat-mdc-standard-chip.mdc-evolution-chip--selected:not(.mdc-evolution-chip--disabled){background-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-app-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled{background-color:var(--mdc-chip-flat-disabled-selected-container-color)}.cdk-high-contrast-active .mat-mdc-standard-chip{outline:solid 1px}.mat-mdc-standard-chip .mdc-evolution-chip__icon--primary{border-radius:var(--mdc-chip-with-avatar-avatar-shape-radius);width:var(--mdc-chip-with-icon-icon-size);height:var(--mdc-chip-with-icon-icon-size);font-size:var(--mdc-chip-with-icon-icon-size)}.mdc-evolution-chip--selected .mdc-evolution-chip__icon--primary{opacity:0}.mat-mdc-standard-chip:not(.mdc-evolution-chip--disabled) .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-icon-color, var(--mat-app-on-surface-variant))}.mat-mdc-standard-chip.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--primary{color:var(--mdc-chip-with-icon-disabled-icon-color, var(--mat-app-on-surface))}.mat-mdc-chip-highlighted{--mdc-chip-with-icon-icon-color:var(--mdc-chip-with-icon-selected-icon-color, var(--mat-app-on-secondary-container));--mdc-chip-elevated-container-color:var(--mdc-chip-elevated-selected-container-color, var(--mat-app-secondary-container));--mdc-chip-label-text-color:var(--mdc-chip-selected-label-text-color, var(--mat-app-on-secondary-container));--mdc-chip-outline-width:var(--mdc-chip-flat-selected-outline-width)}.mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-chip-selected .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-app-on-secondary-container))}.mat-mdc-chip:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-hover-state-layer-color, var(--mat-app-on-surface-variant));opacity:var(--mdc-chip-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-chip-focus-overlay .mat-mdc-chip-selected:hover,.mat-mdc-chip-highlighted:hover .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-hover-state-layer-color, var(--mat-app-on-secondary-container));opacity:var(--mdc-chip-selected-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-chip.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-focus-state-layer-color, var(--mat-app-on-surface-variant));opacity:var(--mdc-chip-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-chip-selected.cdk-focused .mat-mdc-chip-focus-overlay,.mat-mdc-chip-highlighted.cdk-focused .mat-mdc-chip-focus-overlay{background:var(--mdc-chip-selected-focus-state-layer-color, var(--mat-app-on-secondary-container));opacity:var(--mdc-chip-selected-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mdc-evolution-chip--disabled:not(.mdc-evolution-chip--selected) .mat-mdc-chip-avatar{opacity:var(--mdc-chip-with-avatar-disabled-avatar-opacity)}.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{opacity:var(--mdc-chip-with-trailing-icon-disabled-trailing-icon-opacity)}.mdc-evolution-chip--disabled.mdc-evolution-chip--selected .mdc-evolution-chip__checkmark{opacity:var(--mdc-chip-with-icon-disabled-icon-opacity)}.mat-mdc-standard-chip.mdc-evolution-chip--disabled{opacity:var(--mat-chip-disabled-container-opacity)}.mat-mdc-standard-chip.mdc-evolution-chip--selected .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-trailing-icon-color, var(--mat-app-on-secondary-container))}.mat-mdc-standard-chip.mdc-evolution-chip--selected.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing,.mat-mdc-standard-chip.mat-mdc-chip-highlighted.mdc-evolution-chip--disabled .mdc-evolution-chip__icon--trailing{color:var(--mat-chip-selected-disabled-trailing-icon-color, var(--mat-app-on-surface))}.mat-mdc-chip-remove{opacity:var(--mat-chip-trailing-action-opacity)}.mat-mdc-chip-remove:focus{opacity:var(--mat-chip-trailing-action-focus-opacity)}.mat-mdc-chip-remove::after{background-color:var(--mat-chip-trailing-action-state-layer-color, var(--mat-app-on-surface-variant))}.mat-mdc-chip-remove:hover::after{opacity:var(--mat-chip-trailing-action-hover-state-layer-opacity, var(--mat-app-hover-state-layer-opacity))}.mat-mdc-chip-remove:focus::after{opacity:var(--mat-chip-trailing-action-focus-state-layer-opacity, var(--mat-app-focus-state-layer-opacity))}.mat-mdc-chip-selected .mat-mdc-chip-remove::after,.mat-mdc-chip-highlighted .mat-mdc-chip-remove::after{background-color:var(--mat-chip-selected-trailing-action-state-layer-color, var(--mat-app-on-secondary-container))}.mat-mdc-standard-chip{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-standard-chip .mdc-evolution-chip__cell--primary,.mat-mdc-standard-chip .mdc-evolution-chip__action--primary,.mat-mdc-standard-chip .mat-mdc-chip-action-label{overflow:visible}.mat-mdc-standard-chip .mat-mdc-chip-graphic,.mat-mdc-standard-chip .mat-mdc-chip-trailing-icon{box-sizing:content-box}.mat-mdc-standard-chip._mat-animation-noopable,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__graphic,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark,.mat-mdc-standard-chip._mat-animation-noopable .mdc-evolution-chip__checkmark-path{transition-duration:1ms;animation-duration:1ms}.mat-mdc-chip-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;opacity:0;border-radius:inherit;transition:opacity 150ms linear}._mat-animation-noopable .mat-mdc-chip-focus-overlay{transition:none}.mat-mdc-basic-chip .mat-mdc-chip-focus-overlay{display:none}.mat-mdc-chip .mat-ripple.mat-mdc-chip-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-chip-avatar{text-align:center;line-height:1;color:var(--mdc-chip-with-icon-icon-color, currentColor)}.mat-mdc-chip{position:relative;z-index:0}.mat-mdc-chip-action-label{text-align:left;z-index:1}[dir=rtl] .mat-mdc-chip-action-label{text-align:right}.mat-mdc-chip.mdc-evolution-chip--with-trailing-action .mat-mdc-chip-action-label{position:relative}.mat-mdc-chip-action-label .mat-mdc-chip-primary-focus-indicator{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none}.mat-mdc-chip-action-label .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-chip-remove::before{margin:calc(var(--mat-mdc-focus-indicator-border-width, 3px)*-1);left:8px;right:8px}.mat-mdc-chip-remove::after{content:"";display:block;opacity:0;position:absolute;top:-3px;bottom:-3px;left:5px;right:5px;border-radius:50%;box-sizing:border-box;padding:12px;margin:-12px;background-clip:content-box}.mat-mdc-chip-remove .mat-icon{width:18px;height:18px;font-size:18px;box-sizing:content-box}.mat-chip-edit-input{cursor:text;display:inline-block;color:inherit;outline:0}.cdk-high-contrast-active .mat-mdc-chip-selected:not(.mat-mdc-chip-multiple){outline-width:3px}.mat-mdc-chip-action:focus .mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0})}}return r})();var VJ=(()=>{class r{get chipFocusChanges(){return this._getChipStream(e=>e._onFocus)}get chipDestroyedChanges(){return this._getChipStream(e=>e.destroyed)}get chipRemovedChanges(){return this._getChipStream(e=>e.removed)}get disabled(){return this._disabled}set disabled(e){this._disabled=e,this._syncChipsState()}get empty(){return!this._chips||this._chips.length===0}get role(){return this._explicitRole?this._explicitRole:this.empty?null:this._defaultRole}set role(e){this._explicitRole=e}get focused(){return this._hasFocusedChip()}constructor(e,n,o){this._elementRef=e,this._changeDetectorRef=n,this._dir=o,this._lastDestroyedFocusedChipIndex=null,this._destroyed=new Si,this._defaultRole="presentation",this._disabled=!1,this.tabIndex=0,this._explicitRole=null,this._chipActions=new MA}ngAfterViewInit(){this._setUpFocusManagement(),this._trackChipSetChanges(),this._trackDestroyedFocusedChip()}ngOnDestroy(){this._keyManager?.destroy(),this._chipActions.destroy(),this._destroyed.next(),this._destroyed.complete()}_hasFocusedChip(){return this._chips&&this._chips.some(e=>e._hasFocus())}_syncChipsState(){this._chips?.forEach(e=>{e._chipListDisabled=this._disabled,e._changeDetectorRef.markForCheck()})}focus(){}_handleKeydown(e){this._originatesFromChip(e)&&this._keyManager.onKeydown(e)}_isValidIndex(e){return e>=0&&e<this._chips.length}_allowFocusEscape(){let e=this._elementRef.nativeElement.tabIndex;e!==-1&&(this._elementRef.nativeElement.tabIndex=-1,setTimeout(()=>this._elementRef.nativeElement.tabIndex=e))}_getChipStream(e){return this._chips.changes.pipe(ec(null),Xn(()=>Fs(...this._chips.map(e))))}_originatesFromChip(e){let n=e.target;for(;n&&n!==this._elementRef.nativeElement;){if(n.classList.contains("mat-mdc-chip"))return!0;n=n.parentElement}return!1}_setUpFocusManagement(){this._chips.changes.pipe(ec(this._chips)).subscribe(e=>{let n=[];e.forEach(o=>o._getActions().forEach(s=>n.push(s))),this._chipActions.reset(n),this._chipActions.notifyOnChanges()}),this._keyManager=new PA(this._chipActions).withVerticalOrientation().withHorizontalOrientation(this._dir?this._dir.value:"ltr").withHomeAndEnd().skipPredicate(e=>this._skipPredicate(e)),this.chipFocusChanges.pipe(Vo(this._destroyed)).subscribe(({chip:e})=>{let n=e._getSourceAction(document.activeElement);n&&this._keyManager.updateActiveItem(n)}),this._dir?.change.pipe(Vo(this._destroyed)).subscribe(e=>this._keyManager.withHorizontalOrientation(e))}_skipPredicate(e){return!e.isInteractive||e.disabled}_trackChipSetChanges(){this._chips.changes.pipe(ec(null),Vo(this._destroyed)).subscribe(()=>{this.disabled&&Promise.resolve().then(()=>this._syncChipsState()),this._redirectDestroyedChipFocus()})}_trackDestroyedFocusedChip(){this.chipDestroyedChanges.pipe(Vo(this._destroyed)).subscribe(e=>{let o=this._chips.toArray().indexOf(e.chip);this._isValidIndex(o)&&e.chip._hasFocus()&&(this._lastDestroyedFocusedChipIndex=o)})}_redirectDestroyedChipFocus(){if(this._lastDestroyedFocusedChipIndex!=null){if(this._chips.length){let e=Math.min(this._lastDestroyedFocusedChipIndex,this._chips.length-1),n=this._chips.toArray()[e];n.disabled?this._chips.length===1?this.focus():this._keyManager.setPreviousItemActive():n.focus()}else this.focus();this._lastDestroyedFocusedChipIndex=null}}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(lr),Ie(Rl,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-chip-set"]],contentQueries:function(n,o,s){if(n&1&&Do(s,d8,5),n&2){let l;bi(l=wi())&&(o._chips=l)}},hostAttrs:[1,"mat-mdc-chip-set","mdc-evolution-chip-set"],hostVars:1,hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._handleKeydown(l)}),n&2&&Or("role",o.role)},inputs:{disabled:[2,"disabled","disabled",Vi],role:"role",tabIndex:[2,"tabIndex","tabIndex",e=>e==null?0:Uo(e)]},standalone:!0,features:[$n,lt],ngContentSelectors:F2e,decls:2,vars:0,consts:[["role","presentation",1,"mdc-evolution-chip-set__chips"]],template:function(n,o){n&1&&(Kn(),$(0,"div",0),Tn(1),ee())},styles:[".mat-mdc-chip-set{display:flex}.mat-mdc-chip-set:focus{outline:none}.mat-mdc-chip-set .mdc-evolution-chip-set__chips{min-width:100%;margin-left:-8px;margin-right:0}.mat-mdc-chip-set .mdc-evolution-chip{margin:4px 0 4px 8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip-set__chips{margin-left:0;margin-right:-8px}[dir=rtl] .mat-mdc-chip-set .mdc-evolution-chip{margin-left:0;margin-right:8px}.mdc-evolution-chip-set__chips{display:flex;flex-flow:wrap;min-width:0}.mat-mdc-chip-set-stacked{flex-direction:column;align-items:flex-start}.mat-mdc-chip-set-stacked .mat-mdc-chip{width:100%}.mat-mdc-chip-set-stacked .mdc-evolution-chip__graphic{flex-grow:0}.mat-mdc-chip-set-stacked .mdc-evolution-chip__action--primary{flex-basis:100%;justify-content:start}input.mat-mdc-chip-input{flex:1 0 150px;margin-left:8px}[dir=rtl] input.mat-mdc-chip-input{margin-left:0;margin-right:8px}"],encapsulation:2,changeDetection:0})}}return r})();var UJ=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({providers:[H7,{provide:P2e,useValue:{separatorKeyCodes:[13]}}],imports:[ul,L1,ul]})}}return r})();var yC=(()=>{class r{http;constructor(e){this.http=e}getDomValuesFromURL(e){return un(this,null,function*(){let n=e.url,o;return yield this.http.get(n).pipe(Nt(s=>(o=s,s)),qr(s=>A1(s))).toPromise(),o})}static \u0275fac=function(n){return new(n||r)(pt(Er))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var D2e=["selection"],R2e=()=>({standalone:!0});function N2e(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe("",e.title," ")}}function B2e(r,i){if(r&1){let e=We();$(0,"div",14)(1,"mat-form-field")(2,"mat-select",15),le(3,"translate"),eo("valueChange",function(o){we(e);let s=ne(3);return Jn(s.currentPushButtonsGroup,o)||(s.currentPushButtonsGroup=o),xe(o)}),Pe(4,N2e,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(3);j(2),z("matTooltip",ce(3,3,"igo.geo.layer.legend.selectStyle")),Qn("value",e.currentPushButtonsGroup),j(2),z("ngForOf",e.getPushButtonsGroups())}}function G2e(r,i){if(r&1){let e=We();$(0,"mat-button-toggle",20),ve("change",function(){let o=we(e).$implicit,s=ne(3).$implicit,l=ne();return xe(l.onSelectionChange(o,s.selectorType))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(4);z("matTooltip",n.getToolTip(e))("ngStyle",n.getButtonColor(e))("checked",e.enabled)("value",e),j(),Qe("",e.title," ")}}function j2e(r,i){if(r&1&&(Dr(0),$(1,"h3"),_e(2),ee(),$(3,"mat-button-toggle-group",18),Pe(4,G2e,2,5,"mat-button-toggle",19),ee(),Rr()),r&2){let e=i.$implicit,n=ne(3);j(2),bt(e.title),j(),sr("vertical",n.bundleIsVertical(e)),j(),z("ngForOf",e.selectors)}}function V2e(r,i){if(r&1&&($(0,"div",12),ct(1,"mat-divider"),Pe(2,B2e,5,5,"div",13)(3,j2e,5,3,"ng-container",5),ee()),r&2){let e=ne(2);j(2),z("ngIf",e.getPushButtonsGroups().length>1),j(),z("ngForOf",e.currentPushButtonsGroup.computedSelectors)}}function U2e(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe("",e.title," ")}}function z2e(r,i){if(r&1){let e=We();$(0,"div",14)(1,"mat-form-field")(2,"mat-select",22),le(3,"translate"),eo("valueChange",function(o){we(e);let s=ne(3);return Jn(s.currentCheckboxesGroup,o)||(s.currentCheckboxesGroup=o),xe(o)}),Pe(4,U2e,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(3);j(2),z("matTooltip",ce(3,3,"igo.geo.layer.legend.selectStyle")),Qn("value",e.currentCheckboxesGroup),j(2),z("ngForOf",e.getCheckboxesGroups())}}function $2e(r,i){if(r&1){let e=We();$(0,"mat-checkbox",25),ve("change",function(){let o=we(e).$implicit,s=ne(3).$implicit,l=ne();return xe(l.onSelectionChange(o,s.selectorType))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(4);z("matTooltip",n.getToolTip(e))("checked",e.enabled)("value",e),j(),Qe("",e.title," ")}}function W2e(r,i){if(r&1){let e=We();$(0,"u",28),ve("click",function(){we(e);let o=ne(5);return xe(o.displayLessResults("checkbox"))}),_e(1),le(2,"translate"),ee()}r&2&&(j(),Qe("",ce(2,1,"igo.geo.filter.displayLessResults")," "))}function H2e(r,i){if(r&1){let e=We();$(0,"u",29),ve("click",function(){we(e);let o=ne(5);return xe(o.displayMoreResults("checkbox"))}),_e(1),le(2,"translate"),ee()}r&2&&(j(),Qe("",ce(2,1,"igo.geo.filter.displayMoreResults")," "))}function q2e(r,i){if(r&1&&($(0,"p"),Pe(1,W2e,3,3,"u",26)(2,H2e,3,3,"u",27),ee()),r&2){let e=ne().$implicit,n=ne(3);j(),z("ngIf",n.isLessResults(e,"checkbox")),j(),z("ngIf",n.isMoreResults(e,"checkbox"))}}function Y2e(r,i){if(r&1&&(Dr(0),$(1,"h3"),_e(2),ee(),$(3,"div",23),Pe(4,$2e,2,4,"mat-checkbox",24),ee(),Pe(5,q2e,3,2,"p",6),Rr()),r&2){let e=i.$implicit,n=ne(3);j(2),bt(e.title),j(2),z("ngForOf",e.selectors),j(),z("ngIf",n.isLessResults(e,"checkbox")||n.isMoreResults(e,"checkbox"))}}function Z2e(r,i){if(r&1&&($(0,"div",21),ct(1,"mat-divider"),Pe(2,z2e,5,5,"div",13)(3,Y2e,6,3,"ng-container",5),ee()),r&2){let e=ne(2);j(2),z("ngIf",e.getCheckboxesGroups().length>1),j(),z("ngForOf",e.currentCheckboxesGroup.computedSelectors)}}function X2e(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe("",e.title," ")}}function K2e(r,i){if(r&1){let e=We();$(0,"div",14)(1,"mat-form-field")(2,"mat-select",31),le(3,"translate"),eo("valueChange",function(o){we(e);let s=ne(3);return Jn(s.currentRadioButtonsGroup,o)||(s.currentRadioButtonsGroup=o),xe(o)}),Pe(4,X2e,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(3);j(2),z("matTooltip",ce(3,3,"igo.geo.layer.legend.selectStyle")),Qn("value",e.currentRadioButtonsGroup),j(2),z("ngForOf",e.getRadioButtonsGroups())}}function Q2e(r,i){if(r&1){let e=We();$(0,"mat-radio-button",34),le(1,"translate"),ve("change",function(){we(e);let o=ne(4);return xe(o.emptyRadioButtons())}),_e(2),le(3,"translate"),ee()}r&2&&(z("matTooltip",ce(1,2,"igo.geo.filter.resetFilters")),j(2),Qe("",ce(3,4,"igo.geo.filter.resetFilters")," "))}function J2e(r,i){if(r&1){let e=We();$(0,"mat-radio-button",25),ve("change",function(){let o=we(e).$implicit,s=ne(3).$implicit,l=ne();return xe(l.onSelectionChange(o,s.selectorType))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(4);z("matTooltip",n.getToolTip(e))("checked",e.enabled)("value",e),j(),Qe("",e.title," ")}}function eCe(r,i){if(r&1){let e=We();$(0,"u",28),ve("click",function(){we(e);let o=ne(5);return xe(o.displayLessResults("radio"))}),_e(1),le(2,"translate"),ee()}r&2&&(j(),Qe("",ce(2,1,"igo.geo.filter.displayLessResults")," "))}function tCe(r,i){if(r&1){let e=We();$(0,"u",29),ve("click",function(){we(e);let o=ne(5);return xe(o.displayMoreResults("radio"))}),_e(1),le(2,"translate"),ee()}r&2&&(j(),Qe("",ce(2,1,"igo.geo.filter.displayMoreResults")," "))}function iCe(r,i){if(r&1&&($(0,"p"),Pe(1,eCe,3,3,"u",26)(2,tCe,3,3,"u",27),ee()),r&2){let e=ne().$implicit,n=ne(3);j(),z("ngIf",n.isLessResults(e,"radio")),j(),z("ngIf",n.isMoreResults(e,"radio"))}}function rCe(r,i){if(r&1&&(Dr(0),$(1,"h3"),_e(2),ee(),$(3,"mat-radio-group",32),Pe(4,Q2e,4,6,"mat-radio-button",33)(5,J2e,2,4,"mat-radio-button",24)(6,iCe,3,2,"p",6),ee(),Rr()),r&2){let e=i.$implicit,n=ne(3);j(2),bt(e.title),j(2),z("ngIf",e.unfiltered),j(),z("ngForOf",e.selectors),j(),z("ngIf",n.isLessResults(e,"radio")||n.isMoreResults(e,"radio"))}}function nCe(r,i){if(r&1&&($(0,"div",30),ct(1,"mat-divider"),Pe(2,K2e,5,5,"div",13)(3,rCe,7,4,"ng-container",5),ee()),r&2){let e=ne(2);j(2),z("ngIf",e.getRadioButtonsGroups().length>1),j(),z("ngForOf",e.currentRadioButtonsGroup.computedSelectors)}}function oCe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe("",e.title," ")}}function aCe(r,i){if(r&1){let e=We();$(0,"div",14)(1,"mat-form-field")(2,"mat-select",36),le(3,"translate"),eo("valueChange",function(o){we(e);let s=ne(3);return Jn(s.currentSelectGroup,o)||(s.currentSelectGroup=o),xe(o)}),Pe(4,oCe,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(3);j(2),z("matTooltip",ce(3,3,"igo.geo.layer.legend.selectStyle")),Qn("value",e.currentSelectGroup),j(2),z("ngForOf",e.getSelectGroups())}}function sCe(r,i){if(r&1){let e=We();$(0,"mat-button",39),le(1,"translate"),ve("click",function(){we(e);let o=ne(4);return xe(o.emptySelect())}),$(2,"mat-icon"),_e(3,"filter_alt_off"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.filter.resetFilters"))}function lCe(r,i){if(r&1){let e=We();$(0,"mat-checkbox",43),eo("ngModelChange",function(o){we(e);let s=ne(5);return Jn(s.selectAllSelected,o)||(s.selectAllSelected=o),xe(o)}),ve("change",function(){we(e);let o=ne(5);return xe(o.toggleAllSelection())}),_e(1,"Tous "),ee()}if(r&2){let e=ne(5);Qn("ngModel",e.selectAllSelected),z("ngModelOptions",Ih(2,R2e))}}function cCe(r,i){if(r&1){let e=We();$(0,"mat-option",44),ve("onSelectionChange",function(o){we(e);let s=ne(2).$implicit,l=ne(3);return xe(l.selectOptionClick(o.source.value,s,o))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(5);z("matTooltip",n.getToolTip(e))("value",e),j(),Qe("",e.title," ")}}function uCe(r,i){if(r&1&&($(0,"div")(1,"mat-select",40,1)(3,"div",23),Pe(4,lCe,2,3,"mat-checkbox",41),ee(),Pe(5,cCe,2,3,"mat-option",42),ee()()),r&2){let e=ne().$implicit;j(),z("multiple",e.multiple)("placeholder",e.title),j(3),z("ngIf",e.multiple),j(),z("ngForOf",e.selectors)}}function dCe(r,i){if(r&1){let e=We();$(0,"mat-option",44),ve("onSelectionChange",function(o){we(e);let s=ne(2).$implicit,l=ne(3);return xe(l.selectOptionClick(o.source.value,s))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(5);z("matTooltip",n.getToolTip(e))("value",e),j(),Qe("",e.title," ")}}function hCe(r,i){if(r&1&&($(0,"mat-select",45),Pe(1,dCe,2,3,"mat-option",42),ee()),r&2){let e=ne().$implicit;z("placeholder",e.title),j(),z("ngForOf",e.selectors)}}function pCe(r,i){if(r&1&&(Dr(0),$(1,"h3"),_e(2),ee(),$(3,"div",14),Pe(4,sCe,4,3,"mat-button",37),$(5,"mat-form-field"),Pe(6,uCe,6,4,"div",38)(7,hCe,2,2,"ng-template",null,0,Ac),ee()(),Rr()),r&2){let e=i.$implicit,n=Xt(8);j(2),bt(e.title),j(2),z("ngIf",e.unfiltered&&!e.multiple),j(),fo("width",e.width?e.width:void 0,"%"),j(),z("ngIf",e.multiple)("ngIfElse",n)}}function mCe(r,i){if(r&1&&($(0,"div",35),ct(1,"mat-divider"),Pe(2,aCe,5,5,"div",13)(3,pCe,9,6,"ng-container",5),ee()),r&2){let e=ne(2);j(2),z("ngIf",e.getSelectGroups().length>1),j(),z("ngForOf",e.currentSelectGroup.computedSelectors)}}function fCe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe("",e.title," ")}}function gCe(r,i){if(r&1){let e=We();$(0,"div",14)(1,"mat-form-field")(2,"mat-select",47),le(3,"translate"),eo("valueChange",function(o){we(e);let s=ne(3);return Jn(s.currentAutocompleteGroup,o)||(s.currentAutocompleteGroup=o),xe(o)}),Pe(4,fCe,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(3);j(2),z("matTooltip",ce(3,3,"igo.geo.layer.legend.selectStyle")),Qn("value",e.currentAutocompleteGroup),j(2),z("ngForOf",e.getAutocompleteGroups())}}function _Ce(r,i){if(r&1){let e=We();$(0,"mat-button",39),le(1,"translate"),ve("click",function(){we(e);let o=ne(4);return xe(o.emptyAutocomplete())}),$(2,"mat-icon"),_e(3,"filter_alt_off"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.filter.resetFilters"))}function yCe(r,i){if(r&1){let e=We();$(0,"mat-chip",54),ve("removed",function(){let o=we(e).$implicit,s=ne(6);return xe(s.toggleSelection(o))}),_e(1),$(2,"button",55),le(3,"translate"),$(4,"mat-icon"),_e(5,"cancel"),ee()()()}if(r&2){let e=i.$implicit;j(),Qe(" ",e," "),j(),z("matTooltip",ce(3,2,"igo.geo.filter.removeFilter"))}}function vCe(r,i){if(r&1&&($(0,"mat-chip-set"),Pe(1,yCe,6,4,"mat-chip",53),ee()),r&2){let e=ne(5);j(),z("ngForOf",e.autocompleteEnableds)}}function bCe(r,i){if(r&1){let e=We();$(0,"mat-option",56)(1,"div",57),ve("click",function(o){let s=we(e).$implicit,l=ne(5);return xe(l.toggleAutocompleteOption(o,s.value))}),$(2,"mat-checkbox",58),ve("click",function(o){let s=we(e).$implicit,l=ne(5);return xe(l.toggleAutocompleteOption(o,s.value))}),ee(),_e(3),ee()()}if(r&2){let e=i.$implicit,n=ne(5);z("matTooltip",n.getToolTip(e)),j(2),z("checked",n.checkedStatus(e.value)),j(),Qe(" ",e.value," ")}}function wCe(r,i){if(r&1){let e=We();$(0,"mat-form-field",49)(1,"mat-label"),_e(2),ee(),Pe(3,vCe,2,1,"mat-chip-set",6),$(4,"input",50,2),ve("input",function(){we(e);let o=ne(4);return xe(o.onInputChange())}),ee(),$(6,"mat-autocomplete",51,3),Pe(8,bCe,4,3,"mat-option",52),le(9,"async"),ee()()}if(r&2){let e,n=Xt(7),o=ne().$implicit,s=ne(3);fo("width",o.width?o.width:void 0,"%"),j(2),bt(o.title),j(),z("ngIf",s.filteredOgcAutocomplete[o.id]&&((e=o.showChips)!==null&&e!==void 0?e:!0)),j(),z("matAutocomplete",n),j(2),z("displayWith",s.displayFn),j(2),z("ngForOf",ce(9,7,s.filteredOgcAutocomplete[o.id]))}}function xCe(r,i){if(r&1&&(Dr(0),$(1,"h3"),_e(2),ee(),$(3,"div",14),Pe(4,_Ce,4,3,"mat-button",37)(5,wCe,10,9,"mat-form-field",48),ee(),Rr()),r&2){let e=i.$implicit,n=ne(3);j(2),bt(e.title),j(2),z("ngIf",e.unfiltered),j(),z("ngIf",n.filteredOgcAutocomplete[e.id])}}function SCe(r,i){if(r&1&&($(0,"div",46),ct(1,"mat-divider"),Pe(2,gCe,5,5,"div",13)(3,xCe,6,3,"ng-container",5),ee()),r&2){let e=ne(2);j(2),z("ngIf",e.getAutocompleteGroups().length>1),j(),z("ngForOf",e.currentAutocompleteGroup.computedSelectors)}}function CCe(r,i){if(r&1&&($(0,"div"),Pe(1,V2e,4,2,"div",7)(2,Z2e,4,2,"div",8)(3,nCe,4,2,"div",9)(4,mCe,4,2,"div",10)(5,SCe,4,2,"div",11),ee()),r&2){let e=i.$implicit;j(),z("ngIf",e.selectorType==="pushButton"),j(),z("ngIf",e.selectorType==="checkbox"),j(),z("ngIf",e.selectorType==="radioButton"),j(),z("ngIf",e.selectorType==="select"),j(),z("ngIf",e.selectorType==="autocomplete")}}function ACe(r,i){r&1&&($(0,"h3"),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.filter.reportingDate")," "))}function MCe(r,i){if(r&1&&($(0,"h3"),_e(1),ee()),r&2){let e=ne(2);j(),bt(e.currentFilter.title)}}function ICe(r,i){if(r&1){let e=We();$(0,"div"),ct(1,"mat-divider"),Pe(2,ACe,3,3,"h3",6)(3,MCe,2,1,"h3",6),$(4,"igo-ogc-filter-time",59),ve("changeProperty",function(o){we(e);let s=ne();return xe(s.changeProperty(o.value,o.pos))}),ee()()}if(r&2){let e=ne();j(2),z("ngIf",!e.currentFilter.title),j(),z("ngIf",e.currentFilter.title),j(),z("datasource",e.datasource)("currentFilter",e.currentFilter)}}var h8=(()=>{class r{ogcFilterService;formBuilder;domService;configService;cdRef;sel;matAutocomplete;refreshFilters;datasource;map;checkboxesIndex=5;radioButtonsIndex=5;baseIndex=5;get currentFilter(){return this._currentFilter}set currentFilter(e){this._currentFilter=e,this._currentFilter?.sliderOptions&&(this._currentFilter.sliderOptions.enabled=!1)}_currentFilter;inputChangeAutocomplete=new Si;ogcFilterOperator=_i;form;ogcFilterWriter;color="primary";selectAllSelected=!1;selectEnabled$=new ut(void 0);selectEnableds$=new ut([]);autocompleteEnableds$=new ut([]);filteredOgcAutocomplete={};applyFiltersTimeout;get ogcFiltersSelectors(){let e=[];return this.datasource?.options?.ogcFilters?.pushButtons&&e.push(this.datasource?.options?.ogcFilters?.pushButtons),this.datasource?.options?.ogcFilters?.checkboxes&&e.push(this.datasource?.options?.ogcFilters?.checkboxes),this.datasource?.options?.ogcFilters?.radioButtons&&e.push(this.datasource?.options?.ogcFilters?.radioButtons),this.datasource?.options?.ogcFilters?.select&&e.push(this.datasource?.options?.ogcFilters?.select),this.datasource?.options?.ogcFilters?.autocomplete&&e.push(this.datasource?.options?.ogcFilters?.autocomplete),e.sort((n,o)=>n.order<o.order?-1:n.order>o.order?1:0),e}get currentPushButtonsGroup(){return this.form.get("pushButtonsGroup").value}set currentPushButtonsGroup(e){this.form.patchValue({pushButtonsGroup:e})}get currentCheckboxesGroup(){return this.form.get("checkboxesGroup").value}set currentCheckboxesGroup(e){this.form.patchValue({checkboxesGroup:e})}get currentRadioButtonsGroup(){return this.form.get("radioButtonsGroup").value}set currentRadioButtonsGroup(e){this.form.patchValue({radioButtonsGroup:e})}get currentSelectGroup(){return this.form.get("selectGroup").value}set currentSelectGroup(e){this.form.patchValue({selectGroup:e}),this.cdRef.detectChanges()}get currentAutocompleteGroup(){return this.form.get("autocompleteGroup").value}set currentAutocompleteGroup(e){this.form.patchValue({autocompleteGroup:e}),this.cdRef.detectChanges()}get selectEnabled(){return this.selectEnabled$.value}set selectEnabled(e){this.selectEnabled$.next(e),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(o=>{e===o?o.enabled=!0:o.enabled=!1})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get selectEnableds(){return this.selectEnableds$.value}set selectEnableds(e){this.selectEnableds$.next(e),clearTimeout(this.applyFiltersTimeout),this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(o=>{e.includes(o)?o.enabled=!0:o.enabled=!1})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}get autocompleteEnableds(){return this.autocompleteEnableds$.value}set autocompleteEnableds(e){this.autocompleteEnableds$.next(e),clearTimeout(this.applyFiltersTimeout),this.currentAutocompleteGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(o=>{o.enabled=!1;for(let s of e)s===o.title&&(o.enabled=!0)})}),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}checkedStatus(e){return this.autocompleteEnableds.includes(e)}constructor(e,n,o,s,l){this.ogcFilterService=e,this.formBuilder=n,this.domService=o,this.configService=s,this.cdRef=l,this.ogcFilterWriter=new us,this.buildForm()}buildForm(){this.form=this.formBuilder.group({pushButtons:[""],radioButtons:[""],pushButtonsGroup:["",[Fn.required]],checkboxesGroup:["",[Fn.required]],radioButtonsGroup:["",[Fn.required]],selectGroup:["",[Fn.required]],select:[""],selectMulti:[""],autocompleteGroup:["",[Fn.required]],autocomplete:[""]})}getPushButtonsGroups(){if(this.datasource?.options?.ogcFilters?.pushButtons)return this.datasource.options.ogcFilters.pushButtons.groups}getCheckboxesGroups(){if(this.datasource?.options?.ogcFilters?.checkboxes)return this.datasource.options.ogcFilters.checkboxes.groups}getRadioButtonsGroups(){if(this.datasource?.options?.ogcFilters?.radioButtons)return this.datasource.options.ogcFilters.radioButtons.groups}getSelectGroups(){if(this.datasource?.options?.ogcFilters?.select)return this.datasource.options.ogcFilters.select.groups}getAutocompleteGroups(){if(this.datasource?.options?.ogcFilters?.autocomplete)return this.datasource.options.ogcFilters.autocomplete.groups}ngOnInit(){return un(this,null,function*(){this.datasource.options.ogcFilters&&(this.datasource.options.ogcFilters.pushButtons&&(this.currentPushButtonsGroup=this.datasource.options.ogcFilters.pushButtons.groups.find(e=>e.enabled)||this.datasource.options.ogcFilters.pushButtons.groups[0]),this.datasource.options.ogcFilters.checkboxes&&(this.currentCheckboxesGroup=this.datasource.options.ogcFilters.checkboxes.groups.find(e=>e.enabled)||this.datasource.options.ogcFilters.checkboxes.groups[0]),this.datasource.options.ogcFilters.radioButtons&&(this.currentRadioButtonsGroup=this.datasource.options.ogcFilters.radioButtons.groups.find(e=>e.enabled)||this.datasource.options.ogcFilters.radioButtons.groups[0]),this.datasource.options.ogcFilters.select&&(this.currentSelectGroup=this.datasource.options.ogcFilters.select.groups.find(e=>e.enabled)||this.datasource.options.ogcFilters.select.groups[0],this.initSelectEnabled(),yield this.getSelectDomValues()),this.datasource.options.ogcFilters.autocomplete&&(this.currentAutocompleteGroup=this.datasource.options.ogcFilters.autocomplete.groups.find(e=>e.enabled)||this.datasource.options.ogcFilters.autocomplete.groups[0],this.initAutocompleteEnableds(),yield this.getAutocompleteDomValues()),this.applyFilters()),this.form.get("pushButtonsGroup").valueChanges.pipe(Br(750)).subscribe(()=>{this.onPushButtonsChangeGroup(),this.applyFilters()}),this.form.get("checkboxesGroup").valueChanges.pipe(Br(750)).subscribe(()=>{this.onCheckboxesChangeGroup(),this.applyFilters()}),this.form.get("radioButtonsGroup").valueChanges.pipe(Br(750)).subscribe(()=>{this.onRadioButtonsChangeGroup(),this.applyFilters()}),this.form.get("selectGroup").valueChanges.pipe(Br(750)).subscribe(()=>{this.onSelectChangeGroup(),this.applyFilters()}),this.form.get("autocompleteGroup").valueChanges.pipe(Br(750)).subscribe(()=>{this.onAutocompleteChangeGroup(),this.applyFilters()}),this.form.get("pushButtons").valueChanges.pipe(Br(750)).subscribe(()=>{this.applyFilters()}),this.form.get("radioButtons").valueChanges.pipe(Br(750)).subscribe(()=>{this.applyFilters()}),this.inputChangeAutocomplete.pipe().subscribe(()=>{this.getAutocompleteDomValues()})})}initSelectEnabled(){let e=[],n;this.currentSelectGroup.computedSelectors.forEach(o=>{o.multiple?(o.selectors?.forEach(s=>{s.enabled&&e.push(s)}),this.selectEnableds=e,this.form.controls.selectMulti.setValue(e)):(o.selectors?.forEach(s=>{s.enabled&&(n=s)}),this.form.controls.select.reset(n),this.selectEnabled$.subscribe(s=>{this.form.controls.select.value!==s&&this.form.controls.select.setValue(s)}),this.selectEnabled=n)})}initAutocompleteEnableds(){let e=[];this.currentAutocompleteGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(o=>{if(o.enabled){let s={id:o.filters.expression,value:o.title};e.push(o.title),this.form.controls.autocomplete.setValue(s)}}),this.autocompleteEnableds=e})}getToolTip(e){let n;return e.tooltip&&(Array.isArray(e.tooltip)?n=e.tooltip.join(`
`):n=e.tooltip),n||""}getSelectDomValues(){return un(this,null,function*(){for(let e of this.datasource.options.ogcFilters.select.bundles)if(e.domSelectors){let n;for(let o of e.domSelectors){let s;for(let l of this.configService.getConfig("dom"))(o.id===l.id||o.name===l.name)&&(s={id:l.id,url:l.url,name:l.name,values:l.values});if(s.url?n=yield this.domService.getDomValuesFromURL(s):n=s.values,n){let l=e;l.selectors=[];let h;for(let p of n){if(e.multiple){let m;this.selectEnableds?.find(f=>f.title===p.value)?m=!0:m=!1,h={title:p.value,enabled:m,filters:{operator:o.operator,propertyName:o.propertyName,expression:p.id}}}else h={title:p.value,enabled:this.selectEnabled?.title===p.value,filters:{operator:o.operator,propertyName:o.propertyName,expression:p.id}};l.selectors.push(h)}this.getSelectGroups().find(p=>p.ids.includes(l.id)).computedSelectors.find(p=>p.title===l.title).selectors=l.selectors}}this.initSelectEnabled()}})}onInputChange(){this.inputChangeAutocomplete.next()}getAutocompleteDomValues(){return un(this,null,function*(){for(let e of this.datasource.options.ogcFilters.autocomplete.bundles)if(e.domSelectors){let n;for(let o of e.domSelectors){let s;for(let l of this.configService.getConfig("dom"))(o.id===l.id||o.name===l.name)&&(s={id:l.id,url:l.url,name:l.name,values:l.values});if(s.url?n=yield this.domService.getDomValuesFromURL(s):n=s.values,n){let l=e;l.selectors=[];let h;for(let p of n)h={title:p.id,enabled:!!this.autocompleteEnableds?.includes(p.value),filters:{operator:o.operator,propertyName:o.propertyName,expression:p.value}},l.selectors.push(h);this.getAutocompleteGroups().find(p=>p.ids.includes(l.id)).computedSelectors.find(p=>p.title===l.title).selectors=l.selectors}}this.filteredOgcAutocomplete[e.id]=new $r,this.cdRef.detectChanges(),this.filteredOgcAutocomplete[e.id]=ai(n)}})}getButtonColor(e){let n;return e.color&&e.enabled&&(n={"background-color":`rgba(${e.color})`}),n}bundleIsVertical(e){return e.vertical?e.vertical:!1}onPushButtonsChangeGroup(){this.getPushButtonsGroups().map(e=>e.enabled=!1),this.getPushButtonsGroups().find(e=>e===this.currentPushButtonsGroup).enabled=!0}onCheckboxesChangeGroup(){this.getCheckboxesGroups().map(e=>e.enabled=!1),this.getCheckboxesGroups().find(e=>e===this.currentCheckboxesGroup).enabled=!0}onRadioButtonsChangeGroup(){this.getRadioButtonsGroups().map(e=>e.enabled=!1),this.getRadioButtonsGroups().find(e=>e===this.currentRadioButtonsGroup).enabled=!0}onSelectChangeGroup(){this.getSelectGroups().map(e=>e.enabled=!1),this.getSelectGroups().find(e=>e===this.currentSelectGroup).enabled=!0}onAutocompleteChangeGroup(){this.getAutocompleteGroups().map(e=>e.enabled=!1),this.getAutocompleteGroups().find(e=>e===this.currentAutocompleteGroup).enabled=!0}onSelectionChange(e,n){clearTimeout(this.applyFiltersTimeout),n==="radioButton"&&this.emptyRadioButtons(),e&&(e.enabled=!e.enabled),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)}emptyRadioButtons(){this.currentRadioButtonsGroup.computedSelectors.forEach(e=>{e.selectors.map(n=>n.enabled=!1),this.applyFiltersTimeout=setTimeout(()=>{this.applyFilters()},750)})}emptySelect(){this.selectEnabled=void 0}emptyAutocomplete(){this.autocompleteEnableds=[],this.form.controls.autocomplete.setValue(""),this.form.controls.autocomplete.markAsUntouched()}toggleAllSelection(){if(this.selectAllSelected){let e=[];this.currentSelectGroup.computedSelectors.forEach(n=>{n.selectors?.forEach(o=>{e.push(o)})}),this.sel.options.forEach(n=>n.select()),this.selectEnableds=e}else this.sel.options.forEach(e=>e.deselect()),this.selectEnableds=[]}selectOptionClick(e,n,o){if(n.multiple){let s=this.selectEnableds,l=!0;if(this.sel.options.forEach(h=>{h.selected||(l=!1)}),this.selectAllSelected=l,o.isUserInput)if(s.length){for(let h of s)if(h.title===e.title){if(h.enabled&&e.enabled){s.splice(s.indexOf(h),1),this.selectEnableds=s;break}}else if(s.indexOf(h)===s.length-1){s.push(e),this.selectEnableds=s;break}}else s.push(e),this.selectEnableds=s}else this.selectEnabled=e}toggleAutocompleteOption(e,n){e.stopPropagation(),this.toggleSelection(n)}toggleSelection(e){this.autocompleteEnableds.includes(e)?this.autocompleteEnableds=this.autocompleteEnableds.filter(n=>n!==e):this.autocompleteEnableds=[...this.autocompleteEnableds,e]}displayFn(){return""}applyFilters(){let e="",n=[],o=[this.currentPushButtonsGroup,this.currentCheckboxesGroup,this.currentRadioButtonsGroup,this.currentSelectGroup,this.currentAutocompleteGroup];for(let s of o)s.computedSelectors&&s.computedSelectors.map(l=>{let h=[];l.selectors?.filter(p=>p.enabled===!0).forEach(p=>h.push(p.filters)),h.length>=1&&(h.length===1?n.push(h[0]):n.push({logical:l.logical,filters:h}))});this.isTemporalOperator()&&this._currentFilter.active&&n.push(this.datasource.options.ogcFilters.interfaceOgcFilters[0]),n.length>=1&&(e=this.ogcFilterWriter.buildFilter(n.length===1?n[0]:{logical:"And",filters:n})),this.datasource.options.type==="wms"&&this.ogcFilterService.filterByOgc(this.datasource,e),this.datasource.options.type==="wfs"&&this.datasource.ol.refresh(),this.datasource.setOgcFilters(this.datasource.options.ogcFilters,!0)}isMoreResults(e,n){let o=e.selectors.length,s=n==="radio"?this.radioButtonsIndex:this.checkboxesIndex;return o>s}displayMoreResults(e){e==="radio"?this.radioButtonsIndex+=5:this.checkboxesIndex+=5}isLessResults(e,n){let o=e.selectors.length,s=n==="radio"?this.radioButtonsIndex:this.checkboxesIndex;return this.baseIndex!==s&&o>this.baseIndex}displayLessResults(e){e==="radio"?this.radioButtonsIndex=this.baseIndex:this.checkboxesIndex=this.baseIndex}isTemporalOperator(){return this.currentFilter?.operator?.toLowerCase()===this.ogcFilterOperator.During.toLowerCase()}changeProperty(e,n,o=!0){let s=this.detectProperty(n);s&&(this.datasource.options.ogcFilters.interfaceOgcFilters.find(l=>l.filterid===this.currentFilter.filterid)[s]=e,o&&this.applyFilters())}detectProperty(e){switch(this.currentFilter.operator){case _i.PropertyIsNotEqualTo:case _i.PropertyIsEqualTo:case _i.PropertyIsGreaterThan:case _i.PropertyIsGreaterThanOrEqualTo:case _i.PropertyIsLessThan:case _i.PropertyIsLessThanOrEqualTo:return"expression";case _i.PropertyIsLike:return"pattern";case _i.PropertyIsBetween:return e&&e===1?"lowerBoundary":e&&e===2?"upperBoundary":void 0;case _i.During:return e&&e===1?"begin":e&&e===2?"end":void 0;default:return}}static \u0275fac=function(n){return new(n||r)(Ie(s1),Ie($c),Ie(yC),Ie(Oi),Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter-selection"]],viewQuery:function(n,o){if(n&1&&(Ir(D2e,5),Ir(Su,5,Su)),n&2){let s;bi(s=wi())&&(o.sel=s.first),bi(s=wi())&&(o.matAutocomplete=s.first)}},inputs:{refreshFilters:"refreshFilters",datasource:"datasource",map:"map",checkboxesIndex:"checkboxesIndex",radioButtonsIndex:"radioButtonsIndex",baseIndex:"baseIndex",currentFilter:"currentFilter"},standalone:!0,features:[Xi([yC]),lt],decls:3,vars:3,consts:[["notMulti",""],["selection",""],["input",""],["auto","matAutocomplete"],[3,"formGroup"],[4,"ngFor","ngForOf"],[4,"ngIf"],["class","pushButtonGroups",4,"ngIf"],["class","checkboxGroups",4,"ngIf"],["class","radioButtonGroups",4,"ngIf"],["class","selectGroups",4,"ngIf"],["class","autocompleteGroups",4,"ngIf"],[1,"pushButtonGroups"],["class","groupsSelector",4,"ngIf"],[1,"groupsSelector"],["formControlName","pushButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","pushButtons","appearance","legacy","multiple","true",1,"mat-typography",3,"vertical"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","ngStyle","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip","ngStyle","checked","value"],[1,"checkboxGroups"],["formControlName","checkboxesGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],[1,"checkboxes","mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","checked","value","change",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip","checked","value"],["class","lessResults mat-typography",3,"click",4,"ngIf"],["class","moreResults mat-typography",3,"click",4,"ngIf"],[1,"lessResults","mat-typography",3,"click"],[1,"moreResults","mat-typography",3,"click"],[1,"radioButtonGroups"],["formControlName","radioButtonsGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["formControlName","radioButtons",1,"mat-typography"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","change",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"change","matTooltip"],[1,"selectGroups"],["formControlName","selectGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","click",4,"ngIf"],[4,"ngIf","ngIfElse"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500","matTooltipClass","material-tooltip",3,"click","matTooltip"],["formControlName","selectMulti",3,"multiple","placeholder"],[3,"ngModel","ngModelOptions","ngModelChange","change",4,"ngIf"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"matTooltip","value","onSelectionChange",4,"ngFor","ngForOf"],[3,"ngModelChange","change","ngModel","ngModelOptions"],["tooltip-position","below","matTooltipDelay","500","matTooltipClass","material-tooltip",3,"onSelectionChange","matTooltip","value"],["formControlName","select",3,"placeholder"],[1,"autocompleteGroups"],["formControlName","autocompleteGroup","tooltip-position","below","matTooltipShowDelay","500",3,"valueChange","matTooltip","value"],["floatLabel","always",3,"width",4,"ngIf"],["floatLabel","always"],["matInput","","type","text","formControlName","autocomplete",3,"input","matAutocomplete"],[3,"displayWith"],["id","mat-option",3,"matTooltip",4,"ngFor","ngForOf"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove","",3,"matTooltip"],["id","mat-option",3,"matTooltip"],[3,"click"],["id","mat-checkbox","color","primary",3,"click","checked"],[3,"changeProperty","datasource","currentFilter"]],template:function(n,o){n&1&&($(0,"form",4),Pe(1,CCe,6,5,"div",5),ee(),Pe(2,ICe,5,4,"div",6)),n&2&&(z("formGroup",o.form),j(),z("ngForOf",o.ogcFiltersSelectors),j(),z("ngIf",o.isTemporalOperator()))},dependencies:[Sn,Xu,os,kn,Zu,nc,Sa,Ku,Qu,Li,Gt,dl,Uc,jr,Gr,Mo,ho,uo,Nn,Qt,ti,Bn,Ed,Gu,mu,cl,hl,ac,wm,vm,bm,jt,$t,gn,Cn,Oh,kh,Su,gC,Ei,Et,Tt,UJ,d8,jJ,VJ],styles:[`[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%]{margin:5px;flex-wrap:wrap;box-shadow:none!important;width:95%}[_nghost-%COMP%]   .checkboxes[_ngcontent-%COMP%]{flex-wrap:wrap;box-shadow:none}[_nghost-%COMP%]   .groupsSelector[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{display:inline-flex;border:1.5px solid black;border-radius:5px;margin:5px;white-space:normal;min-height:40px;height:auto;width:142px}[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]     .mat-button-toggle-label-content{line-height:unset;font-size:small;display:block}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:45%}}[_nghost-%COMP%]     .material-tooltip{white-space:pre-wrap}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%], [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:7px;width:95%;display:inline-flex;font-size:larger}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]     label, [_nghost-%COMP%]   mat-radio-button[_ngcontent-%COMP%]     label{white-space:normal}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{vertical-align:middle}[_nghost-%COMP%]   mat-button[_ngcontent-%COMP%]{padding-right:10px;cursor:pointer}[_nghost-%COMP%]   h3[_ngcontent-%COMP%]{margin:7px;text-align:left}[_nghost-%COMP%]   u[_ngcontent-%COMP%]{cursor:pointer;color:#00f;margin:5px}[_nghost-%COMP%]   p[_ngcontent-%COMP%]{margin:unset}
/*# sourceMappingURL=ogc-filter-selection.component-YPTLP5T2.css.map */`]})}return r})();function ECe(r,i){if(r&1&&ct(0,"igo-ogc-filter-selection",2),r&2){let e=ne();z("refreshFilters",e.refreshFunc)("datasource",e.datasource)("map",e.map)("currentFilter",e.currentFilter)}}function TCe(r,i){if(r&1&&ct(0,"igo-ogc-filter-form",4),r&2){let e=i.$implicit,n=ne(2);z("currentFilter",e)("refreshFilters",n.refreshFunc)("datasource",n.datasource)("map",n.map)}}function FCe(r,i){if(r&1&&Pe(0,TCe,1,4,"ng-template",3),r&2){let e=ne();z("ngForOf",e.datasource.options.ogcFilters.interfaceOgcFilters)}}var p8=(()=>{class r{datasource;map;refreshFilters;get refreshFunc(){return this.refreshFilters}get advancedOgcFilters(){if(this.datasource.options.ogcFilters)return this.datasource.options.ogcFilters.advancedOgcFilters}get currentFilter(){return this.datasource.options.ogcFilters.interfaceOgcFilters?this.datasource.options.ogcFilters.interfaceOgcFilters[0]:void 0}color="primary";static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filterable-form"]],inputs:{datasource:"datasource",map:"map",refreshFilters:"refreshFilters"},standalone:!0,features:[Xi([{provide:kG,useValue:{overlayPanelClass:"igo-overlay-panel-width"}},{provide:NG,useValue:{overlayPanelClass:"igo-overlay-panel-width"}}]),lt],decls:2,vars:2,consts:[["igoListItem","",3,"refreshFilters","datasource","map","currentFilter",4,"ngIf"],[4,"ngIf"],["igoListItem","",3,"refreshFilters","datasource","map","currentFilter"],["ngFor","",3,"ngForOf"],[3,"currentFilter","refreshFilters","datasource","map"]],template:function(n,o){n&1&&Pe(0,ECe,1,4,"igo-ogc-filter-selection",0)(1,FCe,1,1,null,1),n&2&&(z("ngIf",!o.advancedOgcFilters),j(),z("ngIf",o.advancedOgcFilters&&o.datasource.options.ogcFilters.editable))},dependencies:[Gt,h8,Qo,Li,a8],styles:[`.igo-overlay-panel-width{min-width:fit-content}
/*# sourceMappingURL=ogc-filterable-form.component-X2VZGYX2.css.map */`]})}return r})();var PCe=r=>({"separate-item":r}),LCe=r=>({cursor:r}),kCe=r=>({disabled:r});function OCe(r,i){if(r&1){let e=We();$(0,"mat-icon",11),ve("click",function(){we(e);let o=ne();return xe(o.toggleFiltersCollapsed())}),_e(1,"expand_less "),ee()}if(r&2){let e=ne(),n=Xt(8);z("target",n)("collapsed",e.filtersCollapsed)}}function DCe(r,i){if(r&1){let e=We();$(0,"span",12),ve("click",function(){we(e);let o=ne();return xe(o.toggleLegendOnClick())}),_e(1),ee()}if(r&2){let e=ne();z("ngStyle",fn(3,LCe,e.filtersCollapsed?"default":"pointer"))("matTooltip",e.layer.title),j(),Qe(" ",e.layer.title," ")}}function RCe(r,i){if(r&1){let e=We();$(0,"button",13),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.addFilterToSequence())}),$(2,"mat-icon"),_e(3,"add"),ee()()}if(r&2){let e=ne();z("disabled",e.addFilterDisabled())("matTooltip",ce(1,3,"igo.geo.filter.addFilter"))("color",e.color)}}function NCe(r,i){if(r&1){let e=We();$(0,"button",14),le(1,"translate"),le(2,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.layer.visible=!o.layer.visible)}),$(3,"mat-icon",2),le(4,"async"),_e(5),ee()()}if(r&2){let e=ne();z("color",e.layer.visible?"primary":"default")("matTooltip",e.layer.visible?ce(1,4,"igo.geo.layer.hideLayer"):ce(2,6,"igo.geo.layer.showLayer")),j(3),z("ngClass",fn(10,kCe,ce(4,8,e.inResolutionRange$)===!1)),j(2),Qe("",e.layer.visible?"visibility":"visibility_off"," ")}}function BCe(r,i){if(r&1&&ct(0,"igo-layer-legend",17),r&2){let e=ne(2);z("layer",e.layer)}}function GCe(r,i){if(r&1&&($(0,"div",15,1),Pe(2,BCe,1,1,"igo-layer-legend",16),le(3,"async"),ee()),r&2){let e=ne();j(2),z("ngIf",ce(3,1,e.showLegend$))}}function jCe(r,i){if(r&1){let e=We();$(0,"section",18),ct(1,"mat-divider"),$(2,"mat-checkbox",19),ve("change",function(o){we(e);let s=ne();return xe(s.changeOgcFilterType(o))}),eo("ngModelChange",function(o){we(e);let s=ne();return Jn(s.datasource.options.ogcFilters.advancedOgcFilters,o)||(s.datasource.options.ogcFilters.advancedOgcFilters=o),xe(o)}),_e(3),le(4,"translate"),ee()()}if(r&2){let e=ne();j(2),Qn("ngModel",e.datasource.options.ogcFilters.advancedOgcFilters),j(),Qe(" ",ce(4,2,"igo.geo.filter.advancedOgcFilters")," ")}}var c1=(()=>{class r{ogcFilterService;color="primary";lastRunOgcFilter;defaultLogicalParent=_i.And;hasActiveSpatialFilter=!1;filtersAreEditable=!0;filtersCollapsed=!0;hasSelector=!1;showLegend$=new ut(!1);inResolutionRange$=new ut(!0);resolution$$;ogcFilterWriter;layer;map;header=!0;get refreshFunc(){return this.refreshFilters.bind(this)}get datasource(){return this.layer.dataSource}constructor(e){this.ogcFilterService=e,this.ogcFilterWriter=new us}ngOnInit(){this.layer.visible&&(this.filtersCollapsed=!1);let e=this.datasource.options.ogcFilters;switch((e.pushButtons&&e.pushButtons.bundles.length>0||e.checkboxes&&e.checkboxes.bundles.length>0||e.radioButtons&&e.radioButtons.bundles.length>0||e.select&&e.select.bundles.length>0||e.autocomplete&&e.autocomplete.bundles.length>0)&&(e.advancedOgcFilters===void 0&&(e.advancedOgcFilters=!1),this.hasSelector=!0),this.datasource.options.type){case"wms":this.ogcFilterService.setOgcWMSFiltersOptions(this.datasource);break;case"wfs":this.ogcFilterService.setOgcWFSFiltersOptions(this.datasource);break;default:break}e&&(e.interfaceOgcFilters&&(this.lastRunOgcFilter=JSON.parse(JSON.stringify(e.interfaceOgcFilters)),e.interfaceOgcFilters.filter(o=>o.wkt_geometry).length>=1&&(this.hasActiveSpatialFilter=!0)),this.filtersAreEditable=e.editable?e.editable:!1);let n=this.layer.map.viewController.resolution$;this.resolution$$=n.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}addFilterToSequence(){this.filtersCollapsed=!1;let n=this.datasource.options.ogcFilters.interfaceOgcFilters||[],o=n.length===0?0:n[n.length-1].level,s="",l=this.datasource.options.sourceFields.filter(g=>!g.excludeFromOgcFilters);l.length>0&&(s=l[0].name===void 0?"":l[0].name);let h,p=this.datasource.options;p.fieldNameGeometry?h=p.fieldNameGeometry:this.datasource.options.paramsWFS&&this.datasource.options.paramsWFS.fieldNameGeometry&&(h=this.datasource.options.paramsWFS.fieldNameGeometry);let m=this.ogcFilterWriter.computeAllowedOperators(this.datasource.options.sourceFields,s,this.datasource.options.ogcFilters.allowedOperatorsType),f=Object.keys(m)[0];n.push(this.ogcFilterWriter.addInterfaceFilter({propertyName:s,operator:f,active:!0,igoSpatialSelector:"fixedExtent",srsName:this.map.projection},h,o,this.defaultLogicalParent)),this.datasource.options.ogcFilters.interfaceOgcFilters=n}refreshFilters(e){e===!0&&(this.lastRunOgcFilter=void 0);let n=this.datasource.options.ogcFilters,o=n.interfaceOgcFilters?n.interfaceOgcFilters.filter(s=>s.active===!0):[];if(o.length===0&&(n.filters=void 0,n.filtered=!1),o.length>1&&(o[0].parentLogical=o[1].parentLogical),o.filter(s=>["Contains","Intersects","Within"].indexOf(s.operator)!==-1).length===0?this.hasActiveSpatialFilter=!1:this.hasActiveSpatialFilter=!0,JSON.stringify(this.lastRunOgcFilter)!==JSON.stringify(o)){if(this.layer.dataSource.options.type==="wfs"){let l=this.layer.dataSource.options.ogcFilters;l.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(o),this.layer.dataSource.ol.refresh()}else if(this.layer.dataSource.options.type==="wms"&&n.enabled){let s="";if(o.length>=1){let l=this.layer.dataSource,h=l.options.ogcFilters;h.filters=this.ogcFilterWriter.rebuiltIgoOgcFilterObjectFromSequence(o),s=this.ogcFilterWriter.buildFilter(h.filters,void 0,void 0,this.layer.dataSource.options.fieldNameGeometry,l.options)}this.ogcFilterService.filterByOgc(this.datasource,s),this.datasource.options.ogcFilters.filtered=o.length!==0}this.lastRunOgcFilter=JSON.parse(JSON.stringify(o))}this.layer.dataSource.setOgcFilters(n,!0)}setVisible(){this.layer.visible=!0}isAdvancedOgcFilters(){return this.datasource.options.ogcFilters.advancedOgcFilters}addFilterDisabled(){return!this.datasource.options.sourceFields||this.datasource.options.sourceFields.length===0}changeOgcFiltersAdvancedOgcFilters(e){this.datasource.options.ogcFilters.advancedOgcFilters=e}changeOgcFilterType(e){this.changeOgcFiltersAdvancedOgcFilters(e.checked),e.checked&&this.refreshFilters(!0)}toggleLegend(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(n){return new(n||r)(Ie(s1))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filterable-item"]],inputs:{layer:"layer",map:"map",header:"header"},standalone:!0,features:[Xi([s1]),lt],decls:12,vars:12,consts:[["ogcFilters",""],["legend",""],[3,"ngClass"],["class","igo-chevron","matListItemIcon","","igoCollapse","",3,"target","collapsed","click",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"ngStyle","matTooltip","click",4,"ngIf"],["matListItemMeta",""],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"disabled","matTooltip","color","click",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","igo-layer-legend-container",4,"ngIf"],[3,"datasource","map","refreshFilters"],["class","mat-typography advancedOgcFilters",4,"ngIf"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"click","target","collapsed"],["matListItemTitle","","matTooltipShowDelay","500",3,"click","ngStyle","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","disabled","matTooltip","color"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],[1,"igo-layer-legend-container"],[3,"layer",4,"ngIf"],[3,"layer"],[1,"mat-typography","advancedOgcFilters"],[3,"change","ngModelChange","ngModel"]],template:function(n,o){n&1&&($(0,"div",2)(1,"mat-list-item"),Pe(2,OCe,2,2,"mat-icon",3)(3,DCe,2,5,"span",4),$(4,"div",5),Pe(5,RCe,4,5,"button",6)(6,NCe,6,12,"button",7),ee()(),$(7,"div",null,0),Pe(9,GCe,4,3,"div",8),ct(10,"igo-ogc-filterable-form",9),Pe(11,jCe,5,4,"section",10),ee()()),n&2&&(z("ngClass",fn(10,PCe,o.header===!0)),j(2),z("ngIf",o.header),j(),z("ngIf",o.header),j(2),z("ngIf",o.isAdvancedOgcFilters()&&o.filtersAreEditable),j(),z("ngIf",o.header),j(3),z("ngIf",o.header),j(),z("datasource",o.datasource)("map",o.map)("refreshFilters",o.refreshFunc),j(),z("ngIf",o.hasSelector&&o.filtersAreEditable))},dependencies:[_a,Io,ks,oc,Uc,Ta,Ju,Gt,jt,$t,Vp,cl,Qt,ti,Vt,ci,Up,p8,dl,hl,ac,Sn,kn,nc,Ei,Et,Tt],styles:[`[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .advancedOgcFilters[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block}[_nghost-%COMP%]   .mat-mdc-list-item[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}[_nghost-%COMP%]   mat-icon.disabled[_ngcontent-%COMP%]{color:#00000061}[_nghost-%COMP%]   .separate-item[_ngcontent-%COMP%]{border-bottom:4px solid darkgrey}[_nghost-%COMP%]     .mdc-list-item__start, [_nghost-%COMP%]     .mdc-list-item__end, [_nghost-%COMP%]     .mdc-list-item__content{pointer-events:auto}
/*# sourceMappingURL=ogc-filterable-item.component-WRZIGHLJ.css.map */`]})}return r})();function VCe(r,i){if(r&1&&($(0,"button",3),le(1,"translate"),$(2,"mat-icon",4),_e(3,"filter_alt"),ee()()),r&2){let e=ne();z("matTooltip",ce(1,3,"igo.geo.filter.filterBy"))("color",e.color),j(2),z("matBadge",e.badge)}}function UCe(r,i){if(r&1&&ct(0,"igo-ogc-filterable-item",7),r&2){let e=ne(2);z("header",!1)("map",e.layer.map)("layer",e.layer)}}function zCe(r,i){if(r&1&&($(0,"div",5,0),Pe(2,UCe,1,3,"igo-ogc-filterable-item",6),ee()),r&2){let e=ne();j(2),z("ngIf",e.ogcFilterCollapse&&e.options.ogcFilters.enabled)}}var $Ce=(()=>{class r{options;get badge(){let e=this.options.ogcFilters,n=0;if(e&&!e.advancedOgcFilters){if(e.pushButtons){let s=e.pushButtons.groups.find(h=>h.enabled),l=0;s&&s.computedSelectors?.map(h=>l+=h.selectors?.filter(p=>p.enabled).length),n+=l}if(e.checkboxes){let s=e.checkboxes.groups.find(h=>h.enabled),l=0;s&&s.computedSelectors?.map(h=>l+=h.selectors?.filter(p=>p.enabled).length),n+=l}if(e.radioButtons){let s=e.radioButtons.groups.find(h=>h.enabled),l=0;s&&s.computedSelectors?.map(h=>l+=h.selectors?.filter(p=>p.enabled).length),n+=l}if(e.select){let s=e.select.groups.find(h=>h.enabled),l=0;s&&s.computedSelectors?.map(h=>l+=h.selectors?.filter(p=>p.enabled).length),n+=l}if(e.autocomplete){let s=e.autocomplete.groups.find(h=>h.enabled),l=0;s&&s.computedSelectors?.map(h=>l+=h.selectors?.filter(p=>p.enabled).length),n+=l}}else{if(e&&e.filters&&!e.filters.filters)return 1;if(e&&e.filters&&e.filters.filters)return e.filters.filters.length}if(e.filters&&e.filters.operator==="During"&&e.filters.active&&e.interfaceOgcFilters&&e.interfaceOgcFilters[0].active){let o=e.interfaceOgcFilters[0];e.filters.calendarModeYear?(o.begin.substring(0,4)!==this.options.minDate.substring(0,4)||o.end.substring(0,4)!==this.options.maxDate.substring(0,4))&&(n+=1):(o.begin!==this.options.minDate||o.end!==this.options.maxDate)&&(n+=1)}return n>0?n:void 0}get layer(){return this._layer}set layer(e){this._layer=e,e&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header;ogcFilterCollapse=!1;ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[lt],decls:2,vars:2,consts:[["ogcFilter",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["igoListItem","",3,"header","map","layer",4,"ngIf"],["igoListItem","",3,"header","map","layer"]],template:function(n,o){n&1&&Pe(0,VCe,4,5,"button",1)(1,zCe,3,1,"div",2),n&2&&(z("ngIf",o.header&&o.options.ogcFilters&&o.options.ogcFilters.enabled&&(o.options.ogcFilters.pushButtons||o.options.ogcFilters.checkboxes||o.options.ogcFilters.radioButtons||o.options.ogcFilters.select||o.options.ogcFilters.autocomplete||o.options.ogcFilters.editable)),j(),z("ngIf",o.options.ogcFilters&&o.options.ogcFilters.enabled&&(o.options.ogcFilters.pushButtons||o.options.ogcFilters.checkboxes||o.options.ogcFilters.radioButtons||o.options.ogcFilters.select||o.options.ogcFilters.autocomplete||o.options.ogcFilters.editable)))},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,xl,Md,c1,Qo,Et,Tt],changeDetection:0})}return r})();function WCe(r,i){r&1&&($(0,"div",3),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.filter.noFilterableLayer")," "))}function HCe(r,i){if(r&1&&ct(0,"igo-ogc-filterable-item",4),r&2){let e=i.$implicit;z("header",!0)("layer",e)("map",e.map)}}var m8=(()=>{class r{layers;map;static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filterable-list"]],inputs:{layers:"layers",map:"map"},standalone:!0,features:[lt],decls:5,vars:10,consts:[[3,"navigation","selection"],["id","no-layer-message",4,"ngIf"],["ngFor","",3,"ngForOf"],["id","no-layer-message"],["igoListItem","",3,"header","layer","map"]],template:function(n,o){n&1&&($(0,"igo-list",0),Pe(1,WCe,3,3,"div",1),le(2,"filterableDataSource"),Pe(3,HCe,1,3,"ng-template",2),le(4,"filterableDataSource"),ee()),n&2&&(z("navigation",!1)("selection",!1),j(),z("ngIf",Ao(2,4,o.layers,"ogc").length===0),j(2),z("ngForOf",Ao(4,7,o.layers,"ogc")))},dependencies:[yc,Gt,Li,c1,Qo,Et,Tt,pC],styles:[`#no-layer-message[_ngcontent-%COMP%]{padding:7%;text-align:center;font-size:medium;font-weight:700}
/*# sourceMappingURL=ogc-filterable-list.component-GPBN3EMO.css.map */`],changeDetection:0})}return r})();var YCe=(()=>{class r{mapService;component;layers$$;constructor(e,n){this.mapService=n,this.component=e}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layerController.layersFlattened$.subscribe(e=>{this.component.layers=e})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(n){return new(n||r)(Ie(m8,2),Ie(nf))};static \u0275dir=Fi({type:r,selectors:[["","igoOgcFilterableListBinding",""]],standalone:!0})}return r})();var po=function(r){return r.Point="Point",r.LineString="LineString",r.Polygon="Polygon",r.Circle="Circle",r}(po||{}),Pr=function(r){return r.Coordinates="Coordinates",r.Length="Length",r.Area="Area",r.Predefined="Predefined",r.Custom="Custom",r}(Pr||{}),x_=function(r){return r.DecimalDegree="DD",r.DegreesMinutesSeconds="DMS",r}(x_||{});var zJ=(()=>{class r{config;icons;constructor(e){this.config=e,this.getIconsList()}getIcons(){return this.icons}getPath(){return this.config.getConfig("drawingTool.icons")||[]}getIconsList(){this.icons=this.getPath()}static \u0275fac=function(n){return new(n||r)(pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var dh=function(r){return r.Length="length",r.Area="area",r}(dh||{}),or=function(r){return r.Meters="meters",r.Kilometers="kilometers",r.Miles="miles",r.Feet="feet",r}(or||{}),hh={[or.Meters]:"m",[or.Kilometers]:"km",[or.Miles]:"mi",[or.Feet]:"ft"},Bo=function(r){return r.SquareMeters="squareMeters",r.SquareKilometers="squareKilometers",r.SquareMiles="squareMiles",r.SquareFeet="squareFeet",r.Hectares="hectares",r.Acres="acres",r}(Bo||{}),Zp={[Bo.SquareMeters]:"m\xB2",[Bo.SquareKilometers]:"km\xB2",[Bo.SquareMiles]:"mi\xB2",[Bo.SquareFeet]:"ft\xB2",[Bo.Hectares]:"ha",[Bo.Acres]:"ac"};function XCe(r){return r*.001}function KCe(r){return r*3.2808}function QCe(r){return r*621e-6}function JCe(r){return r*1e-6}function eAe(r){return r*3861e-10}function tAe(r){return r*10.764}function iAe(r){return r*1e-4}function rAe(r){return r*24711e-8}function np(r,i){let n=new Map([[or.Meters,o=>o],[or.Kilometers,XCe],[or.Miles,QCe],[or.Feet,KCe]]).get(i);return n?n(r):void 0}function Xp(r,i){let n=new Map([[Bo.SquareMeters,o=>o],[Bo.SquareKilometers,JCe],[Bo.SquareMiles,eAe],[Bo.SquareFeet,tAe],[Bo.Hectares,iAe],[Bo.Acres,rAe]]).get(i);return n?n(r):void 0}function S_(r,i,e){let n=i.decimal;(n===void 0||n<0)&&(n=1);let o=[];return i.locale!==void 0?o.push(r.toLocaleString(i.locale,{minimumFractionDigits:n,maximumFractionDigits:n})):o.push(r.toFixed(n).toString()),i.unit!==void 0&&i.unitAbbr===!0&&(e?o.push(hh[i.unit]?e.translate.instant("igo.geo.measure."+hh[i.unit]):e.translate.instant("igo.geo.measure."+Zp[i.unit])):o.push(hh[i.unit]||Zp[i.unit])),o.filter(s=>s!==void 0).join(" ")}function $J(r){let i=or.Meters,e=r,n=[or.Kilometers];for(;e>1e3&&n.length>0;)i=n.pop(),e=np(r,i);return i}function WJ(r){let i=Bo.SquareMeters,e=r,n=[Bo.SquareKilometers];for(;e>1e6&&n.length>0;)i=n.pop(),e=Xp(r,i);return i}function n3(){return new oi({stroke:new ui({color:"#ffcc33",lineDash:[10,10],width:2}),fill:new hi({color:"rgba(255, 255, 255, 0.2)"}),image:new an({radius:5,stroke:new ui({color:"#ffcc33"}),fill:new hi({color:"rgba(255, 255, 255, 0.2)"})})})}function HJ(){return new oi({stroke:new ui({color:"#ffcc33",width:2}),fill:new hi({color:"rgba(255, 255, 255, 0.2)"})})}function u1(r,i){if(!(r instanceof Ii)&&r.getFlatCoordinates().length!==0)return sy(r,{projection:i})}function d1(r,i){if(!(r instanceof Ii||r instanceof Tr)&&r.getFlatCoordinates().length!==0)return wP(r,{projection:i})}function vC(r,i){let e=u1(r,i),n=d1(r,i),o=[],s=r.getFlatCoordinates(),l=s.length;for(let h=0;h<=l-4;h+=2){let p=new Tr([[s[h],s[h+1]],[s[h+2],s[h+3]]]);o.push(u1(p,i))}return{area:n,length:e,lengths:o}}function o3(r){let i;if(r instanceof Ii){let e=new Ii(r.getFlatCoordinates());i=new Array(1),i[0]=e}else{i=qJ(r);let e=r.getFlatCoordinates(),n=i.length;for(let o=0;o<n;o++){let s=o*2,h=new Tr([[e[s],e[s+1]],[e[s+2],e[s+3]]]).getCoordinateAt(.5),p=i[o];p!==void 0?p.setCoordinates(h):i[o]=new Ii(h)}}return i}function qJ(r){let i;r instanceof Tu?i=0:i=Math.max(r.getFlatCoordinates().length/2-1,0);let e=r.get("_midpoints");if(e===void 0)return r instanceof Ii?e=new Array(1):e=new Array(i),r.set("_midpoints",e,!0),e;if(i===0||i===e.length)return e;if(i>e.length)return e.push(...new Array(i-e.length)),e;for(let n=i;n<e.length;n++){let o=e[i];o!==void 0&&nAe(o)}return e.splice(i),e}function nAe(r){let i=r.get("_tooltip");if(i!==void 0){let e=i.getMap();e!==void 0&&e.removeOverlay(i)}}function YJ(r){let i=o3(r),e="";return r instanceof Tr?e="line-":r instanceof on&&(e="polygone-"),i.map(o=>{let s=o.get("_tooltip");return s===void 0?s=KJ(o,!1,e):s.setPosition(o.getFlatCoordinates()),s})}function oAe(r){return qJ(r).map(e=>e?e.get("_tooltip"):void 0)}function ZJ(r){let i=r.get("_center"),e=as(r.getExtent());return i!==void 0?i.setCoordinates(e):(i=new Ii(e),r.set("_center",i)),i}function XJ(r){let i=ZJ(r),e=i.get("_tooltip");return e===void 0?e=KJ(i,!0):e.setPosition(i.getFlatCoordinates()),e}function aAe(r){let i=r.get("_center");return i?i.get("_tooltip"):void 0}function yw(r){let i=[].concat(oAe(r)||[]),e=aAe(r);return e!==void 0&&i.push(e),i}function KJ(r,i=!1,e=""){let n=new AT({element:document.createElement("div"),offset:[-30,-10],className:(i?["igo-map-tooltip","igo-map-tooltip-measure","igo-map-tooltip-measure-area"]:["igo-map-tooltip","igo-map-tooltip-measure",`igo-map-tooltip-measure-${e}segments`]).join(" "),stopEvent:!1});return n.setPosition(r.getFlatCoordinates()),r.set("_tooltip",n),n}function bC(r,i,e){return new oi({stroke:new ui({color:i||"rgba(143,7,7,1)",width:e||1}),fill:new hi({color:r||"rgba(255,255,255,0.4)"}),image:new an({radius:5,stroke:new ui({color:i||"rgba(143,7,7,1)",width:e||1}),fill:new hi({color:r||"rgba(255,255,255,0.4)"})})})}function a3(r,i){let n=new Map([[x_.DecimalDegree,o=>{if(typeof o[0]=="number")return Rh(o,5);{let s=[Number(o[0]),Number(o[1])];return Rh(s,5)}}],[x_.DegreesMinutesSeconds,o=>hM(o,2)]]).get(i);return n?n(r):void 0}var ph=class extends td{options;stores$$=new Map;states$$=[];empty$$;constructor(i){super(i),this.options=i}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i),this.empty$$=i.empty$.pipe(Ch(e=>!e)).subscribe(()=>this.updateEntitiesInExtent(i))}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}watchStore(i){if(this.stores$$.has(i))return;this.updateEntitiesInExtent(i);let e=i.map??i.layer.map;e&&this.states$$.push(e.viewController.state$.pipe(Br(250)).subscribe(()=>this.updateEntitiesInExtent(i)))}updateEntitiesInExtent(i){if(i?.layer?.map?.viewController){i.state.updateAll({inMapExtent:!1});let e=i.layer.map.viewController.getExtent(),n=i.entities$.value,o=this.getFeaturesInExtent(n,e);i.state.updateMany(o,{inMapExtent:!0},!1)}}getFeaturesInExtent(i,e){return i.reduce((n,o)=>{let s=o.ol?.getGeometry();if(s){let l=s.getExtent();On(l,e)&&n.push(o)}else n.push(o);return n},[])}unwatchStore(i){this.stores$$.get(i)!==void 0&&this.stores$$.delete(i)}unwatchAll(){this.stores$$.clear(),this.states$$.map(i=>i.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}};var pf=class extends td{options;stores$$=new Map;resolution$$=[];empty$$;constructor(i){super(i),this.options=i}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i),this.empty$$=i.empty$.subscribe(()=>this.updateEntitiesInResolution(i,i.layer.map.viewController.getResolution()))}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}watchStore(i){this.stores$$.has(i)||(this.updateEntitiesInResolution(i,i.layer.map.viewController.getResolution()),this.resolution$$.push(i.layer.map.viewController.resolution$.pipe(Br(250)).subscribe(e=>{this.updateEntitiesInResolution(i,e)})))}updateEntitiesInResolution(i,e){e>i.layer.minResolution&&e<i.layer.maxResolution?i.state.updateAll({inMapResolution:!0}):i.state.updateAll({inMapResolution:!1})}unwatchStore(i){this.stores$$.get(i)!==void 0&&this.stores$$.delete(i)}unwatchAll(){this.stores$$.clear(),this.resolution$$.map(i=>i.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}};var C_=class extends td{options;propertyTypeDetectorService;capabilitiesService;stores$$=new Map;states$$=[];empty$$;map;constructor(i,e,n){super(i),this.options=i,this.propertyTypeDetectorService=e,this.capabilitiesService=n,this.map=i.map}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i)}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}watchStore(i){this.stores$$.has(i)||(this.updateEntitiesPropertiesState(i),this.states$$.push(this.map.layerController.all$.pipe(Br(250),b7()).subscribe(([e,n])=>{let o;e&&(o=e.map(l=>l.id));let s=n.filter(l=>!o.includes(l.id));this.updateEntitiesPropertiesState(i,s)})),this.states$$.push(i.entities$.pipe(Br(250)).subscribe(()=>{this.updateEntitiesPropertiesState(i)})))}updateEntitiesPropertiesState(i,e){let n=this.map.layerController.all.map(y=>y.id),o=[];e?o=i.entities$.value:o=i.stateView.all().length?i.stateView.all().filter(_=>!_.state.geoService).map(_=>_.entity):i.entities$.value;let s=o.length>=250?250:o.length,l=o.slice(0,s),h=[];l.map(y=>{h=h.concat(Object.keys(y.properties||{}))}),h=[...new Set(h)];let p={};h.map(y=>{p[y]=[...new Set(o.map(_=>_.properties[y]))]});let m={};Object.entries(p).forEach(y=>{let[_,w]=y,A=w.filter(k=>this.propertyTypeDetectorService.isGeoService(k));A?.length&&(m[_]=A)});let f=[];Object.entries(m).forEach(y=>{let[_,w]=y;w.map(A=>{let k=this.propertyTypeDetectorService.getGeoService(A,h);if(k){let R=h.filter(X=>k.propertiesForLayerName.includes(X)),q=R.length?R[0]:void 0;q&&f.push({url:A,urlProperty:_,layerNameProperty:q,geoService:k})}})});let g=[];f.map(y=>{let _=y.url,w=y.geoService.type||"wms";p[y.layerNameProperty].map(A=>{let k=A,R;["arcgisrest","imagearcgisrest","tilearcgisrest"].includes(w)&&(k=void 0,R=A);let q=rr.removeUndefined({sourceOptions:{type:w||"wms",url:_,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:k,LAYER:R}}}),X=Ep(q.sourceOptions);g.push({geoServiceAssociation:y,state:{added:n.find(ie=>ie===X)!==void 0,haveGeoServiceProperties:!0,type:w,url:_,layerName:A}})})}),g.map(y=>{let _=y.geoServiceAssociation.urlProperty,w=y.geoServiceAssociation.layerNameProperty,A=y.state.url,k=y.state.layerName,R=o.filter(X=>X.properties[_]===A&&X.properties[w]===k),q={geoService:y.state};i.state.updateMany(R,q,!0)})}unwatchStore(i){this.stores$$.get(i)!==void 0&&this.stores$$.delete(i)}unwatchAll(){this.stores$$.clear(),this.states$$.map(i=>i.unsubscribe()),this.empty$$&&this.empty$$.unsubscribe()}};var mf=class extends td{options;stores$$=new Map;constructor(i){super(i),this.options=i}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i)}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}watchStore(i){if(this.stores$$.has(i))return;this.onSourceChanges(i),i.layer.ol.getSource().on("change",()=>{this.onSourceChanges(i)})}unwatchStore(i){this.stores$$.get(i)!==void 0&&this.stores$$.delete(i)}unwatchAll(){this.stores$$.clear()}onSourceChanges(i){let e=i.layer.ol.getSource().getFeatures();i.layer.dataSource instanceof kc&&(e=e.flatMap(n=>n.get("features"))),e.length===0?i.clear():i.setStoreOlFeatures(e)}};var f8=Jl(QJ());var s3=class extends td{options;stores$$=new Map;constructor(i){super(i),this.options=i}bindStore(i){super.bindStore(i),this.active===!0&&this.watchStore(i)}unbindStore(i){super.unbindStore(i),this.active===!0&&this.unwatchStore(i)}doActivate(){this.stores.forEach(i=>this.watchStore(i))}doDeactivate(){this.unwatchAll()}initStoreSearchIndex(i){i.searchDocument=new f8.Document({tokenize:"full"})}watchStore(i){this.stores$$.has(i)||(this.initStoreSearchIndex(i),i.entities$.pipe(Ch(e=>!e.length)).subscribe(()=>this.onEntitiesChanges(i)))}unwatchStore(i){this.stores$$.get(i)!==void 0&&(i.searchDocument=void 0,this.stores$$.delete(i))}unwatchAll(){this.stores$$.clear()}onEntitiesChanges(i){let e=this.options.percentDistinctValueRatio||2,n=[];i.index.forEach((h,p)=>{let m=h.properties;m.igoSearchID=p,n.push(m)});let o=[],s=[],l=[];if(this.options.sourceFields)s=this.options.sourceFields.filter(h=>!h.searchIndex?.enabled),l=this.options.sourceFields.filter(h=>h.searchIndex?.enabled).map(h=>Object.assign({},{field:h.name,tokenize:"full"},h.searchIndex));else if(n.length){let h=Object.keys(n[0]),p=[];s=h.map(f=>{let g=[...new Set(n.map(y=>y[f]))];g.length/n.length*100<=e||g.every(y=>Number(y)===y&&y%1!==0)?s.push(f):p.push(f)}).filter(f=>f),l=p.filter(f=>f!=="igoSearchID").map(f=>({field:f,tokenize:"full"}))}i.index.forEach(h=>{let p=JSON.parse(JSON.stringify(h.properties));s.map(m=>delete p[m]),Object.keys(p).length&&o.push(p)}),o.length===0?this.initStoreSearchIndex(i):(i.searchDocument=new f8.Document({document:{id:"igoSearchID",index:l}}),o.map(h=>{i.searchDocument.add(h.igoSearchID,h)}))}};var So=(()=>{class r{storageService;static id="";static type="";options;getId(){throw new Error('You have to implement the method "getId".')}getType(){throw new Error('You have to implement the method "getType".')}getDefaultOptions(){throw new Error('You have to implement the method "getDefaultOptions".')}get title(){return this.options.title}get available(){return this.options.available!==!1}set enabled(e){this.options.enabled=e}get enabled(){return this.available&&this.options.enabled!==!1}get showInPointerSummary(){let e=this.options.showInPointerSummary;return e||!1}get showInSettings(){let e=this.options.showInSettings;return e===void 0?!0:e}get searchUrl(){return this.options.searchUrl}get params(){return this.options.params}get settings(){return this.options.settings===void 0?[]:this.options.settings}set featureStoresWithIndex(e){this._featureStoresWithIndex=e}get featureStoresWithIndex(){return this._featureStoresWithIndex}_featureStoresWithIndex;setWorkspaces(e){e.filter(s=>s.entityStore.searchDocument).length>=1?this.options.available=!0:this.options.available=!1;let n=[];this.featureStoresWithIndex=e.filter(s=>s.entityStore.searchDocument).map(s=>(n.push({title:s.title,value:s.title,enabled:!0}),s.entityStore));let o=this.options.settings.find(s=>s.title==="datasets");o&&(o.values=n),this.setParamFromSetting(o)}setParamFromSetting(e,n=!0){switch(e.type){case"radiobutton":e.values.forEach(o=>{o.enabled&&(this.options.params=Object.assign(this.options.params||{},{[e.name]:o.value}))});break;case"checkbox":{let o="";e.values.filter(s=>s.available!==!1).forEach(s=>{s.enabled&&(o+=s.value+",")}),o=o.slice(0,-1),this.options.params=Object.assign(this.options.params||{},{[e.name]:o});break}}n&&this.storageService&&this.storageService.set(this.getId()+".options",{params:this.options.params})}get displayOrder(){return this.options.order===void 0?99:this.options.order}constructor(e,n){if(this.storageService=n,this.options=e,this.storageService){let o=this.storageService.get(this.getId()+".options");o&&(this.options=rr.mergeDeep(this.options,o))}this.options=rr.mergeDeep(this.getDefaultOptions(),this.options),this.settings.forEach(o=>{this.setParamFromSetting(o,!1)})}getHashtagsValid(e,n){let o=e.match(/(#[A-Za-z--+]+)/g);if(!o)return;let s=this.getSettingsValues(n),l=[];return o.forEach(h=>{s.values.forEach(p=>{let m=h.substring(1);if(typeof p.value=="string"){let f=p.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(","),g=f.indexOf(m.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""));g!==-1&&l.push(f[g])}p.hashtags&&p.hashtags.indexOf(m.toLowerCase())!==-1&&l.push(p.value)})}),l.filter((h,p)=>l.indexOf(h)===p)}getSettingsValues(e){return this.getDefaultOptions().settings.find(n=>n.name===e)}}return r})();var JJ=()=>({cursor:"pointer",color:"blue"});function sAe(r,i){if(r&1&&($(0,"td")(1,"mat-icon",7),_e(2),ee()()),r&2){let e=ne(3);j(2),bt(e.icon)}}function lAe(r,i){if(r&1){let e=We();$(0,"td")(1,"a",8),_e(2),le(3,"translate"),ee(),$(4,"button",9),ve("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.copyTextToClipboard(o.value))}),$(5,"mat-icon"),_e(6,"content_copy"),ee()()()}if(r&2){let e=ne().$implicit,n=ne(2);j(),sr("href",e.value,Rf),j(),Nf(" ",ce(3,3,"igo.geo.targetHtmlUrl")," ",n.title,"")}}function cAe(r,i){if(r&1&&($(0,"td",10),_e(1),ee()),r&2){let e=ne().$implicit;j(),Qe(" ",e.key," ")}}function uAe(r,i){if(r&1&&ct(0,"td",11),r&2){let e=ne().$implicit;z("innerHTML",e.value,hm)}}function dAe(r,i){if(r&1){let e=We();$(0,"td")(1,"u",12),ve("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.openSecureUrl(o.value))}),_e(2),ee()()}if(r&2){let e=ne().$implicit,n=ne(2);j(),z("ngStyle",Ih(2,JJ)),j(),bt(n.getEmbeddedLinkText(e.value))}}function hAe(r,i){if(r&1){let e=We();$(0,"td")(1,"u",12),ve("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.openSecureUrl(o.value))}),_e(2),le(3,"translate"),ee(),$(4,"button",9),ve("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.copyTextToClipboard(o.value))}),$(5,"mat-icon"),_e(6,"content_copy"),ee()()()}r&2&&(j(),z("ngStyle",Ih(4,JJ)),j(),bt(ce(3,2,"igo.geo.targetHtmlUrl")))}function pAe(r,i){if(r&1){let e=We();$(0,"td")(1,"a",13),ve("click",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.openSecureUrl(o.value))}),ct(2,"img",14),le(3,"secureImage"),le(4,"async"),ee()()}if(r&2){let e=ne().$implicit;j(),sr("href",e.value,Rf),j(),sr("src",ce(4,4,ce(3,2,e.value)),Rf)}}function mAe(r,i){if(r&1&&(ct(0,"td",11),le(1,"json")),r&2){let e=ne().$implicit;z("innerHTML",ce(1,1,e.value),hm)}}function fAe(r,i){if(r&1&&($(0,"tr"),Pe(1,sAe,3,1,"td",4)(2,lAe,7,5,"td",4)(3,cAe,2,1,"td",5)(4,uAe,1,1,"td",6)(5,dAe,3,3,"td",4)(6,hAe,7,5,"td",4)(7,pAe,5,6,"td",4)(8,mAe,2,3,"td",6),ee()),r&2){let e=i.$implicit,n=ne(2);j(),z("ngIf",n.feature.properties.target==="_blank"&&e.key==="url"),j(),z("ngIf",n.feature.properties.target==="_blank"&&e.key==="url"),j(),z("ngIf",n.feature.properties.target===void 0),j(),z("ngIf",n.feature.properties.target===void 0&&!n.isObject(e.value)&&!n.isUrl(e.value)&&!n.isEmbeddedLink(e.value)),j(),z("ngIf",n.feature.properties.target===void 0&&n.isEmbeddedLink(e.value)),j(),z("ngIf",n.feature.properties.target===void 0&&!n.isObject(e.value)&&(n.isDoc(e.value)||n.isUrl(e.value))&&!n.isImg(e.value)),j(),z("ngIf",n.feature.properties.target===void 0&&!n.isObject(e.value)&&n.isUrl(e.value)&&n.isImg(e.value)),j(),z("ngIf",n.feature.properties.target===void 0&&n.isObject(e.value))}}function gAe(r,i){if(r&1&&($(0,"table",2)(1,"tbody"),Pe(2,fAe,9,8,"tr",3),le(3,"keyvalue"),ee()()),r&2){let e=ne();j(2),z("ngForOf",ce(3,1,e.filterFeatureProperties(e.feature)))}}function _Ae(r,i){if(r&1&&ct(0,"iframe",15),r&2){let e=ne();z("srcdoc",e.htmlSanitizer(e.feature.properties),hm)("src",e.urlSanitizer(e.feature.properties.url),S7)}}var vw=(()=>{class r{http;cdRef;sanitizer;networkService;messageService;configService;state;unsubscribe$=new Si;ready=!1;get source(){return this._source}set source(e){this._source=e,this.cdRef.detectChanges()}map;toolbox;get feature(){return this._feature}set feature(e){this._feature=e,this.cdRef.detectChanges(),this.selectFeature.emit()}_feature;_source;routeEvent=new Ke;selectFeature=new Ke;htmlDisplayEvent=new Ke;get title(){return ed(this.feature)}get icon(){return d0(this.feature)||"link"}constructor(e,n,o,s,l,h){this.http=e,this.cdRef=n,this.sanitizer=o,this.networkService=s,this.messageService=l,this.configService=h,this.networkService.currentState().pipe(Vo(this.unsubscribe$)).subscribe(p=>{this.state=p})}ngOnInit(){this.ready=!0}ngOnDestroy(){this.unsubscribe$.next(),this.unsubscribe$.complete()}urlSanitizer(e){return this.sanitizer.bypassSecurityTrustResourceUrl(e)}isHtmlDisplay(){return this.feature&&this.isObject(this.feature.properties)&&this.feature.properties.target==="iframe"?(this.htmlDisplayEvent.emit(!0),!0):(this.htmlDisplayEvent.emit(!1),!1)}htmlSanitizer(e){if(!e.body)return;if(!/<base href="[\w:\/\.]+">/.test(e.body)){let o=new URL(e.url,window.location.origin);e.body=e.body.replace("<head>",`<head><base href="${o.origin}">`)}return this.sanitizer.bypassSecurityTrustHtml(e.body)}isObject(e){return typeof e=="object"}openSecureUrl(e){let n,o=new RegExp(this.configService?.getConfig("depot.url")+'.*?(?="|$)');if(o.test(e))n=e.match(o)[0],this.http.get(n,{responseType:"blob"}).subscribe(s=>{let l=URL.createObjectURL(s);window.open(l,"_blank"),this.cdRef.detectChanges()},()=>{this.messageService.error("igo.geo.targetHtmlUrlUnauthorized","igo.geo.targetHtmlUrlUnauthorizedTitle")});else{let s=e;if(this.isEmbeddedLink(e)){let l=document.createElement("div");l.innerHTML=e,s=l.children[0].getAttribute("href")}window.open(s,"_blank")}}isUrl(e){if(typeof e=="string")return/^https?:\/\//.test(e)}isDoc(e){if(typeof e=="string")return this.isUrl(e)?/(pdf|docx?|xlsx?)$/.test(e.toLowerCase()):!1}isImg(e){if(typeof e=="string")return this.isUrl(e)?/(jpe?g|png|gif)$/.test(e.toLowerCase()):!1}isEmbeddedLink(e){if(typeof e=="string"){let n=/<a/g;return(e.match(n)||[]).length===1}return!1}getEmbeddedLinkText(e){let n=/(?:>).*?(?=<|$)/,o=e.match(n)[0];return o=o.replace(/>/g,""),o}filterFeatureProperties(e){let n=e.meta?e.meta.alias:void 0,o={},s;return this.map&&this.map.forcedOffline$.pipe(Vo(this.unsubscribe$)).subscribe(l=>{s=l}),e.properties&&e.properties.Route&&this.toolbox&&!this.toolbox.getTool("directions")&&delete e.properties.Route,n?(Object.keys(n).forEach(l=>{o[n[l]]=e.properties[l]}),o):(s!==void 0?s?e.meta&&e.meta.excludeAttributeOffline&&e.meta.excludeAttributeOffline.forEach(h=>{delete e.properties[h]}):this.state.connection&&e.meta&&e.meta.excludeAttribute?e.meta.excludeAttribute.forEach(h=>{delete e.properties[h]}):!this.state.connection&&e.meta&&e.meta.excludeAttributeOffline&&e.meta.excludeAttributeOffline.forEach(h=>{delete e.properties[h]}):this.state.connection&&e.meta&&e.meta.excludeAttribute?e.meta.excludeAttribute.forEach(h=>{delete e.properties[h]}):!this.state.connection&&e.meta&&e.meta.excludeAttributeOffline&&e.meta.excludeAttributeOffline.forEach(h=>{delete e.properties[h]}),e.properties)}copyTextToClipboard(e){Cx.copy(e)&&this.messageService.success("igo.geo.query.link.message")}static \u0275fac=function(n){return new(n||r)(Ie(Er),Ie(lr),Ie(J7),Ie(jf),Ie(Gn),Ie(Oi))};static \u0275cmp=nt({type:r,selectors:[["igo-feature-details"]],inputs:{source:"source",map:"map",toolbox:"toolbox",feature:"feature"},outputs:{routeEvent:"routeEvent",selectFeature:"selectFeature",htmlDisplayEvent:"htmlDisplayEvent"},standalone:!0,features:[lt],decls:2,vars:2,consts:[["class","igo-striped mat-typography",4,"ngIf"],[3,"srcdoc","src",4,"ngIf"],[1,"igo-striped","mat-typography"],[4,"ngFor","ngForOf"],[4,"ngIf"],["id","keyValue",4,"ngIf"],[3,"innerHTML",4,"ngIf"],["matListItemIcon",""],["target","_blank","rel","noopener noreferrer",3,"href"],["mat-icon-button","",1,"copyClipboard",3,"click"],["id","keyValue"],[3,"innerHTML"],[3,"click","ngStyle"],["target","_blank","rel","noopener noreferrer",3,"click","href"],["igoImageError","","width","225","height","auto",3,"src"],[3,"srcdoc","src"]],template:function(n,o){n&1&&Pe(0,gAe,4,3,"table",0)(1,_Ae,1,2,"iframe",1),n&2&&(z("ngIf",o.ready&&o.feature&&o.isObject(o.feature.properties)&&o.feature.properties.target!=="iframe"),j(),z("ngIf",o.isHtmlDisplay()))},dependencies:[Gt,Li,jt,$t,cl,GA,Ei,P7,E1,Et,Tt,R1],styles:[`table[_ngcontent-%COMP%]{width:100%}table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:5px}#keyValue[_ngcontent-%COMP%]{width:30%}table[_ngcontent-%COMP%]     .routing{cursor:pointer}iframe[_ngcontent-%COMP%]{height:calc(100% - 4px);width:100%;border:0}.copyClipboard[_ngcontent-%COMP%]{border:none;background:transparent;cursor:pointer}
/*# sourceMappingURL=feature-details.component-TNUA653B.css.map */`],changeDetection:0})}return r})();var tee=(()=>{class r{el;component;get feature(){return this.component.feature}feature$=new ut(void 0);routingEvent=new Ke;setFeature(){this.feature$.next(this.feature)}constructor(e,n){this.el=n,this.component=e}ngOnInit(){this.feature$.subscribe(()=>{this.feature.geometry&&this.bindClicking()})}bindClicking(){setTimeout(()=>{let e=this.el.nativeElement.querySelector("span.routing");e&&e.addEventListener("click",()=>{this.routingEvent.emit()})},1)}static \u0275fac=function(n){return new(n||r)(Ie(vw,2),Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","igoFeatureDetailsDirective",""]],hostBindings:function(n,o){n&1&&ve("selectFeature",function(){return o.setFeature()})},outputs:{routingEvent:"routingEvent"},standalone:!0})}return r})();var iee=[vw,tee];var yAe=["igoForm"],vAe=["*",[["","formButtons",""]]],bAe=["*","[formButtons]"],g8=(()=>{class r{form;set feature(e){this.feature$.next(e)}get feature(){return this.feature$.value}feature$=new ut(void 0);submitForm=new Ke;igoForm;onSubmit(e){let n=this.formDataToFeature(e);this.submitForm.emit(n)}getData(){return this.formDataToFeature(this.igoForm.getData())}formDataToFeature(e){let n={},o={};this.feature===void 0?o.id=rn():(Object.assign(n,this.feature.properties),Object.assign(o,this.feature.meta,{revision:VA(this.feature)+1}));let s="properties.";Object.entries(e).forEach(h=>{let[p,m]=h;if(p.startsWith(s)){let f=p.substr(s.length);n[f]=m}});let l=e.geometry;return l===void 0&&this.feature!==void 0&&(l=this.feature.geometry),{meta:o,type:vr,geometry:l,projection:"EPSG:4326",properties:n}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-feature-form"]],viewQuery:function(n,o){if(n&1&&Ir(yAe,7),n&2){let s;bi(s=wi())&&(o.igoForm=s.first)}},inputs:{form:"form",feature:"feature"},outputs:{submitForm:"submitForm"},standalone:!0,features:[lt],ngContentSelectors:bAe,decls:5,vars:4,consts:[["igoForm",""],[3,"submitForm","form","formData"]],template:function(n,o){if(n&1){let s=We();Kn(vAe),$(0,"igo-form",1,0),le(2,"async"),ve("submitForm",function(h){return we(s),xe(o.onSubmit(h))}),Tn(3),Tn(4,1,["formButtons",""]),ee()}n&2&&z("form",o.form)("formData",ce(2,2,o.feature$))},dependencies:[i9,Ei],styles:[`[_nghost-%COMP%]{display:block}igo-form[_ngcontent-%COMP%]{height:100%}
/*# sourceMappingURL=feature-form.component-ZVPWPMQZ.css.map */`],changeDetection:0})}return r})();var FOt=[...iee,g8];var YAe=Jl(_ee(),1);function I8(r){return r=r||[0,153,255],new an({stroke:new ui({color:r.concat([1]),width:2}),fill:new hi({color:r.concat([.2])}),radius:8})}function E8(){return new oi({stroke:new ui({color:[0,153,255,1],width:2})})}function yee(r,i){r.appendLinearRing(i)}function xC(r){let i=r.target;return i instanceof on?i.getFlatCoordinates().slice(-4,-2):i.getFlatCoordinates().slice(-2)}var op=class{options;start$=new Si;end$=new Si;changes$=new Si;modify$=new Si;select$=new Si;abort$=new Si;freehand$=new ut(!1);ispredefinedRadius$=new ut(!1);predefinedRadius$=new ut(void 0);radiusDrawEnd$=new ut(void 0);keyDown$$;olGeometryType;olInteractionStyle;olMap;olDrawingLayer;olDrawInteraction;olSelectInteraction;olModifyInteraction;onDrawStartKey;onDrawEndKey;onDrawAbortKey;onDrawKey;radius;mousePosition;get radiusVal(){return this.predefinedRadius$.getValue()}set radiusValData(i){this.predefinedRadius$.next(i)}get active(){return this.olMap!==void 0}get olDrawingLayerSource(){return this.olDrawingLayer.getSource()}constructor(i){this.options=i,this.olDrawingLayer=i.drawingLayer?i.drawingLayer:this.createOlInnerOverlayLayer(),this.olGeometryType=this.options.geometryType,this.olInteractionStyle=this.options.interactionStyle}setOlMap(i,e){if(!i){this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlInteractions(),this.olMap=i;return}this.olMap=i,this.addOlInnerOverlayLayer(),this.addOlInteractions(e)}getSource(){return this.olDrawingLayerSource}setOlInteractionStyle(i){this.olInteractionStyle=i}setGeometryType(i){this.olGeometryType=i}getGeometryType(){return this.olGeometryType}createOlInnerOverlayLayer(){return new fc({source:this.options.drawingLayerSource?this.options.drawingLayerSource:new $a,style:this.options.drawingLayerStyle,zIndex:500})}removeOlInnerOverlayLayer(){!this.options.drawingLayer&&this.olMap&&this.olMap.removeLayer(this.olDrawingLayer)}addOlInnerOverlayLayer(){this.options.drawingLayer||this.olMap.addLayer(this.olDrawingLayer)}clearOlInnerOverlaySource(){!this.options.drawingLayer&&!this.options.drawingLayerSource&&this.olDrawingLayerSource.clear(!0)}addOlInteractions(i){let e;if(this.freehand$.getValue()?this.olGeometryType==="Point"?e=new Vy({type:"Circle",source:this.getSource(),style:typeof this.olInteractionStyle=="function"?void 0:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):e=new Vy({type:this.olGeometryType,source:this.getSource(),style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!0}):this.ispredefinedRadius$.getValue()?e=new Vy({type:"Point",source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}):e=new Vy({type:this.olGeometryType,source:this.getSource(),stopClick:!0,style:this.olInteractionStyle,maxPoints:this.options.maxPoints,freehand:!1,freehandCondition:()=>!1}),this.olMap.addInteraction(e),this.olDrawInteraction=e,this.onDrawStartKey=e.on("drawstart",n=>this.onDrawStart(n)),this.onDrawEndKey=e.on("drawend",n=>this.onDrawEnd(n)),this.onDrawAbortKey=e.on("drawabort",n=>this.abort$.next(n.feature.getGeometry())),i){let n=new Db({source:this.getSource()});if(this.olMap.addInteraction(n),this.olModifyInteraction=n,!this.olSelectInteraction){let o=new Rb({condition:jq,style:void 0});this.olMap.addInteraction(o),this.olSelectInteraction=o,this.olSelectInteraction.on("select",s=>this.onSelect(s))}}}removeOlInteractions(){this.unsubscribeKeyDown(),io([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey,this.onDrawAbortKey]),this.olMap&&(this.olMap.removeInteraction(this.olDrawInteraction),this.olMap.removeInteraction(this.olModifyInteraction)),this.olDrawInteraction=void 0,this.olModifyInteraction=void 0}onDrawStart(i){let e=i.feature.getGeometry();this.start$.next(e),this.clearOlInnerOverlaySource(),this.onDrawKey=e.on("change",n=>{this.mousePosition=xC(n),this.changes$.next(n.target)}),this.subscribeKeyDown()}onDrawEnd(i){i.feature.getGeometry().getType()==="Point"&&this.radiusDrawEnd$.next(this.predefinedRadius$.getValue()),this.unsubscribeKeyDown(),io(this.onDrawKey);let e=i.feature.getGeometry();e.on("change",()=>{this.modify$.next(e)}),this.end$.next(e)}onSelect(i){i.selected.length===1&&this.select$.next(i.selected[0])}subscribeKeyDown(){this.unsubscribeKeyDown(),this.keyDown$$=jo(document,"keydown").subscribe(i=>{if(i.key==="Escape"){this.olDrawInteraction.abortDrawing();return}if(i.key==="Backspace"&&this.olDrawInteraction.removeLastPoint(),i.key==="Enter"&&this.olDrawInteraction.finishDrawing(),i.key===" "){this.olMap.getView().animate({center:this.mousePosition,duration:100});return}})}unsubscribeKeyDown(){this.keyDown$$&&(this.keyDown$$.unsubscribe(),this.keyDown$$=void 0)}};var Kp=function(r){return r.Arial="Arial",r.ArialBlack="Arial Black",r.Verdana="Verdana",r.Tahoma="Tahoma",r.TrebuchetMS="Trebuchet MS",r.Impact="Impact",r.TimesNewRoman="Times New Roman",r.Georgia="Georgia",r.AmericanTypewriter="American Typewriter",r.Courier="Courier",r.LucidaConsole="Lucida Console",r.BrushScriptMT="Brush Script MT",r.ComicSansMS="Comic Sans MS",r}(Kp||{});function Ql(r,i){ZAe(r)&&(r="100%");var e=XAe(r);return r=i===360?r:Math.min(i,Math.max(0,parseFloat(r))),e&&(r=parseInt(String(r*i),10)/100),Math.abs(r-i)<1e-6?1:(i===360?r=(r<0?r%i+i:r%i)/parseFloat(String(i)):r=r%i/parseFloat(String(i)),r)}function SC(r){return Math.min(1,Math.max(0,r))}function ZAe(r){return typeof r=="string"&&r.indexOf(".")!==-1&&parseFloat(r)===1}function XAe(r){return typeof r=="string"&&r.indexOf("%")!==-1}function d3(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function CC(r){return r<=1?"".concat(Number(r)*100,"%"):r}function M_(r){return r.length===1?"0"+r:String(r)}function vee(r,i,e){return{r:Ql(r,255)*255,g:Ql(i,255)*255,b:Ql(e,255)*255}}function F8(r,i,e){r=Ql(r,255),i=Ql(i,255),e=Ql(e,255);var n=Math.max(r,i,e),o=Math.min(r,i,e),s=0,l=0,h=(n+o)/2;if(n===o)l=0,s=0;else{var p=n-o;switch(l=h>.5?p/(2-n-o):p/(n+o),n){case r:s=(i-e)/p+(i<e?6:0);break;case i:s=(e-r)/p+2;break;case e:s=(r-i)/p+4;break;default:break}s/=6}return{h:s,s:l,l:h}}function T8(r,i,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(i-r)*(6*e):e<1/2?i:e<2/3?r+(i-r)*(2/3-e)*6:r}function bee(r,i,e){var n,o,s;if(r=Ql(r,360),i=Ql(i,100),e=Ql(e,100),i===0)o=e,s=e,n=e;else{var l=e<.5?e*(1+i):e+i-e*i,h=2*e-l;n=T8(h,l,r+1/3),o=T8(h,l,r),s=T8(h,l,r-1/3)}return{r:n*255,g:o*255,b:s*255}}function P8(r,i,e){r=Ql(r,255),i=Ql(i,255),e=Ql(e,255);var n=Math.max(r,i,e),o=Math.min(r,i,e),s=0,l=n,h=n-o,p=n===0?0:h/n;if(n===o)s=0;else{switch(n){case r:s=(i-e)/h+(i<e?6:0);break;case i:s=(e-r)/h+2;break;case e:s=(r-i)/h+4;break;default:break}s/=6}return{h:s,s:p,v:l}}function wee(r,i,e){r=Ql(r,360)*6,i=Ql(i,100),e=Ql(e,100);var n=Math.floor(r),o=r-n,s=e*(1-i),l=e*(1-o*i),h=e*(1-(1-o)*i),p=n%6,m=[e,l,s,s,h,e][p],f=[h,e,e,l,s,s][p],g=[s,s,h,e,e,l][p];return{r:m*255,g:f*255,b:g*255}}function L8(r,i,e,n){var o=[M_(Math.round(r).toString(16)),M_(Math.round(i).toString(16)),M_(Math.round(e).toString(16))];return n&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function xee(r,i,e,n,o){var s=[M_(Math.round(r).toString(16)),M_(Math.round(i).toString(16)),M_(Math.round(e).toString(16)),M_(KAe(n))];return o&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))&&s[3].startsWith(s[3].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function KAe(r){return Math.round(parseFloat(r)*255).toString(16)}function k8(r){return Td(r)/255}function Td(r){return parseInt(r,16)}function See(r){return{r:r>>16,g:(r&65280)>>8,b:r&255}}var AC={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Cee(r){var i={r:0,g:0,b:0},e=1,n=null,o=null,s=null,l=!1,h=!1;return typeof r=="string"&&(r=eMe(r)),typeof r=="object"&&(Gg(r.r)&&Gg(r.g)&&Gg(r.b)?(i=vee(r.r,r.g,r.b),l=!0,h=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Gg(r.h)&&Gg(r.s)&&Gg(r.v)?(n=CC(r.s),o=CC(r.v),i=wee(r.h,n,o),l=!0,h="hsv"):Gg(r.h)&&Gg(r.s)&&Gg(r.l)&&(n=CC(r.s),s=CC(r.l),i=bee(r.h,n,s),l=!0,h="hsl"),Object.prototype.hasOwnProperty.call(r,"a")&&(e=r.a)),e=d3(e),{ok:l,format:r.format||h,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:e}}var QAe="[-\\+]?\\d+%?",JAe="[-\\+]?\\d*\\.\\d+%?",I_="(?:".concat(JAe,")|(?:").concat(QAe,")"),O8="[\\s|\\(]+(".concat(I_,")[,|\\s]+(").concat(I_,")[,|\\s]+(").concat(I_,")\\s*\\)?"),D8="[\\s|\\(]+(".concat(I_,")[,|\\s]+(").concat(I_,")[,|\\s]+(").concat(I_,")[,|\\s]+(").concat(I_,")\\s*\\)?"),Qp={CSS_UNIT:new RegExp(I_),rgb:new RegExp("rgb"+O8),rgba:new RegExp("rgba"+D8),hsl:new RegExp("hsl"+O8),hsla:new RegExp("hsla"+D8),hsv:new RegExp("hsv"+O8),hsva:new RegExp("hsva"+D8),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function eMe(r){if(r=r.trim().toLowerCase(),r.length===0)return!1;var i=!1;if(AC[r])r=AC[r],i=!0;else if(r==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e=Qp.rgb.exec(r);return e?{r:e[1],g:e[2],b:e[3]}:(e=Qp.rgba.exec(r),e?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=Qp.hsl.exec(r),e?{h:e[1],s:e[2],l:e[3]}:(e=Qp.hsla.exec(r),e?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=Qp.hsv.exec(r),e?{h:e[1],s:e[2],v:e[3]}:(e=Qp.hsva.exec(r),e?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=Qp.hex8.exec(r),e?{r:Td(e[1]),g:Td(e[2]),b:Td(e[3]),a:k8(e[4]),format:i?"name":"hex8"}:(e=Qp.hex6.exec(r),e?{r:Td(e[1]),g:Td(e[2]),b:Td(e[3]),format:i?"name":"hex"}:(e=Qp.hex4.exec(r),e?{r:Td(e[1]+e[1]),g:Td(e[2]+e[2]),b:Td(e[3]+e[3]),a:k8(e[4]+e[4]),format:i?"name":"hex8"}:(e=Qp.hex3.exec(r),e?{r:Td(e[1]+e[1]),g:Td(e[2]+e[2]),b:Td(e[3]+e[3]),format:i?"name":"hex"}:!1)))))))))}function Gg(r){return!!Qp.CSS_UNIT.exec(String(r))}var ww=function(){function r(i,e){i===void 0&&(i=""),e===void 0&&(e={});var n;if(i instanceof r)return i;typeof i=="number"&&(i=See(i)),this.originalInput=i;var o=Cee(i);this.originalInput=i,this.r=o.r,this.g=o.g,this.b=o.b,this.a=o.a,this.roundA=Math.round(100*this.a)/100,this.format=(n=e.format)!==null&&n!==void 0?n:o.format,this.gradientType=e.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=o.ok}return r.prototype.isDark=function(){return this.getBrightness()<128},r.prototype.isLight=function(){return!this.isDark()},r.prototype.getBrightness=function(){var i=this.toRgb();return(i.r*299+i.g*587+i.b*114)/1e3},r.prototype.getLuminance=function(){var i=this.toRgb(),e,n,o,s=i.r/255,l=i.g/255,h=i.b/255;return s<=.03928?e=s/12.92:e=Math.pow((s+.055)/1.055,2.4),l<=.03928?n=l/12.92:n=Math.pow((l+.055)/1.055,2.4),h<=.03928?o=h/12.92:o=Math.pow((h+.055)/1.055,2.4),.2126*e+.7152*n+.0722*o},r.prototype.getAlpha=function(){return this.a},r.prototype.setAlpha=function(i){return this.a=d3(i),this.roundA=Math.round(100*this.a)/100,this},r.prototype.isMonochrome=function(){var i=this.toHsl().s;return i===0},r.prototype.toHsv=function(){var i=P8(this.r,this.g,this.b);return{h:i.h*360,s:i.s,v:i.v,a:this.a}},r.prototype.toHsvString=function(){var i=P8(this.r,this.g,this.b),e=Math.round(i.h*360),n=Math.round(i.s*100),o=Math.round(i.v*100);return this.a===1?"hsv(".concat(e,", ").concat(n,"%, ").concat(o,"%)"):"hsva(".concat(e,", ").concat(n,"%, ").concat(o,"%, ").concat(this.roundA,")")},r.prototype.toHsl=function(){var i=F8(this.r,this.g,this.b);return{h:i.h*360,s:i.s,l:i.l,a:this.a}},r.prototype.toHslString=function(){var i=F8(this.r,this.g,this.b),e=Math.round(i.h*360),n=Math.round(i.s*100),o=Math.round(i.l*100);return this.a===1?"hsl(".concat(e,", ").concat(n,"%, ").concat(o,"%)"):"hsla(".concat(e,", ").concat(n,"%, ").concat(o,"%, ").concat(this.roundA,")")},r.prototype.toHex=function(i){return i===void 0&&(i=!1),L8(this.r,this.g,this.b,i)},r.prototype.toHexString=function(i){return i===void 0&&(i=!1),"#"+this.toHex(i)},r.prototype.toHex8=function(i){return i===void 0&&(i=!1),xee(this.r,this.g,this.b,this.a,i)},r.prototype.toHex8String=function(i){return i===void 0&&(i=!1),"#"+this.toHex8(i)},r.prototype.toHexShortString=function(i){return i===void 0&&(i=!1),this.a===1?this.toHexString(i):this.toHex8String(i)},r.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},r.prototype.toRgbString=function(){var i=Math.round(this.r),e=Math.round(this.g),n=Math.round(this.b);return this.a===1?"rgb(".concat(i,", ").concat(e,", ").concat(n,")"):"rgba(".concat(i,", ").concat(e,", ").concat(n,", ").concat(this.roundA,")")},r.prototype.toPercentageRgb=function(){var i=function(e){return"".concat(Math.round(Ql(e,255)*100),"%")};return{r:i(this.r),g:i(this.g),b:i(this.b),a:this.a}},r.prototype.toPercentageRgbString=function(){var i=function(e){return Math.round(Ql(e,255)*100)};return this.a===1?"rgb(".concat(i(this.r),"%, ").concat(i(this.g),"%, ").concat(i(this.b),"%)"):"rgba(".concat(i(this.r),"%, ").concat(i(this.g),"%, ").concat(i(this.b),"%, ").concat(this.roundA,")")},r.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var i="#"+L8(this.r,this.g,this.b,!1),e=0,n=Object.entries(AC);e<n.length;e++){var o=n[e],s=o[0],l=o[1];if(i===l)return s}return!1},r.prototype.toString=function(i){var e=!!i;i=i??this.format;var n=!1,o=this.a<1&&this.a>=0,s=!e&&o&&(i.startsWith("hex")||i==="name");return s?i==="name"&&this.a===0?this.toName():this.toRgbString():(i==="rgb"&&(n=this.toRgbString()),i==="prgb"&&(n=this.toPercentageRgbString()),(i==="hex"||i==="hex6")&&(n=this.toHexString()),i==="hex3"&&(n=this.toHexString(!0)),i==="hex4"&&(n=this.toHex8String(!0)),i==="hex8"&&(n=this.toHex8String()),i==="name"&&(n=this.toName()),i==="hsl"&&(n=this.toHslString()),i==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},r.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},r.prototype.clone=function(){return new r(this.toString())},r.prototype.lighten=function(i){i===void 0&&(i=10);var e=this.toHsl();return e.l+=i/100,e.l=SC(e.l),new r(e)},r.prototype.brighten=function(i){i===void 0&&(i=10);var e=this.toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(i/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(i/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(i/100)))),new r(e)},r.prototype.darken=function(i){i===void 0&&(i=10);var e=this.toHsl();return e.l-=i/100,e.l=SC(e.l),new r(e)},r.prototype.tint=function(i){return i===void 0&&(i=10),this.mix("white",i)},r.prototype.shade=function(i){return i===void 0&&(i=10),this.mix("black",i)},r.prototype.desaturate=function(i){i===void 0&&(i=10);var e=this.toHsl();return e.s-=i/100,e.s=SC(e.s),new r(e)},r.prototype.saturate=function(i){i===void 0&&(i=10);var e=this.toHsl();return e.s+=i/100,e.s=SC(e.s),new r(e)},r.prototype.greyscale=function(){return this.desaturate(100)},r.prototype.spin=function(i){var e=this.toHsl(),n=(e.h+i)%360;return e.h=n<0?360+n:n,new r(e)},r.prototype.mix=function(i,e){e===void 0&&(e=50);var n=this.toRgb(),o=new r(i).toRgb(),s=e/100,l={r:(o.r-n.r)*s+n.r,g:(o.g-n.g)*s+n.g,b:(o.b-n.b)*s+n.b,a:(o.a-n.a)*s+n.a};return new r(l)},r.prototype.analogous=function(i,e){i===void 0&&(i=6),e===void 0&&(e=30);var n=this.toHsl(),o=360/e,s=[this];for(n.h=(n.h-(o*i>>1)+720)%360;--i;)n.h=(n.h+o)%360,s.push(new r(n));return s},r.prototype.complement=function(){var i=this.toHsl();return i.h=(i.h+180)%360,new r(i)},r.prototype.monochromatic=function(i){i===void 0&&(i=6);for(var e=this.toHsv(),n=e.h,o=e.s,s=e.v,l=[],h=1/i;i--;)l.push(new r({h:n,s:o,v:s})),s=(s+h)%1;return l},r.prototype.splitcomplement=function(){var i=this.toHsl(),e=i.h;return[this,new r({h:(e+72)%360,s:i.s,l:i.l}),new r({h:(e+216)%360,s:i.s,l:i.l})]},r.prototype.onBackground=function(i){var e=this.toRgb(),n=new r(i).toRgb(),o=e.a+n.a*(1-e.a);return new r({r:(e.r*e.a+n.r*n.a*(1-e.a))/o,g:(e.g*e.a+n.g*n.a*(1-e.a))/o,b:(e.b*e.a+n.b*n.a*(1-e.a))/o,a:o})},r.prototype.triad=function(){return this.polyad(3)},r.prototype.tetrad=function(){return this.polyad(4)},r.prototype.polyad=function(i){for(var e=this.toHsl(),n=e.h,o=[this],s=360/i,l=1;l<i;l++)o.push(new r({h:(n+l*s)%360,s:e.s,l:e.l}));return o},r.prototype.equals=function(i){return this.toRgbString()===new r(i).toRgbString()},r}();function tMe(r,i){if(r&1){let e=We();$(0,"span",3),ve("mousedown",function(o){we(e);let s=ne();return xe(s.handleMousedown(o))}),_e(1),ee()}if(r&2){let e=ne();z("id",e.uniqueId)("ngStyle",e.labelStyle),j(),Qe(" ",e.label," ")}}function iMe(r,i){if(r&1&&($(0,"div",2),ct(1,"div",3),ee()),r&2){let e=ne();fo("left",e.left)("top",e.top),j(),z("ngStyle",e.pointer)}}var R8={};function rMe(r,i,e){if(typeof document>"u")return null;let n=document.createElement("canvas");n.width=e*2,n.height=e*2;let o=n.getContext("2d");return o?(o.fillStyle=r,o.fillRect(0,0,n.width,n.height),o.fillStyle=i,o.fillRect(0,0,e,e),o.translate(e,e),o.fillRect(0,0,e,e),n.toDataURL()):null}function nMe(r,i,e){let n=`${r}-${i}-${e}`;if(R8[n])return R8[n];let o=rMe(r,i,e);return o?(R8[n]=o,o):null}var N8=(()=>{class r{white="transparent";size=8;grey="rgba(0,0,0,.08)";boxShadow;borderRadius;gridStyles;ngOnInit(){let e=nMe(this.white,this.grey,this.size);this.gridStyles={borderRadius:this.borderRadius,boxShadow:this.boxShadow,background:`url(${e}) center left`}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-checkboard"]],inputs:{white:"white",size:"size",grey:"grey",boxShadow:"boxShadow",borderRadius:"borderRadius"},decls:1,vars:1,consts:[[1,"grid",3,"ngStyle"]],template:function(n,o){n&1&&ct(0,"div",0),n&2&&z("ngStyle",o.gridStyles)},dependencies:[cl],styles:[".grid[_ngcontent-%COMP%]{inset:0;position:absolute}"],changeDetection:0})}return r})(),B8=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu]})}return r})(),G8=(()=>{class r{el;coordinatesChange=new Si;mousechange=new Si;mouseListening=!1;sub;mousemove(e,n,o,s=!1){this.mouseListening&&(e.preventDefault(),this.mousechange.next({$event:e,x:n,y:o,isTouch:s}))}mouseup(){this.mouseListening=!1}mousedown(e,n,o,s=!1){e.preventDefault(),this.mouseListening=!0,this.mousechange.next({$event:e,x:n,y:o,isTouch:s})}constructor(e){this.el=e}ngOnInit(){this.sub=this.mousechange.pipe($u((e,n)=>e.x===n.x&&e.y===n.y)).subscribe(e=>this.handleChange(e.x,e.y,e.$event,e.isTouch))}ngOnDestroy(){this.sub?.unsubscribe()}handleChange(e,n,o,s){let l=this.el.nativeElement.clientWidth,h=this.el.nativeElement.clientHeight,p=e-(this.el.nativeElement.getBoundingClientRect().left+window.pageXOffset),m=n-this.el.nativeElement.getBoundingClientRect().top;s||(m=m-window.pageYOffset),this.coordinatesChange.next({x:e,y:n,top:m,left:p,containerWidth:l,containerHeight:h,$event:o})}static \u0275fac=function(n){return new(n||r)(Ie(ar))};static \u0275dir=Fi({type:r,selectors:[["","ngx-color-coordinates",""]],hostBindings:function(n,o){n&1&&ve("mousemove",function(l){return o.mousemove(l,l.pageX,l.pageY)},!1,hx)("touchmove",function(l){return o.mousemove(l,l.touches[0].clientX,l.touches[0].clientY,!0)},!1,hx)("mouseup",function(){return o.mouseup()},!1,hx)("touchend",function(){return o.mouseup()},!1,hx)("mousedown",function(l){return o.mousedown(l,l.pageX,l.pageY)})("touchstart",function(l){return o.mousedown(l,l.touches[0].clientX,l.touches[0].clientY,!0)})},outputs:{coordinatesChange:"coordinatesChange"}})}return r})(),j8=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({})}return r})(),Mee=(()=>{class r{hsl;rgb;pointer;shadow;radius;direction="horizontal";onChange=new Ke;gradient;pointerLeft;pointerTop;ngOnChanges(){this.direction==="vertical"?(this.pointerLeft=0,this.pointerTop=this.rgb.a*100,this.gradient={background:`linear-gradient(to bottom, rgba(${this.rgb.r},${this.rgb.g},${this.rgb.b}, 0) 0%,
          rgba(${this.rgb.r},${this.rgb.g},${this.rgb.b}, 1) 100%)`}):(this.gradient={background:`linear-gradient(to right, rgba(${this.rgb.r},${this.rgb.g},${this.rgb.b}, 0) 0%,
          rgba(${this.rgb.r},${this.rgb.g},${this.rgb.b}, 1) 100%)`},this.pointerLeft=this.rgb.a*100)}handleChange({top:e,left:n,containerHeight:o,containerWidth:s,$event:l}){let h;if(this.direction==="vertical"){let p;e<0?p=0:e>o?p=1:p=Math.round(e*100/o)/100,this.hsl.a!==p&&(h={h:this.hsl.h,s:this.hsl.s,l:this.hsl.l,a:p,source:"rgb"})}else{let p;n<0?p=0:n>s?p=1:p=Math.round(n*100/s)/100,this.hsl.a!==p&&(h={h:this.hsl.h,s:this.hsl.s,l:this.hsl.l,a:p,source:"rgb"})}h&&this.onChange.emit({data:h,$event:l})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-alpha"]],inputs:{hsl:"hsl",rgb:"rgb",pointer:"pointer",shadow:"shadow",radius:"radius",direction:"direction"},outputs:{onChange:"onChange"},features:[wu],decls:7,vars:15,consts:[[1,"alpha"],[1,"alpha-checkboard"],[1,"alpha-gradient",3,"ngStyle"],["ngx-color-coordinates","",3,"coordinatesChange"],[1,"alpha-pointer"],[1,"alpha-slider",3,"ngStyle"]],template:function(n,o){n&1&&($(0,"div",0)(1,"div",1),ct(2,"color-checkboard"),ee(),ct(3,"div",2),$(4,"div",3),ve("coordinatesChange",function(l){return o.handleChange(l)}),$(5,"div",4),ct(6,"div",5),ee()()()),n&2&&(fo("border-radius",o.radius),j(3),fo("box-shadow",o.shadow)("border-radius",o.radius),z("ngStyle",o.gradient),j(),px("alpha-container color-alpha-",o.direction,""),j(),fo("left",o.pointerLeft,"%")("top",o.pointerTop,"%"),j(),z("ngStyle",o.pointer))},dependencies:[cl,N8,G8],styles:[".alpha[_ngcontent-%COMP%]{position:absolute;inset:0}.alpha-checkboard[_ngcontent-%COMP%]{position:absolute;inset:0;overflow:hidden}.alpha-gradient[_ngcontent-%COMP%]{position:absolute;inset:0}.alpha-container[_ngcontent-%COMP%]{position:relative;height:100%;margin:0 3px}.alpha-pointer[_ngcontent-%COMP%]{position:absolute}.alpha-slider[_ngcontent-%COMP%]{width:4px;border-radius:1px;height:8px;box-shadow:0 0 2px #0009;background:#fff;margin-top:1px;transform:translate(-2px)}"],changeDetection:0})}return r})(),Iee=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu,B8,j8]})}return r})();function Aee(r){let i=["r","g","b","a","h","s","l","v"],e=0,n=0;return i.forEach(o=>{r[o]&&(e+=1,isNaN(r[o])||(n+=1),(o==="s"||o==="l")&&/^\d+%$/.test(r[o])&&(n+=1))}),e===n?r:!1}function h3(r,i,e){let n=r.hex?new ww(r.hex):new ww(r);e&&n.setAlpha(1);let o=n.toHsl(),s=n.toHsv(),l=n.toRgb(),h=n.toHex();o.s===0&&(o.h=i||0,s.h=i||0);let p=h==="000000"&&l.a===0;return{hsl:o,hex:p?"transparent":n.toHexString(),rgb:l,hsv:s,oldHue:r.h||i||o.h,source:r.source}}function Eee(r){return new ww(r).isValid}var xw=function(r){return r.HEX="hex",r.HSL="hsl",r.HSV="hsv",r.RGB="rgb",r}(xw||{}),V8=(()=>{class r{className;mode=xw.HEX;color={h:250,s:.5,l:.2,a:1};colorChange=new Ke;onChange=new Ke;onChangeComplete=new Ke;onSwatchHover=new Ke;oldHue;hsl;hsv;rgb;hex;source;currentColor;changes;disableAlpha;_onChangeCompleteSubscription=new Es;_onSwatchHoverSubscription=new Es;ngOnInit(){this.changes=this.onChange.pipe(Br(100),bu(e=>{switch(this.onChangeComplete.emit(e),this.mode){case xw.HEX:this.colorChange.emit(e.color.hex);break;case xw.HSL:this.colorChange.emit(e.color.hsl);break;case xw.HSV:this.colorChange.emit(e.color.hsv);break;case xw.RGB:this.colorChange.emit(e.color.rgb);break;default:let n=`The mode '${this.mode}' is not supported`;if(T7())throw new Error(n);console.warn(n);break}})).subscribe(),this.setState(h3(this.color,0)),this.currentColor=this.hex}ngOnChanges(){this.setState(h3(this.color,this.oldHue))}ngOnDestroy(){this.changes?.unsubscribe(),this._onChangeCompleteSubscription?.unsubscribe(),this._onSwatchHoverSubscription?.unsubscribe()}setState(e){this.oldHue=e.oldHue,this.hsl=e.hsl,this.hsv=e.hsv,this.rgb=e.rgb,this.hex=e.hex,this.source=e.source,this.afterValidChange()}handleChange(e,n){if(Aee(e)){let s=h3(e,e.h||this.oldHue,this.disableAlpha);this.setState(s),this.onChange.emit({color:s,$event:n}),this.afterValidChange()}}afterValidChange(){}handleSwatchHover(e,n){if(Aee(e)){let s=h3(e,e.h||this.oldHue);this.setState(s),this.onSwatchHover.emit({color:s,$event:n})}}registerOnChange(e){this._onChangeCompleteSubscription.add(this.onChangeComplete.pipe(bu(n=>e(n.color.hex))).subscribe())}registerOnTouched(e){this._onSwatchHoverSubscription.add(this.onSwatchHover.pipe(bu(()=>e())).subscribe())}setDisabledState(e){}writeValue(e){this.color=e}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-wrap"]],inputs:{className:"className",mode:"mode",color:"color"},outputs:{colorChange:"colorChange",onChange:"onChange",onChangeComplete:"onChangeComplete",onSwatchHover:"onSwatchHover"},features:[Xi([{provide:Yu,useExisting:Dl(()=>r),multi:!0}]),wu],decls:0,vars:0,template:function(n,o){},encapsulation:2})}return r})();var oMe=0,Tee=(()=>{class r{style;label;value;arrowOffset;dragLabel;dragMax;placeholder="";onChange=new Ke;currentValue;blurValue;wrapStyle;inputStyle;labelStyle;focus=!1;mousemove;mouseup;uniqueId=`editableInput-${++oMe}`;ngOnInit(){this.wrapStyle=this.style&&this.style.wrap?this.style.wrap:{},this.inputStyle=this.style&&this.style.input?this.style.input:{},this.labelStyle=this.style&&this.style.label?this.style.label:{},this.dragLabel&&(this.labelStyle.cursor="ew-resize")}handleFocus(e){this.focus=!0}handleFocusOut(e){this.focus=!1,this.currentValue=this.blurValue}handleKeydown(e){let n=String(e.target.value),o=n.indexOf("%")>-1,s=Number(n.replace(/%/g,""));if(isNaN(s))return;let l=this.arrowOffset||1;e.keyCode===38&&(this.label?this.onChange.emit({data:{[this.label]:s+l},$event:e}):this.onChange.emit({data:s+l,$event:e}),o?this.currentValue=`${s+l}%`:this.currentValue=s+l),e.keyCode===40&&(this.label?this.onChange.emit({data:{[this.label]:s-l},$event:e}):this.onChange.emit({data:s-l,$event:e}),o?this.currentValue=`${s-l}%`:this.currentValue=s-l)}handleKeyup(e){e.keyCode===40||e.keyCode===38||`${this.currentValue}`!==e.target.value&&(this.label?this.onChange.emit({data:{[this.label]:e.target.value},$event:e}):this.onChange.emit({data:e.target.value,$event:e}))}ngOnChanges(){this.focus?this.blurValue=String(this.value).toUpperCase():(this.currentValue=String(this.value).toUpperCase(),this.blurValue=String(this.value).toUpperCase())}ngOnDestroy(){this.unsubscribe()}subscribe(){this.mousemove=jo(document,"mousemove").subscribe(e=>this.handleDrag(e)),this.mouseup=jo(document,"mouseup").subscribe(()=>this.unsubscribe())}unsubscribe(){this.mousemove?.unsubscribe(),this.mouseup?.unsubscribe()}handleMousedown(e){this.dragLabel&&(e.preventDefault(),this.handleDrag(e),this.subscribe())}handleDrag(e){if(this.dragLabel){let n=Math.round(this.value+e.movementX);n>=0&&n<=this.dragMax&&this.onChange.emit({data:{[this.label]:n},$event:e})}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-editable-input"]],inputs:{style:"style",label:"label",value:"value",arrowOffset:"arrowOffset",dragLabel:"dragLabel",dragMax:"dragMax",placeholder:"placeholder"},outputs:{onChange:"onChange"},features:[wu],decls:3,vars:6,consts:[[1,"wrap",3,"ngStyle"],["spellCheck","false",3,"keydown","keyup","focus","focusout","ngStyle","value","placeholder"],[3,"id","ngStyle","mousedown",4,"ngIf"],[3,"mousedown","id","ngStyle"]],template:function(n,o){n&1&&($(0,"div",0)(1,"input",1),ve("keydown",function(l){return o.handleKeydown(l)})("keyup",function(l){return o.handleKeyup(l)})("focus",function(l){return o.handleFocus(l)})("focusout",function(l){return o.handleFocusOut(l)}),ee(),Pe(2,tMe,2,3,"span",2),ee()),n&2&&(z("ngStyle",o.wrapStyle),j(),z("ngStyle",o.inputStyle)("value",o.currentValue)("placeholder",o.placeholder),Or("aria-labelledby",o.uniqueId),j(),z("ngIf",o.label))},dependencies:[Gt,cl],styles:["[_nghost-%COMP%]{display:flex}.wrap[_ngcontent-%COMP%]{position:relative}"],changeDetection:0})}return r})(),Fee=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu]})}return r})(),Pee=(()=>{class r{hsl;pointer;radius;shadow;hidePointer=!1;direction="horizontal";onChange=new Ke;left="0px";top="";ngOnChanges(){this.direction==="horizontal"?this.left=`${this.hsl.h*100/360}%`:this.top=`${-(this.hsl.h*100/360)+100}%`}handleChange({top:e,left:n,containerHeight:o,containerWidth:s,$event:l}){let h;if(this.direction==="vertical"){let p;e<0?p=359:e>o?p=0:p=360*(-(e*100/o)+100)/100,this.hsl.h!==p&&(h={h:p,s:this.hsl.s,l:this.hsl.l,a:this.hsl.a,source:"rgb"})}else{let p;n<0?p=0:n>s?p=359:p=360*(n*100/s)/100,this.hsl.h!==p&&(h={h:p,s:this.hsl.s,l:this.hsl.l,a:this.hsl.a,source:"rgb"})}h&&this.onChange.emit({data:h,$event:l})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-hue"]],inputs:{hsl:"hsl",pointer:"pointer",radius:"radius",shadow:"shadow",hidePointer:"hidePointer",direction:"direction"},outputs:{onChange:"onChange"},features:[wu],decls:3,vars:8,consts:[["ngx-color-coordinates","",1,"color-hue-container",3,"coordinatesChange"],["class","color-hue-pointer",3,"left","top",4,"ngIf"],[1,"color-hue-pointer"],[1,"color-hue-slider",3,"ngStyle"]],template:function(n,o){n&1&&($(0,"div")(1,"div",0),ve("coordinatesChange",function(l){return o.handleChange(l)}),Pe(2,iMe,2,5,"div",1),ee()()),n&2&&(px("color-hue color-hue-",o.direction,""),fo("border-radius",o.radius,"px")("box-shadow",o.shadow),j(2),z("ngIf",!o.hidePointer))},dependencies:[Gt,cl,G8],styles:[".color-hue[_ngcontent-%COMP%]{position:absolute;inset:0}.color-hue-container[_ngcontent-%COMP%]{margin:0 2px;position:relative;height:100%}.color-hue-pointer[_ngcontent-%COMP%]{position:absolute}.color-hue-slider[_ngcontent-%COMP%]{margin-top:1px;width:4px;border-radius:1px;height:8px;box-shadow:0 0 2px #0009;background:#fff;transform:translate(-2px)}.color-hue-horizontal[_ngcontent-%COMP%]{background:linear-gradient(to right,#f00 0%,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,#f00 100%)}.color-hue-vertical[_ngcontent-%COMP%]{background:linear-gradient(to top,#f00 0%,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,#f00 100%)}"],changeDetection:0})}return r})(),Lee=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu,j8]})}return r})();var kee=(()=>{class r{hsl;hsv;radius;pointer;circle;onChange=new Ke;background;pointerTop;pointerLeft;ngOnChanges(){this.background=`hsl(${this.hsl.h}, 100%, 50%)`,this.pointerTop=-(this.hsv.v*100)+1+100+"%",this.pointerLeft=this.hsv.s*100+"%"}handleChange({top:e,left:n,containerHeight:o,containerWidth:s,$event:l}){n<0?n=0:n>s?n=s:e<0?e=0:e>o&&(e=o);let h=n/s,p=-(e/o)+1;p=p>0?p:0,p=p>1?1:p;let m={h:this.hsl.h,s:h,v:p,a:this.hsl.a,source:"hsva"};this.onChange.emit({data:m,$event:l})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-saturation"]],inputs:{hsl:"hsl",hsv:"hsv",radius:"radius",pointer:"pointer",circle:"circle"},outputs:{onChange:"onChange"},features:[wu],decls:5,vars:8,consts:[["ngx-color-coordinates","",1,"color-saturation",3,"coordinatesChange"],[1,"saturation-white"],[1,"saturation-black"],[1,"saturation-pointer",3,"ngStyle"],[1,"saturation-circle",3,"ngStyle"]],template:function(n,o){n&1&&($(0,"div",0),ve("coordinatesChange",function(l){return o.handleChange(l)}),$(1,"div",1),ct(2,"div",2),$(3,"div",3),ct(4,"div",4),ee()()()),n&2&&(fo("background",o.background),j(3),fo("top",o.pointerTop)("left",o.pointerLeft),z("ngStyle",o.pointer),j(),z("ngStyle",o.circle))},dependencies:[cl,G8],styles:[".saturation-white[_ngcontent-%COMP%]{background:linear-gradient(to right,#fff,rgba(255,255,255,0));position:absolute;inset:0}.saturation-black[_ngcontent-%COMP%]{background:linear-gradient(to top,#000,rgba(0,0,0,0));position:absolute;inset:0}.color-saturation[_ngcontent-%COMP%]{position:absolute;inset:0}.saturation-pointer[_ngcontent-%COMP%]{position:absolute;cursor:default}.saturation-circle[_ngcontent-%COMP%]{width:4px;height:4px;box-shadow:0 0 0 1.5px #fff,inset 0 0 1px 1px #0000004d,0 0 1px 2px #0006;border-radius:50%;cursor:hand;transform:translate(-2px,-4px)}"],changeDetection:0})}return r})(),Oee=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu,j8]})}return r})();var jg=(r,i)=>({input:r,label:i});function sMe(r,i){if(r&1){let e=We();$(0,"div",11)(1,"color-editable-input",12),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()()}if(r&2){let e=ne();j(),pm(Ys(3,jg,e.input,e.label)),z("value",e.hex)}}function lMe(r,i){if(r&1){let e=We();$(0,"color-editable-input",17),ve("onChange",function(o){we(e);let s=ne(2);return xe(s.handleChange(o))}),ee()}if(r&2){let e=ne(2);pm(Ys(4,jg,e.input,e.label)),z("value",e.rgb.a)("arrowOffset",.01)}}function cMe(r,i){if(r&1){let e=We();$(0,"div",11)(1,"color-editable-input",13),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(2,"div",11)(3,"color-editable-input",14),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(4,"div",11)(5,"color-editable-input",15),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(6,"div",11),Pe(7,lMe,1,7,"color-editable-input",16),ee()}if(r&2){let e=ne();j(),pm(Ys(10,jg,e.input,e.label)),z("value",e.rgb.r),j(2),pm(Ys(13,jg,e.input,e.label)),z("value",e.rgb.g),j(2),pm(Ys(16,jg,e.input,e.label)),z("value",e.rgb.b),j(2),z("ngIf",!e.disableAlpha)}}function uMe(r,i){if(r&1){let e=We();$(0,"color-editable-input",17),ve("onChange",function(o){we(e);let s=ne(2);return xe(s.handleChange(o))}),ee()}if(r&2){let e=ne(2);pm(Ys(4,jg,e.input,e.label)),z("value",e.hsl.a)("arrowOffset",.01)}}function dMe(r,i){if(r&1){let e=We();$(0,"div",11)(1,"color-editable-input",18),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(2,"div",11)(3,"color-editable-input",19),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(4,"div",11)(5,"color-editable-input",20),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee()(),$(6,"div",11),Pe(7,uMe,1,7,"color-editable-input",16),ee()}if(r&2){let e=ne();j(),pm(Ys(10,jg,e.input,e.label)),z("value",e.round(e.hsl.h)),j(2),pm(Ys(13,jg,e.input,e.label)),z("value",e.round(e.hsl.s*100)+"%"),j(2),pm(Ys(16,jg,e.input,e.label)),z("value",e.round(e.hsl.l*100)+"%"),j(2),z("ngIf",!e.disableAlpha)}}function hMe(r,i){if(r&1){let e=We();$(0,"div",12)(1,"color-alpha",13),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleValueChange(o))}),ee()()}if(r&2){let e=ne();j(),z("radius",2)("rgb",e.rgb)("hsl",e.hsl)("pointer",e.pointer)}}var pMe=(()=>{class r{disableAlpha;hsl;rgb;hex;onChange=new Ke;view="";input={fontSize:"11px",color:"#333",width:"100%",borderRadius:"2px",border:"none",boxShadow:"inset 0 0 0 1px #dadada",height:"21px","text-align":"center"};label={"text-transform":"uppercase",fontSize:"11px","line-height":"11px",color:"#969696","text-align":"center",display:"block",marginTop:"12px"};ngOnInit(){this.hsl.a===1&&this.view!=="hex"?this.view="hex":this.view!=="rgb"&&this.view!=="hsl"&&(this.view="rgb")}toggleViews(){this.view==="hex"?this.view="rgb":this.view==="rgb"?this.view="hsl":this.view==="hsl"&&(this.hsl.a===1?this.view="hex":this.view="rgb")}round(e){return Math.round(e)}handleChange({data:e,$event:n}){if(e.hex){if(Eee(e.hex)){let o=new ww(e.hex);this.onChange.emit({data:{hex:this.disableAlpha?o.toHex():o.toHex8(),source:"hex"},$event:n})}}else if(e.r||e.g||e.b)this.onChange.emit({data:{r:e.r||this.rgb.r,g:e.g||this.rgb.g,b:e.b||this.rgb.b,source:"rgb"},$event:n});else if(e.a)e.a<0?e.a=0:e.a>1&&(e.a=1),this.disableAlpha&&(e.a=1),this.onChange.emit({data:{h:this.hsl.h,s:this.hsl.s,l:this.hsl.l,a:Math.round(e.a*100)/100,source:"rgb"},$event:n});else if(e.h||e.s||e.l){let o=e.s&&e.s.replace("%",""),s=e.l&&e.l.replace("%","");this.onChange.emit({data:{h:e.h||this.hsl.h,s:Number(o||this.hsl.s),l:Number(s||this.hsl.l),source:"hsl"},$event:n})}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-chrome-fields"]],inputs:{disableAlpha:"disableAlpha",hsl:"hsl",rgb:"rgb",hex:"hex"},outputs:{onChange:"onChange"},decls:13,vars:3,consts:[["icon",""],["iconUp",""],["iconDown",""],[1,"chrome-wrap"],[1,"chrome-fields"],[3,"ngIf"],[1,"chrome-toggle"],[1,"chrome-icon",3,"click"],["viewBox","0 0 24 24",1,"chrome-toggle-svg"],["fill","#333","d","M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"],["fill","#333","d","M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15Z"],[1,"chrome-field"],["label","hex",3,"onChange","value"],["label","r",3,"onChange","value"],["label","g",3,"onChange","value"],["label","b",3,"onChange","value"],["label","a",3,"style","value","arrowOffset","onChange",4,"ngIf"],["label","a",3,"onChange","value","arrowOffset"],["label","h",3,"onChange","value"],["label","s",3,"onChange","value"],["label","l",3,"onChange","value"]],template:function(n,o){if(n&1){let s=We();$(0,"div",3)(1,"div",4),Pe(2,sMe,2,6,"ng-template",5)(3,cMe,8,19,"ng-template",5)(4,dMe,8,19,"ng-template",5),ee(),$(5,"div",6)(6,"div",7,0),ve("click",function(){return we(s),xe(o.toggleViews())}),fp(),$(8,"svg",8),ct(9,"path",9,1)(11,"path",10,2),ee()()()()}n&2&&(j(2),z("ngIf",o.view==="hex"),j(),z("ngIf",o.view==="rgb"),j(),z("ngIf",o.view==="hsl"))},dependencies:[Gt,Tee],styles:[".chrome-wrap[_ngcontent-%COMP%]{padding-top:16px;display:flex}.chrome-fields[_ngcontent-%COMP%]{flex:1;display:flex;margin-left:-6px}.chrome-field[_ngcontent-%COMP%]{padding-left:6px;width:100%}.chrome-toggle[_ngcontent-%COMP%]{width:32px;text-align:right;position:relative}.chrome-icon[_ngcontent-%COMP%]{margin-right:-4px;margin-top:12px;cursor:pointer;position:relative}.chrome-toggle-svg[_ngcontent-%COMP%]{width:24px;height:24px;border:1px transparent solid;border-radius:5px}.chrome-toggle-svg[_ngcontent-%COMP%]:hover{background:#eee}"],changeDetection:0})}return r})(),Dee=(()=>{class r extends V8{disableAlpha=!1;circle={width:"12px",height:"12px",borderRadius:"6px",boxShadow:"rgb(255, 255, 255) 0px 0px 0px 1px inset",transform:"translate(-6px, -8px)"};pointer={width:"12px",height:"12px",borderRadius:"6px",transform:"translate(-6px, -2px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"};activeBackground;constructor(){super()}afterValidChange(){let e=this.disableAlpha?1:this.rgb.a;this.activeBackground=`rgba(${this.rgb.r}, ${this.rgb.g}, ${this.rgb.b}, ${e})`}handleValueChange({data:e,$event:n}){this.handleChange(e,n)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["color-chrome"]],inputs:{disableAlpha:"disableAlpha"},features:[Xi([{provide:Yu,useExisting:Dl(()=>r),multi:!0},{provide:V8,useExisting:Dl(()=>r)}]),ll],decls:14,vars:16,consts:[[1,"saturation"],[3,"onChange","hsl","hsv","circle"],[1,"chrome-body"],[1,"chrome-controls"],[1,"chrome-color"],[1,"chrome-swatch"],[1,"chrome-active"],[1,"chrome-toggles"],[1,"chrome-hue"],[3,"onChange","radius","hsl","pointer"],["class","chrome-alpha",4,"ngIf"],[3,"onChange","rgb","hsl","hex","disableAlpha"],[1,"chrome-alpha"],[3,"onChange","radius","rgb","hsl","pointer"]],template:function(n,o){n&1&&($(0,"div")(1,"div",0)(2,"color-saturation",1),ve("onChange",function(l){return o.handleValueChange(l)}),ee()(),$(3,"div",2)(4,"div",3)(5,"div",4)(6,"div",5),ct(7,"div",6)(8,"color-checkboard"),ee()(),$(9,"div",7)(10,"div",8)(11,"color-hue",9),ve("onChange",function(l){return o.handleValueChange(l)}),ee()(),Pe(12,hMe,2,4,"div",10),ee()(),$(13,"color-chrome-fields",11),ve("onChange",function(l){return o.handleValueChange(l)}),ee()()()),n&2&&(px("chrome-picker ",o.className,""),j(2),z("hsl",o.hsl)("hsv",o.hsv)("circle",o.circle),j(5),fo("background",o.activeBackground),j(4),z("radius",2)("hsl",o.hsl)("pointer",o.pointer),j(),z("ngIf",!o.disableAlpha),j(),z("rgb",o.rgb)("hsl",o.hsl)("hex",o.hex)("disableAlpha",o.disableAlpha))},dependencies:()=>[Gt,Mee,N8,Pee,kee,pMe],styles:[".chrome-picker[_ngcontent-%COMP%]{background:#fff;border-radius:2px;box-shadow:0 0 2px #0000004d,0 4px 8px #0000004d;box-sizing:initial;width:225px;font-family:Menlo}.chrome-controls[_ngcontent-%COMP%]{display:flex}.chrome-color[_ngcontent-%COMP%]{width:42px}.chrome-body[_ngcontent-%COMP%]{padding:14px 14px 12px}.chrome-active[_ngcontent-%COMP%]{position:absolute;inset:0;border-radius:20px;box-shadow:inset 0 0 0 1px #0000001a;z-index:2}.chrome-swatch[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:15px;position:relative;overflow:hidden}.saturation[_ngcontent-%COMP%]{width:100%;padding-bottom:55%;position:relative;border-radius:2px 2px 0 0;overflow:hidden}.chrome-toggles[_ngcontent-%COMP%]{flex:1}.chrome-hue[_ngcontent-%COMP%]{height:10px;position:relative;margin-bottom:8px}.chrome-alpha[_ngcontent-%COMP%]{height:10px;position:relative}"],changeDetection:0})}return r})(),Ree=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Wu,Iee,B8,Fee,Lee,Oee]})}return r})();function p3(r){"@babel/helpers - typeof";return p3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},p3(r)}var fMe=/^\s+/,gMe=/\s+$/;function Zi(r,i){if(r=r||"",i=i||{},r instanceof Zi)return r;if(!(this instanceof Zi))return new Zi(r,i);var e=_Me(r);this._originalInput=r,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=Math.round(100*this._a)/100,this._format=i.format||e.format,this._gradientType=i.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=e.ok}Zi.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var i=this.toRgb();return(i.r*299+i.g*587+i.b*114)/1e3},getLuminance:function(){var i=this.toRgb(),e,n,o,s,l,h;return e=i.r/255,n=i.g/255,o=i.b/255,e<=.03928?s=e/12.92:s=Math.pow((e+.055)/1.055,2.4),n<=.03928?l=n/12.92:l=Math.pow((n+.055)/1.055,2.4),o<=.03928?h=o/12.92:h=Math.pow((o+.055)/1.055,2.4),.2126*s+.7152*l+.0722*h},setAlpha:function(i){return this._a=zee(i),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var i=Bee(this._r,this._g,this._b);return{h:i.h*360,s:i.s,v:i.v,a:this._a}},toHsvString:function(){var i=Bee(this._r,this._g,this._b),e=Math.round(i.h*360),n=Math.round(i.s*100),o=Math.round(i.v*100);return this._a==1?"hsv("+e+", "+n+"%, "+o+"%)":"hsva("+e+", "+n+"%, "+o+"%, "+this._roundA+")"},toHsl:function(){var i=Nee(this._r,this._g,this._b);return{h:i.h*360,s:i.s,l:i.l,a:this._a}},toHslString:function(){var i=Nee(this._r,this._g,this._b),e=Math.round(i.h*360),n=Math.round(i.s*100),o=Math.round(i.l*100);return this._a==1?"hsl("+e+", "+n+"%, "+o+"%)":"hsla("+e+", "+n+"%, "+o+"%, "+this._roundA+")"},toHex:function(i){return Gee(this._r,this._g,this._b,i)},toHexString:function(i){return"#"+this.toHex(i)},toHex8:function(i){return wMe(this._r,this._g,this._b,this._a,i)},toHex8String:function(i){return"#"+this.toHex8(i)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(hs(this._r,255)*100)+"%",g:Math.round(hs(this._g,255)*100)+"%",b:Math.round(hs(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(hs(this._r,255)*100)+"%, "+Math.round(hs(this._g,255)*100)+"%, "+Math.round(hs(this._b,255)*100)+"%)":"rgba("+Math.round(hs(this._r,255)*100)+"%, "+Math.round(hs(this._g,255)*100)+"%, "+Math.round(hs(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:kMe[Gee(this._r,this._g,this._b,!0)]||!1},toFilter:function(i){var e="#"+jee(this._r,this._g,this._b,this._a),n=e,o=this._gradientType?"GradientType = 1, ":"";if(i){var s=Zi(i);n="#"+jee(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+e+",endColorstr="+n+")"},toString:function(i){var e=!!i;i=i||this._format;var n=!1,o=this._a<1&&this._a>=0,s=!e&&o&&(i==="hex"||i==="hex6"||i==="hex3"||i==="hex4"||i==="hex8"||i==="name");return s?i==="name"&&this._a===0?this.toName():this.toRgbString():(i==="rgb"&&(n=this.toRgbString()),i==="prgb"&&(n=this.toPercentageRgbString()),(i==="hex"||i==="hex6")&&(n=this.toHexString()),i==="hex3"&&(n=this.toHexString(!0)),i==="hex4"&&(n=this.toHex8String(!0)),i==="hex8"&&(n=this.toHex8String()),i==="name"&&(n=this.toName()),i==="hsl"&&(n=this.toHslString()),i==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return Zi(this.toString())},_applyModification:function(i,e){var n=i.apply(null,[this].concat([].slice.call(e)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(AMe,arguments)},brighten:function(){return this._applyModification(MMe,arguments)},darken:function(){return this._applyModification(IMe,arguments)},desaturate:function(){return this._applyModification(xMe,arguments)},saturate:function(){return this._applyModification(SMe,arguments)},greyscale:function(){return this._applyModification(CMe,arguments)},spin:function(){return this._applyModification(EMe,arguments)},_applyCombination:function(i,e){return i.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(PMe,arguments)},complement:function(){return this._applyCombination(TMe,arguments)},monochromatic:function(){return this._applyCombination(LMe,arguments)},splitcomplement:function(){return this._applyCombination(FMe,arguments)},triad:function(){return this._applyCombination(Vee,[3])},tetrad:function(){return this._applyCombination(Vee,[4])}};Zi.fromRatio=function(r,i){if(p3(r)=="object"){var e={};for(var n in r)r.hasOwnProperty(n)&&(n==="a"?e[n]=r[n]:e[n]=MC(r[n]));r=e}return Zi(r,i)};function _Me(r){var i={r:0,g:0,b:0},e=1,n=null,o=null,s=null,l=!1,h=!1;return typeof r=="string"&&(r=NMe(r)),p3(r)=="object"&&(Vg(r.r)&&Vg(r.g)&&Vg(r.b)?(i=yMe(r.r,r.g,r.b),l=!0,h=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Vg(r.h)&&Vg(r.s)&&Vg(r.v)?(n=MC(r.s),o=MC(r.v),i=bMe(r.h,n,o),l=!0,h="hsv"):Vg(r.h)&&Vg(r.s)&&Vg(r.l)&&(n=MC(r.s),s=MC(r.l),i=vMe(r.h,n,s),l=!0,h="hsl"),r.hasOwnProperty("a")&&(e=r.a)),e=zee(e),{ok:l,format:r.format||h,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:e}}function yMe(r,i,e){return{r:hs(r,255)*255,g:hs(i,255)*255,b:hs(e,255)*255}}function Nee(r,i,e){r=hs(r,255),i=hs(i,255),e=hs(e,255);var n=Math.max(r,i,e),o=Math.min(r,i,e),s,l,h=(n+o)/2;if(n==o)s=l=0;else{var p=n-o;switch(l=h>.5?p/(2-n-o):p/(n+o),n){case r:s=(i-e)/p+(i<e?6:0);break;case i:s=(e-r)/p+2;break;case e:s=(r-i)/p+4;break}s/=6}return{h:s,s:l,l:h}}function vMe(r,i,e){var n,o,s;r=hs(r,360),i=hs(i,100),e=hs(e,100);function l(m,f,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?m+(f-m)*6*g:g<1/2?f:g<2/3?m+(f-m)*(2/3-g)*6:m}if(i===0)n=o=s=e;else{var h=e<.5?e*(1+i):e+i-e*i,p=2*e-h;n=l(p,h,r+1/3),o=l(p,h,r),s=l(p,h,r-1/3)}return{r:n*255,g:o*255,b:s*255}}function Bee(r,i,e){r=hs(r,255),i=hs(i,255),e=hs(e,255);var n=Math.max(r,i,e),o=Math.min(r,i,e),s,l,h=n,p=n-o;if(l=n===0?0:p/n,n==o)s=0;else{switch(n){case r:s=(i-e)/p+(i<e?6:0);break;case i:s=(e-r)/p+2;break;case e:s=(r-i)/p+4;break}s/=6}return{h:s,s:l,v:h}}function bMe(r,i,e){r=hs(r,360)*6,i=hs(i,100),e=hs(e,100);var n=Math.floor(r),o=r-n,s=e*(1-i),l=e*(1-o*i),h=e*(1-(1-o)*i),p=n%6,m=[e,l,s,s,h,e][p],f=[h,e,e,l,s,s][p],g=[s,s,h,e,e,l][p];return{r:m*255,g:f*255,b:g*255}}function Gee(r,i,e,n){var o=[em(Math.round(r).toString(16)),em(Math.round(i).toString(16)),em(Math.round(e).toString(16))];return n&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function wMe(r,i,e,n,o){var s=[em(Math.round(r).toString(16)),em(Math.round(i).toString(16)),em(Math.round(e).toString(16)),em($ee(n))];return o&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)&&s[3].charAt(0)==s[3].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}function jee(r,i,e,n){var o=[em($ee(n)),em(Math.round(r).toString(16)),em(Math.round(i).toString(16)),em(Math.round(e).toString(16))];return o.join("")}Zi.equals=function(r,i){return!r||!i?!1:Zi(r).toRgbString()==Zi(i).toRgbString()};Zi.random=function(){return Zi.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function xMe(r,i){i=i===0?0:i||10;var e=Zi(r).toHsl();return e.s-=i/100,e.s=m3(e.s),Zi(e)}function SMe(r,i){i=i===0?0:i||10;var e=Zi(r).toHsl();return e.s+=i/100,e.s=m3(e.s),Zi(e)}function CMe(r){return Zi(r).desaturate(100)}function AMe(r,i){i=i===0?0:i||10;var e=Zi(r).toHsl();return e.l+=i/100,e.l=m3(e.l),Zi(e)}function MMe(r,i){i=i===0?0:i||10;var e=Zi(r).toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(i/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(i/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(i/100)))),Zi(e)}function IMe(r,i){i=i===0?0:i||10;var e=Zi(r).toHsl();return e.l-=i/100,e.l=m3(e.l),Zi(e)}function EMe(r,i){var e=Zi(r).toHsl(),n=(e.h+i)%360;return e.h=n<0?360+n:n,Zi(e)}function TMe(r){var i=Zi(r).toHsl();return i.h=(i.h+180)%360,Zi(i)}function Vee(r,i){if(isNaN(i)||i<=0)throw new Error("Argument to polyad must be a positive number");for(var e=Zi(r).toHsl(),n=[Zi(r)],o=360/i,s=1;s<i;s++)n.push(Zi({h:(e.h+s*o)%360,s:e.s,l:e.l}));return n}function FMe(r){var i=Zi(r).toHsl(),e=i.h;return[Zi(r),Zi({h:(e+72)%360,s:i.s,l:i.l}),Zi({h:(e+216)%360,s:i.s,l:i.l})]}function PMe(r,i,e){i=i||6,e=e||30;var n=Zi(r).toHsl(),o=360/e,s=[Zi(r)];for(n.h=(n.h-(o*i>>1)+720)%360;--i;)n.h=(n.h+o)%360,s.push(Zi(n));return s}function LMe(r,i){i=i||6;for(var e=Zi(r).toHsv(),n=e.h,o=e.s,s=e.v,l=[],h=1/i;i--;)l.push(Zi({h:n,s:o,v:s})),s=(s+h)%1;return l}Zi.mix=function(r,i,e){e=e===0?0:e||50;var n=Zi(r).toRgb(),o=Zi(i).toRgb(),s=e/100,l={r:(o.r-n.r)*s+n.r,g:(o.g-n.g)*s+n.g,b:(o.b-n.b)*s+n.b,a:(o.a-n.a)*s+n.a};return Zi(l)};Zi.readability=function(r,i){var e=Zi(r),n=Zi(i);return(Math.max(e.getLuminance(),n.getLuminance())+.05)/(Math.min(e.getLuminance(),n.getLuminance())+.05)};Zi.isReadable=function(r,i,e){var n=Zi.readability(r,i),o,s;switch(s=!1,o=BMe(e),o.level+o.size){case"AAsmall":case"AAAlarge":s=n>=4.5;break;case"AAlarge":s=n>=3;break;case"AAAsmall":s=n>=7;break}return s};Zi.mostReadable=function(r,i,e){var n=null,o=0,s,l,h,p;e=e||{},l=e.includeFallbackColors,h=e.level,p=e.size;for(var m=0;m<i.length;m++)s=Zi.readability(r,i[m]),s>o&&(o=s,n=Zi(i[m]));return Zi.isReadable(r,n,{level:h,size:p})||!l?n:(e.includeFallbackColors=!1,Zi.mostReadable(r,["#fff","#000"],e))};var U8=Zi.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},kMe=Zi.hexNames=OMe(U8);function OMe(r){var i={};for(var e in r)r.hasOwnProperty(e)&&(i[r[e]]=e);return i}function zee(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function hs(r,i){DMe(r)&&(r="100%");var e=RMe(r);return r=Math.min(i,Math.max(0,parseFloat(r))),e&&(r=parseInt(r*i,10)/100),Math.abs(r-i)<1e-6?1:r%i/parseFloat(i)}function m3(r){return Math.min(1,Math.max(0,r))}function mh(r){return parseInt(r,16)}function DMe(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function RMe(r){return typeof r=="string"&&r.indexOf("%")!=-1}function em(r){return r.length==1?"0"+r:""+r}function MC(r){return r<=1&&(r=r*100+"%"),r}function $ee(r){return Math.round(parseFloat(r)*255).toString(16)}function Uee(r){return mh(r)/255}var Jp=function(){var r="[-\\+]?\\d+%?",i="[-\\+]?\\d*\\.\\d+%?",e="(?:"+i+")|(?:"+r+")",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",o="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+o),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+o),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+o),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Vg(r){return!!Jp.CSS_UNIT.exec(r)}function NMe(r){r=r.replace(fMe,"").replace(gMe,"").toLowerCase();var i=!1;if(U8[r])r=U8[r],i=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e;return(e=Jp.rgb.exec(r))?{r:e[1],g:e[2],b:e[3]}:(e=Jp.rgba.exec(r))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=Jp.hsl.exec(r))?{h:e[1],s:e[2],l:e[3]}:(e=Jp.hsla.exec(r))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=Jp.hsv.exec(r))?{h:e[1],s:e[2],v:e[3]}:(e=Jp.hsva.exec(r))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=Jp.hex8.exec(r))?{r:mh(e[1]),g:mh(e[2]),b:mh(e[3]),a:Uee(e[4]),format:i?"name":"hex8"}:(e=Jp.hex6.exec(r))?{r:mh(e[1]),g:mh(e[2]),b:mh(e[3]),format:i?"name":"hex"}:(e=Jp.hex4.exec(r))?{r:mh(e[1]+""+e[1]),g:mh(e[2]+""+e[2]),b:mh(e[3]+""+e[3]),a:Uee(e[4]+""+e[4]),format:i?"name":"hex8"}:(e=Jp.hex3.exec(r))?{r:mh(e[1]+""+e[1]),g:mh(e[2]+""+e[2]),b:mh(e[3]+""+e[3]),format:i?"name":"hex"}:!1}function BMe(r){var i,e;return r=r||{level:"AA",size:"small"},i=(r.level||"AA").toUpperCase(),e=(r.size||"small").toLowerCase(),i!=="AA"&&i!=="AAA"&&(i="AA"),e!=="small"&&e!=="large"&&(e="small"),{level:i,size:e}}function GMe(r,i){if(r&1){let e=We();$(0,"div",4)(1,"color-chrome",5),ve("onChange",function(o){we(e);let s=ne();return xe(s.handleChange(o))}),ee(),$(2,"div",6)(3,"button",7),ve("click",function(o){we(e);let s=ne();return xe(s.handleClick(o))}),_e(4),le(5,"translate"),ee()()()}if(r&2){let e=ne();j(),z("color",e.colorPicker),j(3),Qe(" ",ce(5,2,"igo.common.confirmDialog.applyBtn")," ")}}var IC=(()=>{class r{isOpen=!1;set value(e){this._value=this.formatColor(e??"#000"),this.colorPicker=this._value,this.onChange(this.value),this.onTouch(this.value)}get value(){return this._value}_value;outputFormat="rgba";colorChange=new Ke;colorPicker;onChange=()=>{};onTouch=()=>{};writeValue(e){this.value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouch=e}handleClick(e){e.preventDefault(),e.stopPropagation(),this.isOpen=!1,this.value=this.colorPicker}handleChange(e){this.colorPicker=this.formatColor(e.color.rgb,"rgba"),this.colorChange.emit(this.formatColor(this.colorPicker))}formatColor(e,n=this.outputFormat){switch(n){case"hex":e=Zi(e).toHexString();break;case"rgba":e=Zi(e).toRgbString();break;case"hsla":e=Zi(e).toHsvString();break;default:e=Zi(e).toRgbString();break}return e}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-color-picker-form-field"]],inputs:{outputFormat:"outputFormat"},outputs:{colorChange:"colorChange"},standalone:!0,features:[Xi([{provide:Yu,useExisting:Dl(()=>r),multi:!0}]),lt],decls:6,vars:7,consts:[["trigger","cdkOverlayOrigin"],["floatLabel","always","tooltip-position","below","matTooltipShowDelay","500","subscriptSizing","dynamic","cdkOverlayOrigin","",1,"fill-field",3,"click"],["type","text","matInput","",3,"readonly"],["cdkConnectedOverlay","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"backdropClick","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayHasBackdrop"],[1,"picker"],[3,"onChange","color"],[1,"buttons"],["mat-flat-button","","color","primary",3,"click"]],template:function(n,o){if(n&1){let s=We();$(0,"mat-form-field",1,0),ve("click",function(){return we(s),xe(o.isOpen=!o.isOpen)}),$(2,"mat-label"),_e(3),ee(),ct(4,"input",2),ee(),Pe(5,GMe,6,4,"ng-template",3),ve("backdropClick",function(){return we(s),xe(o.isOpen=!1)})}if(n&2){let s=Xt(1);j(3),bt(o.colorPicker),j(),fo("background",o.colorPicker),z("readonly",!0),j(),z("cdkConnectedOverlayOrigin",s)("cdkConnectedOverlayOpen",o.isOpen)("cdkConnectedOverlayHasBackdrop",!0)}},dependencies:[jr,Gr,Mo,dG,gn,Cn,hG,Ree,Dee,Vt,co,Et,Tt],styles:[`.picker[_ngcontent-%COMP%]{left:100%;position:absolute;top:100%;background-color:#fff;border-radius:8px;overflow:hidden;box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f}.picker[_ngcontent-%COMP%]     .chrome-picker{box-shadow:none}.picker[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{padding:4px 12px 8px;display:flex;justify-content:flex-end}
/*# sourceMappingURL=color-picker-form-field.component-2OEXY2TH.css.map */`]})}return r})();var EC=(()=>{class r{fillColor="rgba(255,255,255,0.4)";strokeColor="rgba(143,7,7,1)";strokeWidth=1;labelsAreShown=!0;icon;fontSize="15";fontStyle=Kp.Arial.toString();offsetX=0;offsetY=0;getFillColor(){return this.fillColor}setFillColor(e){this.fillColor=e}getStrokeColor(){return this.strokeColor}setStrokeColor(e){this.strokeColor=e}getStrokeWidth(){return this.strokeWidth}getLabelsAreShown(){return this.labelsAreShown}toggleLabelsAreShown(){this.labelsAreShown=!this.labelsAreShown}setIcon(e){this.icon=e}getIcon(){return this.icon}getFontSize(){return this.fontSize}setFontSize(e){this.fontSize=e}getFontStyle(){return this.fontStyle}setFontStyle(e){this.fontStyle=e}getOffsetX(){return this.offsetX}setOffsetX(e){this.offsetX=e}getOffsetY(){return this.offsetY}setOffsetY(e){this.offsetY=e}createIndividualElementStyle(e,n,o,s,l,h,p,m,f,g){let y,_=!1;e.getGeometry()instanceof Ii&&(_=!_);let A=o?e.get("draw"):"";e.set("_mapTitle",A);let k={text:A,stroke:{color:"white",width:.75},fill:{color:"black"},font:s,overflow:!0,offsetX:p,offsetY:m},R;if(e.get("rad")){let q=Sr(e.getGeometry().flatCoordinates,f,"EPSG:4326"),X=e.get("rad")/Math.cos(Math.PI/180*q[1])/n;return R={text:k,circle:{radius:X,stroke:{color:h||this.strokeColor,width:this.strokeWidth},fill:{color:l}}},e.set("_style",R),y=new oi({text:new so({text:A,stroke:new ui({color:"white",width:.75}),fill:new hi({color:"black"}),font:s,overflow:!0,offsetX:p,offsetY:m}),image:new an({radius:X,stroke:new ui({color:h||this.strokeColor,width:this.strokeWidth}),fill:new hi({color:l})})}),y}else if(g){this.offsetY=-26,k.offsetY=this.offsetY;let q={text:k,stroke:{color:h,width:this.strokeWidth},fill:{color:l},icon:{src:g}};return e.set("_style",q),y=new oi({text:new so({text:o?e.get("draw"):"",stroke:new ui({color:"white",width:.75}),fill:new hi({color:"black"}),font:s,overflow:!0,offsetX:p,offsetY:m}),stroke:new ui({color:h,width:this.strokeWidth}),fill:new hi({color:l}),image:new Bs({src:g})}),y}else{this.offsetY=_?-15:0,k.offsetY=this.offsetY;let q={text:k,stroke:{color:h,width:this.strokeWidth},fill:{color:l},circle:{radius:5,stroke:{color:h,width:this.strokeWidth},fill:{color:l}}};return e.set("_style",q),y=new oi({text:new so({text:o?e.get("draw"):"",stroke:new ui({color:"white",width:.75}),fill:new hi({color:"black"}),font:s,overflow:!0,offsetX:p,offsetY:m}),stroke:new ui({color:h,width:this.strokeWidth}),fill:new hi({color:l}),image:new an({radius:5,stroke:new ui({color:h,width:this.strokeWidth}),fill:new hi({color:l})})}),y}}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function jMe(r,i){r&1&&(Dr(0),$(1,"span")(2,"mat-icon",9),_e(3,"format_color_fill"),ee(),_e(4),le(5,"translate"),ee(),ct(6,"igo-color-picker-form-field",21),Rr()),r&2&&(j(4),Qe(" ",ce(5,1,"igo.geo.style.fill")," "))}function VMe(r,i){if(r&1&&($(0,"mat-option",22),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e," ")}}var z8=(()=>{class r{dialogRef;formBuilder;drawStyleService;data;confirmFlag=!1;form;styleModalData;linestringOnly;constructor(e,n,o,s){this.dialogRef=e,this.formBuilder=n,this.drawStyleService=o,this.data=s}ngOnInit(){this.linestringOnly=!0;for(let e of this.data.features)e.geometry.type!=="LineString"&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getFeatureFillColor()],stroke:[this.getFeatureStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)",strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)",fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20",fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Kp.Arial,offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX(),offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}}get allFontStyles(){return Object.values(Kp)}getFeatureFontSize(){return this.styleModalData.fontSize?this.styleModalData.fontSize:this.data.features.length>0?this.data.features[0].properties.fontStyle.split(" ")[0].replace("px",""):"20"}getFeatureFontStyle(){return this.styleModalData.fontStyle?this.styleModalData.fontStyle:this.data.features.length>0?this.data.features[0].properties.fontStyle.substring(this.data.features[0].properties.fontStyle.indexOf(" ")+1):Kp.Arial}getFeatureFillColor(){return this.styleModalData.fillColor?this.styleModalData.fillColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.styleModalData.strokeColor?this.styleModalData.strokeColor:this.data.features.length>0?this.data.features[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.styleModalData.offsetX?this.styleModalData.offsetX:this.data.features.length>0?this.data.features[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.styleModalData.offsetY?this.styleModalData.offsetY:this.data.features.length>0?this.data.features[0].properties.offsetY:this.drawStyleService.getOffsetY()}cancelDrawing(){this.dialogRef.close()}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(n){return new(n||r)(Ie(Hc),Ie($c),Ie(EC),Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-style-modal-drawing"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[lt],decls:47,vars:29,consts:[["testFontSize",""],["testFontStyle",""],["offsetXInput",""],["offsetYInput",""],["mat-dialog-title",""],["mat-dialog-content","",1,"edition-drawing",3,"hidden"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke"],[1,"igo-input-container"],["subscriptSizing","dynamic",1,"igo-form-input-box"],["matInput","","type","number","placeholder","10","min","10","onkeydown","return event.keyCode !== 69",3,"input","value"],["matTextSuffix",""],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","type","number","onkeydown","return event.keyCode !== 69",3,"input","value"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill"],[3,"value"]],template:function(n,o){if(n&1){let s=We();$(0,"h2",4),_e(1),le(2,"translate"),ee(),$(3,"div",5)(4,"form",6)(5,"div",7),Pe(6,jMe,7,3,"ng-container",8),$(7,"span")(8,"mat-icon",9),_e(9,"border_color "),ee(),_e(10),le(11,"translate"),ee(),ct(12,"igo-color-picker-form-field",10),ee(),$(13,"div",11)(14,"mat-form-field",12)(15,"mat-label"),_e(16),le(17,"translate"),ee(),$(18,"input",13,0),ve("input",function(h){return we(s),xe(o.styleModalData.fontSize=h.target.value)}),ee(),$(20,"span",14),_e(21,"px"),ee()(),$(22,"mat-form-field",12)(23,"mat-label"),_e(24),le(25,"translate"),ee(),$(26,"mat-select",15,1),ve("selectionChange",function(h){return we(s),xe(o.styleModalData.fontStyle=h.value)}),Pe(28,VMe,2,2,"mat-option",16),ee()(),$(29,"mat-form-field",12)(30,"mat-label"),_e(31),le(32,"translate"),ee(),$(33,"input",17,2),ve("input",function(h){return we(s),xe(o.styleModalData.offsetX=h.target.value)}),ee()(),$(35,"mat-form-field",12)(36,"mat-label"),_e(37),le(38,"translate"),ee(),$(39,"input",17,3),ve("input",function(h){return we(s),xe(o.styleModalData.offsetY=h.target.value)}),ee()()()()(),$(41,"div",18)(42,"button",19),ve("click",function(){return we(s),xe(o.cancelDrawing())}),_e(43),le(44,"translate"),ee(),$(45,"button",20),ve("click",function(){return we(s),xe(o.confirm())}),_e(46,"OK"),ee()()}n&2&&(j(),Qe(" ",ce(2,15,"igo.geo.style.styleModal"),`
`),j(2),z("hidden",o.data.features.length===0),j(),z("formGroup",o.form),j(2),z("ngIf",o.linestringOnly!==!0),j(4),Qe(" ",ce(11,17,"igo.geo.style.stroke")," "),j(6),bt(ce(17,19,"igo.geo.style.fontSize")),j(2),z("value",o.getFeatureFontSize()),j(6),bt(ce(25,21,"igo.geo.style.fontStyle")),j(2),z("value",o.getFeatureFontStyle()),j(2),z("ngForOf",o.allFontStyles),j(3),bt(ce(32,23,"igo.geo.style.offsetX")),j(2),z("value",o.getFeatureOffsetX()),j(4),bt(ce(38,25,"igo.geo.style.offsetY")),j(2),z("value",o.getFeatureOffsetY()),j(4),Qe(" ",ce(44,27,"igo.geo.style.cancel")," "))},dependencies:[id,pl,Sn,Xu,kn,Zu,Sa,Ku,Qu,Gt,jt,$t,IC,jr,Gr,Mo,Vc,gn,Cn,ho,uo,Nn,Li,Bn,Zc,Vt,co,Et,Tt],styles:[`[_nghost-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 1px}[_nghost-%COMP%]   form[_ngcontent-%COMP%]{padding-top:16px}[_nghost-%COMP%]   .fill-field[_ngcontent-%COMP%], [_nghost-%COMP%]   .stroke-field[_ngcontent-%COMP%]{width:140px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}[_nghost-%COMP%]   .color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{width:25px;height:25px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}[_nghost-%COMP%]   .igo-form-input-box[_ngcontent-%COMP%]{width:150px}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{margin-right:5px}
/*# sourceMappingURL=style-modal-drawing.component-C3KHKGP6.css.map */`]})}return r})();var Hee=(()=>{class r{dialogRef;confirmFlag=!1;constructor(e){this.dialogRef=e}cancelDrawing(){this.dialogRef.close()}confirm(e){this.confirmFlag=!0,this.dialogRef.close(e)}static \u0275fac=function(n){return new(n||r)(Ie(Hc))};static \u0275cmp=nt({type:r,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[lt],decls:14,vars:9,consts:[["input",""],["mat-dialog-content",""],[1,"mat-typography"],[1,"example-full-width"],["matInput","",3,"placeholder"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,o){if(n&1){let s=We();$(0,"div",1)(1,"p",2),_e(2),le(3,"translate"),ee(),$(4,"mat-form-field",3),ct(5,"input",4,0),le(7,"translate"),ee()(),$(8,"div",5)(9,"button",6),ve("click",function(){return we(s),xe(o.cancelDrawing())}),_e(10),le(11,"translate"),ee(),$(12,"button",7),ve("click",function(){we(s);let h=Xt(6);return xe(o.confirm(h.value))}),_e(13," OK "),ee()()}n&2&&(j(2),Qe(" ",ce(3,3,"igo.geo.draw.layer.layerDialogInstruction")," "),j(3),sr("placeholder",ce(7,5,"igo.geo.draw.layer.title")),j(5),Qe(" ",ce(11,7,"igo.geo.draw.cancel")," "))},dependencies:[pl,jr,Gr,gn,Cn,Zc,Vt,co,Et,Tt],styles:[`[_nghost-%COMP%]   .fields-container[_ngcontent-%COMP%]{display:flex}
/*# sourceMappingURL=draw-layer-popup.component-RNO7JF4O.css.map */`]})}return r})();function UMe(r,i){if(r&1){let e=We();$(0,"mat-radio-button",12),ve("change",function(o){we(e);let s=ne(3);return xe(s.onLabelTypeChange(o.value))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(3);z("value",e.value)("disabled",n.optionAvailable(e.value))("checked",e.checked),j(),Qe(" ",n.getProperLengthLabel(e.value)," ")}}function zMe(r,i){if(r&1&&($(0,"mat-radio-group"),Pe(1,UMe,2,4,"mat-radio-button",11),ee()),r&2){let e=ne(2);j(),z("ngForOf",e.arrayBuiltInType)}}function $Me(r,i){if(r&1){let e=We();$(0,"mat-checkbox",14),ve("change",function(o){we(e);let s=ne(3);return xe(s.onLabelTypeChange(o.source.value,o.checked))}),_e(1),ee()}if(r&2){let e=i.$implicit,n=ne(3);z("value",e.value)("disabled",n.optionAvailable(e.value))("checked",e.checked),j(),Qe(" ",n.getProperLengthLabel(e.value)," ")}}function WMe(r,i){if(r&1&&(Dr(0),Pe(1,$Me,2,4,"mat-checkbox",13),Rr()),r&2){let e=ne(2);j(),z("ngForOf",e.arrayBuiltInType)}}function HMe(r,i){if(r&1&&($(0,"mat-option",6),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e," ")}}function qMe(r,i){if(r&1){let e=We();$(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),_e(3,"(Latitude, Longitude)"),ee(),ct(4,"input",17,0),ee(),$(6,"mat-form-field",18)(7,"mat-select",19),ve("selectionChange",function(o){we(e);let s=ne(2);return xe(s.onChangeCoordinateUnit(o.value))}),Pe(8,HMe,2,2,"mat-option",20),ee()()()}if(r&2){let e=ne(2);j(4),sr("value",e.currentCoordinates),j(3),z("value",e.coordinatesMeasureUnit),j(),z("ngForOf",e.allCoordinatesUnits)}}function YMe(r,i){if(r&1&&($(0,"mat-option",6),_e(1),ee()),r&2){let e=i.$implicit,n=ne(3);z("value",e),j(),Qe(" ",n.getLengthUnitEnum(e)," ")}}function ZMe(r,i){if(r&1){let e=We();$(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),_e(3),ee(),ct(4,"input",21,0),ee(),$(6,"mat-form-field",18)(7,"mat-select",19),ve("selectionChange",function(o){we(e);let s=ne(2);return xe(s.onChangeLengthUnit(o.value))}),Pe(8,YMe,2,2,"mat-option",20),ee()()()}if(r&2){let e=ne(2);j(3),bt(e.lengthLabelT),j(),sr("placeholder",e.lengthLabelT),sr("value",e.currentLength),j(3),z("value",e.lengthMeasureUnit),j(),z("ngForOf",e.allLengthUnits)}}function XMe(r,i){if(r&1&&($(0,"mat-option",6),_e(1),ee()),r&2){let e=i.$implicit,n=ne(3);z("value",e),j(),Qe(" ",n.getAreaUnitEnum(e)," ")}}function KMe(r,i){if(r&1){let e=We();$(0,"div",15)(1,"mat-form-field",16)(2,"mat-label"),_e(3),le(4,"translate"),ee(),ct(5,"input",21,0),le(7,"translate"),ee(),$(8,"mat-form-field",18)(9,"mat-select",19),ve("selectionChange",function(o){we(e);let s=ne(2);return xe(s.onChangeAreaUnit(o.value))}),Pe(10,XMe,2,2,"mat-option",20),ee()()()}if(r&2){let e=ne(2);j(3),bt(ce(4,5,"igo.geo.draw.labelType.Area")),j(2),sr("placeholder",ce(7,7,"igo.geo.draw.labelType.Area")),sr("value",e.currentArea),j(4),z("value",e.areaMeasureUnit),j(),z("ngForOf",e.allAreaUnits)}}function QMe(r,i){if(r&1){let e=We();Dr(0),$(1,"div",3)(2,"div",4)(3,"mat-button-toggle-group",5),ve("change",function(o){we(e);let s=ne();return xe(s.onLabelTypeChange(o.value))}),$(4,"mat-button-toggle",6),_e(5),le(6,"translate"),ee(),$(7,"mat-button-toggle",6),_e(8),le(9,"translate"),ee()()(),$(10,"div")(11,"p"),_e(12),le(13,"translate"),ee(),Pe(14,zMe,2,1,"mat-radio-group",2)(15,WMe,2,1,"ng-container",2)(16,qMe,9,3,"div",7)(17,ZMe,9,5,"div",7)(18,KMe,11,9,"div",7),ee()(),$(19,"div",8)(20,"button",9),ve("click",function(){we(e);let o=ne();return xe(o.cancelDrawing())}),_e(21),le(22,"translate"),ee(),$(23,"button",10),ve("click",function(){we(e);let o=ne();return xe(o.confirm())}),_e(24),ee()(),Rr()}if(r&2){let e=ne();j(3),z("value",e.customOrPredefined),j(),z("value",e.labelType.Custom),j(),Qe(" ",ce(6,13,"igo.geo.draw.labelType.custom")," "),j(2),z("value",e.labelType.Predefined),j(),Qe(" ",ce(9,15,"igo.geo.draw.labelType.predefined")," "),j(4),Qe(" ",ce(13,17,"igo.geo.draw.builtInInstructions")," "),j(2),z("ngIf",e.olGeometryType!=="Polygon"),j(),z("ngIf",e.olGeometryType==="Polygon"),j(),z("ngIf",e.labelFlag===e.labelType.Coordinates),j(),z("ngIf",e.labelFlag===e.labelType.Length||e.polygonCheck===2),j(),z("ngIf",e.labelFlag===e.labelType.Area||e.polygonCheck===2),j(3),Qe(" ",ce(22,19,"igo.geo.draw.cancel")," "),j(3),Qe(" ",e.noLabelButton()," ")}}function JMe(r,i){if(r&1){let e=We();Dr(0),$(1,"div",3)(2,"div",4)(3,"mat-button-toggle-group",5),ve("change",function(o){we(e);let s=ne();return xe(s.onLabelTypeChange(o.value))}),$(4,"mat-button-toggle",6),_e(5),le(6,"translate"),ee(),$(7,"mat-button-toggle",6),_e(8),le(9,"translate"),ee()()(),$(10,"p"),_e(11),le(12,"translate"),ee(),$(13,"mat-form-field",22)(14,"mat-label"),_e(15),le(16,"translate"),ee(),$(17,"input",23,0),le(19,"translate"),ve("select",function(){return we(e),xe(!0)})("input",function(o){we(e);let s=ne();return xe(s.getLabelLength(o.target.value))}),ee()()(),$(20,"div",8)(21,"button",9),ve("click",function(){we(e);let o=ne();return xe(o.cancelDrawing())}),_e(22),le(23,"translate"),ee(),$(24,"button",10),ve("click",function(){we(e);let o=Xt(18),s=ne();return xe(s.confirm(o.value))}),_e(25),ee()(),Rr()}if(r&2){let e=ne();j(3),z("value",e.customOrPredefined),j(),z("value",e.labelType.Custom),j(),Qe(" ",ce(6,11,"igo.geo.draw.labelType.custom")," "),j(2),z("value",e.labelType.Predefined),j(),Qe(" ",ce(9,13,"igo.geo.draw.labelType.predefined")," "),j(3),Qe(" ",ce(12,15,"igo.geo.draw.dialogInstruction")," "),j(4),bt(ce(16,17,"igo.geo.draw.dialogTitle")),j(2),sr("placeholder",ce(19,19,"igo.geo.draw.dialogTitle")),sr("value",e.currentLabel),j(5),Qe(" ",ce(23,21,"igo.geo.draw.cancel")," "),j(3),Qe(" ",e.noLabelButton()," ")}}var qee=(()=>{class r{languageService;dialogRef;data;confirmFlag=!1;labelFlag=Pr.Custom;coordinatesMeasureUnit;lengthMeasureUnit;areaMeasureUnit;geometryType=po;labelType=Pr;arrayBuiltInType=[];currentLabel;currentCoordinates;currentArea;currentLength;olGeometryType=void 0;lengthInMeters;areaInMetersSquare;coordinatesInDD;currentCoordinatesUnit;longlatDD;labelLength;polygonCheck=0;constructor(e,n,o){this.languageService=e,this.dialogRef=n,this.data=o,this.currentLabel=this.data.olGeometry.get("draw"),this.labelLength=this.currentLabel?this.currentLabel.length:0;let s,l=this.data.map.ol.getView().getProjection();if(this.data.olGeometry instanceof gi)if(this.data.olGeometry.get("rad")){let h=[this.data.olGeometry.get("longitude"),this.data.olGeometry.get("latitude")];this.olGeometryType=po.Circle,s=new Tu(h,this.data.olGeometry.get("rad"))}else this.olGeometryType=this.data.olGeometry.getGeometry().getType(),s=this.data.olGeometry.get("geometry");else this.olGeometryType=this.data.olGeometry.getType(),s=this.data.olGeometry;if(this.olGeometryType===po.Point||this.olGeometryType===po.Circle){if(this.data.olGeometry instanceof gi){let h=this.data.olGeometry.get("longitude"),p=this.data.olGeometry.get("latitude");this.longlatDD=uc([h,p],5),this.coordinatesInDD="("+p+", "+h+")"}else{let h=Sr(this.data.olGeometry.getFlatCoordinates(),l,"EPSG:4326");this.longlatDD=uc([h[0],h[1]],5),this.coordinatesInDD="("+this.longlatDD[1]+", "+this.longlatDD[0]+")"}this.currentCoordinates=this.coordinatesInDD}if(this.olGeometryType===po.LineString)this.lengthInMeters=u1(s,l.getCode()).toFixed(2),this.currentLength=this.lengthInMeters;else if(this.olGeometryType===po.Polygon)this.lengthInMeters=u1(s,l.getCode()).toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=d1(s,l.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare;else if(this.olGeometryType===po.Circle){let h=Kd(s,1e4),p=this.getRadius(h);this.lengthInMeters=p.toFixed(2),this.currentLength=this.lengthInMeters,this.areaInMetersSquare=d1(h,l.getCode()).toFixed(2),this.currentArea=this.areaInMetersSquare}o.olGeometry.get("labelType")===Pr.Coordinates?(this.onLabelTypeChange(Pr.Predefined),this.onLabelTypeChange(Pr.Coordinates,!0),this.coordinatesMeasureUnit=o.olGeometry.get("measureUnit")):o.olGeometry.get("labelType")===Pr.Length?(this.onLabelTypeChange(Pr.Predefined),this.onLabelTypeChange(Pr.Length,!0),this.lengthMeasureUnit=o.olGeometry.get("measureUnit")):o.olGeometry.get("labelType")===Pr.Area?(this.onLabelTypeChange(Pr.Predefined),this.onLabelTypeChange(Pr.Area,!0),this.areaMeasureUnit=o.olGeometry.get("measureUnit")):o.olGeometry.get("labelType")?.length===2&&(this.onLabelTypeChange(Pr.Predefined),this.onLabelTypeChange(Pr.Length,!0),this.onLabelTypeChange(Pr.Area,!0),this.lengthMeasureUnit=o.olGeometry.get("measureUnit")[0],this.areaMeasureUnit=o.olGeometry.get("measureUnit")[1]),this.buildArrayType()}cancelDrawing(){this.dialogRef.close()}confirm(e){this.confirmFlag=!0,this.labelFlag===Pr.Predefined?this.dialogRef.close():this.labelFlag===Pr.Custom?this.dialogRef.close({label:e}):this.labelFlag===Pr.Coordinates?this.dialogRef.close({label:this.currentCoordinates,measureUnit:this.coordinatesMeasureUnit}):this.olGeometryType===po.Polygon?this.polygonCheck===2?(this.labelFlag=[Pr.Length,Pr.Area],this.dialogRef.close({label:"P: "+this.currentLength+" "+hh[or.Meters]+`
`+this.languageService.translate.instant("igo.geo.draw.labelType.A")+this.currentArea+" "+Zp[Bo.SquareMeters],measureUnit:[this.lengthMeasureUnit,this.areaMeasureUnit]})):this.labelFlag===Pr.Length?this.dialogRef.close({label:"P: "+this.currentLength+" "+hh[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.dialogRef.close({label:this.currentArea+" "+Zp[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit}):this.labelFlag===Pr.Length?this.olGeometryType===po.Circle?this.dialogRef.close({label:"R: "+this.currentLength+" "+hh[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.olGeometryType===po.LineString&&this.dialogRef.close({label:this.currentLength+" "+hh[this.lengthMeasureUnit],measureUnit:this.lengthMeasureUnit}):this.labelFlag===Pr.Area&&this.dialogRef.close({label:this.currentArea+" "+Zp[this.areaMeasureUnit],measureUnit:this.areaMeasureUnit})}onLabelTypeChange(e,n){e!==Pr.Predefined&&e!==Pr.Custom&&this.olGeometryType===po.Polygon?(this.arrayBuiltInType.find(s=>s.value===e)?this.arrayBuiltInType.find(s=>s.value===e).checked=n:this.labelFlag=void 0,n?this.labelFlag=e:this.labelFlag=this.arrayBuiltInType.find(s=>s.checked)?.value):this.labelFlag=e,e===Pr.Predefined?this.olGeometryType===po.Point?(this.labelFlag=Pr.Coordinates,this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=x_.DecimalDegree):this.olGeometryType===po.LineString&&(this.labelFlag=Pr.Length,this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=or.Meters):e===Pr.Area?(this.currentArea=this.areaInMetersSquare,this.areaMeasureUnit=Bo.SquareMeters):e===Pr.Length?(this.currentLength=this.lengthInMeters,this.lengthMeasureUnit=or.Meters):this.labelFlag===Pr.Coordinates&&(this.currentCoordinates=this.coordinatesInDD,this.coordinatesMeasureUnit=x_.DecimalDegree);let o=[this.labelType.Length,this.labelType.Area];this.olGeometryType===po.Polygon&&o.includes(e)?n?this.polygonCheck+=1:this.polygonCheck-=1:this.polygonCheck=0}onChangeLengthUnit(e){this.lengthMeasureUnit=e,this.currentLength=np(Number(this.lengthInMeters),e).toFixed(2)}onChangeAreaUnit(e){this.areaMeasureUnit=e,this.currentArea=Xp(Number(this.areaInMetersSquare),e).toFixed(2)}onChangeCoordinateUnit(e){this.coordinatesMeasureUnit=e;let n=a3(this.longlatDD,e);this.currentCoordinates="("+n[1]+", "+n[0]+")"}buildArrayType(){for(let e of Object.values(Pr))e!==Pr.Custom&&e!==Pr.Predefined&&this.arrayBuiltInType.push({value:e,checked:this.selectOptions(e)||this.labelFlag===e||this.polygonCheck===2&&e!==Pr.Coordinates})}noLabelButton(){return this.labelFlag===Pr.Predefined||this.labelFlag===Pr.Custom&&this.labelLength===0?this.languageService.translate.instant("igo.geo.draw.noLabel"):"OK"}get customOrPredefined(){return this.labelFlag===Pr.Custom?Pr.Custom:Pr.Predefined}optionAvailable(e){switch(this.olGeometryType){case po.Point:return e!==Pr.Coordinates;case po.LineString:return e!==Pr.Length;case po.Polygon:return e===Pr.Coordinates;default:return!1}}get allLengthUnits(){return Object.values(or)}getLengthUnitEnum(e){return hh[e]}get allAreaUnits(){return Object.values(Bo)}get allCoordinatesUnits(){return Object.values(x_)}getAreaUnitEnum(e){return Zp[e]}getRadius(e){let n=sy(e);return Number(n/(2*Math.PI))}get lengthLabelT(){return this.olGeometryType===po.Polygon?this.languageService.translate.instant("igo.geo.measure.perimeter"):this.olGeometryType===po.Circle?this.languageService.translate.instant("igo.geo.search.coordinates.radius"):this.languageService.translate.instant("igo.geo.draw.labelType.Length")}getLabelLength(e){this.labelLength=e.length}selectOptions(e){if(this.olGeometryType===po.Point)return e===Pr.Coordinates;if(this.olGeometryType===po.LineString)return e===Pr.Length}getProperLengthLabel(e){return e===Pr.Length?this.olGeometryType===po.Polygon?this.languageService.translate.instant("igo.geo.measure.perimeter"):this.olGeometryType===po.Circle?this.languageService.translate.instant("igo.geo.search.coordinates.radius"):this.languageService.translate.instant("igo.geo.draw.labelType.Length"):this.languageService.translate.instant("igo.geo.draw.labelType."+e)}static \u0275fac=function(n){return new(n||r)(Ie(Di),Ie(Hc),Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-draw-popup-component"]],inputs:{confirmFlag:"confirmFlag",labelFlag:"labelFlag",coordinatesMeasureUnit:"coordinatesMeasureUnit",lengthMeasureUnit:"lengthMeasureUnit",areaMeasureUnit:"areaMeasureUnit"},standalone:!0,features:[lt],decls:5,vars:5,consts:[["input",""],["mat-dialog-title",""],[4,"ngIf"],["mat-dialog-content","",1,"geometry-type-toggle"],[1,"button-toggle-container"],[3,"change","value"],[3,"value"],["class","fields-container",4,"ngIf"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],[3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[3,"change","value","disabled","checked"],["class","mat-typography",3,"value","disabled","checked","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"change","value","disabled","checked"],[1,"fields-container"],[1,"readOnly-Input"],["matInput","","placeholder","(Latitude, Longitude)","readonly","",3,"value"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"placeholder","value"],[1,"input"],["matInput","","cdkFocusInitial","",3,"select","input","placeholder","value"]],template:function(n,o){n&1&&($(0,"h2",1),_e(1),le(2,"translate"),ee(),Pe(3,QMe,25,21,"ng-container",2)(4,JMe,26,23,"ng-container",2)),n&2&&(j(),Qe(" ",ce(2,3,"igo.geo.draw.popupTitle"),`
`),j(2),z("ngIf",o.labelFlag!==o.labelType.Custom),j(),z("ngIf",o.labelFlag===o.labelType.Custom))},dependencies:[id,Gt,pl,Ed,Gu,mu,wm,vm,bm,Li,hl,ac,jr,Gr,Mo,gn,Cn,ho,uo,Nn,Bn,Zc,Vt,co,Et,Tt],styles:[`[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%] ~ .mat-radio-button[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .readOnly-Input[_ngcontent-%COMP%]{width:200px!important}[_nghost-%COMP%]   .button-toggle-container[_ngcontent-%COMP%]{margin-bottom:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-form-field-infix{width:fit-content}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]     .mat-mdc-select-min-line{padding-right:24px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{position:sticky!important}[_nghost-%COMP%]   .coordinatesInputView[_ngcontent-%COMP%]{top:5em!important}[_nghost-%COMP%]   .mat-mdc-dialog-actions[_ngcontent-%COMP%]{display:flex!important;justify-content:flex-end}[_nghost-%COMP%]   .input[_ngcontent-%COMP%]{width:auto!important}[_nghost-%COMP%]   .mat-button-toggle-group[_ngcontent-%COMP%], [_nghost-%COMP%]   .mat-button-toggle[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin-right:10px}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}
/*# sourceMappingURL=draw-popup.component-E67ZZUSI.css.map */`]})}return r})();var Yee=(()=>{class r{svgIcon=EG;static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-draw-shorcuts"]],standalone:!0,features:[lt],decls:27,vars:13,consts:[[1,"shortcut","mat-typography"],[1,"shortcut-icon"],[3,"icon"],[1,"shortcuts-close"],["mat-raised-button","","mat-dialog-close","","color","primary"]],template:function(n,o){n&1&&($(0,"mat-dialog-content")(1,"div")(2,"span",0)(3,"mat-icon",1),_e(4,"keyboard_return"),ee(),_e(5),le(6,"translate"),ee()(),$(7,"div")(8,"span",0)(9,"mat-icon",1),_e(10,"keyboard_backspace"),ee(),_e(11),le(12,"translate"),ee()(),$(13,"div")(14,"span",0),ct(15,"igo-icon",2),_e(16),le(17,"translate"),ee()(),$(18,"div")(19,"span",0)(20,"mat-icon",1),_e(21,"space_bar"),ee(),_e(22),le(23,"translate"),ee()()(),$(24,"mat-dialog-actions",3)(25,"button",4),_e(26,"OK"),ee()()),n&2&&(j(5),bt(ce(6,5,"igo.geo.draw.finish")),j(6),bt(ce(12,7,"igo.geo.draw.undo")),j(4),z("icon",o.svgIcon),j(),Qe(" ",ce(17,9,"igo.geo.draw.abort")," "),j(6),bt(ce(23,11,"igo.geo.draw.move")))},dependencies:[pl,jt,$t,Zc,Vt,co,WA,Et,Tt,BA],styles:[`.shortcut[_ngcontent-%COMP%]{display:flex;align-items:center}.shortcut-icon[_ngcontent-%COMP%]{margin-right:10px}.shortcuts-close[_ngcontent-%COMP%]{display:flex;justify-content:center}
/*# sourceMappingURL=draw-shorcuts.component-7Q4HIN2C.css.map */`]})}return r})();var eIe=["selectedLayer"];function tIe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",7),ve("change",function(o){we(e);let s=ne();return xe(s.onToggleFreehandMode(o))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.freehandMode)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.draw.freehandMode")," ")}}function iIe(r,i){if(r&1&&($(0,"mat-option",4),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.measure."+e)," ")}}function rIe(r,i){if(r&1){let e=We();$(0,"div",24)(1,"mat-form-field",25),ct(2,"input",26),le(3,"translate"),ee(),$(4,"mat-form-field",27)(5,"mat-select",12),ve("selectionChange",function(o){we(e);let s=ne();return xe(s.onMeasureUnitChange(o.value))}),Pe(6,iIe,3,4,"mat-option",13),ee()()()}if(r&2){let e=ne();j(2),sr("placeholder",ce(3,5,"igo.geo.spatialFilter.radius")),z("formControl",e.radiusFormControl)("readonly",e.freehandMode),j(3),z("value",e.measureUnit),j(),z("ngForOf",e.measureUnits)}}function nIe(r,i){if(r&1&&($(0,"mat-option",4),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e.title," ")}}function oIe(r,i){if(r&1){let e=We();$(0,"button",28),le(1,"translate"),le(2,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.activeDrawingLayer.visible=!o.activeDrawingLayer.visible)}),$(3,"mat-icon"),_e(4),ee()()}if(r&2){let e=ne();z("color",e.activeDrawingLayer.visible?"primary":"default")("matTooltip",e.activeDrawingLayer.visible?ce(1,3,"igo.geo.layer.hideLayer"):ce(2,5,"igo.geo.layer.showLayer")),j(4),Qe(" ",e.activeDrawingLayer.visible?"visibility":"visibility_off"," ")}}function aIe(r,i){if(r&1){let e=We();$(0,"button",29),le(1,"translate"),le(2,"async"),ve("click",function(){we(e);let o=ne();return xe(o.deleteDrawings())}),$(3,"mat-icon"),_e(4,"delete"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.draw.delete"))("disabled",ce(2,4,e.selectedFeatures$).length===0)}}function sIe(r,i){if(r&1&&($(0,"div",33),ct(1,"img",34),ee()),r&2){let e=ne(2);j(),sr("src",e.icon,Rf)}}function lIe(r,i){if(r&1){let e=We();$(0,"mat-option",35),ve("click",function(){let o=we(e).$implicit,s=ne(2);return xe(s.onIconChange(o))}),$(1,"div",33),ct(2,"img",34),ee()()}if(r&2){let e=i.$implicit;z("value",e),j(2),sr("src",e,Rf)}}function cIe(r,i){if(r&1){let e=We();$(0,"mat-form-field")(1,"mat-label"),_e(2),le(3,"translate"),ee(),$(4,"mat-select")(5,"mat-select-trigger"),Pe(6,sIe,2,1,"div",30),ee(),$(7,"mat-option",31),ve("click",function(){we(e);let o=ne();return xe(o.onIconChange())}),_e(8),le(9,"translate"),ee(),Pe(10,lIe,3,2,"mat-option",32),ee()()}if(r&2){let e=ne();j(2),bt(ce(3,4,"igo.geo.draw.icon")),j(4),z("ngIf",e.icon),j(2),bt(ce(9,6,"igo.geo.draw.noIcon")),j(2),z("ngForOf",e.icons)}}function uIe(r,i){if(r&1){let e=We();$(0,"button",36),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.openStyleModalDialog())}),_e(2),le(3,"translate"),$(4,"mat-icon",37),_e(5,"palette "),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,3,"igo.geo.style.styleModalTooltipSelected")),j(2),Qe(" ",ce(3,5,"igo.geo.style.styleModal")," "),j(2),z("matBadge",e.selectedFeatures$.value.length)}}var dIe=(()=>{class r{languageService;formBuilder;drawStyleService;dialog;drawIconService;tableTemplate;geometryType=po;map;get stores(){return this._stores}set stores(e){this._stores=e}_stores=[];get drawControls(){return this._drawControls}set drawControls(e){this._drawControls=e}_drawControls=[];get activeDrawingLayer(){return this._activeDrawingLayer}set activeDrawingLayer(e){this._activeDrawingLayer=e}_activeDrawingLayer;activeLayerChange=new Ke;drawControlsEvent=new Ke;layersIDEvent=new Ke;fillColor;strokeColor;strokeWidth;fontSize;fontStyle;activeStore;layerCounterID=0;draw$=new ut({});activeDrawingLayerSource=new $a;activeDrawControl;drawEnd$$;drawSelect$$;selectedFeatures$=new ut([]);fillForm;strokeForm;drawControlIsDisabled=!0;drawControlIsActive=!1;labelsAreShown;freehandMode=!1;subscriptions$$=[];position="bottom";form;icons;icon;radiusFormControl=new zc(1e3);measureUnit=or.Meters;radiusFormControlChange$$=new Es;predefinedRadius$=new ut(void 0);radiusDrawEnd$=new ut(void 0);get measureUnits(){return[or.Meters,or.Kilometers]}numberOfDrawings;isCreatingNewLayer=!1;currGeometryType=this.geometryType.Point;select;constructor(e,n,o,s,l){this.languageService=e,this.formBuilder=n,this.drawStyleService=o,this.dialog=s,this.drawIconService=l,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,fixedHeader:!0,tableHeight:"auto",columns:[{name:"Drawing",title:this.languageService.translate.instant("igo.geo.draw.labels"),valueAccessor:h=>h.properties.draw},{name:"Edition",title:"",sort:!1,valueAccessor:h=>[{editMode:!1,icon:"edit",color:"primary",click:()=>{this.editLabelDrawing(h)},style:"mat-icon-button"}],renderer:xu.ButtonGroup}]},this.buildForm(),this.fillColor=this.drawStyleService.getFillColor(),this.strokeColor=this.drawStyleService.getStrokeColor(),this.strokeWidth=this.drawStyleService.getStrokeWidth(),this.labelsAreShown=this.drawStyleService.getLabelsAreShown(),this.icons=this.drawIconService.getIcons(),this.icon=this.drawStyleService.getIcon(),this.fontSize=this.drawStyleService.getFontSize(),this.fontStyle=this.drawStyleService.getFontStyle()}ngOnInit(){this.stores.length?(this.activeStore=this.stores.find(e=>e.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(e=>e[0]===this.activeDrawingLayer.id)[1],this.deactivateDrawControl(),this.allLayers.forEach(e=>{e.id!==this.activeDrawingLayer.id&&(e.opacity=0);let n=this.stores.find(o=>o.layer.id===e.id);this.subscriptions$$.push(n.stateView.manyBy$(o=>o.state.selected===!0).pipe(Ps()).subscribe(o=>{o.forEach(s=>{s.state.selected=!1})})),this.subscriptions$$.push(n.stateView.manyBy$(o=>o.state.selected===!0).pipe(Of(1)).subscribe(o=>{this.selectedFeatures$.next(o.map(s=>s.entity))}))}),this.onLayerChange(this.activeDrawingLayer)):(this.activeStore=new is([],{map:this.map}),this.initStore(),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.geometryType.Point),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.onLayerChange(this.activeDrawingLayer)),this.radiusFormControlChange$$=this.radiusFormControl.valueChanges.subscribe(e=>{this.activeDrawControl.ispredefinedRadius$.getValue()&&this.changeRadius(e)})}ngOnDestroy(){this.activeStore.count===0&&this.activeStore.map.layerController.remove(this.activeDrawingLayer),this.allLayers.forEach(e=>e.opacity=1),this.activeStore.state.updateAll({selected:!1}),this.deactivateDrawControl(),this.subscriptions$$.map(e=>e.unsubscribe()),this.radiusFormControlChange$$.unsubscribe()}createDrawControl(e,n,o){return new op({geometryType:void 0,drawingLayerSource:this.activeDrawingLayerSource,drawingLayerStyle:new oi({}),interactionStyle:bC(e,n,o)})}initStore(e,n){this.createLayer(e,n),this.subscriptions$$.push(this.activeStore.stateView.manyBy$(o=>o.state.selected===!0).pipe(Of(1)).subscribe(o=>{this.selectedFeatures$.next(o.map(s=>s.entity))}))}openStyleModalDialog(){setTimeout(()=>{let e=this.dialog.open(z8,{disableClose:!1,data:{features:this.selectedFeatures$.getValue(),icons:this.icons,icon:this.icon},autoFocus:!1});e.afterClosed().subscribe(n=>{e.componentInstance.confirmFlag&&(this.onFontChange(this.labelsAreShown,n.fontSize,n.fontStyle),this.onColorChange(this.labelsAreShown,!!this.icon,n.fillColor,n.strokeColor),this.onOffsetLabelChange(this.labelsAreShown,n.offsetX,n.offsetY))})},250)}openDrawDialog(e,n){setTimeout(()=>{let o=this.dialog.open(qee,{disableClose:!1,data:{olGeometry:e,map:this.map}});o.afterClosed().subscribe(s=>{o.componentInstance.confirmFlag?(this.updateLabelOfOlGeometry(e,s.label),this.updateLabelType(e,o.componentInstance.labelFlag),this.updateMeasureUnit(e,s.measureUnit),e instanceof gi||(this.updateFontSizeAndStyle(e,"15",Kp.Arial),this.updateFillAndStrokeColor(e,"rgba(255,255,255,0.4)","rgba(143,7,7,1)"),this.updateOffset(e,0,e instanceof Ii?-15:0)),n?this.onDrawEnd(e):this.onSelectDraw(e,s.label,[o.componentInstance.labelFlag,s.measureUnit]),this.updateHeightTable()):this.activeDrawingLayerSource.getFeatures().forEach(l=>{let h=l.getGeometry();e===h&&this.activeDrawingLayerSource.removeFeature(l)})})},250)}onDrawEnd(e,n){this.addFeatureToStore(e,n),this.clearLabelsOfOlGeometry(e),this.activeStore.layer.ol.getSource().refresh()}onModifyDraw(e){this.activeStore.all().forEach(o=>{let s=o.properties.id,l=e.ol_uid;if(s===l){if(o.properties.labelType===Pr.Coordinates){let h=a3([o.properties.longitude,o.properties.latitude],o.properties.measureUnit);this.updateLabelOfOlGeometry(e,"("+h[1]+", "+h[0]+")")}else if(o.properties.labelType===Pr.Length)if(e instanceof Tu){let h=Kd(e,1e4),p=np(this.getRadius(h),o.properties.measureUnit),m=hh[o.properties.measureUnit],f="R: "+p.toFixed(2).toString()+" "+m;this.updateLabelOfOlGeometry(e,f)}else{let h=u1(e,this.map.ol.getView().getProjection().getCode()),p=o.properties.measureUnit,m=hh[o.properties.measureUnit];h=np(h,p);let f=e instanceof on?"P: "+h.toFixed(2).toString()+" "+m:h.toFixed(2).toString()+" "+m;this.updateLabelOfOlGeometry(e,f)}else if(o.properties.labelType===Pr.Area)if(e instanceof Tu){let h=Kd(e,1e4),p=d1(h,this.map.ol.getView().getProjection().getCode()),m=Zp[o.properties.measureUnit],f=o.properties.measureUnit;p=Xp(p,f);let g=p.toFixed(2).toString()+" "+m;this.updateLabelOfOlGeometry(e,g)}else{let h=d1(e,this.map.ol.getView().getProjection().getCode()),p=o.properties.measureUnit,m=Zp[o.properties.measureUnit];h=Xp(h,p);let f=h.toFixed(2).toString()+" "+m;this.updateLabelOfOlGeometry(e,f)}else this.updateLabelOfOlGeometry(e,o.properties.draw);this.updateLabelType(e,o.properties.labelType),this.updateMeasureUnit(e,o.properties.measureUnit),this.updateFontSizeAndStyle(e,o.properties.fontStyle.split(" ")[0].replace("px",""),o.properties.fontStyle.substring(o.properties.fontStyle.indexOf(" ")+1)),this.updateFillAndStrokeColor(e,o.properties.drawingStyle.fill,o.properties.drawingStyle.stroke),this.updateOffset(e,o.properties.offsetX,o.properties.offsetY),this.replaceFeatureInStore(o,e)}})}onSelectDraw(e,n,o){let s=this.activeStore.all(),l=e.getGeometry();l.ol_uid=e.get("id");let h=JSON.stringify(l.getCoordinates()[0]);s.forEach(p=>{let m=JSON.stringify(p.geometry.coordinates[0]);if(h===m){let f=e.get("fontStyle").split(" ")[0].replace("px",""),g=e.get("fontStyle").substring(e.get("fontStyle").indexOf(" ")+1),y=e.get("drawingStyle").fill,_=e.get("drawingStyle").stroke,w=e.get("offsetX"),A=e.get("offsetY"),k=p.properties.rad?p.properties.rad:void 0;this.updateLabelOfOlGeometry(l,n),this.updateFontSizeAndStyle(l,f,g),this.updateFillAndStrokeColor(l,y,_),this.updateOffset(l,w,A),this.updateLabelType(l,o[0]),this.updateMeasureUnit(l,o[1]),this.replaceFeatureInStore(p,l,k)}})}addFeatureToStore(e,n,o){let s,l,h,p,m,f=o?o.properties.id:e.ol_uid,g=this.map.ol.getView().getProjection(),y=new Qr().writeGeometryObject(e,{featureProjection:g,dataProjection:g});if(e instanceof Tu||n)if(n)s=n;else{y.type="Point",y.coordinates=e.getCenter();let _=Sr([e.getFlatCoordinates()[2],e.getFlatCoordinates()[3]],g,"EPSG:4326");l=Sr([e.getFlatCoordinates()[0],e.getFlatCoordinates()[1]],g,"EPSG:4326"),p=l[0],m=l[1],s=b0(l,_),this.radiusFormControl.setValue(Math.round(s))}this.activeDrawControl.radiusDrawEnd$.getValue()&&(s=this.activeDrawControl.radiusDrawEnd$.getValue()),e instanceof Ii&&(h=Sr(e.getFlatCoordinates(),g,"EPSG:4326"),p=h[0],m=h[1]),this.activeStore.update({type:vr,geometry:y,projection:g.getCode(),properties:{id:f,draw:e.get("_label"),longitude:p||null,latitude:m||null,rad:s||null,fontStyle:e.get("fontStyle_"),drawingStyle:{fill:e.get("fillColor_"),stroke:e.get("strokeColor_")},offsetX:e.get("offsetX_"),offsetY:e.get("offsetY_"),labelType:e.get("labelType_"),measureUnit:e.get("measureUnit_")},meta:{id:f}}),this.activeStore.setLayerExtent(),this.activeDrawControl.predefinedRadius$.next(void 0),this.activeDrawControl.radiusDrawEnd$.next(void 0)}buildForm(){this.form=this.formBuilder.group({fill:[""],stroke:[""]})}setupLayer(e){setTimeout(()=>{let n=this.dialog.open(Hee,{disableClose:!1});n.afterClosed().subscribe(o=>{n.componentInstance.confirmFlag?(this.activeStore.state.updateAll({selected:!1}),this.activeStore=new is([],{map:this.map}),this.activeDrawingLayerSource=new $a,this.activeDrawingLayer.opacity=0,this.deactivateDrawControl(),this.initStore(o,e),this.activeDrawControl=this.createDrawControl(this.fillColor,this.strokeColor,this.strokeWidth),this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl(),this.stores.push(this.activeStore),this.drawControls.push([this.activeDrawingLayer.id,this.activeDrawControl]),this.drawControlsEvent.emit(this.drawControls),this.layersIDEvent.emit(this.activeDrawingLayer.id),this.isCreatingNewLayer=!1,this.labelsAreShown||this.onToggleLabels(),this.activeLayerChange.emit(this.activeDrawingLayer)):(this.select.value=this.activeDrawingLayer,this.select.selectionChange.emit(this.activeDrawingLayer))})},250)}editLabelDrawing(e){let n=ku(e,this.map.ol.getView().getProjection().getCode());this.openDrawDialog(n,!1)}openShorcutsDialog(){this.dialog.open(Yee)}deleteDrawings(){this.activeStore.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(e=>{this.activeDrawingLayerSource.getFeatures().forEach(n=>{let o=n.getGeometry();e.properties.id===o.ol_uid&&this.activeDrawingLayerSource.removeFeature(n)})}),this.updateHeightTable(),this.activeStore.setLayerExtent()}onToggleLabels(){this.drawStyleService.toggleLabelsAreShown(),this.labelsAreShown=!this.labelsAreShown,this.icon?this.elementStyle(this.labelsAreShown,!0):this.elementStyle(this.labelsAreShown,!1),this.createDrawControl()}onToggleDrawControl(e){e?this.toggleDrawControl():this.deactivateDrawControl()}onToggleFreehandMode(e){this.isCircle()&&!e.checked?(this.activeDrawControl.ispredefinedRadius$.next(!0),this.changeRadius(this.radiusFormControl.value)):(this.activeDrawControl.setOlInteractionStyle(bC(this.fillColor,this.strokeColor,this.strokeWidth)),this.activeDrawControl.ispredefinedRadius$.next(!1)),this.freehandMode=e.checked,this.activeDrawControl.freehand$.next(e.checked),this.toggleDrawControl()}onLayerChange(e){e?(this.activeStore.state.updateAll({selected:!1}),this.isCreatingNewLayer=!1,this.activeDrawingLayer.opacity=0,this.activeDrawingLayer=e,this.activeDrawingLayer.opacity=1,this.deactivateDrawControl(),this.labelsAreShown||this.onToggleLabels(),this.activeStore=this.stores.find(n=>n.layer.id===this.activeDrawingLayer.id),this.activeDrawControl=this.drawControls.find(n=>n[0]===this.activeDrawingLayer.id)[1],this.activeDrawingLayerSource=this.activeDrawControl.olDrawingLayerSource,this.activeDrawControl.setGeometryType(this.currGeometryType),this.toggleDrawControl()):this.setupLayer(!0),this.activeLayerChange.emit(this.activeDrawingLayer)}createLayer(e,n){for(let o of this.allLayers){let s=Number(o.id.replace("igo-draw-layer",""));this.layerCounterID=Math.max(s,this.layerCounterID)}this.activeDrawingLayer=new Fr({isIgoInternalLayer:!0,id:"igo-draw-layer"+ ++this.layerCounterID,title:n?e:this.languageService.translate.instant("igo.geo.draw.drawing"),zIndex:200,source:new kr,style:(o,s)=>this.drawStyleService.createIndividualElementStyle(o,s,this.labelsAreShown,o.get("fontStyle"),o.get("drawingStyle").fill,o.get("drawingStyle").stroke,o.get("offsetX"),o.get("offsetY"),this.map.projection,this.icon),showInLayerList:!0,exportable:!0,browsable:!1,workspace:{enabled:!1}}),bd(this.activeStore,this.activeDrawingLayer),Jm(this.activeStore,new vl({motion:Yi.None})),Cb(this.activeStore,new rs({map:this.map,motion:Yi.None,many:!0})),this.activeStore.layer.visible=!0,this.activeStore.source.ol.on("removefeature",o=>{let s=o.feature.getGeometry();this.clearLabelsOfOlGeometry(s)})}onColorChange(e,n,o,s){this.selectedFeatures$.value.length>0&&!n&&this.selectedFeatures$.value.forEach(l=>{let h=ku(l,this.map.ol.getView().getProjection().getCode());this.updateFillAndStrokeColor(h,o,s);let p=this.activeStore.all().find(m=>m.meta.id===h.getId());p.properties.drawingStyle.fill=h.get("fillColor_"),p.properties.drawingStyle.stroke=h.get("strokeColor_"),this.activeStore.update(p)}),this.elementStyle(e,n),this.createDrawControl()}onFontChange(e,n,o){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let l=ku(s,this.map.ol.getView().getProjection().getCode());this.updateFontSizeAndStyle(l,n,o);let h=this.activeStore.all().find(p=>p.meta.id===l.getId());h.properties.fontStyle=l.get("fontStyle_"),this.activeStore.update(h),l=this.activeStore.layer.ol.getSource().getFeatures().find(p=>p.getId()===h.meta.id),l.setProperties({fontStyle:h.properties.fontStyle}),l.changed()}),this.fontSize=n,this.fontStyle=o,this.drawStyleService.setFontSize(n),this.drawStyleService.setFontStyle(o),this.elementStyle(e))}onOffsetLabelChange(e,n,o){this.selectedFeatures$.value.length>0&&(this.selectedFeatures$.value.forEach(s=>{let l=ku(s,this.map.ol.getView().getProjection().getCode());this.updateOffset(l,n,o);let h=this.activeStore.all().find(p=>p.meta.id===l.getId());h.properties.offsetX=l.get("offsetX_"),h.properties.offsetY=l.get("offsetY_"),this.activeStore.update(h),l=this.activeStore.layer.ol.getSource().getFeatures().find(p=>p.getId()===h.meta.id),l.setProperties({offsetX:h.properties.offsetX,offsetY:h.properties.offsetY}),l.changed()}),this.elementStyle(e))}onIconChange(e){this.icon=e,this.drawStyleService.setIcon(this.icon),this.elementStyle(!0,this.icon)}onGeometryTypeChange(e){this.currGeometryType=e,this.activeDrawControl.setGeometryType(e),this.freehandMode?this.onToggleFreehandMode({checked:!0}):this.onToggleFreehandMode({checked:!1}),this.toggleDrawControl()}updateLabelOfOlGeometry(e,n){e.setProperties({_label:n},!0)}updateFontSizeAndStyle(e,n,o){e.setProperties({fontStyle_:`${n}px ${o}`},!0)}updateFillAndStrokeColor(e,n,o){e.setProperties({fillColor_:n,strokeColor_:o},!0)}updateOffset(e,n,o){e.setProperties({offsetX_:n,offsetY_:o},!0)}updateLabelType(e,n){e.setProperties({labelType_:n},!0)}updateMeasureUnit(e,n){e.setProperties({measureUnit_:n},!0)}getFeatureFontSize(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.split(" ")[0].replace("px",""):"15"}getFeatureFontStyle(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.fontStyle.substring(this.selectedFeatures$.value[0].properties.fontStyle.indexOf(" ")+1):Kp.Arial}getFeatureFillColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.fill:"rgba(255,255,255,0.4)"}getFeatureStrokeColor(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.drawingStyle.stroke:"rgba(143,7,7,1)"}getFeatureOffsetX(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetX:this.drawStyleService.getOffsetX()}getFeatureOffsetY(){return this.selectedFeatures$.value.length>0?this.selectedFeatures$.value[0].properties.offsetY:"0"}get allFontStyles(){return Object.values(Kp)}get allLayers(){return this.map.layerController.all.filter(e=>String(e.id).includes("igo-draw-layer"))}updateHeightTable(){this.numberOfDrawings=this.activeStore.count$.getValue(),this.numberOfDrawings>10?this.tableTemplate.tableHeight="35vh":this.tableTemplate.tableHeight="auto"}updateActiveLayer(){let e=this.allLayers.find(n=>n.title===this.activeDrawingLayer.title);return e||this.allLayers[0]}toggleDrawControl(){this.deactivateDrawControl(),this.activateDrawControl()}clearLabelsOfOlGeometry(e){yw(e).forEach(n=>{n&&n.getMap()&&this.map.ol.removeOverlay(n)})}replaceFeatureInStore(e,n,o){this.activeStore.delete(e),this.onDrawEnd(n,o)}deactivateDrawControl(){this.activeDrawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.activeDrawControl.setOlMap(void 0),this.drawControlIsActive=!1)}activateDrawControl(){this.drawControlIsDisabled=!1,this.drawControlIsActive=!0,this.drawEnd$$=this.activeDrawControl.end$.subscribe(e=>{this.openDrawDialog(e,!0)}),this.activeDrawControl.modify$.subscribe(e=>{this.onModifyDraw(e)}),this.drawSelect$$||(this.drawSelect$$=this.activeDrawControl.select$.subscribe(e=>{this.openDrawDialog(e,!1)})),this.activeDrawControl.setOlMap(this.map.ol,!0)}isPoint(){return this.activeDrawControl.getGeometryType()===this.geometryType.Point}isLineString(){return this.activeDrawControl.getGeometryType()===this.geometryType.LineString}isPolygon(){return this.activeDrawControl.getGeometryType()===this.geometryType.Polygon}isCircle(){return this.activeDrawControl.getGeometryType()===this.geometryType.Circle}changeRadius(e){let n;e?this.measureUnit===or.Meters?n=e:n=e*1e3:n=void 0;let o=(s,l)=>{let h=s.getGeometry(),p=Sr(h.getCoordinates(),this.map.projection,"EPSG:4326"),m=n/Math.cos(Math.PI/180*p[1])/l;return this.activeDrawControl.predefinedRadius$.next(n),new oi({image:new an({radius:m,stroke:new ui({width:1,color:"rgba(143,7,7,1)"}),fill:new hi({color:"rgba(255,255,255,0.4)"})})})};this.activeDrawControl.setOlInteractionStyle(o),this.toggleDrawControl()}onMeasureUnitChange(e){e!==this.measureUnit&&(this.measureUnit=e,this.measureUnit===or.Meters?this.radiusFormControl.setValue(this.radiusFormControl.value*1e3):this.radiusFormControl.setValue(this.radiusFormControl.value/1e3))}elementStyle(e,n){n?this.activeStore.layer.ol.setStyle((o,s)=>this.drawStyleService.createIndividualElementStyle(o,s,e,o.get("fontStyle"),o.get("drawingStyle").fill,o.get("drawingStyle").stroke,o.get("offsetX"),o.get("offsetY"),this.map.projection,this.icon)):this.activeStore.layer.ol.setStyle((o,s)=>this.drawStyleService.createIndividualElementStyle(o,s,e,o.get("fontStyle"),o.get("drawingStyle").fill,o.get("drawingStyle").stroke,o.get("offsetX"),o.get("offsetY"),this.map.projection))}getRadius(e){let n=sy(e);return Number(n/(2*Math.PI))}static \u0275fac=function(n){return new(n||r)(Ie(Di),Ie($c),Ie(EC),Ie(Yc),Ie(zJ))};static \u0275cmp=nt({type:r,selectors:[["igo-draw"]],viewQuery:function(n,o){if(n&1&&Ir(eIe,5),n&2){let s;bi(s=wi())&&(o.select=s.first)}},inputs:{map:"map",stores:"stores",drawControls:"drawControls",activeDrawingLayer:"activeDrawingLayer"},outputs:{activeLayerChange:"activeLayerChange",drawControlsEvent:"drawControlsEvent",layersIDEvent:"layersIDEvent",fillColor:"fillColor",strokeColor:"strokeColor",strokeWidth:"strokeWidth",fontSize:"fontSize",fontStyle:"fontStyle"},standalone:!0,features:[Xi([{provide:i3,useValue:{hideSingleSelectionIndicator:!0}}]),lt],decls:51,vars:47,consts:[["selectedLayer",""],["table",""],[1,"geometry-type-toggle","mat-typography"],[3,"change","value"],[3,"value"],[1,"draw-options","mat-typography"],[3,"change","disabled","checked","labelPosition"],[3,"change","checked","labelPosition"],[3,"checked","labelPosition","change",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"layer-select-container"],["subscriptSizing","dynamic",1,"layer-select"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],["id","createNewLayer"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["class","deleteBtn","mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],[1,"icon-options"],[4,"ngIf"],[1,"actions-container"],["mat-icon-button","","color","accent","disableRipple","true",3,"click"],["tooltip-position","below","matTooltipShowDelay","500",1,"shortcuts-icon",3,"matTooltip"],["mat-raised-button","","color","primary",3,"matTooltip","click",4,"ngIf"],[1,"radius-unit"],[1,"radius"],["matInput","","type","number","min","0",3,"placeholder","formControl","readonly"],[1,"unit-field"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],["mat-icon-button","","color","warn","tooltip-position","below","matTooltipShowDelay","500",1,"deleteBtn",3,"click","matTooltip","disabled"],["class","box",4,"ngIf"],["value","",3,"click"],[3,"value","click",4,"ngFor","ngForOf"],[1,"box"],[3,"src"],[3,"click","value"],["mat-raised-button","","color","primary",3,"click","matTooltip"],["aria-hidden","false","iconPositionEnd","","matBadgeColor","warn","matBadgeSize","medium",1,"style-icon",3,"matBadge"]],template:function(n,o){if(n&1){let s=We();$(0,"div")(1,"div",2)(2,"mat-button-toggle-group",3),ve("change",function(h){return we(s),xe(o.onGeometryTypeChange(h.value))}),$(3,"mat-button-toggle",4),_e(4),le(5,"translate"),ee(),$(6,"mat-button-toggle",4),_e(7),le(8,"translate"),ee(),$(9,"mat-button-toggle",4),_e(10),le(11,"translate"),ee(),$(12,"mat-button-toggle",4),_e(13),le(14,"translate"),ee()()(),$(15,"div",5)(16,"mat-slide-toggle",6),ve("change",function(h){return we(s),xe(o.onToggleDrawControl(h.checked))}),_e(17),le(18,"translate"),ee(),$(19,"mat-slide-toggle",7),ve("change",function(){return we(s),xe(o.onToggleLabels())}),_e(20),le(21,"translate"),ee(),Pe(22,tIe,3,5,"mat-slide-toggle",8)(23,rIe,7,7,"div",9),ee(),ct(24,"mat-divider"),$(25,"div",10)(26,"mat-form-field",11)(27,"mat-label"),_e(28),le(29,"translate"),ee(),$(30,"mat-select",12,0),ve("selectionChange",function(){we(s);let h=Xt(31);return xe(o.onLayerChange(h.value))}),Pe(32,nIe,2,2,"mat-option",13),$(33,"mat-option",14),_e(34),le(35,"translate"),ee()()(),Pe(36,oIe,5,7,"button",15),ee(),ct(37,"mat-divider"),$(38,"div"),Pe(39,aIe,5,6,"button",16),$(40,"div"),ct(41,"igo-entity-table",17,1),ee()(),$(43,"div",18),Pe(44,cIe,11,8,"mat-form-field",19),ee(),$(45,"div",20)(46,"button",21),ve("click",function(){return we(s),xe(o.openShorcutsDialog())}),$(47,"mat-icon",22),le(48,"translate"),_e(49,"keyboard "),ee()(),Pe(50,uIe,6,7,"button",23),ee()()}n&2&&(j(2),z("value",o.geometryType.Point),j(),z("value",o.geometryType.Point),j(),Qe(" ",ce(5,29,"igo.geo.draw."+o.geometryType.Point)," "),j(2),z("value",o.geometryType.LineString),j(),Qe(" ",ce(8,31,"igo.geo.draw."+o.geometryType.LineString)," "),j(2),z("value",o.geometryType.Polygon),j(),Qe(" ",ce(11,33,"igo.geo.draw."+o.geometryType.Polygon)," "),j(2),z("value",o.geometryType.Circle),j(),Qe(" ",ce(14,35,"igo.geo.draw."+o.geometryType.Circle)," "),j(3),z("disabled",o.drawControlIsDisabled)("checked",o.drawControlIsActive)("labelPosition","before"),j(),Qe(" ",ce(18,37,"igo.geo.draw.drawControl")," "),j(2),z("checked",o.labelsAreShown)("labelPosition","before"),j(),Qe(" ",ce(21,39,"igo.geo.draw.toggleMapTooltips")," "),j(2),z("ngIf",!o.isPoint()),j(),z("ngIf",o.isCircle()),j(5),bt(ce(29,41,"igo.geo.draw.layer.title")),j(2),z("value",o.updateActiveLayer()),j(2),z("ngForOf",o.allLayers),j(2),Qe(" ",ce(35,43,"igo.geo.draw.layer.createNewLayer")," "),j(2),z("ngIf",o.activeDrawingLayer),j(3),z("ngIf",o.activeStore.count$.getValue()>0),j(2),z("store",o.activeStore)("template",o.tableTemplate),j(3),z("ngIf",o.icons.length>=1),j(3),z("matTooltip",ce(48,45,"igo.geo.draw.shortcuts")),j(3),z("ngIf",o.selectedFeatures$.value.length))},dependencies:[Ed,Gu,mu,bl,js,Gt,jr,Gr,Mo,gn,Cn,Sn,os,c0,kn,iG,Sa,Th,ho,uo,UA,Nn,Li,Bn,dl,Uc,Vt,co,ci,Qt,ti,jt,$t,B1,xl,Md,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .geometry-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .draw-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .icon-options[_ngcontent-%COMP%]{margin:5px 5px 0}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:16px}[_nghost-%COMP%]   .edition-drawing[_ngcontent-%COMP%]{padding:10px 0}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%}[_nghost-%COMP%]   .deleteBtn[_ngcontent-%COMP%]{margin-left:12px}[_nghost-%COMP%]   .storeTable[_ngcontent-%COMP%]{height:auto!important}[_nghost-%COMP%]   .layer-select[_ngcontent-%COMP%]{flex:1;margin-right:8px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]{padding:10px}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:25%}[_nghost-%COMP%]   .input-button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{left:8px;bottom:10px}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:4px 8px}[_nghost-%COMP%]     igo-entity-table td:last-child{text-align:right!important}[_nghost-%COMP%]     igo-entity-table td:last-child button{margin:0%!important}[_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{margin:16px 8px}[_nghost-%COMP%]   .actions-container[_ngcontent-%COMP%], [_nghost-%COMP%]   .layer-select-container[_ngcontent-%COMP%]{display:flex;align-items:center}
/*# sourceMappingURL=draw.component-ZXMT2PMZ.css.map */`],data:{animation:[Gf("openClose",[Ud("open",Ls({opacity:1})),Ud("closed",Ls({opacity:0})),qu("open => closed",[Hu("600ms ease")]),qu("closed => open",[Hu("800ms ease")])])]},changeDetection:0})}return r})();var TC=(()=>{class r{transform(e,n,o=!1){let s;return Object.values(Bo).indexOf(n)>=0?s=Xp(e,n):Object.values(or).indexOf(n)>=0&&(s=np(e,n)),s&&S_(s,{decimal:1,unit:n,unitAbbr:o,locale:"fr"})}static \u0275fac=function(n){return new(n||r)};static \u0275pipe=CA({name:"measureFormat",type:r,pure:!0,standalone:!0})}return r})();var Sw=class{options;start$=new Si;end$=new Si;changes$=new Si;olMap;olOverlayLayer;olModifyInteraction;onModifyStartKey;onModifyEndKey;onModifyKey;olModifyInteractionIsActive=!1;olTranslateInteraction;onTranslateStartKey;onTranslateEndKey;onTranslateKey;olTranslateInteractionIsActive=!1;olDrawInteraction;onDrawStartKey;onDrawEndKey;onDrawKey;olDrawInteractionIsActive=!1;mousePosition;keyDown$$;drawKeyUp$$;drawKeyDown$$;removedOlInteractions=[];olLinearRingsLayer;olOuterGeometry;get active(){return this.olMap!==void 0}get olOverlaySource(){return this.olOverlayLayer.getSource()}get olLinearRingsSource(){return this.olLinearRingsLayer.getSource()}modify=!0;translate=!0;constructor(i){this.options=i,i.modify!==void 0&&(this.modify=i.modify),i.translate!==void 0&&(this.translate=i.translate),i.layer!==void 0?this.olOverlayLayer=i.layer:this.olOverlayLayer=this.createOlInnerOverlayLayer(),this.olLinearRingsLayer=this.createOlLinearRingsLayer()}setOlMap(i){if(i===void 0){this.clearOlInnerOverlaySource(),this.removeOlInnerOverlayLayer(),this.removeOlModifyInteraction(),this.removeOlTranslateInteraction(),this.removeOlDrawInteraction(),this.olMap=i;return}this.olMap=i,this.addOlInnerOverlayLayer(),this.modify===!0&&this.addOlDrawInteraction(),this.translate===!0&&(this.addOlTranslateInteraction(),this.activateTranslateInteraction()),this.modify===!0&&(this.addOlModifyInteraction(),this.activateModifyInteraction())}getSource(){return this.olOverlaySource}setOlGeometry(i){let e=new gi({geometry:i});this.olOverlaySource.clear(),this.olOverlaySource.addFeature(e)}createOlInnerOverlayLayer(){return new fc({source:this.options.source?this.options.source:new $a,style:this.options.layerStyle,zIndex:500})}addOlInnerOverlayLayer(){this.options.layer===void 0&&this.olMap.addLayer(this.olOverlayLayer)}removeOlInnerOverlayLayer(){this.options.layer===void 0&&this.olMap!==void 0&&this.olMap.removeLayer(this.olOverlayLayer)}clearOlInnerOverlaySource(){this.options.layer===void 0&&this.options.source===void 0&&this.olOverlaySource.clear(!0)}createOlLinearRingsLayer(){return new fc({source:new $a,style:E8(),zIndex:500})}addOlLinearRingsLayer(){this.olMap.addLayer(this.olLinearRingsLayer)}removeOlLinearRingsLayer(){this.olMap.removeLayer(this.olLinearRingsLayer)}clearOlLinearRingsSource(){this.olLinearRingsSource.clear(!0)}addOlModifyInteraction(){let i=new Db({source:this.olOverlaySource,style:this.options.drawStyle});this.olModifyInteraction=i}removeOlModifyInteraction(){this.olModifyInteraction!==void 0&&(this.deactivateModifyInteraction(),this.olModifyInteraction=void 0)}activateModifyInteraction(){this.olModifyInteractionIsActive!==!0&&(this.olModifyInteractionIsActive=!0,this.onModifyStartKey=this.olModifyInteraction.on("modifystart",i=>this.onModifyStart(i)),this.onModifyEndKey=this.olModifyInteraction.on("modifyend",i=>this.onModifyEnd(i)),this.olMap.addInteraction(this.olModifyInteraction))}deactivateModifyInteraction(){this.olModifyInteractionIsActive!==!1&&(this.olModifyInteractionIsActive=!1,io([this.onModifyStartKey,this.onModifyEndKey,this.onModifyKey]),this.olMap!==void 0&&this.olMap.removeInteraction(this.olModifyInteraction))}onModifyStart(i){let e=i.features.item(0).getGeometry();this.start$.next(e),this.onModifyKey=e.on("change",n=>{this.mousePosition=xC(n),this.changes$.next(n.target)}),this.subscribeToKeyDown()}onModifyEnd(i){io(this.onModifyKey),this.end$.next(i.features.item(0).getGeometry()),this.unsubscribeToKeyDown()}subscribeToKeyDown(){this.keyDown$$=jo(document,"keydown").subscribe(i=>{if(i.key===" "){this.olMap.getView().animate({center:this.mousePosition,duration:0});return}})}unsubscribeToKeyDown(){this.keyDown$$!==void 0&&this.keyDown$$.unsubscribe()}addOlTranslateInteraction(){let i=new g2({layers:[this.olOverlayLayer]});this.olTranslateInteraction=i}removeOlTranslateInteraction(){this.olTranslateInteraction!==void 0&&(this.deactivateTranslateInteraction(),this.olTranslateInteraction=void 0)}activateTranslateInteraction(){this.olTranslateInteractionIsActive!==!0&&(this.olTranslateInteractionIsActive=!0,this.onTranslateStartKey=this.olTranslateInteraction.on("translatestart",i=>this.onTranslateStart(i)),this.onTranslateEndKey=this.olTranslateInteraction.on("translateend",i=>this.onTranslateEnd(i)),this.olMap.addInteraction(this.olTranslateInteraction))}deactivateTranslateInteraction(){this.olTranslateInteractionIsActive!==!1&&(this.olTranslateInteractionIsActive=!1,io([this.onTranslateStartKey,this.onTranslateEndKey,this.onTranslateKey]),this.olMap!==void 0&&this.olMap.removeInteraction(this.olTranslateInteraction))}onTranslateStart(i){let e=i.features.item(0).getGeometry();this.start$.next(e)}onTranslateEnd(i){io(this.onTranslateKey),this.end$.next(i.features.item(0).getGeometry())}addOlDrawInteraction(){let i=new Vy({type:"Polygon",source:this.olLinearRingsSource,stopClick:!0,style:E8(),condition:e=>(this.olOuterGeometry||this.getOlGeometry()).intersectsCoordinate(e.coordinate)});this.olDrawInteraction=i,this.subscribeToDrawKeyDown()}subscribeToDrawKeyDown(){this.drawKeyDown$$=jo(document,"keydown").subscribe(i=>{if(i.key!=="Control")return;this.unsubscribeToDrawKeyDown();let e=this.getOlGeometry();!e||!(e instanceof on)||(this.subscribeToDrawKeyUp(),this.deactivateModifyInteraction(),this.deactivateTranslateInteraction(),this.activateDrawInteraction())})}subscribeToDrawKeyUp(){this.drawKeyUp$$=jo(document,"keyup").subscribe(i=>{i.key==="Control"&&(this.unsubscribeToDrawKeyUp(),this.unsubscribeToKeyDown(),this.deactivateDrawInteraction(),this.activateModifyInteraction(),this.translate===!0&&this.activateTranslateInteraction(),this.subscribeToDrawKeyDown(),this.olOuterGeometry=void 0,this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()))})}unsubscribeToDrawKeyDown(){this.drawKeyDown$$!==void 0&&this.drawKeyDown$$.unsubscribe()}unsubscribeToDrawKeyUp(){this.drawKeyUp$$!==void 0&&this.drawKeyUp$$.unsubscribe()}removeOlDrawInteraction(){this.olDrawInteraction!==void 0&&(this.unsubscribeToKeyDown(),this.unsubscribeToDrawKeyUp(),this.unsubscribeToDrawKeyDown(),this.deactivateDrawInteraction(),this.clearOlLinearRingsSource(),this.olDrawInteraction=void 0)}activateDrawInteraction(){this.olDrawInteractionIsActive!==!0&&(this.clearOlLinearRingsSource(),this.addOlLinearRingsLayer(),this.olMap.getInteractions().forEach(i=>{i instanceof xb&&(this.olMap.removeInteraction(i),this.removedOlInteractions.push(i))}),this.olDrawInteractionIsActive=!0,this.onDrawStartKey=this.olDrawInteraction.on("drawstart",i=>this.onDrawStart(i)),this.onDrawEndKey=this.olDrawInteraction.on("drawend",i=>this.onDrawEnd(i)),this.olMap.addInteraction(this.olDrawInteraction))}deactivateDrawInteraction(){this.olDrawInteractionIsActive!==!1&&(this.removeOlLinearRingsLayer(),this.removedOlInteractions.forEach(i=>{this.olMap.addInteraction(i)}),this.removedOlInteractions=[],this.olDrawInteractionIsActive=!1,io([this.onDrawStartKey,this.onDrawEndKey,this.onDrawKey]),this.olMap!==void 0&&this.olMap.removeInteraction(this.olDrawInteraction))}onDrawStart(i){let e=i.feature.getGeometry();this.olOuterGeometry=this.getOlGeometry().clone();let n=e.getLinearRing().getCoordinates();this.addLinearRingToOlGeometry(n),this.start$.next(this.getOlGeometry()),this.onDrawKey=e.on("change",o=>{this.mousePosition=xC(o);let l=o.target.getLinearRing(0).getCoordinates();this.updateLinearRingOfOlGeometry(l),this.changes$.next(this.getOlGeometry())}),this.subscribeToKeyDown()}onDrawEnd(i){io(this.onDrawKey),this.olOuterGeometry=void 0;let e=i.feature.getGeometry().getLinearRing().getCoordinates();this.updateLinearRingOfOlGeometry(e),this.clearOlLinearRingsSource(),this.end$.next(this.getOlGeometry()),this.unsubscribeToKeyDown()}addLinearRingToOlGeometry(i){let e=this.getOlGeometry(),n=new Om(i);yee(e,n)}updateLinearRingOfOlGeometry(i){let e=this.getOlGeometry(),o=e.getLinearRings().slice(0,-1).map(s=>s.getCoordinates());o.push(i),e.setCoordinates(o)}getOlGeometry(){let i=this.olOverlaySource.getFeatures();return i.length>0?i[0].getGeometry():void 0}};function hIe(r,i){if(r&1&&($(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),_e(4),le(5,"translate"),ee()()(),$(6,"tbody")(7,"tr")(8,"td"),_e(9),le(10,"measureFormat"),ee(),$(11,"td"),_e(12),le(13,"translate"),ee()(),$(14,"tr")(15,"td"),_e(16),le(17,"measureFormat"),ee(),$(18,"td"),_e(19),le(20,"translate"),ee()(),$(21,"tr")(22,"td"),_e(23),le(24,"measureFormat"),ee(),$(25,"td"),_e(26),le(27,"translate"),ee()(),$(28,"tr")(29,"td"),_e(30),le(31,"measureFormat"),ee(),$(32,"td"),_e(33),le(34,"translate"),ee()()()()),r&2){let e=ne();j(4),Qe(" ",ce(5,9,"igo.geo.measure.dialog.length.title")," "),j(5),bt(Ao(10,11,e.data.length,e.measureLengthUnit.Meters)),j(3),bt(ce(13,14,"igo.geo.measure.dialog.lengthInMeters")),j(4),Qe(" ",Ao(17,16,e.data.length,e.measureLengthUnit.Kilometers)," "),j(3),bt(ce(20,19,"igo.geo.measure.dialog.lengthInKilometers")),j(4),bt(Ao(24,21,e.data.length,e.measureLengthUnit.Miles)),j(3),bt(ce(27,24,"igo.geo.measure.dialog.lengthInMiles")),j(4),bt(Ao(31,26,e.data.length,e.measureLengthUnit.Feet)),j(3),bt(ce(34,29,"igo.geo.measure.dialog.lengthInFeet"))}}function pIe(r,i){if(r&1&&($(0,"table",3)(1,"thead")(2,"tr")(3,"th",4),_e(4),le(5,"translate"),ee()()(),$(6,"tbody")(7,"tr")(8,"td"),_e(9),le(10,"measureFormat"),ee(),$(11,"td"),_e(12),le(13,"translate"),ee()(),$(14,"tr")(15,"td"),_e(16),le(17,"measureFormat"),ee(),$(18,"td"),_e(19),le(20,"translate"),ee()(),$(21,"tr")(22,"td"),_e(23),le(24,"measureFormat"),ee(),$(25,"td"),_e(26),le(27,"translate"),ee()(),$(28,"tr")(29,"td"),_e(30),le(31,"measureFormat"),ee(),$(32,"td"),_e(33),le(34,"translate"),ee()(),$(35,"tr")(36,"td"),_e(37),le(38,"measureFormat"),ee(),$(39,"td"),_e(40),le(41,"translate"),ee()(),$(42,"tr")(43,"td"),_e(44),le(45,"translate"),ee(),$(46,"td"),_e(47),le(48,"measureFormat"),ee()()()()),r&2){let e=ne();j(4),Qe(" ",ce(5,13,"igo.geo.measure.dialog.area.title")," "),j(5),bt(Ao(10,15,e.data.area,e.measureAreaUnit.SquareMeters)),j(3),bt(ce(13,18,"igo.geo.measure.dialog.areaInSquareMeters")),j(4),Qe(" ",Ao(17,20,e.data.area,e.measureAreaUnit.SquareKilometers)," "),j(3),Qe(" ",ce(20,23,"igo.geo.measure.dialog.areaInSquareKilometers")," "),j(4),bt(Ao(24,25,e.data.area,e.measureAreaUnit.SquareMiles)),j(3),bt(ce(27,28,"igo.geo.measure.dialog.areaInSquareMiles")),j(4),bt(Ao(31,30,e.data.area,e.measureAreaUnit.Acres)),j(3),bt(ce(34,33,"igo.geo.measure.dialog.areaInAcres")),j(4),bt(Ao(38,35,e.data.area,e.measureAreaUnit.Hectares)),j(3),bt(ce(41,38,"igo.geo.measure.dialog.areaInHectares")),j(4),bt(ce(45,40,"igo.geo.measure.dialog.perimeterInMeters")),j(3),bt(Ao(48,42,e.data.perimeter,e.measureLengthUnit.Meters))}}var Zee=(()=>{class r{dialogRef;data;measureAreaUnit=Bo;measureLengthUnit=or;constructor(e,n){this.dialogRef=e,this.data=n}onNoClick(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||r)(Ie(Hc),Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-measurer-dialog"]],standalone:!0,features:[lt],decls:6,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],["colspan","2"]],template:function(n,o){n&1&&($(0,"h3",0),_e(1),le(2,"translate"),ee(),$(3,"div",1),Pe(4,hIe,35,31,"table",2)(5,pIe,49,45,"table",2),ee()),n&2&&(j(),bt(ce(2,3,"igo.geo.measure.dialog.title")),j(3),z("ngIf",o.data.length>0),j(),z("ngIf",o.data.area>0))},dependencies:[id,pl,Gt,Et,Tt,TC],styles:[`[_nghost-%COMP%]{font-family:Roboto,Helvetica Neue,sans-serif}h3[_ngcontent-%COMP%]{text-align:center;margin:0}table[_ngcontent-%COMP%]{width:100%;padding:10px}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:last-child{padding-left:10px}
/*# sourceMappingURL=measurer-dialog.component-U7JVXGYA.css.map */`]})}return r})();function mIe(r,i){if(r&1&&($(0,"mat-option",5),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.measure."+e)," ")}}var Xee=(()=>{class r{measure$=new ut(void 0);measure$$;measureType;measureUnit;set measure(e){this.measure$.next(e)}get measure(){return this.measure$.value}set auto(e){this.toggleAutoUnit(e)}get auto(){return this._auto}_auto=!1;placeholder;measureUnitChange=new Ke;get measureUnits(){return this.measureType===dh.Area?Object.values(Bo):Object.values(or)}ngOnDestroy(){this.toggleAutoUnit(!1)}onMeasureUnitChange(e){this.measureUnit=e,this.measureUnitChange.emit(e)}toggleAutoUnit(e){this.measure$$!==void 0&&this.measure$$.unsubscribe(),e===!0&&(this.measure$$=this.measure$.subscribe(n=>{this.computeBestMeasureUnit(n)})),this._auto=e}computeBestMeasureUnit(e){let n=this.measureUnit;this.measureType===dh.Area?n=WJ(e):this.measureType===dh.Length&&(n=$J(e)),n!==this.measureUnit&&this.onMeasureUnitChange(n)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-measurer-item"]],inputs:{measureType:"measureType",measureUnit:"measureUnit",measure:"measure",auto:"auto",placeholder:"placeholder"},outputs:{measureUnitChange:"measureUnitChange"},standalone:!0,features:[lt],decls:9,vars:12,consts:[["floatLabel","always",1,"measure-field"],["matInput","",3,"disabled","readonly","value"],[1,"unit-field"],[3,"selectionChange","value","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,o){n&1&&($(0,"mat-form-field",0)(1,"mat-label"),_e(2),ee(),ct(3,"input",1),le(4,"async"),le(5,"measureFormat"),ee(),$(6,"mat-form-field",2)(7,"mat-select",3),ve("selectionChange",function(l){return o.onMeasureUnitChange(l.value)}),Pe(8,mIe,3,4,"mat-option",4),ee()()),n&2&&(j(2),bt(o.placeholder),j(),z("disabled",!0)("readonly",!0)("value",Ao(5,9,ce(4,7,o.measure$)||0,o.measureUnit)),j(4),z("value",o.measureUnit)("disabled",o.auto),j(),z("ngForOf",o.measureUnits))},dependencies:[jr,Gr,Mo,gn,Cn,ho,uo,Nn,Li,Bn,Ei,Et,Tt,TC],styles:[`[_nghost-%COMP%]{display:flex;width:100%;padding:5px 10px}[_nghost-%COMP%]   .measure-field[_ngcontent-%COMP%]{pointer-events:none;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{margin-left:8px;flex:1}[_nghost-%COMP%]     mat-form-field .mat-mdc-form-field-subscript-wrapper{display:none}
/*# sourceMappingURL=measurer-item.component-3ABZTNTA.css.map */`],changeDetection:0})}return r})();var fIe=["table"];function gIe(r,i){r&1&&ct(0,"mat-divider")}function _Ie(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",8),ve("change",function(o){we(e);let s=ne();return xe(s.onToggleDisplayLines(o.checked))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.displayLines)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.measure.toggleDisplayLines")," ")}}function yIe(r,i){r&1&&ct(0,"mat-divider")}function vIe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",8),ve("change",function(o){we(e);let s=ne();return xe(s.onToggleDisplayDistance(o.checked))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.displayDistance)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.measure.toggleDisplayDistance")," ")}}function bIe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",8),ve("change",function(o){we(e);let s=ne();return xe(s.onToggleDisplayAreas(o.checked))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.displayAreas)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.measure.toggleDisplayAreas")," ")}}function wIe(r,i){r&1&&ct(0,"mat-divider")}function xIe(r,i){if(r&1){let e=We();$(0,"igo-measurer-item",14),le(1,"translate"),ve("measureUnitChange",function(o){we(e);let s=ne(2);return xe(s.onLengthUnitChange(o))}),ee()}if(r&2){let e=ne().ngIf,n=ne();z("measureType",n.measureType.Length)("measureUnit",n.activeLengthUnit)("measure",e.length)("auto",n.measureUnitsAuto)("placeholder",ce(1,5,n.activeMeasureType===n.measureType.Area?"igo.geo.measure.perimeter":"igo.geo.measure.length"))}}function SIe(r,i){if(r&1){let e=We();$(0,"igo-measurer-item",14),le(1,"translate"),ve("measureUnitChange",function(o){we(e);let s=ne(2);return xe(s.onAreaUnitChange(o))}),ee()}if(r&2){let e=ne().ngIf,n=ne();z("measureType",n.measureType.Area)("measureUnit",n.activeAreaUnit)("measure",e.area)("auto",n.measureUnitsAuto)("placeholder",ce(1,5,"igo.geo.measure.area"))}}function CIe(r,i){if(r&1&&(Dr(0),Pe(1,xIe,2,7,"igo-measurer-item",13)(2,SIe,2,7,"igo-measurer-item",13),Rr()),r&2){let e=ne();j(),z("ngIf",e.activeMeasureType===e.measureType.Length||e.activeMeasureType===e.measureType.Area),j(),z("ngIf",e.activeMeasureType===e.measureType.Area)}}function AIe(r,i){r&1&&ct(0,"mat-divider")}function MIe(r,i){if(r&1){let e=We();$(0,"button",15),le(1,"translate"),le(2,"async"),ve("click",function(){we(e);let o=ne();return xe(o.onCalculateClick())}),$(3,"mat-icon"),_e(4,"calculate"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.measure.actionbar.calculate.tooltip"))("disabled",ce(2,4,e.selectedFeatures$).length===0)}}function IIe(r,i){if(r&1){let e=We();$(0,"button",16),le(1,"translate"),le(2,"async"),ve("click",function(){we(e);let o=ne();return xe(o.onDeleteClick())}),$(3,"mat-icon"),_e(4,"delete"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.measure.actionbar.delete.tooltip"))("disabled",ce(2,4,e.selectedFeatures$).length===0)}}var Kee=(()=>{class r{languageService;dialog;storageService;document;tableTemplate;subscriptions$$=[];measureType=dh;measureAreaUnit=Bo;measureLengthUnit=or;measureUnitsAuto=!1;displayDistance=!0;displayLines=!0;displayAreas=!0;hasLine$=new ut(!1);hasArea$=new ut(!1);measure$=new ut({});selectedFeatures$=new ut([]);showTooltips=!0;drawControlIsDisabled=!0;drawLineControl;drawPolygonControl;modifyControl;activeOlGeometry;activeLengthUnit=or.Meters;activeAreaUnit=Bo.SquareMeters;onFeatureAddedKey;onFeatureRemovedKey;activeDrawControl;drawStart$$;drawEnd$$;drawChanges$$;modifyStart$$;modifyEnd$$;modifyChanges$$;selectedFeatures$$;olDrawSource=new $a;map;store;set activeMeasureType(e){this.setActiveMeasureType(e)}get activeMeasureType(){return this._activeMeasureType}_activeMeasureType;minSegmentLength=10;table;get drawControlIsActive(){return this.activeDrawControl!==void 0}get projection(){return this.map.ol.getView().getProjection().getCode()}constructor(e,n,o,s){this.languageService=e,this.dialog=n,this.storageService=o,this.document=s,this.tableTemplate={selection:!0,selectMany:!0,selectionCheckbox:!0,sort:!0,columns:[{name:"length",title:this.languageService.translate.instant("igo.geo.measure.lengthHeader"),valueAccessor:l=>{let h=this.activeLengthUnit,p=np(l.properties.measure.length,h);return S_(p,{decimal:1,unit:h,unitAbbr:!1,locale:"fr"})}},{name:"area",title:this.languageService.translate.instant("igo.geo.measure.areaHeader"),valueAccessor:l=>{let h=this.activeAreaUnit,p=Xp(l.properties.measure.area,h);return p?S_(p,{decimal:1,unit:h,unitAbbr:!1,locale:"fr"}):""}}]}}ngOnInit(){this.getSavedUnits(),this.initStore(),this.createDrawLineControl(),this.createDrawPolygonControl(),this.createModifyControl(),this.toggleDrawControl(),this.updateTooltipsOfOlSource(this.store.source.ol),this.checkDistanceAreaToggle(),this.setActiveMeasureType(dh.Length)}ngOnDestroy(){this.store.count===0&&this.store.map.layerController.remove(this.store.layer),this.setActiveMeasureType(void 0),this.deactivateModifyControl(),this.freezeStore(),this.subscriptions$$.map(e=>e.unsubscribe())}onMeasureTypeChange(e){this.activeMeasureType=e}onToggleDrawControl(e){e===!0?this.toggleDrawControl():this.deactivateDrawControl()}onToggleMeasureUnitsAuto(e){this.measureUnitsAuto=e}onToggleDisplayDistance(e){this.displayDistance=e,this.onDisplayDistance(),this.storageService.set("distanceToggle",e,gm.SESSION)}onToggleDisplayLines(e){this.displayLines=e,this.onDisplayLines(),this.storageService.set("linesToggle",e,gm.SESSION)}onToggleDisplayAreas(e){this.displayAreas=e,this.onDisplayAreas(),this.storageService.set("areasToggle",e,gm.SESSION)}checkDistanceAreaToggle(){this.storageService.get("distanceToggle")===!1&&(this.displayDistance=!1),this.storageService.get("linesToggle")===!1&&(this.displayLines=!1),this.storageService.get("areasToggle")===!1&&(this.displayAreas=!1)}onDisplayDistance(){let e=this.document.getElementsByClassName("igo-map-tooltip-measure-polygone-segments");this.displayDistance?Array.from(e).map(n=>n.classList.remove("igo-map-tooltip-hidden")):Array.from(e).map(n=>n.classList.add("igo-map-tooltip-hidden"))}onDisplayLines(){let e=this.document.getElementsByClassName("igo-map-tooltip-measure-line-segments");this.displayLines?Array.from(e).map(n=>{n.classList.remove("igo-map-tooltip-hidden")}):Array.from(e).map(n=>{n.classList.add("igo-map-tooltip-hidden")})}onDisplayAreas(){let e=this.document.getElementsByClassName("igo-map-tooltip-measure-area");this.displayAreas?Array.from(e).map(n=>n.classList.remove("igo-map-tooltip-hidden")):Array.from(e).map(n=>n.classList.add("igo-map-tooltip-hidden"))}onLengthUnitChange(e){this.activeLengthUnit=e,this.saveCurrentUnits(),this.refreshTableAndTooltip()}onAreaUnitChange(e){this.activeAreaUnit=e,this.saveCurrentUnits(),this.refreshTableAndTooltip()}refreshTableAndTooltip(){this.store.stateView.clear(),this.updateTooltipsOfOlSource(this.store.source.ol),this.activeOlGeometry!==void 0&&this.updateTooltipsOfOlGeometry(this.activeOlGeometry)}onCalculateClick(){let e=this.selectedFeatures$.value,n=e.reduce((l,h)=>l+h.properties.measure.area||0,0),o=e.reduce((l,h)=>h.geometry.type==="Polygon"?l:l+h.properties.measure.length||0,0),s=e.reduce((l,h)=>h.geometry.type==="LineString"?l:l+h.properties.measure.length||0,0);this.openDialog({area:n,length:o,perimeter:s})}onDeleteClick(){this.store.deleteMany(this.selectedFeatures$.value),this.selectedFeatures$.value.forEach(e=>{this.olDrawSource.getFeatures().forEach(n=>{let o=n.getGeometry();e.properties.id===o.ol_uid&&this.olDrawSource.removeFeature(n)})})}onModifyClick(){if(this.selectedFeatures$.value.length===1)if(this.modifyControl.active===!0)this.deactivateModifyControl(),this.toggleDrawControl();else{let e=this.selectedFeatures$.value[0],o=this.store.layer.ol.getSource().getFeatures().find(s=>s.get("id")===e.properties.id);if(o!==void 0){this.deactivateDrawControl(),this.activateModifyControl();let s=o.getGeometry();this.clearTooltipsOfOlGeometry(s),this.modifyControl.setOlGeometry(s)}}}openDialog(e){this.dialog.open(Zee,{data:e})}initStore(){let e=this.store,n=new Fr({title:this.languageService.translate.instant("igo.geo.measure.layerTitle"),isIgoInternalLayer:!0,id:`igo-measures-${rn()}`,zIndex:200,source:new kr,style:HJ(),showInLayerList:!0,exportable:!0,visible:!0,browsable:!1,workspace:{enabled:!1}});n=bd(e,n),n.visible$.subscribe(o=>{let s=this.document.getElementsByClassName("igo-map-tooltip-measure");o?Array.from(s).map(l=>l.classList.remove("igo-map-tooltip-measure-by-display")):Array.from(s).map(l=>l.classList.add("igo-map-tooltip-measure-by-display"))}),Jm(e),Cb(e,new rs({map:this.map,many:!0})),this.onFeatureAddedKey=e.source.ol.on("addfeature",o=>{let s=o.feature,l=s.getGeometry();this.updateMeasureOfOlGeometry(l,s.get("measure")),this.onDisplayDistance(),this.onDisplayLines(),this.onDisplayAreas()}),this.onFeatureRemovedKey=e.source.ol.on("removefeature",o=>{let s=o.feature.getGeometry();this.clearTooltipsOfOlGeometry(s)}),this.selectedFeatures$$=e.stateView.manyBy$(o=>o.state.selected===!0).pipe(Of(1)).subscribe(o=>{this.modifyControl.active===!0&&this.deactivateModifyControl(),this.selectedFeatures$.next(o.map(s=>s.entity))}),this.subscriptions$$.push(this.store.entities$.subscribe(o=>{o.find(s=>s.geometry.type==="Polygon")?this.hasArea$.next(!0):this.hasArea$.next(!1),o.find(s=>s.geometry.type==="LineString")?this.hasLine$.next(!0):this.hasLine$.next(!1)}))}freezeStore(){let e=this.store;this.selectedFeatures$$.unsubscribe(),io(this.onFeatureAddedKey),io(this.onFeatureRemovedKey),e.deactivateStrategyOfType(vl),e.deactivateStrategyOfType(rs)}createDrawLineControl(){this.drawLineControl=new op({geometryType:"LineString",drawingLayerSource:this.olDrawSource,interactionStyle:n3(),drawingLayerStyle:new oi({})})}createDrawPolygonControl(){this.drawPolygonControl=new op({geometryType:"Polygon",drawingLayerSource:this.olDrawSource,interactionStyle:n3(),drawingLayerStyle:new oi({})})}createModifyControl(){this.modifyControl=new Sw({source:this.olDrawSource,drawStyle:n3(),layerStyle:new oi({})})}toggleDrawControl(){this.deactivateDrawControl(),this.activeMeasureType===dh.Length?this.activateDrawControl(this.drawLineControl):this.activeMeasureType===dh.Area&&this.activateDrawControl(this.drawPolygonControl)}activateDrawControl(e){this.drawControlIsDisabled=!1,this.activeDrawControl=e,this.drawStart$$=e.start$.subscribe(n=>this.onDrawStart(n)),this.drawEnd$$=e.end$.subscribe(n=>this.onDrawEnd(n)),this.drawChanges$$=e.changes$.subscribe(n=>this.onDrawChanges(n)),this.drawChanges$$=e.abort$.subscribe(n=>{this.clearTooltipsOfOlGeometry(n),this.clearMeasures()}),e.setOlMap(this.map.ol,!1)}deactivateDrawControl(){this.activeDrawControl!==void 0&&(this.olDrawSource.clear(),this.drawStart$$!==void 0&&this.drawStart$$.unsubscribe(),this.drawEnd$$!==void 0&&this.drawEnd$$.unsubscribe(),this.drawChanges$$!==void 0&&this.drawChanges$$.unsubscribe(),this.clearTooltipsOfOlSource(this.olDrawSource),this.activeOlGeometry!==void 0&&this.clearTooltipsOfOlGeometry(this.activeOlGeometry),this.activeDrawControl.setOlMap(void 0),this.activeDrawControl=void 0,this.activeOlGeometry=void 0)}setActiveMeasureType(e){this._activeMeasureType=e,this.clearMeasures(),this.toggleDrawControl()}onDrawStart(e){this.activeOlGeometry=e}onDrawEnd(e){this.activeOlGeometry=void 0,this.finalizeMeasureOfOlGeometry(e),this.addFeatureToStore(e),this.clearTooltipsOfOlGeometry(e),this.olDrawSource.clear(!0)}onDrawChanges(e){let n=vC(e,this.projection);this.updateMeasureOfOlGeometry(e,Object.assign({},n,{area:void 0})),this.measure$.next(n)}activateModifyControl(){let e=this.store.getStrategyOfType(rs);e.deactivate(),e.clear(),this.modifyStart$$=this.modifyControl.start$.subscribe(n=>this.onModifyStart(n)),this.modifyEnd$$=this.modifyControl.end$.subscribe(n=>this.onModifyEnd(n)),this.modifyChanges$$=this.modifyControl.changes$.subscribe(n=>this.onModifyChanges(n)),this.modifyControl.setOlMap(this.map.ol)}deactivateModifyControl(){if(this.modifyStart$$!==void 0&&this.modifyStart$$.unsubscribe(),this.modifyEnd$$!==void 0&&this.modifyEnd$$.unsubscribe(),this.modifyChanges$$!==void 0&&this.modifyChanges$$.unsubscribe(),this.activeOlGeometry!==void 0){if(this.selectedFeatures$.value.length===1){let e=this.selectedFeatures$.value[0];this.addFeatureToStore(this.activeOlGeometry,e)}this.finalizeMeasureOfOlGeometry(this.activeOlGeometry)}this.olDrawSource.clear(),this.store.activateStrategyOfType(rs),this.activeOlGeometry=void 0,this.modifyControl.setOlMap(void 0)}onModifyStart(e){this.onDrawStart(e)}onModifyChanges(e){this.onDrawChanges(e)}onModifyEnd(e){this.finalizeMeasureOfOlGeometry(e)}finalizeMeasureOfOlGeometry(e){let n=vC(e,this.projection);this.updateMeasureOfOlGeometry(e,n)}updateMeasureOfOlGeometry(e,n){e.setProperties({_measure:n},!0),this.updateTooltipsOfOlGeometry(e)}clearMeasures(){this.measure$.next({})}addFeatureToStore(e,n){let o=n?n.properties.id:e.ol_uid,s=this.map.ol.getView().getProjection(),l=new Qr().writeGeometryObject(e,{featureProjection:s,dataProjection:s});this.store.update({type:vr,geometry:l,projection:s.getCode(),properties:{id:o,measure:e.get("_measure")},meta:{id:o}})}updateTooltipsOfOlGeometry(e){let n=e.get("_measure"),o=n.lengths,s=n.area,l=YJ(e);if(o.length===l.length)for(let h=0;h<l.length;h++){let p=o[h];p!==void 0&&this.updateOlTooltip(l[h],np(p,this.activeLengthUnit),this.activeLengthUnit,dh.Length)}s!==void 0&&this.updateOlTooltip(XJ(e),Xp(s,this.activeAreaUnit),this.activeAreaUnit,dh.Area)}clearTooltipsOfOlGeometry(e){yw(e).forEach(n=>{n!==void 0&&n.getMap()!==void 0&&this.map.ol.removeOverlay(n)})}updateTooltipsOfOlSource(e){e.forEachFeature(n=>{this.updateTooltipsOfOlGeometry(n.getGeometry())})}clearTooltipsOfOlSource(e){e.forEachFeature(n=>{n.getGeometry()!==void 0&&this.clearTooltipsOfOlGeometry(n.getGeometry())})}updateOlTooltip(e,n,o,s){e.setProperties({_measure:n,_unit:o,_type:s},!0),e.getElement().innerHTML=this.computeTooltipInnerHTML(e),this.shouldShowTooltip(e)&&this.map.ol.addOverlay(e)}computeTooltipInnerHTML(e){let n=e.getProperties();return S_(n._measure,{decimal:1,unit:n._unit,unitAbbr:!0,locale:"fr"},this.languageService)}shouldShowTooltip(e){if(this.showTooltips===!1)return!1;let n=e.getProperties(),o=n._measure;if(o===void 0)return!1;if(n._unit===dh.Length){let s=np(this.minSegmentLength,n._unit)||0;return o>Math.max(s,0)}return!0}saveCurrentUnits(){this.storageService.set("distanceUnit",this.activeLengthUnit,gm.SESSION),this.storageService.set("areaUnit",this.activeAreaUnit,gm.SESSION)}getSavedUnits(){let e=this.storageService.get("distanceUnit"),n=this.storageService.get("areaUnit");this.activeLengthUnit=e||this.activeLengthUnit,this.activeAreaUnit=n||this.activeAreaUnit}static \u0275fac=function(n){return new(n||r)(Ie(Di),Ie(Yc),Ie(Kr),Ie(rc))};static \u0275cmp=nt({type:r,selectors:[["igo-measurer"]],viewQuery:function(n,o){if(n&1&&Ir(fIe,7),n&2){let s;bi(s=wi())&&(o.table=s.first)}},inputs:{map:"map",store:"store",activeMeasureType:"activeMeasureType",minSegmentLength:"minSegmentLength"},standalone:!0,features:[lt],decls:43,vars:60,consts:[["table",""],[1,"measure-type-toggle","mat-typography"],[3,"change","value"],[3,"value"],[1,"measure-options","mat-typography"],[3,"change","disabled","checked","labelPosition"],[4,"ngIf"],[3,"checked","labelPosition","change",4,"ngIf"],[3,"change","checked","labelPosition"],[1,"measure-store-buttons"],["mat-icon-button","","color","accent",3,"matTooltip","disabled","click",4,"ngIf"],["mat-icon-button","","color","warn",3,"matTooltip","disabled","click",4,"ngIf"],[1,"table-compact",3,"store","template"],[3,"measureType","measureUnit","measure","auto","placeholder","measureUnitChange",4,"ngIf"],[3,"measureUnitChange","measureType","measureUnit","measure","auto","placeholder"],["mat-icon-button","","color","accent",3,"click","matTooltip","disabled"],["mat-icon-button","","color","warn",3,"click","matTooltip","disabled"]],template:function(n,o){if(n&1){let s=We();$(0,"div")(1,"div",1)(2,"mat-button-toggle-group",2),ve("change",function(h){return we(s),xe(o.onMeasureTypeChange(h.value))}),$(3,"mat-button-toggle",3),_e(4),le(5,"translate"),ee(),$(6,"mat-button-toggle",3),_e(7),le(8,"translate"),ee()()(),$(9,"div",4)(10,"mat-slide-toggle",5),ve("change",function(h){return we(s),xe(o.onToggleDrawControl(h.checked))}),_e(11),le(12,"translate"),ee(),Pe(13,gIe,1,0,"mat-divider",6),le(14,"async"),Pe(15,_Ie,3,5,"mat-slide-toggle",7),le(16,"async"),Pe(17,yIe,1,0,"mat-divider",6),le(18,"async"),le(19,"async"),Pe(20,vIe,3,5,"mat-slide-toggle",7),le(21,"async"),Pe(22,bIe,3,5,"mat-slide-toggle",7),le(23,"async"),Pe(24,wIe,1,0,"mat-divider",6),le(25,"async"),$(26,"mat-slide-toggle",8),ve("change",function(h){return we(s),xe(o.onToggleMeasureUnitsAuto(h.checked))}),_e(27),le(28,"translate"),ee()(),Pe(29,CIe,3,2,"ng-container",6),le(30,"async"),Pe(31,AIe,1,0,"mat-divider",6),le(32,"async"),le(33,"async"),$(34,"div",9),Pe(35,MIe,5,6,"button",10),le(36,"async"),le(37,"async"),Pe(38,IIe,5,6,"button",11),le(39,"async"),le(40,"async"),ee(),ct(41,"igo-entity-table",12,0),ee()}n&2&&(j(2),z("value",o.activeMeasureType),j(),z("value",o.measureType.Length),j(),Qe(" ",ce(5,24,"igo.geo.measure."+o.measureType.Length)," "),j(2),z("value",o.measureType.Area),j(),Qe(" ",ce(8,26,"igo.geo.measure."+o.measureType.Area)," "),j(3),z("disabled",o.drawControlIsDisabled)("checked",o.drawControlIsActive)("labelPosition","before"),j(),Qe(" ",ce(12,28,"igo.geo.measure.toggleActive")," "),j(2),z("ngIf",ce(14,30,o.hasLine$)),j(2),z("ngIf",ce(16,32,o.hasLine$)),j(2),z("ngIf",ce(18,34,o.hasLine$)||ce(19,36,o.hasArea$)),j(3),z("ngIf",ce(21,38,o.hasArea$)),j(2),z("ngIf",ce(23,40,o.hasArea$)),j(2),z("ngIf",ce(25,42,o.hasArea$)),j(2),z("checked",o.measureUnitsAuto)("labelPosition","before"),j(),Qe(" ",ce(28,44,"igo.geo.measure.toggleAutoUnits")," "),j(2),z("ngIf",ce(30,46,o.measure$)),j(2),z("ngIf",ce(32,48,o.hasLine$)||ce(33,50,o.hasArea$)),j(4),z("ngIf",ce(36,52,o.hasLine$)||ce(37,54,o.hasArea$)),j(3),z("ngIf",ce(39,56,o.hasLine$)||ce(40,58,o.hasArea$)),j(3),z("store",o.store)("template",o.tableTemplate))},dependencies:[Ed,Gu,mu,bl,js,Gt,dl,Uc,Xee,Vt,ci,Qt,ti,jt,$t,B1,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .measure-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .measure-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]{margin-left:-2px}[_nghost-%COMP%]   .measure-store-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{margin-left:14px}[_nghost-%COMP%]   .table-compact[_ngcontent-%COMP%]     .mat-mdc-header-cell.mat-column-selectionCheckbox{width:52px}[_nghost-%COMP%]   .igo-map-tooltip[_ngcontent-%COMP%]{position:relative;border-radius:4px;padding:4px 8px;white-space:nowrap}  .igo-map-tooltip-hidden, .igo-map-tooltip-measure-by-display[_ngcontent-%COMP%]{display:none}
/*# sourceMappingURL=measurer.component-GOQHMCZF.css.map */`],changeDetection:0})}return r})();function EIe(r,i){}var FC=(()=>{class r{cdRef;ngControl;olOverlayLayer;olGeoJSON=new Qr;ready=!1;drawControl;modifyControl;defaultDrawStyleRadius;olGeometryEnds$$;olGeometryChanges$$;olTooltip=this.createMeasureTooltip();activeControl;map;set geometryType(e){this._geometryType=e,this.ready!==!1&&(this.deactivateControl(),this.createDrawControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get geometryType(){return this._geometryType}_geometryType;drawGuide=null;measure=!1;get drawControlIsActive(){return this._drawControlIsActive}set drawControlIsActive(e){if(this._drawControlIsActive=e,this.ready!==!1)if(this.deactivateControl(),this._drawControlIsActive)this.toggleControl();else return}_drawControlIsActive=!0;get freehandDrawIsActive(){return this._freehandDrawIsActive}set freehandDrawIsActive(e){this._freehandDrawIsActive=e,this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.ready!==!1&&this.drawControlIsActive&&this.toggleControl()}_freehandDrawIsActive;get predefinedRadius(){return this._predefinedRadius}set predefinedRadius(e){this._predefinedRadius=e,this.drawControl.ispredefinedRadius$.next(e)}_predefinedRadius;controlOptions={};set drawStyle(e){e===void 0&&(e=I8()),this._drawStyle=e;let n=this.getGuideStyleFromDrawStyle(e);n!==void 0?this.defaultDrawStyleRadius=n.getRadius():this.defaultDrawStyleRadius=null,this.ready!==!1&&(this.deactivateControl(),this.createDrawControl(),this.createModifyControl(),this.drawControl.freehand$.next(this.freehandDrawIsActive),this.toggleControl())}get drawStyle(){return this._drawStyle}_drawStyle;set overlayStyle(e){this._overlayStyle=e}get overlayStyle(){return this._overlayStyle}_overlayStyle;set value(e){this._value=e,this.ready!==!1&&(e?this.addGeoJSONToOverlay(e):this.olOverlaySource.clear(!0),this.onChange(e),this.toggleControl(),this.cdRef.detectChanges())}get value(){return this._value}_value;get olOverlaySource(){return this.olOverlayLayer.getSource()}set radius(e){if(this.ready!==!1&&(this.modifyControl.getSource()&&this.modifyControl.getSource().refresh(),this.freehandDrawIsActive)){let n;setTimeout(()=>{n=this.modifyControl.olModifyInteraction,n&&n.features_&&(n.features_.clear(),this.addGeoJSONToOverlay(this.value))},0)}}constructor(e,n){this.cdRef=e,this.ngControl=n,this.ngControl!==void 0&&(this.ngControl.valueAccessor=this)}ngOnInit(){this.drawStyle===void 0&&(this.drawStyle=I8()),this.overlayStyle===void 0&&(this.overlayStyle=this.drawStyle),this.addOlOverlayLayer(),this.createDrawControl(),this.createModifyControl(),this.value&&this.addGeoJSONToOverlay(this.value),this.toggleControl(),this.ready=!0}ngOnDestroy(){this.ready=!1,this.deactivateControl(),this.olOverlaySource.clear(),this.map.ol.removeLayer(this.olOverlayLayer)}registerOnChange(e){this.onChange=e}onChange=()=>{};registerOnTouched(e){this.onTouched=e}onTouched=()=>{};writeValue(e){this.value=e}addOlOverlayLayer(){this.olOverlayLayer=new fc({source:new $a,zIndex:500,style:null}),this.map.ol.addLayer(this.olOverlayLayer)}createDrawControl(){let e=Object.assign({},this.controlOptions,{geometryType:this.geometryType||"Point",drawingLayer:this.olOverlayLayer,interactionStyle:typeof this.drawStyle=="function"?this.drawStyle:(n,o)=>{let s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,o),s}});this.drawControl=new op(e)}createModifyControl(){let e=Object.assign({},this.controlOptions,{layer:this.olOverlayLayer,drawStyle:typeof this.drawStyle=="function"?this.drawStyle:(n,o)=>{let s=this.drawStyle;return this.updateDrawStyleWithDrawGuide(s,o),s}});this.modifyControl=new Sw(e)}toggleControl(){let e;!this.value&&this.geometryType?e=this.drawControl:e=this.modifyControl,e!==this.activeControl&&(this.deactivateControl(),this.activateControl(e))}activateControl(e){this.activeControl=e,this.olGeometryEnds$$=e.end$.subscribe(n=>this.onOlGeometryEnds(n)),this.measure===!0&&e===this.drawControl&&(this.olGeometryChanges$$=e.changes$.subscribe(n=>this.onOlGeometryChanges(n))),e.setOlMap(this.map.ol,!1)}deactivateControl(){this.removeMeasureTooltip(),this.activeControl!==void 0&&this.activeControl.setOlMap(void 0),this.olGeometryEnds$$!==void 0&&this.olGeometryEnds$$.unsubscribe(),this.olGeometryChanges$$!==void 0&&this.olGeometryChanges$$.unsubscribe(),this.activeControl=void 0}onOlGeometryEnds(e){this.removeMeasureTooltip(),this.setOlGeometry(e)}onOlGeometryChanges(e){e.getType()!=="Point"&&this.updateMeasureTooltip(e)}setOlGeometry(e){if(e===void 0)return;e.getType()==="Circle"&&(e=this.circleToPoint(e));let n=this.olGeoJSON.writeGeometryObject(e,{featureProjection:this.map.projection,dataProjection:"EPSG:4326"});e.get("radius")&&(n.radius=e.get("radius"),e.set("radius",n.radius)),this.writeValue(n)}circleToPoint(e){let n=e.getCenter(),o=Sr(n,this.map.projection,"EPSG:4326"),s=Math.round(e.getRadius()*Math.cos(Math.PI/180*o[1]));return e=new Ii(n),e.set("radius",s,!0),e}addGeoJSONToOverlay(e){let n=this.olGeoJSON.readGeometry(e,{dataProjection:"EPSG:4326",featureProjection:this.map.projection}),o=new gi({geometry:n});o.setStyle(this.overlayStyle),this.olOverlaySource.clear(),this.olOverlaySource.addFeature(o)}createMeasureTooltip(){return new AT({element:document.createElement("div"),offset:[-30,-10],className:["igo-map-tooltip","igo-map-tooltip-measure"].join(" "),stopEvent:!1})}updateMeasureTooltip(e){let o=vC(e,this.map.projection).lengths,s=e.getType()==="Polygon"?o.length-2:o.length-1,l=o[s],h=o3(e),p=h[s];if(h.length===0||p===void 0){this.removeMeasureTooltip();return}this.olTooltip.setPosition(p.getFlatCoordinates());let m=S_(l,{decimal:1,unit:or.Meters,unitAbbr:!0,locale:"fr"});this.olTooltip.getElement().innerHTML=m,this.olTooltip.getMap()===void 0&&this.map.ol.addOverlay(this.olTooltip)}removeMeasureTooltip(){this.olTooltip.getMap&&this.olTooltip.getMap()!==void 0&&(this.map.ol.removeOverlay(this.olTooltip),this.olTooltip.setMap(void 0))}updateDrawStyleWithDrawGuide(e,n){let o=this.getGuideStyleFromDrawStyle(e);if(o===void 0)return;let s=this.drawGuide,l;!s||s<0?l=this.defaultDrawStyleRadius:l=s>0?s/n:s,o.setRadius(l)}getGuideStyleFromDrawStyle(e){let n;Array.isArray(e)?n=e[0]:n=e,typeof n.getImage=="function"&&(n=n.getImage());let o;return typeof n.setRadius=="function"&&(o=n),o}static \u0275fac=function(n){return new(n||r)(Ie(lr),Ie(tG,10))};static \u0275cmp=nt({type:r,selectors:[["igo-geometry-form-field-input"]],inputs:{map:"map",geometryType:"geometryType",drawGuide:"drawGuide",measure:"measure",drawControlIsActive:"drawControlIsActive",freehandDrawIsActive:"freehandDrawIsActive",predefinedRadius:"predefinedRadius",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle",value:"value",radius:"radius"},standalone:!0,features:[lt],decls:1,vars:0,template:function(n,o){n&1&&Pe(0,EIe,0,0,"ng-template")},encapsulation:2,changeDetection:0})}return r})();function TIe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",17),ve("change",function(){we(e);let o=ne();return xe(o.onDrawControlChange())}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.drawControlIsActive)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.spatialFilter.drawControl")," ")}}function FIe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",17),ve("change",function(){we(e);let o=ne();return xe(o.onfreehandControlChange())}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("checked",e.freehandDrawIsActive)("labelPosition","before"),j(),Qe(" ",ce(2,3,"igo.geo.spatialFilter.freehandControl")," ")}}function PIe(r,i){if(r&1&&($(0,"mat-option",6),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.measure."+e)," ")}}function LIe(r,i){if(r&1){let e=We();$(0,"div",18)(1,"mat-form-field",19),ct(2,"input",20),le(3,"translate"),ee(),$(4,"mat-form-field",21)(5,"mat-select",22),ve("selectionChange",function(o){we(e);let s=ne();return xe(s.onMeasureUnitChange(o.value))}),Pe(6,PIe,3,4,"mat-option",23),ee()()()}if(r&2){let e=ne();j(2),sr("placeholder",ce(3,6,"igo.geo.spatialFilter.buffer")),z("formControl",e.bufferFormControl)("value",0)("readonly",e.formControl.value===null),j(3),z("value",e.measureUnit),j(),z("ngForOf",e.measureUnits)}}function kIe(r,i){if(r&1&&($(0,"mat-option",6),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.measure."+e)," ")}}function OIe(r,i){if(r&1){let e=We();$(0,"div",24)(1,"mat-form-field",25)(2,"input",26),le(3,"translate"),ve("input",function(){we(e);let o=ne();return xe(o.getRadius())}),ee()(),$(4,"mat-form-field",21)(5,"mat-select",22),ve("selectionChange",function(o){we(e);let s=ne();return xe(s.onMeasureUnitChange(o.value))}),Pe(6,kIe,3,4,"mat-option",23),ee()()()}if(r&2){let e=ne();j(2),sr("placeholder",ce(3,6,"igo.geo.spatialFilter.radius")),z("formControl",e.radiusFormControl)("value",1e3)("readonly",e.freehandDrawIsActive&&e.formControl.value===null),j(3),z("value",e.measureUnit),j(),z("ngForOf",e.measureUnits)}}function DIe(r,i){if(r&1){let e=We();$(0,"mat-radio-button",27),ve("change",function(o){we(e);let s=ne();return xe(s.onItemTypeChange(o))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.spatialFilter."+e)," ")}}function RIe(r,i){r&1&&($(0,"mat-header-cell",38),_e(1),le(2,"translate"),ee()),r&2&&(j(),bt(ce(2,1,"igo.geo.spatialFilter.Thematics")))}function NIe(r,i){if(r&1){let e=We();$(0,"mat-header-cell",39)(1,"mat-checkbox",40),ve("change",function(o){we(e);let s=ne(2);return xe(o?s.masterToggle():null)}),ee()()}if(r&2){let e=ne(2);j(),z("checked",e.isAllSelected())("indeterminate",e.selectedThematics.hasValue()&&!e.isAllSelected())}}function BIe(r,i){r&1&&ct(0,"mat-header-row")}function GIe(r,i){r&1&&ct(0,"mat-row")}function jIe(r,i){if(r&1){let e=We();$(0,"mat-tree-node",41)(1,"li",42),ct(2,"button",43),_e(3),$(4,"mat-checkbox",44),ve("click",function(o){return we(e),xe(o.stopPropagation())})("change",function(o){let s=we(e).$implicit,l=ne(2);return xe(o?l.onToggleChange(s):null)}),ee()()()}if(r&2){let e=i.$implicit,n=ne(2);j(3),Qe(" ",e.name," "),j(),z("checked",n.selectedThematics.isSelected(e))}}function VIe(r,i){if(r&1){let e=We();$(0,"mat-nested-tree-node")(1,"div",42)(2,"button",45),ve("click",function(){let o=we(e).$implicit,s=ne(2);return xe(s.onToggleClick(o))}),$(3,"mat-icon"),_e(4),ee()(),_e(5),$(6,"mat-checkbox",46),ve("change",function(o){let s=we(e).$implicit,l=ne(2);return xe(o?l.childrensToggle(s):null)}),ee()(),$(7,"ul",47),ic(8,48),ee()()}if(r&2){let e=i.$implicit,n=ne(2);j(4),bt(n.treeControl.isExpanded(e)?"expand_more":"chevron_right"),j(),Qe(" ",e.name," "),j(),z("checked",n.isAllSelected(e))("indeterminate",n.hasChildrenSelected(e)&&!n.isAllSelected(e)),j(),dr("example-tree-invisible",!n.treeControl.isExpanded(e))}}function UIe(r,i){if(r&1&&($(0,"div",28)(1,"mat-table"),Dr(2,29),Pe(3,RIe,3,3,"mat-header-cell",30),Rr(),Dr(4,31),Pe(5,NIe,2,2,"mat-header-cell",32),Rr(),Pe(6,BIe,1,0,"mat-header-row",33)(7,GIe,1,0,"mat-row",34),ee(),$(8,"mat-tree",35),Pe(9,jIe,5,2,"mat-tree-node",36)(10,VIe,9,6,"mat-nested-tree-node",37),ee()()),r&2){let e=ne();j(6),z("matHeaderRowDef",e.displayedColumns),j(),z("matRowDefColumns",e.displayedColumns),j(),z("dataSource",e.dataSource)("treeControl",e.treeControl),j(2),z("matTreeNodeDefWhen",e.hasChild)}}function zIe(r,i){if(r&1){let e=We();$(0,"button",49),ve("click",function(){we(e);let o=ne();return xe(o.clearSearch())}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("disabled",e.disabledClearSearch()),j(),Qe(" ",ce(2,2,"igo.geo.spatialFilter.clearSearch")," ")}}function $Ie(r,i){if(r&1){let e=We();$(0,"button",50),ve("click",function(){we(e);let o=ne();return xe(o.clearDrawZone())}),_e(1),le(2,"translate"),ee()}if(r&2){let e=ne();z("disabled",e.formControl.value===null),j(),Qe(" ",ce(2,2,"igo.geo.spatialFilter.clearForm")," ")}}function WIe(r,i){if(r&1){let e=We();$(0,"button",51),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.toggleVisibleList())}),$(2,"mat-icon"),_e(3,"expand_more"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.spatialFilter.showSearchResults"))}function HIe(r,i){if(r&1){let e=We();$(0,"button",55),le(1,"translate"),ve("click",function(){we(e);let o=ne(2);return xe(o.toggleVisibleList())}),$(2,"mat-icon"),_e(3,"expand_less"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.spatialFilter.hideSearchResults"))}function qIe(r,i){if(r&1){let e=We();$(0,"div",52),Pe(1,HIe,4,3,"button",53),$(2,"igo-entity-table",54),ve("entitySelectChange",function(o){we(e);let s=ne();return xe(s.entityChange.emit(o))}),ee()()}if(r&2){let e=ne();j(),z("ngIf",e.listIsVisible),j(),z("template",e.tableTemplate)("store",e.store)}}var YIe=(()=>{class r{cdRef;spatialFilterService;messageService;languageService;map;get type(){return this._type}set type(e){this._type=e;let n=this.geometryTypes.findIndex(o=>o===this.type);if(this.geometryType=this.geometryTypes[n],this.formControl.reset(),this.radius=void 0,this.drawGuide$.next(null),this.drawStyle$.next(void 0),this.type===nl.Predefined){let o={type:"Point",coordinates:""};this.formControl.setValue(o)}if(this.type===nl.Point)this.radius=1e3,this.radiusFormControl.setValue(this.radius),this.PointStyle=(o,s)=>{let l=o.getGeometry(),h=Sr(l.getCoordinates(),this.map.projection,"EPSG:4326");return new oi({image:new an({radius:this.radius/Math.cos(Math.PI/180*h[1])/s,stroke:new ui({width:2,color:"rgba(0, 153, 255)"}),fill:new hi({color:"rgba(0, 153, 255, 0.2)"})})})},this.overlayStyle=this.PointStyle,this.drawStyle$.next(this.overlayStyle);else{this.radius=void 0,this.PolyStyle=()=>new oi({stroke:new ui({width:2,color:"rgba(0, 153, 255)"}),fill:new hi({color:"rgba(0, 153, 255, 0.2)"})});let o=[0,153,255],s=()=>new oi({image:new an({radius:8,stroke:new ui({width:2,color:"rgba(0, 153, 255)"}),fill:new hi({color:"rgba(0, 153, 255, 0.2)"})}),stroke:new ui({color:o.concat([1]),width:2}),fill:new hi({color:o.concat([.2])})});this.overlayStyle=this.PolyStyle,this.drawStyle$.next(s)}this.overlayStyle$.next(this.overlayStyle)}_type;queryType;zone;loading;get store(){return this._store}set store(e){this._store=e,this._store.entities$.subscribe(()=>{this.cdRef.detectChanges()})}_store;get measureUnits(){return[or.Meters,or.Kilometers]}layers=[];allLayers=[];get thematicLength(){return this._thematicLength}set thematicLength(e){this._thematicLength=e}_thematicLength;toggleSearch=new Ke;itemTypeChange=new Ke;thematicChange=new Ke;drawZoneEvent=new Ke;bufferEvent=new Ke;zoneWithBufferChange=new Ke;measureUnitChange=new Ke;radiusEvent=new Ke;freehandControl=new Ke;predefinedRadius=new Ke;clearButtonEvent=new Ke;clearSearchEvent=new Ke;export=new Ke;openWorkspace=new Ke;entityChange=new Ke;itemType=[uh.Address,uh.Thematics];selectedItemType=uh.Address;selectedSourceAddress;treeControl=new kT(e=>e.children);displayedColumns=["name","select"];childrens=[];groups=[];thematics=[];dataSource=new BT;selectedThematics=new Eh(!0,[]);value$=new ut(void 0);drawGuide$=new ut(null);overlayStyle$=new ut(void 0);drawStyle$=new ut(void 0);value$$;radiusChanges$$;bufferChanges$$;formControl=new zc;geometryType;geometryTypeField=!1;geometryTypes=[po.Point,po.Polygon];drawGuideField=!1;drawGuide=null;drawGuidePlaceholder="";measure=!1;drawControlIsActive=!0;freehandDrawIsActive=!1;drawStyle;drawZone;overlayStyle;PointStyle;PolyStyle;radius;buffer=0;radiusFormControl=new zc;bufferFormControl=new zc;measureUnit=or.Meters;zoneWithBuffer;listIsVisible=!0;tableTemplate;constructor(e,n,o,s){this.cdRef=e,this.spatialFilterService=n,this.messageService=o,this.languageService=s}ngOnInit(){this.spatialFilterService.loadThematicsList().subscribe(o=>{for(let l of o)this.childrens.push(l),this.childrens.sort((h,p)=>h.name.localeCompare(p.name));this.groups.push(this.languageService.translate.instant("igo.geo.terrapi.limites"));let s={name:this.groups[0],children:[]};this.thematics.push(s),this.childrens.forEach(l=>{if(l.group&&this.groups.indexOf(l.group)===-1){this.groups.push(l.group);let h={name:l.group,children:[]};this.thematics.push(h)}if(!l.group)if(l.name===this.languageService.translate.instant("igo.geo.terrapi.AdmRegion")||l.name===this.languageService.translate.instant("igo.geo.terrapi.Mun")||l.name===this.languageService.translate.instant("igo.geo.terrapi.Arrond")||l.name===this.languageService.translate.instant("igo.geo.terrapi.CircFed")||l.name===this.languageService.translate.instant("igo.geo.terrapi.CircProv")||l.name===this.languageService.translate.instant("igo.geo.terrapi.DirReg")||l.name===this.languageService.translate.instant("igo.geo.terrapi.MRC")||l.name===this.languageService.translate.instant("igo.geo.terrapi.RegTour"))l.group=s.name;else if(l.name===this.languageService.translate.instant("igo.geo.terrapi.routes"))l.group=this.languageService.translate.instant("igo.geo.spatialFilter.group.transport");else{let h={name:l.name,children:[],source:l.source};this.thematics.push(h)}this.thematics.sort((h,p)=>h.name.localeCompare(p.name))}),this.thematics.forEach(l=>{for(let h of this.childrens)h.group===l.name&&l.children.push(h)})}),this.dataSource.data=this.thematics,this.drawGuide$.next(null),this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(o=>{o?(this.value$.next(o),this.drawZone=this.formControl.value,this.buffer!==0&&(this.drawZoneEvent.emit(this.drawZone),this.bufferFormControl.setValue(this.buffer))):(this.value$.next(void 0),this.drawZone=void 0)}),this.value$.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.radiusChanges$$=this.radiusFormControl.valueChanges.subscribe(()=>{this.getRadius(),this.cdRef.detectChanges()}),this.bufferChanges$$=this.bufferFormControl.valueChanges.pipe(Br(500)).subscribe(o=>{this.measureUnit===or.Meters&&o>0&&o<=1e5?(this.buffer=o,this.bufferEvent.emit(o),this.spatialFilterService.loadBufferGeometry(this.drawZone,nl.Polygon,o).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===or.Kilometers&&o>0&&o<=100?(this.buffer=o,this.bufferEvent.emit(o),this.spatialFilterService.loadBufferGeometry(this.drawZone,nl.Polygon,o*1e3).subscribe(s=>{this.zoneWithBuffer=s,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):o===0?(this.buffer=o,this.bufferEvent.emit(o),this.drawZoneEvent.emit(this.drawZone)):(o<0||this.measureUnit===or.Meters&&o>1e5||this.measureUnit===or.Kilometers&&o>100)&&(this.bufferFormControl.setValue(0),this.buffer=0,this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))});let e=new _m({}),n=new rs({layer:new Fr({zIndex:300,source:new kr,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:this.map,hitTolerance:15,motion:Yi.Default,many:!0,dragBox:!0});this.store.addStrategy(n,!0),this.store.addStrategy(e,!1)}ngOnDestroy(){this.value$$.unsubscribe(),this.radiusChanges$$.unsubscribe(),this.bufferChanges$$.unsubscribe(),this.cdRef.detach(),this.radiusChanges$$&&this.radiusChanges$$.unsubscribe(),this.value$$&&this.value$$.unsubscribe()}onItemTypeChange(e){this.selectedItemType=e.value,this.itemTypeChange.emit(this.selectedItemType)}onMeasureUnitChange(e){e!==this.measureUnit&&(this.measureUnit=e,this.measureUnitChange.emit(this.measureUnit),this.isPolygon()?this.measureUnit===or.Meters?this.bufferFormControl.setValue(this.bufferFormControl.value*1e3):this.bufferFormControl.setValue(this.bufferFormControl.value/1e3):this.isPoint()&&(this.measureUnit===or.Meters?this.radiusFormControl.setValue(this.radiusFormControl.value*1e3):this.radiusFormControl.setValue(this.radiusFormControl.value/1e3)))}isPredefined(){return this.type===nl.Predefined}isPolygon(){return this.type===nl.Polygon}isPoint(){return this.type===nl.Point}hasChild(e,n){return n.children?n.children.length:!1}onToggleClick(e){this.treeControl.isExpanded(e)?this.treeControl.collapse(e):this.treeControl.expand(e)}isAllSelected(e){let n,o=0;return e?(n=e.children.length,e.children.forEach(s=>{this.selectedThematics.selected.find(l=>l===s)&&o++})):(n=this.selectedThematics.selected.length,this.thematics.forEach(s=>{this.groups.indexOf(s.name)===-1&&o++}),this.childrens.forEach(s=>{this.thematics.find(l=>l.source===s.source)||o++})),o>=1?n===o:!1}hasChildrenSelected(e){let n=!1;return e.children.forEach(o=>{this.selectedThematics.selected.find(s=>s.source===o.source)&&(n=!0)}),n}masterToggle(){this.isAllSelected()?this.selectedThematics.clear():this.selectAll();let e=[];for(let n of this.selectedThematics.selected)e.push(n);this.isAllSelected()?this.thematics.forEach(n=>{this.hasChild(0,n)&&this.treeControl.expand(n)}):this.thematics.forEach(n=>{this.hasChild(0,n)&&this.treeControl.collapse(n)}),this.thematicChange.emit(e)}selectAll(e){e?this.hasChild(0,e)&&e.children.forEach(n=>this.selectedThematics.select(n)):(this.thematics.forEach(n=>{this.groups.indexOf(n.name)===-1&&this.selectedThematics.select(n)}),this.childrens.forEach(n=>{this.selectedThematics.selected.find(o=>o.source===n.source)||this.selectedThematics.select(n)}))}childrensToggle(e){this.isAllSelected(e)?e.children.forEach(o=>this.selectedThematics.deselect(o)):this.selectAll(e);let n=[];for(let o of this.selectedThematics.selected)n.push(o);this.treeControl.expand(e),this.thematicChange.emit(n)}onToggleChange(e){let n=!1;this.selectedThematics.selected.find(s=>s.source===e.source)!==void 0&&(n=!0),this.childrens.forEach(s=>{s===e&&n===!1&&this.selectedThematics.select(s),s===e&&n===!0&&this.selectedThematics.deselect(s)}),this.thematics.forEach(s=>{s===e&&n===!1&&this.selectedThematics.select(s),s===e&&n===!0&&this.selectedThematics.deselect(s)});let o=[];for(let s of this.selectedThematics.selected)o.push(s);this.thematicChange.emit(o)}onDrawControlChange(){this.drawControlIsActive=!this.drawControlIsActive}onfreehandControlChange(){this.freehandDrawIsActive=!this.freehandDrawIsActive,this.freehandControl.emit(this.freehandDrawIsActive),this.isPoint()?(this.predefinedRadius.emit(!this.freehandDrawIsActive),this.freehandDrawIsActive&&(this.overlayStyle$.next(void 0),this.drawStyle$.next(void 0))):this.predefinedRadius.emit(!1)}toggleSearchButton(){this.isPredefined()||(this.buffer>0?(this.zoneWithBuffer.meta={id:void 0,title:"Zone"},this.zoneWithBuffer.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.zoneWithBuffer)):(this.drawZone.meta={id:void 0,title:"Zone"},this.drawZone.properties={nom:"Zone",type:this.type},this.drawZoneEvent.emit(this.drawZone))),this.isPoint()?this.radiusEvent.emit(this.radius):this.isPolygon()&&this.bufferEvent.emit(this.buffer),this.toggleSearch.emit(),this.store.entities$.pipe(Br(500)).subscribe(e=>{e.length&&this.layers.length===this.thematicLength+1&&(this.openWorkspace.emit(),this.createTableTemplate())})}clearButton(){this.loading=!0,this.store&&this.store.clear(),(this.isPoint()||this.isPolygon())&&(this.drawZone=void 0,this.formControl.reset()),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.clearButtonEvent.emit(),this.loading=!1,this.tableTemplate=void 0}clearDrawZone(){this.formControl.reset(),this.bufferFormControl.setValue(0),this.buffer=0}clearSearch(){this.selectedThematics.clear(),this.bufferFormControl.setValue(0),this.buffer=0,this.bufferEvent.emit(0),this.thematicChange.emit([]),this.clearSearchEvent.emit()}disableSearchButton(){if(this.type===nl.Predefined){if(this.selectedItemType===uh.Address&&this.queryType!==void 0&&this.zone!==void 0)return this.loading;if(this.selectedItemType===uh.Thematics&&this.queryType!==void 0&&this.zone!==void 0&&this.selectedThematics.selected.length>0)return this.loading}if(this.type===nl.Polygon||this.type===nl.Point){if(this.selectedItemType===uh.Address&&this.formControl.value!==null)return this.loading;if(this.selectedItemType===uh.Thematics&&this.selectedThematics.selected.length>0&&this.formControl.value!==null)return this.loading}return!0}disabledClearSearch(){let e=!0;return this.selectedItemType===uh.Address?e=this.queryType===void 0:e=this.queryType===void 0&&this.selectedThematics.selected.length===0,e}getRadius(){let e;if(this.formControl.value!==null?this.measureUnit===or.Meters?e=this.formControl.value.radius:e=this.formControl.value.radius/1e3:e=void 0,this.type===nl.Point){if(this.freehandDrawIsActive){if(e){if(e>=1e5){this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.formControl.reset();return}if(e!==this.radiusFormControl.value){this.radiusFormControl.setValue(e);return}}}else if(this.radiusFormControl.value<0||this.measureUnit===or.Meters&&this.radiusFormControl.value>=1e5||this.measureUnit===or.Kilometers&&this.radiusFormControl.value>=100){this.messageService.alert("igo.geo.spatialFilter.radiusAlert","igo.geo.spatialFilter.warning"),this.radius=1e3,this.measureUnit===or.Meters?this.radiusFormControl.setValue(this.radius):this.radiusFormControl.setValue(this.radius/1e3),this.drawGuide$.next(this.radius);return}this.measureUnit===or.Meters?(this.radius=this.radiusFormControl.value,this.drawGuide$.next(this.radius)):(this.radius=this.radiusFormControl.value*1e3,this.drawGuide$.next(this.radius*1e3)),this.overlayStyle$.next(this.PointStyle),this.drawStyle$.next(this.PointStyle)}}toggleVisibleList(){this.listIsVisible=!this.listIsVisible}createTableTemplate(){let e={name:"meta.title",title:this.languageService.translate.instant("igo.geo.spatialFilter.type"),renderer:xu.UnsanitizedHTML},n={name:"properties.nom",title:this.languageService.translate.instant("igo.geo.spatialFilter.searchResults"),renderer:xu.UnsanitizedHTML},o=[e,n];this.tableTemplate={selection:!0,sort:!0,columns:o}}static \u0275fac=function(n){return new(n||r)(Ie(lr),Ie(fC),Ie(Gn),Ie(Di))};static \u0275cmp=nt({type:r,selectors:[["igo-spatial-filter-item"]],inputs:{map:"map",type:"type",queryType:"queryType",zone:"zone",loading:"loading",store:"store",layers:"layers",allLayers:"allLayers",thematicLength:"thematicLength"},outputs:{toggleSearch:"toggleSearch",itemTypeChange:"itemTypeChange",thematicChange:"thematicChange",drawZoneEvent:"drawZoneEvent",bufferEvent:"bufferEvent",zoneWithBufferChange:"zoneWithBufferChange",measureUnitChange:"measureUnitChange",radiusEvent:"radiusEvent",freehandControl:"freehandControl",predefinedRadius:"predefinedRadius",clearButtonEvent:"clearButtonEvent",clearSearchEvent:"clearSearchEvent",export:"export",openWorkspace:"openWorkspace",entityChange:"entityChange"},standalone:!0,features:[lt],decls:29,vars:43,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","drawStyle","overlayStyle","radius","predefinedRadius"],[1,"header"],[3,"checked","labelPosition","change",4,"ngIf"],["class","buffer-unit",4,"ngIf"],["class","radius-unit",4,"ngIf"],[1,"title","mat-typography"],[3,"value"],[3,"value","change",4,"ngFor","ngForOf"],["class","thematics",4,"ngIf"],[1,"buttons"],["mat-raised-button","","class","clear-search-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","class","clear-form-button",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","primary",1,"search-button",3,"click","disabled"],["mat-raised-button","",1,"remove-button",3,"click","disabled"],["mat-raised-button","",1,"export-button",3,"click","disabled"],["class","expand-more","mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],["class","results",4,"ngIf"],[3,"change","checked","labelPosition"],[1,"buffer-unit"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"radius-unit"],[1,"radius"],["type","number","matInput","",3,"input","placeholder","formControl","value","readonly"],[3,"change","value"],[1,"thematics"],["matColumnDef","name"],["class","thematics-header",4,"matHeaderCellDef"],["matColumnDef","select"],["class","checks-header",4,"matHeaderCellDef"],[4,"matHeaderRowDef"],[4,"matRowDef","matRowDefColumns"],[3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"thematics-header"],[1,"checks-header"],[3,"change","checked","indeterminate"],["matTreeNodeToggle",""],[1,"mat-tree-node"],["mat-icon-button","","disabled",""],[1,"tree-check",3,"click","change","checked"],["mat-icon-button","",3,"click"],[1,"tree-check-2",3,"change","checked","indeterminate"],[1,"tree-ul"],["matTreeNodeOutlet",""],["mat-raised-button","",1,"clear-search-button",3,"click","disabled"],["mat-raised-button","",1,"clear-form-button",3,"click","disabled"],["mat-icon-button","","matTooltipShowDelay","500",1,"expand-more",3,"click","matTooltip"],[1,"results"],["mat-icon-button","","matTooltipShowDelay","500",3,"matTooltip","click",4,"ngIf"],[1,"results-list",3,"entitySelectChange","template","store"],["mat-icon-button","","matTooltipShowDelay","500",3,"click","matTooltip"]],template:function(n,o){n&1&&(ct(0,"igo-geometry-form-field-input",0),le(1,"async"),le(2,"async"),le(3,"async"),$(4,"div",1),Pe(5,TIe,3,5,"mat-slide-toggle",2)(6,FIe,3,5,"mat-slide-toggle",2),ee(),Pe(7,LIe,7,8,"div",3)(8,OIe,7,8,"div",4),$(9,"mat-label",5),_e(10),le(11,"translate"),ee(),$(12,"mat-radio-group",6),Pe(13,DIe,3,4,"mat-radio-button",7),ee(),Pe(14,UIe,11,5,"div",8),$(15,"div",9),Pe(16,zIe,3,4,"button",10)(17,$Ie,3,4,"button",11),$(18,"button",12),ve("click",function(){return o.toggleSearchButton()}),_e(19),le(20,"translate"),ee(),$(21,"button",13),ve("click",function(){return o.clearButton()}),_e(22),le(23,"translate"),ee(),$(24,"button",14),ve("click",function(){return o.export.emit()}),_e(25),le(26,"translate"),ee()(),Pe(27,WIe,4,3,"button",15)(28,qIe,3,3,"div",16)),n&2&&(z("formControl",o.formControl)("map",o.map)("geometryType",o.geometryType)("drawGuide",ce(1,29,o.drawGuide$))("measure",o.measure)("drawControlIsActive",o.drawControlIsActive)("freehandDrawIsActive",o.freehandDrawIsActive)("drawStyle",ce(2,31,o.drawStyle$))("overlayStyle",ce(3,33,o.overlayStyle$))("radius",o.radius)("predefinedRadius",o.predefinedRadius),j(5),z("ngIf",!o.isPredefined()),j(),z("ngIf",!o.isPredefined()),j(),z("ngIf",o.isPolygon()),j(),z("ngIf",o.isPoint()),j(2),Qe("",ce(11,35,"igo.geo.spatialFilter.search"),` :
`),j(2),z("value",o.selectedItemType),j(),z("ngForOf",o.itemType),j(),z("ngIf",o.selectedItemType==="Thematics"&&!o.tableTemplate||o.selectedItemType==="Thematics"&&o.tableTemplate&&!o.listIsVisible),j(2),z("ngIf",o.isPredefined()),j(),z("ngIf",o.isPolygon()||o.isPoint()),j(),z("disabled",o.disableSearchButton()),j(),Qe(" ",ce(20,37,"igo.geo.spatialFilter.goSearch")," "),j(2),z("disabled",o.allLayers.length===0),j(),Qe(" ",ce(23,39,"igo.geo.spatialFilter.removeLayer")," "),j(2),z("disabled",!o.store.entities$.getValue().length),j(),Qe(" ",ce(26,41,"igo.geo.spatialFilter.exportLayer")," "),j(2),z("ngIf",o.store.all().length&&o.tableTemplate&&!o.listIsVisible),j(),z("ngIf",o.store.all().length&&o.tableTemplate&&o.listIsVisible))},dependencies:[FC,Sn,os,c0,kn,Sa,Th,Gt,bl,js,jr,Gr,Mo,gn,Cn,ho,uo,Nn,Li,Bn,wm,vm,bm,QG,$G,WG,YG,HG,ZG,qG,XG,KG,hl,ac,UT,XQ,GT,VT,jT,pw,DT,Vt,co,ci,jt,$t,Qt,ti,B1,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .header[_ngcontent-%COMP%]{margin-top:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]{padding:5px;width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .mat-mdc-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .title[_ngcontent-%COMP%]{margin-left:5px;font-size:initial}[_nghost-%COMP%]   .mat-mdc-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}[_nghost-%COMP%]   .mat-mdc-radio-button[_ngcontent-%COMP%]{display:inline-flex;position:relative;margin-left:12px}[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{margin-top:5px}[_nghost-%COMP%]   .mat-column-select[_ngcontent-%COMP%]{overflow:auto}[_nghost-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin:16px 0}[_nghost-%COMP%]   .thematics[_ngcontent-%COMP%]{max-height:35%;overflow:auto;margin-top:5px;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{overflow:auto;max-height:250px;width:98%}[_nghost-%COMP%]   .mat-column-typeResults[_ngcontent-%COMP%]{max-width:100px;margin-right:5px}[_nghost-%COMP%]   .buffer-unit[_ngcontent-%COMP%], [_nghost-%COMP%]   .radius-unit[_ngcontent-%COMP%]{display:flex;width:100%;padding:5px;box-sizing:border-box}[_nghost-%COMP%]   .radius[_ngcontent-%COMP%], [_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex-flow:column nowrap;flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}[_nghost-%COMP%]   .example-tree-invisible[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .tree-ul[_ngcontent-%COMP%]{margin:0;padding:0 0 0 20px;list-style-type:none}[_nghost-%COMP%]   .tree-check[_ngcontent-%COMP%], [_nghost-%COMP%]   .tree-check-2[_ngcontent-%COMP%]{position:relative;margin-left:auto;margin-right:5px}[_nghost-%COMP%]   .thematics-header[_ngcontent-%COMP%]{max-width:250px}[_nghost-%COMP%]   .checks-header[_ngcontent-%COMP%]{padding:none;max-width:calc(100% - 316px);overflow:hidden}[_nghost-%COMP%]   .mat-mdc-checkbox[_ngcontent-%COMP%]{padding:5px}[_nghost-%COMP%]   .mat-tree-node[_ngcontent-%COMP%]{position:relative;min-height:42px;width:280px}[_nghost-%COMP%]   .mat-mdc-header-cell[_ngcontent-%COMP%]{height:56px}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]{max-height:45%;width:98%}[_nghost-%COMP%]   .results[_ngcontent-%COMP%]   igo-entity-table[_ngcontent-%COMP%]     div.table-container{overflow:unset}
/*# sourceMappingURL=spatial-filter-item.component-WWE4Z3TN.css.map */`],changeDetection:0})}return r})();function ZIe(r,i){if(r&1&&($(0,"mat-option",12),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e.properties.nom," ")}}function XIe(r,i){if(r&1&&($(0,"mat-option",12),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.measure."+e)," ")}}var $8=(()=>{class r{spatialFilterService;messageService;store;get queryType(){return this._queryType}set queryType(e){this.formControl.setValue(""),this._queryType=e}_queryType;get zone(){return this._zone}set zone(e){this._zone=e,e||(this.zoneWithBuffer=void 0,this.bufferFormControl.setValue(0))}_zone;layers=[];zoneWithBuffer;selectedZone;measureUnit=or.Meters;formControl=new zc;bufferFormControl=new zc;get measureUnits(){return[or.Meters,or.Kilometers]}zoneChange=new Ke;zoneWithBufferChange=new Ke;bufferChange=new Ke;measureUnitChange=new Ke;formValueChanges$$;bufferValueChanges$$;constructor(e,n){this.spatialFilterService=e,this.messageService=n}ngOnInit(){this.formValueChanges$$=this.formControl.valueChanges.subscribe(e=>{e.length&&this.store.view.filter(n=>{let o=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return n.properties.nom.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(o)})}),this.bufferValueChanges$$=this.bufferFormControl.valueChanges.pipe(Br(500),$u()).subscribe(e=>{this.measureUnit===or.Meters&&e>0&&e<=1e5?(this.bufferChange.emit(e),this.spatialFilterService.loadBufferGeometry(this.selectedZone,nl.Predefined,e,this.queryType).subscribe(n=>{this.zoneWithBuffer=n,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):this.measureUnit===or.Kilometers&&e>0&&e<=100?(this.bufferChange.emit(e),this.spatialFilterService.loadBufferGeometry(this.selectedZone,nl.Predefined,e*1e3,this.queryType).subscribe(n=>{this.zoneWithBuffer=n,this.zoneWithBufferChange.emit(this.zoneWithBuffer)})):e===0&&this.layers.length>0?(this.bufferChange.emit(e),this.zoneWithBufferChange.emit(this.selectedZone)):(e<0||this.measureUnit===or.Meters&&e>1e5||this.measureUnit===or.Kilometers&&e>100)&&(this.bufferFormControl.setValue(0),this.messageService.alert("igo.geo.spatialFilter.bufferAlert","igo.geo.spatialFilter.warning"))})}ngOnDestroy(){this.formValueChanges$$.unsubscribe()}displayFn(e){return e?e.properties.nom:void 0}onZoneChange(e){e&&this.queryType&&this.spatialFilterService.loadItemById(e,this.queryType).subscribe(n=>{this.selectedZone=n,this.zoneChange.emit(n)})}onMeasureUnitChange(e){e!==this.measureUnit&&(this.measureUnit=e,this.measureUnitChange.emit(this.measureUnit),this.measureUnit===or.Meters?this.bufferFormControl.setValue(this.bufferFormControl.value*1e3):this.bufferFormControl.setValue(this.bufferFormControl.value/1e3))}static \u0275fac=function(n){return new(n||r)(Ie(fC),Ie(Gn))};static \u0275cmp=nt({type:r,selectors:[["igo-spatial-filter-list"]],inputs:{store:"store",queryType:"queryType",zone:"zone",layers:"layers"},outputs:{zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[lt],decls:23,vars:23,consts:[["input",""],["auto","matAutocomplete"],[1,"form-list"],[1,"zone-list"],["type","text","matInput","",3,"placeholder","formControl","matAutocomplete"],[3,"optionSelected","displayWith"],[3,"value",4,"ngFor","ngForOf"],[1,"buffer-div"],[1,"buffer"],["type","number","matInput","",3,"placeholder","formControl","value","readonly"],[1,"unit-field"],[3,"selectionChange","value"],[3,"value"]],template:function(n,o){if(n&1){let s=We();$(0,"div",2)(1,"mat-form-field",3)(2,"mat-label"),_e(3),le(4,"translate"),ee(),ct(5,"input",4,0),le(7,"translate"),$(8,"mat-autocomplete",5,1),ve("optionSelected",function(h){return we(s),xe(o.onZoneChange(h.option.value))}),Pe(10,ZIe,2,2,"mat-option",6),le(11,"async"),ee()(),$(12,"div")(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),_e(16),le(17,"translate"),ee(),ct(18,"input",9),le(19,"translate"),ee(),$(20,"mat-form-field",10)(21,"mat-select",11),ve("selectionChange",function(h){return we(s),xe(o.onMeasureUnitChange(h.value))}),Pe(22,XIe,3,4,"mat-option",6),ee()()()()()}if(n&2){let s=Xt(9);j(3),bt(ce(4,13,"igo.geo.spatialFilter.listLabel")),j(2),sr("placeholder",ce(7,15,"igo.geo.spatialFilter.listLabel")),z("formControl",o.formControl)("matAutocomplete",s),j(3),z("displayWith",o.displayFn),j(2),z("ngForOf",ce(11,17,o.store.view.all$())),j(6),bt(ce(17,19,"igo.geo.spatialFilter.buffer")),j(2),sr("placeholder",ce(19,21,"igo.geo.spatialFilter.buffer")),z("formControl",o.bufferFormControl)("value",0)("readonly",!o.zone),j(3),z("value",o.measureUnit),j(),z("ngForOf",o.measureUnits)}},dependencies:[jr,Gr,Mo,gn,Cn,Sn,os,c0,kn,Oh,kh,Nn,Su,Sa,Th,Li,Bn,ho,uo,Ei,Et,Tt],styles:[`[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .buffer-div[_ngcontent-%COMP%]{display:flex;width:100%}[_nghost-%COMP%]   .zone-list[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .buffer[_ngcontent-%COMP%]{flex:2}[_nghost-%COMP%]   .unit-field[_ngcontent-%COMP%]{flex:1;margin-left:8px}
/*# sourceMappingURL=spatial-filter-list.component-4H6VYTFA.css.map */`],changeDetection:0})}return r})();var Y8=["*"];function KIe(r,i){r&1&&Tn(0)}var QIe=["tabListContainer"],JIe=["tabList"],e5e=["tabListInner"],t5e=["nextPaginator"],i5e=["previousPaginator"],r5e=r=>({animationDuration:r}),n5e=(r,i)=>({value:r,params:i});function o5e(r,i){}var a5e=["tabBodyWrapper"],s5e=["tabHeader"];function l5e(r,i){}function c5e(r,i){if(r&1&&Pe(0,l5e,0,0,"ng-template",12),r&2){let e=ne().$implicit;z("cdkPortalOutlet",e.templateLabel)}}function u5e(r,i){if(r&1&&_e(0),r&2){let e=ne().$implicit;bt(e.textLabel)}}function d5e(r,i){if(r&1){let e=We();$(0,"div",7,2),ve("click",function(){let o=we(e),s=o.$implicit,l=o.$index,h=ne(),p=Xt(1);return xe(h._handleClick(s,p,l))})("cdkFocusChange",function(o){let s=we(e).$index,l=ne();return xe(l._tabFocusChanged(o,s))}),ct(2,"span",8)(3,"div",9),$(4,"span",10)(5,"span",11),Pe(6,c5e,1,1,null,12)(7,u5e,1,1),ee()()()}if(r&2){let e=i.$implicit,n=i.$index,o=Xt(1),s=ne();Vd(e.labelClass),dr("mdc-tab--active",s.selectedIndex===n),z("id",s._getTabLabelId(n))("disabled",e.disabled)("fitInkBarToContent",s.fitInkBarToContent),Or("tabIndex",s._getTabIndex(n))("aria-posinset",n+1)("aria-setsize",s._tabs.length)("aria-controls",s._getTabContentId(n))("aria-selected",s.selectedIndex===n)("aria-label",e.ariaLabel||null)("aria-labelledby",!e.ariaLabel&&e.ariaLabelledby?e.ariaLabelledby:null),j(3),z("matRippleTrigger",o)("matRippleDisabled",e.disabled||s.disableRipple),j(3),jc(e.templateLabel?6:7)}}function h5e(r,i){r&1&&Tn(0)}function p5e(r,i){if(r&1){let e=We();$(0,"mat-tab-body",13),ve("_onCentered",function(){we(e);let o=ne();return xe(o._removeTabBodyWrapperHeight())})("_onCentering",function(o){we(e);let s=ne();return xe(s._setTabBodyWrapperHeight(o))}),ee()}if(r&2){let e=i.$implicit,n=i.$index,o=ne();Vd(e.bodyClass),dr("mat-mdc-tab-body-active",o.selectedIndex===n),z("id",o._getTabContentId(n))("content",e.content)("position",e.position)("origin",e.origin)("animationDuration",o.animationDuration)("preserveContent",o.preserveContent),Or("tabindex",o.contentTabIndex!=null&&o.selectedIndex===n?o.contentTabIndex:null)("aria-labelledby",o._getTabLabelId(n))("aria-hidden",o.selectedIndex!==n)}}var m5e=new Ln("MatTabContent"),f5e=(()=>{class r{constructor(e){this.template=e}static{this.\u0275fac=function(n){return new(n||r)(Ie(gp))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matTabContent",""]],standalone:!0,features:[Xi([{provide:m5e,useExisting:r}])]})}}return r})(),g5e=new Ln("MatTabLabel"),ete=new Ln("MAT_TAB"),_5e=(()=>{class r extends lG{constructor(e,n,o){super(e,n),this._closestTab=o}static{this.\u0275fac=function(n){return new(n||r)(Ie(gp),Ie(Mh),Ie(ete,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["","mat-tab-label",""],["","matTabLabel",""]],standalone:!0,features:[Xi([{provide:g5e,useExisting:r}]),ll]})}}return r})(),tte=new Ln("MAT_TAB_GROUP"),PC=(()=>{class r{get templateLabel(){return this._templateLabel}set templateLabel(e){this._setTemplateLabelInput(e)}get content(){return this._contentPortal}constructor(e,n){this._viewContainerRef=e,this._closestTabGroup=n,this.disabled=!1,this._explicitContent=void 0,this.textLabel="",this._contentPortal=null,this._stateChanges=new Si,this.position=null,this.origin=null,this.isActive=!1}ngOnChanges(e){(e.hasOwnProperty("textLabel")||e.hasOwnProperty("disabled"))&&this._stateChanges.next()}ngOnDestroy(){this._stateChanges.complete()}ngOnInit(){this._contentPortal=new sG(this._explicitContent||this._implicitContent,this._viewContainerRef)}_setTemplateLabelInput(e){e&&e._closestTab===this&&(this._templateLabel=e)}static{this.\u0275fac=function(n){return new(n||r)(Ie(Mh),Ie(tte,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-tab"]],contentQueries:function(n,o,s){if(n&1&&(Do(s,_5e,5),Do(s,f5e,7,gp)),n&2){let l;bi(l=wi())&&(o.templateLabel=l.first),bi(l=wi())&&(o._explicitContent=l.first)}},viewQuery:function(n,o){if(n&1&&Ir(gp,7),n&2){let s;bi(s=wi())&&(o._implicitContent=s.first)}},hostAttrs:["hidden",""],inputs:{disabled:[2,"disabled","disabled",Vi],textLabel:[0,"label","textLabel"],ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],labelClass:"labelClass",bodyClass:"bodyClass"},exportAs:["matTab"],standalone:!0,features:[Xi([{provide:ete,useExisting:r}]),$n,wu,lt],ngContentSelectors:Y8,decls:1,vars:0,template:function(n,o){n&1&&(Kn(),Pe(0,KIe,1,0,"ng-template"))},encapsulation:2})}}return r})(),W8="mdc-tab-indicator--active",Qee="mdc-tab-indicator--no-transition",H8=class{constructor(i){this._items=i}hide(){this._items.forEach(i=>i.deactivateInkBar())}alignToElement(i){let e=this._items.find(o=>o.elementRef.nativeElement===i),n=this._currentItem;if(e!==n&&(n?.deactivateInkBar(),e)){let o=n?.elementRef.nativeElement.getBoundingClientRect?.();e.activateInkBar(o),this._currentItem=e}}},y5e=(()=>{class r{constructor(){this._elementRef=ga(ar),this._fitToContent=!1}get fitInkBarToContent(){return this._fitToContent}set fitInkBarToContent(e){this._fitToContent!==e&&(this._fitToContent=e,this._inkBarElement&&this._appendInkBarElement())}activateInkBar(e){let n=this._elementRef.nativeElement;if(!e||!n.getBoundingClientRect||!this._inkBarContentElement){n.classList.add(W8);return}let o=n.getBoundingClientRect(),s=e.width/o.width,l=e.left-o.left;n.classList.add(Qee),this._inkBarContentElement.style.setProperty("transform",`translateX(${l}px) scaleX(${s})`),n.getBoundingClientRect(),n.classList.remove(Qee),n.classList.add(W8),this._inkBarContentElement.style.setProperty("transform","")}deactivateInkBar(){this._elementRef.nativeElement.classList.remove(W8)}ngOnInit(){this._createInkBarElement()}ngOnDestroy(){this._inkBarElement?.remove(),this._inkBarElement=this._inkBarContentElement=null}_createInkBarElement(){let e=this._elementRef.nativeElement.ownerDocument||document,n=this._inkBarElement=e.createElement("span"),o=this._inkBarContentElement=e.createElement("span");n.className="mdc-tab-indicator",o.className="mdc-tab-indicator__content mdc-tab-indicator__content--underline",n.appendChild(this._inkBarContentElement),this._appendInkBarElement()}_appendInkBarElement(){this._inkBarElement;let e=this._fitToContent?this._elementRef.nativeElement.querySelector(".mdc-tab__content"):this._elementRef.nativeElement;e.appendChild(this._inkBarElement)}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275dir=Fi({type:r,inputs:{fitInkBarToContent:[2,"fitInkBarToContent","fitInkBarToContent",Vi]},features:[$n]})}}return r})();var ite=(()=>{class r extends y5e{constructor(e){super(),this.elementRef=e,this.disabled=!1}focus(){this.elementRef.nativeElement.focus()}getOffsetLeft(){return this.elementRef.nativeElement.offsetLeft}getOffsetWidth(){return this.elementRef.nativeElement.offsetWidth}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matTabLabelWrapper",""]],hostVars:3,hostBindings:function(n,o){n&2&&(Or("aria-disabled",!!o.disabled),dr("mat-mdc-tab-disabled",o.disabled))},inputs:{disabled:[2,"disabled","disabled",Vi]},standalone:!0,features:[$n,ll]})}}return r})(),Jee=Q_({passive:!0}),v5e=650,b5e=100,w5e=(()=>{class r{get selectedIndex(){return this._selectedIndex}set selectedIndex(e){let n=isNaN(e)?0:e;this._selectedIndex!=n&&(this._selectedIndexChanged=!0,this._selectedIndex=n,this._keyManager&&this._keyManager.updateActiveItem(n))}constructor(e,n,o,s,l,h,p){this._elementRef=e,this._changeDetectorRef=n,this._viewportRuler=o,this._dir=s,this._ngZone=l,this._platform=h,this._animationMode=p,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Si,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Si,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new Ke,this.indexFocused=new Ke,this._sharedResizeObserver=ga(K7),this._injector=ga(jd),l.runOutsideAngular(()=>{jo(e.nativeElement,"mouseleave").pipe(Vo(this._destroyed)).subscribe(()=>{this._stopInterval()})})}ngAfterViewInit(){jo(this._previousPaginator.nativeElement,"touchstart",Jee).pipe(Vo(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),jo(this._nextPaginator.nativeElement,"touchstart",Jee).pipe(Vo(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){let e=this._dir?this._dir.change:ai("ltr"),n=this._sharedResizeObserver.observe(this._elementRef.nativeElement).pipe(Br(32),Vo(this._destroyed)),o=this._viewportRuler.change(150).pipe(Vo(this._destroyed)),s=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new PA(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap().skipPredicate(()=>!1),this._keyManager.updateActiveItem(this._selectedIndex),M1(s,{injector:this._injector}),Fs(e,o,n,this._items.changes,this._itemsResized()).pipe(Vo(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),s()})}),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.subscribe(l=>{this.indexFocused.emit(l),this._setTabFocus(l)})}_itemsResized(){return typeof ResizeObserver!="function"?Gd:this._items.changes.pipe(ec(this._items),Xn(e=>new $r(n=>this._ngZone.runOutsideAngular(()=>{let o=new ResizeObserver(s=>n.next(s));return e.forEach(s=>o.observe(s.elementRef.nativeElement)),()=>{o.disconnect()}}))),Of(1),SA(e=>e.some(n=>n.contentRect.width>0&&n.contentRect.height>0)))}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._keyManager?.destroy(),this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(e){if(!O7(e))switch(e.keyCode){case 13:case 32:if(this.focusIndex!==this.selectedIndex){let n=this._items.get(this.focusIndex);n&&!n.disabled&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(e))}break;default:this._keyManager.onKeydown(e)}}_onContentChanges(){let e=this._elementRef.nativeElement.textContent;e!==this._currentTextContent&&(this._currentTextContent=e||"",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(e){!this._isValidIndex(e)||this.focusIndex===e||!this._keyManager||this._keyManager.setActiveItem(e)}_isValidIndex(e){return this._items?!!this._items.toArray()[e]:!0}_setTabFocus(e){if(this._showPaginationControls&&this._scrollToLabel(e),this._items&&this._items.length){this._items.toArray()[e].focus();let n=this._tabListContainer.nativeElement;this._getLayoutDirection()=="ltr"?n.scrollLeft=0:n.scrollLeft=n.scrollWidth-n.offsetWidth}}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_updateTabScrollPosition(){if(this.disablePagination)return;let e=this.scrollDistance,n=this._getLayoutDirection()==="ltr"?-e:e;this._tabList.nativeElement.style.transform=`translateX(${Math.round(n)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(e){this._scrollTo(e)}_scrollHeader(e){let n=this._tabListContainer.nativeElement.offsetWidth,o=(e=="before"?-1:1)*n/3;return this._scrollTo(this._scrollDistance+o)}_handlePaginatorClick(e){this._stopInterval(),this._scrollHeader(e)}_scrollToLabel(e){if(this.disablePagination)return;let n=this._items?this._items.toArray()[e]:null;if(!n)return;let o=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:s,offsetWidth:l}=n.elementRef.nativeElement,h,p;this._getLayoutDirection()=="ltr"?(h=s,p=h+l):(p=this._tabListInner.nativeElement.offsetWidth-s,h=p-l);let m=this.scrollDistance,f=this.scrollDistance+o;h<m?this.scrollDistance-=m-h:p>f&&(this.scrollDistance+=Math.min(p-f,h-m))}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{let e=this._tabListInner.nativeElement.scrollWidth,n=this._elementRef.nativeElement.offsetWidth,o=e-n>=5;o||(this.scrollDistance=0),o!==this._showPaginationControls&&(this._showPaginationControls=o,this._changeDetectorRef.markForCheck())}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=this.scrollDistance==0,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){let e=this._tabListInner.nativeElement.scrollWidth,n=this._tabListContainer.nativeElement.offsetWidth;return e-n||0}_alignInkBarToSelectedTab(){let e=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,n=e?e.elementRef.nativeElement:null;n?this._inkBar.alignToElement(n):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(e,n){n&&n.button!=null&&n.button!==0||(this._stopInterval(),dm(v5e,b5e).pipe(Vo(Fs(this._stopScrolling,this._destroyed))).subscribe(()=>{let{maxScrollDistance:o,distance:s}=this._scrollHeader(e);(s===0||s>=o)&&this._stopInterval()}))}_scrollTo(e){if(this.disablePagination)return{maxScrollDistance:0,distance:0};let n=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(n,e)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:n,distance:this._scrollDistance}}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(lr),Ie(Sx),Ie(Rl,8),Ie(tc),Ie(Bf),Ie(Ah,8))}}static{this.\u0275dir=Fi({type:r,inputs:{disablePagination:[2,"disablePagination","disablePagination",Vi],selectedIndex:[2,"selectedIndex","selectedIndex",Uo]},outputs:{selectFocusedIndex:"selectFocusedIndex",indexFocused:"indexFocused"},features:[$n]})}}return r})(),x5e=(()=>{class r extends w5e{constructor(e,n,o,s,l,h,p){super(e,n,o,s,l,h,p),this.disableRipple=!1}ngAfterContentInit(){this._inkBar=new H8(this._items),super.ngAfterContentInit()}_itemSelected(e){e.preventDefault()}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(lr),Ie(Sx),Ie(Rl,8),Ie(tc),Ie(Bf),Ie(Ah,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-tab-header"]],contentQueries:function(n,o,s){if(n&1&&Do(s,ite,4),n&2){let l;bi(l=wi())&&(o._items=l)}},viewQuery:function(n,o){if(n&1&&(Ir(QIe,7),Ir(JIe,7),Ir(e5e,7),Ir(t5e,5),Ir(i5e,5)),n&2){let s;bi(s=wi())&&(o._tabListContainer=s.first),bi(s=wi())&&(o._tabList=s.first),bi(s=wi())&&(o._tabListInner=s.first),bi(s=wi())&&(o._nextPaginator=s.first),bi(s=wi())&&(o._previousPaginator=s.first)}},hostAttrs:[1,"mat-mdc-tab-header"],hostVars:4,hostBindings:function(n,o){n&2&&dr("mat-mdc-tab-header-pagination-controls-enabled",o._showPaginationControls)("mat-mdc-tab-header-rtl",o._getLayoutDirection()=="rtl")},inputs:{ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"],disableRipple:[2,"disableRipple","disableRipple",Vi]},standalone:!0,features:[$n,ll,lt],ngContentSelectors:Y8,decls:13,vars:10,consts:[["previousPaginator",""],["tabListContainer",""],["tabList",""],["tabListInner",""],["nextPaginator",""],["mat-ripple","",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-before",3,"click","mousedown","touchend","matRippleDisabled"],[1,"mat-mdc-tab-header-pagination-chevron"],[1,"mat-mdc-tab-label-container",3,"keydown"],["role","tablist",1,"mat-mdc-tab-list",3,"cdkObserveContent"],[1,"mat-mdc-tab-labels"],["mat-ripple","",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-after",3,"mousedown","click","touchend","matRippleDisabled"]],template:function(n,o){if(n&1){let s=We();Kn(),$(0,"div",5,0),ve("click",function(){return we(s),xe(o._handlePaginatorClick("before"))})("mousedown",function(h){return we(s),xe(o._handlePaginatorPress("before",h))})("touchend",function(){return we(s),xe(o._stopInterval())}),ct(2,"div",6),ee(),$(3,"div",7,1),ve("keydown",function(h){return we(s),xe(o._handleKeydown(h))}),$(5,"div",8,2),ve("cdkObserveContent",function(){return we(s),xe(o._onContentChanges())}),$(7,"div",9,3),Tn(9),ee()()(),$(10,"div",10,4),ve("mousedown",function(h){return we(s),xe(o._handlePaginatorPress("after",h))})("click",function(){return we(s),xe(o._handlePaginatorClick("after"))})("touchend",function(){return we(s),xe(o._stopInterval())}),ct(12,"div",6),ee()}n&2&&(dr("mat-mdc-tab-header-pagination-disabled",o._disableScrollBefore),z("matRippleDisabled",o._disableScrollBefore||o.disableRipple),j(3),dr("_mat-animation-noopable",o._animationMode==="NoopAnimations"),j(2),Or("aria-label",o.ariaLabel||null)("aria-labelledby",o.ariaLabelledby||null),j(5),dr("mat-mdc-tab-header-pagination-disabled",o._disableScrollAfter),z("matRippleDisabled",o._disableScrollAfter||o.disableRipple))},dependencies:[fm,R7],styles:[".mat-mdc-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mdc-tab-indicator .mdc-tab-indicator__content{transition-duration:var(--mat-tab-animation-duration, 250ms)}.mat-mdc-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;box-sizing:content-box;outline:0}.mat-mdc-tab-header-pagination::-moz-focus-inner{border:0}.mat-mdc-tab-header-pagination .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color, var(--mat-app-on-surface))}.mat-mdc-tab-header-pagination-controls-enabled .mat-mdc-tab-header-pagination{display:flex}.mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after{padding-left:4px}.mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-pagination-after{padding-right:4px}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-mdc-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;height:8px;width:8px;border-color:var(--mat-tab-header-pagination-icon-color, var(--mat-app-on-surface))}.mat-mdc-tab-header-pagination-disabled{box-shadow:none;cursor:default;pointer-events:none}.mat-mdc-tab-header-pagination-disabled .mat-mdc-tab-header-pagination-chevron{opacity:.4}.mat-mdc-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-mdc-tab-list{transition:none}.mat-mdc-tab-label-container{display:flex;flex-grow:1;overflow:hidden;z-index:1;border-bottom-style:solid;border-bottom-width:var(--mat-tab-header-divider-height);border-bottom-color:var(--mat-tab-header-divider-color, var(--mat-app-surface-variant))}.mat-mdc-tab-group-inverted-header .mat-mdc-tab-label-container{border-bottom:none;border-top-style:solid;border-top-width:var(--mat-tab-header-divider-height);border-top-color:var(--mat-tab-header-divider-color, var(--mat-app-surface-variant))}.mat-mdc-tab-labels{display:flex;flex:1 0 auto}[mat-align-tabs=center]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:center}[mat-align-tabs=end]>.mat-mdc-tab-header .mat-mdc-tab-labels{justify-content:flex-end}.cdk-drop-list .mat-mdc-tab-labels,.mat-mdc-tab-labels.cdk-drop-list{min-height:var(--mdc-secondary-navigation-tab-container-height)}.mat-mdc-tab::before{margin:5px}.cdk-high-contrast-active .mat-mdc-tab[aria-disabled=true]{color:GrayText}"],encapsulation:2})}}return r})(),S5e=new Ln("MAT_TABS_CONFIG"),C5e={translateTab:Gf("translateTab",[Ud("center, void, left-origin-center, right-origin-center",Ls({transform:"none",visibility:"visible"})),Ud("left",Ls({transform:"translate3d(-100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),Ud("right",Ls({transform:"translate3d(100%, 0, 0)",minHeight:"1px",visibility:"hidden"})),qu("* => left, * => right, left => center, right => center",Hu("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")),qu("void => left-origin-center",[Ls({transform:"translate3d(-100%, 0, 0)",visibility:"hidden"}),Hu("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")]),qu("void => right-origin-center",[Ls({transform:"translate3d(100%, 0, 0)",visibility:"hidden"}),Hu("{{animationDuration}} cubic-bezier(0.35, 0, 0.25, 1)")])])},A5e=(()=>{class r extends NA{constructor(e,n,o,s){super(e,n,s),this._host=o,this._centeringSub=Es.EMPTY,this._leavingSub=Es.EMPTY}ngOnInit(){super.ngOnInit(),this._centeringSub=this._host._beforeCentering.pipe(ec(this._host._isCenterPosition(this._host._position))).subscribe(e=>{this._host._content&&e&&!this.hasAttached()&&this.attach(this._host._content)}),this._leavingSub=this._host._afterLeavingCenter.subscribe(()=>{this._host.preserveContent||this.detach()})}ngOnDestroy(){super.ngOnDestroy(),this._centeringSub.unsubscribe(),this._leavingSub.unsubscribe()}static{this.\u0275fac=function(n){return new(n||r)(Ie(C7),Ie(Mh),Ie(Dl(()=>rte)),Ie(rc))}}static{this.\u0275dir=Fi({type:r,selectors:[["","matTabBodyHost",""]],standalone:!0,features:[ll]})}}return r})(),rte=(()=>{class r{set position(e){this._positionIndex=e,this._computePositionAnimationState()}constructor(e,n,o){this._elementRef=e,this._dir=n,this._dirChangeSubscription=Es.EMPTY,this._translateTabComplete=new Si,this._onCentering=new Ke,this._beforeCentering=new Ke,this._afterLeavingCenter=new Ke,this._onCentered=new Ke(!0),this.animationDuration="500ms",this.preserveContent=!1,n&&(this._dirChangeSubscription=n.change.subscribe(s=>{this._computePositionAnimationState(s),o.markForCheck()})),this._translateTabComplete.subscribe(s=>{this._isCenterPosition(s.toState)&&this._isCenterPosition(this._position)&&this._onCentered.emit(),this._isCenterPosition(s.fromState)&&!this._isCenterPosition(this._position)&&this._afterLeavingCenter.emit()})}ngOnInit(){this._position=="center"&&this.origin!=null&&(this._position=this._computePositionFromOrigin(this.origin))}ngOnDestroy(){this._dirChangeSubscription.unsubscribe(),this._translateTabComplete.complete()}_onTranslateTabStarted(e){let n=this._isCenterPosition(e.toState);this._beforeCentering.emit(n),n&&this._onCentering.emit(this._elementRef.nativeElement.clientHeight)}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_isCenterPosition(e){return e=="center"||e=="left-origin-center"||e=="right-origin-center"}_computePositionAnimationState(e=this._getLayoutDirection()){this._positionIndex<0?this._position=e=="ltr"?"left":"right":this._positionIndex>0?this._position=e=="ltr"?"right":"left":this._position="center"}_computePositionFromOrigin(e){let n=this._getLayoutDirection();return n=="ltr"&&e<=0||n=="rtl"&&e>0?"left-origin-center":"right-origin-center"}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(Rl,8),Ie(lr))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-tab-body"]],viewQuery:function(n,o){if(n&1&&Ir(NA,5),n&2){let s;bi(s=wi())&&(o._portalHost=s.first)}},hostAttrs:[1,"mat-mdc-tab-body"],inputs:{_content:[0,"content","_content"],origin:"origin",animationDuration:"animationDuration",preserveContent:"preserveContent",position:"position"},outputs:{_onCentering:"_onCentering",_beforeCentering:"_beforeCentering",_afterLeavingCenter:"_afterLeavingCenter",_onCentered:"_onCentered"},standalone:!0,features:[lt],decls:3,vars:6,consts:[["content",""],["cdkScrollable","",1,"mat-mdc-tab-body-content"],["matTabBodyHost",""]],template:function(n,o){if(n&1){let s=We();$(0,"div",1,0),ve("@translateTab.start",function(h){return we(s),xe(o._onTranslateTabStarted(h))})("@translateTab.done",function(h){return we(s),xe(o._translateTabComplete.next(h))}),Pe(2,o5e,0,0,"ng-template",2),ee()}n&2&&z("@translateTab",Ys(3,n5e,o._position,fn(1,r5e,o.animationDuration)))},dependencies:[A5e,oG],styles:['.mat-mdc-tab-body{top:0;left:0;right:0;bottom:0;position:absolute;display:block;overflow:hidden;outline:0;flex-basis:100%}.mat-mdc-tab-body.mat-mdc-tab-body-active{position:relative;overflow-x:hidden;overflow-y:auto;z-index:1;flex-grow:1}.mat-mdc-tab-group.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body.mat-mdc-tab-body-active{overflow-y:hidden}.mat-mdc-tab-body-content{height:100%;overflow:auto}.mat-mdc-tab-group-dynamic-height .mat-mdc-tab-body-content{overflow:hidden}.mat-mdc-tab-body-content[style*="visibility: hidden"]{display:none}'],encapsulation:2,data:{animation:[C5e.translateTab]}})}}return r})(),M5e=0,I5e=!0,f3=(()=>{class r{get fitInkBarToContent(){return this._fitInkBarToContent}set fitInkBarToContent(e){this._fitInkBarToContent=e,this._changeDetectorRef.markForCheck()}get selectedIndex(){return this._selectedIndex}set selectedIndex(e){this._indexToSelect=isNaN(e)?null:e}get animationDuration(){return this._animationDuration}set animationDuration(e){let n=e+"";this._animationDuration=/^\d+$/.test(n)?e+"ms":n}get contentTabIndex(){return this._contentTabIndex}set contentTabIndex(e){this._contentTabIndex=isNaN(e)?null:e}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){if(!I5e)throw new Error("mat-tab-group background color must be set through the Sass theming API");let n=this._elementRef.nativeElement.classList;n.remove("mat-tabs-with-background",`mat-background-${this.backgroundColor}`),e&&n.add("mat-tabs-with-background",`mat-background-${e}`),this._backgroundColor=e}constructor(e,n,o,s){this._elementRef=e,this._changeDetectorRef=n,this._animationMode=s,this._tabs=new MA,this._indexToSelect=0,this._lastFocusedTabIndex=null,this._tabBodyWrapperHeight=0,this._tabsSubscription=Es.EMPTY,this._tabLabelSubscription=Es.EMPTY,this._fitInkBarToContent=!1,this.stretchTabs=!0,this.dynamicHeight=!1,this._selectedIndex=null,this.headerPosition="above",this.disablePagination=!1,this.disableRipple=!1,this.preserveContent=!1,this.selectedIndexChange=new Ke,this.focusChange=new Ke,this.animationDone=new Ke,this.selectedTabChange=new Ke(!0),this._isServer=!ga(Bf).isBrowser,this._groupId=M5e++,this.animationDuration=o&&o.animationDuration?o.animationDuration:"500ms",this.disablePagination=o&&o.disablePagination!=null?o.disablePagination:!1,this.dynamicHeight=o&&o.dynamicHeight!=null?o.dynamicHeight:!1,o?.contentTabIndex!=null&&(this.contentTabIndex=o.contentTabIndex),this.preserveContent=!!o?.preserveContent,this.fitInkBarToContent=o&&o.fitInkBarToContent!=null?o.fitInkBarToContent:!1,this.stretchTabs=o&&o.stretchTabs!=null?o.stretchTabs:!0}ngAfterContentChecked(){let e=this._indexToSelect=this._clampTabIndex(this._indexToSelect);if(this._selectedIndex!=e){let n=this._selectedIndex==null;if(!n){this.selectedTabChange.emit(this._createChangeEvent(e));let o=this._tabBodyWrapper.nativeElement;o.style.minHeight=o.clientHeight+"px"}Promise.resolve().then(()=>{this._tabs.forEach((o,s)=>o.isActive=s===e),n||(this.selectedIndexChange.emit(e),this._tabBodyWrapper.nativeElement.style.minHeight="")})}this._tabs.forEach((n,o)=>{n.position=o-e,this._selectedIndex!=null&&n.position==0&&!n.origin&&(n.origin=e-this._selectedIndex)}),this._selectedIndex!==e&&(this._selectedIndex=e,this._lastFocusedTabIndex=null,this._changeDetectorRef.markForCheck())}ngAfterContentInit(){this._subscribeToAllTabChanges(),this._subscribeToTabLabels(),this._tabsSubscription=this._tabs.changes.subscribe(()=>{let e=this._clampTabIndex(this._indexToSelect);if(e===this._selectedIndex){let n=this._tabs.toArray(),o;for(let s=0;s<n.length;s++)if(n[s].isActive){this._indexToSelect=this._selectedIndex=s,this._lastFocusedTabIndex=null,o=n[s];break}!o&&n[e]&&Promise.resolve().then(()=>{n[e].isActive=!0,this.selectedTabChange.emit(this._createChangeEvent(e))})}this._changeDetectorRef.markForCheck()})}_subscribeToAllTabChanges(){this._allTabs.changes.pipe(ec(this._allTabs)).subscribe(e=>{this._tabs.reset(e.filter(n=>n._closestTabGroup===this||!n._closestTabGroup)),this._tabs.notifyOnChanges()})}ngOnDestroy(){this._tabs.destroy(),this._tabsSubscription.unsubscribe(),this._tabLabelSubscription.unsubscribe()}realignInkBar(){this._tabHeader&&this._tabHeader._alignInkBarToSelectedTab()}updatePagination(){this._tabHeader&&this._tabHeader.updatePagination()}focusTab(e){let n=this._tabHeader;n&&(n.focusIndex=e)}_focusChanged(e){this._lastFocusedTabIndex=e,this.focusChange.emit(this._createChangeEvent(e))}_createChangeEvent(e){let n=new q8;return n.index=e,this._tabs&&this._tabs.length&&(n.tab=this._tabs.toArray()[e]),n}_subscribeToTabLabels(){this._tabLabelSubscription&&this._tabLabelSubscription.unsubscribe(),this._tabLabelSubscription=Fs(...this._tabs.map(e=>e._stateChanges)).subscribe(()=>this._changeDetectorRef.markForCheck())}_clampTabIndex(e){return Math.min(this._tabs.length-1,Math.max(e||0,0))}_getTabLabelId(e){return`mat-tab-label-${this._groupId}-${e}`}_getTabContentId(e){return`mat-tab-content-${this._groupId}-${e}`}_setTabBodyWrapperHeight(e){if(!this.dynamicHeight||!this._tabBodyWrapperHeight)return;let n=this._tabBodyWrapper.nativeElement;n.style.height=this._tabBodyWrapperHeight+"px",this._tabBodyWrapper.nativeElement.offsetHeight&&(n.style.height=e+"px")}_removeTabBodyWrapperHeight(){let e=this._tabBodyWrapper.nativeElement;this._tabBodyWrapperHeight=e.clientHeight,e.style.height="",this.animationDone.emit()}_handleClick(e,n,o){n.focusIndex=o,e.disabled||(this.selectedIndex=o)}_getTabIndex(e){let n=this._lastFocusedTabIndex??this.selectedIndex;return e===n?0:-1}_tabFocusChanged(e,n){e&&e!=="mouse"&&e!=="touch"&&(this._tabHeader.focusIndex=n)}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(lr),Ie(S5e,8),Ie(Ah,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-tab-group"]],contentQueries:function(n,o,s){if(n&1&&Do(s,PC,5),n&2){let l;bi(l=wi())&&(o._allTabs=l)}},viewQuery:function(n,o){if(n&1&&(Ir(a5e,5),Ir(s5e,5)),n&2){let s;bi(s=wi())&&(o._tabBodyWrapper=s.first),bi(s=wi())&&(o._tabHeader=s.first)}},hostAttrs:[1,"mat-mdc-tab-group"],hostVars:10,hostBindings:function(n,o){n&2&&(Vd("mat-"+(o.color||"primary")),fo("--mat-tab-animation-duration",o.animationDuration),dr("mat-mdc-tab-group-dynamic-height",o.dynamicHeight)("mat-mdc-tab-group-inverted-header",o.headerPosition==="below")("mat-mdc-tab-group-stretch-tabs",o.stretchTabs))},inputs:{color:"color",fitInkBarToContent:[2,"fitInkBarToContent","fitInkBarToContent",Vi],stretchTabs:[2,"mat-stretch-tabs","stretchTabs",Vi],dynamicHeight:[2,"dynamicHeight","dynamicHeight",Vi],selectedIndex:[2,"selectedIndex","selectedIndex",Uo],headerPosition:"headerPosition",animationDuration:"animationDuration",contentTabIndex:[2,"contentTabIndex","contentTabIndex",Uo],disablePagination:[2,"disablePagination","disablePagination",Vi],disableRipple:[2,"disableRipple","disableRipple",Vi],preserveContent:[2,"preserveContent","preserveContent",Vi],backgroundColor:"backgroundColor",ariaLabel:[0,"aria-label","ariaLabel"],ariaLabelledby:[0,"aria-labelledby","ariaLabelledby"]},outputs:{selectedIndexChange:"selectedIndexChange",focusChange:"focusChange",animationDone:"animationDone",selectedTabChange:"selectedTabChange"},exportAs:["matTabGroup"],standalone:!0,features:[Xi([{provide:tte,useExisting:r}]),$n,lt],ngContentSelectors:Y8,decls:9,vars:8,consts:[["tabHeader",""],["tabBodyWrapper",""],["tabNode",""],[3,"indexFocused","selectFocusedIndex","selectedIndex","disableRipple","disablePagination","aria-label","aria-labelledby"],["role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",1,"mdc-tab","mat-mdc-tab","mat-mdc-focus-indicator",3,"id","mdc-tab--active","class","disabled","fitInkBarToContent"],[1,"mat-mdc-tab-body-wrapper"],["role","tabpanel",3,"id","mat-mdc-tab-body-active","class","content","position","origin","animationDuration","preserveContent"],["role","tab","matTabLabelWrapper","","cdkMonitorElementFocus","",1,"mdc-tab","mat-mdc-tab","mat-mdc-focus-indicator",3,"click","cdkFocusChange","id","disabled","fitInkBarToContent"],[1,"mdc-tab__ripple"],["mat-ripple","",1,"mat-mdc-tab-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mdc-tab__content"],[1,"mdc-tab__text-label"],[3,"cdkPortalOutlet"],["role","tabpanel",3,"_onCentered","_onCentering","id","content","position","origin","animationDuration","preserveContent"]],template:function(n,o){if(n&1){let s=We();Kn(),$(0,"mat-tab-header",3,0),ve("indexFocused",function(h){return we(s),xe(o._focusChanged(h))})("selectFocusedIndex",function(h){return we(s),xe(o.selectedIndex=h)}),mx(2,d5e,8,17,"div",4,zF),ee(),Pe(4,h5e,1,0),$(5,"div",5,1),mx(7,p5e,1,13,"mat-tab-body",6,zF),ee()}n&2&&(z("selectedIndex",o.selectedIndex||0)("disableRipple",o.disableRipple)("disablePagination",o.disablePagination)("aria-label",o.ariaLabel)("aria-labelledby",o.ariaLabelledby),j(2),fx(o._tabs),j(2),jc(o._isServer?4:-1),j(),dr("_mat-animation-noopable",o._animationMode==="NoopAnimations"),j(2),fx(o._tabs))},dependencies:[x5e,ite,z7,fm,NA,rte],styles:['.mdc-tab{min-width:90px;padding:0 24px;display:flex;flex:1 0 auto;justify-content:center;box-sizing:border-box;border:none;outline:none;text-align:center;white-space:nowrap;cursor:pointer;z-index:1}.mdc-tab__content{display:flex;align-items:center;justify-content:center;height:inherit;pointer-events:none}.mdc-tab__text-label{transition:150ms color linear;display:inline-block;line-height:1;z-index:2}.mdc-tab--active .mdc-tab__text-label{transition-delay:100ms}._mat-animation-noopable .mdc-tab__text-label{transition:none}.mdc-tab-indicator{display:flex;position:absolute;top:0;left:0;justify-content:center;width:100%;height:100%;pointer-events:none;z-index:1}.mdc-tab-indicator__content{transition:var(--mat-tab-animation-duration, 250ms) transform cubic-bezier(0.4, 0, 0.2, 1);transform-origin:left;opacity:0}.mdc-tab-indicator__content--underline{align-self:flex-end;box-sizing:border-box;width:100%;border-top-style:solid}.mdc-tab-indicator--active .mdc-tab-indicator__content{opacity:1}._mat-animation-noopable .mdc-tab-indicator__content,.mdc-tab-indicator--no-transition .mdc-tab-indicator__content{transition:none}.mat-mdc-tab-ripple{position:absolute;top:0;left:0;bottom:0;right:0;pointer-events:none}.mat-mdc-tab{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-decoration:none;background:none;height:var(--mdc-secondary-navigation-tab-container-height);font-family:var(--mat-tab-header-label-text-font, var(--mat-app-title-small-font));font-size:var(--mat-tab-header-label-text-size, var(--mat-app-title-small-size));letter-spacing:var(--mat-tab-header-label-text-tracking, var(--mat-app-title-small-tracking));line-height:var(--mat-tab-header-label-text-line-height, var(--mat-app-title-small-line-height));font-weight:var(--mat-tab-header-label-text-weight, var(--mat-app-title-small-weight))}.mat-mdc-tab.mdc-tab{flex-grow:0}.mat-mdc-tab .mdc-tab-indicator__content--underline{border-color:var(--mdc-tab-indicator-active-indicator-color, var(--mat-app-primary));border-top-width:var(--mdc-tab-indicator-active-indicator-height);border-radius:var(--mdc-tab-indicator-active-indicator-shape)}.mat-mdc-tab:hover .mdc-tab__text-label{color:var(--mat-tab-header-inactive-hover-label-text-color, var(--mat-app-on-surface))}.mat-mdc-tab:focus .mdc-tab__text-label{color:var(--mat-tab-header-inactive-focus-label-text-color, var(--mat-app-on-surface))}.mat-mdc-tab.mdc-tab--active .mdc-tab__text-label{color:var(--mat-tab-header-active-label-text-color, var(--mat-app-on-surface))}.mat-mdc-tab.mdc-tab--active .mdc-tab__ripple::before,.mat-mdc-tab.mdc-tab--active .mat-ripple-element{background-color:var(--mat-tab-header-active-ripple-color, var(--mat-app-on-surface))}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab__text-label{color:var(--mat-tab-header-active-hover-label-text-color, var(--mat-app-on-surface))}.mat-mdc-tab.mdc-tab--active:hover .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-hover-indicator-color, var(--mat-app-primary))}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab__text-label{color:var(--mat-tab-header-active-focus-label-text-color, var(--mat-app-on-surface))}.mat-mdc-tab.mdc-tab--active:focus .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-focus-indicator-color, var(--mat-app-primary))}.mat-mdc-tab.mat-mdc-tab-disabled{opacity:.4;pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__content{pointer-events:none}.mat-mdc-tab.mat-mdc-tab-disabled .mdc-tab__ripple::before,.mat-mdc-tab.mat-mdc-tab-disabled .mat-ripple-element{background-color:var(--mat-tab-header-disabled-ripple-color)}.mat-mdc-tab .mdc-tab__ripple::before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;opacity:0;pointer-events:none;background-color:var(--mat-tab-header-inactive-ripple-color, var(--mat-app-on-surface))}.mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-inactive-label-text-color, var(--mat-app-on-surface));display:inline-flex;align-items:center}.mat-mdc-tab .mdc-tab__content{position:relative;pointer-events:auto}.mat-mdc-tab:hover .mdc-tab__ripple::before{opacity:.04}.mat-mdc-tab.cdk-program-focused .mdc-tab__ripple::before,.mat-mdc-tab.cdk-keyboard-focused .mdc-tab__ripple::before{opacity:.12}.mat-mdc-tab .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color, var(--mat-app-on-surface))}.mat-mdc-tab-group.mat-mdc-tab-group-stretch-tabs>.mat-mdc-tab-header .mat-mdc-tab{flex-grow:1}.mat-mdc-tab-group{display:flex;flex-direction:column;max-width:100%}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination{background-color:var(--mat-tab-header-with-background-background-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mat-mdc-tab .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background.mat-primary>.mat-mdc-tab-header .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-header .mat-mdc-tab:not(.mdc-tab--active) .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-focus-indicator::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-focus-indicator::before{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mdc-tab__ripple::before,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-ripple-element,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mdc-tab__ripple::before{background-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-group.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header{flex-direction:column-reverse}.mat-mdc-tab-group.mat-mdc-tab-group-inverted-header .mdc-tab-indicator__content--underline{align-self:flex-start}.mat-mdc-tab-body-wrapper{position:relative;overflow:hidden;display:flex;transition:height 500ms cubic-bezier(0.35, 0, 0.25, 1)}.mat-mdc-tab-body-wrapper._mat-animation-noopable{transition:none !important;animation:none !important}'],encapsulation:2})}}return r})(),q8=class{};var g3=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[ul,ul]})}}return r})();function E5e(r,i){if(r&1&&($(0,"mat-option",8),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.terrapi."+e)," ")}}var T5e=(()=>{class r{store;queryType=["Arrond","CircFed","CircProv","DirReg","Mun","MRC","AdmRegion","RegTour"];selectedTypeIndex=new zc(0);spatialType=nl;activeDrawType=this.spatialType.Polygon;selectedQueryType;zone;layers=[];type;eventType=new Ke;eventQueryType=new Ke;zoneChange=new Ke;zoneWithBufferChange=new Ke;bufferChange=new Ke;measureUnitChange=new Ke;ngOnInit(){this.selectedTypeIndex.value===0&&(this.type=this.spatialType.Predefined),this.selectedTypeIndex.value===1&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onTypeChange(){this.selectedTypeIndex.value===0&&(this.type=nl.Predefined),this.selectedTypeIndex.value===1&&(this.type=this.activeDrawType),this.eventType.emit(this.type)}onDrawTypeChange(e){this.activeDrawType=e,this.eventType.emit(this.activeDrawType)}onSelectionChange(){this.eventQueryType.emit(this.selectedQueryType),this.zoneChange.emit(void 0)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-spatial-filter-type"]],inputs:{store:"store",selectedQueryType:"selectedQueryType",zone:"zone",layers:"layers"},outputs:{eventType:"eventType",eventQueryType:"eventQueryType",zoneChange:"zoneChange",zoneWithBufferChange:"zoneWithBufferChange",bufferChange:"bufferChange",measureUnitChange:"measureUnitChange"},standalone:!0,features:[lt],decls:22,vars:25,consts:[[3,"selectedIndexChange","selectedTabChange","selectedIndex"],[3,"label"],[3,"selectionChange","valueChange","value"],[3,"value",4,"ngFor","ngForOf"],[3,"zoneChange","zoneWithBufferChange","bufferChange","measureUnitChange","store","queryType","zone","layers"],[1,"spatial-type-toggle"],[3,"change","value"],[3,"value","matTooltip"],[3,"value"]],template:function(n,o){n&1&&($(0,"mat-tab-group",0),ve("selectedIndexChange",function(l){return o.selectedTypeIndex.setValue(l)})("selectedTabChange",function(){return o.onTypeChange()}),$(1,"mat-tab",1),le(2,"translate"),$(3,"mat-form-field")(4,"mat-label"),_e(5),le(6,"translate"),ee(),$(7,"mat-select",2),ve("selectionChange",function(){return o.onSelectionChange()}),eo("valueChange",function(l){return Jn(o.selectedQueryType,l)||(o.selectedQueryType=l),l}),Pe(8,E5e,3,4,"mat-option",3),ee()(),$(9,"igo-spatial-filter-list",4),ve("zoneChange",function(l){return o.zoneChange.emit(l)})("zoneWithBufferChange",function(l){return o.zoneWithBufferChange.emit(l)})("bufferChange",function(l){return o.bufferChange.emit(l)})("measureUnitChange",function(l){return o.measureUnitChange.emit(l)}),ee()(),$(10,"mat-tab",1),le(11,"translate"),$(12,"div",5)(13,"mat-button-toggle-group",6),ve("change",function(l){return o.onDrawTypeChange(l.value)}),$(14,"mat-button-toggle",7),le(15,"translate"),$(16,"mat-icon"),_e(17,"pentagon"),ee()(),$(18,"mat-button-toggle",7),le(19,"translate"),$(20,"mat-icon"),_e(21,"circle"),ee()()()()()()),n&2&&(z("selectedIndex",o.selectedTypeIndex.value),j(),z("label",ce(2,15,"igo.geo.spatialFilter.predefined")),j(4),bt(ce(6,17,"igo.geo.spatialFilter.searchLabel")),j(2),Qn("value",o.selectedQueryType),j(),z("ngForOf",o.queryType),j(),z("store",o.store)("queryType",o.selectedQueryType)("zone",o.zone)("layers",o.layers),j(),z("label",ce(11,19,"igo.geo.spatialFilter.draw")),j(3),z("value",o.activeDrawType),j(),z("value",o.spatialType.Polygon)("matTooltip",ce(15,21,"igo.geo.spatialFilter.drawPolygon")),j(4),z("value",o.spatialType.Point)("matTooltip",ce(19,23,"igo.geo.spatialFilter.drawCircle")))},dependencies:[g3,PC,f3,jr,Gr,Mo,ho,uo,Nn,Li,Bn,$8,Ed,Gu,mu,Qt,ti,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   .mat-mdc-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-content{overflow:hidden}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-label{padding:10px}[_nghost-%COMP%]   .mat-mdc-tab-group[_ngcontent-%COMP%]     .mat-mdc-tab-body-wrapper{margin-top:5px}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   .spatial-type-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}
/*# sourceMappingURL=spatial-filter-type.component-SWQY73RK.css.map */`],changeDetection:0})}return r})();var F5e=["matDatetimepickerCalendarBody",""];function P5e(r,i){if(r&1&&($(0,"tr",2)(1,"td",3),_e(2),ee()()),r&2){let e=ne();j(),Or("colspan",e.numCols),j(),Qe(" ",e.label," ")}}function L5e(r,i){if(r&1&&($(0,"td",7),_e(1),ee()),r&2){let e=ne(2);Or("colspan",e._firstRowOffset),j(),Qe(" ",e._firstRowOffset>=e.labelMinRequiredCells?e.label:""," ")}}function k5e(r,i){if(r&1){let e=We();$(0,"td",8),ve("click",function(){let o=we(e).$implicit,s=ne(2);return xe(s._cellClicked(o))}),$(1,"div",9),_e(2),ee()()}if(r&2){let e=i.$implicit,n=i.index,o=ne().index,s=ne();dr("mat-datetimepicker-calendar-body-active",s._isActiveCell(o,n))("mat-datetimepicker-calendar-body-disabled",!e.enabled),Or("aria-disabled",!e.enabled||null)("aria-label",e.ariaLabel),j(),dr("mat-datetimepicker-calendar-body-selected",s.selectedValue===e.value)("mat-datetimepicker-calendar-body-today",s.todayValue===e.value),Or("aria-selected",s.selectedValue===e.value),j(),Qe(" ",e.displayValue," ")}}function O5e(r,i){if(r&1&&($(0,"tr",4),Pe(1,L5e,2,2,"td",5)(2,k5e,3,12,"td",6),ee()),r&2){let e=i.$implicit,n=i.index,o=ne();j(),z("ngIf",n===0&&o._firstRowOffset),j(),z("ngForOf",e)}}function D5e(r,i){if(r&1&&($(0,"div",7),_e(1),ee()),r&2){let e=i.$implicit,n=ne();fo("font-size",e.fontSize)("left",e.left+"%")("top",e.top+"%"),dr("mat-datetimepicker-clock-cell-disabled",!e.enabled)("mat-datetimepicker-clock-cell-selected",n._selectedHour===e.value),j(),Qe(" ",e.displayValue," ")}}function R5e(r,i){if(r&1&&($(0,"div",7),_e(1),ee()),r&2){let e=i.$implicit,n=ne();fo("left",e.left+"%")("top",e.top+"%"),dr("mat-datetimepicker-clock-cell-disabled",!e.enabled)("mat-datetimepicker-clock-cell-selected",n._selectedMinute===e.value),j(),Qe(" ",e.displayValue," ")}}function N5e(r,i){if(r&1&&($(0,"th"),_e(1),ee()),r&2){let e=i.$implicit;Or("aria-label",e.long),j(),Qe(" ",e.narrow," ")}}function B5e(r,i){r&1&&($(0,"mat-icon"),_e(1,"arrow_drop_down"),ee())}function G5e(r,i){if(r&1){let e=We();$(0,"div",10),ve("click",function(){we(e);let o=ne();return xe(o._yearClicked())}),_e(1),Pe(2,B5e,2,0,"mat-icon",11),ee()}if(r&2){let e=ne();dr("active",e.currentView==="year"||e.currentView==="multi-year"),j(),Qe(" ",e._yearLabel," "),j(),z("ngIf",e.multiYearSelector||e.type==="year")}}function j5e(r,i){if(r&1){let e=We();$(0,"span",12),ve("click",function(){we(e);let o=ne();return xe(o._dateClicked())}),_e(1),ee()}if(r&2){let e=ne();dr("active",e.currentView==="month")("not-clickable",e.type==="month"),j(),bt(e._dateLabel)}}function V5e(r,i){if(r&1){let e=We();$(0,"span",17)(1,"span",18),ve("click",function(){we(e);let o=ne(2);return xe(o._ampmClicked("AM"))}),_e(2,"AM"),ee(),_e(3,"/"),$(4,"span",18),ve("click",function(){we(e);let o=ne(2);return xe(o._ampmClicked("PM"))}),_e(5,"PM"),ee()()}if(r&2){let e=ne(2);j(),dr("active",e._AMPM==="AM"),j(3),dr("active",e._AMPM==="PM")}}function U5e(r,i){if(r&1){let e=We();$(0,"span",13)(1,"span",14),ve("click",function(){we(e);let o=ne();return xe(o._hoursClicked())}),_e(2),ee(),_e(3,":"),$(4,"span",15),ve("click",function(){we(e);let o=ne();return xe(o._minutesClicked())}),_e(5),ee(),ct(6,"br"),Pe(7,V5e,6,4,"span",16),ee()}if(r&2){let e=ne();dr("active",e.currentView==="clock"),j(),dr("active",e._clockView==="hour"),j(),bt(e._hoursLabel),j(2),dr("active",e._clockView==="minute"),j(),bt(e._minutesLabel),j(2),z("ngIf",e.twelvehour)}}function z5e(r,i){if(r&1){let e=We();$(0,"div",19)(1,"div",20)(2,"div",21),ve("click",function(){we(e);let o=ne();return xe(o._previousClicked())}),fp(),$(3,"svg",22),ct(4,"path",23),ee()(),x7(),$(5,"div",24),ve("@slideCalendar.done",function(){we(e);let o=ne();return xe(o._calendarStateDone())}),$(6,"strong"),_e(7),ee()(),$(8,"div",25),ve("click",function(){we(e);let o=ne();return xe(o._nextClicked())}),fp(),$(9,"svg",22),ct(10,"path",26),ee()()()()}if(r&2){let e=ne();j(2),dr("disabled",!e._previousEnabled()),Or("aria-disabled",!e._previousEnabled())("aria-label",e._ariaLabelPrev),j(3),z("@slideCalendar",e._calendarState),j(2),bt(e._monthYearLabel),j(),dr("disabled",!e._nextEnabled()),Or("aria-disabled",!e._nextEnabled())("aria-label",e._ariaLabelNext)}}function $5e(r,i){if(r&1){let e=We();$(0,"mat-datetimepicker-month-view",27),ve("_userSelection",function(){we(e);let o=ne();return xe(o._userSelected())})("selectedChange",function(o){we(e);let s=ne();return xe(s._dateSelected(o))}),ee()}if(r&2){let e=ne();z("activeDate",e._activeDate)("dateFilter",e._dateFilterForViews)("selected",e.selected)("type",e.type)}}function W5e(r,i){if(r&1){let e=We();$(0,"mat-datetimepicker-year-view",27),ve("_userSelection",function(){we(e);let o=ne();return xe(o._userSelected())})("selectedChange",function(o){we(e);let s=ne();return xe(s._monthSelected(o))}),ee()}if(r&2){let e=ne();z("activeDate",e._activeDate)("dateFilter",e._dateFilterForViews)("selected",e.selected)("type",e.type)}}function H5e(r,i){if(r&1){let e=We();$(0,"mat-datetimepicker-multi-year-view",28),ve("_userSelection",function(){we(e);let o=ne();return xe(o._userSelected())})("selectedChange",function(o){we(e);let s=ne();return xe(s._yearSelected(o))}),ee()}if(r&2){let e=ne();z("activeDate",e._activeDate)("dateFilter",e._dateFilterForViews)("maxDate",e.maxDate)("minDate",e.minDate)("selected",e.selected)("type",e.type)}}function q5e(r,i){if(r&1){let e=We();$(0,"mat-datetimepicker-clock",29),ve("_userSelection",function(){we(e);let o=ne();return xe(o._userSelected())})("activeDateChange",function(o){we(e);let s=ne();return xe(s._onActiveDateChange(o))})("selectedChange",function(o){we(e);let s=ne();return xe(s._timeSelected(o))}),ee()}if(r&2){let e=ne();z("dateFilter",e.dateFilter)("interval",e.timeInterval)("maxDate",e.maxDate)("minDate",e.minDate)("selected",e._activeDate)("startView",e._clockView)("twelvehour",e.twelvehour)}}function Y5e(r,i){r&1&&(fp(),$(0,"svg",4),ct(1,"path",5),ee())}function Z5e(r,i){r&1&&(fp(),$(0,"svg",4),ct(1,"path",6),ee())}function X5e(r,i){r&1&&(fp(),$(0,"svg",4),ct(1,"path",7)(2,"path",8),ee())}var tm=class extends P1{constructor(i){super(),this._delegate=i}getValidDateOrNull(i){return this.isDateInstance(i)&&this.isValid(i)?i:null}compareDatetime(i,e,n=!0){return this.compareDate(i,e)||this.getHour(i)-this.getHour(e)||n&&this.getMinute(i)-this.getMinute(e)}sameDatetime(i,e){if(i&&e){let n=this.isValid(i),o=this.isValid(e);return n&&o?!this.compareDatetime(i,e):n===o}return i===e}sameYear(i,e){return i&&e&&this.getYear(i)===this.getYear(e)}sameDay(i,e){return i&&e&&this.getDate(i)===this.getDate(e)&&this.sameMonthAndYear(i,e)}sameHour(i,e){return i&&e&&this.getHour(i)===this.getHour(e)&&this.sameDay(i,e)}sameMinute(i,e){return i&&e&&this.getMinute(i)===this.getMinute(e)&&this.sameHour(i,e)}sameMonthAndYear(i,e){if(i&&e){let n=this.isValid(i),o=this.isValid(e);return n&&o?!(this.getYear(i)-this.getYear(e)||this.getMonth(i)-this.getMonth(e)):n===o}return i===e}deserialize(i){return this._delegate.deserialize(i)}clone(i){return this._delegate.clone(i)}addCalendarYears(i,e){return this._delegate.addCalendarYears(i,e)}addCalendarMonths(i,e){return this._delegate.addCalendarMonths(i,e)}addCalendarDays(i,e){return this._delegate.addCalendarDays(i,e)}getYear(i){return this._delegate.getYear(i)}getMonth(i){return this._delegate.getMonth(i)}getDate(i){return this._delegate.getDate(i)}getDayOfWeek(i){return this._delegate.getDayOfWeek(i)}getMonthNames(i){return this._delegate.getMonthNames(i)}getDateNames(){return this._delegate.getDateNames()}getDayOfWeekNames(i){return this._delegate.getDayOfWeekNames(i)}getYearName(i){return this._delegate.getYearName(i)}getFirstDayOfWeek(){return this._delegate.getFirstDayOfWeek()}getNumDaysInMonth(i){return this._delegate.getNumDaysInMonth(i)}createDate(i,e,n){return this._delegate.createDate(i,e,n)}today(){return this._delegate.today()}parse(i,e){return this._delegate.parse(i,e)}format(i,e){return this._delegate.format(i,e)}toIso8601(i){return this._delegate.toIso8601(i)}isDateInstance(i){return this._delegate.isDateInstance(i)}isValid(i){return this._delegate.isValid(i)}invalid(){return this._delegate.invalid()}clampDate(i,e,n){return e&&this.compareDatetime(i,e)<0?e:n&&this.compareDatetime(i,n)>0?n:i}},Iw=new Ln("mat-datetime-formats"),K5e=dte(24,r=>String(r)),Q5e=dte(60,r=>String(r));function dte(r,i){let e=Array(r);for(let n=0;n<r;n++)e[n]=i(n);return e}var J5e=(()=>{class r extends tm{constructor(e,n){super(n),this.setLocale(e)}clone(e){return this.createDatetime(this.getYear(e),this.getMonth(e),this.getDate(e),this.getHour(e),this.getMinute(e))}getHour(e){return e.getHours()}getMinute(e){return e.getMinutes()}isInNextMonth(e,n){let o=this.getDateInNextMonth(e);return this.sameMonthAndYear(o,n)}createDatetime(e,n,o,s,l){if(n<0||n>11)throw Error(`Invalid month index "${n}". Month index has to be between 0 and 11.`);if(o<1)throw Error(`Invalid date "${o}". Date has to be greater than 0.`);if(s<0||s>23)throw Error(`Invalid hour "${s}". Hour has to be between 0 and 23.`);if(l<0||l>59)throw Error(`Invalid minute "${l}". Minute has to be between 0 and 59.`);let h=this._createDateWithOverflow(e,n,o,s,l);if(h.getMonth()!==n)throw Error(`Invalid date "${o}" for month with index "${n}".`);return h}getFirstDateOfMonth(e){let n=new Date;return n.setFullYear(e.getFullYear(),e.getMonth(),1),n}getHourNames(){return K5e}getMinuteNames(){return Q5e}addCalendarYears(e,n){return this.addCalendarMonths(e,n*12)}addCalendarMonths(e,n){let o=this._createDateWithOverflow(this.getYear(e),this.getMonth(e)+n,this.getDate(e),this.getHour(e),this.getMinute(e));return this.getMonth(o)!==((this.getMonth(e)+n)%12+12)%12&&(o=this._createDateWithOverflow(this.getYear(o),this.getMonth(o),0,this.getHour(e),this.getMinute(e))),o}addCalendarDays(e,n){return this._createDateWithOverflow(this.getYear(e),this.getMonth(e),this.getDate(e)+n,this.getHour(e),this.getMinute(e))}addCalendarHours(e,n){return this._createDateWithOverflow(this.getYear(e),this.getMonth(e),this.getDate(e),this.getHour(e)+n,this.getMinute(e))}addCalendarMinutes(e,n){return this._createDateWithOverflow(this.getYear(e),this.getMonth(e),this.getDate(e),this.getHour(e),this.getMinute(e)+n)}toIso8601(e){return super.toIso8601(e)+"T"+[this._2digit(e.getUTCHours()),this._2digit(e.getUTCMinutes())].join(":")}getDateInNextMonth(e){return new Date(e.getFullYear(),e.getMonth()+1,1,e.getHours(),e.getMinutes())}_stripDirectionalityCharacters(e){return e.replace(/[\u200e\u200f]/g,"")}_2digit(e){return("00"+e).slice(-2)}_createDateWithOverflow(e,n,o,s,l){let h=new Date(e,n,o,s,l);return e>=0&&e<100&&h.setFullYear(this.getYear(h)-1900),h}static{this.\u0275fac=function(n){return new(n||r)(pt($7,8),pt(P1))}}static{this.\u0275prov=qt({token:r,factory:r.\u0275fac})}}return r})(),eEe={parse:{},display:{dateInput:{year:"numeric",month:"2-digit",day:"2-digit"},monthInput:{month:"long"},datetimeInput:{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"},timeInput:{hour:"2-digit",minute:"2-digit"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"},popupHeaderDateLabel:{weekday:"short",month:"short",day:"2-digit"}}},tEe=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({providers:[{provide:tm,useClass:J5e}],imports:[W7]})}}return r})(),hte=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({providers:[{provide:Iw,useValue:eEe}],imports:[tEe,kA]})}}return r})(),xGt=Gf("fadeInContent",[Ud("showing",Ls({opacity:1})),qu("void => showing",[Ls({opacity:0}),Hu("150ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)")])]),_3=Gf("slideCalendar",[qu("* => left",[Hu(180,YF([Ls({transform:"translateX(100%)",offset:.5}),Ls({transform:"translateX(-100%)",offset:.51}),Ls({transform:"translateX(0)",offset:1})]))]),qu("* => right",[Hu(180,YF([Ls({transform:"translateX(-100%)",offset:.5}),Ls({transform:"translateX(100%)",offset:.51}),Ls({transform:"translateX(0)",offset:1})]))])]);function im(r){return Error(`MatDatetimepickerComponent: No provider found for ${r}. You must import one of the following modules at your application root: MatNativeDatetimeModule, MatMomentDatetimeModule, or provide a custom implementation.`)}var kC=function(r){return r[r.DATE=0]="DATE",r[r.HOUR=1]="HOUR",r[r.MINUTE=2]="MINUTE",r}(kC||{}),OC=class{constructor(i,e,n,o){this.value=i,this.displayValue=e,this.ariaLabel=n,this.enabled=o}},Q8=(()=>{class r{constructor(){this.numCols=7,this.allowDisabledSelection=!1,this.activeCell=0,this.selectedValueChange=new Ke}get _firstRowOffset(){return this.rows&&this.rows.length&&this.rows[0].length?this.numCols-this.rows[0].length:0}_cellClicked(e){!this.allowDisabledSelection&&!e.enabled||this.selectedValueChange.emit(e.value)}_isActiveCell(e,n){let o=e*this.numCols+n;return e&&(o-=this._firstRowOffset),o===this.activeCell}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=nt({type:r,selectors:[["tbody","matDatetimepickerCalendarBody",""]],hostAttrs:[1,"mat-datetimepicker-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",selectedValue:"selectedValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",allowDisabledSelection:"allowDisabledSelection",activeCell:"activeCell"},outputs:{selectedValueChange:"selectedValueChange"},attrs:F5e,decls:2,vars:2,consts:[["aria-hidden","true",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],["aria-hidden","true"],[1,"mat-datetimepicker-calendar-body-label"],["role","row"],["aria-hidden","true","class","mat-datetimepicker-calendar-body-label",4,"ngIf"],["class","mat-datetimepicker-calendar-body-cell","role","button",3,"mat-datetimepicker-calendar-body-active","mat-datetimepicker-calendar-body-disabled","click",4,"ngFor","ngForOf"],["aria-hidden","true",1,"mat-datetimepicker-calendar-body-label"],["role","button",1,"mat-datetimepicker-calendar-body-cell",3,"click"],[1,"mat-datetimepicker-calendar-body-cell-content"]],template:function(n,o){n&1&&Pe(0,P5e,3,2,"tr",0)(1,O5e,3,2,"tr",1),n&2&&(z("ngIf",o._firstRowOffset<o.labelMinRequiredCells),j(),z("ngForOf",o.rows))},dependencies:[Li,Gt],styles:[`.mat-datetimepicker-calendar-body{font-size:13px;min-width:224px}.mat-datetimepicker-calendar-body-label{padding:7.1428571429% 0 7.1428571429% 7.1428571429%;height:0;line-height:0;color:#0000008a;transform:translate(-6px);text-align:left}.mat-datetimepicker-calendar-body-cell{position:relative;width:14.2857142857%;height:0;line-height:0;padding:7.1428571429% 0;text-align:center;outline:none;cursor:pointer}.mat-datetimepicker-calendar-body-disabled{cursor:default;pointer-events:none}.mat-datetimepicker-calendar-body-cell-content{position:absolute;top:5%;left:5%;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;color:#000000de;border:1px solid transparent;border-radius:50px}.mat-datetimepicker-calendar-body-disabled>.mat-datetimepicker-calendar-body-cell-content:not(.mat-datetimepicker-calendar-body-selected){color:#00000061}:not(.mat-datetimepicker-calendar-body-disabled):hover>.mat-datetimepicker-calendar-body-cell-content:not(.mat-datetimepicker-calendar-body-selected),.mat-datetimepicker-calendar-body-active>.mat-datetimepicker-calendar-body-cell-content:not(.mat-datetimepicker-calendar-body-selected){background-color:#0000001f}.mat-datetimepicker-calendar-body-disabled>.mat-datetimepicker-calendar-body-today:not(.mat-datetimepicker-calendar-body-selected){border-color:#0000002e}[dir=rtl] .mat-datetimepicker-calendar-body-label{padding:0 7.1428571429% 0 0;transform:translate(6px);text-align:right}
`],encapsulation:2,changeDetection:0})}}return r})(),fh=24,K8=4,iEe=(()=>{class r{constructor(e,n){if(this._adapter=e,this._dateFormats=n,this._userSelection=new Ke,this.type="date",this.selectedChange=new Ke,!this._adapter)throw im("DatetimeAdapter");if(!this._dateFormats)throw im("MAT_DATETIME_FORMATS");this._activeDate=this._adapter.today()}get activeDate(){return this._activeDate}set activeDate(e){let n=this._activeDate;this._activeDate=e||this._adapter.today(),n&&this._activeDate&&!pte(this._adapter,n,this._activeDate,this.minDate,this.maxDate)&&this._init()}get selected(){return this._selected}set selected(e){this._selected=e,this._selectedYear=this._selected&&this._adapter.getYear(this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._getValidDateOrNull(this._adapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._getValidDateOrNull(this._adapter.deserialize(e))}ngAfterContentInit(){this._init()}_yearSelected(e){let n=this._adapter.getMonth(this.activeDate),o=this._adapter.createDatetime(e,n,1,0,0);this.selectedChange.emit(this._adapter.createDatetime(e,n,Math.min(this._adapter.getDate(this.activeDate),this._adapter.getNumDaysInMonth(o)),this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate))),this.type==="year"&&this._userSelection.emit()}_getActiveCell(){return LC(this._adapter,this.activeDate,this.minDate,this.maxDate)}_calendarStateDone(){this._calendarState=""}_init(){this._todayYear=this._adapter.getYear(this._adapter.today()),this._yearLabel=this._adapter.getYearName(this.activeDate);let n=this._adapter.getYear(this.activeDate)-LC(this._adapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let o=0,s=[];o<fh;o++)s.push(n+o),s.length==K8&&(this._years.push(s.map(l=>this._createCellForYear(l))),s=[])}_createCellForYear(e){let n=this._adapter.getYearName(this._adapter.createDate(e,0,1));return new OC(e,n,n,this._shouldEnableYear(e))}_shouldEnableYear(e){if(e==null||this.maxDate&&e>this._adapter.getYear(this.maxDate)||this.minDate&&e<this._adapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let n=this._adapter.createDate(e,0,1);for(let o=n;this._adapter.getYear(o)==e;o=this._adapter.addCalendarDays(o,1))if(this.dateFilter(o))return!0;return!1}_getYearInCurrentRange(e){let n=this._adapter.getYear(e);return this._isInRange(n)?n:null}_isInRange(e){return!0}_getValidDateOrNull(e){return this._adapter.isDateInstance(e)&&this._adapter.isValid(e)?e:null}static{this.\u0275fac=function(n){return new(n||r)(Ie(tm,8),Ie(Iw,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-multi-year-view"]],inputs:{type:"type",dateFilter:"dateFilter",activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate"},outputs:{_userSelection:"_userSelection",selectedChange:"selectedChange"},decls:3,vars:6,consts:[[1,"mat-datetimepicker-calendar-table"],[1,"mat-datetimepicker-calendar-table-header"],["allowDisabledSelection","true","matDatetimepickerCalendarBody","","role","grid",3,"selectedValueChange","activeCell","numCols","rows","selectedValue","todayValue"]],template:function(n,o){n&1&&($(0,"table",0),ct(1,"thead",1),$(2,"tbody",2),ve("@slideCalendar.done",function(){return o._calendarStateDone()})("selectedValueChange",function(l){return o._yearSelected(l)}),ee()()),n&2&&(j(2),z("@slideCalendar",o._calendarState)("activeCell",o._getActiveCell())("numCols",4)("rows",o._years)("selectedValue",o._selectedYear)("todayValue",o._todayYear))},dependencies:[Q8],encapsulation:2,data:{animation:[_3]},changeDetection:0})}}return r})();function pte(r,i,e,n,o){let s=r.getYear(i),l=r.getYear(e),h=mte(r,n,o);return Math.floor((s-h)/fh)===Math.floor((l-h)/fh)}function LC(r,i,e,n){let o=r.getYear(i);return rEe(o-mte(r,e,n),fh)}function mte(r,i,e){let n=0;return e?n=r.getYear(e)-fh+1:i&&(n=r.getYear(i)),n}function rEe(r,i){return(r%i+i)%i}var Cw=50,Z8=27.5,E_=41.25,Aw=7.0833,nEe=(()=>{class r{constructor(e,n){this._element=e,this._adapter=n,this._userSelection=new Ke,this.interval=1,this.twelvehour=!1,this.selectedChange=new Ke,this.activeDateChange=new Ke,this._hours=[],this._minutes=[],this._hourView=!0,this._timeChanged=!1,this.mouseMoveListener=o=>{this._handleMousemove(o)},this.mouseUpListener=()=>{this._handleMouseup()}}get activeDate(){return this._activeDate}set activeDate(e){let n=this._activeDate;this._activeDate=this._adapter.clampDate(e,this.minDate,this.maxDate),this._adapter.sameMinute(n,this._activeDate)||this._init()}get selected(){return this._selected}set selected(e){this._selected=this._adapter.getValidDateOrNull(this._adapter.deserialize(e)),this._selected&&(this.activeDate=this._selected)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._adapter.getValidDateOrNull(this._adapter.deserialize(e))}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._adapter.getValidDateOrNull(this._adapter.deserialize(e))}set startView(e){this._hourView=e!="minute"}get _hand(){let e=this._adapter.getHour(this.activeDate);this.twelvehour?(e===0&&(e=24),this._selectedHour=e>12?e-12:e):this._selectedHour=e,this._selectedMinute=this._adapter.getMinute(this.activeDate);let n=0,o=E_;return this._hourView?(o=this._selectedHour>0&&this._selectedHour<13?E_:Z8,this.twelvehour&&(o=E_),n=Math.round(this._selectedHour*(360/(24/2)))):n=Math.round(this._selectedMinute*(360/60)),{transform:`rotate(${n}deg)`,height:`${o}%`,"margin-top":`${50-o}%`}}ngAfterContentInit(){this.activeDate=this._activeDate||this._adapter.today(),this._init()}_handleMousedown(e){this._timeChanged=!1,this.setTime(e),document.addEventListener("mousemove",this.mouseMoveListener),document.addEventListener("touchmove",this.mouseMoveListener),document.addEventListener("mouseup",this.mouseUpListener),document.addEventListener("touchend",this.mouseUpListener)}_handleMousemove(e){e.preventDefault(),this.setTime(e)}_handleMouseup(){document.removeEventListener("mousemove",this.mouseMoveListener),document.removeEventListener("touchmove",this.mouseMoveListener),document.removeEventListener("mouseup",this.mouseUpListener),document.removeEventListener("touchend",this.mouseUpListener),this._timeChanged&&(this.selectedChange.emit(this.activeDate),this._hourView||this._userSelection.emit())}_init(){this._hours.length=0,this._minutes.length=0;let e=this._adapter.getHourNames(),n=this._adapter.getMinuteNames();if(this.twelvehour)for(let o=1;o<e.length/2+1;o++){let s=o/6*Math.PI,l=E_,h=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),this._adapter.getDate(this.activeDate),o+1,0),p=(!this.minDate||this._adapter.compareDatetime(h,this.minDate)>=0)&&(!this.maxDate||this._adapter.compareDatetime(h,this.maxDate)<=0);this._hours.push({value:o,displayValue:o===0?"00":e[o],enabled:p,top:Cw-Math.cos(s)*l-Aw,left:Cw+Math.sin(s)*l-Aw})}else for(let o=0;o<e.length;o++){let s=o/6*Math.PI,l=o>0&&o<13,h=l?E_:Z8,p=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),this._adapter.getDate(this.activeDate),o,0),m=(!this.minDate||this._adapter.compareDatetime(p,this.minDate,!1)>=0)&&(!this.maxDate||this._adapter.compareDatetime(p,this.maxDate,!1)<=0)&&(!this.dateFilter||this.dateFilter(p,kC.HOUR));this._hours.push({value:o,displayValue:o===0?"00":e[o],enabled:m,top:Cw-Math.cos(s)*h-Aw,left:Cw+Math.sin(s)*h-Aw,fontSize:o>0&&o<13?"":"80%"})}for(let o=0;o<n.length;o+=5){let s=o/30*Math.PI,l=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),this._adapter.getDate(this.activeDate),this._adapter.getHour(this.activeDate),o),h=(!this.minDate||this._adapter.compareDatetime(l,this.minDate)>=0)&&(!this.maxDate||this._adapter.compareDatetime(l,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(l,kC.MINUTE));this._minutes.push({value:o,displayValue:o===0?"00":n[o],enabled:h,top:Cw-Math.cos(s)*E_-Aw,left:Cw+Math.sin(s)*E_-Aw})}}setTime(e){let n=this._element.nativeElement,o=n.getBoundingClientRect(),s=n.offsetWidth,l=n.offsetHeight,h=e.pageX!==void 0?e.pageX:e.touches[0].pageX,p=e.pageY!==void 0?e.pageY:e.touches[0].pageY,m=s/2-(h-o.left-window.pageXOffset),f=l/2-(p-o.top-window.pageYOffset),g=Math.atan2(-m,f),y=Math.PI/(this._hourView?6:this.interval?30/this.interval:30),_=Math.sqrt(m*m+f*f),w=this._hourView&&_>(s*(E_/100)+s*(Z8/100))/2;g<0&&(g=Math.PI*2+g);let A=Math.round(g/y),k;if(this._hourView){if(this.twelvehour?A=A===0?12:A:(A===12&&(A=0),A=w?A===0?12:A:A===0?0:A+12),!this._hours.find(R=>R?.value===A)?.enabled)return;k=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),this._adapter.getDate(this.activeDate),A,this._adapter.getMinute(this.activeDate))}else{if(this.interval&&(A*=this.interval),A===60&&(A=0),!this._minutes.find(R=>R?.value===A)?.enabled)return;k=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),this._adapter.getDate(this.activeDate),this._adapter.getHour(this.activeDate),A)}this._timeChanged=!0,this.activeDate=k,this.activeDateChange.emit(this.activeDate)}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(tm))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-clock"]],hostAttrs:["role","clock"],hostBindings:function(n,o){n&1&&ve("mousedown",function(l){return o._handleMousedown(l)})},inputs:{dateFilter:"dateFilter",interval:"interval",twelvehour:"twelvehour",activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",startView:"startView"},outputs:{_userSelection:"_userSelection",selectedChange:"selectedChange",activeDateChange:"activeDateChange"},decls:7,vars:7,consts:[[1,"mat-datetimepicker-clock"],[1,"mat-datetimepicker-clock-center"],[1,"mat-datetimepicker-clock-hand",3,"ngStyle"],[1,"mat-datetimepicker-clock-hours"],["class","mat-datetimepicker-clock-cell",3,"mat-datetimepicker-clock-cell-disabled","mat-datetimepicker-clock-cell-selected","fontSize","left","top",4,"ngFor","ngForOf"],[1,"mat-datetimepicker-clock-minutes"],["class","mat-datetimepicker-clock-cell",3,"mat-datetimepicker-clock-cell-disabled","mat-datetimepicker-clock-cell-selected","left","top",4,"ngFor","ngForOf"],[1,"mat-datetimepicker-clock-cell"]],template:function(n,o){n&1&&($(0,"div",0),ct(1,"div",1)(2,"div",2),$(3,"div",3),Pe(4,D5e,2,11,"div",4),ee(),$(5,"div",5),Pe(6,R5e,2,9,"div",6),ee()()),n&2&&(j(2),z("ngStyle",o._hand),j(),dr("active",o._hourView),j(),z("ngForOf",o._hours),j(),dr("active",!o._hourView),j(),z("ngForOf",o._minutes))},dependencies:[Li,cl],styles:['[_nghost-%COMP%]{position:relative;display:block;min-width:224px;margin:8px;font-size:14px;box-sizing:border-box;-webkit-user-select:none;user-select:none}.mat-datetimepicker-clock[_ngcontent-%COMP%]{position:relative;width:100%;height:0;padding-top:100%;background-color:#e0e0e0;border-radius:50%}.mat-datetimepicker-clock-center[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;width:2%;height:2%;margin:-1%;border-radius:50%}.mat-datetimepicker-clock-hand[_ngcontent-%COMP%]{position:absolute;inset:0;width:1px;margin:0 auto;transform-origin:bottom}.mat-datetimepicker-clock-hand[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-4px;left:-4px;width:8px;height:8px;border-radius:50%}.mat-datetimepicker-clock-hours[_ngcontent-%COMP%], .mat-datetimepicker-clock-minutes[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;visibility:hidden;transition:.35s;transform:scale(1.2)}.mat-datetimepicker-clock-hours.active[_ngcontent-%COMP%], .mat-datetimepicker-clock-minutes.active[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:scale(1)}.mat-datetimepicker-clock-minutes[_ngcontent-%COMP%]{transform:scale(.8)}.mat-datetimepicker-clock-cell[_ngcontent-%COMP%]{position:absolute;display:flex;width:14.1666%;height:14.1666%;color:#000000de;justify-content:center;box-sizing:border-box;border-radius:50%;align-items:center;cursor:pointer}.mat-datetimepicker-clock-cell[_ngcontent-%COMP%]:not(.mat-datetimepicker-clock-cell-selected):not(.mat-datetimepicker-clock-cell-disabled):hover{background-color:#0000001a}.mat-datetimepicker-clock-cell.mat-datetimepicker-clock-cell-disabled[_ngcontent-%COMP%]{color:#00000061;pointer-events:none}.mat-datetimepicker-clock-cell.mat-datetimepicker-clock-cell-selected[_ngcontent-%COMP%]{color:#fff}']})}}return r})(),X8=7,oEe=(()=>{class r{constructor(e,n){if(this._adapter=e,this._dateFormats=n,this.type="date",this._userSelection=new Ke,this.selectedChange=new Ke,!this._adapter)throw im("DatetimeAdapter");if(!this._dateFormats)throw im("MAT_DATETIME_FORMATS");let o=this._adapter.getFirstDayOfWeek(),s=this._adapter.getDayOfWeekNames("narrow"),h=this._adapter.getDayOfWeekNames("long").map((p,m)=>({long:p,narrow:s[m]}));this._weekdays=h.slice(o).concat(h.slice(0,o)),this._activeDate=this._adapter.today()}get activeDate(){return this._activeDate}set activeDate(e){let n=this._activeDate;this._activeDate=e||this._adapter.today(),n&&this._activeDate&&!this._adapter.sameMonthAndYear(n,this._activeDate)&&(this._init(),this._adapter.isInNextMonth(n,this._activeDate)?this.calendarState("right"):this.calendarState("left"))}get selected(){return this._selected}set selected(e){this._selected=e,this._selectedDate=this._getDateInCurrentMonth(this.selected)}ngAfterContentInit(){this._init()}_dateSelected(e){this.selectedChange.emit(this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),e,this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate))),this.type==="date"&&this._userSelection.emit()}_calendarStateDone(){this._calendarState=""}_init(){this._selectedDate=this._getDateInCurrentMonth(this.selected),this._todayDate=this._getDateInCurrentMonth(this._adapter.today());let e=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),1,this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate));this._firstWeekOffset=(X8+this._adapter.getDayOfWeek(e)-this._adapter.getFirstDayOfWeek())%X8,this._createWeekCells()}_createWeekCells(){let e=this._adapter.getNumDaysInMonth(this.activeDate),n=this._adapter.getDateNames();this._weeks=[[]];for(let o=0,s=this._firstWeekOffset;o<e;o++,s++){s==X8&&(this._weeks.push([]),s=0);let l=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),this._adapter.getMonth(this.activeDate),o+1,this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate)),h=!this.dateFilter||this.dateFilter(l),p=this._adapter.format(l,this._dateFormats.display.dateA11yLabel);this._weeks[this._weeks.length-1].push(new OC(o+1,n[o],p,h))}}_getDateInCurrentMonth(e){return this._adapter.sameMonthAndYear(e,this.activeDate)?this._adapter.getDate(e):null}calendarState(e){this._calendarState=e}static{this.\u0275fac=function(n){return new(n||r)(Ie(tm,8),Ie(Iw,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-month-view"]],inputs:{type:"type",dateFilter:"dateFilter",activeDate:"activeDate",selected:"selected"},outputs:{_userSelection:"_userSelection",selectedChange:"selectedChange"},decls:5,vars:6,consts:[[1,"mat-datetimepicker-calendar-table"],[1,"mat-datetimepicker-calendar-table-header"],[4,"ngFor","ngForOf"],["matDatetimepickerCalendarBody","","role","grid",3,"selectedValueChange","activeCell","rows","selectedValue","todayValue"]],template:function(n,o){n&1&&($(0,"table",0)(1,"thead",1)(2,"tr"),Pe(3,N5e,2,2,"th",2),ee()(),$(4,"tbody",3),ve("@slideCalendar.done",function(){return o._calendarStateDone()})("selectedValueChange",function(l){return o._dateSelected(l)}),ee()()),n&2&&(j(3),z("ngForOf",o._weekdays),j(),z("@slideCalendar",o._calendarState)("activeCell",o._adapter.getDate(o.activeDate)-1)("rows",o._weeks)("selectedValue",o._selectedDate)("todayValue",o._todayDate))},dependencies:[Li,Q8],encapsulation:2,data:{animation:[_3]},changeDetection:0})}}return r})(),aEe=(()=>{class r{constructor(e,n){if(this._adapter=e,this._dateFormats=n,this._userSelection=new Ke,this.type="date",this.selectedChange=new Ke,!this._adapter)throw im("DatetimeAdapter");if(!this._dateFormats)throw im("MAT_DATETIME_FORMATS");this._activeDate=this._adapter.today()}get activeDate(){return this._activeDate}set activeDate(e){let n=this._activeDate;this._activeDate=e||this._adapter.today(),n&&this._activeDate&&!this._adapter.sameYear(n,this._activeDate)&&this._init()}get selected(){return this._selected}set selected(e){this._selected=e,this._selectedMonth=this._getMonthInCurrentYear(this.selected)}ngAfterContentInit(){this._init()}_monthSelected(e){let n=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),e,1,0,0);this.selectedChange.emit(this._adapter.createDatetime(this._adapter.getYear(this.activeDate),e,Math.min(this._adapter.getDate(this.activeDate),this._adapter.getNumDaysInMonth(n)),this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate))),this.type==="month"&&this._userSelection.emit()}_calendarStateDone(){this._calendarState=""}_init(){this._selectedMonth=this._getMonthInCurrentYear(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._adapter.today()),this._yearLabel=this._adapter.getYearName(this.activeDate);let e=this._adapter.getMonthNames("short");this._months=[[0,1,2,3,4],[5,6,7,8,9,10,11]].map(n=>n.map(o=>this._createCellForMonth(o,e[o])))}_getMonthInCurrentYear(e){return this._adapter.sameYear(e,this.activeDate)?this._adapter.getMonth(e):null}_createCellForMonth(e,n){let o=this._adapter.format(this._adapter.createDatetime(this._adapter.getYear(this.activeDate),e,1,this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate)),this._dateFormats.display.monthYearA11yLabel);return new OC(e,n.toLocaleUpperCase(),o,this._isMonthEnabled(e))}_isMonthEnabled(e){if(!this.dateFilter)return!0;let n=this._adapter.createDatetime(this._adapter.getYear(this.activeDate),e,1,this._adapter.getHour(this.activeDate),this._adapter.getMinute(this.activeDate));for(let o=n;this._adapter.getMonth(o)==e;o=this._adapter.addCalendarDays(o,1))if(this.dateFilter(o))return!0;return!1}static{this.\u0275fac=function(n){return new(n||r)(Ie(tm,8),Ie(Iw,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-year-view"]],inputs:{type:"type",dateFilter:"dateFilter",activeDate:"activeDate",selected:"selected"},outputs:{_userSelection:"_userSelection",selectedChange:"selectedChange"},decls:3,vars:7,consts:[[1,"mat-datetimepicker-calendar-table"],[1,"mat-datetimepicker-calendar-table-header"],["allowDisabledSelection","true","matDatetimepickerCalendarBody","","role","grid",3,"selectedValueChange","activeCell","labelMinRequiredCells","label","rows","selectedValue","todayValue"]],template:function(n,o){n&1&&($(0,"table",0),ct(1,"thead",1),$(2,"tbody",2),ve("@slideCalendar.done",function(){return o._calendarStateDone()})("selectedValueChange",function(l){return o._monthSelected(l)}),ee()()),n&2&&(j(2),z("@slideCalendar",o._calendarState)("activeCell",o._adapter.getMonth(o.activeDate))("labelMinRequiredCells",2)("label",o._yearLabel)("rows",o._months)("selectedValue",o._selectedMonth)("todayValue",o._todayMonth))},dependencies:[Q8],encapsulation:2,data:{animation:[_3]},changeDetection:0})}}return r})(),cte=(()=>{class r{constructor(e,n,o,s,l,h){if(this._elementRef=e,this._intl=n,this._ngZone=o,this._adapter=s,this._dateFormats=l,this._userSelection=new Ke,this.multiYearSelector=!1,this.startView="month",this.twelvehour=!1,this.timeInterval=1,this.ariaLabel="Use arrow keys to navigate",this.ariaNextMonthLabel="Next month",this.ariaPrevMonthLabel="Previous month",this.ariaNextYearLabel="Next year",this.ariaPrevYearLabel="Previous year",this.ariaNextMultiYearLabel="Next year range",this.ariaPrevMultiYearLabel="Previous year range",this.preventSameDateTimeSelection=!1,this.selectedChange=new Ke,this.viewChanged=new Ke,this._clockView="hour",this._type="date",this._dateFilterForViews=p=>!!p&&(!this.dateFilter||this.dateFilter(p,kC.DATE))&&(!this.minDate||this._adapter.compareDate(p,this.minDate)>=0)&&(!this.maxDate||this._adapter.compareDate(p,this.maxDate)<=0),!this._adapter)throw im("DatetimeAdapter");if(!this._dateFormats)throw im("MAT_DATETIME_FORMATS");this._intlChanges=n.changes.subscribe(()=>h.markForCheck())}get type(){return this._type}set type(e){this._type=e||"date",this.type==="year"&&(this.multiYearSelector=!0)}get startAt(){return this._startAt}set startAt(e){this._startAt=this._adapter.getValidDateOrNull(e)}get selected(){return this._selected}set selected(e){this._selected=this._adapter.getValidDateOrNull(e)}get minDate(){return this._minDate}set minDate(e){this._minDate=this._adapter.getValidDateOrNull(e)}get maxDate(){return this._maxDate}set maxDate(e){this._maxDate=this._adapter.getValidDateOrNull(e)}get _activeDate(){return this._clampedActiveDate}set _activeDate(e){let n=this._clampedActiveDate;this._clampedActiveDate=this._adapter.clampDate(e,this.minDate,this.maxDate),n&&this._clampedActiveDate&&this.currentView==="month"&&!this._adapter.sameMonthAndYear(n,this._clampedActiveDate)&&(this._adapter.isInNextMonth(n,this._clampedActiveDate)?this.calendarState("right"):this.calendarState("left"))}get currentView(){return this._currentView}set currentView(e){this._currentView=e,this.viewChanged.emit(e)}get _yearLabel(){return this._adapter.getYearName(this._activeDate)}get _monthYearLabel(){if(this.currentView==="multi-year"){let n=this._adapter.getYear(this._activeDate)-LC(this._adapter,this._activeDate,this.minDate,this.maxDate),o=n+fh-1,s=this._adapter.getYearName(this._adapter.createDate(n,0,1)),l=this._adapter.getYearName(this._adapter.createDate(o,0,1));return this._intl.formatYearRange(s,l)}return this.currentView==="month"?this._adapter.getMonthNames("long")[this._adapter.getMonth(this._activeDate)]:this._adapter.getYearName(this._activeDate)}get _dateLabel(){switch(this.type){case"month":return this._adapter.getMonthNames("long")[this._adapter.getMonth(this._activeDate)];default:return this._adapter.format(this._activeDate,this._dateFormats.display.popupHeaderDateLabel)}}get _hoursLabel(){let e=this._adapter.getHour(this._activeDate);return this.twelvehour&&(e===0&&(e=24),e=e>12?e-12:e),this._2digit(e)}get _minutesLabel(){return this._2digit(this._adapter.getMinute(this._activeDate))}get _ariaLabelNext(){switch(this._currentView){case"month":return this.ariaNextMonthLabel;case"year":return this.ariaNextYearLabel;case"multi-year":return this.ariaNextMultiYearLabel;default:return""}}get _ariaLabelPrev(){switch(this._currentView){case"month":return this.ariaPrevMonthLabel;case"year":return this.ariaPrevYearLabel;case"multi-year":return this.ariaPrevMultiYearLabel;default:return""}}_userSelected(){this._userSelection.emit()}ngAfterContentInit(){this._activeDate=this.startAt||this._adapter.today(),this._selectAMPM(this._activeDate),this._focusActiveCell(),this.type==="year"?this.currentView="multi-year":this.type==="month"?this.currentView="year":this.type==="time"?this.currentView="clock":this.currentView=this.startView||"month"}ngOnDestroy(){this._intlChanges.unsubscribe()}_dateSelected(e){this.type==="date"?(!this._adapter.sameDate(e,this.selected)||!this.preventSameDateTimeSelection)&&this.selectedChange.emit(e):(this._activeDate=e,this.currentView="clock")}_monthSelected(e){this.type==="month"?(!this._adapter.sameMonthAndYear(e,this.selected)||!this.preventSameDateTimeSelection)&&this.selectedChange.emit(this._adapter.getFirstDateOfMonth(e)):(this._activeDate=e,this.currentView="month",this._clockView="hour")}_yearSelected(e){if(this.type==="year"){if(!this._adapter.sameYear(e,this.selected)||!this.preventSameDateTimeSelection){let n=this._adapter.createDatetime(this._adapter.getYear(e),0,1,0,0);this.selectedChange.emit(n)}}else this._activeDate=e,this.currentView="year"}_timeSelected(e){this._clockView!=="minute"?(this._activeDate=this._updateDate(e),this._clockView="minute"):(!this._adapter.sameDatetime(e,this.selected)||!this.preventSameDateTimeSelection)&&this.selectedChange.emit(e)}_onActiveDateChange(e){this._activeDate=e}_updateDate(e){if(this.twelvehour){if(this._adapter.getHour(e)===12){if(this._AMPM==="AM")return this._adapter.addCalendarHours(e,-12)}else if(this._AMPM==="PM")return this._adapter.addCalendarHours(e,12)}return e}_selectAMPM(e){this._adapter.getHour(e)>11?this._AMPM="PM":this._AMPM="AM"}_ampmClicked(e){e!==this._AMPM&&(this._AMPM=e,this._AMPM==="AM"?this._activeDate=this._adapter.addCalendarHours(this._activeDate,-12):this._activeDate=this._adapter.addCalendarHours(this._activeDate,12))}_yearClicked(){if(this.type==="year"||this.multiYearSelector){this.currentView="multi-year";return}this.currentView="year"}_dateClicked(){this.type!=="month"&&(this.currentView="month")}_hoursClicked(){this.currentView="clock",this._clockView="hour"}_minutesClicked(){this.currentView="clock",this._clockView="minute"}_previousClicked(){this._activeDate=this.currentView==="month"?this._adapter.addCalendarMonths(this._activeDate,-1):this._adapter.addCalendarYears(this._activeDate,this.currentView==="year"?-1:-fh)}_nextClicked(){this._activeDate=this.currentView==="month"?this._adapter.addCalendarMonths(this._activeDate,1):this._adapter.addCalendarYears(this._activeDate,this.currentView==="year"?1:fh)}_previousEnabled(){return this.minDate?!this.minDate||!this._isSameView(this._activeDate,this.minDate):!0}_nextEnabled(){return!this.maxDate||!this._isSameView(this._activeDate,this.maxDate)}_handleCalendarBodyKeydown(e){this.currentView==="month"?this._handleCalendarBodyKeydownInMonthView(e):this.currentView==="year"?this._handleCalendarBodyKeydownInYearView(e):this.currentView==="multi-year"?this._handleCalendarBodyKeydownInMultiYearView(e):this._handleCalendarBodyKeydownInClockView(e)}_focusActiveCell(){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.asObservable().pipe(Ps()).subscribe(()=>{this._elementRef.nativeElement.focus()})})}_calendarStateDone(){this._calendarState=""}_isSameView(e,n){return this.currentView==="month"?this._adapter.getYear(e)===this._adapter.getYear(n)&&this._adapter.getMonth(e)===this._adapter.getMonth(n):this.currentView==="year"?this._adapter.getYear(e)===this._adapter.getYear(n):pte(this._adapter,e,n,this.minDate,this.maxDate)}_handleCalendarBodyKeydownInMonthView(e){switch(e.keyCode){case 37:this._activeDate=this._adapter.addCalendarDays(this._activeDate,-1);break;case 39:this._activeDate=this._adapter.addCalendarDays(this._activeDate,1);break;case 38:this._activeDate=this._adapter.addCalendarDays(this._activeDate,-7);break;case 40:this._activeDate=this._adapter.addCalendarDays(this._activeDate,7);break;case 36:this._activeDate=this._adapter.addCalendarDays(this._activeDate,1-this._adapter.getDate(this._activeDate));break;case 35:this._activeDate=this._adapter.addCalendarDays(this._activeDate,this._adapter.getNumDaysInMonth(this._activeDate)-this._adapter.getDate(this._activeDate));break;case 33:this._activeDate=e.altKey?this._adapter.addCalendarYears(this._activeDate,-1):this._adapter.addCalendarMonths(this._activeDate,-1);break;case 34:this._activeDate=e.altKey?this._adapter.addCalendarYears(this._activeDate,1):this._adapter.addCalendarMonths(this._activeDate,1);break;case 13:this._dateFilterForViews(this._activeDate)&&(this._dateSelected(this._activeDate),e.preventDefault());return;default:return}e.preventDefault()}_handleCalendarBodyKeydownInYearView(e){switch(e.keyCode){case 37:this._activeDate=this._adapter.addCalendarMonths(this._activeDate,-1);break;case 39:this._activeDate=this._adapter.addCalendarMonths(this._activeDate,1);break;case 38:this._activeDate=this._prevMonthInSameCol(this._activeDate);break;case 40:this._activeDate=this._nextMonthInSameCol(this._activeDate);break;case 36:this._activeDate=this._adapter.addCalendarMonths(this._activeDate,-this._adapter.getMonth(this._activeDate));break;case 35:this._activeDate=this._adapter.addCalendarMonths(this._activeDate,11-this._adapter.getMonth(this._activeDate));break;case 33:this._activeDate=this._adapter.addCalendarYears(this._activeDate,e.altKey?-10:-1);break;case 34:this._activeDate=this._adapter.addCalendarYears(this._activeDate,e.altKey?10:1);break;case 13:this._monthSelected(this._activeDate);break;default:return}e.preventDefault()}_handleCalendarBodyKeydownInMultiYearView(e){switch(e.keyCode){case 37:this._activeDate=this._adapter.addCalendarYears(this._activeDate,-1);break;case 39:this._activeDate=this._adapter.addCalendarYears(this._activeDate,1);break;case 38:this._activeDate=this._adapter.addCalendarYears(this._activeDate,-K8);break;case 40:this._activeDate=this._adapter.addCalendarYears(this._activeDate,K8);break;case 36:this._activeDate=this._adapter.addCalendarYears(this._activeDate,-LC(this._adapter,this._activeDate,this.minDate,this.maxDate));break;case 35:this._activeDate=this._adapter.addCalendarYears(this._activeDate,fh-LC(this._adapter,this._activeDate,this.minDate,this.maxDate)-1);break;case 33:this._activeDate=this._adapter.addCalendarYears(this._activeDate,e.altKey?-fh*10:-fh);break;case 34:this._activeDate=this._adapter.addCalendarYears(this._activeDate,e.altKey?fh*10:fh);break;case 13:this._yearSelected(this._activeDate);break;default:return}}_handleCalendarBodyKeydownInClockView(e){switch(e.keyCode){case 38:this._activeDate=this._clockView==="hour"?this._adapter.addCalendarHours(this._activeDate,1):this._adapter.addCalendarMinutes(this._activeDate,1);break;case 40:this._activeDate=this._clockView==="hour"?this._adapter.addCalendarHours(this._activeDate,-1):this._adapter.addCalendarMinutes(this._activeDate,-1);break;case 13:this._timeSelected(this._activeDate);return;default:return}e.preventDefault()}_prevMonthInSameCol(e){let n=this._adapter.getMonth(e)<=4?-5:this._adapter.getMonth(e)>=7?-7:-12;return this._adapter.addCalendarMonths(e,n)}_nextMonthInSameCol(e){let n=this._adapter.getMonth(e)<=4?7:this._adapter.getMonth(e)>=7?5:12;return this._adapter.addCalendarMonths(e,n)}calendarState(e){this._calendarState=e}_2digit(e){return("00"+e).slice(-2)}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(JF),Ie(tc),Ie(tm,8),Ie(Iw,8),Ie(lr))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-calendar"]],hostAttrs:["role","dialog","tabindex","0"],hostVars:3,hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._handleCalendarBodyKeydown(l)}),n&2&&(Or("aria-label",o.ariaLabel),dr("mat-datetimepicker-calendar",!0))},inputs:{multiYearSelector:"multiYearSelector",startView:"startView",twelvehour:"twelvehour",timeInterval:"timeInterval",dateFilter:"dateFilter",ariaLabel:"ariaLabel",ariaNextMonthLabel:"ariaNextMonthLabel",ariaPrevMonthLabel:"ariaPrevMonthLabel",ariaNextYearLabel:"ariaNextYearLabel",ariaPrevYearLabel:"ariaPrevYearLabel",ariaNextMultiYearLabel:"ariaNextMultiYearLabel",ariaPrevMultiYearLabel:"ariaPrevMultiYearLabel",preventSameDateTimeSelection:"preventSameDateTimeSelection",type:"type",startAt:"startAt",selected:"selected",minDate:"minDate",maxDate:"maxDate"},outputs:{_userSelection:"_userSelection",selectedChange:"selectedChange",viewChanged:"viewChanged"},decls:11,vars:8,consts:[[1,"mat-datetimepicker-calendar-header"],["class","mat-datetimepicker-calendar-header-year","role","button",3,"active","click",4,"ngIf"],[1,"mat-datetimepicker-calendar-header-date-time"],["class","mat-datetimepicker-calendar-header-date","role","button",3,"active","not-clickable","click",4,"ngIf"],["class","mat-datetimepicker-calendar-header-time",3,"active",4,"ngIf"],[1,"mat-datetimepicker-calendar-content",3,"ngSwitch"],["class","mat-month-content",4,"ngIf"],[3,"activeDate","dateFilter","selected","type","_userSelection","selectedChange",4,"ngSwitchCase"],[3,"activeDate","dateFilter","maxDate","minDate","selected","type","_userSelection","selectedChange",4,"ngSwitchCase"],[3,"dateFilter","interval","maxDate","minDate","selected","startView","twelvehour","_userSelection","activeDateChange","selectedChange",4,"ngSwitchDefault"],["role","button",1,"mat-datetimepicker-calendar-header-year",3,"click"],[4,"ngIf"],["role","button",1,"mat-datetimepicker-calendar-header-date",3,"click"],[1,"mat-datetimepicker-calendar-header-time"],["role","button",1,"mat-datetimepicker-calendar-header-hours",3,"click"],["role","button",1,"mat-datetimepicker-calendar-header-minutes",3,"click"],["class","mat-datetimepicker-calendar-header-ampm-container",4,"ngIf"],[1,"mat-datetimepicker-calendar-header-ampm-container"],[1,"mat-datetimepicker-calendar-header-ampm",3,"click"],[1,"mat-month-content"],[1,"mat-datetimepicker-calendar-controls"],["role","button",1,"mat-datetimepicker-calendar-previous-button",3,"click"],["height","24","viewBox","0 0 24 24","width","24"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],[1,"mat-datetimepicker-calendar-period-button"],["role","button",1,"mat-datetimepicker-calendar-next-button",3,"click"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],[3,"_userSelection","selectedChange","activeDate","dateFilter","selected","type"],[3,"_userSelection","selectedChange","activeDate","dateFilter","maxDate","minDate","selected","type"],[3,"_userSelection","activeDateChange","selectedChange","dateFilter","interval","maxDate","minDate","selected","startView","twelvehour"]],template:function(n,o){n&1&&($(0,"div",0),Pe(1,G5e,3,4,"div",1),$(2,"div",2),Pe(3,j5e,2,5,"span",3)(4,U5e,8,9,"span",4),ee()(),$(5,"div",5),Pe(6,z5e,11,10,"div",6)(7,$5e,1,4,"mat-datetimepicker-month-view",7)(8,W5e,1,4,"mat-datetimepicker-year-view",7)(9,H5e,1,6,"mat-datetimepicker-multi-year-view",8)(10,q5e,1,7,"mat-datetimepicker-clock",9),ee()),n&2&&(j(),z("ngIf",o.type!=="time"),j(2),z("ngIf",o.type!=="time"&&o.type!=="year"),j(),z("ngIf",o.type.endsWith("time")),j(),z("ngSwitch",o.currentView),j(),z("ngIf",o.currentView==="month"||o.currentView==="year"||o.currentView==="multi-year"),j(),z("ngSwitchCase","month"),j(),z("ngSwitchCase","year"),j(),z("ngSwitchCase","multi-year"))},dependencies:[Gt,_x,yx,WF,$t,nEe,oEe,aEe,iEe],styles:[`.mat-datetimepicker-calendar{-webkit-user-select:none;user-select:none;display:block;outline:none}.mat-datetimepicker-calendar[mode=landscape]{display:flex}.mat-datetimepicker-calendar-header{padding:16px;font-size:14px;box-sizing:border-box}[mode=landscape] .mat-datetimepicker-calendar-header{width:150px;min-width:150px}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-year,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-date-time{width:100%;font-weight:500;white-space:nowrap}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-year{font-size:16px}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-year mat-icon{transform:translateY(5px)}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-date-time{font-size:30px;line-height:34px}[mode=landscape] .mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-date-time{white-space:normal;word-wrap:break-word}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-ampm-container{font-size:.77em}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-year:not(.active),.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-date:not(.active),.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-hours:not(.active),.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-minutes:not(.active),.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-ampm:not(.active){cursor:pointer;opacity:.6}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-year.not-clickable,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-date.not-clickable,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-hours.not-clickable,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-minutes.not-clickable,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-ampm.not-clickable{cursor:initial}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time{padding-left:8px}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time:not(.active){opacity:.6}.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time:not(.active) .mat-datetimepicker-calendar-header-hours,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time:not(.active) .mat-datetimepicker-calendar-header-minutes,.mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time:not(.active) .mat-datetimepicker-calendar-header-ampm{cursor:pointer;opacity:1}[mode=landscape] .mat-datetimepicker-calendar-header .mat-datetimepicker-calendar-header-time{display:block;padding-left:0}.mat-datetimepicker-calendar-content{width:100%;padding:0 8px 8px;outline:none;box-sizing:border-box;overflow:hidden}[mode=landscape] .mat-datetimepicker-calendar-content{padding-top:8px}.mat-datetimepicker-calendar-controls{display:flex;justify-content:space-between}.mat-datetimepicker-calendar-period-button{display:inline-block;height:48px;padding:12px;outline:none;border:0;background:transparent;box-sizing:border-box}.mat-datetimepicker-calendar-previous-button,.mat-datetimepicker-calendar-next-button{display:inline-block;width:48px;height:48px;padding:12px;outline:none;border:0;cursor:pointer;background:transparent;box-sizing:border-box}.mat-datetimepicker-calendar-previous-button.disabled,.mat-datetimepicker-calendar-next-button.disabled{color:#00000061;pointer-events:none}.mat-datetimepicker-calendar-previous-button svg,.mat-datetimepicker-calendar-next-button svg{fill:currentColor;vertical-align:top}.mat-datetimepicker-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-datetimepicker-calendar-table-header{color:#00000061}.mat-datetimepicker-calendar-table-header th{text-align:center;font-size:11px;padding:0 0 8px}@media (min-width: 480px){.mat-datetimepicker-calendar[mode=auto]{display:flex}.mat-datetimepicker-calendar[mode=auto] .mat-datetimepicker-calendar-header{width:150px;min-width:150px}.mat-datetimepicker-calendar[mode=auto] .mat-datetimepicker-calendar-header-date-time{white-space:normal;word-wrap:break-word}.mat-datetimepicker-calendar[mode=auto] .mat-datetimepicker-calendar-header-time{display:block;padding-left:0}.mat-datetimepicker-calendar[mode=auto] .mat-datetimepicker-calendar-content{padding-top:8px}}
`],encapsulation:2,data:{animation:[_3]},changeDetection:0})}}return r})(),sEe=0,ute=(()=>{class r{ngAfterContentInit(){this._calendar._focusActiveCell()}onSelectionChange(e){this.datetimepicker._select(e),this.datetimepicker.close()}_handleKeydown(e){e.keyCode===27&&(this.datetimepicker.close(),e.preventDefault(),e.stopPropagation())}static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-content"]],viewQuery:function(n,o){if(n&1&&Ir(cte,7),n&2){let s;bi(s=wi())&&(o._calendar=s.first)}},hostAttrs:[1,"mat-datetimepicker-content"],hostVars:2,hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o._handleKeydown(l)}),n&2&&dr("mat-datetimepicker-content-touch",o.datetimepicker==null?null:o.datetimepicker.touchUi)},decls:1,vars:17,consts:[["cdkTrapFocus","",1,"mat-typography",3,"_userSelection","selectedChange","viewChanged","ariaNextMonthLabel","ariaNextYearLabel","ariaPrevMonthLabel","ariaPrevYearLabel","preventSameDateTimeSelection","dateFilter","id","maxDate","minDate","multiYearSelector","selected","startAt","startView","timeInterval","twelvehour","type"]],template:function(n,o){n&1&&($(0,"mat-datetimepicker-calendar",0),ve("_userSelection",function(){return o.datetimepicker.close()})("selectedChange",function(l){return o.onSelectionChange(l)})("viewChanged",function(l){return o.datetimepicker._viewChanged(l)}),ee()),n&2&&(z("ariaNextMonthLabel",o.datetimepicker.ariaNextMonthLabel)("ariaNextYearLabel",o.datetimepicker.ariaNextYearLabel)("ariaPrevMonthLabel",o.datetimepicker.ariaPrevMonthLabel)("ariaPrevYearLabel",o.datetimepicker.ariaPrevYearLabel)("preventSameDateTimeSelection",o.datetimepicker.preventSameDateTimeSelection)("dateFilter",o.datetimepicker._dateFilter)("id",o.datetimepicker.id)("maxDate",o.datetimepicker._maxDate)("minDate",o.datetimepicker._minDate)("multiYearSelector",o.datetimepicker.multiYearSelector)("selected",o.datetimepicker._selected)("startAt",o.datetimepicker.startAt)("startView",o.datetimepicker.startView)("timeInterval",o.datetimepicker.timeInterval)("twelvehour",o.datetimepicker.twelvehour)("type",o.datetimepicker.type),Or("mode",o.datetimepicker.mode))},dependencies:[j7,cte],styles:[`.mat-datetimepicker-content{box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f;display:block;background-color:#fff;border-radius:2px;overflow:hidden}.mat-datetimepicker-calendar{width:296px;height:405px}.mat-datetimepicker-calendar[mode=landscape]{width:446px;height:328px}@media (min-width: 480px){.mat-datetimepicker-calendar[mode=auto]{width:446px;height:328px}}.mat-datetimepicker-content-touch{box-shadow:0 0 #0003,0 0 #00000024,0 0 #0000001f;display:block;box-shadow:0 11px 15px -7px #0003,0 24px 38px 3px #00000024,0 9px 46px 8px #0000001f}.cdk-overlay-container,.cdk-global-overlay-wrapper{pointer-events:none;top:0;left:0;height:100%;width:100%}.cdk-overlay-container{position:fixed;z-index:1000}.cdk-global-overlay-wrapper{display:flex;position:absolute;z-index:1000}.cdk-overlay-pane{position:absolute;pointer-events:auto;box-sizing:border-box;z-index:1000}.cdk-overlay-backdrop{position:absolute;inset:0;z-index:1000;pointer-events:auto;transition:opacity .4s cubic-bezier(.25,.8,.25,1);opacity:0}.cdk-overlay-backdrop.cdk-overlay-backdrop-showing{opacity:.48}.cdk-overlay-dark-backdrop{background:#0009}.mat-datetimepicker-dialog .mat-dialog-container{padding:0}
`],encapsulation:2,changeDetection:0})}}return r})(),fte=(()=>{class r{constructor(e,n,o,s,l,h,p,m){if(this._dialog=e,this._overlay=n,this._ngZone=o,this._viewContainerRef=s,this._scrollStrategy=l,this._dateAdapter=h,this._dir=p,this._document=m,this.multiYearSelector=!1,this.twelvehour=!1,this.startView="month",this.mode="auto",this.timeInterval=1,this.ariaNextMonthLabel="Next month",this.ariaPrevMonthLabel="Previous month",this.ariaNextYearLabel="Next year",this.ariaPrevYearLabel="Previous year",this.preventSameDateTimeSelection=!1,this.selectedChanged=new Ke,this.openedStream=new Ke,this.closedStream=new Ke,this.viewChanged=new Ke,this.opened=!1,this.id=`mat-datetimepicker-${sEe++}`,this._disabledChange=new Si,this._validSelected=null,this._focusedElementBeforeOpen=null,this._inputSubscription=Es.EMPTY,this._type="date",this._touchUi=!1,!this._dateAdapter)throw im("DateAdapter")}get startAt(){return this._startAt||(this._datepickerInput?this._datepickerInput.value:null)}set startAt(e){this._startAt=this._dateAdapter.getValidDateOrNull(e)}get openOnFocus(){return this._openOnFocus}set openOnFocus(e){this._openOnFocus=T1(e)}get type(){return this._type}set type(e){this._type=e||"date"}get touchUi(){return this._touchUi}set touchUi(e){this._touchUi=T1(e)}get disabled(){return this._disabled===void 0&&this._datepickerInput?this._datepickerInput.disabled:!!this._disabled}set disabled(e){let n=T1(e);n!==this._disabled&&(this._disabled=n,this._disabledChange.next(n))}get _selected(){return this._validSelected}set _selected(e){this._validSelected=e}get _minDate(){return this._datepickerInput&&this._datepickerInput.min}get _maxDate(){return this._datepickerInput&&this._datepickerInput.max}get _dateFilter(){return this._datepickerInput&&this._datepickerInput._dateFilter}_handleFocus(){!this.opened&&this.openOnFocus&&this.open()}_viewChanged(e){this.viewChanged.emit(e)}ngOnDestroy(){this.close(),this._inputSubscription.unsubscribe(),this._disabledChange.complete(),this._popupRef&&this._popupRef.dispose()}_select(e){let n=this._selected;this._selected=e,this._dateAdapter.sameDatetime(n,this._selected)||this.selectedChanged.emit(e)}_registerInput(e){if(this._datepickerInput)throw Error("A MatDatepicker can only be associated with a single input.");this._datepickerInput=e,this._inputSubscription=this._datepickerInput._valueChange.subscribe(n=>this._selected=n)}open(){if(!(this.opened||this.disabled)){if(!this._datepickerInput)throw Error("Attempted to open an MatDatepicker with no associated input.");this._document&&(this._focusedElementBeforeOpen=this._document.activeElement),this.touchUi?this._openAsDialog():this._openAsPopup(),this.opened=!0,this.openedStream.emit()}}close(){if(!this.opened)return;this._popupRef&&this._popupRef.hasAttached()&&this._popupRef.detach(),this._dialogRef&&(this._dialogRef.close(),this._dialogRef=null),this._calendarPortal&&this._calendarPortal.isAttached&&this._calendarPortal.detach();let e=()=>{this.opened&&(this.opened=!1,this.closedStream.emit(),this._focusedElementBeforeOpen=null)};this._focusedElementBeforeOpen&&typeof this._focusedElementBeforeOpen.focus=="function"?(this._focusedElementBeforeOpen.focus(),setTimeout(e)):e()}_openAsDialog(){this._dialogRef=this._dialog.open(ute,{direction:this._dir?this._dir.value:"ltr",viewContainerRef:this._viewContainerRef,panelClass:"mat-datetimepicker-dialog"}),this._dialogRef.afterClosed().subscribe(()=>this.close()),this._dialogRef.componentInstance.datetimepicker=this}_openAsPopup(){if(this._calendarPortal||(this._calendarPortal=new aG(ute,this._viewContainerRef)),this._popupRef||this._createPopup(),!this._popupRef.hasAttached()){let e=this._popupRef.attach(this._calendarPortal);e.instance.datetimepicker=this,this._ngZone.onStable.asObservable().pipe(Ps()).subscribe(()=>{this._popupRef.updatePosition()})}this._popupRef.backdropClick().subscribe(()=>this.close())}_createPopup(){let e=new cG({positionStrategy:this._createPopupPositionStrategy(),hasBackdrop:!0,backdropClass:"mat-overlay-transparent-backdrop",direction:this._dir?this._dir.value:"ltr",scrollStrategy:this._scrollStrategy(),panelClass:"mat-datetimepicker-popup"});this._popupRef=this._overlay.create(e)}_createPopupPositionStrategy(){return this._overlay.position().flexibleConnectedTo(this._datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datetimepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition().withPositions([{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"}])}static{this.\u0275fac=function(n){return new(n||r)(Ie(Yc),Ie(uG),Ie(tc),Ie(Mh),Ie(GG),Ie(tm,8),Ie(Rl,8),Ie(rc,8))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker"]],inputs:{multiYearSelector:"multiYearSelector",twelvehour:"twelvehour",startView:"startView",mode:"mode",timeInterval:"timeInterval",ariaNextMonthLabel:"ariaNextMonthLabel",ariaPrevMonthLabel:"ariaPrevMonthLabel",ariaNextYearLabel:"ariaNextYearLabel",ariaPrevYearLabel:"ariaPrevYearLabel",preventSameDateTimeSelection:"preventSameDateTimeSelection",panelClass:"panelClass",startAt:"startAt",openOnFocus:"openOnFocus",type:"type",touchUi:"touchUi",disabled:"disabled"},outputs:{selectedChanged:"selectedChanged",openedStream:"opened",closedStream:"closed",viewChanged:"viewChanged"},exportAs:["matDatetimepicker"],decls:0,vars:0,template:function(n,o){},encapsulation:2,changeDetection:0})}}return r})(),lEe={provide:Yu,useExisting:Dl(()=>y3),multi:!0},cEe={provide:DA,useExisting:Dl(()=>y3),multi:!0},Mw=class{constructor(i,e){this.target=i,this.targetElement=e,this.value=this.target.value}},y3=(()=>{class r{constructor(e,n,o,s){if(this._elementRef=e,this._dateAdapter=n,this._dateFormats=o,this._formField=s,this.dateChange=new Ke,this.dateInput=new Ke,this._valueChange=new Ke,this._disabledChange=new Ke,this._datepickerSubscription=Es.EMPTY,this._localeSubscription=Es.EMPTY,this._lastValueValid=!1,this._onTouched=()=>{},this._cvaOnChange=()=>{},this._validatorOnChange=()=>{},this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._minValidator=l=>{let h=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(l.value));return!this.min||!h||this._dateAdapter.compareDatetime(this.min,h)<=0?null:{matDatepickerMin:{min:this.min,actual:h}}},this._maxValidator=l=>{let h=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(l.value));return!this.max||!h||this._dateAdapter.compareDatetime(this.max,h)>=0?null:{matDatepickerMax:{max:this.max,actual:h}}},this._filterValidator=l=>{let h=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(l.value));return!this._dateFilter||!h||this._dateFilter(h,kC.DATE)?null:{matDatepickerFilter:!0}},this._validator=Fn.compose([this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]),!this._dateAdapter)throw im("DatetimeAdapter");if(!this._dateFormats)throw im("MAT_DATETIME_FORMATS");this._localeSubscription=n.localeChanges.subscribe(()=>{this.value=this.value})}set matDatetimepicker(e){this.registerDatepicker(e)}set matDatepickerFilter(e){this._dateFilter=e,this._validatorOnChange()}get value(){return this._value}set value(e){e=this._dateAdapter.deserialize(e),this._lastValueValid=!e||this._dateAdapter.isValid(e),e=this._dateAdapter.getValidDateOrNull(e);let n=this.value;this._value=e,this._formatValue(e),setTimeout(()=>{this._dateAdapter.sameDatetime(n,e)||this._valueChange.emit(e)})}get min(){return this._min}set min(e){this._min=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get max(){return this._max}set max(e){this._max=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(e)),this._validatorOnChange()}get disabled(){return!!this._disabled}set disabled(e){let n=T1(e);this._disabled!==n&&(this._disabled=n,this._disabledChange.emit(n))}ngAfterContentInit(){this._datepicker&&(this._datepickerSubscription=this._datepicker.selectedChanged.subscribe(e=>{this.value=e,this._cvaOnChange(e),this._onTouched(),this.dateInput.emit(new Mw(this,this._elementRef.nativeElement)),this.dateChange.emit(new Mw(this,this._elementRef.nativeElement))}))}ngOnDestroy(){this._datepickerSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this._valueChange.complete(),this._disabledChange.complete()}registerOnValidatorChange(e){this._validatorOnChange=e}validate(e){return this._validator?this._validator(e):null}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}writeValue(e){this.value=e}registerOnChange(e){this._cvaOnChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_onKeydown(e){e.altKey&&e.keyCode===40&&(this._datepicker.open(),e.preventDefault())}_onInput(e){let n=this._dateAdapter.parse(e,this.getParseFormat());this._lastValueValid=!n||this._dateAdapter.isValid(n),n=this._dateAdapter.getValidDateOrNull(n),this._value=n,this._cvaOnChange(n),this._valueChange.emit(n),this.dateInput.emit(new Mw(this,this._elementRef.nativeElement))}_onChange(){this.dateChange.emit(new Mw(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}registerDatepicker(e){e&&(this._datepicker=e,this._datepicker._registerInput(this))}getDisplayFormat(){switch(this._datepicker.type){case"date":return this._dateFormats.display.dateInput;case"datetime":return this._dateFormats.display.datetimeInput;case"time":return this._dateFormats.display.timeInput;case"month":return this._dateFormats.display.monthInput}}getParseFormat(){let e;switch(this._datepicker.type){case"date":e=this._dateFormats.parse.dateInput;break;case"datetime":e=this._dateFormats.parse.datetimeInput;break;case"time":e=this._dateFormats.parse.timeInput;break;case"month":e=this._dateFormats.parse.monthInput;break}return e||(e=this._dateFormats.parse.dateInput),e}_formatValue(e){this._elementRef.nativeElement.value=e?this._dateAdapter.format(e,this.getDisplayFormat()):""}static{this.\u0275fac=function(n){return new(n||r)(Ie(ar),Ie(tm,8),Ie(Iw,8),Ie(Gr,8))}}static{this.\u0275dir=Fi({type:r,selectors:[["input","matDatetimepicker",""]],hostVars:5,hostBindings:function(n,o){n&1&&ve("focus",function(){return o._datepicker._handleFocus()})("input",function(l){return o._onInput(l.target.value)})("change",function(){return o._onChange()})("blur",function(){return o._onBlur()})("keydown",function(l){return o._onKeydown(l)}),n&2&&(mm("disabled",o.disabled),Or("aria-haspopup",!0)("aria-owns",(o._datepicker==null?null:o._datepicker.opened)&&o._datepicker.id||null)("min",o.min?o._dateAdapter.toIso8601(o.min):null)("max",o.max?o._dateAdapter.toIso8601(o.max):null))},inputs:{matDatetimepicker:"matDatetimepicker",matDatepickerFilter:"matDatepickerFilter",value:"value",min:"min",max:"max",disabled:"disabled"},outputs:{dateChange:"dateChange",dateInput:"dateInput"},exportAs:["matDatepickerInput"],features:[Xi([lEe,cEe,{provide:BG,useExisting:r}])]})}}return r})(),gte=(()=>{class r{constructor(e,n){this._intl=e,this._changeDetectorRef=n,this._stateChanges=Es.EMPTY}get disabled(){return this._disabled===void 0?this.datetimepicker.disabled:!!this._disabled}set disabled(e){this._disabled=T1(e)}ngOnChanges(e){e.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(e){this.datetimepicker&&!this.disabled&&(this.datetimepicker.open(),e.stopPropagation())}_watchStateChanges(){let e=this.datetimepicker?this.datetimepicker._disabledChange:GF([],BF),n=this.datetimepicker&&this.datetimepicker._datepickerInput?this.datetimepicker._datepickerInput._disabledChange:GF([],BF);this._stateChanges.unsubscribe(),this._stateChanges=Fs(this._intl.changes,e,n).subscribe(()=>this._changeDetectorRef.markForCheck())}static{this.\u0275fac=function(n){return new(n||r)(Ie(JF),Ie(lr))}}static{this.\u0275cmp=nt({type:r,selectors:[["mat-datetimepicker-toggle"]],hostAttrs:[1,"mat-datetimepicker-toggle"],hostBindings:function(n,o){n&1&&ve("click",function(l){return o._open(l)})},inputs:{datetimepicker:[0,"for","datetimepicker"],disabled:"disabled"},exportAs:["matDatetimepickerToggle"],features:[wu],decls:5,vars:5,consts:[["mat-icon-button","","type","button",3,"disabled"],[3,"ngSwitch"],["fill","currentColor","focusable","false","height","100%","style","vertical-align: top","viewBox","0 0 24 24","width","100%",4,"ngSwitchCase"],["fill","currentColor","focusable","false","height","100%","style","vertical-align: top","viewBox","0 0 24 24","width","100%",4,"ngSwitchDefault"],["fill","currentColor","focusable","false","height","100%","viewBox","0 0 24 24","width","100%",2,"vertical-align","top"],["d","M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M12.5,7V12.25L17,14.92L16.25,16.15L11,13V7H12.5Z"],["d","M15,13H16.5V15.82L18.94,17.23L18.19,18.53L15,16.69V13M19,8H5V19H9.67C9.24,18.09 9,17.07 9,16A7,7 0 0,1 16,9C17.07,9 18.09,9.24 19,9.67V8M5,21C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H6V1H8V3H16V1H18V3H19A2,2 0 0,1 21,5V11.1C22.24,12.36 23,14.09 23,16A7,7 0 0,1 16,23C14.09,23 12.36,22.24 11.1,21H5M16,11.15A4.85,4.85 0 0,0 11.15,16C11.15,18.68 13.32,20.85 16,20.85A4.85,4.85 0 0,0 20.85,16C20.85,13.32 18.68,11.15 16,11.15Z"],["d","M0 0h24v24H0z","fill","none"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(n,o){n&1&&($(0,"button",0)(1,"mat-icon",1),Pe(2,Y5e,2,0,"svg",2)(3,Z5e,2,0,"svg",2)(4,X5e,3,0,"svg",3),ee()()),n&2&&(z("disabled",o.disabled),Or("aria-label",o._intl.openCalendarLabel),j(),z("ngSwitch",o.datetimepicker.type),j(),z("ngSwitchCase","time"),j(),z("ngSwitchCase","datetime"))},dependencies:[_x,yx,WF,ci,$t],encapsulation:2,changeDetection:0})}}return r})(),_te=(()=>{class r{static{this.\u0275fac=function(n){return new(n||r)}}static{this.\u0275mod=_r({type:r})}static{this.\u0275inj=gr({imports:[Wu,Vt,V1,jt,pG,LA]})}}return r})();var yte=Jl(D1());function dEe(r,i){if(r&1){let e=We();$(0,"div",9)(1,"mat-form-field"),ct(2,"mat-datetimepicker-toggle",10)(3,"mat-datetimepicker",11,0),$(5,"input",12),le(6,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.date,o)||(s.date=o),xe(o)}),ve("dateChange",function(){we(e);let o=ne(2);return xe(o.handleDateChange())}),ee()()()}if(r&2){let e=Xt(4),n=ne(2);j(2),z("for",e),j(),z("type",n.type)("openOnFocus",!0)("timeInterval",5),j(2),sr("placeholder",ce(6,9,"igo.geo.timeFilter.date")),z("matDatetimepicker",e),Qn("ngModel",n.date),z("min",n.min)("max",n.max)}}function hEe(r,i){if(r&1){let e=We();$(0,"div")(1,"div",13)(2,"mat-form-field"),ct(3,"mat-datetimepicker-toggle",10)(4,"mat-datetimepicker",11,1),$(6,"input",14),le(7,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.startDate,o)||(s.startDate=o),xe(o)}),ve("input",function(){we(e);let o=ne(2);return xe(o.startDate)})("dateChange",function(){we(e);let o=ne(2);return xe(o.handleDateChange())}),ee()()(),$(8,"div",13)(9,"mat-form-field"),ct(10,"mat-datetimepicker-toggle",10)(11,"mat-datetimepicker",11,2),$(13,"input",12),le(14,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.endDate,o)||(s.endDate=o),xe(o)}),ve("dateChange",function(){we(e);let o=ne(2);return xe(o.handleDateChange())}),ee()()()()}if(r&2){let e=Xt(5),n=Xt(12),o=ne(2);j(3),z("for",e),j(),z("type",o.type)("openOnFocus",!0)("timeInterval",5),j(2),sr("placeholder",ce(7,18,"igo.geo.timeFilter.startDate")),z("matDatetimepicker",e),Qn("ngModel",o.startDate),z("min",o.min)("max",o.getRangeMaxDate()),j(4),z("for",n),j(),z("type",o.type)("openOnFocus",!0)("timeInterval",5),j(2),sr("placeholder",ce(14,20,"igo.geo.timeFilter.endDate")),z("matDatetimepicker",n),Qn("ngModel",o.endDate),z("min",o.getRangeMinDate())("max",o.max)}}function pEe(r,i){if(r&1&&($(0,"div"),Pe(1,dEe,7,11,"div",8)(2,hEe,15,22,"div",6),ee()),r&2){let e=ne();j(),z("ngIf",!e.isRange),j(),z("ngIf",e.isRange)}}function mEe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function fEe(r,i){if(r&1){let e=We();$(0,"div",9)(1,"mat-form-field")(2,"mat-select",15),le(3,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.year,o)||(s.year=o),xe(o)}),ve("selectionChange",function(){we(e);let o=ne(2);return xe(o.handleYearChange())}),Pe(4,mEe,2,2,"mat-option",16),ee()()()}if(r&2){let e=ne(2);j(2),sr("placeholder",ce(3,3,"igo.geo.timeFilter.date")),Qn("ngModel",e.year),j(2),z("ngForOf",e.listYears)}}function gEe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function _Ee(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),bt(e)}}function yEe(r,i){if(r&1){let e=We();$(0,"div")(1,"div",13)(2,"mat-form-field")(3,"mat-select",15),le(4,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.startYear,o)||(s.startYear=o),xe(o)}),ve("selectionChange",function(){we(e);let o=ne(2);return xe(o.handleYearChange())}),Pe(5,gEe,2,2,"mat-option",16),ee()()(),$(6,"div",13)(7,"mat-form-field")(8,"mat-select",15),le(9,"translate"),eo("ngModelChange",function(o){we(e);let s=ne(2);return Jn(s.endYear,o)||(s.endYear=o),xe(o)}),ve("selectionChange",function(){we(e);let o=ne(2);return xe(o.handleYearChange())}),Pe(10,_Ee,2,2,"mat-option",16),ee()()()()}if(r&2){let e=ne(2);j(3),sr("placeholder",ce(4,6,"igo.geo.timeFilter.startDate")),Qn("ngModel",e.startYear),j(2),z("ngForOf",e.startListYears),j(3),sr("placeholder",ce(9,8,"igo.geo.timeFilter.endDate")),Qn("ngModel",e.endYear),j(2),z("ngForOf",e.endListYears)}}function vEe(r,i){if(r&1&&($(0,"div"),Pe(1,fEe,5,5,"div",8)(2,yEe,11,10,"div",6),ee()),r&2){let e=ne();j(),z("ngIf",!e.isRange),j(),z("ngIf",e.isRange)}}function bEe(r,i){if(r&1&&($(0,"p",25),_e(1),ee()),r&2){let e=ne(2);j(),bt(e.year)}}function wEe(r,i){if(r&1){let e=We();$(0,"div",18)(1,"span"),_e(2),ee(),$(3,"mat-slider",19,3)(5,"input",20,4),ve("input",function(){we(e);let o=Xt(4),s=Xt(6),l=ne();return xe(l.handleSliderYearChange({source:s,parent:o,value:s.value}))})("change",function(){we(e);let o=Xt(4),s=Xt(6),l=ne();return xe(l.handleSliderYearChange({source:s,parent:o,value:s.value}))}),ee()(),$(7,"span"),_e(8),ee(),Pe(9,bEe,2,1,"p",21),$(10,"div",22,5)(12,"mat-slide-toggle",23),le(13,"translate"),ve("change",function(){we(e);let o=ne();return xe(o.toggleFilterState())}),ee(),$(14,"button",24),ve("click",function(){we(e);let o=ne();return xe(o.playYear())}),$(15,"mat-icon"),_e(16),ee()(),$(17,"button",24),ve("click",function(){we(e);let o=ne();return xe(o.resetFilter())}),$(18,"mat-icon"),_e(19),ee()()()()}if(r&2){let e=ne();j(2),bt(e.startYear),j(),sr("step",e.step),z("min",e.startYear)("max",e.endYear)("color",e.color)("disabled",!e.options.enabled||!e.layer.visible),j(2),z("value",e.handleSliderValue()),j(3),bt(e.endYear),j(),z("ngIf",e.options.enabled),j(3),z("matTooltip",ce(13,17,"igo.geo.filter.toggleFilterState"))("color",e.color)("checked",e.options.enabled)("disabled",!e.layer.visible),j(2),z("disabled",!e.options.enabled||!e.layer.visible),j(2),bt(e.playIcon),j(),z("disabled",!e.options.enabled||!e.layer.visible),j(2),bt(e.resetIcon)}}function xEe(r,i){if(r&1){let e=We();$(0,"div",9)(1,"mat-slider",26,3),ve("selectionChange",function(o){we(e);let s=ne();return xe(s.handleSliderDateChange(o))}),$(3,"input",27,4),ve("input",function(){we(e);let o=Xt(2),s=Xt(4),l=ne();return xe(l.handleSliderDateChange({source:s,parent:o,value:s.value}))}),ee()(),$(5,"p",25),_e(6),ee(),$(7,"button",28),ve("click",function(){we(e);let o=ne();return xe(o.playFilter())}),$(8,"mat-icon"),_e(9),ee()()()}if(r&2){let e=ne();j(),sr("step",e.step),z("min",e.dateToNumber(e.min))("max",e.dateToNumber(e.max)),j(2),z("value",e.handleSliderValue()),j(3),bt(e.handleSliderTooltip()),j(3),bt(e.playIcon)}}var J8=(()=>{class r{dateAdapter;color="primary";date;startDate;endDate;year;startYear;endYear;initStartYear;initEndYear;listYears=[];startListYears=[];endListYears=[];interval;playIcon="play-circle";resetIcon="replay";layer;options;set currentValue(e){if(e&&this.type!==rl.YEAR){let n=e.split("/");if(n.length>0){let o=new Date(n[0]),s=new Date(n[1]);isNaN(o.valueOf())||(this.startDate=o),isNaN(s.valueOf())||(this.endDate=s)}}}change=new Ke;yearChange=new Ke;mySlider;get type(){return this.options.type===void 0?rl.DATE:this.options.type}get isRange(){return this.options.range===void 0||this.options.style===Id.SLIDER?!1:this.options.range}get style(){return this.options.style===void 0?Id.SLIDER:this.options.style}get step(){let e=108e5;if(this.options.step===void 0)switch(this.type){case rl.DATE:case rl.DATETIME:e=108e5;break;case rl.TIME:e=36e5;break;case rl.YEAR:e=31536e6;break;default:e=108e5}else e=this.getStepDefinition(this.options.step);return e}get timeInterval(){return this.options.timeInterval===void 0?2e3:this.options.timeInterval}get min(){if(this.options.min){let e=new Date(this.options.min);return new Date(e.getTime()+e.getTimezoneOffset()*6e4)}else return}get max(){if(this.options.max){let e=new Date(this.options.max);return new Date(e.getTime()+e.getTimezoneOffset()*6e4)}else return}get is(){return this.options.range===void 0?!1:this.options.range}constructor(e){this.dateAdapter=e,this.dateAdapter.setLocale("fr")}ngOnInit(){if(this.startDate===void 0&&(this.startDate=new Date(this.min)),this.endDate===void 0&&(this.endDate=new Date(this.max)),this.startYear===void 0&&(this.startYear=new Date(this.startDate).getFullYear(),this.initStartYear=this.startYear),this.endYear===void 0&&(this.endYear=new Date(this.endDate).getFullYear(),this.initEndYear=this.endYear),this.isRange){for(let e=this.startYear;e<this.endYear;e++)this.startListYears.push(e);for(let e=this.startYear+1;e<=this.endYear;e++)this.endListYears.push(e)}else for(let e=this.startYear;e<=this.endYear+1;e++)this.listYears.push(e);this.options.enabled=this.options.enabled===void 0?!0:this.options.enabled,this.checkFilterValue(),this.options.enabled?!this.isRange&&this.style==="slider"&&this.type==="year"&&this.yearChange.emit(this.year):(this.storeCurrentFilterValue(),this.yearChange.emit(void 0))}storeCurrentFilterValue(){!this.isRange&&this.style===Id.SLIDER&&this.type===rl.YEAR&&(this.options.value=this.year.toString())}checkFilterValue(){let n=this.layer.dataSource.ol.getParams().TIME;if(!this.isRange&&this.style===Id.SLIDER&&this.type===rl.YEAR)n?this.year=new Date(n.toString()).getFullYear()+1:this.options.value?this.year=new Date(this.options.value.toString()).getFullYear()+1:this.year=new Date(this.min).getFullYear()+1;else if(this.isRange&&this.style===Id.CALENDAR&&this.type===rl.YEAR&&n){this.startYear=parseInt(n.substr(0,4),10),this.endYear=parseInt(n.substr(5,4),10);let o=[],s=[];for(let l=this.initStartYear;l<this.endYear;l++)o.push(l);for(let l=this.startYear+1;l<=this.initEndYear;l++)s.push(l);this.startListYears=o,this.endListYears=s}}handleDateChange(){this.setupDateOutput(),this.applyTypeChange(),this.isRange?this.change.emit([this.startDate,this.endDate]):this.change.emit(this.startDate)}handleYearChange(){if(this.isRange){this.endListYears=[];for(let e=this.startYear+1;e<=this.initEndYear;e++)this.endListYears.push(e);this.startListYears=[];for(let e=this.initStartYear+1;e<this.endYear;e++)this.startListYears.push(e);this.yearChange.emit([this.startYear,this.endYear])}else this.yearChange.emit(this.year)}handleListYearChange(){this.handleYearChange()}handleListYearStartChange(){this.change.emit([this.startDate,this.endDate])}dateToNumber(e){let n;return e?n=new Date(e):n=new Date(this.min),n.getTime()}setSliderThumbLabel(e){let n=this.findThumbLabel(this.mySlider._elementRef.nativeElement.childNodes);n&&(n.textContent=e)}findThumbLabel(e){let n;return e.forEach(o=>{o.className==="mat-slider-thumb-label-text"&&(n=o),o.children.length>0&&!n&&(n=this.findThumbLabel(o.childNodes))},this),n}toggleFilterState(){this.options.enabled=!this.options.enabled,this.options.enabled?!this.isRange&&Id.SLIDER&&this.type===rl.YEAR&&this.yearChange.emit(this.year):(this.stopFilter(),this.storeCurrentFilterValue(),this.change.emit(void 0))}resetFilter(){this.date=new Date(this.min),this.year=this.date.getFullYear(),!this.isRange&&Id.SLIDER&&this.type===rl.YEAR?this.yearChange.emit(this.year):(this.setupDateOutput(),this.change.emit(void 0))}playFilter(){this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=window.setInterval(e=>{let n,o=new Date(e.max);n=e.date===void 0?e.min.getTime():e.date.getTime(),n+=e.mySlider.step,e.date=new Date(n),n>o.getTime()&&e.stopFilter(),e.handleDateChange()},this.timeInterval,this))}playYear(){this.year+this.mySlider.step>this.max.getFullYear()+this.mySlider.step&&(this.stopFilter(),this.resetFilter()),this.interval?this.stopFilter():(this.playIcon="pause_circle",this.interval=setInterval(()=>{this.year+this.mySlider.step>this.max.getFullYear()?this.stopFilter():this.year=this.year+this.mySlider.step,this.yearChange.emit(this.year)},this.timeInterval,this))}stopFilter(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.playIcon="play_circle"}handleSliderDateChange(e){this.date=new Date(e.value),this.setSliderThumbLabel(this.handleSliderTooltip()),this.handleDateChange()}handleSliderYearChange(e){this.year=e.value,this.yearChange.emit(this.year)}handleSliderValue(){if(this.options.current===!0||!this.min){let e=new Date;this.date=this.getRoundedDate(e)}return this.type===rl.YEAR?this.year:this.date===void 0?this.min.getTime():this.date.getTime()}handleSliderTooltip(){let e;switch(this.type){case rl.DATE:e=this.date===void 0?this.min.toDateString():this.date.toDateString();break;case rl.TIME:e=this.date===void 0?this.min.toTimeString():this.date.toTimeString();break;default:e=this.date===void 0?this.min.toUTCString():this.date.toUTCString();break}return e}setupDateOutput(){this.style===Id.SLIDER?(this.startDate=new Date(this.date),this.startDate.setSeconds(-(this.step/1e3)),this.endDate=new Date(this.startDate),this.endDate.setSeconds(this.step/1e3)):!this.isRange&&this.date?(this.endDate=new Date(this.date),this.startDate=new Date(this.date)):this.isRange&&(this.date||!this.date)?(this.startDate=this.startDate===void 0?new Date(this.min):this.startDate,this.endDate=this.endDate===void 0?new Date(this.max):this.endDate):this.date||(this.startDate=this.startDate===void 0?new Date(this.min):this.startDate,this.endDate=this.endDate===void 0?new Date(this.max):this.endDate)}applyTypeChange(){switch(this.type){case rl.DATE:(this.startDate!==void 0||this.endDate!==void 0)&&(this.startDate.setHours(0),this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setHours(23),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;case rl.TIME:if(this.style===Id.CALENDAR){if(this.startDate.getDay()!==this.min.getDay()){let e=this.startDate.getHours(),n=this.startDate.getMinutes();this.startDate=this.min,this.startDate.setHours(e),this.startDate.setMinutes(n)}if(this.endDate.getDay()!==this.min.getDay()){let e=this.endDate.getHours(),n=this.endDate.getMinutes();this.endDate=this.min,this.endDate.setHours(e),this.endDate.setMinutes(n)}}!this.isRange&&this.step>60*60*1e3&&(this.startDate.setMinutes(0),this.startDate.setSeconds(0),this.endDate.setMinutes(59),this.endDate.setSeconds(59));break;default:}}getRangeMinDate(){return this.startDate===void 0?this.min:this.startDate}getRangeMaxDate(){return this.endDate===void 0?this.max:this.endDate}getRoundedDate(e,n=10){let o=6e4*n;return new Date(Math.round(e.getTime()/o)*o)}getStepDefinition(e){return yte.default.duration(e).asMilliseconds()}static \u0275fac=function(n){return new(n||r)(Ie(P1))};static \u0275cmp=nt({type:r,selectors:[["igo-time-filter-form"]],viewQuery:function(n,o){if(n&1&&Ir(uf,5),n&2){let s;bi(s=wi())&&(o.mySlider=s.first)}},inputs:{layer:"layer",options:"options",currentValue:"currentValue"},outputs:{change:"change",yearChange:"yearChange"},standalone:!0,features:[lt],decls:5,vars:4,consts:[["datetimePicker",""],["minDatetimePicker",""],["maxDatetimePicker",""],["ngSlider",""],["ngSliderThumb","matSliderThumb"],["actions",""],[4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m mat-typography",4,"ngIf"],["class","igo-col igo-col-100 igo-col-100-m",4,"ngIf"],[1,"igo-col","igo-col-100","igo-col-100-m"],["matSuffix","",1,"time-filter-mat-datetimepicker-toggle",3,"for"],[3,"type","openOnFocus","timeInterval"],["matInput","","autocomplete","false","readonly","readonly",3,"ngModelChange","dateChange","placeholder","matDatetimepicker","ngModel","min","max"],[1,"igo-col","igo-col-100"],["matInput","","autocomplete","false","readonly","readonly",3,"ngModelChange","input","dateChange","placeholder","matDatetimepicker","ngModel","min","max"],[3,"ngModelChange","selectionChange","placeholder","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"igo-col","igo-col-100","igo-col-100-m","mat-typography"],["id","time-slider","thumbLabel","",3,"step","min","max","color","disabled"],["matSliderThumb","",3,"input","change","value"],["class","date-below",4,"ngIf"],[1,"igo-layer-actions-container"],["tooltip-position","below","matTooltipShowDelay","500",3,"change","matTooltip","color","checked","disabled"],["mat-icon-button","","color","primary",3,"click","disabled"],[1,"date-below"],["id","time-slider","thumbLabel","",3,"selectionChange","step","min","max"],["matSliderThumb","",3,"input","value"],["mat-icon-button","","color","primary",3,"click"]],template:function(n,o){n&1&&(Pe(0,pEe,3,2,"div",6)(1,vEe,3,2,"div",6),ct(2,"br"),Pe(3,wEe,20,19,"div",7)(4,xEe,10,6,"div",8)),n&2&&(z("ngIf",o.style==="calendar"&&o.type!=="year"),j(),z("ngIf",o.style==="calendar"&&o.type==="year"),j(2),z("ngIf",!o.isRange&&o.style==="slider"&&o.type==="year"),j(),z("ngIf",o.style==="slider"&&o.type!=="year"))},dependencies:[Gt,jr,Gr,Vc,_te,fte,gte,y3,DG,hte,kA,gn,Cn,Sn,os,kn,nc,ho,uo,Nn,Li,Bn,v_,uf,o1,bl,js,Qt,ti,Vt,ci,jt,$t,Et,Tt],styles:[`[_nghost-%COMP%]   .igo-layer-filters-container[_ngcontent-%COMP%]{padding-left:5px}[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:70%}@media only screen and (orientation:portrait) and (max-width: 599px),only screen and (orientation:landscape) and (max-width: 959px){[_nghost-%COMP%]   #time-slider[_ngcontent-%COMP%]{width:60%}}[_nghost-%COMP%]   .date-below[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]   .igo-layer-actions-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}
/*# sourceMappingURL=time-filter-form.component-XAH3DKNU.css.map */`]})}return r})();var SEe=r=>({cursor:r}),CEe=r=>({disabled:r});function AEe(r,i){if(r&1){let e=We();$(0,"button",10),le(1,"translate"),le(2,"translate"),ve("click",function(){we(e);let o=ne(2);return xe(o.layer.visible=!o.layer.visible)}),$(3,"mat-icon",11),le(4,"async"),_e(5),ee()()}if(r&2){let e=ne(2);z("color",e.layer.visible?"primary":"default")("matTooltip",e.layer.visible?ce(1,4,"igo.geo.layer.hideLayer"):ce(2,6,"igo.geo.layer.showLayer")),j(3),z("ngClass",fn(10,CEe,ce(4,8,e.inResolutionRange$)===!1)),j(2),Qe("",e.layer.visible?"visibility":"visibility_off"," ")}}function MEe(r,i){if(r&1){let e=We();$(0,"mat-list-item")(1,"mat-icon",7),ve("click",function(){we(e);let o=ne();return xe(o.toggleFiltersCollapsed())}),_e(2," expand_less "),ee(),$(3,"span",8),ve("click",function(){we(e);let o=ne();return xe(o.toggleLegendOnClick())}),_e(4),ee(),Pe(5,AEe,6,12,"button",9),ee()}if(r&2){let e=ne(),n=Xt(2);j(),z("target",n)("collapsed",e.filtersCollapsed),j(2),z("ngStyle",fn(5,SEe,e.filtersCollapsed?"default":"pointer")),j(),bt(e.layer.title),j(),z("ngIf",e.header)}}function IEe(r,i){if(r&1&&ct(0,"igo-layer-legend",12),r&2){let e=ne();z("layer",e.layer)}}var DC=(()=>{class r{timeFilterService;color="primary";showLegend$=new ut(!1);inResolutionRange$=new ut(!0);resolution$$;filtersCollapsed=!1;header=!0;layer;get datasource(){return this.layer.dataSource}constructor(e){this.timeFilterService=e}ngOnInit(){let e=this.layer.map.viewController.resolution$;this.resolution$$=e.subscribe(()=>{this.inResolutionRange$.next(this.layer.isInResolutionsRange)})}ngOnDestroy(){this.resolution$$.unsubscribe()}handleYearChange(e){this.timeFilterService.filterByYear(this.datasource,e)}handleDateChange(e){this.timeFilterService.filterByDate(this.datasource,e)}toggleLegend(e){this.layer.legendCollapsed=e,this.showLegend$.next(!e)}toggleLegendOnClick(){this.filtersCollapsed||this.toggleLegend(this.showLegend$.value)}setVisible(){this.layer.visible=!0}toggleFiltersCollapsed(){this.filtersCollapsed=!this.filtersCollapsed}static \u0275fac=function(n){return new(n||r)(Ie(mC))};static \u0275cmp=nt({type:r,selectors:[["igo-time-filter-item"]],inputs:{header:"header",layer:"layer"},standalone:!0,features:[Xi([mC]),lt],decls:8,vars:7,consts:[["filters",""],["legend",""],[4,"ngIf"],[1,"igo-datasource-filters-container"],[1,"igo-layer-legend-container"],[3,"layer",4,"ngIf"],[3,"change","yearChange","layer","options","currentValue"],["matListItemIcon","","igoCollapse","",1,"igo-chevron",3,"click","target","collapsed"],["matListItemTitle","",3,"click","ngStyle"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"color","matTooltip","click",4,"ngIf"],["mat-icon-button","","matListItemMeta","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"click","color","matTooltip"],[3,"ngClass"],[3,"layer"]],template:function(n,o){if(n&1){let s=We();Pe(0,MEe,6,7,"mat-list-item",2),$(1,"div",3,0)(3,"div",4,1),Pe(5,IEe,1,1,"igo-layer-legend",5),le(6,"async"),ee(),$(7,"igo-time-filter-form",6),ve("change",function(h){return we(s),xe(o.handleDateChange(h))})("yearChange",function(h){return we(s),xe(o.handleYearChange(h))}),ee()()}n&2&&(z("ngIf",o.header),j(5),z("ngIf",ce(6,5,o.showLegend$)),j(2),z("layer",o.layer)("options",o.datasource.options.timeFilter)("currentValue",o.datasource.options.params.TIME))},dependencies:[Gt,Io,ks,oc,Ta,Ju,jt,$t,Vp,cl,Vt,ci,Qt,ti,_a,Up,J8,Ei,Et,Tt],styles:[`[_nghost-%COMP%]{overflow:hidden}[_nghost-%COMP%]   .igo-datasource-filters-container[_ngcontent-%COMP%]{text-align:center;width:100%;display:inline-block;padding-top:5px}[_nghost-%COMP%]   .igo-layer-legend-container[_ngcontent-%COMP%]{padding-left:1.125em;width:calc(100% - 18px)}
/*# sourceMappingURL=time-filter-item.component-JOEEMYFR.css.map */`]})}return r})();function EEe(r,i){if(r&1&&($(0,"button",3),le(1,"translate"),$(2,"mat-icon",4),_e(3,"history"),ee()()),r&2){let e=ne();z("matTooltip",ce(1,3,"igo.geo.filter.filterBy"))("color",e.color),j(2),z("matBadge",e.badge)}}function TEe(r,i){if(r&1&&ct(0,"igo-time-filter-item",7),r&2){let e=ne(2);z("header",!1)("layer",e.layer)}}function FEe(r,i){if(r&1&&($(0,"div",5,0),Pe(2,TEe,1,2,"igo-time-filter-item",6),ee()),r&2){let e=ne();j(2),z("ngIf",e.timeFilterCollapse&&e.options.timeFilter)}}var PEe=(()=>{class r{options;get badge(){let e=this.options.timeFilter;if(e&&e.enabled)return 1}get layer(){return this._layer}set layer(e){this._layer=e,e&&(this.options=this.layer.dataSource.options)}_layer;map;color="primary";header=!0;timeFilterCollapse=!1;ngOnInit(){this.options=this.layer.dataSource.options}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-time-filter-button"]],inputs:{layer:"layer",map:"map",color:"color",header:"header"},standalone:!0,features:[lt],decls:2,vars:2,consts:[["ogcFilter",""],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["class","igo-layer-actions-container",4,"ngIf"],["mat-icon-button","","collapsibleButton","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"],["aria-hidden","false","matBadgeColor","warn","matBadgeSize","medium",3,"matBadge"],[1,"igo-layer-actions-container"],["igoListItem","",3,"header","layer",4,"ngIf"],["igoListItem","",3,"header","layer"]],template:function(n,o){n&1&&Pe(0,EEe,4,5,"button",1)(1,FEe,3,1,"div",2),n&2&&(z("ngIf",o.header&&o.options.timeFilterable&&o.options.timeFilter),j(),z("ngIf",o.header&&o.options.timeFilterable&&o.options.timeFilter))},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,xl,Md,DC,Qo,Et,Tt],changeDetection:0})}return r})();function LEe(r,i){if(r&1&&ct(0,"igo-time-filter-item",2),r&2){let e=i.$implicit;z("header",!0)("layer",e)}}var eB=(()=>{class r{layers=[];static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-time-filter-list"]],inputs:{layers:"layers"},standalone:!0,features:[lt],decls:3,vars:6,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],["igoListItem","",3,"header","layer"]],template:function(n,o){n&1&&($(0,"igo-list",0),Pe(1,LEe,1,2,"ng-template",1),le(2,"filterableDataSource"),ee()),n&2&&(z("navigation",!1)("selection",!1),j(),z("ngForOf",Ao(2,3,o.layers,"time")))},dependencies:[yc,Li,DC,Qo,pC],encapsulation:2,changeDetection:0})}return r})();var OEe=(()=>{class r{mapService;component;layers$$;constructor(e,n){this.mapService=n,this.component=e}ngOnInit(){this.component.layers=[],this.layers$$=this.mapService.getMap().layerController.all$.subscribe(e=>{this.component.layers=e})}ngOnDestroy(){this.layers$$.unsubscribe()}static \u0275fac=function(n){return new(n||r)(Ie(eB,2),Ie(nf))};static \u0275dir=Fi({type:r,selectors:[["","igoTimeFilterListBinding",""]],standalone:!0})}return r})();function DEe(r,i){if(r&1&&($(0,"button",1),le(1,"translate"),$(2,"mat-icon"),_e(3,"file_save"),ee()()),r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.download.action"))("color",e.color)}}var REe=(()=>{class r{layer;color="primary";get options(){if(this.layer)return this.layer.dataSource.options}layerIsExportable(){return!!(this.layer instanceof Fr&&this.layer.exportable===!0||this.layer.dataSource.options.download&&this.layer.dataSource.options.download.url||this.layer.options.workspace?.enabled&&this.layer.options.workspace?.workspaceId!==this.layer.id)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-export-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color"]],template:function(n,o){n&1&&Pe(0,DEe,4,4,"button",0),n&2&&z("ngIf",o.layerIsExportable())},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,Et,Tt],changeDetection:0})}return r})();var NEe=r=>({"igo-spinner-container":!0,"igo-spinner-shown":r}),v3=(()=>{class r{shown$=new ut(!1);set shown(e){this.shown$.next(e)}get shown(){return this.shown$.value}show(){this.shown=!0}hide(){this.shown=!1}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-spinner"]],inputs:{shown:"shown"},standalone:!0,features:[lt],decls:4,vars:5,consts:[[3,"ngClass"],[1,"igo-spinner-background"],["diameter","40","mode","indeterminate"]],template:function(n,o){n&1&&($(0,"div",0),le(1,"async"),ct(2,"div",1)(3,"mat-progress-spinner",2),ee()),n&2&&z("ngClass",fn(3,NEe,ce(1,1,o.shown$)))},dependencies:[_a,n9,Ei],styles:[`[_nghost-%COMP%]   .igo-spinner-container[_ngcontent-%COMP%]{display:none;position:relative;pointer-events:none}[_nghost-%COMP%]   .igo-spinner-container.igo-spinner-shown[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   mat-progress-spinner[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}[_nghost-%COMP%]   .igo-spinner-background[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:50%;border:4px solid #ffffff;position:absolute;top:2px;left:2px}
/*# sourceMappingURL=spinner.component-X37E5KEJ.css.map */`]})}return r})();var b3=(()=>{class r{styleList={};httpClient;constructor(e){this.httpClient=new Er(e)}getStyleList(e){return rr.resolve(this.styleList,e)}load(e){let n=e.default||{};return e.path?new Promise(o=>{this.httpClient.get(e.path).pipe(qr(s=>(console.log(`StyleList file ${e.path} could not be read`),o(!0),A1(s.error||"Server error")))).subscribe(s=>{this.styleList=rr.mergeDeep(n,s),o(!0)})}):(this.styleList=n,!0)}static \u0275fac=function(n){return new(n||r)(pt(L7))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var w3=class extends Error{},x3=class r extends w3{constructor(){super("Invalid file"),Object.setPrototypeOf(this,r.prototype)}},Ew=class r extends w3{constructor(){super("Nothing to export"),Object.setPrototypeOf(this,r.prototype)}};function bte(r,i){if(r instanceof Ew){GEe(i);return}i.error("igo.geo.export.failed.text","igo.geo.export.failed.title")}function wte(r){r.success("igo.geo.export.success.text","igo.geo.export.success.title")}function GEe(r){r.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title")}function RC(r){return r==="CSV"||["CSVsemicolon","CSVcomma"].includes(r)}var jEe=255,S3=(()=>{class r{config;httpClient;static ogreFormats={GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"ESRI Shapefile",CSV:"CSV",CSVcomma:"CSVcomma",CSVsemicolon:"CSVsemicolon"};static noOgreFallbacks=["GML","GPX","KML"];ogreUrl;aggregateInComment=!0;constructor(e,n){this.config=e,this.httpClient=n,this.ogreUrl=this.config.getConfig("importExport.url");let o=this.config.getConfig("importExport.gpxAggregateInComment");o!==void 0&&(this.aggregateInComment=o)}export(e,n,o,s="EPSG:4326",l="EPSG:4326"){let h=this.cleanFeatures(e,n.format,"_featureStore");return this.exportAsync(h,n,o,s,l)}cleanFeatures(e,n,o="_"){return n==="GPX"&&this.aggregateInComment?this.generateAggregatedFeature(e):e.map(s=>{let l=s.getKeys().filter(p=>!p.startsWith(o));n==="Shapefile"&&s.get("_style")&&JSON.stringify(s.get("_style")).length>jEe&&(l=l.filter(m=>m!=="_style"));let h=l.reduce((p,m)=>(p[m]=s.get(m),p),{geometry:s.getGeometry()});return new gi(h)})}generateAggregatedFeature(e){return e.map(n=>{let o=n.getKeys().filter(p=>!p.startsWith("_")),s="",l=o.reduce((p,m)=>(m&&m!=="geometry"&&(m==="id"&&n.get("draw")?s+=m+":"+n.get("draw")+`   \r
`:s+=m+":"+n.get(m)+`   \r
`),p[m]=n.get(m),p),{geometry:n.getGeometry()}),h=new gi(l);return h.set("name",n.getId()),h.set("cmt",s),h})}exportAsync(e,n,o,s,l){let{format:h}=n;return new $r(p=>{if(this.nothingToExport(e,h)){p.error(new Ew);return}if(Object.keys(r.ogreFormats).indexOf(h)>=0){if(!this.ogreUrl){r.noOgreFallbacks.indexOf(h)>=0?(this.exportToFile(e,h,o,s,l),p.complete()):p.error(new x3);return}this.exportWithOgre(e,n,o,s,l).subscribe({complete:()=>p.complete(),error:g=>p.error(g)})}else this.exportToFile(e,h,o,s,l),p.complete()})}exportToFile(e,n,o,s,l){return un(this,null,function*(){let h=this.formatFeatures(e,n,s,l),p=`${o}.${n.toLowerCase()}`;XF(h,"attachment/plain;charset=utf-8",p)})}formatFeatures(e,n,o="EPSG:4326",s="EPSG:4326"){let l=this.getFormatter(n),h=this.cleanFeatures(e,n,"_featureStore");return l.writeFeatures(h,{dataProjection:s,featureProjection:o})}getFormatter(e){switch(e){case"GPX":return new sg;case"GML":return new Ty;case"KML":return new cg;default:return new Qr}}exportExcel(e,n,o){return un(this,null,function*(){let s=yield bG();for(let h of o.layers){let p=e.layerController.getById(h);if(An(p))continue;let m=yield dx(this.getFeatures(e,p,o,n)),f=m?.length?this.formatFeatures(m,"GeoJSON"):null,y=(m?JSON.parse(f):{features:[]}).features.map(_=>this.formatRecord(_.properties));yield wG(p.title,y,s)}let l=this.getTitleFromLayers(o.layers,e);xG(s,l,{compression:!0})})}getTitleFromLayers(e,n){return e.length===1?this.getLayerTitleFromId(e[0],n):"igo"}getLayerTitleFromId(e,n){return n.layerController.getById(e).title}formatRecord(e){return Object.entries(e).reduce((n,[o,s])=>(n[o]=this.formatDataType(s),n),{})}formatDataType(e){switch(!0){case typeof e=="string":return vG(e)?new Date(e).toLocaleString():e;case typeof e=="object":case e instanceof Array:return JSON.stringify(e);default:return e}}exportWithOgre(e,{format:n,csvSeparator:o=null},s,l,h){let p=new Qr().writeFeatures(e,{dataProjection:h,featureProjection:l}),m=`${this.ogreUrl}/convertJson`,f=new FormData;f.append("json",p);let g=n==="Shapefile"?`${s}.zip`:`${s}.${n.toLowerCase()}`,y=r.ogreFormats[n];return RC(n)&&(g=`${s}.csv`,(n==="CSVcomma"||n==="CSVsemicolon")&&(y="CSV"),f.append("lco",`SEPARATOR=${o}`),n==="CSVsemicolon"&&f.append("lco",`SEPARATOR=${o}`)),f.append("outputName",this.formatFilename(g)),f.append("format",y),this.httpClient.post(m,f,{responseType:"blob"}).pipe(bu(_=>{SG(_,g)}))}formatFilename(e){return e.replaceAll(" ","_").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(//g,"'")}nothingToExport(e,n){return e.length===0?!0:n==="GPX"?e.find(s=>["Point","LineString","MultiLineString"].indexOf(s.getGeometry().getType())>=0)===void 0:!1}getFeaturesFromMap(e,n){let o=e.dataSource.ol,s=e.map.viewController.getExtent(),l=n.featureInMapExtent?o.getFeaturesInExtent(s):o.getFeatures();return e.dataSource instanceof kc&&(l=l.flatMap(h=>h.get("features"))),l}getFeaturesFromWorkspace(e,n,o){let s=o.layersWithSelection.indexOf(n)!==-1,l=o.featureInMapExtent;return s&&l?e.entityStore.stateView.all().filter(h=>h.state.inMapExtent&&h.state.selected).map(h=>h.entity.ol):s&&!l?e.entityStore.stateView.all().filter(h=>h.state.selected).map(h=>h.entity.ol):l?e.entityStore.stateView.all().filter(h=>h.state.inMapExtent).map(h=>h.entity.ol):e.entityStore.stateView.all().map(h=>h.entity.ol)}getFeatures(e,n,o,s){let l=e.viewController.getOlProjection(),h=o.featureInMapExtent?e.viewController.getExtent():void 0;if(n.dataSource instanceof qh)return n.dataSource.fetchFeatures({extent:h,projection:l,httpClient:this.httpClient}).pipe(qr(p=>{throw p}));if(n.options.workspace?.enabled){let p=this.getWorkspaceByLayerId(n.id,s);if(p?.entityStore?.stateView.all().length){let m=this.getFeaturesFromWorkspace(p,n.id,o);return ai(m).pipe(qr(f=>{throw f}))}}else if(n instanceof Fr)return ai(this.getFeaturesFromMap(n,o));return ai([])}getWorkspaceByLayerId(e,n){let o=n.all().find(s=>s.layer.id===e);if(o)return o}getGeomTypes(e,n){let o=[];return n==="Shapefile"||n==="GPX"?e.forEach(s=>{let l=s.getGeometry().getType(),h=o.find(p=>p.type===l);h?h.features.push(s):o.push({type:l,features:[s]})}):o=[{type:null,features:e}],o.forEach(s=>{s.features.forEach(l=>{let h=l.get("rad");if(h){let p=[l.get("longitude"),l.get("latitude")],m=pI(p,h,500);m.transform("EPSG:4326",l.get("_projection")),l.setGeometry(m)}})}),o}static \u0275fac=function(n){return new(n||r)(pt(Oi),pt(Er))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var tB=["GeoJSON","Excel","Shapefile","GML","GPX","KML","CSV","URL"],xte=["CSVcomma","CSVsemicolon"],Ste=["auto","comma","semicolon"];var T_=class extends Error{},NC=class r extends T_{constructor(){super("Invalid file"),Object.setPrototypeOf(this,r.prototype)}},F_=class r extends T_{constructor(){super("Failed to read file"),Object.setPrototypeOf(this,r.prototype)}},C3=class r extends T_{constructor(){super("Nothing to import"),Object.setPrototypeOf(this,r.prototype)}},A3=class extends T_{constructor(){super("File is too large"),Object.setPrototypeOf(this,C3.prototype)}},M3=class extends T_{constructor(){super("Invalid SRS definition"),Object.setPrototypeOf(this,C3.prototype)}},I3=class r extends T_{constructor(){super("Error 500 with OGRE"),Object.setPrototypeOf(this,r.prototype)}};function UEe(r,i,e,n,o,s=!1){let l=r.map(_=>ku(_,i.projection)),h=rn(),p={id:h,type:"vector",queryable:!0},m=new kr(p);m.ol.addFeatures(l);let f,g=!1;l[0].getKeys().includes("_style")||l[0].getKeys().includes("_mapTitle")?f=rJ():(f=nJ(),g=!0);let y=o.createLayer({id:h,title:n,workspace:{enabled:!0,searchIndexEnabled:!0},isIgoInternalLayer:!0,source:m,igoStyle:{editable:g},idbInfo:{storeToIdb:s,contextUri:e},style:f});return y.setExtent(By(l,i.viewProjection)),i.layerController.add(y),ih(i.viewController,l),y}function zEe(r,i,e,n,o,s,l,h,p=!0){let m=r.map(w=>ku(w,i.projection)),f,g;if(n.getStyleList(e.toString()+".styleByAttribute")){let w=n.getStyleList(e.toString()+".styleByAttribute");f=(A,k)=>o.createStyleByAttribute(A,w,k)}else if(n.getStyleList(e.toString()+".clusterStyle")){let w=n.getStyleList(e.toString()+".clusterParam");g=n.getStyleList(e.toString()+".distance"),f=(A,k)=>{let R=o.createStyle(n.getStyleList(e.toString()+".clusterStyle"),A,k);return o.createClusterStyle(A,k,w,R)}}else if(n.getStyleList(e.toString()+".style"))f=(w,A)=>o.createStyle(n.getStyleList(e.toString()+".style"),w,A);else if(n.getStyleList("default.clusterStyle")&&r[0].geometry.type==="Point"){let w=n.getStyleList("default.clusterParam");g=n.getStyleList("default.distance"),f=(A,k)=>{let R=o.createStyle(n.getStyleList("default.clusterStyle"),A,k);return o.createClusterStyle(A,k,w,R)}}else f=(w,A)=>o.createStyle(n.getStyleList("default.style"),w,A);let y;if(n.getStyleList(e.toString()+".clusterStyle")){let w={distance:g,type:"cluster",queryable:!0};y=new kc(Object.assign(w,l)),y.ol.source.addFeatures(m)}else if(n.getStyleList(e.toString())){let w={type:"vector",queryable:!0};y=new kr(Object.assign(w,l)),y.ol.addFeatures(m)}else if(n.getStyleList("default.clusterStyle")&&r[0].geometry.type==="Point"){let w={distance:g,type:"cluster",queryable:!0};y=new kc(Object.assign(w,l)),y.ol.source.addFeatures(m)}else{let w={type:"vector",queryable:!0};y=new kr(Object.assign(w,l)),y.ol.addFeatures(m)}let _=new Fr(Object.assign({title:e,id:s||rn(),isIgoInternalLayer:!0,source:y,style:f},h));return i.layerController.add(_),p&&ih(i.viewController,m),_}function E3(r){return r.toString().padStart(2,"0")}function T3(r,i,e,n,o,s,l,h,p){if(i.length===0){qEe(r,o);return}let m=F3(r);(l?l.open("igo.geo.import.promptStoreToIdb"):ai(!1)).pipe(Ps()).subscribe(g=>{let y=new Date,_=[y.getFullYear(),E3(y.getMonth()+1),E3(y.getDate())].join("/")+" "+[E3(y.getHours()),E3(y.getMinutes())].join(":");m=g?`${m} (${_})`:m,h?zEe(i,e,m,h,p):UEe(i,e,n,m,s,g),o.success("igo.geo.dropGeoFile.success.text","igo.geo.dropGeoFile.success.title",void 0,{value:m})})}function iB(r,i,e,n){n=n||30,{"Invalid file":$Ee,"File is too large":HEe,"Failed to read file":WEe,"Invalid SRS definition":YEe,"Error 500 with OGRE":ZEe}[i.message](r,i,e,n)}function $Ee(r,i,e){e.error("igo.geo.dropGeoFile.invalid.text","igo.geo.dropGeoFile.invalid.title",void 0,{value:r.name,mimeType:r.type})}function WEe(r,i,e){e.error("igo.geo.dropGeoFile.unreadable.text","igo.geo.dropGeoFile.unreadable.title",void 0,{value:r.name})}function HEe(r,i,e,n){e.error("igo.geo.dropGeoFile.tooLarge.text","igo.geo.dropGeoFile.tooLarge.title",void 0,{value:r.name,size:n})}function qEe(r,i){i.error("igo.geo.dropGeoFile.empty.text","igo.geo.dropGeoFile.empty.title",void 0,{value:r.name,mimeType:r.type})}function YEe(r,i){i.error("igo.geo.dropGeoFile.invalidSRS.text","igo.geo.dropGeoFile.invalidSRS.title",void 0,{value:r.name,mimeType:r.type})}function ZEe(r,i,e){e.error("igo.geo.dropGeoFile.ogreServer.text","igo.geo.dropGeoFile.ogreServer.title")}function rB(r){return r.name.split(".").pop().toLowerCase()}function F3(r){return r.name.substr(0,r.name.lastIndexOf("."))}var nB=(()=>{class r{http;config;static formatExtensionAssociation={GeoJSON:"geojson",GML:"gml",GPX:"gpx",KML:"kml",Shapefile:"zip"};static allowedMimeTypes=["application/gml+xml","application/vnd.google-earth.kml+xml","application/gpx+xml","application/json"];static allowedZipMimeTypes=["application/zip","application/x-zip-compressed","application/x-zip"];static allowedExtensions=["geojson","kml","gpx","json","gml","zip"];ogreUrl;clientSideFileSizeMax;constructor(e,n){this.http=e,this.config=n;let o=this.config.getConfig("importExport");this.ogreUrl=o.url;let s=o.clientSideFileSizeMaxMb;this.clientSideFileSizeMax=(s||30)*Math.pow(1024,2),o.formats&&(r.allowedExtensions=o.formats.map(l=>r.formatExtensionAssociation[l]).filter(l=>l),r.allowedExtensions.includes("geojson")&&r.allowedExtensions.push("json"))}import(e,n="EPSG:4326",o="EPSG:4326"){return this.importAsync(e,n,o)}getFileImporter(e){let n=rB(e),o=r.allowedExtensions,s=[];o.includes("zip")&&(s=r.allowedZipMimeTypes);let l=e.type;if(!([...r.allowedMimeTypes,...s].indexOf(l)<0&&o.indexOf(n)<0)){if(l==="application/json"||["json","geojson","kml","gpx"].indexOf(n)>=0)return this.importFile;if(this.ogreUrl!==void 0)return this.importFileWithOgre}}importAsync(e,n,o){let s=l=>{if(e.size>=this.clientSideFileSizeMax){l.error(new A3);return}let h=this.getFileImporter(e);if(h===void 0){l.error(new NC);return}h.call(this,e,l,n,o)};return new $r(s)}importFile(e,n,o,s){let l=new FileReader;l.onload=h=>{try{let p=this.parseFeaturesFromFile(e,h.target.result,o,s);n.next(p)}catch{n.error(new F_)}n.complete()},l.onerror=()=>{n.error(new F_)},l.readAsText(e,"UTF-8")}importFileWithOgre(e,n,o,s){let l=`${this.ogreUrl}/convert`,h=new FormData;h.append("upload",e),h.append("sourceSrs",o),h.append("targetSrs",s),h.append("formatOutput","GEOJSON"),h.append("skipFailures",""),this.http.post(l,h,{headers:new vx}).subscribe(p=>{if(p===null){n.error(new F_);return}if((p.errors||[]).length>0)n.error(new F_);else{let f=this.parseFeaturesFromGeoJSON(e,p,s);n.next(f),n.complete()}},p=>{p.error.caught=!0;let m=p.error.msg||"";m==="No valid files found"?n.error(new NC):m&&m.startWith("ERROR 1: Failed to process SRS definition")?n.error(new M3):p.status===500?n.error(new I3):n.error(new F_)})}parseFeaturesFromFile(e,n,o,s){let l=rB(e),h=e.type,p=new Qr,m;if(h==="application/vnd.google-earth.kml+xml")m=new cg;else if(h==="application/gml+xml")m=new Ty;else if(h==="application/gpx+xml")m=new sg;else switch(l){case"kml":m=new cg;break;case"gpx":m=new sg;break;case"gml":m=new Ty;break;default:m=p;break}return m.readFeatures(n,{dataProjection:o,featureProjection:s}).map(y=>Object.assign(p.writeFeatureObject(y),{projection:s,meta:{id:rn(),title:F3(e)}}))}parseFeaturesFromGeoJSON(e,n,o){let s=new Qr;return s.readFeatures(n).map(p=>Object.assign(s.writeFeatureObject(p),{projection:o,meta:{id:rn(),title:F3(e)}}))}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var KEe=r=>({size:r}),QEe=r=>({"igo-export-layer-mat-option":r});function JEe(r,i){if(r&1&&($(0,"span",16),_e(1),le(2,"translate"),ee()),r&2){let e=ne().$implicit;j(),Qe(" ",Ao(2,1,"igo.geo.importExportForm.projections."+e.translateKey,e)," ")}}function eTe(r,i){if(r&1&&($(0,"span",16),_e(1),ee()),r&2){let e=ne().$implicit;j(),Qe(" ",e.alias," ")}}function tTe(r,i){if(r&1){let e=We();$(0,"mat-option",14),ve("click",function(o){return we(e),xe(o.stopPropagation())}),Pe(1,JEe,3,4,"span",15)(2,eTe,2,1,"span",15),ee()}if(r&2){let e=i.$implicit;z("value",e),j(),z("ngIf",e.translateKey),j(),z("ngIf",!e.translateKey)}}function iTe(r,i){if(r&1){let e=We();$(0,"form",6)(1,"div",7)(2,"mat-form-field")(3,"mat-label"),_e(4),le(5,"translate"),ee(),$(6,"mat-select",8),eo("valueChange",function(o){we(e);let s=ne();return Jn(s.inputProj,o)||(s.inputProj=o),xe(o)}),Pe(7,tTe,3,3,"mat-option",9),le(8,"async"),ee()()(),$(9,"div",10),le(10,"translate"),le(11,"translate"),$(12,"button",11),le(13,"async"),ve("click",function(){we(e);let o=Xt(19);return xe(o.click())}),_e(14),le(15,"translate"),ee(),ct(16,"igo-spinner",12),le(17,"async"),$(18,"input",13,0),ve("click",function(){we(e);let o=Xt(19);return xe(o.value=null)})("change",function(o){we(e);let s=ne();return xe(s.importFiles(o.target.files))}),ee()()()}if(r&2){let e=ne();z("formGroup",e.importForm),j(4),bt(ce(5,10,"igo.geo.importExportForm.importProjPlaceholder")),j(2),Qn("value",e.inputProj),j(),z("ngForOf",ce(8,12,e.projections$)),j(2),z("matTooltip",e.importForm.invalid?ce(10,14,"igo.geo.importExportForm.projections.choose"):ce(11,16,"igo.geo.importExportForm.importButton")),j(3),z("disabled",e.importForm.invalid||ce(13,18,e.loading$)),j(2),Qe(" ",ce(15,20,"igo.geo.importExportForm.importButton")," "),j(2),z("shown",ce(17,22,e.loading$)),j(2),fo("display","none")}}function rTe(r,i){if(r&1&&($(0,"div")(1,"h4"),_e(2),le(3,"translate"),ee(),$(4,"ul")(5,"li"),_e(6),le(7,"translate"),ee(),$(8,"li"),_e(9),le(10,"translate"),ee(),$(11,"li"),_e(12),le(13,"translate"),ee()()()),r&2){let e=ne(2);j(2),bt(ce(3,4,"igo.geo.importExportForm.importClarifications")),j(4),Qe(" ",Ao(7,6,"igo.geo.importExportForm.importSizeMax",fn(13,KEe,e.fileSizeMb))," "),j(3),Qe(" ",ce(10,9,"igo.geo.importExportForm.importFormatAuthorized")," "),j(3),bt(ce(13,11,"igo.geo.importExportForm.importShpZip"))}}function nTe(r,i){if(r&1&&ct(0,"igo-custom-html",18),r&2){let e=ne(2);z("html",e.importHtmlClarifications)}}function oTe(r,i){if(r&1&&($(0,"section"),Pe(1,rTe,14,15,"div",5)(2,nTe,1,1,"igo-custom-html",17),ee()),r&2){let e=ne();j(),z("ngIf",e.importHtmlClarifications===""),j(),z("ngIf",e.importHtmlClarifications!=="")}}function aTe(r,i){r&1&&($(0,"section")(1,"h4"),_e(2),le(3,"translate"),ee()()),r&2&&(j(2),bt(ce(3,1,"igo.geo.importExportForm.exportNoLayersExportable")))}function sTe(r,i){if(r&1&&($(0,"span",27),_e(1),le(2,"translate"),ee()),r&2){let e=ne(2);j(),Nf(" (+",e.layers.length-1," ",ce(2,2,(e.layers==null?null:e.layers.length)===2?"igo.geo.importExportForm.other":"igo.geo.importExportForm.others"),") ")}}function lTe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",30),ve("click",function(o){we(e);let s=ne().$implicit,l=ne(2);return xe(l.onlySelectedClick(o,s.id))})("checked",function(){we(e);let o=ne().$implicit,s=ne(2);return xe(s.inLayersIdToExportSelectionOnly(o))})("change",function(o){we(e);let s=ne().$implicit,l=ne(2);return xe(l.onlySelected(o,s.id))}),$(1,"small"),_e(2),le(3,"translate"),ee()()}r&2&&(j(2),bt(ce(3,1,"igo.geo.importExportForm.exportSelectedFeature")))}function cTe(r,i){if(r&1){let e=We();$(0,"mat-option",28),ve("click",function(o){return we(e),xe(o.stopPropagation())}),$(1,"span",16),_e(2),ee(),$(3,"span",16),Pe(4,lTe,4,3,"mat-slide-toggle",29),ee()()}if(r&2){let e=i.$implicit,n=ne(2);z("ngClass",fn(4,QEe,n.layerHasSelectedFeatures(e)))("value",e.id),j(2),bt(e.title),j(2),z("ngIf",n.layerHasSelectedFeatures(e))}}function uTe(r,i){if(r&1&&($(0,"mat-option",3),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.export.format."+e)," ")}}function dTe(r,i){if(r&1&&(Dr(0),Pe(1,uTe,3,4,"mat-option",31),le(2,"async"),Rr()),r&2){let e=ne(2);j(),z("ngForOf",ce(2,1,e.formats$))}}function hTe(r,i){r&1&&($(0,"mat-option",32),_e(1),le(2,"translate"),ee()),r&2&&(j(),Qe(" ",ce(2,1,"igo.geo.export.noFormat.title")," "))}function pTe(r,i){r&1&&($(0,"div",7)(1,"mat-form-field"),ct(2,"input",33),le(3,"translate"),ee()()),r&2&&(j(2),sr("placeholder",ce(3,1,"igo.geo.importExportForm.exportFileNamePlaceholder")))}function mTe(r,i){if(r&1&&($(0,"mat-option",3),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",ce(2,2,"igo.geo.export.csv.separator."+e)," ")}}function fTe(r,i){r&1&&($(0,"div",37)(1,"mat-slide-toggle",38),_e(2),le(3,"translate"),ee()()),r&2&&(j(),z("labelPosition","before"),j(),Qe(" ",ce(3,2,"igo.geo.importExportForm.exportCombineResults")," "))}function gTe(r,i){r&1&&($(0,"div",39)(1,"mat-slide-toggle",40),_e(2),le(3,"translate"),ee()()),r&2&&(j(),z("labelPosition","before"),j(),Qe(" ",ce(3,2,"igo.geo.importExportForm.exportSeparator")," "))}function _Te(r,i){if(r&1&&(Dr(0),$(1,"div",7)(2,"mat-form-field")(3,"mat-label"),_e(4),le(5,"translate"),ee(),$(6,"mat-select",34),Pe(7,mTe,3,4,"mat-option",31),ee()()(),Pe(8,fTe,4,4,"div",35)(9,gTe,4,4,"div",36),Rr()),r&2){let e=ne(2);j(4),bt(ce(5,4,"igo.geo.export.separator")),j(3),z("ngForOf",e.csvSeparators),j(),z("ngIf",e.layers.length>1),j(),z("ngIf",e.layers.length>1&&e.form.value.combineLayers)}}function yTe(r,i){r&1&&($(0,"div",41)(1,"mat-slide-toggle",42),_e(2),le(3,"translate"),ee()()),r&2&&(j(),z("labelPosition","before"),j(),Qe(" ",ce(3,2,"igo.geo.importExportForm.exportFeatureInExtent")," "))}function vTe(r,i){if(r&1&&ct(0,"igo-custom-html",18),r&2){let e=ne(2);z("html",e.exportHtmlClarifications)}}function bTe(r,i){if(r&1){let e=We();$(0,"form",6)(1,"div",7)(2,"mat-form-field")(3,"mat-label"),_e(4),le(5,"translate"),ee(),$(6,"mat-select",19),eo("valueChange",function(o){we(e);let s=ne();return Jn(s.layers,o)||(s.layers=o),xe(o)}),$(7,"mat-select-trigger"),_e(8),Pe(9,sTe,3,4,"span",20),ee(),Pe(10,cTe,5,6,"mat-option",21),le(11,"async"),ee()()(),$(12,"div",7)(13,"mat-form-field")(14,"mat-label"),_e(15),le(16,"translate"),ee(),$(17,"mat-select",22),Pe(18,dTe,3,3,"ng-container",5),le(19,"async"),Pe(20,hTe,3,3,"mat-option",23),le(21,"async"),ee()()(),Pe(22,pTe,4,3,"div",24)(23,_Te,10,6,"ng-container",5)(24,yTe,4,4,"div",25),$(25,"div",26)(26,"button",11),le(27,"async"),ve("click",function(){we(e);let o=ne();return xe(o.handleExportFormSubmit(o.form.value))}),_e(28),le(29,"translate"),le(30,"translate"),le(31,"translate"),ee(),ct(32,"igo-spinner",12),le(33,"async"),ee(),Pe(34,vTe,1,1,"igo-custom-html",17),ee()}if(r&2){let e=ne();z("formGroup",e.form),j(4),bt(ce(5,16,"igo.geo.importExportForm.exportLayerPlaceholder")),j(2),Qn("value",e.layers),j(2),Qe(" ",e.layers.length?e.getLayerTitleById(e.layers[0]):""," "),j(),z("ngIf",e.layers.length>1),j(),z("ngForOf",ce(11,18,e.exportableLayers$)),j(5),bt(ce(16,20,"igo.geo.importExportForm.exportFormatPlaceholder")),j(3),z("ngIf",ce(19,22,e.formats$).length!==0),j(2),z("ngIf",ce(21,24,e.formats$).length===0),j(2),z("ngIf",e.forceNaming&&e.form.value.format!=="URL"),j(),z("ngIf",e.isCsvExport(e.form.value.format)),j(),z("ngIf",e.form.value.format!=="URL"),j(2),z("disabled",!e.form.valid||ce(27,26,e.loading$)),j(2),Qe(" ",e.form.value.format!=="URL"?ce(29,28,"igo.geo.importExportForm.exportButton"):e.form.value.layers.length>1?ce(30,30,"igo.geo.importExportForm.exportButtonLinks"):ce(31,32,"igo.geo.importExportForm.exportButtonLink")," "),j(4),z("shown",ce(33,34,e.loading$)),j(2),z("ngIf",e.exportHtmlClarifications!=="")}}var wTe=(()=>{class r{importService;exportService;languageService;messageService;styleListService;styleService;formBuilder;config;storageService;downloadService;layerService;confirmDialogService;form;importForm;formats$=new ut(void 0);exportableLayers$=new ut([]);loading$=new ut(!1);forceNaming=!1;controlFormat="format";csvSeparators=Ste;isCsvExport=RC;layers$$;exportableLayers$$;formats$$;formLayer$$;exportOptions$$;importHtmlClarifications;exportHtmlClarifications;espgCodeRegex=new RegExp("^\\d{4,6}");clientSideFileSizeMax;fileSizeMb;projections$=new ut([]);projectionsConstraints;popupChecked=!1;configFormats;previousLayerSpecs$=new ut(void 0);selectFirstProj=!1;map;contextUri;_projectionsLimitations={};set projectionsLimitations(e){this._projectionsLimitations=e,this.computeProjections()}get projectionsLimitations(){return this._projectionsLimitations||{}}store;selectedMode="import";selectMode=new Ke;exportOptions$=new ut(void 0);exportOptionsChange=new Ke;get layers(){return this.form.get("layers").value}set layers(e){this.form.patchValue({layers:e})}get inputProj(){return this.importForm.get("inputProj").value}set inputProj(e){this.importForm.patchValue({inputProj:e})}get popupAllowed(){return this.storageService.get("importExportPopupAllowed")||!1}set popupAllowed(e){this.storageService.set("importExportPopupAllowed",e)}constructor(e,n,o,s,l,h,p,m,f,g,y,_){this.importService=e,this.exportService=n,this.languageService=o,this.messageService=s,this.styleListService=l,this.styleService=h,this.formBuilder=p,this.config=m,this.storageService=f,this.downloadService=g,this.layerService=y,this.confirmDialogService=_,this.loadConfig(),this.buildForm(),this.computeProjections(),this.importHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.importHtmlClarifications"),this.exportHtmlClarifications=this.languageService.translate.instant("igo.geo.importExportForm.exportHtmlClarifications")}ngOnInit(){this.layers$$=this.map.layerController.all$.subscribe(n=>{let o=n.filter(s=>An(s)?!1:s instanceof Fr&&s.exportable===!0||s.dataSource.options.download&&s.dataSource.options.download.url);this.exportableLayers$.next(o)});let e=this.config.getConfig("importExport.clientSideFileSizeMaxMb");this.clientSideFileSizeMax=(e||30)*Math.pow(1024,2),this.fileSizeMb=this.clientSideFileSizeMax/Math.pow(1024,2),this.exportOptions$$=this.exportOptions$.pipe(Ch(n=>!n)).subscribe(n=>{this.form.patchValue(n,{emitEvent:!0}),n.layers&&this.computeFormats(n.layers.map(o=>this.map.layerController.getById(o)))}),this.formLayer$$=this.form.get("format").valueChanges.subscribe(n=>{!this.popupChecked&&this.form.get("layers").value?.length>1&&this.isOgreOrLink(n)&&(this.handlePopup(!0)||this.form.patchValue({format:void 0},{emitEvent:!1}))}),this.formLayer$$=this.form.get("layers").valueChanges.subscribe(n=>{this.handlePreviousLayerSpecs();let o=n instanceof Array?n:[n];this.form.patchValue({layers:o},{emitEvent:!1});let s=o.map(h=>this.map.layerController.getById(h));this.computeFormats(s),this.formats$.value.indexOf(this.form.value.format)===-1&&this.form.patchValue({format:void 0}),this.loading$.next(!0);let l=[];s.forEach(h=>{h instanceof Fr&&h.dataSource.ol.getFeatures().length===0&&(l.push({id:h.id,visible:h.visible,opacity:h.opacity,queryable:h.queryable}),h.opacity=0,h.visible=!0)}),this.previousLayerSpecs$.next(l),setTimeout(()=>{this.loading$.next(!1)},500)}),this.formats$$=this.formats$.pipe(Ch(n=>!n)).subscribe(n=>{n.length===1&&this.form.patchValue({format:n[0]})}),this.exportableLayers$$=this.exportableLayers$.pipe(Ch(n=>!n)).subscribe(n=>{n.length===1&&this.form.patchValue({layers:n[0].id})}),this.selectFirstProj?this.projections$.value.length===0?this.importForm.patchValue({inputProj:{translateKey:"nad83",alias:"NAD83",code:"EPSG:4326",zone:""}}):this.importForm.patchValue({inputProj:this.projections$.value[0]}):this.importForm.patchValue({inputProj:void 0})}computeProjections(){this.projectionsConstraints=sJ(this.projectionsLimitations);let e=[];if(this.projectionsConstraints.nad83&&e.push({translateKey:"nad83",alias:"NAD83",code:"EPSG:4269",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.wgs84&&e.push({translateKey:"wgs84",alias:"WGS84",code:"EPSG:4326",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.webMercator&&e.push({translateKey:"webMercator",alias:"Web Mercator",code:"EPSG:3857",zone:"",extent:void 0,def:void 0}),this.projectionsConstraints.mtm){let o=this.projectionsConstraints.mtmZone.minZone,s=this.projectionsConstraints.mtmZone.maxZone;for(let l=o;l<=s;l++){let h=l<10?`EPSG:3218${l}`:`EPSG:321${80+l}`;e.push({translateKey:"mtm",alias:`MTM ${l}`,code:h,zone:`${l}`,extent:void 0,def:void 0})}}if(this.projectionsConstraints.utm){let o=this.projectionsConstraints.utmZone.minZone,s=this.projectionsConstraints.utmZone.maxZone;for(let l=o;l<=s;l++){let h=l<10?`EPSG:3260${l}`:`EPSG:326${l}`;e.push({translateKey:"utm",alias:`UTM ${l}`,code:h,zone:`${l}`,extent:void 0,def:void 0})}}let n=[];this.projectionsConstraints.projFromConfig&&(n=this.config.getConfig("projections")||[]),this.projections$.next(n.concat(e))}getLayerTitleById(e){return this.map.layerController.getById(e)?.title}layerHasSelectedFeatures(e){let n=this.exportService.getWorkspaceByLayerId(e.id,this.store);if(n)return!!n.entityStore.stateView.firstBy(s=>s.state.selected===!0)}onlySelected(e,n){let o=this.form.value.layersWithSelection;e.checked?o.push(n):o=o.filter(s=>s!==n),this.form.patchValue({layersWithSelection:o})}onlySelectedClick(e,n){this.form.value.layers.find(o=>o===n)&&e.stopPropagation()}inLayersIdToExportSelectionOnly(e){return!!this.form.value.layersWithSelection.find(n=>n===e.id)}ngOnDestroy(){this.layers$$.unsubscribe(),this.exportableLayers$$.unsubscribe(),this.formats$$.unsubscribe(),this.formLayer$$.unsubscribe(),this.exportOptions$$&&this.exportOptions$$.unsubscribe(),this.exportOptionsChange.emit(this.form.value),this.handlePreviousLayerSpecs()}handlePreviousLayerSpecs(){let e=this.previousLayerSpecs$.value;e&&e.length&&e.forEach(n=>{let o=this.map.layerController.getById(n.id);o.visible=n.visible,o.opacity=n.opacity,o.queryable=n.queryable}),this.previousLayerSpecs$.next(void 0)}importFiles(e){let n=this.inputProj.code;this.espgCodeRegex.test(n)&&(n=`EPSG:${n}`),this.loading$.next(!0);for(let o of e)this.importService.import(o,n).subscribe(s=>this.onFileImportSuccess(o,s),s=>this.onFileImportError(o,s),()=>{this.loading$.next(!1)})}handlePopup(e=!0){window.open("","popup","width=1, height=1").close();let o=window.open("","popup","width=1, height=1");return!o||o.closed||typeof o.closed>"u"||o===null?(this.onPopupBlockedError(e),this.popupAllowed=!1):(o.close(),this.popupAllowed=!0,this.popupChecked=!0),this.popupAllowed}isOgreOrLink(e){return Object.keys(S3.ogreFormats).indexOf(e)>=0||e==="URL"}handleExportFormSubmit(e){return un(this,null,function*(){this.loading$.next(!0),!this.popupChecked&&e.layers.length>1&&this.isOgreOrLink(e.format)&&!this.popupAllowed&&this.handlePopup();let n=RC(e.format);if(e.format==="Excel")try{return yield this.exportService.exportExcel(this.map,this.store,e),this.loading$.next(!1),this.onFileExportSuccess()}catch(s){throw this.onFileExportError(s),s}let o="";for(let s of e.layers){this.loading$.next(!0);let l=this.map.layerController.getById(s);if(An(l))continue;let h=yield dx(this.exportService.getFeatures(this.map,l,e,this.store)).catch(m=>{throw this.onFileExportError(m),m}),p=this.exportService.getGeomTypes(h,e.format);!n||!e.combineLayers||e.layers.length===1?(o=l.title,e.name&&(o=e.name)):o=this.languageService.translate.instant("igo.geo.export.combinedLayers"),e.format==="URL"&&jn(l)&&this.handleUrlExport(l),e.format==="GPX"&&this.validateGpxExport(p),p.length===0&&(this.loading$.next(!1),this.messageService.error("igo.geo.export.nothing.text","igo.geo.export.nothing.title",{timeOut:2e4})),(!n||!e.combineLayers)&&p.forEach(m=>{m.type&&(o+=m.type),this.handleExport(m.features,e,o)}),this.loading$.next(!1)}n&&this.handleCsvExport(e,o)})}handleUrlExport(e){let{download:n=null}=e.dataSource.options;if(n?.url||n?.dynamicUrl){setTimeout(()=>{let o=n.url??n.dynamicUrl;o.match(/service=wfs/gi)?this.downloadService.open(e):window.open(o,"_blank"),this.loading$.next(!1)},500);return}}validateGpxExport(e){let n=e.length;e=e.filter(s=>["LineString","Point"].includes(s.type));let o=e.length;n>o&&this.messageService.error("igo.geo.export.gpx.error.poly.text","igo.geo.export.gpx.error.poly.title",{timeOut:2e4})}handleCsvExport(e,n){return un(this,null,function*(){let o=[];if(e.combineLayers){let s;(yield this.getAllLayerGeomTypes(e)).forEach(h=>{h.features.forEach(p=>{if(e.separator)if(s){if(p.get("_featureStore").layer.options.title!==s.get("_featureStore").layer.options.title){let m=this.createTitleEmptyRows(s,p);o.push(m[2]),o.push(m[0]),o.push(m[1])}}else{let m=this.createTitleEmptyRows(p,p);o.push(m[0])}o.push(p),s=p})})}this.handleExport(o,e,n)})}handleExport(e,n,o){this.exportService.export(e,n,o,this.map.projectionCode).subscribe({error:s=>this.onFileExportError(s),complete:()=>{this.onFileExportSuccess(),e.forEach(s=>{this.circleToPoint(s)}),this.loading$.next(!1)}})}getAllLayerGeomTypes(e){return un(this,null,function*(){return e.layers.reduce((n,o)=>un(this,null,function*(){let s=yield n,l=this.map.layerController.getById(o);if(An(l))return n;let h=yield dx(this.exportService.getFeatures(this.map,l,e,this.store)).catch(m=>{throw this.onFileExportError(m),m}),p=this.exportService.getGeomTypes(h,e.format);return s.concat(p)}),Promise.resolve([]))})}createTitleEmptyRows(e,n){let o=n.clone(),s=n.clone(),l=n.clone(),h=e.getKeys(),p="";for(let w in h)if(h[w]!=="geometry"){p=h[w];break}let m=n.getKeys(),f="";for(let w in m)if(m[w]!=="geometry"){f=m[w];break}let g=n.getKeys();h.forEach(w=>{g.includes(w)&&w!==p&&g.push(w)}),g.unshift(p);let y="";for(let w in g)if(g[w]!=="geometry"){y=g[w];break}return g.forEach(w=>{let A=h.length===m.length&&h.every((k,R)=>k===m[R]);w===y&&!A?(o.set(w,n.get("_featureStore").layer.options.title+" ===============>",!0),s.set(w,w,!0),l.unset(w,!0)):w===y&&A||w===f?(o.set(w,n.get("_featureStore").layer.options.title,!0),s.set(w,w,!0),l.unset(w,!0)):w!=="geometry"?(o.unset(w,!0),s.set(w,w,!0),l.unset(w,!0)):(o.unset(w,!0),l.unset(w,!0)),m.includes(w)||s.unset(w,!0)}),[o,s,l]}circleToPoint(e){if(e.get("rad")){let o=new Ii([e.get("longitude"),e.get("latitude")]);o.transform("EPSG:4326",e.get("_projection")),e.setGeometry(o)}}buildForm(){this.importForm=this.formBuilder.group({inputProj:["",[Fn.required]]});let e=this.formBuilder.group({format:["",[Fn.required]],layers:[[],[Fn.required]],layersWithSelection:[[]],combineLayers:[!0,[Fn.required]],separator:[!1,[Fn.required]],featureInMapExtent:[!1,[Fn.required]]});this.forceNaming&&e.addControl("name",new xx("",[Fn.required])),e.get("format").valueChanges.subscribe(n=>this.handleCsvForm(e,n)),this.form=e}handleCsvForm(e,n){n==="CSV"?e.addControl("csvSeparator",new xx("auto",[Fn.required])):e.removeControl("csvSeparator")}onFileImportSuccess(e,n){let o=this.config.getConfig("importExport"),s=o?.allowToStoreLayer?this.confirmDialogService:void 0;o?.importWithStyle?T3(e,n,this.map,this.contextUri,this.messageService,this.layerService,s,this.styleListService,this.styleService):T3(e,n,this.map,this.contextUri,this.messageService,this.layerService,s)}onFileImportError(e,n){this.loading$.next(!1),iB(e,n,this.messageService,this.fileSizeMb)}onPopupBlockedError(e=!0){this.loading$.next(!1);let n=e?"igo.geo.export.popupBlocked.selectAgain":"igo.geo.export.popupBlocked.retry";this.messageService.error("igo.geo.export.popupBlocked.text","igo.geo.export.popupBlocked.title",{timeOut:2e4},{extraMessage:n})}onFileExportError(e){this.loading$.next(!1),bte(e,this.messageService)}loadConfig(){let e=this.config.getConfig("importExport.forceNaming");this.forceNaming=e!==void 0?e:!1,this.configFormats=this.config.getConfig("importExport.formats"),this.computeFormats()}computeFormats(e){let n=[...tB],o={onlyUrl:!1,onlyVector:!1,vectorAndUrl:!1,customList:!1},s=[];if(e?.length){e.forEach(h=>{!h||An(h)||(h.dataSource.options.download?.allowedFormats?(o.customList=!0,s.push({layer:h.title,formats:this.validateListFormat(h.dataSource.options.download.allowedFormats)})):!(h instanceof Fr)&&h.dataSource.options.download&&h.dataSource.options.download.url?o.onlyUrl=!0:h.dataSource.options.download&&(h.dataSource.options.download.url||h.dataSource.options.download.dynamicUrl)?o.vectorAndUrl=!0:h instanceof Fr&&(o.onlyVector=!0))});let l=this.formats$.value.includes("URL");if(o.onlyUrl===!0&&o.onlyVector===!1)n=["URL"];else if(o.onlyVector===!0&&o.onlyUrl===!1)this.computeFormats(),l&&(n=[...this.formats$.value].filter(h=>h!=="URL"));else if(o.vectorAndUrl===!0&&o.onlyUrl===!1&&o.onlyVector===!1&&(this.computeFormats(),!l)){let h=[...this.formats$.value];h.push("URL"),n=h}}if(n=this.getAvailableFormats(n),o.customList){let l,h=[],p=s[0].formats;s.map(f=>{h.push(f.layer),l=f.formats.filter(g=>p.includes(g)),p=f.formats});let m=l.filter(f=>n.includes(f));m.length>0?(this.formats$.next(m),e&&e.length&&e.length>1&&this.messageService.alert("igo.geo.export.customList.text","igo.geo.export.customList.title",void 0,{value:h.join()})):(this.formats$.next([]),this.messageService.alert("igo.geo.export.noFormat.text","igo.geo.export.noFormat.title"));return}else this.formats$.next(n)}getAvailableFormats(e){if(!this.configFormats)return e;let n=this.validateListFormat(this.configFormats);return e.filter(o=>n.includes(o))}validateListFormat(e){let n=[...tB,...xte].map(o=>o.toUpperCase());return e.filter(o=>{if(n.includes(o.toUpperCase()))return o}).map(o=>{if(["CSV","CSVcomma","CSVsemicolon"].map(l=>l.toUpperCase()).includes(o.toUpperCase()))return"CSV";if(this.compareString("Excel",o))return"Excel";if(this.compareString("GML",o))return"GML";if(this.compareString("GPX",o))return"GPX";if(this.compareString("GeoJSON",o))return"GeoJSON";if(this.compareString("KML",o))return"KML";if(this.compareString("Shapefile",o))return"Shapefile";if(this.compareString("URL",o))return"URL"})}compareString(e,n){return e.toUpperCase()===n.toUpperCase()}modeChanged(e){this.selectMode.emit(e)}onFileExportSuccess(){wte(this.messageService)}onImportExportChange(e){this.selectedMode=e.value}static \u0275fac=function(n){return new(n||r)(Ie(nB),Ie(S3),Ie(Di),Ie(Gn),Ie(b3),Ie(Nc),Ie($c),Ie(Oi),Ie(Kr),Ie(QT),Ie(Za),Ie(Ix))};static \u0275cmp=nt({type:r,selectors:[["igo-import-export"]],inputs:{selectFirstProj:"selectFirstProj",map:"map",contextUri:"contextUri",projectionsLimitations:"projectionsLimitations",store:"store",selectedMode:"selectedMode",exportOptions$:"exportOptions$"},outputs:{selectMode:"selectMode",exportOptionsChange:"exportOptionsChange"},standalone:!0,features:[Xi([Ix]),lt],decls:14,vars:17,consts:[["fileInput",""],[1,"import-export-toggle"],[3,"change","value"],[3,"value"],["class","igo-form",3,"formGroup",4,"ngIf"],[4,"ngIf"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],[3,"valueChange","value"],[3,"value","click",4,"ngFor","ngForOf"],["tooltip-position","below","matTooltipShowDelay","500",1,"igo-form-button-group",3,"matTooltip"],["mat-raised-button","","type","button",3,"click","disabled"],[3,"shown"],["hidden","","type","file",3,"click","change"],[3,"click","value"],["matListItemTitle","",4,"ngIf"],["matListItemTitle",""],[3,"html",4,"ngIf"],[3,"html"],["multiple","",3,"valueChange","value"],["class","export-select-trigger",4,"ngIf"],[3,"ngClass","value","click",4,"ngFor","ngForOf"],["formControlName","format"],["disabled","true",4,"ngIf"],["class","igo-input-container",4,"ngIf"],["class","export-options",4,"ngIf"],[1,"igo-form-button-group"],[1,"export-select-trigger"],[3,"click","ngClass","value"],[3,"click","checked","change",4,"ngIf"],[3,"click","checked","change"],[3,"value",4,"ngFor","ngForOf"],["disabled","true"],["matInput","","formControlName","name",3,"placeholder"],["formControlName","csvSeparator"],["class","export-combine-layers",4,"ngIf"],["class","export-separator",4,"ngIf"],[1,"export-combine-layers"],["formControlName","combineLayers",3,"labelPosition"],[1,"export-separator"],["formControlName","separator",3,"labelPosition"],[1,"export-options"],["formControlName","featureInMapExtent",3,"labelPosition"]],template:function(n,o){n&1&&($(0,"div",1)(1,"mat-button-toggle-group",2),ve("change",function(l){return o.onImportExportChange(l)}),$(2,"mat-button-toggle",3),_e(3),le(4,"translate"),ee(),$(5,"mat-button-toggle",3),_e(6),le(7,"translate"),ee()()(),Pe(8,iTe,20,24,"form",4)(9,oTe,3,2,"section",5)(10,aTe,4,3,"section",5),le(11,"async"),Pe(12,bTe,35,36,"form",4),le(13,"async")),n&2&&(j(),z("value",o.selectedMode),j(),z("value","import"),j(),Qe(" ",ce(4,9,"igo.geo.importExportForm.importTabTitle")," "),j(2),z("value","export"),j(),Qe(" ",ce(7,11,"igo.geo.importExportForm.exportTabTitle")," "),j(2),z("ngIf",o.selectedMode==="import"),j(),z("ngIf",o.selectedMode==="import"),j(),z("ngIf",ce(11,13,o.exportableLayers$).length===0&&o.selectedMode==="export"),j(2),z("ngIf",ce(13,15,o.exportableLayers$).length>0&&o.selectedMode==="export"))},dependencies:[Ed,Gu,mu,Gt,Sn,Xu,os,kn,Zu,Sa,Ku,Qu,jr,Gr,Mo,ho,uo,UA,Nn,Li,Bn,Qt,ti,Vt,co,v3,e9,_a,bl,js,gn,Cn,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   mat-option.igo-export-layer-mat-option[_ngcontent-%COMP%]{height:5em;line-height:1em}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .import-export-toggle[_ngcontent-%COMP%]   mat-button-toggle-group[_ngcontent-%COMP%]   mat-button-toggle[_ngcontent-%COMP%]{width:50%}[_nghost-%COMP%]   h4[_ngcontent-%COMP%]{padding:0 5px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:15px 5px}[_nghost-%COMP%]   .igo-input-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center;padding-top:10px}[_nghost-%COMP%]   igo-spinner[_ngcontent-%COMP%]{position:absolute;padding-left:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%], [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:10px}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .export-options[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-combine-layers[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label, [_nghost-%COMP%]   .export-separator[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .export-select-trigger[_ngcontent-%COMP%]{opacity:.75;font-size:.75em}
/*# sourceMappingURL=import-export.component-NMVSF5EE.css.map */`]})}return r})();var Ate=(()=>{class r{open(e){e.extern&&window.open(e.url,"_blank")}static \u0275fac=function(n){return new(n||r)};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function STe(r,i){if(r&1){let e=We();$(0,"button",1),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.openMetadata(o.options.metadata))}),$(2,"mat-icon"),_e(3,"info"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.metadata.show"))("color",e.color)}}function CTe(r,i){if(r&1&&($(0,"mat-dialog-content",3)(1,"h3"),_e(2),ee()()),r&2){let e=ne();j(2),bt(e.data.abstract)}}function ATe(r,i){if(r&1&&($(0,"mat-dialog-content",3),ct(1,"h3",4),ee()),r&2){let e=ne();j(),z("innerHTML",e.data.abstract,hm)}}var aB=(()=>{class r{metadataService;dialog;layer;color="primary";constructor(e,n){this.metadataService=e,this.dialog=n}openMetadata(e){e.extern?!e.url&&e.abstract?this.dialog.open(oB,{data:{layerTitle:this.layer.title,abstract:e.abstract,type:e.type}}):e.url&&this.metadataService.open(e):!e.extern&&e.abstract&&this.dialog.open(oB,{data:{layerTitle:this.layer.title,abstract:e.abstract,type:e.type}})}get options(){if(this.layer)return this.layer.options}static \u0275fac=function(n){return new(n||r)(Ie(Ate),Ie(Yc))};static \u0275cmp=nt({type:r,selectors:[["igo-metadata-button"]],inputs:{layer:"layer",color:"color"},standalone:!0,features:[lt],decls:1,vars:1,consts:[["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","color"]],template:function(n,o){n&1&&Pe(0,STe,4,4,"button",0),n&2&&z("ngIf",o.options&&o.options.metadata&&o.options.metadata.url||o.options&&o.options.metadata&&o.options.metadata.abstract)},dependencies:[Gt,Vt,ci,Qt,ti,jt,$t,Et,Tt,V1],changeDetection:0})}return r})(),oB=(()=>{class r{data;constructor(e){this.data=e}static \u0275fac=function(n){return new(n||r)(Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-metadata-abstract"]],standalone:!0,features:[lt],decls:6,vars:3,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",1,"close-button"],["class","mat-typography",4,"ngIf"],[1,"mat-typography"],[3,"innerHTML"]],template:function(n,o){n&1&&($(0,"h2",0),_e(1),ee(),$(2,"button",1),_e(3,"X"),ee(),Pe(4,CTe,3,1,"mat-dialog-content",2)(5,ATe,2,1,"mat-dialog-content",2)),n&2&&(j(),bt(o.data.layerTitle),j(3),z("ngIf",o.data.type!=="arcgisrest"),j(),z("ngIf",o.data.type==="arcgisrest"))},dependencies:[id,Vt,co,WA,Gt,pl],styles:[`:host{position:relative;display:block}.close-button{top:5px;right:5px;padding:7px;line-height:10px;position:absolute!important;min-width:auto}
/*# sourceMappingURL=metadata-abstract.component-WPB7KOO3.css.map */
`],encapsulation:2})}return r})();var sB=(()=>{class r extends So{static id="map";static type=vr;constructor(e){super(e)}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"Carte"}}static \u0275fac=function(n){return new(n||r)(pt("options"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function MTe(r){return new sB(r.getConfig(`searchSources.${sB.id}`)||{})}function Mte(){return{provide:So,useFactory:MTe,multi:!0,deps:[Oi]}}var zzt=(()=>{class r{component;queryService;queries$$=[];mapClickListener;olDragSelectInteraction;olDragSelectInteractionEndKey;queryFeatures=!1;queryFeaturesHitTolerance=0;queryFeaturesCondition;waitForAllQueries=!0;query=new Ke;get map(){return this.component.map}constructor(e,n){this.component=e,this.queryService=n}ngAfterViewInit(){this.listenToMapClick(),this.addDragBoxInteraction()}ngOnDestroy(){this.cancelOngoingQueries(),this.unlistenToMapClick(),this.removeDragBoxInteraction()}listenToMapClick(){this.mapClickListener=this.map.ol.on("singleclick",e=>this.onMapEvent(e))}unlistenToMapClick(){io(this.mapClickListener),this.mapClickListener=void 0}onMapEvent(e){if(this.cancelOngoingQueries(),!this.queryService.queryEnabled)return;let n=[];this.queryFeatures&&n.push(this.doQueryFeatures(e));let o=this.map.ol.getView().getResolution(),s=this.map.layerController.all.filter(Xb);n.push(...this.queryService.query(s,{coordinates:e.coordinate,projection:this.map.projection,resolution:o})),n.length!==0&&(this.waitForAllQueries?this.queries$$.push(Sh(...n).subscribe(l=>{let h=[].concat(...l);this.query.emit({features:h,event:e})})):this.queries$$=n.map(l=>l.subscribe(h=>{this.query.emit({features:h,event:e})})))}doQueryFeatures(e){let n=[];if(e.type==="singleclick")this.map.ol.forEachFeatureAtPixel(e.pixel,(o,s)=>{let l=this.map.layerController.getById(s.values_._layer.id);if(!(An(l)||!l.displayed)&&!l.dataSource.options.queryFormatAsWms&&o)if(o.get("features"))for(let h of o.get("features")){let p=Sb(h,this.map.projection);p.meta={title:h.values_.nom,id:s.values_._layer.id+"."+h.id_,icon:h.values_._icon,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(l)},n.push(p)}else if(o instanceof il){let h=Uq(o,this.map.projection,s);h.meta={id:s.values_._layer.id+"."+h.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(l),title:this.queryService.getQueryTitle(h,l)||h.meta.title},n.push(h)}else{let h=Sb(o,this.map.projection,s);h.meta={id:s.values_._layer.id+"."+h.meta.id,sourceTitle:s.values_.title,alias:this.queryService.getAllowedFieldsAndAlias(l),title:this.queryService.getQueryTitle(h,l)||h.meta.title},n.push(h)}},{hitTolerance:this.queryFeaturesHitTolerance||0,layerFilter:this.queryFeaturesCondition?this.queryFeaturesCondition:fK});else if(e.type==="boxend"){let s=e.target.getGeometry().getExtent();this.map.layerController.all.filter(Xb).filter(l=>jn(l)&&l instanceof Fr&&l.visible).map(l=>{l.dataSource.ol.forEachFeatureIntersectingExtent(s,p=>{let m=Sb(p,this.map.projection,l.ol);m.meta={id:l.id+"."+p.getId(),icon:p.values_._icon,sourceTitle:l.title,alias:this.queryService.getAllowedFieldsAndAlias(l),title:this.queryService.getQueryTitle(m,l)||m.meta.title},n.push(m)})})}return ai(n)}cancelOngoingQueries(){this.queries$$.forEach(e=>e.unsubscribe()),this.queries$$=[]}addDragBoxInteraction(){let e,n=this.map.ol.getInteractions().getArray();for(let o of n)if(o instanceof Gy){e=o;break}e===void 0&&(e=new Gy({condition:K1}),this.map.ol.addInteraction(e),this.olDragSelectInteraction=e),this.olDragSelectInteractionEndKey=e.on("boxend",o=>this.onMapEvent(o))}removeDragBoxInteraction(){this.olDragSelectInteractionEndKey!==void 0&&io(this.olDragSelectInteractionEndKey),this.olDragSelectInteraction!==void 0&&this.map.ol.removeInteraction(this.olDragSelectInteraction),this.olDragSelectInteraction=void 0}static \u0275fac=function(n){return new(n||r)(Ie(sh,2),Ie(gw))};static \u0275dir=Fi({type:r,selectors:[["","igoQuery",""]],inputs:{queryFeatures:"queryFeatures",queryFeaturesHitTolerance:"queryFeaturesHitTolerance",queryFeaturesCondition:"queryFeaturesCondition",waitForAllQueries:"waitForAllQueries"},outputs:{query:"query"},standalone:!0})}return r})();var ITe=(()=>{class r{static forRoot(){return{ngModule:r,providers:[Mte()]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({providers:[gw],imports:[Wu,IG]})}return r})();var P3=[vr,b_];function ETe(r,i){if(r&1&&($(0,"mat-radio-button",6),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit,n=ne();z("value",e),j(),Qe(" ",ce(2,2,n.getSearchTypeTitle(e))," ")}}var Tw=(()=>{class r{searchSourceService;searchType$=new ut(void 0);searchType$$;searchTypes=P3;set searchType(e){this.setSearchType(e)}get searchType(){return this.searchType$.value}searchTypeChange=new Ke;constructor(e){this.searchSourceService=e}ngOnInit(){this.searchType$$=this.searchType$.pipe($u()).subscribe(e=>this.onSetSearchType(e))}ngOnDestroy(){this.searchType$$.unsubscribe()}onSearchTypeChange(e){this.setSearchType(e)}getSearchTypeTitle(e){return`igo.geo.search.${e.toLowerCase()}.title`}setSearchType(e){this.searchType$.next(e)}onSetSearchType(e){e!=null&&(this.searchSourceService.enableSourcesByType(e),this.searchTypeChange.emit(e))}static \u0275fac=function(n){return new(n||r)(Ie(Bu))};static \u0275cmp=nt({type:r,selectors:[["igo-search-selector"]],inputs:{searchTypes:"searchTypes",searchType:"searchType"},outputs:{searchTypeChange:"searchTypeChange"},standalone:!0,features:[lt],decls:10,vars:8,consts:[["searchSelectorMenu","matMenu"],[1,"igo-search-selector"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-selector-button",3,"matTooltip","matMenuTriggerFor"],["xPosition","before","yPosition","above",1,"no-border-radius"],[1,"igo-search-selector-radio-group",3,"change","value"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,o){if(n&1){let s=We();$(0,"div",1)(1,"button",2),le(2,"translate"),$(3,"mat-icon"),_e(4,"arrow_drop_down"),ee()(),$(5,"mat-menu",3,0)(7,"mat-radio-group",4),le(8,"async"),ve("change",function(h){return we(s),xe(o.onSearchTypeChange(h.value))}),Pe(9,ETe,3,4,"mat-radio-button",5),ee()()()}if(n&2){let s=Xt(6);j(),z("matTooltip",ce(2,4,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",s),j(6),z("value",ce(8,6,o.searchType$)),j(2),z("ngForOf",o.searchTypes)}},dependencies:[Vt,ci,Qt,ti,ym,G1,j1,jt,$t,wm,vm,bm,Li,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]{border-radius:0}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], [_nghost-%COMP%]   .igo-search-selector-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]{display:inline-flex;flex-direction:column}[_nghost-%COMP%]   .igo-search-selector-radio-group[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{margin:5px}
/*# sourceMappingURL=search-selector.component-Y5IK753H.css.map */`],changeDetection:0})}return r})();function TTe(r,i){if(r&1){let e=We();$(0,"div",12)(1,"button",13),ve("click",function(o){we(e);let s=ne();return xe(s.checkUncheckAllSources(o))}),_e(2),le(3,"translate"),le(4,"translate"),ee()()}if(r&2){let e=ne();j(2),Qe(" ",e.searchSourcesAllEnabled?ce(4,3,"igo.geo.search.searchSources.selectAll"):ce(3,1,"igo.geo.search.searchSources.unselectAll")," ")}}function FTe(r,i){if(r&1&&($(0,"button",18),_e(1),ee()),r&2){let e=ne().$implicit,n=Xt(6);z("matMenuTriggerFor",n),j(),Qe(" ",e.title," ")}}function PTe(r,i){if(r&1&&($(0,"button",9),_e(1),ee()),r&2){let e=ne().$implicit;j(),Qe(" ",e.title," ")}}function LTe(r,i){if(r&1){let e=We();$(0,"mat-radio-button",23),ve("click",function(o){return we(e),xe(o.stopPropagation())})("change",function(o){let s=we(e).$implicit,l=ne(2).$implicit,h=ne().$implicit,p=ne();return xe(p.settingsValueCheckedRadioButton(o,h,l,s))}),_e(1),le(2,"translate"),ee()}if(r&2){let e=i.$implicit,n=ne(4);z("value",e)("matTooltip",n.getAvailableHashtagsValues(e))("checked",e.enabled),j(),Qe(" ",ce(2,4,e.title)," ")}}function kTe(r,i){if(r&1&&($(0,"span")(1,"mat-radio-group",21),Pe(2,LTe,3,6,"mat-radio-button",22),ee()()),r&2){let e=ne().$implicit;j(),z("value",e),j(),z("ngForOf",e.values)}}function OTe(r,i){if(r&1){let e=We();$(0,"div",12)(1,"button",13),ve("click",function(o){we(e);let s=ne(2).$implicit,l=ne().$implicit,h=ne();return xe(h.checkUncheckAll(o,l,s))}),_e(2),le(3,"translate"),le(4,"translate"),ee()()}if(r&2){let e=ne(2).$implicit;j(2),Qe(" ",e.allEnabled||e.allEnabled===void 0?ce(3,1,"igo.geo.search.searchSources.settings.unselectAll"):ce(4,3,"igo.geo.search.searchSources.settings.selectAll")," ")}}function DTe(r,i){if(r&1){let e=We();$(0,"div",25)(1,"mat-checkbox",26),ve("click",function(o){return we(e),xe(o.stopPropagation())})("change",function(o){let s=we(e).$implicit,l=ne(2).$implicit,h=ne().$implicit,p=ne();return xe(p.settingsValueCheckedCheckbox(o,h,l,s))}),_e(2),le(3,"translate"),ee()()}if(r&2){let e=i.$implicit,n=ne(2).$implicit,o=ne(2);j(),fo("display",o.displayBlock),z("checked",e.enabled)("value",n)("matTooltip",o.getAvailableHashtagsValues(e)),j(),Qe(" ",ce(3,6,e.title)," ")}}function RTe(r,i){if(r&1&&($(0,"span"),Pe(1,OTe,5,5,"div",6)(2,DTe,4,8,"div",24),ee()),r&2){let e=ne().$implicit,n=ne(2);j(),z("ngIf",e.values.length>3),j(),z("ngForOf",n.getAvailableValues(e))}}function NTe(r,i){if(r&1&&(Dr(0),$(1,"button",18),_e(2),le(3,"translate"),ee(),$(4,"mat-menu",19,2),Pe(6,kTe,3,2,"span",20)(7,RTe,3,2,"span",20),ee(),Rr()),r&2){let e=i.$implicit,n=Xt(5);j(),z("matMenuTriggerFor",n),j(),Qe(" ",ce(3,5,"igo.geo.search.searchSources.settings."+e.title)," "),j(2),z("ngSwitch",e.type),j(2),z("ngSwitchCase","radiobutton"),j(),z("ngSwitchCase","checkbox")}}function BTe(r,i){if(r&1){let e=We();Dr(0),$(1,"span",14)(2,"mat-checkbox",15),ve("click",function(o){return we(e),xe(o.stopPropagation())})("change",function(o){let s=we(e).$implicit,l=ne();return xe(l.onCheckSearchSource(o,s))}),ee(),Pe(3,FTe,2,2,"button",16)(4,PTe,2,1,"button",17),ee(),$(5,"mat-menu",null,1),Pe(7,NTe,8,7,"ng-container",7),ee(),Rr()}if(r&2){let e=i.$implicit;j(2),z("checked",e.enabled)("value",e),j(),z("ngIf",e.settings.length>0),j(),z("ngIf",e.settings.length===0),j(3),z("ngForOf",e.settings)}}function GTe(r,i){if(r&1){let e=We();$(0,"mat-slide-toggle",11),le(1,"translate"),ve("change",function(o){we(e);let s=ne();return xe(s.changePointerReverseSearch(o))})("click",function(o){return we(e),xe(o.stopPropagation())}),_e(2),le(3,"translate"),ee()}if(r&2){let e=ne();z("matTooltip",ce(1,3,"igo.geo.search.pointerSearchSummary.tooltip"))("checked",e.pointerSummaryEnabled),j(2),Qe(" ",ce(3,5,"igo.geo.search.pointerSearchSummary.title")," ")}}var Fw=(()=>{class r{searchSourceService;mediaService;storageService;hasPointerReverseSearchSource=!1;searchSourcesAllEnabled=!1;buffer=[];lastKeyTime=Date.now();displayBlock="block";get isTouchScreen(){return this.mediaService.isTouchScreen()}pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;reverseSearchCoordsFormatEnabled=!1;searchSourceChange=new Ke;pointerSummaryStatus=new Ke;searchResultsGeometryStatus=new Ke;reverseSearchCoordsFormatStatus=new Ke;handleKeyboardEvent(e){e.key==="F2"&&(this.pointerSummaryEnabled=!this.pointerSummaryEnabled,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled))}constructor(e,n,o){this.searchSourceService=e,this.mediaService=n,this.storageService=o}ngOnInit(){this.hasPointerReverseSearchSource=this.hasReverseSearchSourcesForPointerSummary()}getSearchSources(){let e=this.searchSourceService.getSources().filter(ZT).filter(s=>s.available&&s.getId()!=="map"&&s.showInSettings),n=this.searchSourceService.getSources().filter(XT).filter(s=>s.available&&s.getId()!=="map"&&s.showInSettings),o=e.concat(n);return this.computeSourcesCheckAllBehavior(o),o}hasReverseSearchSourcesForPointerSummary(){return!!this.searchSourceService.getEnabledSources().filter(_w).length}settingsValueCheckedCheckbox(e,n,o,s){s.enabled=e.checked,n.setParamFromSetting(o),this.searchSourceChange.emit(n)}computeSettingCheckAllBehavior(e){e.allEnabled===void 0?e.values.find(n=>n.enabled)?e.allEnabled=!1:e.allEnabled=!0:e.allEnabled=!e.allEnabled}computeSourcesCheckAllBehavior(e){let n=e.filter(s=>s.enabled).length,o=e.filter(s=>!s.enabled).length;this.searchSourcesAllEnabled=!(n>=o)}checkUncheckAll(e,n,o){e.stopPropagation(),this.computeSettingCheckAllBehavior(o),o.values.forEach(s=>{s.enabled=o.allEnabled}),n.setParamFromSetting(o),this.searchSourceChange.emit(n)}checkUncheckAllSources(e){e.stopPropagation(),this.getSearchSources().map(n=>{n.enabled=this.searchSourcesAllEnabled,this.searchSourceChange.emit(n)})}settingsValueCheckedRadioButton(e,n,o,s){o.values.forEach(l=>{l.value!==s.value?l.enabled=!e.source.checked:l.enabled=e.source.checked}),n.setParamFromSetting(o),this.searchSourceChange.emit(n)}onCheckSearchSource(e,n){n.enabled=e.checked;let o=this.storageService.get(n.getId()+".options")||{};o.enabled=n.enabled,this.storageService.set(n.getId()+".options",o),this.searchSourceChange.emit(n)}getAvailableValues(e){return e.values.filter(n=>n.available!==!1)}getAvailableHashtagsValues(e){if(e.hashtags)return e.hashtags.map(n=>"#"+n).join(", ")}stopPropagation(e){e.stopPropagation()}changePointerReverseSearch(e){this.pointerSummaryEnabled=e.checked,this.pointerSummaryStatus.emit(this.pointerSummaryEnabled)}changeSearchResultsGeometry(e){this.searchResultsGeometryEnabled=e.checked,this.searchResultsGeometryStatus.emit(this.searchResultsGeometryEnabled)}reverseSearchCoordsFormat(e){this.reverseSearchCoordsFormatEnabled=e.checked,this.reverseSearchCoordsFormatStatus.emit(this.reverseSearchCoordsFormatEnabled)}static \u0275fac=function(n){return new(n||r)(Ie(Bu),Ie(Wc),Ie(Kr))};static \u0275cmp=nt({type:r,selectors:[["igo-search-settings"]],hostBindings:function(n,o){n&1&&ve("keydown",function(l){return o.handleKeyboardEvent(l)},!1,X_)},inputs:{pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled"},outputs:{searchSourceChange:"searchSourceChange",pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus"},standalone:!0,features:[lt],decls:24,vars:23,consts:[["searchSettingsMenu","matMenu"],["sub_menu","matMenu"],["test_sub_menu","matMenu"],[1,"igo-search-settings"],["mat-icon-button","","color","primary","tooltip-position","below","matTooltipShowDelay","500",1,"igo-search-settings-button",3,"matTooltip","matMenuTriggerFor"],[1,"no-border-radius"],["class","checkAllButton",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"pointer-summary-slide-toggle-container"],["mat-menu-item",""],["class","search-option","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","checked","change","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500",1,"search-option",3,"change","click","matTooltip","checked"],[1,"checkAllButton"],["mat-raised-button","",3,"click"],[1,"igo-search-settings-search-source"],[1,"igo-search-settings-checkbox",3,"click","change","checked","value"],["mat-menu-item","",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",4,"ngIf"],["mat-menu-item","",3,"matMenuTriggerFor"],["yPosition","above",3,"ngSwitch"],[4,"ngSwitchCase"],[1,"igo-search-settings-radio-group",3,"value"],["class","mat-typography",3,"value","matTooltip","checked","click","change",4,"ngFor","ngForOf"],[1,"mat-typography",3,"click","change","value","matTooltip","checked"],["class","igo-search-settings-sub-menu","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","",1,"igo-search-settings-sub-menu"],[3,"click","change","checked","value","matTooltip"]],template:function(n,o){if(n&1){let s=We();$(0,"div",3)(1,"button",4),le(2,"translate"),$(3,"mat-icon"),_e(4,"expand_more"),ee()(),$(5,"mat-menu",5,0),Pe(7,TTe,5,5,"div",6)(8,BTe,8,5,"ng-container",7),ct(9,"mat-divider"),$(10,"span",8)(11,"div",9),Pe(12,GTe,4,7,"mat-slide-toggle",10),ee(),$(13,"div",9)(14,"mat-slide-toggle",11),le(15,"translate"),ve("change",function(h){return we(s),xe(o.changeSearchResultsGeometry(h))})("click",function(h){return we(s),xe(h.stopPropagation())}),_e(16),le(17,"translate"),ee()(),$(18,"div",9)(19,"mat-slide-toggle",11),le(20,"translate"),le(21,"translate"),ve("change",function(h){return we(s),xe(o.reverseSearchCoordsFormat(h))})("click",function(h){return we(s),xe(h.stopPropagation())}),_e(22),le(23,"translate"),ee()()()()()}if(n&2){let s=Xt(6);j(),z("matTooltip",ce(2,11,"igo.geo.search.menu.tooltip"))("matMenuTriggerFor",s),j(6),z("ngIf",o.getSearchSources().length>4),j(),z("ngForOf",o.getSearchSources()),j(4),z("ngIf",o.hasPointerReverseSearchSource&&!o.isTouchScreen),j(2),z("matTooltip",ce(15,13,"igo.geo.search.searchResultsGeometry.tooltip"))("checked",o.searchResultsGeometryEnabled),j(2),Qe(" ",ce(17,15,"igo.geo.search.searchResultsGeometry.title")," "),j(3),z("matTooltip",o.reverseSearchCoordsFormatEnabled?ce(20,17,"igo.geo.search.reverseCoordFormat.tooltipLatLon"):ce(21,19,"igo.geo.search.reverseCoordFormat.tooltipLonLat"))("checked",o.reverseSearchCoordsFormatEnabled),j(3),Qe(" ",ce(23,21,"igo.geo.search.reverseCoordFormat.title")," ")}},dependencies:[Vt,co,ci,Qt,ti,ym,G1,t9,j1,jt,$t,Gt,Li,hl,ac,_x,yx,wm,vm,bm,dl,Uc,bl,js,Et,Tt],styles:[`[_nghost-%COMP%]{display:flex;align-items:center}.checkAllButton[_ngcontent-%COMP%]{text-align:center;padding:0 5px}.igo-search-settings-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-right:16px}.igo-search-settings-checkbox[_ngcontent-%COMP%]   mat-radio-button[_ngcontent-%COMP%]{display:flex}.igo-search-settings-search-source[_ngcontent-%COMP%]{display:flex;width:100%}.igo-search-settings-search-source[_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{display:flex;margin-left:5px;margin-right:5px}.search-option[_ngcontent-%COMP%]{display:block;margin-right:10px;margin-bottom:15px}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]{overflow-x:hidden}.pointer-summary-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{margin:10px 0}.igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mat-ripple[_ngcontent-%COMP%], .igo-search-settings-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   .mdc-icon-button__ripple[_ngcontent-%COMP%]{border-radius:0!important}.igo-search-settings-sub-menu[_ngcontent-%COMP%]{min-height:34px}
/*# sourceMappingURL=search-settings.component-56FROAYO.css.map */`],changeDetection:0})}return r})();var jTe=["input"],VTe=r=>({empty:r}),UTe=r=>({hasSearchIcon:r});function zTe(r,i){if(r&1&&($(0,"mat-label"),_e(1),ee()),r&2){let e=ne();j(),bt(e.label)}}function $Te(r,i){if(r&1){let e=We();$(0,"button",11),le(1,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.onClearButtonClick())}),$(2,"mat-icon"),_e(3,"close"),ee()()}if(r&2){let e=ne();z("color",e.color)("matTooltip",ce(1,2,"igo.geo.search.clearSearch"))}}function WTe(r,i){r&1&&ct(0,"mat-divider",12),r&2&&z("vertical",!0)}function HTe(r,i){if(r&1){let e=We();$(0,"button",13),ve("click",function(){we(e);let o=ne();return xe(o.handleSearch())}),$(1,"mat-icon"),_e(2,"search"),ee()()}if(r&2){let e=ne();z("color",e.color)}}function qTe(r,i){if(r&1){let e=We();$(0,"igo-search-selector",14),le(1,"async"),ve("searchTypeChange",function(o){we(e);let s=ne();return xe(s.onSearchTypeChange(o))}),ee()}if(r&2){let e=ne();z("searchTypes",e.searchTypes)("searchType",ce(1,2,e.searchType$))}}function YTe(r,i){if(r&1){let e=We();$(0,"igo-search-settings",15),ve("pointerSummaryStatus",function(o){we(e);let s=ne();return xe(s.pointerSummaryStatus.emit(o))})("searchResultsGeometryStatus",function(o){we(e);let s=ne();return xe(s.searchResultsGeometryStatus.emit(o))})("reverseSearchCoordsFormatStatus",function(o){we(e);let s=ne();return xe(s.reverseSearchCoordsFormatStatus.emit(o))})("searchSourceChange",function(){we(e);let o=ne();return xe(o.onSearchSettingsChange())}),ee()}if(r&2){let e=ne();z("pointerSummaryEnabled",e.pointerSummaryEnabled)("searchResultsGeometryEnabled",e.searchResultsGeometryEnabled)("reverseSearchCoordsFormatEnabled",e.reverseSearchCoordsFormatEnabled)}}var L3=(()=>{class r{configService;searchService;searchSourceService;static invalidKeys=["Control","Shift","Alt","ArrowDown","ArrowUp","ArrowRight","ArrowLeft"];placeholder$=new ut("igo.geo.search.placeholder");empty$=new ut(!0);term$$;stream$=new ut("");stream$$;searchType$$;researches$$;showSearchButton=!1;searchTypes=P3;withDivider;set searchType(e){this.setSearchType(e)}get searchType(){return this.searchType$.value}searchType$=new ut(void 0);pointerSummaryStatus=new Ke;searchResultsGeometryStatus=new Ke;reverseSearchCoordsFormatStatus=new Ke;set term(e){this.setTerm(e)}get term(){return this.term$.value}term$=new ut("");set disabled(e){this.disabled$.next(e)}get disabled(){return this.disabled$.value}disabled$=new ut(!1);pointerSummaryEnabled=!1;searchResultsGeometryEnabled=!1;get reverseSearchCoordsFormatEnabled(){return this._reverseSearchCoordsFormatEnabled}set reverseSearchCoordsFormatEnabled(e){this._reverseSearchCoordsFormatEnabled=e,this.setTerm(this.term,!0)}_reverseSearchCoordsFormatEnabled=!1;floatLabel="auto";appearance="fill";placeholder;label;color="primary";termSplitter="|";debounce=200;minLength=2;searchSelector=!1;searchSettings=!1;forceNA=!1;store;searchTermChange=new Ke;search=new Ke;searchTypeChange=new Ke;clearFeature=new Ke;searchSettingsChange=new Ke;input;get empty(){return this.term.length===0}constructor(e,n,o){this.configService=e,this.searchService=n,this.searchSourceService=o}ngOnInit(){this.term$$=this.term$.subscribe(n=>{this.empty$.next(n===void 0||n.length===0)}),this.stream$$=this.stream$.pipe(o0(()=>dm(this.debounce))).subscribe(n=>this.onSetTerm(n)),this.handlePlaceholder(),this.searchType$$=this.searchType$.pipe($u()).subscribe(n=>this.onSetSearchType(n));let e=this.configService.getConfig("searchBar.showSearchButton");this.showSearchButton=e!==void 0?e:!1}ngOnDestroy(){this.term$$.unsubscribe(),this.stream$$.unsubscribe(),this.searchType$$.unsubscribe()}onKeyup(e){let n=e.key;if(!this.keyIsValid(n))return;let o=e.target.value;this.setTerm(o)}onClearButtonClick(){this.clear(),this.clearFeature.emit()}onSearchTypeChange(e){this.setSearchType(e)}setSearchType(e){this.searchType$.next(e)}onSearchSettingsChange(){this.doSearch(this.term),this.searchSettingsChange.emit(),this.handlePlaceholder()}setTerm(e,n){if(this.disabled)return;e=e||"",e!==this.term&&!n&&this.term$.next(e);let o=e.replace(/(#[^\s]*)/g,"").trim();(o.length>=this.minLength||o.length===0)&&this.stream$.next(e)}handleSearch(){this.doSearch(this.term)}clear(){this.term$.next(""),this.stream$.next(""),this.input.nativeElement.focus()}keyIsValid(e){return r.invalidKeys.indexOf(e)===-1}onSetTerm(e){this.searchTermChange.emit(e),this.doSearch(e)}handlePlaceholder(){let e=[...new Set(this.searchSourceService.getEnabledSources().filter(o=>!["map","coordinatesreverse"].includes(o.getId())).map(o=>o.getType()))],n="igo.geo.search.placeholder";e.length===1?n=`igo.geo.search.${e[0].toLowerCase()}.placeholder`:e.length===0&&(n="igo.geo.search.emptyType.placeholder"),this.placeholder$.next(n)}onSetSearchType(e){if(e==null)return;this.searchTypeChange.emit(e);let n=`igo.geo.search.${e.toLowerCase()}.placeholder`;this.placeholder$.next(n),this.setTerm(this.term)}doSearch(e){this.researches$$&&(this.researches$$.map(s=>s.unsubscribe()),this.researches$$=void 0);let n;this.termSplitter&&e.match(new RegExp(this.termSplitter,"g"))?(n=e.split(this.termSplitter).filter(s=>s.length>=this.minLength),this.store&&this.store.clear()):n=[e];let o=[];n.map(s=>{if((s?s.replace(/(#[^\s]*)/g,"").trim():"")===""){this.store!==void 0&&this.store.clear();return}o=o.concat(this.searchService.search(s,{forceNA:this.forceNA}))}),this.researches$$=o.map(s=>s.request.subscribe(l=>{this.onResearchCompleted(s,l)}))}onResearchCompleted(e,n){if(this.search.emit({research:e,results:n}),this.store!==void 0){let o=this.store.all().filter(s=>s.source!==e.source).concat(n);this.store.updateMany(o)}}static \u0275fac=function(n){return new(n||r)(Ie(Oi),Ie(ch),Ie(Bu))};static \u0275cmp=nt({type:r,selectors:[["igo-search-bar"]],viewQuery:function(n,o){if(n&1&&Ir(jTe,7),n&2){let s;bi(s=wi())&&(o.input=s.first)}},inputs:{searchTypes:"searchTypes",withDivider:"withDivider",searchType:"searchType",term:"term",disabled:"disabled",pointerSummaryEnabled:"pointerSummaryEnabled",searchResultsGeometryEnabled:"searchResultsGeometryEnabled",reverseSearchCoordsFormatEnabled:"reverseSearchCoordsFormatEnabled",floatLabel:"floatLabel",appearance:"appearance",placeholder:"placeholder",label:"label",color:"color",termSplitter:"termSplitter",debounce:"debounce",minLength:"minLength",searchSelector:"searchSelector",searchSettings:"searchSettings",forceNA:"forceNA",store:"store"},outputs:{pointerSummaryStatus:"pointerSummaryStatus",searchResultsGeometryStatus:"searchResultsGeometryStatus",reverseSearchCoordsFormatStatus:"reverseSearchCoordsFormatStatus",searchTermChange:"searchTermChange",search:"search",searchTypeChange:"searchTypeChange",clearFeature:"clearFeature",searchSettingsChange:"searchSettingsChange"},standalone:!0,features:[lt],decls:17,vars:29,consts:[["input",""],[1,"igo-search-bar-container",3,"ngClass"],[3,"floatLabel","appearance"],[4,"ngIf"],["matInput","","autocomplete","off",3,"keyup","ngClass","disabled","placeholder","value"],["mat-icon-button","","matSuffix","",3,"color","matTooltip","click",4,"ngIf"],[3,"vertical",4,"ngIf"],[1,"search-bar-buttons"],["mat-icon-button","",3,"color","click",4,"ngIf"],[3,"searchTypes","searchType","searchTypeChange",4,"ngIf"],[3,"pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled","pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click","color","matTooltip"],[3,"vertical"],["mat-icon-button","",3,"click","color"],[3,"searchTypeChange","searchTypes","searchType"],[3,"pointerSummaryStatus","searchResultsGeometryStatus","reverseSearchCoordsFormatStatus","searchSourceChange","pointerSummaryEnabled","searchResultsGeometryEnabled","reverseSearchCoordsFormatEnabled"]],template:function(n,o){if(n&1){let s=We();$(0,"div",1),le(1,"async"),$(2,"mat-form-field",2),Pe(3,zTe,2,1,"mat-label",3),$(4,"input",4,0),le(6,"async"),le(7,"async"),le(8,"translate"),le(9,"async"),ve("keyup",function(h){return we(s),xe(o.onKeyup(h))}),ee(),Pe(10,$Te,4,4,"button",5),le(11,"async"),ee(),Pe(12,WTe,1,1,"mat-divider",6),$(13,"div",7),Pe(14,HTe,3,1,"button",8)(15,qTe,2,4,"igo-search-selector",9)(16,YTe,1,3,"igo-search-settings",10),ee()()}n&2&&(z("ngClass",fn(25,VTe,ce(1,13,o.empty$))),j(2),z("floatLabel",o.floatLabel)("appearance",o.appearance),j(),z("ngIf",o.label),j(),z("ngClass",fn(27,UTe,o.showSearchButton))("disabled",ce(6,15,o.disabled$))("placeholder",o.placeholder?o.placeholder:ce(7,17,o.placeholder$)?ce(8,19,o.placeholder$.value):void 0)("value",ce(9,21,o.term$)),j(6),z("ngIf",ce(11,23,o.empty$)===!1),j(2),z("ngIf",o.withDivider),j(2),z("ngIf",o.showSearchButton),j(),z("ngIf",o.searchSelector),j(),z("ngIf",o.searchSettings))},dependencies:[_a,jr,Gr,Mo,Vc,Gt,gn,Cn,Vt,ci,Qt,ti,jt,$t,dl,Uc,Tw,Fw,Ei,Et,Tt],styles:[`[_nghost-%COMP%]     .mat-mdc-form-field-subscript-wrapper{display:none}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{align-items:center;padding-right:0}[_nghost-%COMP%]     .mat-mdc-form-field-infix{align-self:center}@media (max-width: 599px){[_nghost-%COMP%]     .mat-mdc-form-field-infix{width:158px}}[_nghost-%COMP%]     mat-form-field .mdc-line-ripple{display:none}[_nghost-%COMP%]     mat-form-field input{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.igo-search-bar-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}mat-form-field[_ngcontent-%COMP%]{flex:1}mat-divider[_ngcontent-%COMP%]{margin:8px 0}.search-bar-buttons[_ngcontent-%COMP%]{position:relative;display:inline-flex}.search-bar-buttons[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]:nth-child(2):before{content:"";border-right:1px solid #ddd;height:28px}igo-search-selector[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}igo-search-settings[_ngcontent-%COMP%]{background-color:#fff;top:0;border-radius:0}
/*# sourceMappingURL=search-bar.component-NOTNCB65.css.map */`],changeDetection:0})}return r})();var lB=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[L3]})}return r})();var ZTe=[[["","igoSearchItemToolbar",""]]],XTe=["[igoSearchItemToolbar]"];function KTe(r,i){if(r&1&&($(0,"mat-icon",6),_e(1),ee()),r&2){let e=ne();j(),bt(e.showIcons?e.icon:"blank")}}function QTe(r,i){if(r&1&&ct(0,"div",7),r&2){let e=ne();z("innerHtml",e.titleHtml,hm)("matTooltip",e.tooltipHtml)}}function JTe(r,i){if(r&1&&($(0,"span",9),_e(1),ee()),r&2){let e=ne(2);z("matTooltip",e.title),j(),bt(e.title)}}function e3e(r,i){if(r&1&&Pe(0,JTe,2,2,"span",8),r&2){let e=ne();z("ngIf",!e.titleHtml)}}function t3e(r,i){if(r&1){let e=We();$(0,"button",10),ve("click",function(){we(e);let o=ne();return xe(o.onZoomHandler())}),$(1,"mat-icon"),_e(2,"search"),ee()()}}var k3=(()=>{class r{result;map;showIcons;withZoomButton=!1;zoomEvent=new Ke;format=new Qr;get title(){return ed(this.result)}get titleHtml(){return LG(this.result)}get tooltipHtml(){return this.titleHtml.replace(/<small?[^>]+(>|$)/g,`
`).replace(/<\/?[^>]+(>|$)/g,"")}get icon(){return d0(this.result)}onZoomHandler(){let e=this.format.readFeature(this.result.data,{dataProjection:this.result.data.projection,featureProjection:this.map.projection});ih(this.map.viewController,[e],Yi.Default)}onMouseEvent(e){let n=e.target;switch(e.type){case"mouseenter":{n.querySelector("#hide-save-search-result-btn")?.setAttribute("id","show-save-search-result-btn");break}case"mouseleave":{n.querySelector("#show-save-search-result-btn")?.setAttribute("id","hide-save-search-result-btn");break}default:break}}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-search-results-item"]],inputs:{result:"result",map:"map",showIcons:"showIcons",withZoomButton:"withZoomButton"},outputs:{zoomEvent:"zoomEvent"},standalone:!0,features:[lt],ngContentSelectors:XTe,decls:8,vars:4,consts:[["normalTitle",""],[3,"mouseenter","mouseleave"],["matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip",4,"ngIf","ngIfElse"],["matListItemMeta",""],["igoStopPropagation","","mat-icon-button","",3,"click",4,"ngIf"],["matListItemIcon",""],["matListItemTitle","","matTooltipShowDelay","500","matTooltipClass","search-result-tooltip",3,"innerHtml","matTooltip"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"matTooltip"],["igoStopPropagation","","mat-icon-button","",3,"click"]],template:function(n,o){if(n&1){let s=We();Kn(ZTe),$(0,"mat-list-item",1),ve("mouseenter",function(h){return we(s),xe(o.onMouseEvent(h))})("mouseleave",function(h){return we(s),xe(o.onMouseEvent(h))}),Pe(1,KTe,2,1,"mat-icon",2)(2,QTe,1,2,"div",3)(3,e3e,1,1,"ng-template",null,0,Ac),$(5,"div",4),Pe(6,t3e,3,0,"button",5),Tn(7),ee()()}if(n&2){let s=Xt(4);j(),z("ngIf",o.icon),j(),z("ngIf",o.titleHtml)("ngIfElse",s),j(4),z("ngIf",o.withZoomButton)}},dependencies:[Io,ks,oc,Ta,Ju,Gt,jt,$t,Qt,ti,Vt,ci,zA],styles:[`[_nghost-%COMP%]     small{color:#8c8c8c}[_nghost-%COMP%]   div[matlistitemmeta][_ngcontent-%COMP%]:empty{display:none}[_nghost-%COMP%]     .search-result-tooltip{white-space:pre-line}
/*# sourceMappingURL=search-results-item.component-5HHM72HY.css.map */`],changeDetection:0})}return r})();function i3e(r,i){if(r&1&&($(0,"mat-option",14)(1,"p",15),_e(2),ee()()),r&2){let e=i.$implicit;z("value",e),j(2),bt(e.title)}}var Ite=(()=>{class r{formBuilder;languageService;dialogRef;data;form;feature;layers=[];filteredLayers$;constructor(e,n,o,s){this.formBuilder=e,this.languageService=n,this.dialogRef=o,this.data=s,this.form=this.formBuilder.group({layerName:["",[Fn.required]]})}ngOnInit(){this.feature=this.data.feature,this.layers=this.data.layers,this.filteredLayers$=this.form.controls.layerName.valueChanges.pipe(ec(""),Nt(e=>this.filter(e)))}filter(e){if(typeof e=="string")return this.layers.map(n=>n).filter(n=>n?.title?.toLowerCase().includes(e.toLowerCase()))}displayFn(e){return e&&e.title?e.title:""}save(){let e={layer:this.form.value.layerName,feature:this.feature};this.dialogRef.close(e)}cancel(){this.dialogRef.close()}static \u0275fac=function(n){return new(n||r)(Ie($c),Ie(Di),Ie(Hc),Ie(qc,8))};static \u0275cmp=nt({type:r,selectors:[["igo-save-feature-dialog"]],standalone:!0,features:[lt],decls:23,vars:22,consts:[["auto","matAutocomplete"],["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[3,"navigation","selection"],["igoListItem","","color","accent",3,"result","showIcons"],[1,"igo-input-container"],["type","text","matInput","","formControlName","layerName",3,"placeholder","matAutocomplete"],[3,"displayWith"],[3,"value",4,"ngFor","ngForOf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","create-layer-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","createLayerBtnDialog","mat-raised-button","","type","button","color","primary",3,"click"],[3,"value"],["matListItemTitle",""]],template:function(n,o){if(n&1){let s=We();$(0,"h1",1),_e(1),le(2,"translate"),ee(),$(3,"div",2)(4,"form",3)(5,"igo-list",4),ct(6,"igo-search-results-item",5),ee(),$(7,"div",6)(8,"mat-form-field"),ct(9,"input",7),le(10,"translate"),$(11,"mat-autocomplete",8,0),Pe(13,i3e,3,2,"mat-option",9),le(14,"async"),ee()()()()(),$(15,"div",10)(16,"div",11)(17,"button",12),ve("click",function(){return we(s),xe(o.cancel())}),_e(18),le(19,"translate"),ee(),$(20,"button",13),ve("click",function(){return we(s),xe(o.save())}),_e(21),le(22,"translate"),ee()()()}if(n&2){let s=Xt(12);j(),Qe(" ",ce(2,12,"igo.geo.layer.saveFeatureInLayer"),`
`),j(3),z("formGroup",o.form),j(),z("navigation",!1)("selection",!1),j(),z("result",o.feature)("showIcons",!0),j(3),sr("placeholder",ce(10,14,"igo.geo.layer.chooseOrSet")),z("matAutocomplete",s),j(2),z("displayWith",o.displayFn),j(2),z("ngForOf",ce(14,16,o.filteredLayers$)),j(5),Qe(" ",ce(19,18,"igo.geo.layer.cancelBtn")," "),j(3),Qe(" ",ce(22,20,"igo.geo.layer.saveBtn")," ")}},dependencies:[id,pl,Sn,Xu,os,kn,Zu,Sa,Ku,Qu,yc,k3,Qo,jr,Gr,gn,Cn,Oh,kh,Nn,Su,Li,Bn,Io,Ta,Zc,Vt,co,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .create-layer-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{cursor:pointer}[_nghost-%COMP%]   button#createLayerBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}[_nghost-%COMP%]   .error[_ngcontent-%COMP%]{color:red}
/*# sourceMappingURL=save-feature-dialog.component-H2NI6NH4.css.map */`]})}return r})();function r3e(r,i){if(r&1){let e=We();$(0,"button",2),le(1,"translate"),le(2,"async"),ve("mouseenter",function(o){we(e);let s=ne();return xe(s.onMouseEvent(o))})("mouseleave",function(o){we(e);let s=ne();return xe(s.onMouseEvent(o))})("click",function(o){we(e);let s=ne();return xe(s.onToggleClick(o))}),$(3,"mat-icon",3),le(4,"async"),le(5,"async"),le(6,"async"),le(7,"async"),le(8,"async"),le(9,"async"),_e(10),le(11,"async"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,7,e.computeTooltip()))("color",ce(2,9,e.isPreview$)?"":e.added?"warn":""),j(3),z("igoMatBadgeIcon",e.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",ce(4,11,e.inRange$)&&ce(5,13,e.isVisible$)===!0||ce(6,15,e.inRange$)&&!e.added||ce(7,17,e.inRange$)&&ce(8,19,e.isPreview$))("matBadgeDisabled",ce(9,21,e.inRange$)===!1),j(7),Qe("",ce(11,23,e.isPreview$)?"add":e.added?"delete":"add"," ")}}function n3e(r,i){if(r&1){let e=We();$(0,"button",4),le(1,"async"),le(2,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.addFeatureToLayer())}),$(3,"mat-icon",5),le(4,"async"),_e(5,"add_to_photos "),ee()()}if(r&2){let e=ne();z("id",e.isMobile?"":"hide-save-search-result-btn")("matTooltip",ce(2,7,ce(1,5,e.addFeatureToLayerTooltip$))),j(3),z("igoMatBadgeInverseColor",!0)("matBadgeHidden",ce(4,9,e.inRange$))("matBadgeDisabled",!0)}}var O3=(()=>{class r{layerService;dialog;dataSourceService;mediaService;tooltip$=new ut("igo.geo.catalog.layer.addToMap");addFeatureToLayerTooltip$=new ut("igo.geo.search.addToLayer");resolution$$;layers$$;inRange$=new ut(!0);isVisible$=new ut(!1);isPreview$=new ut(!1);layersSubcriptions=[];lastTimeoutRequest;mouseInsideAdd=!1;layer;store;added;map;saveSearchResultInLayer=!1;get color(){return this._color}set color(e){this._color=e}_color="primary";stores=[];get allLayers(){return this.map.layerController.all.filter(e=>String(e.id).includes("igo-search-layer"))}mediaService$$;isMobile=!1;constructor(e,n,o,s){this.layerService=e,this.dialog=n,this.dataSourceService=o,this.mediaService=s}ngOnInit(){this.mediaService$$=this.mediaService.media$.subscribe(e=>{e===$A.Mobile&&(this.isMobile=!0)}),this.layer.meta.dataType==="Layer"&&(this.added=!!this.map.layerController.getBySourceId(this.layer.data.sourceOptions.id)),this.layers$$=this.map.layerController.all$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(e=>{this.isInResolutionsRange(e),this.isVisible()})}ngOnDestroy(){this.resolution$$.unsubscribe(),this.layers$$.unsubscribe(),this.mediaService$$&&this.mediaService$$.unsubscribe()}onMouseEvent(e){this.onToggleClick(e)}onToggleClick(e){typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest);let n=e||{};if(!(n.type==="mouseenter"&&this.mouseInsideAdd))switch(n.type){case"click":this.isPreview$.value||(this.added?this.remove():this.add(n)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(n),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":clearTimeout(this.lastTimeoutRequest),this.isPreview$.value&&(this.remove(),this.isPreview$.next(!1)),this.mouseInsideAdd=!1;break;default:break}}add(e){this.added||(this.added=!0,this.addLayerToMap(e))}remove(){this.added&&(this.added=!1,this.removeLayerFromMap(),this.layersSubcriptions.map(e=>e.unsubscribe()),this.layersSubcriptions=[])}addLayerToMap(e){if(this.map===void 0||this.layer.meta.dataType!==b_)return;let n=this.layer.data;n.sourceOptions.optionsFromApi===void 0&&(n.sourceOptions.optionsFromApi=!0),this.layersSubcriptions.push(this.layerService.createAsyncLayer(n).subscribe(o=>{o&&(e.type==="click"&&this.map.layersAddedByClick$.next([o]),this.map.layerController.add(o))}))}removeLayerFromMap(){if(this.map===void 0||this.layer.meta.dataType!==b_)return;let e=this.map.layerController.getBySourceId(this.layer.data.sourceOptions.id);e&&this.map.layerController.remove(e)}isInResolutionsRange(e){let n=this.layer.data.minResolution||0,o=this.layer.data.maxResolution||1/0;this.inRange$.next(e>=n&&e<=o)}isVisible(){if(this.layer?.data?.sourceOptions?.id){let e=this.map.layerController.getBySourceId(this.layer.data.sourceOptions.id);this.isVisible$.next(e?.visible??!1)}}getBadgeIcon(){return this.inRange$.value&&this.isVisible$.value?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}addFeatureToLayer(){if(this.layer.meta.dataType!=="Feature")return;let e=this.layer;this.dialog.open(Ite,{width:"700px",data:{feature:e,layers:this.allLayers}}).afterClosed().subscribe(o=>{if(o)if(this.stores.length>0&&this.stores.map(s=>(s.state.updateAll({selected:!1}),s?.layer&&(s.layer.visible=!1),s)),typeof o.layer=="string")this.createLayer(o.layer,o.feature);else{let s=this.stores.find(l=>l.layer.id===o.layer.id);s.layer.visible=!0,s.layer.opacity=1,this.addFeature(o.feature,s)}})}createLayer(e,n){let o=new is([],{map:this.map}),s=[new oi({image:new an({radius:5,stroke:new ui({width:1,color:"rgba(143,7,7,1)"}),fill:new hi({color:"rgba(143,7,7,1)"})})}),new oi({stroke:new ui({width:1,color:"rgba(143,7,7,1)"}),fill:new hi({color:"rgba(0, 0, 255, 0.1)"})})],l=0;for(let h of this.allLayers){let p=Number(h.id.replace("igo-search-layer",""));l=Math.max(p,l)}this.dataSourceService.createAsyncDataSource({type:"vector",queryable:!0}).pipe(Ol(1)).subscribe(h=>{let p=new Fr({isIgoInternalLayer:!0,id:"igo-search-layer"+ ++l,title:e,source:h,igoStyle:{editable:!1,igoStyleObject:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},circle:{fill:{color:"rgba(255,255,255,0.4)"},stroke:{color:"rgba(143,7,7,1)",width:1},radius:5}}},style:s,showInLayerList:!0,exportable:!0,workspace:{enabled:!0}});bd(o,p),Jm(o,new vl({motion:Yi.None})),Cb(o,new rs({map:this.map,motion:Yi.None,many:!0})),o.layer.visible=!0,o.source.ol.on("removefeature",m=>{let f=m.feature.getGeometry();this.clearLabelsOfOlGeometry(f)}),this.addFeature(n,o),this.stores.push(o)})}addFeature(e,n){let o={type:e.data.type,geometry:{coordinates:e.data.geometry.coordinates,type:e.data.geometry.type},projection:e.data.projection,properties:e.data.properties,meta:{id:e.meta.id}};delete o.properties.Route,n.update(o),n.setLayerExtent(),n.layer.ol.getSource().refresh()}clearLabelsOfOlGeometry(e){yw(e).forEach(n=>{n&&n.getMap()&&this.map.ol.removeOverlay(n)})}static \u0275fac=function(n){return new(n||r)(Ie(Za),Ie(Yc),Ie(FT),Ie(Wc))};static \u0275cmp=nt({type:r,selectors:[["igo-search-add-button"]],inputs:{layer:"layer",store:"store",added:"added",map:"map",saveSearchResultInLayer:"saveSearchResultInLayer",color:"color",stores:"stores"},standalone:!0,features:[lt],decls:2,vars:2,consts:[["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"matTooltip","color","mouseenter","mouseleave","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"id","matTooltip","click",4,"ngIf"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"mouseenter","mouseleave","click","matTooltip","color"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],["igoStopPropagation","","mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","id","matTooltip"],["aria-hidden","false","matBadge","icon","igoMatBadgeIcon","visibility_off","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"]],template:function(n,o){n&1&&Pe(0,r3e,12,25,"button",0)(1,n3e,6,11,"button",1),n&2&&(z("ngIf",o.layer.meta.dataType==="Layer"),j(),z("ngIf",o.layer.meta.dataType==="Feature"&&o.saveSearchResultInLayer))},dependencies:[Gt,Vt,ci,zA,Qt,ti,jt,$t,xl,Md,VE,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   #hide-save-search-result-btn[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   #show-save-search-result-btn[_ngcontent-%COMP%]{display:block}
/*# sourceMappingURL=search-results-add-button.component-5MGAHKUH.css.map */`],changeDetection:0})}return r})();var o3e=["igoSearchItemToolbar"],Ete=r=>({results:r}),Tte=r=>({result:r}),Fte=r=>({group:r});function a3e(r,i){r&1&&ic(0)}function s3e(r,i){if(r&1){let e=We();$(0,"igo-collapsible",8),ve("toggle",function(o){we(e);let s=ne().$implicit,l=ne(2);return xe(l.collapsed[s.source.title]=o)}),Pe(1,a3e,1,0,"ng-container",9),ee()}if(r&2){let e=ne().$implicit,n=Xt(4),o=ne(2);Vd(e.source.getId()),z("title",o.computeGroupTitle(e))("collapsed",o.collapsed[e.source.title]),j(),z("ngTemplateOutlet",n)("ngTemplateOutletContext",fn(6,Ete,e.results))}}function l3e(r,i){r&1&&ic(0)}function c3e(r,i){if(r&1&&Pe(0,l3e,1,0,"ng-container",9),r&2){let e=ne().$implicit,n=Xt(4);z("ngTemplateOutlet",n)("ngTemplateOutletContext",fn(2,Ete,e.results))}}function u3e(r,i){if(r&1){let e=We();$(0,"igo-search-results-item",11),ve("focus",function(){let o=we(e).$implicit,s=ne(4);return xe(s.resultFocus.emit(o))})("unfocus",function(){let o=we(e).$implicit,s=ne(4);return xe(s.resultUnfocus.emit(o))})("select",function(){let o=we(e).$implicit,s=ne(4);return xe(s.onResultSelect(o))})("mouseenter",function(){let o=we(e).$implicit,s=ne(4);return xe(s.resultFocus.emit(o))})("mouseleave",function(){let o=we(e).$implicit,s=ne(4);return xe(s.resultUnfocus.emit(o))}),ic(1,12),ee()}if(r&2){let e=i.$implicit,n=ne(4);z("map",n.map)("result",e)("showIcons",n.showIcons)("withZoomButton",n.withZoomButton)("focused",n.store.state.get(e).focused)("selected",n.store.state.get(e).selected),j(),z("ngTemplateOutlet",n.templateSearchToolbar)("ngTemplateOutletContext",fn(8,Tte,e))}}function d3e(r,i){if(r&1){let e=We();$(0,"span",13),ve("click",function(){we(e);let o=ne(2).$implicit,s=ne(2);return xe(s.displayMoreResults(o))}),$(1,"u"),_e(2),le(3,"translate"),ee()()}r&2&&(j(2),bt(ce(3,1,"igo.geo.search.displayMoreResults")))}function h3e(r,i){if(r&1&&Pe(0,u3e,2,10,"ng-template",6)(1,d3e,4,3,"span",10),r&2){let e=i.results,n=ne().$implicit,o=ne(2);z("ngForOf",e),j(),z("ngIf",o.isMoreResults(n))}}function p3e(r,i){if(r&1&&Pe(0,s3e,2,8,"igo-collapsible",7)(1,c3e,1,4,"ng-template",null,1,Ac)(3,h3e,2,2,"ng-template",null,2,Ac),r&2){let e=Xt(2),n=ne(2);z("ngIf",n.mode===n.searchResultMode.Grouped)("ngIfElse",e)}}function m3e(r,i){if(r&1&&($(0,"igo-list",5),Pe(1,p3e,5,2,"ng-template",6,0,Ac),le(3,"async"),ee()),r&2){let e=ne();z("navigation",!0),j(),z("ngForOf",ce(3,2,e.results$))}}function f3e(r,i){r&1&&ic(0)}function g3e(r,i){r&1&&ic(0)}function _3e(r,i){if(r&1&&($(0,"mat-tab",17),Pe(1,g3e,1,0,"ng-container",9),ee()),r&2){let e=i.$implicit;ne(2);let n=Xt(7),o=ne();z("label",o.computeGroupTitle(e)),j(),z("ngTemplateOutlet",n)("ngTemplateOutletContext",fn(3,Fte,e))}}function y3e(r,i){if(r&1&&($(0,"mat-tab-group",15),Pe(1,_3e,2,5,"mat-tab",16),le(2,"async"),ee()),r&2){let e=ne(2);j(),z("ngForOf",ce(2,1,e.results$))}}function v3e(r,i){r&1&&ic(0)}function b3e(r,i){if(r&1&&Pe(0,v3e,1,0,"ng-container",9),r&2){let e=i.$implicit;ne(2);let n=Xt(7);z("ngTemplateOutlet",n)("ngTemplateOutletContext",fn(2,Fte,e))}}function w3e(r,i){if(r&1&&(Pe(0,b3e,1,4,"ng-template",6),le(1,"async")),r&2){let e=ne(2);z("ngForOf",ce(1,1,e.results$))}}function x3e(r,i){if(r&1){let e=We();$(0,"igo-search-results-item",11),ve("focus",function(){let o=we(e).$implicit,s=ne(3);return xe(s.resultFocus.emit(o))})("unfocus",function(){let o=we(e).$implicit,s=ne(3);return xe(s.resultUnfocus.emit(o))})("select",function(){let o=we(e).$implicit,s=ne(3);return xe(s.onResultSelect(o))})("mouseenter",function(){let o=we(e).$implicit,s=ne(3);return xe(s.resultFocus.emit(o))})("mouseleave",function(){let o=we(e).$implicit,s=ne(3);return xe(s.resultUnfocus.emit(o))}),ic(1,12),ee()}if(r&2){let e=i.$implicit,n=ne(3);z("map",n.map)("result",e)("showIcons",n.showIcons)("withZoomButton",n.withZoomButton)("focused",n.store.state.get(e).focused)("selected",n.store.state.get(e).selected),j(),z("ngTemplateOutlet",n.templateSearchToolbar)("ngTemplateOutletContext",fn(8,Tte,e))}}function S3e(r,i){if(r&1){let e=We();$(0,"span",13),ve("click",function(){we(e);let o=ne().group,s=ne(2);return xe(s.displayMoreResults(o))}),$(1,"u"),_e(2),le(3,"translate"),ee()()}r&2&&(j(2),bt(ce(3,1,"igo.geo.search.displayMoreResults")))}function C3e(r,i){if(r&1&&Pe(0,x3e,2,10,"ng-template",6)(1,S3e,4,3,"span",10),r&2){let e=i.group,n=ne(2);z("ngForOf",e.results),j(),z("ngIf",n.isMoreResults(e))}}function A3e(r,i){if(r&1&&($(0,"igo-list",5),Pe(1,f3e,1,0,"ng-container",14)(2,y3e,3,3,"ng-template",null,3,Ac)(4,w3e,2,3,"ng-template",null,1,Ac)(6,C3e,2,2,"ng-template",null,2,Ac),ee()),r&2){let e=Xt(3),n=Xt(5),o=ne();z("navigation",!0),j(),z("ngIf",o.mode===o.searchResultMode.Grouped)("ngIfThen",e)("ngIfElse",n)}}var cB=function(r){return r.Grouped="grouped",r.Flat="flat",r}(cB||{}),D3=(()=>{class r{cdRef;searchService;configService;showResultsCount=!0;searchResultMode=cB;watcher;settingsChange$$;pageIterator=[];collapsed=[];map;store;showIcons;mode=cB.Grouped;withZoomButton=!1;tabsMode=!1;get term(){return this._term}set term(e){this._term=e,this.pageIterator=[]}_term;settingsChange$=new ut(void 0);termSplitter="|";resultFocus=new Ke;resultUnfocus=new Ke;resultSelect=new Ke;moreResults=new Ke;resultMouseenter=new Ke;resultMouseleave=new Ke;templateSearchToolbar;get results$(){return this._results$===void 0&&(this._results$=this.liftResults()),this._results$}_results$;constructor(e,n,o){this.cdRef=e,this.searchService=n,this.configService=o}ngOnInit(){this.watcher=new N1(this.store,this.cdRef),this.settingsChange$$=this.settingsChange$.subscribe(()=>{this.pageIterator=[]}),this.configService.getConfig("searchSources.showResultsCount")===!1&&(this.showResultsCount=!1)}ngOnDestroy(){this.watcher.destroy(),this.settingsChange$$.unsubscribe()}computeGroupTitle(e){let n=[e.source.title],o=e.results.length;return o>1&&this.showResultsCount&&n.push(`(${o})`),n.join(" ")}onResultSelect(e){this.store.state.get(e)&&this.store.state.get(e).selected===!0||(this.store.state.update(e,{focused:!0,selected:!0},!0),this.resultSelect.emit(e))}liftResults(){return this.store.stateView.all$().pipe(o0(e=>e.length===0?Gd:dm(200)),Nt(e=>this.groupResults(e.map(n=>n.entity).sort(this.sortByOrder))))}sortByOrder(e,n){return e.source.displayOrder-n.source.displayOrder}groupResults(e){let n=new Map;return e.forEach(o=>{let s=o.source,l=n.get(s);l===void 0&&(l=[],n.set(s,l)),l.push(o)}),Array.from(n.keys()).map(o=>(this.pageIterator[o.getId()]===void 0&&(this.pageIterator[o.getId()]=1),{source:o,results:n.get(o)}))}isMoreResults(e){return this.store.getStrategyOfType(Mx)?.active||!1?e.results?.length%+e.source.params.limit===0&&+e.source.params.page<30:e.results&&e.results[e.results.length-1].meta.nextPage===!0}displayMoreResults(e){let n={sourceId:e.source.getId(),page:++this.pageIterator[e.source.getId()]},o;this.termSplitter&&this.term.match(new RegExp(this.termSplitter,"g"))?o=this.term.split(this.termSplitter):o=[this.term];let s=[];o.map(l=>{s=s.concat(this.searchService.search(l,n))}),s.map(l=>{l.request.subscribe(h=>{let p=e.results.concat(h);h.length||(p[p.length-1].meta.nextPage=!1),this.moreResults.emit({research:l,results:p})})})}static \u0275fac=function(n){return new(n||r)(Ie(lr),Ie(ch),Ie(Oi))};static \u0275cmp=nt({type:r,selectors:[["igo-search-results"]],contentQueries:function(n,o,s){if(n&1&&Do(s,o3e,5),n&2){let l;bi(l=wi())&&(o.templateSearchToolbar=l.first)}},inputs:{map:"map",store:"store",showIcons:"showIcons",mode:"mode",withZoomButton:"withZoomButton",tabsMode:"tabsMode",term:"term",settingsChange$:"settingsChange$",termSplitter:"termSplitter"},outputs:{resultFocus:"resultFocus",resultUnfocus:"resultUnfocus",resultSelect:"resultSelect",moreResults:"moreResults",resultMouseenter:"resultMouseenter",resultMouseleave:"resultMouseleave"},standalone:!0,features:[lt],decls:2,vars:2,consts:[["groupTemplate",""],["flatTemplate",""],["storeItemTemplate",""],["tabsTemplate",""],[3,"navigation",4,"ngIf"],[3,"navigation"],["ngFor","",3,"ngForOf"],[3,"class","title","collapsed","toggle",4,"ngIf","ngIfElse"],[3,"toggle","title","collapsed"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","moreResults mat-typography",3,"click",4,"ngIf"],["igoListItem","","color","accent",3,"focus","unfocus","select","mouseenter","mouseleave","map","result","showIcons","withZoomButton","focused","selected"],["igoSearchItemToolbar","",3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"moreResults","mat-typography",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["dynamicHeight","",1,"custom-tabs-view"],[3,"label",4,"ngFor","ngForOf"],[3,"label"]],template:function(n,o){n&1&&Pe(0,m3e,4,4,"igo-list",4)(1,A3e,8,4,"igo-list",4),n&2&&(z("ngIf",o.tabsMode===!1),j(),z("ngIf",o.tabsMode))},dependencies:[Gt,yc,Li,kE,EA,k3,Qo,g3,PC,f3,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   .moreResults[_ngcontent-%COMP%]{cursor:pointer;color:#00f;float:right;margin-right:10px;margin-top:5px}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list{height:100%}[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]     mat-list .custom-tabs-view .mat-mdc-tab-header-pagination{min-width:20px}
/*# sourceMappingURL=search-results.component-5USK4N77.css.map */`],changeDetection:0})}return r})();var uB=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[D3,O3]})}return r})();var Pte=[D3,O3];var dB=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Tw]})}return r})();var hB=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[Fw]})}return r})();var Lte=(()=>{class r{component;searchService;searchSourceService;mediaService;store;lonLat;pointerSearchStore=new Lh([]);lastTimeoutRequest;store$$;reverseSearch$$=[];hasPointerReverseSearchSource=!1;pointerMoveListener;searchPointerSummaryFeatureId="searchPointerSummaryFeatureId";igoSearchPointerSummaryDelay=1e3;igoSearchPointerSummaryEnabled=!1;mouseleave(){clearTimeout(this.lastTimeoutRequest),this.clearLayer()}get map(){return this.component.map}get mapProjection(){return this.component.map.projection}constructor(e,n,o,s){this.component=e,this.searchService=n,this.searchSourceService=o,this.mediaService=s}ngOnInit(){this.listenToMapPointerMove(),this.map.status$.pipe(Ps(e=>e===dn.Done)).subscribe(()=>{this.store=new is([],{map:this.map}),this.initStore(),this.subscribeToPointerStore()})}initStore(){let e=this.store,n=new Fr({isIgoInternalLayer:!0,id:"searchPointerSummaryId",title:"searchPointerSummary",zIndex:900,source:new kr,showInLayerList:!1,exportable:!1,browsable:!1,style:aJ});bd(e,n)}ngAfterContentChecked(){this.searchSourceService.getEnabledSources().filter(_w).length?this.hasPointerReverseSearchSource=!0:this.hasPointerReverseSearchSource=!1}ngOnDestroy(){this.unlistenToMapPointerMove(),this.unsubscribeToPointerStore(),this.unsubscribeReverseSearch()}subscribeToPointerStore(){this.store$$=this.pointerSearchStore.entities$.subscribe(e=>{this.entitiesToPointerOverlay(e)})}computeSummaryClosestFeature(e){let n={};return e.map(o=>{if(o.data.properties.type&&o.data.properties.distance>=0)if(n.hasOwnProperty(o.data.properties.type)){let s=n[o.data.properties.type].distance;if(o.data.properties.distance<s){let l=o.meta.pointerSummaryTitle||o.meta.title;n[o.data.properties.type]={distance:o.data.properties.distance,title:l}}}else{let s=o.meta.pointerSummaryTitle||o.meta.title;n[o.data.properties.type]={distance:o.data.properties.distance,title:s}}}),n}entitiesToPointerOverlay(e){let n=this.computeSummaryClosestFeature(e),o=Object.keys(n),s=[],l=[];e.map(h=>{let p=o.indexOf(h.data.properties.type);p!==-1?(l.push(n[h.data.properties.type].title),o.splice(p,1),s.push(h.data.properties.type)):s.indexOf(h.data.properties.type)===-1&&l.push(h.meta.pointerSummaryTitle||h.meta.title)}),l.length&&this.addPointerOverlay(l.join(`
`))}listenToMapPointerMove(){this.pointerMoveListener=this.map.ol.on("pointermove",e=>this.onMapEvent(e))}unsubscribeToPointerStore(){this.store$$?.unsubscribe()}unsubscribeReverseSearch(){this.reverseSearch$$.map(e=>e.unsubscribe()),this.reverseSearch$$=[]}unlistenToMapPointerMove(){io(this.pointerMoveListener),this.pointerMoveListener=void 0}onMapEvent(e){if(e.dragging||!this.igoSearchPointerSummaryEnabled||!this.hasPointerReverseSearchSource||this.mediaService.isTouchScreen()){this.clearLayer();return}typeof this.lastTimeoutRequest<"u"&&(clearTimeout(this.lastTimeoutRequest),this.clearLayer(),this.unsubscribeReverseSearch()),this.lonLat=Sr(e.coordinate,this.mapProjection,"EPSG:4326"),this.lastTimeoutRequest=setTimeout(()=>{this.onSearchCoordinate()},this.igoSearchPointerSummaryDelay)}sortByOrder(e,n){return e.source.displayOrder-n.source.displayOrder}onSearchCoordinate(){this.pointerSearchStore.clear();let e=this.searchService.reverseSearch(this.lonLat,{params:{geometry:"false",icon:"false"}},!0);for(let n in e)e.length>0&&this.reverseSearch$$.push(e[n].request.subscribe(o=>{this.onSearch({research:e[n],results:o})}))}onSearch(e){let n=e.results,o=this.pointerSearchStore.all().filter(s=>s.source!==e.research.source).concat(n);this.pointerSearchStore.load(o.sort(this.sortByOrder))}addPointerOverlay(e){this.clearLayer();let n=new Ii(Sr(this.lonLat,"EPSG:4326",this.mapProjection)),o=new gi({geometry:n}),s=new Qr().writeGeometryObject(n,{featureProjection:this.mapProjection,dataProjection:this.mapProjection}),l={type:vr,geometry:s,projection:this.mapProjection,properties:{id:this.searchPointerSummaryFeatureId,pointerSummary:e},meta:{id:this.searchPointerSummaryFeatureId},ol:o};this.store.setLayerFeatures([l],Yi.None)}clearLayer(){this.store&&this.store.clearLayer()}static \u0275fac=function(n){return new(n||r)(Ie(sh,2),Ie(ch),Ie(Bu),Ie(Wc))};static \u0275dir=Fi({type:r,selectors:[["","igoSearchPointerSummary",""]],hostBindings:function(n,o){n&1&&ve("mouseleave",function(){return o.mouseleave()})},inputs:{igoSearchPointerSummaryDelay:"igoSearchPointerSummaryDelay",igoSearchPointerSummaryEnabled:"igoSearchPointerSummaryEnabled"},standalone:!0})}return r})();function M3e(r){return new Bu(r)}function R3(){return{provide:Bu,useFactory:M3e,deps:[So]}}var vc=class{static getGoogleMapsCoordLink(i,e){return`https://www.google.com/maps/search/?api=1&query=${e}%2C${i}`}static getGoogleStreetViewLink(i,e){return`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${e}%2C${i}`}static getGoogleMapsNameLink(i){return`https://www.google.com/maps/search/?api=1&query=${encodeURI(i)}`}};var N3=class{static getOpenStreetMapLink(i,e,n=17){return`https://www.openstreetmap.org/?mlat=${e}&mlon=${i}#map=${n}/${e}/${i}`}static getOpenStreetCamLink(i,e,n=17){return`https://openstreetcam.org/map/@${e},${i},${n}z`}};var pB=(()=>{class r{languageService;constructor(e){this.languageService=e}formatResult(e){return e}static \u0275fac=function(n){return new(n||r)(pt(Di))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})(),B3=class r extends So{languageService;static id="coordinatesreverse";static type=vr;projections;title$=new ut("");get title(){return this.title$.getValue()}constructor(i,e,n,o){super(i,n),this.languageService=e,this.projections=o,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"igo.geo.search.coordinates.name",order:1,showInSettings:!1}}reverseSearch(i,e,n){return ai([this.dataToResult(i,e,n)])}dataToResult(i,e,n){let o=hM(i),l=$9(i,this.projections).reduce((w,A)=>(w[A.alias]=A.igo2CoordFormat,w),{}),h=n?uc(i,6).reverse().join(", "):uc(i,6).join(", "),p=n?o.reverse().join(", "):o.join(", "),m={type:"Point",coordinates:[i[0],i[1]]},f={},g="";if(e.distance){let w=this.languageService.translate.instant("igo.geo.search.coordinates.radius");f[w]=e.distance,g="<br><small>Rayon: "+e.distance+" m</small>";let A=Sr([i[0],i[1]],"EPSG:4326","EPSG:3857"),k=new Tu(A,e.distance),R=Kd(k),q=new Qr;m=JSON.parse(q.writeGeometry(R.transform("EPSG:3857","EPSG:4326")))}if(e.conf){let w=this.languageService.translate.instant("igo.geo.search.coordinates.conf");f[w]=e.conf,g+=g===""?"<br>":"<small> - </small>",g+="<small>Confiance: "+e.conf+"%</small>"}let y=n?this.languageService.translate.instant("igo.geo.search.coordinates.reversedCoord"):this.languageService.translate.instant("igo.geo.search.coordinates.coord");f[y]=h;let _=n?this.languageService.translate.instant("igo.geo.search.coordinates.reversedCoordDMS"):this.languageService.translate.instant("igo.geo.search.coordinates.coordDMS");return f[_]=p,{source:this,data:{type:vr,projection:"EPSG:4326",geometry:m,extent:void 0,properties:Object.assign(f,l,{GoogleMaps:vc.getGoogleMapsCoordLink(i[0],i[1]),GoogleStreetView:vc.getGoogleStreetViewLink(i[0],i[1]),OpenStreetMap:N3.getOpenStreetMapLink(i[0],i[1],14),Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"}),meta:{id:i[0].toString()+","+i[1].toString(),title:h}},meta:{dataType:vr,id:i[0].toString()+","+i[1].toString(),title:h,titleHtml:h+g,icon:"location_on",score:100}}}static \u0275fac=function(e){return new(e||r)(pt("options"),pt(Di),pt(Kr),pt("projections"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20}),Xr("design:type",Function),Xr("design:paramtypes",[Array,Object,Boolean]),Xr("design:returntype",$r)],B3.prototype,"reverseSearch",null);var gf=function(r){return r[r.ICherche=0]="ICherche",r[r.IChercheReverse=1]="IChercheReverse",r[r.Cadastre=2]="Cadastre",r[r.CoordinatesReverse=3]="CoordinatesReverse",r[r.ILayer=4]="ILayer",r[r.Nominatim=5]="Nominatim",r[r.StoredQueries=6]="StoredQueries",r[r.StoredQueriesReverse=7]="StoredQueriesReverse",r[r.Workspace=8]="Workspace",r}(gf||{});function I3e(r){return new pB(r)}function kte(){return{provide:pB,useFactory:I3e,deps:[Di]}}var mB={"map-marker":"location_on",city:"location_city","flag-triangle":"flag","map-marker-alert":"fmd_bad","map-marker-radius":"pin_drop","map-marker-multiple":"local_post_office","map-legend":"map",bank:"account_balance","map-search":"search_insights","book-open-variant":"menu_book","office-building":"apartment","table-picnic":"table_restaurant",flash:"flash_on",engine:TG,"road-variant":"add_road","baby-face-outline":"child_care","home-account":"location_home",hospital:"local_hospital",pharmacy:"local_pharmacy","police-badge-outline":"local_police",parking:"local_parking",tree:"nature","home-city":"home_work",terrain:"landscape","panorama-horizontal":"panorama_horizontal"};var BC=(()=>{class r{languageService;constructor(e){this.languageService=e}formatResult(e){return e}static \u0275fac=function(n){return new(n||r)(pt(Di))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})(),fB=class{encodeKey(i){return encodeURIComponent(i)}encodeValue(i){return encodeURIComponent(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}},Pw=class r extends So{http;languageService;formatter;static id="icherche";static type=vr;static propertiesBlacklist=[];title$=new ut("");hashtagsLieuxToKeep=[];get title(){return this.title$.getValue()}constructor(i,e,n,o,s,l){super(o,n),this.http=i,this.languageService=e,this.formatter=s;let h=l.get(KF);this.settings.length&&(h?h.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes()),this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return r.id}getType(){return r.type}getDefaultOptions(){let i=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,e=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,n=this.options.params?.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","codes-postaux","routes","intersections","municipalites","mrc","regadmin","lieux"],o=this.options.showAdvancedSettings;return{title:"igo.geo.search.icherche.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/icherche",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:n.indexOf("adresses")!==-1,hashtags:["adresse"]},{title:"igo.geo.search.icherche.type.oldAddress",value:"anciennes-adresses",enabled:n.indexOf("anciennes-adresses")!==-1,hashtags:["anciennes-adresses"]},{title:"igo.geo.search.icherche.type.oldCity",value:"anciennes-municipalites",enabled:n.indexOf("anciennes-municipalites")!==-1,hashtags:["anciennes-municipalites"]},{title:"igo.geo.search.icherche.type.cn",value:"bornes-cn",enabled:n.indexOf("bornes-cn")!==-1,hashtags:["borne","bornes","cn"]},{title:"igo.geo.search.icherche.type.sumi",value:"bornes-sumi",enabled:n.indexOf("bornes-sumi")!==-1,hashtags:["borne","bornes","sumi"]},{title:"igo.geo.search.icherche.type.cadastre",value:"cadastre",enabled:n.indexOf("cadastre")!==-1,hashtags:["cadastre"]},{title:"igo.geo.search.icherche.type.postalCode",value:"codes-postaux",enabled:n.indexOf("codes-postaux")!==-1,hashtags:["code-postal"]},{title:"igo.geo.search.icherche.type.entreprise",value:"entreprises",enabled:n.indexOf("entreprises")!==-1,available:!1,hashtags:["entreprise"]},{title:"igo.geo.search.icherche.type.cycleStop",value:"haltes_cyclables",enabled:n.indexOf("haltes_cyclables")!==-1,hashtags:["haltevelo","haltes_cyclables"]},{title:"igo.geo.search.icherche.type.restArea",value:"haltes_routieres",enabled:n.indexOf("haltes_routieres")!==-1,hashtags:["halteroute","haltes_routieres"]},{title:"igo.geo.search.icherche.type.hq",value:"hq",enabled:n.indexOf("hq")!==-1,hashtags:["hq"]},{title:"igo.geo.search.icherche.type.intersection",value:"intersections",enabled:n.indexOf("intersections")!==-1,hashtags:["intersection","+"]},{title:"igo.geo.search.icherche.type.place",value:"lieux",enabled:n.indexOf("lieux")!==-1,hashtags:["lieu"]},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:n.indexOf("mrc")!==-1,hashtags:["mrc"]},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:n.indexOf("municipalites")!==-1,hashtags:["municipalit\xE9","mun"]},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:n.indexOf("regadmin")!==-1,hashtags:["r\xE9gion-administrative","regadmin"]},{title:"igo.geo.search.icherche.type.gcc",value:"bornes-gcc",enabled:n.indexOf("bornes-gcc")!==-1,hashtags:["borne","bornes","rep\xE8re","gcc","ccg"]},{title:"igo.geo.search.icherche.type.km",value:"bornes-km",enabled:n.indexOf("bornes-km")!==-1,hashtags:["borne","bornes","rep\xE8re","km"]},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:n.indexOf("routes")!==-1,hashtags:["route"]},{title:"igo.geo.search.icherche.type.exit",value:"sorties-autoroute",enabled:n.indexOf("sorties-autoroute")!==-1,hashtags:["sortie","sorties","exit"]},{title:"igo.geo.search.icherche.type.cultpatri",value:"culture",enabled:n.indexOf("culture")!==-1,hashtags:["grille","culture"]},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:n.indexOf("unites")!==-1,hashtags:["unites","adresse"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:i===1},{title:"5",value:5,enabled:i===5||!i},{title:"10",value:10,enabled:i===10},{title:"25",value:25,enabled:i===25},{title:"50",value:50,enabled:i===50}]},o&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:e===10},{title:"30 %",value:30,enabled:e===30||!e},{title:"50 %",value:50,enabled:e===50},{title:"75 %",value:75,enabled:e===75},{title:"100 %",value:100,enabled:e===100}]},{type:"radiobutton",title:"restrictExtent",name:"loc",values:[{title:"igo.geo.search.icherche.restrictExtent.map",value:"true",enabled:!1},{title:"igo.geo.search.icherche.restrictExtent.quebec",value:"false",enabled:!0}]}].filter(Boolean)}}search(i,e){let n=this.computeRequestParams(i,e||{});return n.get("type").length?(this.options.params.page=n.get("page")||"1",this.getSearch(i,n)):ai([])}getSearch(i,e){return this.http.get(`${this.searchUrl}/geocode`,{params:e}).pipe(Nt(n=>this.extractResults(n,i)),qr(n=>{throw n.error.toDisplay=!0,n.error.title=this.languageService.translate.instant(this.getDefaultOptions().title),n}))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(i=>{let e=this.settings.find(n=>n.name==="type");e.values.forEach(n=>{let o=new RegExp(`^${n.value}(\\.|$)`),s=i.filter(l=>o.test(l));n.available=s.length>0,n.value==="lieux"&&(this.hashtagsLieuxToKeep=[...new Set(s.map(l=>l.split(".")).reduce((l,h)=>l.concat(h)).filter(l=>l!=="lieux"))])}),this.setParamFromSetting(e,!1)})}computeRequestParams(i,e){let n=Object.assign({geometry:!0,bbox:!0,icon:!0,type:"adresses,codes-postaux,municipalites,mrc,regadmin,lieux,entreprises,bornes-sumi"},this.params,this.computeOptionsParam(i,e||{}).params,{q:this.computeTerm(i),page:e.page});if(n.loc==="true"){let[o,s,l,h]=e.extent;n.loc=`${o},${s};${l},${s};${l},${h};${o},${h};${o},${s}`}else n.loc==="false"&&delete n.loc;return/#[A-Za-z]+/.test(n.q)&&(n.type="lieux"),new fs({fromObject:rr.removeUndefined(n),encoder:new fB})}extractResults(i,e){return i.features.map(n=>this.formatter.formatResult(this.dataToResult(n,e,i)))}dataToResult(i,e,n){let o=this.computeProperties(i),s=[this.getId(),o.type,o.code].join("."),l=i.highlight.title||i.properties.nom,h=i.highlight.title2?" <small> "+i.highlight.title2+"</small>":"",p=i.highlight.title3?"<br><small> "+i.highlight.title3+"</small>":"",m=i.icon;return typeof m=="string"&&Object.keys(mB).includes(m)&&(m=mB[m]),{source:this,data:{type:vr,projection:"EPSG:4326",geometry:i.geometry,extent:i.bbox,properties:o,meta:{id:s,title:i.properties.nom}},meta:{dataType:vr,id:s,title:i.properties.nom,titleHtml:l+h+p,icon:m||"location_on",score:i.score||lh(e.trim(),i.properties.nom),nextPage:n.features.length%+this.options.params.limit===0&&+this.options.params.page<10}}}computeProperties(i){let e=rr.removeKeys(i.properties,r.propertiesBlacklist);if(!i.geometry)return Object.assign({type:i.index},e);let n={GoogleMaps:""},o;if(i.geometry.type==="Point")o=vc.getGoogleMapsCoordLink(i.geometry.coordinates[0],i.geometry.coordinates[1]);else{let h=Fb(i.geometry);o=vc.getGoogleMapsCoordLink(h.geometry.coordinates[0],h.geometry.coordinates[1])}let s;i.index==="routes"?s=vc.getGoogleMapsNameLink(i.properties.nom+", "+i.properties.municipalite):i.index==="municipalites"?s=vc.getGoogleMapsNameLink(i.properties.nom+", ville"):i.index==="mrc"?s=vc.getGoogleMapsNameLink("mrc+"+i.properties.nom):i.index==="regadmin"?s=vc.getGoogleMapsNameLink(i.properties.nom+",+QC"):s=vc.getGoogleMapsNameLink(i.properties.nom||i.highlight.title),n.GoogleMaps="<a href="+o+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a> <br /> <a href="+s+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByName")+"</a>",i.geometry.type==="Point"&&(n.GoogleStreetView=vc.getGoogleStreetViewLink(i.geometry.coordinates[0],i.geometry.coordinates[1]));let l={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:i.index},e,n,l)}computeTerm(i){let e=i.match(/(#[A-Za-z]+)/g)||[],n=!1;return n=e.some(o=>{let s=String(o).substring(1);return this.hashtagsLieuxToKeep.some(l=>l.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""))}),n||(i=i.replace(/(#[A-Za-z]+)/g,"")),i.replace(/[^\w- !\-\+\(\)\.\/,'#]+/g,"")}computeOptionsParam(i,e){let n=super.getHashtagsValid(i,"type");return n&&(e.params=Object.assign(e.params||{},{type:n.join(",")})),e}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"),pt(BC),pt(jd))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[String,fs]),Xr("design:returntype",$r)],Pw.prototype,"getSearch",null);var G3=class r extends So{http;languageService;static id="icherchereverse";static type=vr;static propertiesBlacklist=[];title$=new ut("");get title(){return this.title$.getValue()}constructor(i,e,n,o,s){super(o,n),this.http=i,this.languageService=e,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))});let l=s.get(KF);this.settings.length&&(l?l.authenticate$.subscribe(()=>{this.getAllowedTypes()}):this.getAllowedTypes())}getId(){return r.id}getType(){return r.type}getDefaultOptions(){let i=this.options.params&&this.options.params.type?this.options.params.type.replace(/\s/g,"").toLowerCase().split(","):["adresses","municipalites","mrc","regadmin"];return{title:"igo.geo.search.ichercheReverse.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/terrapi",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.icherche.type.address",value:"adresses",enabled:i.indexOf("adresses")!==-1},{title:"igo.geo.search.icherche.type.road",value:"routes",enabled:i.indexOf("routes")!==-1,available:!1},{title:"igo.geo.search.icherche.type.district",value:"arrondissements",enabled:i.indexOf("arrondissements")!==-1},{title:"igo.geo.search.icherche.type.city",value:"municipalites",enabled:i.indexOf("municipalites")!==-1},{title:"igo.geo.search.icherche.type.mrc",value:"mrc",enabled:i.indexOf("mrc")!==-1},{title:"igo.geo.search.icherche.type.regadmin",value:"regadmin",enabled:i.indexOf("regadmin")!==-1},{title:"igo.geo.search.icherche.type.unites",value:"unites",enabled:i.indexOf("unites")!==-1},{title:"igo.geo.search.icherche.type.tours",value:"tours",enabled:i.indexOf("tours")!==-1},{title:"igo.geo.search.icherche.type.rss",value:"rss",enabled:i.indexOf("rss")!==-1},{title:"igo.geo.search.icherche.type.rls",value:"rls",enabled:i.indexOf("rls")!==-1},{title:"igo.geo.search.icherche.type.clsc",value:"clsc",enabled:i.indexOf("clsc")!==-1}]},{type:"radiobutton",title:"radius",name:"bufferInput",values:[{title:"100 m",value:100,enabled:!this.options.distance||this.options.distance===100},{title:"500 m",value:500,enabled:this.options.distance===500},{title:"1 km",value:1e3,enabled:this.options.distance===1e3},{title:"2 km",value:2e3,enabled:this.options.distance===2e3},{title:"5 km",value:5e3,enabled:this.options.distance===5e3}]}]}}reverseSearch(i,e){let n=this.computeRequestParams(i,e||{});return n.get("type").length?this.getReverseSearch(n):ai([])}getReverseSearch(i){return this.http.get(`${this.searchUrl}/locate`,{params:i}).pipe(Nt(e=>this.extractResults(e)))}getAllowedTypes(){return this.http.get(`${this.searchUrl}/types`).subscribe(i=>{let e=this.settings.find(n=>n.name==="type");e.values.forEach(n=>{n.available=i.indexOf(n.value)>-1}),this.setParamFromSetting(e,!1)})}computeRequestParams(i,e){return(e.distance||this.options.distance)&&(e.params=Object.assign(e.params||{},{bufferInput:e.distance||this.options.distance})),new fs({fromObject:Object.assign({loc:i.join(","),sort:"distance",geometry:!0,icon:!0},e.params||{},this.params)})}extractResults(i){return i.features.map(e=>this.dataToResult(e))}getSubtitle(i){if(!this.settings.length)return"";let e="";switch(i.properties.type){case"arrondissements":e=i.properties.municipalite+" (Arrondissement)";break;default:{let o=this.settings.find(s=>s.name==="type").values.find(s=>s.value===i.properties.type);o&&(e=this.languageService.translate.instant(o.title))}}return e}dataToResult(i){let e=this.computeProperties(i),n=this.computeExtent(i),o=[this.getId(),e.type,e.code].join("."),s=i.properties.nom,l=" <small> "+this.getSubtitle(i)+"</small>";return{source:this,data:{type:vr,projection:"EPSG:4326",geometry:i.geometry,extent:n,properties:e,meta:{id:o,title:i.properties.nom}},meta:{dataType:vr,id:o,title:i.properties.nom,titleHtml:s+l,icon:i.icon||"location_on",pointerSummaryTitle:this.getSubtitle(i)+": "+i.properties.nom}}}computeProperties(i){let e=rr.removeKeys(i.properties,r.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(e,n)}computeExtent(i){return i.bbox?[i.bbox[0],i.bbox[2],i.bbox[1],i.bbox[3]]:void 0}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"),pt(jd))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[fs]),Xr("design:returntype",$r)],G3.prototype,"getReverseSearch",null);function E3e(r){return new BC(r)}function gB(){return{provide:BC,useFactory:E3e,deps:[Di]}}function T3e(r,i,e,n,o,s){return new Pw(r,i,e,n.getConfig(`searchSources.${Pw.id}`),o,s)}function F3e(){return{provide:So,useFactory:T3e,multi:!0,deps:[Er,Di,Kr,Oi,BC,jd]}}function UYt(){return{kind:gf.ICherche,providers:[F3e(),gB()]}}var V3=(()=>{class r{languageService;constructor(e){this.languageService=e}formatResult(e){let n=["title","abstract","groupTitle","metadataUrl","downloadUrl","urlInfo","name"],o=Object.entries(e.properties).filter(([l])=>n.indexOf(l)!==-1).reduce((l,h)=>{let[p,m]=h,f;try{f=this.languageService.translate.instant("igo.geo.search.ilayer.properties."+p)}catch{f=p}return l[f]=m||"",l},{}),s=Object.assign({},e);return s.properties=o,s}static \u0275fac=function(n){return new(n||r)(pt(Di))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})(),j3=class r extends So{http;languageService;formatter;static id="ilayer";static type=b_;title$=new ut("");get title(){return this.title$.getValue()}constructor(i,e,n,o,s){super(o,n),this.http=i,this.languageService=e,this.formatter=s,this.languageService.language$.subscribe(()=>{this.title$.next(this.languageService.translate.instant(this.options.title))})}getId(){return r.id}getType(){return r.type}getDefaultOptions(){let i=this.options.params&&this.options.params.limit?Number(this.options.params.limit):void 0,e=this.options.params&&this.options.params.ecmax?Number(this.options.params.ecmax):void 0,n=this.options.showAdvancedSettings;return{title:"igo.geo.search.ilayer.name",searchUrl:"https://geoegl.msp.gouv.qc.ca/apis/layers/search",settings:[{type:"checkbox",title:"results type",name:"type",values:[{title:"igo.geo.search.ilayer.type.layer",value:"layer",enabled:!0,hashtags:["layer","layers","couche","couches"]},{title:"igo.geo.search.ilayer.type.groupLayer",value:"group",enabled:!1,hashtags:["gr-layer","gr-layers","gr-couche","gr-couches"]}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:i===1},{title:"5",value:5,enabled:i===5||!i},{title:"10",value:10,enabled:i===10},{title:"25",value:25,enabled:i===25},{title:"50",value:50,enabled:i===50}]},n&&{type:"radiobutton",title:"ecmax",name:"ecmax",values:[{title:"10 %",value:10,enabled:e===10},{title:"30 %",value:30,enabled:e===30},{title:"50 %",value:50,enabled:e===50||!e},{title:"75 %",value:75,enabled:e===75},{title:"100 %",value:100,enabled:e===100}]}].filter(Boolean)}}search(i,e){let n=this.computeSearchRequestParams(i,e||{});return!n.get("q")||!n.get("type")?ai([]):(this.options.params.page=n.get("page")||"1",this.getSearch(i,n))}getSearch(i,e){return this.http.get(this.searchUrl,{params:e}).pipe(Nt(n=>this.extractResults(n,i)))}computeSearchRequestParams(i,e){return new fs({fromObject:rr.removeUndefined(Object.assign({q:this.computeTerm(i)},this.params,this.computeOptionsParam(i,e||{}).params,{page:e.page}))})}computeTerm(i){return i.replace(/(#[^\s]*)/g,"").replace(/[^\w- !\-\(\),'#]+/g,"")}computeOptionsParam(i,e){let n=super.getHashtagsValid(i,"type");return n&&(e.params=Object.assign(e.params||{},{type:n.join(",")})),e}extractResults(i,e){return i.items.map(n=>this.dataToResult(n,e,i))}dataToResult(i,e,n){let o=this.computeLayerOptions(i),s=i.highlight.title||i.properties.title,l=i.highlight.groupTitle||i.properties.groupTitle,h=l?' <small style="color: #6f6969"> '+l+"</small>":"";return{source:this,meta:{dataType:b_,id:[this.getId(),i.properties.id].join("."),title:i.properties.title,titleHtml:s+h,icon:i.properties.type==="Layer"?"layers":"map",score:i.score||lh(e.trim(),i.properties.name),nextPage:n.items.length%+this.options.params.limit===0&&+this.options.params.page<10},data:o}}computeLayerOptions(i){let e=i.properties.url,n=this.extractQueryParamsFromSourceUrl(e);return rr.removeUndefined({sourceOptions:{id:i.properties.id,type:i.properties.format,url:e,queryFormat:n.queryFormat,queryHtmlTarget:n.queryHtmlTarget,params:i.properties.format==="wms"?{LAYERS:i.properties.name}:void 0,layer:i.properties.format==="wms"?void 0:i.properties.name,optionsFromCapabilities:!0,crossOrigin:"anonymous"},title:i.properties.title,maxResolution:Oa(Number(i.properties.maxScaleDenom)),minResolution:Oa(Number(i.properties.minScaleDenom)),metadata:{url:i.properties.metadataUrl,extern:i.properties.metadataUrl?!0:void 0,abstract:i.properties.abstract||void 0},properties:this.formatter.formatResult(i).properties})}extractQueryParamsFromSourceUrl(i){let e,n,o=this.options.queryFormat;if(o){for(let s of Object.keys(o)){let l=o[s];if(l==="*"){e=Ya[s.toUpperCase()];break}let h=l.urls;if(Array.isArray(h)){h.forEach(p=>{i.indexOf(p)!==-1&&(e=Ya[s.toUpperCase()])});break}}(e===Ya.HTML||e===Ya.HTMLGML2)&&(n="iframe")}return{queryFormat:e,queryHtmlTarget:n}}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"),pt(V3))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[String,fs]),Xr("design:returntype",$r)],j3.prototype,"getSearch",null);function P3e(r){return new V3(r)}function Ote(){return{provide:V3,useFactory:P3e,deps:[Di]}}var EZt=[L3,Tw,...Pte,Fw,Lte],L3e=(()=>{class r{static forRoot(){return{ngModule:r,providers:[ch,R3(),gB(),kte(),Ote()]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[lB,dB,uB,hB,lB,dB,uB,hB]})}return r})();var LZt=new Ln("styleListOptions");function k3e(r,i){if(r&1){let e=We();Dr(0),$(1,"span")(2,"mat-icon",6),_e(3,"format_color_fill"),ee(),_e(4),le(5,"translate"),ee(),$(6,"igo-color-picker-form-field",11),ve("colorChange",function(o){we(e);let s=ne();return xe(s.setLayerFillColor(o))}),ee(),Rr()}r&2&&(j(4),Qe(" ",ce(5,1,"igo.geo.style.fill")," "))}var _B=(()=>{class r{dialogRef;formBuilder;data;confirmFlag=!1;form;styleModalData;linestringOnly;initialValues;defaultValues={fillColor:"rgba(255,255,255,0.4)",strokeColor:"rgba(143,7,7,1)"};get layerOlStyle(){let e=this.data.layer.ol.getStyle();return e instanceof Function?void 0:e.clone()}constructor(e,n,o){this.dialogRef=e,this.formBuilder=n,this.data=o}ngOnInit(){this.linestringOnly=!0;for(let e of this.data.layer.ol.getSource().getFeatures())e.getGeometry()?.getType()!=="LineString"&&(this.linestringOnly=!1);this.buildStyleData(),this.buildForm()}buildForm(){this.form=this.formBuilder.group({fill:[this.getLayerFillColor()],stroke:[this.getLayerStrokeColor()]})}buildStyleData(){this.styleModalData={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()},this.initialValues={fillColor:this.getLayerFillColor(),strokeColor:this.getLayerStrokeColor()}}getLayerFillColor(){let e=this.defaultValues.fillColor,n=this.layerOlStyle;if(n?.getFill()?.getColor()){let o=n.getFill().getColor();e=`rgba(${o[0]},${o[1]},${o[2]},${o[3]||.4})`}return e}getLayerStrokeColor(){let e=this.defaultValues.strokeColor,n=this.layerOlStyle;if(n?.getStroke()?.getColor()){let o=n.getStroke().getColor();e=`rgba(${o[0]},${o[1]},${o[2]},${o[3]||1})`}return e}setLayerFillColor(e){let n=Ra(e),o=this.layerOlStyle.clone();o.getImage().getFill().setColor(n),o.getFill().setColor(n),this.data.layer.ol.setStyle(o),this.styleModalData.fillColor=e}setLayerStrokeColor(e){let n=Ra(e),o=this.layerOlStyle.clone();o.getImage().getStroke().setColor(n),o.getStroke().setColor(n),this.data.layer.ol.setStyle(o),this.styleModalData.strokeColor=e}cancel(){this.dialogRef.close(),this.setLayerFillColor(this.initialValues.fillColor),this.setLayerStrokeColor(this.initialValues.strokeColor)}confirm(){this.confirmFlag=!0,this.form.get("fill").value&&(this.styleModalData.fillColor=this.form.get("fill").value),this.form.get("stroke").value&&(this.styleModalData.strokeColor=this.form.get("stroke").value),this.dialogRef.close(this.styleModalData)}openPicker(){this.dialogRef.disableClose=!0}closePicker(){this.dialogRef.disableClose=!1}static \u0275fac=function(n){return new(n||r)(Ie(Hc),Ie($c),Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-style-modal-layer"]],inputs:{confirmFlag:"confirmFlag"},standalone:!0,features:[lt],decls:20,vars:11,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"edit-colorpicker"],[1,"igo-form",3,"formGroup"],[1,"color-picker"],[4,"ngIf"],[1,"stroke-palette-icon"],["formControlName","stroke",3,"colorChange"],["mat-dialog-actions",""],["mat-raised-button","",3,"click"],["mat-raised-button","","color","primary",3,"click"],["formControlName","fill",3,"colorChange"]],template:function(n,o){n&1&&($(0,"h2",0),_e(1),le(2,"translate"),ee(),$(3,"div",1)(4,"div",2)(5,"form",3)(6,"div",4),Pe(7,k3e,7,3,"ng-container",5),$(8,"span")(9,"mat-icon",6),_e(10,"border_color"),ee(),_e(11),le(12,"translate"),ee(),$(13,"igo-color-picker-form-field",7),ve("colorChange",function(l){return o.setLayerStrokeColor(l)}),ee()()()()(),$(14,"div",8)(15,"button",9),ve("click",function(){return o.cancel()}),_e(16),le(17,"translate"),ee(),$(18,"button",10),ve("click",function(){return o.confirm()}),_e(19,"OK"),ee()()),n&2&&(j(),Qe(" ",ce(2,5,"igo.geo.style.styleModal"),`
`),j(4),z("formGroup",o.form),j(2),z("ngIf",o.linestringOnly!==!0),j(4),Qe(" ",ce(12,7,"igo.geo.style.stroke")," "),j(5),Qe(" ",ce(17,9,"igo.geo.style.cancel")," "))},dependencies:[id,pl,Sn,Xu,kn,Zu,Sa,Ku,Qu,Gt,jt,$t,IC,Zc,Vt,co,Et,Tt],styles:[`h2[_ngcontent-%COMP%]{font-weight:700;font-size:large}.igo-form[_ngcontent-%COMP%]{padding:10px}.color-picker[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;grid-gap:16px;margin-bottom:16px}.color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}.color-picker[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.edit-colorpicker[_ngcontent-%COMP%]{padding:10px 0}button[_ngcontent-%COMP%]{margin-right:5px}
/*# sourceMappingURL=style-modal-layer.component-ZHGSFTNM.css.map */`]})}return r})();var O3e=(()=>{class r{dialog;layer;constructor(e){this.dialog=e}openStyleModalDialog(){setTimeout(()=>{let e={layer:this.layer};this.dialog.open(_B,{disableClose:!1,data:e,autoFocus:!1})},250)}static \u0275fac=function(n){return new(n||r)(Ie(Yc))};static \u0275cmp=nt({type:r,selectors:[["igo-style-modal-layer-button"]],inputs:{layer:"layer"},standalone:!0,features:[lt],decls:4,vars:3,consts:[["mat-icon-button","","color","primary",3,"click","matTooltip"],[1,"style-icon"]],template:function(n,o){n&1&&($(0,"button",0),le(1,"translate"),ve("click",function(){return o.openStyleModalDialog()}),$(2,"mat-icon",1),_e(3,"palette "),ee()()),n&2&&z("matTooltip",ce(1,1,"igo.geo.style.styleModalTooltipLayer"))},dependencies:[Vt,ci,Qt,ti,jt,$t,Et,Tt],changeDetection:0})}return r})();var D3e=["flexibleMain"],R3e=["*",[["","igoFlexibleFill",""]]],N3e=["*","[igoFlexibleFill]"],B3e=(()=>{class r{el;mediaService;cdr;static transitionTime=250;main;get initial(){return this._initial}set initial(e){this._initial=e}_initial="0";get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}_collapsed="0";get expanded(){return this._expanded}set expanded(e){this._expanded=e}_expanded="100%";get initialMobile(){return this._initialMobile}set initialMobile(e){this._initialMobile=e}_initialMobile=this.expanded;get collapsedMobile(){return this._collapsedMobile}set collapsedMobile(e){this._collapsedMobile=e}_collapsedMobile=this.collapsed;get expandedMobile(){return this._expandedMobile}set expandedMobile(e){this._expandedMobile=e}_expandedMobile=this.expanded;get direction(){return this._direction}set direction(e){this._direction=e}_direction="column";get state(){return this._state}set state(e){let n={initial:this.initial,collapsed:this.collapsed,expanded:this.expanded};this.mediaService.isMobile()&&Object.assign(n,{initial:this.initialMobile,collapsed:this.collapsedMobile,expanded:this.expandedMobile});let o=n[e];o!==void 0&&(this.setSize(o),setTimeout(()=>{this._state=e},r.transitionTime))}_state="initial";mediaService$$;constructor(e,n,o){this.el=e,this.mediaService=n,this.cdr=o}ngOnInit(){this.el.nativeElement.className+=this.direction,this.mediaService$$=this.mediaService.media$.subscribe(()=>this.cdr.markForCheck())}ngOnDestroy(){this.mediaService$$&&this.mediaService$$.unsubscribe()}setSize(e){this._state="transition",this.direction==="column"?this.main.nativeElement.style.height=e:this.direction==="row"&&(this.main.nativeElement.style.width=e)}static \u0275fac=function(n){return new(n||r)(Ie(ar),Ie(Wc),Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-flexible"]],viewQuery:function(n,o){if(n&1&&Ir(D3e,7),n&2){let s;bi(s=wi())&&(o.main=s.first)}},inputs:{initial:"initial",collapsed:"collapsed",expanded:"expanded",initialMobile:"initialMobile",collapsedMobile:"collapsedMobile",expandedMobile:"expandedMobile",direction:"direction",state:"state"},standalone:!0,features:[lt],ngContentSelectors:N3e,decls:8,vars:4,consts:[["flexibleMain",""],[1,"igo-container"],[1,"igo-flexible-fill"]],template:function(n,o){n&1&&(Kn(R3e),$(0,"div",null,0)(2,"div",1),Tn(3),ee()(),$(4,"div",2)(5,"div")(6,"div",1),Tn(7,1),ee()()()),n&2&&A7("igo-flexible-main ",o.state," ",o.direction,"")},styles:[`[_nghost-%COMP%]{display:flex;height:100%;width:100%}.column[_nghost-%COMP%]{flex-direction:column}.row[_nghost-%COMP%]{flex-direction:row}[_nghost-%COMP%]   .igo-flexible-main[_ngcontent-%COMP%]{flex:0 0 auto;overflow:hidden}[_nghost-%COMP%]   .igo-flexible-main.column[_ngcontent-%COMP%]{transition:height .25s ease-in}[_nghost-%COMP%]   .igo-flexible-main.row[_ngcontent-%COMP%]{transition:width .25s ease-in}[_nghost-%COMP%]   .igo-flexible-fill[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;inset:0}[_nghost-%COMP%]   .igo-container[_ngcontent-%COMP%]{height:100%;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-flexible-fill{flex:1 1 auto;overflow:hidden;position:relative}[_nghost-%COMP%]     .igo-content{height:100%;width:100%;overflow:auto}[_nghost-%COMP%]     igo-panel{height:100%}
/*# sourceMappingURL=flexible.component-DO5JIBBX.css.map */`]})}return r})();var U3=(()=>{class r{cdRef;layer;map;complete=new Ke;cancel=new Ke;constructor(e){this.cdRef=e}onUpdateInputs(){this.cdRef.detectChanges()}onClose(){this.cancel.emit()}static \u0275fac=function(n){return new(n||r)(Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-ogc-filter"]],inputs:{layer:"layer",map:"map"},outputs:{complete:"complete",cancel:"cancel"},standalone:!0,features:[lt],decls:1,vars:3,consts:[["igoListItem","",3,"layer","header","map"]],template:function(n,o){n&1&&ct(0,"igo-ogc-filterable-item",0),n&2&&z("layer",o.layer)("header",!1)("map",o.map)},dependencies:[c1],changeDetection:0})}return r})();var yB=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[U3]})}return r})();var G3e=new Ln("OgcFilterWidget");function j3e(r){return r.create(U3)}function Dte(){return{provide:G3e,useFactory:j3e,deps:[o9]}}var Rte=class extends Lh{activeWorkspace$=new ut(void 0);activateWorkspace(i){let e=this.activeWorkspace$.value;e!==void 0&&e.deactivate(),this.deactivateWorkspace(),i!==void 0&&(this.state.update(i,{active:!0,selected:!0},!0),this.activeWorkspace$.next(i),i.activate())}deactivateWorkspace(){let i=this.activeWorkspace$.value;i!==void 0&&(i.deactivate(),this.activeWorkspace$.next(void 0))}};var P_=class{options;widget$=new ut(void 0);widgetInputs$=new ut({});widgetSubscribers$=new ut({});entities$$;change=new Si;change$;get id(){return this.options.id}get title(){return this.options.title}get meta(){return this.options.meta||{}}get entityStore(){return this.options.entityStore}get actionStore(){return this.options.actionStore}get widget(){return this.widget$.value}get hasWidget(){return this.widget!==void 0}constructor(i){this.options=i}get active(){return this.active$.value}active$=new ut(!1);activate(){this.active===!0&&this.deactivate(),this.active$.next(!0),this.entityStore!==void 0&&(this.entities$$=this.entityStore.stateView.all$().subscribe(()=>this.onStateChange())),this.change.next()}deactivate(){this.active$.next(!1),this.deactivateWidget(),this.entities$$!==void 0&&this.entities$$.unsubscribe(),this.change$!==void 0&&this.change$.unsubscribe()}activateWidget(i,e={},n={}){this.widget$.next(i),this.widgetInputs$.next(e),this.widgetSubscribers$.next(n),this.change.next()}deactivateWidget(){this.widget$.next(void 0),this.change.next()}onStateChange(){this.change.next()}};var z3=(()=>{class r{store;disabled;selectedChange=new Ke;getWorkspaceTitle(e){return ed(e)}onSelectedChange(e){let n=e.value;this.store.activateWorkspace(n),this.selectedChange.emit({selected:!0,value:n})}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-workspace-selector"]],inputs:{store:"store",disabled:"disabled"},outputs:{selectedChange:"selectedChange"},standalone:!0,features:[lt],decls:1,vars:4,consts:[[3,"selectedChange","store","multi","titleAccessor","disabled"]],template:function(n,o){n&1&&($(0,"igo-entity-selector",0),ve("selectedChange",function(l){return o.onSelectedChange(l)}),ee()),n&2&&z("store",o.store)("multi",!1)("titleAccessor",o.getWorkspaceTitle)("disabled",o.disabled)},dependencies:[OG],changeDetection:0})}return r})();function V3e(r,i){if(r&1){let e=We();Dr(0),$(1,"igo-widget-outlet",1),le(2,"async"),le(3,"async"),ve("cancel",function(){let o=we(e).ngIf,s=ne();return xe(s.onWidgetCancel(o))})("complete",function(){let o=we(e).ngIf,s=ne();return xe(s.onWidgetComplete(o))}),ee(),Rr()}if(r&2){let e=i.ngIf,n=ne();j(),z("widget",e)("inputs",ce(2,3,n.widgetInputs$))("subscribers",ce(3,5,n.widgetSubscribers$))}}var U3e=(()=>{class r{workspace;deactivateWidget=new Ke;get widget$(){return this.workspace.widget$}get widgetInputs$(){return this.workspace.widgetInputs$}get widgetSubscribers$(){return this.workspace.widgetSubscribers$}onWidgetCancel(e){this.workspace.deactivateWidget(),this.deactivateWidget.emit(e)}onWidgetComplete(e){this.workspace.deactivateWidget(),this.deactivateWidget.emit(e)}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-workspace-widget-outlet"]],inputs:{workspace:"workspace"},outputs:{deactivateWidget:"deactivateWidget"},standalone:!0,features:[lt],decls:2,vars:3,consts:[[4,"ngIf"],[3,"cancel","complete","widget","inputs","subscribers"]],template:function(n,o){n&1&&(Pe(0,V3e,4,7,"ng-container",0),le(1,"async")),n&2&&z("ngIf",ce(1,1,o.widget$))},dependencies:[Gt,a9,Ei],styles:[`igo-widget-outlet[_ngcontent-%COMP%]{height:100%}
/*# sourceMappingURL=workspace-widget-outlet.component-NZQGDUCA.css.map */`],changeDetection:0})}return r})();var vB=(()=>{class r{dialogRef;languageService;data;constructor(e,n,o){this.dialogRef=e,this.languageService=n,this.data=o}cancelAction(){this.data.cancel=!0,this.dialogRef.close(this.data.cancel)}confirmedAction(){this.data.cancel=!1,this.dialogRef.close(this.data.cancel)}static \u0275fac=function(n){return new(n||r)(Ie(Hc),Ie(Di),Ie(qc))};static \u0275cmp=nt({type:r,selectors:[["igo-confirmation-popup-component"]],standalone:!0,features:[lt],decls:8,vars:2,consts:[["mat-dialog-content",""],[1,"mat-typography"],["mat-dialog-actions",""],["mat-raised-button","","color","primary",3,"click"],["mat-raised-button","",3,"click"]],template:function(n,o){n&1&&($(0,"div",0)(1,"p",1),_e(2),ee()(),$(3,"div",2)(4,"button",3),ve("click",function(){return o.confirmedAction()}),_e(5," Ok "),ee(),$(6,"button",4),ve("click",function(){return o.cancelAction()}),_e(7),ee()()),n&2&&(j(2),Qe(" ",o.data.type==="add"?o.languageService.translate.instant("igo.geo.workspace.addConfirmation"):o.languageService.translate.instant("igo.geo.workspace.deleteConfirmation")," "),j(5),Qe(" ",o.languageService.translate.instant("igo.geo.workspace.cancel")," "))},dependencies:[pl,Zc,Vt,co],styles:[`div.mat-mdc-dialog-actions[_ngcontent-%COMP%]{justify-content:center}
/*# sourceMappingURL=confirmation-popup.component-QGTWMYKD.css.map */`]})}return r})();var $3=class extends P_{dialog;configService;adding$;getDomainValues;options;inResolutionRange$=new ut(!0);get layer(){return this.options.layer}get map(){return this.options.map}drawControl;drawEnd$$;olDrawingLayerSource=new $a;olDrawingLayer;geometryType=po;modify;modifyStyle=new oi({stroke:new ui({color:"rgba(255,255,255,1)",width:1}),fill:new hi({color:"rgba(0,161,222,1)"}),image:new an({radius:7,stroke:new ui({color:"rgba(255,255,255,1)",width:1}),fill:new hi({color:"rgba(0,161,222,1)"})})});newFeaturefilterClauseFunc=i=>i.state.newFeature===!0;editFeaturefilterClauseFunc=i=>i.state.edit===!0;fillColor;strokeColor;strokeWidth;constructor(i,e,n,o,s){super(s),this.dialog=i,this.configService=e,this.adding$=n,this.getDomainValues=o,this.options=s,this.map.viewController.resolution$.subscribe(l=>{l>this.layer.minResolution&&l<this.layer.maxResolution?this.inResolutionRange$.next(!0):this.inResolutionRange$.next(!1)}),this.drawControl=this.createDrawControl(),this.drawControl.setGeometryType(this.geometryType.Point),this.olDrawingLayer&&this.map.layerController.remove(this.olDrawingLayer),this.olDrawingLayer=new Fr({id:"igo-draw-layer",title:"edition",zIndex:300,source:new kr,showInLayerList:!1,exportable:!1,browsable:!1,workspace:{enabled:!1}})}deleteFeature(i,e){setTimeout(()=>{this.dialog.open(vB,{disableClose:!1,data:{type:"delete"}}).afterClosed().subscribe(o=>{if(o===!1){let s,l,h=e.layer.dataSource.options.edition.baseUrl,p=e.layer.dataSource.options.edition.deleteUrl;h.length?l=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+h+"?"+p:h+"?"+p:l=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+p:p;for(let m of e.meta.tableTemplate.columns)for(let f in i.properties){let g=m.name;g.includes("properties.")&&(g=g.split(".")[1]),g===f&&m.primary===!0&&(s=i.properties[f])}l&&(l+=s,this.deleteFeature(e,l))}})},250)}editFeature(i,e){i.edition=!0;let n,o=!1,s=e.layer.dataSource.options.edition;for(let l of e.meta.tableTemplate.columns)if((l.type==="list"||l.type==="autocomplete")&&this.getDomainValues(l.relation).subscribe(h=>{l.domainValues=h}),o===!1)for(let h in i.properties){let p=l.name;if(p.includes("properties.")&&(p=p.split(".")[1]),p===h&&l.primary===!0){n=i.properties[h],o=!0;break}}if(n)i.original_properties=JSON.parse(JSON.stringify(i.properties)),i.original_geometry=i.geometry,i.idkey=n,e.entityStore.state.updateAll({edit:!1}),e.entityStore.stateView.filter(this.editFeaturefilterClauseFunc),this.addFeatureToStore(i,e);else if(!i.newFeature&&s.geomType)if(i.newFeature=!0,this.adding$.next(!0),e.entityStore.state.updateAll({newFeature:!1}),e.entityStore.stateView.filter(this.newFeaturefilterClauseFunc),s.addWithDraw){let l=s.geomType;this.onGeometryTypeChange(l,i,e)}else e.entityStore.insert(i),e.entityStore.state.update(i,{newFeature:!0},!0)}createDrawControl(i,e,n){return new op({geometryType:void 0,drawingLayerSource:this.olDrawingLayerSource,drawingLayerStyle:new oi({}),interactionStyle:bC(i,e,n)})}onGeometryTypeChange(i,e,n){this.drawControl.setGeometryType(i),this.toggleDrawControl(e,n)}toggleDrawControl(i,e){this.deactivateDrawControl(),this.activateDrawControl(i,e)}deactivateDrawControl(){this.drawControl&&(this.drawEnd$$&&this.drawEnd$$.unsubscribe(),this.drawControl.setOlMap(void 0))}activateDrawControl(i,e){this.drawEnd$$=this.drawControl.end$.subscribe(n=>{this.addFeatureToStore(i,e,n)}),this.drawControl.setOlMap(this.map.ol,!0)}addFeatureToStore(i,e,n){let o=this.map.ol.getView().getProjection(),s=i.geometry;n?(e.entityStore.insert(i),e.entityStore.state.update(i,{newFeature:!0},!0),s=new Qr().writeGeometryObject(n,{featureProjection:o,dataProjection:"EPSG:4326"}),i.geometry=s):e.entityStore.state.update(i,{edit:!0},!0),i.projection="EPSG:4326";let l=ku(i,o.getCode());this.olDrawingLayer.dataSource.ol.clear(),this.olDrawingLayer.dataSource.ol.addFeature(l),this.map.layerController.add(this.olDrawingLayer),this.deactivateDrawControl(),this.createModifyInteraction(l,i,e)}deleteDrawings(){this.map.layerController.remove(this.olDrawingLayer),this.olDrawingLayerSource.clear(),this.map.ol.removeInteraction(this.modify)}createModifyInteraction(i,e,n){this.map.ol.removeInteraction(this.modify);let o=new Ua([i],{unique:!0});this.modify=new Db({features:o}),this.map.ol.addInteraction(this.modify),o.forEach(s=>{s.setStyle(this.modifyStyle)}),this.modify.on("modifyend",s=>{let l=s.features.getArray()[0]?.getGeometry();l&&this.addFeatureToStore(e,n,l)})}};function mQt(r){return r.entityStore.getStrategyOfType(Mx).active$.pipe(Nt(i=>i?"igo.geo.workspace.inMapExtent.active.tooltip":"igo.geo.workspace.inMapExtent.inactive.tooltip"))}function fQt(r){return r.entityStore.stateView.manyBy$(i=>i.state.selected===!0).pipe(Nt(i=>i.length>=1))}function Nte(r,i,e,n,o,s){let l=rr.removeUndefined({sourceOptions:{type:n,url:e,optionsFromCapabilities:!0,optionsFromApi:!0,params:{LAYERS:n==="wms"?o:void 0,LAYER:n==="wms"?void 0:o}}});if(r==="add")s.createAsyncLayer(l).subscribe(h=>{h&&(i.layersAddedByClick$.next([h]),i.layerController.add(h))});else if(r==="remove"){let h=Ep(l.sourceOptions);i.layerController.remove(i.layerController.all.find(p=>p.id===h))}}function $3e(r,i){return[{name:"geoServiceAction",title:void 0,tooltip:"",renderer:xu.ButtonGroup,valueAccessor:(n,o)=>{let s=o.state.geoService;return s&&s.haveGeoServiceProperties&&s.url&&s.layerName?s.added?[{icon:"delete",color:"warn",click:(l,h)=>{Nte("remove",r.map,h.state.geoService.url,h.state.geoService.type,h.state.geoService.layerName,i),s.added=!1}}]:[{icon:"add",color:"primary",click:(l,h)=>{Nte("add",r.map,h.state.geoService.url,h.state.geoService.type,h.state.geoService.layerName,i),s.added=!0}}]:[]}}]}function Lw(r,i,e,n){let o=$3e(r,e),s=i.dataSource.options.sourceFields||[],l=i.dataSource.options.relations||[];if(s.length===0){r.entityStore.entities$.pipe(Ch(m=>m.length===0),Ol(1)).subscribe(m=>{let f=m[0].ol,g=f.getKeys().filter(y=>!y.startsWith("_")&&y!=="geometry"&&y!==f.getGeometryName()&&!y.match(/boundedby/gi)).map(y=>({name:`properties.${y}`,title:y,renderer:xu.UnsanitizedHTML}));g.unshift(...o),r.meta.tableTemplate={selection:!0,sort:!0,columns:g,tableHeight:"100%"}});return}let h=s.map(m=>({name:`properties.${m.name}`,title:m.alias?m.alias:m.name,renderer:xu.UnsanitizedHTML,tooltip:m.tooltip,visible:m.visible,cellClassFunc:()=>{let f={};if(m.type)return f[`class_${m.type}`]=!0,f}})),p=l.map(m=>({name:`properties.${m.name}`,title:m.alias?m.alias:m.name,renderer:xu.Icon,icon:m.icon,parent:m.parent,type:"relation",tooltip:m.tooltip,onClick:()=>{n.next(m.title)},cellClassFunc:()=>({class_icon:!0})}));h.push(...p),h.unshift(...o),r.meta.tableTemplate={selection:!0,sort:!0,columns:h,tableHeight:"100%"}}function L_(){let r=i=>i.state.inMapExtent===!0&&i.state.inMapResolution===!0;return new Mx({filterClauseFunc:r})}var bB=(()=>{class r{layerService;storageService;configService;messageService;http;dialog;styleService;authInterceptor;ws$=new ut(void 0);adding$=new ut(!1);relationLayers$=new ut(void 0);rowsInMapExtentCheckCondition$=new ut(!0);loading=!1;wktFormat=new _d;geoJsonFormat=new Qr;get zoomAuto(){return this.storageService.get("zoomAuto")}constructor(e,n,o,s,l,h,p,m){this.layerService=e,this.storageService=n,this.configService=o,this.messageService=s,this.http=l,this.dialog=h,this.styleService=p,this.authInterceptor=m}createWorkspace(e,n){if(e.options.workspace?.enabled!==!0||e.dataSource.options.edition.enabled!==!0)return;let o;e.options.workspace?o=e.options.workspace:o={},o.srcId=e.id,o.workspaceId=e.id,o.enabled=!0,o.pageSize=e.options.workspace?.pageSize,o.pageSizeOptions=e.options.workspace?.pageSizeOptions;let s=e.dataSource,l=e.id+".WmsWorkspaceTableSrc",h=e.id+".WfsWorkspaceTableDest";e.options.linkedLayers||(e.options.linkedLayers={linkId:l,links:[]});let p={syncedDelete:!0,linkedIds:[h],properties:[_n.ZINDEX,_n.VISIBLE]};e.options.workspace?.minResolution||p.properties.push(_n.MINRESOLUTION);let m=!1;s.options.ogcFilters?.enabled&&(p.properties.push(_n.OGCFILTERS),m=!0),e.options.workspace?.maxResolution||p.properties.push(_n.MAXRESOLUTION);let f=[];e.options.linkedLayers.links&&(f=JSON.parse(JSON.stringify(e.options.linkedLayers.links))),f.push(p),e.options.linkedLayers.linkId=e.options.linkedLayers.linkId?e.options.linkedLayers.linkId:l,e.options.linkedLayers.links=f,e.createLink();let g;return this.layerService.createAsyncLayer({title:e.title,parentId:e.options.parentId,visible:e.visible,id:h,linkedLayers:{linkId:h},workspace:{srcId:e.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:e.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:!1},pageSize:e.options.workspace?.pageSize,pageSizeOptions:e.options.workspace?.pageSizeOptions},showInLayerList:!1,isIgoInternalLayer:!0,opacity:0,minResolution:e.options.workspace?.minResolution||e.minResolution||0,maxResolution:e.options.workspace?.maxResolution||e.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:s.options.download,type:"wfs",url:s.options.urlWfs||s.options.url,queryable:!0,relations:s.options.relations,queryTitle:s.options.queryTitle,params:s.options.paramsWFS,ogcFilters:Object.assign({},s.ogcFilters,{enabled:m}),sourceFields:s.options.sourceFields||void 0,edition:s.options.edition}}).subscribe(y=>(n.layerController.add(y),e.ol.setProperties({linkedLayers:{linkId:e.options.linkedLayers.linkId,links:f}},!1),y.dataSource.ol.refresh(),g=new $3(this.dialog,this.configService,this.adding$,_=>this.getDomainValues(_),{id:e.id,title:e.title,layer:y,map:n,entityStore:this.createFeatureStore(y,n),actionStore:new h0([]),meta:{tableTemplate:void 0}}),this.createTableTemplate(g,y),y.options.workspace.workspaceId=y.id,e.options.workspace=Object.assign({},e.options.workspace,{wksConfig:o}),delete s.options.download,g)),g}createFeatureStore(e,n){let o=new is([],{map:n});o.bindLayer(e);let s=new mf({}),l=new ph({}),h=new pf({}),p=new _m({}),m=new rs({layer:new Fr({zIndex:300,source:new kr,style:void 0,showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Yi.Default:Yi.None,many:!0,dragBox:!0});return o.addStrategy(s,!0),o.addStrategy(l,!0),o.addStrategy(h,!0),o.addStrategy(m,!0),o.addStrategy(p,!1),o.addStrategy(L_(),!0),o}createTableTemplate(e,n){let o=n.dataSource.options.sourceFields||[],s=n.dataSource.options.relations||[],l=xu.UnsanitizedHTML,h=[],p=[],m=[];if(h=[{name:"edition",title:void 0,renderer:xu.ButtonGroup,primary:!1,valueAccessor:()=>[{editMode:!1,icon:"edit",color:"primary",disabled:n.dataSource.options.edition.modifyButton===!1,click:f=>{e.editFeature(f,e)}},{editMode:!1,icon:"delete",color:"warn",disabled:n.dataSource.options.edition.deleteButton===!1,click:f=>{e.deleteFeature(f,e)}},{editMode:!0,icon:"check",color:"primary",disabled:this.loading,click:f=>{this.saveFeature(f,e)}},{editMode:!0,icon:"close",color:"primary",disabled:this.loading,click:f=>{this.cancelEdit(e,f)}}]}],o.length===0){e.entityStore.entities$.pipe(Ch(f=>f.length===0),Ol(1)).subscribe(f=>{let g=f[0].ol,y=g.getKeys().filter(_=>!_.startsWith("_")&&_!=="geometry"&&_!==g.getGeometryName()&&!_.match(/boundedby/gi)).map(_=>({name:`properties.${_}`,title:_,renderer:l}));e.meta.tableTemplate={selection:!1,sort:!0,columns:y}});return}p=o.map(f=>{let g={name:`properties.${f.name}`,title:f.alias?f.alias:f.name,renderer:l,valueAccessor:void 0,cellClassFunc:()=>{let y={};if(f.type)return y[`class_${f.type}`]=!0,y},primary:f.primary===!0,visible:f.visible,validation:f.validation,linkColumnForce:f.linkColumnForce,type:f.type,domainValues:void 0,relation:void 0,multiple:f.multiple,step:f.step,tooltip:f.tooltip};return(f.type==="list"||f.type==="autocomplete")&&this.getDomainValues(f.relation).subscribe(y=>{g.domainValues=y,g.relation=f.relation}),g}),m=s.map(f=>({name:`properties.${f.name}`,title:f.alias?f.alias:f.name,renderer:xu.Icon,icon:f.icon,parent:f.parent,type:"relation",tooltip:f.tooltip,onClick:()=>{this.adding$.getValue()===!1&&this.ws$.next(f.title)},cellClassFunc:()=>({class_icon:!0})})),p.push(...m),p.push(...h),e.meta.tableTemplate={selection:!1,sort:!0,columns:p}}saveFeature(e,n){if(!this.validateFeature(e,n))return!1;this.sanitizeParameter(e,n);let o=n.layer.dataSource.options.edition.baseUrl,s=this.configService.getConfig("edition.url");if(s?s+=o||"":s=o,e.newFeature){s+=n.layer.dataSource.options.edition.addUrl;let l=n.layer.dataSource.options.edition.addHeaders,h=new vx(l);this.addFeature(e,n,s,h)}else{n.layer.dataSource.options.edition.modifyProtocol!=="post"?s+="?"+n.layer.dataSource.options.edition.modifyUrl+e.idkey:s+=n.layer.dataSource.options.edition.modifyUrl;let l=n.layer.dataSource.options.edition.modifyProtocol,h=n.layer.dataSource.options.edition.modifyHeaders,p=new vx(h);this.modifyFeature(e,n,s,p,l)}}addFeature(e,n,o,s){if(n.layer.dataSource.options.edition.hasGeometry){let l=n.layer.options.sourceOptions.edition.geomDatabaseProj;e.properties[n.layer.dataSource.options.params.fieldNameGeometry]="SRID="+l.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(e.geometry).getGeometry().transform("EPSG:4326",l),{dataProjection:l})}for(let l in e.properties)for(let h of n.layer.dataSource.options.sourceFields)(h.name===l&&h.validation?.readonly||h.name===l&&h.validation?.send===!1)&&delete e.properties[l];this.loading=!0,this.http.post(`${o}`,e.properties,{headers:s}).subscribe(()=>{this.loading=!1,n.entityStore.stateView.clear(),n.deleteDrawings(),n.entityStore.delete(e),this.messageService.success("igo.geo.workspace.addSuccess"),this.refreshMap(n.layer,n.layer.map),this.adding$.next(!1),this.rowsInMapExtentCheckCondition$.next(!0)},l=>{this.loading=!1,l.error.caught=!0;let h=n.layer.dataSource.options.edition.messages;if(h){let p;h.forEach(m=>{let f=Object.keys(m)[0];l.error.message.includes(f)&&(p=m[f],this.messageService.error(p))}),p||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}deleteFeature(e,n){this.loading=!0,this.http.delete(`${n}`,{}).subscribe(()=>{this.loading=!1,this.messageService.success("igo.geo.workspace.deleteSuccess"),this.refreshMap(e.layer,e.layer.map);let o=e.layer.options.sourceOptions?.relations??[];for(let s of o)e.map.layerController.all.find(h=>jn(h)&&h.title===s.title)?.dataSource.ol.refresh()},o=>{this.loading=!1,o.error.caught=!0;let s=e.layer.dataSource.options.edition.messages;if(s){let l;s.forEach(h=>{let p=Object.keys(h)[0];o.error.message.includes(p)&&(l=h[p],this.messageService.error(l))}),l||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}modifyFeature(e,n,o,s,l="patch"){if(n.layer.dataSource.options.edition.hasGeometry){let h=n.layer.options.sourceOptions.edition.geomDatabaseProj;e.geometry.coordinates=Bte(e.geometry.coordinates),e.properties[n.layer.dataSource.options.params.fieldNameGeometry]="SRID="+h.replace("EPSG:","")+";"+this.wktFormat.writeGeometry(this.geoJsonFormat.readFeature(e.geometry).getGeometry().transform("EPSG:4326",h),{dataProjection:h})}for(let h in e.properties)for(let p of n.layer.dataSource.options.sourceFields)(p.name===h&&p.validation?.readonly||p.name===h&&p.validation?.send===!1||h==="boundedBy")&&delete e.properties[h];this.loading=!0,this.http[l](`${o}`,e.properties,{headers:s}).subscribe(()=>{this.loading=!1,this.cancelEdit(n,e,!0),this.messageService.success("igo.geo.workspace.modifySuccess"),this.refreshMap(n.layer,n.layer.map);let h=[];n.layer.options.sourceOptions.relations?.forEach(p=>{n.map.layerController.all.forEach(m=>{jn(m)&&m.title===p.title&&(h.push(m),m.dataSource.ol.refresh())})}),this.relationLayers$.next(h)},h=>{this.loading=!1,h.error.caught=!0;let p=n.layer.dataSource.options.edition.messages;if(p){let m;p.forEach(f=>{let g=Object.keys(f)[0];h.error.message.includes(g)&&(m=f[g],this.messageService.error(m))}),m||this.messageService.error("igo.geo.workspace.addError")}else this.messageService.error("igo.geo.workspace.addError")})}cancelEdit(e,n,o=!1){n.edition=!1,this.adding$.next(!1),e.deleteDrawings(),e.entityStore.stateView.clear(),n.newFeature?(e.entityStore.delete(n),e.deactivateDrawControl(),this.rowsInMapExtentCheckCondition$.next(!0)):(o||(n.properties=n.original_properties,n.geometry=n.original_geometry),delete n.original_properties,delete n.original_geometry)}getDomainValues(e){let n=e.url;return n||(n=this.configService.getConfig("edition.url")?this.configService.getConfig("edition.url")+e.table:e.table),this.http.get(n).pipe(Nt(o=>o),qr(o=>(o.error.caught=!0,A1(o))))}refreshMap(e,n){let o=e.dataSource.ol,s=(l,h,p,m,f)=>{e.customWFSLoader(e.ol.getSource(),e.options.sourceOptions,this.authInterceptor,l,h,p,m,f,!0)};o.setLoader(s),o.refresh();for(let l of n.layerController.all)if(jn(l)&&l.id!==e.id&&l.options.linkedLayers?.linkId.includes(e.id.substr(0,e.id.indexOf(".")-1))&&l.options.linkedLayers?.linkId.includes("WmsWorkspaceTableSrc")){let h=l.dataSource.ol,p=h.getParams();p._t=new Date().getTime(),h.updateParams(p)}}validateFeature(e,n){let o,s=!0;return n.meta.tableTemplate.columns.forEach(l=>{l.hasOwnProperty("validation")&&l.validation&&(o=W3(l.name),Object.keys(l.validation).forEach(h=>{switch(h){case"mandatory":{l.validation[h]&&(!e.properties.hasOwnProperty(o)||!e.properties[o])&&(s=!1,this.messageService.error("igo.geo.formValidation.mandatory",void 0,void 0,{column:l.title}));break}case"minValue":{e.properties.hasOwnProperty(o)&&e.properties[o]&&e.properties[o]<l.validation[h]&&(s=!1,this.messageService.error("igo.geo.formValidation.minValue",void 0,void 0,{column:l.title,value:l.validation[h]}));break}case"maxValue":{e.properties.hasOwnProperty(o)&&e.properties[o]&&e.properties[o]>l.validation[h]&&(s=!1,this.messageService.error("igo.geo.formValidation.maxValue",void 0,void 0,{column:l.title,value:l.validation[h]}));break}case"minLength":{e.properties.hasOwnProperty(o)&&e.properties[o]&&e.properties[o].length<l.validation[h]&&(s=!1,this.messageService.error("igo.geo.formValidation.minLength",void 0,void 0,{column:l.title,value:l.validation[h]}));break}case"maxLength":{e.properties.hasOwnProperty(o)&&e.properties[o]&&e.properties[o].length>l.validation[h]&&(s=!1,this.messageService.error("igo.geo.formValidation.maxLength",void 0,void 0,{column:l.title,value:l.validation[h]}));break}}}))}),s}sanitizeParameter(e,n){n.meta.tableTemplate.columns.forEach(o=>{o.type==="list"&&e.properties[W3(o.name)]&&(e.properties[W3(o.name)]=e.properties[W3(o.name)].toString())})}static \u0275fac=function(n){return new(n||r)(pt(Za),pt(Kr),pt(Oi),pt(Gn),pt(Er),pt(Yc),pt(Nc),pt(O1))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();function W3(r){return r.includes("properties.")?r.split(".")[1]:r}function Bte(r){return r.length===0?r:typeof r[0]=="number"?r.slice(0,2):r.map(Bte)}function kw({feature:r,markerColor:i=[0,161,222],markerOpacity:e=1,markerOutlineColor:n=[0,255,255],fillColor:o,fillOpacity:s=.15,strokeColor:l=[0,255,255],strokeOpacity:h=.5,strokeWidth:p=4}){return W3e({feature:r,markerColor:i,markerOpacity:e,markerOutlineColor:n,fillColor:o,fillOpacity:s,strokeColor:l,strokeOpacity:h,strokeWidth:p})}function W3e({feature:r,markerColor:i=[0,161,222],markerOpacity:e=.5,markerOutlineColor:n,fillColor:o=[0,161,222],fillOpacity:s=.15,strokeColor:l=[0,161,222],strokeOpacity:h=.5,strokeWidth:p=2}){let m=r instanceof gi,f,g;m?(r=r,f=r.getGeometry()):(r=r,f=r.geometry,g=r.meta.mapTitle);let y=m?f.getType():f.type;if(!f||y==="Point"){let _=Ra(i).slice(0),w=_.slice(0,3);return _.length===4&&(typeof i!="string"||/^#[0-9A-F]{8}$/i.test(i))&&(e=_[3]),t_({text:g,opacity:e,markerOutlineColor:n,markerColor:w})}else{let _=Ra(o).slice(0),w=Ra(l).slice(0);return _.length===4&&(typeof o!="string"||/^#[0-9A-F]{8}$/i.test(o))||(_[3]=s),w.length===4&&(typeof l!="string"||/^#[0-9A-F]{8}$/i.test(l))||(w[3]=h),JN({text:g,strokeWidth:p,strokeColor:w,fillColor:_})}}var jte=(()=>{class r{config;options;constructor(e){this.config=e,this.options=this.config.getConfig("regex")}getAll(){return this.options}get(e){if(this.options)return this.options[e]}static \u0275fac=function(n){return new(n||r)(pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Ow=(()=>{class r{regexService;geoServiceRegexes=[];constructor(e){this.regexService=e,this.geoServiceRegexes=this.getGeoServiceRegexes()}getPropertyType(e){return typeof e}isUrl(e){return/^https?:\/\//.test(e.toString())}isGeoService(e){let n=!1;if(this.isUrl){for(let o of this.geoServiceRegexes)if(new RegExp(o.url).test(e)){n=!0;break}return n}}getGeoService(e,n){if(!this.isGeoService(e))return;let o;for(let s of this.geoServiceRegexes)if(new RegExp(s.url).test(e)&&(o=n.filter(p=>s.propertiesForLayerName.includes(p))?s:void 0,o))break;return o}getGeoServiceRegexes(){return this.regexService.get("geoservice")||[]}static \u0275fac=function(n){return new(n||r)(pt(jte))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var H3=class extends P_{options;inResolutionRange$=new ut(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(i){super(i),this.options=i,this.map.viewController.resolution$.subscribe(e=>{e>this.layer.minResolution&&e<this.layer.maxResolution?this.inResolutionRange$.next(!0):this.inResolutionRange$.next(!1)})}getLayerWksOptionTabQuery(){return this.layer.options.workspace.queryOptions?.tabQuery!==void 0?this.layer.options.workspace.queryOptions.tabQuery:!0}getLayerWksOptionMapQuery(){return this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab!==void 0?this.layer.options.workspace.queryOptions.mapQueryOnOpenTab:!0}getInResolutionRange(){return this.inResolutionRange$.value}};var wB=(()=>{class r{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ut(void 0);constructor(e,n,o,s,l){this.storageService=e,this.configService=n,this.layerService=o,this.propertyTypeDetectorService=s,this.capabilitiesService=l}createWorkspace(e,n){if(e.options.workspace?.enabled===!1||e.dataSource.options.edition)return;e.options.workspace=Object.assign({},e.options.workspace,{srcId:e.id,workspaceId:e.id,enabled:!0}),e.options.linkedLayers||(e.options.linkedLayers={linkId:e.id,links:[]});let o=new H3({id:e.id,title:e.title,layer:e,map:n,entityStore:this.createFeatureStore(e,n),actionStore:new h0([]),meta:{tableTemplate:void 0}});return Lw(o,e,this.layerService,this.ws$),o}createFeatureStore(e,n){let o=new is([],{map:n});o.bindLayer(e);let s=new mf({}),l=new s3({percentDistinctValueRatio:2,sourceFields:e.dataSource.options.sourceFields}),h=new ph({}),p=new C_({map:n},this.propertyTypeDetectorService,this.capabilitiesService),m=new pf({}),f=new _m({}),g=this.configService.getConfig("queryOverlayStyle"),y=new rs({layer:new Fr({zIndex:300,source:new kr,style:_=>kw(Object.assign({},{feature:_},g?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Yi.Default:Yi.None,many:!0,dragBox:!0});return e.options.workspace?.searchIndexEnabled&&o.addStrategy(l,!0),o.addStrategy(s,!0),o.addStrategy(h,!0),o.addStrategy(p,!0),o.addStrategy(m,!0),o.addStrategy(y,!0),o.addStrategy(f,!1),o.addStrategy(L_(),!0),o}static \u0275fac=function(n){return new(n||r)(pt(Kr),pt(Oi),pt(Za),pt(Ow),pt(Sl))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Dw=class extends P_{options;inResolutionRange$=new ut(!0);get layer(){return this.options.layer}get map(){return this.options.map}constructor(i){super(i),this.options=i,this.map.viewController.resolution$.subscribe(e=>{e>this.layer.minResolution&&e<this.layer.maxResolution?this.inResolutionRange$.next(!0):this.inResolutionRange$.next(!1)})}getLayerWksOptionTabQuery(){return this.layer.options.workspace.queryOptions?.tabQuery!==void 0?this.layer.options.workspace.queryOptions.tabQuery:!0}getLayerWksOptionMapQuery(){return this.layer.options.workspace.queryOptions?.mapQueryOnOpenTab!==void 0?this.layer.options.workspace.queryOptions.mapQueryOnOpenTab:!0}getInResolutionRange(){return this.inResolutionRange$.value}};var xB=(()=>{class r{storageService;configService;layerService;propertyTypeDetectorService;capabilitiesService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ut(void 0);constructor(e,n,o,s,l){this.storageService=e,this.configService=n,this.layerService=o,this.propertyTypeDetectorService=s,this.capabilitiesService=l}createWorkspace(e,n){if(e.options.workspace?.enabled===!1||e.dataSource.options.edition)return;e.options.workspace=Object.assign({},e.options.workspace,{srcId:e.id,workspaceId:e.id,enabled:!0}),e.options.linkedLayers||(e.options.linkedLayers={linkId:e.id,links:[]});let o=new Dw({id:e.id,title:e.title,layer:e,map:n,entityStore:this.createFeatureStore(e,n),actionStore:new h0([]),meta:{tableTemplate:void 0}});return Lw(o,e,this.layerService,this.ws$),o}createFeatureStore(e,n){let o=new is([],{map:n});o.bindLayer(e);let s=new mf({}),l=new ph({}),h=new C_({map:n},this.propertyTypeDetectorService,this.capabilitiesService),p=new pf({}),m=new _m({}),f=this.configService.getConfig("queryOverlayStyle"),g=e.id+".FeatureStore";e.link||(e.options.linkedLayers.links=[{syncedDelete:!0,linkedIds:[g],properties:[_n.VISIBLE]}],e.createLink());let y=new rs({layer:new Fr({id:g,linkedLayers:{linkId:g},zIndex:300,source:new kr,style:_=>kw(Object.assign({},{feature:_},f?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Yi.Default:Yi.None,many:!0,dragBox:!0});return o.addStrategy(s,!0),o.addStrategy(l,!0),o.addStrategy(h,!0),o.addStrategy(p,!0),o.addStrategy(y,!0),o.addStrategy(m,!1),o.addStrategy(L_(),!0),o}static \u0275fac=function(n){return new(n||r)(pt(Kr),pt(Oi),pt(Za),pt(Ow),pt(Sl))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var SB=(()=>{class r{layerService;storageService;capabilitiesService;styleService;configService;propertyTypeDetectorService;get zoomAuto(){return this.storageService.get("zoomAuto")}ws$=new ut(void 0);constructor(e,n,o,s,l,h){this.layerService=e,this.storageService=n,this.capabilitiesService=o,this.styleService=s,this.configService=l,this.propertyTypeDetectorService=h}createWorkspace(e,n){if(!e.options.workspace||n.layerController.all.find(y=>y.id===e.id+".WfsWorkspaceTableDest")||e.dataSource.options.edition)return;let o=e.dataSource,s=e.id+".WmsWorkspaceTableSrc",l=e.id+".WfsWorkspaceTableDest";e.options.linkedLayers||(e.options.linkedLayers={linkId:s,links:[]});let h={syncedDelete:!0,linkedIds:[l],properties:[_n.ZINDEX,_n.VISIBLE]};e.options.workspace?.minResolution||h.properties.push(_n.MINRESOLUTION);let p=!1;o.options.ogcFilters?.enabled&&(h.properties.push(_n.OGCFILTERS),p=!0),e.options.workspace?.maxResolution||h.properties.push(_n.MAXRESOLUTION);let m=[];e.options.linkedLayers.links&&(m=JSON.parse(JSON.stringify(e.options.linkedLayers.links))),m.push(h),e.options.linkedLayers.linkId=e.options.linkedLayers.linkId?e.options.linkedLayers.linkId:s,e.options.linkedLayers.links=m,e.createLink();let f,g={printable:e.options.workspace?.printable,srcId:e.id,workspaceId:void 0,enabled:!1,queryOptions:{mapQueryOnOpenTab:e.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:e.options.workspace?.queryOptions?.tabQuery},pageSize:e.options.workspace?.pageSize,pageSizeOptions:e.options.workspace?.pageSizeOptions};return this.layerService.createAsyncLayer({title:e.title,parentId:e.options.parentId,isIgoInternalLayer:!0,visible:e.visible,id:l,linkedLayers:{linkId:l},workspace:g,showInLayerList:!1,opacity:0,minResolution:e.options.workspace?.minResolution||e.minResolution||0,maxResolution:e.options.workspace?.maxResolution||e.maxResolution||1/0,style:this.styleService.createStyle({fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},circle:{fill:{color:"rgba(255, 255, 255, 0.01)"},stroke:{color:"rgba(255, 255, 255, 0.01)"},radius:5}}),sourceOptions:{download:o.options.download,type:"wfs",url:o.options.urlWfs||o.options.url,queryable:!0,relations:o.options.relations,queryTitle:o.options.queryTitle,queryFormatAsWms:e.options.workspace?.enabled?o.options.queryFormatAsWms:!0,params:o.options.paramsWFS,ogcFilters:Object.assign({},o.ogcFilters,{enabled:p}),sourceFields:o.options.sourceFields||void 0}}).subscribe(y=>{if(n.layerController.add(y),e.ol.setProperties({linkedLayers:{linkId:e.options.linkedLayers.linkId,links:m}},!1),y.dataSource.ol.refresh(),!!e.options.workspace?.enabled)return f=new Dw({id:e.id,title:e.title,layer:y,map:n,entityStore:this.createFeatureStore(y,n),actionStore:new h0([]),meta:{tableTemplate:void 0}}),Lw(f,y,this.layerService,this.ws$),y.options.workspace.workspaceId=y.id,e.options.workspace=Object.assign({},e.options.workspace,{enabled:!0,srcId:e.id,workspaceId:y.id,queryOptions:{mapQueryOnOpenTab:e.options.workspace?.queryOptions?.mapQueryOnOpenTab,tabQuery:e.options.workspace?.queryOptions?.tabQuery},pageSize:e.options.workspace?.pageSize,pageSizeOptions:e.options.workspace?.pageSizeOptions}),delete o.options.download,f}),f}createFeatureStore(e,n){let o=new is([],{map:n});o.bindLayer(e);let s=new mf({}),l=new ph({}),h=new C_({map:n},this.propertyTypeDetectorService,this.capabilitiesService),p=new pf({}),m=new _m({}),f=this.configService.getConfig("queryOverlayStyle"),g=e.id+".FeatureStore";e.link||(e.options.linkedLayers.links=[{syncedDelete:!0,linkedIds:[g],properties:[_n.VISIBLE]}],e.createLink());let y=new rs({layer:new Fr({id:g,linkedLayers:{linkId:g},zIndex:300,source:new kr,style:_=>kw(Object.assign({},{feature:_},f?.selection||{})),showInLayerList:!1,exportable:!1,browsable:!1}),map:n,hitTolerance:15,motion:this.zoomAuto?Yi.Default:Yi.None,many:!0,dragBox:!0});return o.addStrategy(s,!0),o.addStrategy(l,!0),o.addStrategy(h,!0),o.addStrategy(p,!0),o.addStrategy(y,!0),o.addStrategy(m,!1),o.addStrategy(L_(),!0),o}static \u0275fac=function(n){return new(n||r)(pt(Za),pt(Kr),pt(Sl),pt(Nc),pt(Oi),pt(Ow))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var Hei=(()=>{class r{component;wfsWorkspaceService;wmsWorkspaceService;editionWorkspaceService;featureWorkspaceService;layers$$;entities$$=[];map;changeWorkspace=new Ke;disableSwitch=new Ke;relationLayers=new Ke;rowsInMapExtentCheckCondition=new Ke;get workspaceStore(){return this.component.store}constructor(e,n,o,s,l){this.component=e,this.wfsWorkspaceService=n,this.wmsWorkspaceService=o,this.editionWorkspaceService=s,this.featureWorkspaceService=l}ngOnInit(){this.layers$$=this.map.layerController.all$.pipe(Br(50)).subscribe(e=>this.onLayersChange(e)),this.featureWorkspaceService.ws$.subscribe(e=>{this.changeWorkspace.emit(e)}),this.wmsWorkspaceService.ws$.subscribe(e=>{this.changeWorkspace.emit(e)}),this.wfsWorkspaceService.ws$.subscribe(e=>{this.changeWorkspace.emit(e)}),this.editionWorkspaceService.ws$.subscribe(e=>{this.changeWorkspace.emit(e)}),this.editionWorkspaceService.adding$.subscribe(e=>{this.disableSwitch.emit(e)}),this.editionWorkspaceService.relationLayers$.subscribe(e=>{this.relationLayers.emit(e)}),this.editionWorkspaceService.rowsInMapExtentCheckCondition$.subscribe(e=>{this.rowsInMapExtentCheckCondition.emit(e)})}ngOnDestroy(){this.layers$$.unsubscribe(),this.entities$$.map(e=>e.unsubscribe())}onLayersChange(e){let n=e.filter(h=>this.layerIsEditable(h)),o=n.map(h=>h.id),s=n.map(h=>this.getOrCreateWorkspace(h)).filter(h=>h!==void 0),l=this.workspaceStore.all().filter(h=>o.indexOf(h.id)<0);l.length>0&&(l.forEach(h=>{h.entityStore.deactivateStrategyOfType(ph),h.deactivate()}),this.workspaceStore.state.updateMany(l,{active:!1,selected:!1}),this.workspaceStore.deleteMany(l)),s.length>0&&this.workspaceStore.insertMany(s)}getOrCreateWorkspace(e){if(this.workspaceStore.get(e.id)===void 0){if(e.dataSource instanceof qh&&e.dataSource.options.edition?.enabled!==!0)return this.wfsWorkspaceService.createWorkspace(e,this.map);if(e.dataSource instanceof _l&&e.dataSource.options.edition?.enabled!==!0){if(!e.dataSource.options.paramsWFS)return;let o=this.wmsWorkspaceService.createWorkspace(e,this.map);return o?.inResolutionRange$.subscribe(s=>{e.dataSource.options.queryable=!s,o.layer.dataSource.options.queryable=s}),o}else{if(e.dataSource instanceof kr&&e.exportable===!0&&e.dataSource.options.edition?.enabled!==!0)return this.featureWorkspaceService.createWorkspace(e,this.map);if(e.dataSource instanceof _l&&e.dataSource.options.edition?.enabled===!0)return this.editionWorkspaceService.createWorkspace(e,this.map)}}}layerIsEditable(e){if(An(e))return!1;let n=e.dataSource;return n instanceof qh||n instanceof kr?!0:n instanceof _l?(n.options||{}).ogcFilters?.enabled||n.options.paramsWFS?.featureTypes!==void 0:!1}static \u0275fac=function(n){return new(n||r)(Ie(z3),Ie(xB),Ie(SB),Ie(bB),Ie(wB))};static \u0275dir=Fi({type:r,selectors:[["","igoWorkspaceSelector",""]],inputs:{map:"map"},outputs:{changeWorkspace:"changeWorkspace",disableSwitch:"disableSwitch",relationLayers:"relationLayers",rowsInMapExtentCheckCondition:"rowsInMapExtentCheckCondition"},standalone:!0})}return r})();var Wte=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({})}return r})();var Y3e=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({providers:[Dte()],imports:[s9,yB,Wte,V1,yB]})}return r})();var Ss=function(r){return r.Layer="layer",r.Group="group",r}(Ss||{}),no=function(r){return r[r.wms=0]="wms",r[r.wmts=1]="wmts",r[r.baselayers=2]="baselayers",r[r.arcgisrest=3]="arcgisrest",r[r.tilearcgisrest=4]="tilearcgisrest",r[r.imagearcgisrest=5]="imagearcgisrest",r[r.composite=6]="composite",r}(no||{});var Ug=class{id;title;url;removable;externalProvider;abstract;forcedProperties;items;type;version;matrixSet;requestEncoding;regFilters;groupImpose;groupSeparator;timeFilter;queryFormat;queryHtmlTarget;queryParams;sourceOptions;count;tooltipType;sortDirection;setCrossOriginAnonymous;showLegend;profils;constructor(i){Object.assign(this,i)}};var q3=class extends Ug{_collectCatlogItems;constructor(i,e){super(i),this._collectCatlogItems=e;let n=no[no.wms];this.type=no[n]}collectCatalogItems(){return this._collectCatlogItems(this)}},Y3=class extends Ug{_collectCatlogItems;constructor(i,e){super(i),this._collectCatlogItems=e;let n=no[no.wmts];this.type=no[n]}collectCatalogItems(){return this._collectCatlogItems(this)}},Z3=class extends Ug{_collectCatlogItems;constructor(i,e){super(i),this._collectCatlogItems=e;let n=no[no.baselayers];this.type=no[n]}collectCatalogItems(){return this._collectCatlogItems(this)}},X3=class extends Ug{_collectCatlogItems;constructor(i,e){super(i),this._collectCatlogItems=e;let n=no[no.arcgisrest];this.type=no[n]}collectCatalogItems(){return this._collectCatlogItems(this)}},GC=class extends Ug{_collectCatlogItems;constructor(i,e,n){super(i),this._collectCatlogItems=e,this.type=no[no[n]]}collectCatalogItems(){return this._collectCatlogItems(this)}},K3=class extends Ug{_collectCatlogItems;constructor(i,e){super(i),this._collectCatlogItems=e;let n=no[no.composite];this.type=no[n],this.url=null}collectCatalogItems(){return this._collectCatlogItems(this)}};var Hti=(()=>{class r{http;config;languageService;messageService;capabilitiesService;constructor(e,n,o,s,l){this.http=e,this.config=n,this.languageService=o,this.messageService=s,this.capabilitiesService=l}loadCatalogs(){let e=this.config.getConfig("context")||{},n=this.config.getConfig("catalog")||{},o=n.url||e.url,s=n.sources||[],l=[];if(o){if(n.baselayers){let f=[{id:"catalog.baselayers",title:this.languageService.translate.instant("igo.geo.catalog.baseLayers"),url:`${o}/baselayers`,type:"baselayers"}];l.push(ai(f))}let h=this.http.get(`${o}/catalogs`).pipe(Nt(p=>p.map(m=>Object.assign(m,m.options))),qr(()=>Gd));l.push(h)}return s.length>0&&l.push(ai(s).pipe(Nt(h=>h.map(p=>(p.id||(p.id=rn()),p))))),Sh(...l).pipe(Nt(h=>[].concat.apply([],h)))}loadCatalogItems(e){return Q3.createInstanceCatalog(e,this).collectCatalogItems()}loadCatalogBaseLayerItems(e){return this.getCatalogBaseLayersOptions(e).pipe(Nt(n=>{let o=n.map(s=>({id:Ep(s.sourceOptions),title:s.title,type:Ss.Layer,externalProvider:e.externalProvider,options:s}));return[{id:"catalog.group.baselayers",type:Ss.Group,externalProvider:e.externalProvider,title:e.title,items:o}]}))}getCatalogBaseLayersOptions(e){return this.http.get(e.url)}loadCatalogWMSLayerItems(e){return this.getCatalogCapabilities(e).pipe(Nt(n=>{let o=[];if(!n)return o;n.Service&&n.Service.Abstract&&n.Service.Abstract.length&&(e.abstract=n.Service.Abstract);let s=[];this.flattenWmsCapabilities(n.Capability.Layer,0,s,e.groupSeparator);let l=Object.assign({},n.Capability.Layer);return l.Layer=s.filter(h=>h.Layer.length!==0),this.includeRecursiveItems(e,l,o),o}),qr(()=>(this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:e.title}),Gd)))}flattenWmsCapabilities(e,n=0,o,s=" / "){if(!o.includes(e.Title)){let l=Object.assign({},e);l.Layer=[],o.push(l)}for(let l of e.Layer){let h=Object.assign({},l);n>0&&(h.Title=e.Title+s+l.Title),l.Layer?this.flattenWmsCapabilities(h,n+1,o,s):o.find(p=>p.Title===e.Title).Layer.push(l)}}loadCatalogWMTSLayerItems(e){return this.getCatalogCapabilities(e).pipe(Nt(n=>this.getWMTSItems(e,n)))}loadCatalogArcGISRestItems(e){return this.getCatalogCapabilities(e).pipe(Nt(n=>this.getArcGISRESTItems(e,n)))}loadCatalogCompositeLayerItems(e){let n=e.composite,o=[];n.map(y=>{y.sortDirection=e.sortDirection,o.push(Q3.createInstanceCatalog(y,this))});let s=[];o.map(y=>s.push(y.collectCatalogItems()));let l=[];function h(y){return y.reduce((_,w)=>_.concat(w.type===Ss.Group?h(w.items):w),[])}if(Object.keys(n).find(y=>n[y].groupImpose)){let y=(_,w)=>{let A=o[w],k=Object.assign({},A.groupImpose);k.address=A.id,k.type=Ss.Group,k.externalProvider=A.externalProvider,k.sortDirection===void 0&&(k.sortDirection=A.sortDirection),k.items=[];let R=h(_);return R.map(q=>q.address=`${k.address}.${k.id}`),k.items=R,k};l=s.map((_,w)=>_.pipe(Nt(A=>n[w].groupImpose?y(A,w):A)))}else l=s;let p=Sh(...l).pipe(Nt(y=>[].concat(...y))),m=(y,_)=>y.reduce((w,A)=>{let k=_(A),R=w.find(q=>q.id===k);if(!R)w[w.length]=A;else{let q=w.indexOf(R);w[q].address.split("|").indexOf(A.address)===-1&&(w[q].address=`${w[q].address}|${A.address}`),w[q].items.push(...A.items)}return w},[]),f=(y,_)=>y.reduce((w,A,k,R)=>{let q=_(A),X=Object.assign({},A);if(A.type===Ss.Layer){let ie=[],ae=[];if(R.filter((fe,ge)=>{let ue=!1;return fe.title===q&&fe.type===Ss.Layer&&(ge!==k&&fe.address!==A.address&&(ue=!0),ie.push(ge)),ue}).length>0){let fe=ie.findIndex(ge=>ge===k)+1;X.title=`${A.title} (${fe})`,fe=ae.findIndex(ge=>ge===k)+1,X.newMetadataUrl=`${A.newMetadataUrl} (${fe})`}w.find(fe=>fe.title===X.title&&fe.type===Ss.Layer)||(w[w.length]=X)}else A.type===Ss.Group&&(X.items=f(A.items,ie=>ie.title),w[w.length]=X);return w},[]);return p.pipe(Nt(y=>m(y,_=>_.id)),Nt(y=>[].concat(...y)),Nt(y=>f(y,_=>_.title)))}getCatalogCapabilities(e){let n=no[e.type];return this.capabilitiesService.getCapabilities(n,e.url,e.version).pipe(qr(o=>(this.messageService.error(e.title?"igo.geo.catalog.unavailable":"igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle",void 0,e.title?{value:e.title}:void 0),console.error(o),ai(void 0))))}computeForcedProperties(e,n){if(!n||n.length===0)return;let o={layerName:e,title:void 0,metadataUrl:void 0,metadataAbstract:void 0,metadataAbstractAll:void 0,metadataUrlAll:void 0},s=n.find(l=>l.layerName==="*");return s&&(s.metadataAbstractAll&&(o.metadataAbstractAll=s.metadataAbstractAll),s.metadataUrlAll&&(o.metadataUrlAll=s.metadataUrlAll)),n.map(l=>{e===l.layerName&&(l.title&&(o.title=l.title),l.metadataUrl&&(o.metadataUrl=l.metadataUrl),l.metadataAbstract&&(o.metadataAbstract=l.metadataAbstract))}),o}prepareCatalogItemLayer(e,n,o,s){let l=this.retrieveLayerInfoFormat(e.Name,o),h=s.showLegend&&e.Style?this.capabilitiesService.getStyle(e.Style):void 0,p=Object.assign({},s.queryParams,{LAYERS:e.Name,VERSION:s.version}),m={type:"wms",url:s.url,crossOrigin:s.setCrossOriginAnonymous?"anonymous":void 0,queryFormat:l,queryHtmlTarget:l===Ya.HTML||l===Ya.HTMLGML2?"iframe":void 0,optionsFromCapabilities:!0},f=Object.assign({},m,s.sourceOptions,{params:p}),g=this.computeForcedProperties(e.Name,s.forcedProperties),y,_=!0;e.Abstract?y=e.Abstract:!e.Abstract&&s.abstract&&(y=s.abstract);let w=e?.DataURL&&e?.DataURL.length>0?e?.DataURL[0].OnlineResource:void 0,A=g?.metadataUrl||g?.metadataUrlAll||w,k=g?.metadataAbstract||g?.metadataAbstractAll||y;!g?.metadataUrl&&!g?.metadataUrlAll&&(g?.metadataAbstract||g?.metadataAbstractAll)&&(_=!1),g?.metadataAbstract&&g?.metadataUrlAll&&(_=!1);let R={id:Ep(f),type:Ss.Layer,title:g?.title?g.title:e.Title,address:n,externalProvider:s.externalProvider||!1,options:{maxResolution:Oa(e.MaxScaleDenominator),minResolution:Oa(e.MinScaleDenominator),metadata:{url:A,extern:_,abstract:k,type:m.type},legendOptions:h,tooltip:{type:s.tooltipType},sourceOptions:f}};return rr.removeUndefined(R)}prepareCatalogItemGroup(e,n,o,s,l){return{id:o,type:Ss.Group,title:e.Title,address:l.id,externalProvider:l.externalProvider||!1,sortDirection:l.sortDirection,items:e.Layer.reduce((p,m)=>{if(m.Layer!==void 0){let f=o+`.group.${m.Name||m.Layer[0].Name}`,g=this.prepareCatalogItemGroup(m,n,f,s,l);p.push(g)}else{if(this.testLayerRegexes(m.Name,n)===!1)return p;let f=this.prepareCatalogItemLayer(m,o,s,l);p.push(f)}return p},[])}}includeRecursiveItems(e,n,o,s=0){let l=(e.regFilters||[]).map(h=>new RegExp(h));if(n.Layer)for(let h of n.Layer){if(h.Layer!==void 0){this.includeRecursiveItems(e,h,o,s+1);continue}let p=this.findCatalogInfoFormat(e);if(s!==0){let m=`catalog.group.${n.Name||h.Name}`,f=this.prepareCatalogItemGroup(n,l,m,p,e);f.items.length!==0&&o.push(f);break}else if(this.testLayerRegexes(h.Name,l)!==!1){let m=this.prepareCatalogItemLayer(h,e.id,p,e);o.push(m)}}}getWMTSItems(e,n){if(!n)return[];let o=n.Contents.Layer,s=(e.regFilters||[]).map(l=>new RegExp(l));return n.ServiceIdentification&&n.ServiceIdentification.Abstract&&n.ServiceIdentification.Abstract.length&&(e.abstract=n.ServiceIdentification.Abstract),o.map(l=>{let h=this.computeForcedProperties(l.Title,e.forcedProperties),p=!0,m=h?.metadataUrl||h?.metadataUrlAll,f=h?.metadataAbstract||h?.metadataAbstractAll||e.abstract;if(!h?.metadataUrl&&!h?.metadataUrlAll&&(h?.metadataAbstract||h?.metadataAbstractAll)&&(p=!1),h?.metadataAbstract&&h?.metadataUrlAll&&(p=!1),this.testLayerRegexes(l.Identifier,s)===!1)return;let g=Object.assign({},e.queryParams,{version:"1.0.0"}),y={type:"wmts",url:e.url,crossOrigin:e.setCrossOriginAnonymous?"anonymous":void 0,layer:l.Identifier,matrixSet:e.matrixSet,optionsFromCapabilities:!0,requestEncoding:e.requestEncoding||"KVP",style:"default"},_=Object.assign({},y,e.sourceOptions,{params:g});return rr.removeUndefined({id:Ep(_),type:Ss.Layer,title:h?.title?h.title:l.Title,address:e.id,externalProvider:e.externalProvider,options:{sourceOptions:_,metadata:{url:m,extern:p,abstract:f,type:y.type}}})}).filter(l=>l!==void 0)}getArcGISRESTItems(e,n){if(!n||!n.layers)return this.messageService.error("igo.geo.catalog.someUnavailable","igo.geo.catalog.unavailableTitle"),[];let o=n.layers?n.layers.filter(f=>f.subLayerIds):[],s=n.layers?n.layers.filter(f=>!f.type||f.type===DE.FeatureLayer||f.type===DE.RasterLayer):[],l=(e.regFilters||[]).map(f=>new RegExp(f)),h=s.map(f=>{let g=this.computeForcedProperties(f.name,e.forcedProperties),y=e.abstract,_=!0,w=g?.metadataUrl||g?.metadataUrlAll,A=g?.metadataAbstract||g?.metadataAbstractAll||y;if(!g?.metadataUrl&&!g?.metadataUrlAll&&(g?.metadataAbstract||g?.metadataAbstractAll)&&(_=!1),g?.metadataAbstract&&g?.metadataUrlAll&&(_=!1),this.testLayerRegexes(f.id.toString(),l)===!1)return;let k={type:no[e.type],url:e.url,layer:f.id.toString(),queryable:!0,queryFormat:Ya.ESRIJSON,optionsFromCapabilities:!0},R=Object.assign({},k,e.sourceOptions);return rr.removeUndefined({id:Ep(R),type:Ss.Layer,title:g?.title?g.title:f.name,externalProvider:e.externalProvider,options:{sourceOptions:R,minResolution:Oa(f.maxScale),maxResolution:Oa(f.minScale),metadata:{url:w,extern:_,abstract:A,type:e.type}}})}).filter(f=>f!==void 0),p=[],m=o.map(f=>({options:void 0,address:`catalog.group.${f.name}`,id:`catalog.group.${f.name}`,type:Ss.Group,externalProvider:e.externalProvider,sortDirection:e.sortDirection,title:f.name,items:h.filter(g=>f.subLayerIds.map(_=>_.toString()).includes(g.options.sourceOptions.layer)).map(g=>(p.push(g.id),Object.assign({},g,{address:`catalog.group.${f.name}`})))})).filter(f=>f.items.length);if(o){let f=e.title||e.id,g=h.filter(y=>!p.includes(y.id)).map(y=>Object.assign({},y,{address:`catalog.group.${f}`}));if(g.length){let y={options:void 0,address:`catalog.group.${f}`,id:`catalog.group.${f}`,type:Ss.Group,externalProvider:e.externalProvider,sortDirection:e.sortDirection,title:f,items:g};m.push(y)}}return o?m:h}testLayerRegexes(e,n){return n.length===0?!0:n.find(o=>o.test(e))!==void 0}retrieveLayerInfoFormat(e,n){let o=n.find(h=>h.layer===e),s=n.find(h=>h.layer==="*"),l;return o?l=o.queryFormat:s&&(l=s.queryFormat),l}findCatalogInfoFormat(e){let n=[];return e.queryFormat&&Object.keys(e.queryFormat).forEach(o=>{e.queryFormat[o]instanceof Array?e.queryFormat[o].forEach(s=>{n.find(l=>l.layer===s)||n.push({layer:s,queryFormat:o})}):n.find(s=>s.layer===e.queryFormat[o])||n.push({layer:e.queryFormat[o],queryFormat:o})}),n}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Oi),pt(Di),pt(Gn),pt(Sl))};static \u0275prov=qt({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})(),Q3=class{static createInstanceCatalog(i,e){let n;return i.hasOwnProperty("composite")?n=new K3(i,o=>e.loadCatalogCompositeLayerItems(o)):i.type===no[no.baselayers]?n=new Z3(i,o=>e.loadCatalogBaseLayerItems(o)):i.type===no[no.arcgisrest]?n=new X3(i,o=>e.loadCatalogArcGISRestItems(o)):i.type===no[no.tilearcgisrest]?n=new GC(i,o=>e.loadCatalogArcGISRestItems(o),no.tilearcgisrest):i.type===no[no.imagearcgisrest]?n=new GC(i,o=>e.loadCatalogArcGISRestItems(o),no.imagearcgisrest):i.type===no[no.wmts]?n=new Y3(i,o=>e.loadCatalogWMTSLayerItems(o)):n=new q3(i,o=>e.loadCatalogWMSLayerItems(o)),n}};function Z3e(r,i){r&1&&ct(0,"mat-icon",10)}function X3e(r,i){if(r&1){let e=We();$(0,"button",11)(1,"mat-icon",12),le(2,"translate"),ve("click",function(o){return we(e),xe(o.stopPropagation())}),_e(3," public "),ee()()}r&2&&(j(),z("matTooltip",ce(2,1,"igo.geo.catalog.externalProvider.layer")))}function K3e(r,i){if(r&1&&(ct(0,"igo-layer-legend",5),le(1,"async")),r&2){let e=ne();z("layer",ce(1,1,e.igoLayer$))}}var J3=(()=>{class r{layerService;inRange$=new ut(!0);isPreview$=new ut(!1);isVisible$=new ut(!1);isPreview$$;resolution$$;layers$$;lastTimeoutRequest;layerLegendShown$=new ut(!1);igoLayer$=new ut(void 0);mouseInsideAdd=!1;resolution;catalogAllowLegend=!1;layer;map;added=!1;addedChange=new Ke;addedLayerIsPreview=new Ke;get title(){return ed(this.layer)}get icon(){return d0(this.layer)||"layers"}constructor(e){this.layerService=e}ngOnInit(){this.isPreview$$=this.isPreview$.subscribe(e=>this.addedLayerIsPreview.emit(e)),this.layers$$=this.map.layerController.all$.subscribe(()=>{this.isVisible()}),this.resolution$$=this.map.viewController.resolution$.subscribe(e=>{this.isInResolutionsRange(e),this.isVisible()})}ngOnDestroy(){this.isPreview$$.unsubscribe(),this.resolution$$.unsubscribe(),this.layers$$.unsubscribe()}computeTitleTooltip(){let e=this.layer.options;if(!e.tooltip)return ed(this.layer);let n=e.tooltip,o=e.metadata;switch(e.tooltip.type){case oh.TITLE:return this.layer.title;case oh.ABSTRACT:return o&&o.abstract?o.abstract:this.layer.title;case oh.CUSTOM:return n&&n.text?n.text:this.layer.title;default:return this.layer.title}}onMouseEvent(e){this.onToggleClick(e)}askForLegend(){this.layerLegendShown$.next(!this.layerLegendShown$.value),this.layerService.createAsyncLayer(this.layer.options).pipe(Ps()).subscribe(e=>this.igoLayer$.next(e))}onToggleClick(e){if(typeof this.lastTimeoutRequest<"u"&&clearTimeout(this.lastTimeoutRequest),!(e.type==="mouseenter"&&this.mouseInsideAdd))switch(e.type){case"click":this.isPreview$.value||(this.added?this.remove(e):this.add(e)),this.isPreview$.next(!1);break;case"mouseenter":!this.isPreview$.value&&!this.added&&(this.lastTimeoutRequest=setTimeout(()=>{this.add(e),this.isPreview$.next(!0)},500)),this.mouseInsideAdd=!0;break;case"mouseleave":this.isPreview$.value&&(this.remove(e),this.isPreview$.next(!1)),this.mouseInsideAdd=!1;break;default:break}}add(e){this.added||(this.added=!0,this.addedChange.emit({added:!0,layer:this.layer,event:e}))}remove(e){this.added&&(this.added=!1,this.addedChange.emit({added:!1,layer:this.layer,event:e}))}haveGroup(){return!(!this.layer.address||this.layer.address.split(".").length===1)}isInResolutionsRange(e){let n=!this.layer.options.minResolution||Number.isNaN(this.layer.options.minResolution)?0:this.layer.options.minResolution,o=!this.layer.options.maxResolution||Number.isNaN(this.layer.options.maxResolution)?1/0:this.layer.options.maxResolution;this.inRange$.next(e>=n&&e<=o)}isVisible(){if(this.layer?.id){let e=this.map.layerController.getById(this.layer?.id);this.isVisible$.next(e?.displayed)}}getBadgeIcon(){return this.inRange$.getValue()&&this.isVisible$.getValue()?"":"visibility_off"}computeTooltip(){return this.added?this.isPreview$.value?"igo.geo.catalog.layer.addToMap":this.inRange$.value?this.isVisible$.value?"igo.geo.catalog.layer.removeFromMap":"igo.geo.catalog.layer.removeFromMapNotVisible":"igo.geo.catalog.layer.removeFromMapOutRange":this.inRange$.value?"igo.geo.catalog.layer.addToMap":"igo.geo.catalog.layer.addToMapOutRange"}static \u0275fac=function(n){return new(n||r)(Ie(Za))};static \u0275cmp=nt({type:r,selectors:[["igo-catalog-browser-layer"]],inputs:{resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",layer:"layer",map:"map",added:"added"},outputs:{addedChange:"addedChange",addedLayerIsPreview:"addedLayerIsPreview"},standalone:!0,features:[lt],decls:24,vars:36,consts:[["legend",""],["class","catalog-browser-layer-carret","matListItemIcon","",4,"ngIf"],["matListItemTitle","","matTooltipShowDelay","500",3,"click","ngClass","matTooltip"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[3,"layer"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"mouseenter","mouseleave","click","matTooltip","color"],["aria-hidden","false","matBadge","icon","igoMatBadgeColor","rgba(0,0,0,0.87)","igoMatBadgeBackgroundColor","none","matBadgeSize","small","matBadgePosition","after",3,"igoMatBadgeIcon","igoMatBadgeInverseColor","matBadgeHidden","matBadgeDisabled"],[1,"igo-cataloglayer-legend-container"],[3,"layer",4,"ngIf"],["matListItemIcon","",1,"catalog-browser-layer-carret"],["disabled","true","mat-icon-button",""],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloglayer-external-icon",3,"click","matTooltip"]],template:function(n,o){if(n&1){let s=We();$(0,"mat-list-item"),Pe(1,Z3e,1,0,"mat-icon",1),$(2,"span",2),ve("click",function(){return we(s),xe(o.askForLegend())}),_e(3),ee(),$(4,"div",3),Pe(5,X3e,4,3,"button",4),ct(6,"igo-metadata-button",5),$(7,"button",6),le(8,"translate"),le(9,"async"),ve("mouseenter",function(h){return we(s),xe(o.onMouseEvent(h))})("mouseleave",function(h){return we(s),xe(o.onMouseEvent(h))})("click",function(h){return we(s),xe(o.onToggleClick(h))}),$(10,"mat-icon",7),le(11,"async"),le(12,"async"),le(13,"async"),le(14,"async"),le(15,"async"),le(16,"async"),_e(17),le(18,"async"),ee()()()(),$(19,"div",8,0),Pe(21,K3e,2,3,"igo-layer-legend",9),le(22,"async"),le(23,"async"),ee()}n&2&&(j(),z("ngIf",o.haveGroup()),j(),z("ngClass",o.catalogAllowLegend?"igo-cataloglayer-title":"")("matTooltip",o.computeTitleTooltip()),j(),Qe(" ",o.title," "),j(2),z("ngIf",o.layer.externalProvider),j(),z("layer",o.layer),j(),z("matTooltip",ce(8,14,o.computeTooltip()))("color",ce(9,16,o.isPreview$)?"":o.added?"warn":""),j(3),z("igoMatBadgeIcon",o.getBadgeIcon())("igoMatBadgeInverseColor",!0)("matBadgeHidden",ce(11,18,o.inRange$)&&ce(12,20,o.isVisible$)===!0||ce(13,22,o.inRange$)&&!o.added||ce(14,24,o.inRange$)&&ce(15,26,o.isPreview$))("matBadgeDisabled",ce(16,28,o.inRange$)===!1),j(7),Qe(" ",ce(18,30,o.isPreview$)?"plus":o.added?"delete":"add"," "),j(4),z("ngIf",ce(22,32,o.layerLegendShown$)&&ce(23,34,o.igoLayer$)&&o.catalogAllowLegend))},dependencies:[Io,ks,oc,Ta,Ju,Gt,jt,$t,_a,Qt,ti,Vt,ci,aB,xl,Md,VE,Up,Ei,Et,Tt],styles:[`.igo-cataloglayer-title[_ngcontent-%COMP%]{cursor:pointer}.catalog-browser-layer-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-cataloglayer-legend-container[_ngcontent-%COMP%]{padding-left:18px;width:calc(100% - 18px);margin-left:40px}.igo-cataloglayer-external-icon[_ngcontent-%COMP%]{cursor:help}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}
/*# sourceMappingURL=catalog-browser-layer.component-PLX364FW.css.map */`],changeDetection:0})}return r})();function Q3e(r,i){if(r&1){let e=We();$(0,"mat-icon",10),le(1,"translate"),ve("click",function(o){return we(e),xe(o.stopPropagation())}),_e(2," public "),ee()}r&2&&z("matTooltip",ce(1,1,"igo.geo.catalog.externalProvider.group"))}function J3e(r,i){if(r&1&&($(0,"button",8),Pe(1,Q3e,3,3,"mat-icon",9),ee()),r&2){let e=ne();j(),z("ngIf",e.group.externalProvider)}}function eFe(r,i){if(r&1){let e=We();Dr(0),$(1,"button",11),le(2,"translate"),le(3,"async"),ve("click",function(o){we(e);let s=ne();return xe(s.onToggleClick(o))}),$(4,"mat-icon"),_e(5,"delete"),ee()(),Rr()}if(r&2){let e=ne();j(),z("matTooltip",ce(2,2,"igo.geo.catalog.group.removeFromMap"))("disabled",ce(3,4,e.disabled$))}}function tFe(r,i){if(r&1){let e=We();$(0,"button",12),le(1,"translate"),le(2,"async"),ve("click",function(o){we(e);let s=ne();return xe(s.onToggleClick(o))}),$(3,"mat-icon"),_e(4,"add"),ee()()}if(r&2){let e=ne();z("matTooltip",ce(1,2,"igo.geo.catalog.group.addToMap"))("disabled",ce(2,4,e.disabled$))}}function iFe(r,i){r&1&&ic(0)}function rFe(r,i){if(r&1){let e=We();Dr(0),$(1,"igo-catalog-browser-layer",14),ve("addedLayerIsPreview",function(o){we(e);let s=ne(2);return xe(s.onLayerPreview(o))})("addedChange",function(o){we(e);let s=ne(2);return xe(s.onLayerAddedChange(o))}),ee(),Rr()}if(r&2){let e=ne().$implicit,n=ne();j(),z("layer",e)("resolution",n.resolution)("map",n.map)("catalogAllowLegend",n.catalogAllowLegend)("added",n.state.get(e).added)}}function nFe(r,i){if(r&1&&Pe(0,iFe,1,0,"ng-container",13)(1,rFe,2,5,"ng-container",13),r&2){let e=i.$implicit,n=ne();z("ngIf",n.isGroup(e)),j(),z("ngIf",n.isLayer(e))}}var Hte=(()=>{class r{store=new Lh([]);added$=new ut(!1);preview$=new ut(!1);disabled$=new ut(!1);catalog;group;map;collapsed=!0;resolution;catalogAllowLegend=!1;toggleCollapsed=!0;state;addedChange=new Ke;layerAddedChange=new Ke;get title(){return this.group.title}ngOnInit(){this.store.load(this.group.items),this.evaluateAdded(),this.evaluateDisabled(this.collapsed),this.group.sortDirection!==void 0&&this.store.view.sort({direction:this.group.sortDirection,valueAccessor:e=>e.title})}ngOnDestroy(){this.store.destroy()}isGroup(e){return e.type===Ss.Group}isLayer(e){return e.type===Ss.Layer}onToggleClick(e){this.added$.value?this.remove(e):this.add(e)}onToggleCollapsed(e){this.evaluateDisabled(e)}onLayerAddedChange(e){this.layerAddedChange.emit(e),this.tryToggleGroup(e)}add(e){this.added$.next(!0),this.addedChange.emit({added:!0,group:this.group,event:e})}remove(e){this.added$.next(!1),this.addedChange.emit({added:!1,group:this.group,event:e})}onLayerPreview(e){this.preview$.next(e)}tryToggleGroup(e){let n=e.added,o=e.layer;this.store.view.all().filter(l=>l.id!==o.id).map(l=>this.state.get(l).added||!1).every(l=>l===n)?n?this.add(e.event):this.remove(e.event):this.added$.value===!0&&this.added$.next(!1)}evaluateAdded(){let e=this.store.all().every(n=>(this.state.get(n).added||!1)===!0);this.added$.next(e)}evaluateDisabled(e){let n=!1;this.toggleCollapsed===!1&&(n=e),this.disabled$.next(n)}onTitleClick(){this.collapsed=!this.collapsed}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-catalog-browser-group"]],inputs:{catalog:"catalog",group:"group",map:"map",collapsed:"collapsed",resolution:"resolution",catalogAllowLegend:"catalogAllowLegend",toggleCollapsed:"toggleCollapsed",state:"state"},outputs:{addedChange:"addedChange",layerAddedChange:"layerAddedChange"},standalone:!0,features:[lt],decls:16,vars:14,consts:[["notadded",""],["items",""],["matListItemIcon","","igoCollapse","",1,"igo-chevron","catalog-browser-group-carret",3,"toggle","target","collapsed"],["matListItemTitle","","matTooltipShowDelay","500",1,"igo-catalog-group-title",3,"click","matTooltip"],["matListItemMeta",""],["disabled","true","mat-icon-button","",4,"ngIf"],[4,"ngIf","ngIfElse"],["ngFor","",3,"ngForOf"],["disabled","true","mat-icon-button",""],["class","igo-cataloggroup-external-icon","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-cataloggroup-external-icon",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip","disabled"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500",3,"click","matTooltip","disabled"],[4,"ngIf"],["igoListItem","",3,"addedLayerIsPreview","addedChange","layer","resolution","map","catalogAllowLegend","added"]],template:function(n,o){if(n&1){let s=We();$(0,"mat-list-item")(1,"mat-icon",2),ve("toggle",function(h){return we(s),xe(o.onToggleCollapsed(h))}),_e(2," expand_less "),ee(),$(3,"span",3),ve("click",function(){return we(s),xe(o.onTitleClick())}),_e(4),ee(),$(5,"div",4),Pe(6,J3e,2,1,"button",5)(7,eFe,6,6,"ng-container",6),le(8,"async"),le(9,"async"),Pe(10,tFe,5,6,"ng-template",null,0,Ac),ee()(),$(12,"div",null,1),Pe(14,nFe,2,2,"ng-template",7),le(15,"async"),ee()}if(n&2){let s=Xt(11),l=Xt(13);j(),z("target",l)("collapsed",o.collapsed),j(2),z("matTooltip",o.title),j(),bt(o.title),j(2),z("ngIf",o.group.externalProvider),j(),z("ngIf",ce(8,8,o.added$)&&ce(9,10,o.preview$)===!1)("ngIfElse",s),j(7),z("ngForOf",ce(15,12,o.store.view.all$()))}},dependencies:[Io,ks,oc,Ta,Ju,jt,$t,Vp,Qt,ti,Gt,Vt,ci,Li,J3,Qo,Ei,Et,Tt],styles:[`.igo-catalog-group-title[_ngcontent-%COMP%]{cursor:pointer}.igo-cataloggroup-external-icon[_ngcontent-%COMP%]{cursor:help}.catalog-browser-group-carret[_ngcontent-%COMP%]{margin-right:16px}.igo-catalog-group-title[_ngcontent-%COMP%]{font-weight:500}[_nghost-%COMP%]   .mdc-list-item__end[_ngcontent-%COMP%], [_nghost-%COMP%]   .mdc-list-item__start[_ngcontent-%COMP%]{color:#000}
/*# sourceMappingURL=catalog-browser-group.component-GGDYZJMR.css.map */`],changeDetection:0})}return r})();function oFe(r,i){if(r&1){let e=We();Dr(0),$(1,"igo-catalog-browser-group",3),le(2,"async"),ve("addedChange",function(o){we(e);let s=ne(2);return xe(s.onGroupAddedChange(o))})("layerAddedChange",function(o){we(e);let s=ne(2);return xe(s.onLayerAddedChange(o))}),ee(),Rr()}if(r&2){let e=ne().$implicit,n=ne();j(),z("catalog",n.catalog)("group",e)("map",n.map)("state",n.store.state)("resolution",ce(2,8,n.resolution$))("catalogAllowLegend",n.catalogAllowLegend)("collapsed",n.store.count!==1)("toggleCollapsed",n.toggleCollapsedGroup)}}function aFe(r,i){if(r&1){let e=We();Dr(0),$(1,"igo-catalog-browser-layer",4),le(2,"async"),ve("addedChange",function(o){we(e);let s=ne(2);return xe(s.onLayerAddedChange(o))}),ee(),Rr()}if(r&2){let e=ne().$implicit,n=ne();j(),z("layer",e)("map",n.map)("resolution",ce(2,5,n.resolution$))("catalogAllowLegend",n.catalogAllowLegend)("added",n.store.state.get(e).added)}}function sFe(r,i){if(r&1&&Pe(0,oFe,3,10,"ng-container",2)(1,aFe,3,7,"ng-container",2),r&2){let e=i.$implicit,n=ne();z("ngIf",n.isGroup(e)),j(),z("ngIf",n.isLayer(e))}}var CB=(()=>{class r{layerService;cdRef;watcher;get resolution$(){return this.map.viewController.resolution$}catalogAllowLegend=!1;catalog;store;map;toggleCollapsedGroup=!0;constructor(e,n){this.layerService=e,this.cdRef=n}ngOnInit(){let e=this.map.layerController.all.filter(o=>jn(o)).map(o=>({id:o.options.source.id,title:o.title,type:Ss.Layer}));this.store.state.updateMany(e,{added:!0},!0),this.catalog&&this.catalog.sortDirection!==void 0&&this.store.view.sort({direction:this.catalog.sortDirection,valueAccessor:o=>o.title});let n=this.catalog?this.catalog.showLegend:!1;this.catalogAllowLegend=n||this.catalogAllowLegend,this.watcher=new N1(this.store,this.cdRef)}ngOnDestroy(){this.watcher.destroy()}isGroup(e){return e.type===Ss.Group}isLayer(e){return e.type===Ss.Layer}onLayerAddedChange(e){let n=e.layer;this.store.state.update(n,{added:e.added},!1),e.added?this.addLayerToMap(n,e):this.removeLayerFromMap(n)}onGroupAddedChange(e){let n=e.group;this.store.state.update(n,{added:e.added},!1),e.added?this.addGroupToMap(n,e):this.removeGroupFromMap(n)}addLayerToMap(e,n){this.addLayersToMap([e],n)}removeLayerFromMap(e){this.removeLayersFromMap([e])}addLayersToMap(e,n){let o=e.map(s=>(s.options.sourceOptions.optionsFromApi||(s.options.sourceOptions.optionsFromApi=!0),this.catalog.profils?.length&&(s.options.security={profils:this.catalog.profils}),this.layerService.createAsyncLayer(s.options)));Sh(...o).subscribe(s=>{n.event.type==="click"&&n.added&&this.map.layersAddedByClick$.next(s),this.store.state.updateMany(e,{added:!0}),this.map.layerController.add(...s.filter(Boolean))})}removeLayersFromMap(e){e.forEach(n=>{if(this.store.state.update(n,{added:!1}),n.options.baseLayer===!0){let o=this.map.layerController.getById(String(n.options.id));o!==void 0&&this.map.layerController.remove(o)}else{let o=this.map.layerController.getById(n.id);o!==void 0&&this.map.layerController.remove(o)}})}sortCatalogItemsByTitle(e,n){let o=e.sort((s,l)=>{let h=s.title.normalize("NFD").replace(/[\u0300-\u036f]/g,""),p=l.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return h<p?-1:h>p?1:0});switch(n){case"asc":return o;case"desc":return o.reverse();default:return e}}addGroupToMap(e,n){let o=e.items.filter(s=>{let l=this.store.state.get(s).added||!1;return this.isLayer(s)&&l===!1});e.sortDirection!==void 0&&(o=this.sortCatalogItemsByTitle(o,e.sortDirection)),this.addLayersToMap(o.reverse(),n)}removeGroupFromMap(e){let n=e.items.filter(o=>{let s=this.store.state.get(o).added||!1;return this.isLayer(o)&&s===!0});this.removeLayersFromMap(n)}static \u0275fac=function(n){return new(n||r)(Ie(Za),Ie(lr))};static \u0275cmp=nt({type:r,selectors:[["igo-catalog-browser"]],inputs:{catalogAllowLegend:"catalogAllowLegend",catalog:"catalog",store:"store",map:"map",toggleCollapsedGroup:"toggleCollapsedGroup"},standalone:!0,features:[lt],decls:3,vars:5,consts:[[3,"navigation","selection"],["ngFor","",3,"ngForOf"],[4,"ngIf"],[3,"addedChange","layerAddedChange","catalog","group","map","state","resolution","catalogAllowLegend","collapsed","toggleCollapsed"],["igoListItem","",3,"addedChange","layer","map","resolution","catalogAllowLegend","added"]],template:function(n,o){n&1&&($(0,"igo-list",0),Pe(1,sFe,2,2,"ng-template",1),le(2,"async"),ee()),n&2&&(z("navigation",!1)("selection",!1),j(),z("ngForOf",ce(2,3,o.store.view.all$())))},dependencies:[yc,Li,Gt,Hte,J3,Qo,Ei],encapsulation:2,changeDetection:0})}return r})();var lFe=(r,i)=>({value:r,email:i}),cFe=r=>({value:r});function uFe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("matTooltip",e.title)("value",e),j(),Qe(" ",e.title," ")}}function dFe(r,i){if(r&1&&($(0,"mat-option",17),_e(1),ee()),r&2){let e=i.$implicit;z("matTooltip",e.url)("value",e),j(),Qe(" ",e.url," ")}}function hFe(r,i){if(r&1){let e=We();$(0,"mat-option",18),ve("click",function(o){return we(e),xe(o.stopPropagation())}),$(1,"p",19),_e(2),ee()()}if(r&2){let e=i.$implicit;z("value",e),j(2),bt(e)}}function pFe(r,i){if(r&1&&($(0,"span")(1,"p",20),_e(2),ee()()),r&2){let e=ne();j(2),Qe(" ",e.languageService.translate.instant("igo.geo.catalog.externalProvider.unavailableWithEmail",Ys(1,lFe,e.addedCatalog.url,e.emailAddress))," ")}}function mFe(r,i){if(r&1&&($(0,"span")(1,"p",20),_e(2),ee()()),r&2){let e=ne();j(2),Qe(" ",e.languageService.translate.instant("igo.geo.catalog.unavailable",fn(1,cFe,e.addedCatalog.url))," ")}}var eF=(()=>{class r{formBuilder;languageService;configService;dialogRef;data;form;defaultAddedCatalogType="wms";addedCatalogType$$;predefinedCatalogsList$=new ut([]);typeCapabilities;predefinedCatalogs=[];store;error=!1;addedCatalog;emailAddress;storeViewAll$$;constructor(e,n,o,s,l){this.formBuilder=e,this.languageService=n,this.configService=o,this.dialogRef=s,this.data=l,this.store=l.store,this.predefinedCatalogs=l.predefinedCatalogs,this.error=l.error,this.addedCatalog=l.addedCatalog,this.form=this.formBuilder.group({id:["",[]],title:["",[]],url:["",[Fn.required]],type:[this.defaultAddedCatalogType,[Fn.required]]})}ngOnInit(){this.store.state.clear(),this.typeCapabilities=Object.keys(Kb),this.addedCatalogType$$=this.form.get("type").valueChanges.subscribe(e=>{e==="wmts"?this.form.get("title").setValidators(Fn.required):this.form.get("title").setValidators([]),this.form.get("title").updateValueAndValidity()}),this.computePredefinedCatalogList(),this.storeViewAll$$=this.store.view.all$().subscribe(()=>this.computePredefinedCatalogList()),this.emailAddress=this.configService.getConfig("emailAddress")}ngOnDestroy(){this.addedCatalogType$$.unsubscribe(),this.storeViewAll$$.unsubscribe()}changeUrlOrTitle(e){this.form.patchValue(e),this.error=!1,this.computePredefinedCatalogList()}computePredefinedCatalogList(){this.predefinedCatalogsList$.next(this.predefinedCatalogs.filter(e=>!this.store.get(e.id)))}addCatalog(e){this.error=!1,this.dialogRef.close(e)}cancel(){this.error=!1,this.dialogRef.close()}static \u0275fac=function(n){return new(n||r)(Ie($c),Ie(Di),Ie(Oi),Ie(Hc),Ie(qc,8))};static \u0275cmp=nt({type:r,selectors:[["igo-add-catalog-dialog"]],standalone:!0,features:[lt],decls:34,vars:25,consts:[["auto2","matAutocomplete"],["auto","matAutocomplete"],["mat-dialog-title","",1,"mat-typography"],["mat-dialog-content","",1,"mat-typography"],[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["type","text","formControlName","title","matInput","",3,"placeholder","matAutocomplete"],[3,"optionSelected"],["matTooltipShowDelay","500",3,"matTooltip","value",4,"ngFor","ngForOf"],["type","text","formControlName","url","placeholder","URL","matInput","",3,"matAutocomplete"],["formControlName","type","placeholder","Type"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","",2,"justify-content","center"],[1,"igo-form-button-group","add-catalog-button-top-padding"],["mat-raised-button","","type","button",3,"click"],["id","addCatalogBtnDialog","mat-raised-button","","type","button","color","primary",3,"click","disabled"],["matTooltipShowDelay","500",3,"matTooltip","value"],[3,"click","value"],["matListItemTitle",""],[1,"error"]],template:function(n,o){if(n&1){let s=We();$(0,"h1",2),_e(1),le(2,"translate"),ee(),$(3,"div",3)(4,"form",4)(5,"div",5)(6,"mat-form-field"),ct(7,"input",6),le(8,"translate"),$(9,"mat-autocomplete",7,0),ve("optionSelected",function(h){return we(s),xe(o.changeUrlOrTitle(h.option.value))}),Pe(11,uFe,2,3,"mat-option",8),le(12,"async"),ee()()(),$(13,"div",5)(14,"mat-form-field"),ct(15,"input",9),$(16,"mat-autocomplete",7,1),ve("optionSelected",function(h){return we(s),xe(o.changeUrlOrTitle(h.option.value))}),Pe(18,dFe,2,3,"mat-option",8),le(19,"async"),ee()()(),$(20,"div",5)(21,"mat-form-field")(22,"mat-select",10),Pe(23,hFe,3,2,"mat-option",11),ee()()()(),Pe(24,pFe,3,4,"span",12)(25,mFe,3,3,"span",12),ee(),$(26,"div",13)(27,"div",14)(28,"button",15),ve("click",function(){return we(s),xe(o.cancel())}),_e(29),le(30,"translate"),ee(),$(31,"button",16),ve("click",function(){return we(s),xe(o.addCatalog(o.form.value))}),_e(32),le(33,"translate"),ee()()()}if(n&2){let s=Xt(10),l=Xt(17);j(),Qe(" ",ce(2,13,"igo.geo.catalog.library.addTitle"),`
`),j(3),z("formGroup",o.form),j(3),sr("placeholder",ce(8,15,"igo.geo.printForm.title")),z("matAutocomplete",s),j(4),z("ngForOf",ce(12,17,o.predefinedCatalogsList$)),j(4),z("matAutocomplete",l),j(3),z("ngForOf",ce(19,19,o.predefinedCatalogsList$)),j(5),z("ngForOf",o.typeCapabilities),j(),z("ngIf",o.error&&o.addedCatalog&&o.emailAddress),j(),z("ngIf",o.error&&o.addedCatalog&&!o.emailAddress),j(4),Qe(" ",ce(30,21,"igo.geo.catalog.library.cancel")," "),j(2),z("disabled",!o.form.valid),j(),Qe(" ",ce(33,23,"igo.geo.catalog.library.add")," ")}},dependencies:[id,pl,Sn,Xu,os,kn,Zu,Sa,Ku,Qu,jr,Gr,gn,Cn,Oh,kh,Nn,Su,Li,Bn,Qt,ti,ho,uo,Io,Ta,Gt,Zc,Vt,co,Ei,Et,Tt],styles:[`mat-form-field[_ngcontent-%COMP%]{width:100%}.add-catalog-button-top-padding[_ngcontent-%COMP%]{padding-top:25px}.igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}.igo-form-button-group[_ngcontent-%COMP%]{text-align:center}button[_ngcontent-%COMP%]{cursor:pointer}button#addCatalogBtnDialog[disabled=true][_ngcontent-%COMP%]{cursor:default;background-color:#0000001f;color:#00000042}.error[_ngcontent-%COMP%]{color:red}
/*# sourceMappingURL=add-catalog-dialog.component-XGMEAX7F.css.map */`]})}return r})();function fFe(r,i){if(r&1){let e=We();$(0,"mat-icon",5),le(1,"translate"),ve("click",function(o){return we(e),xe(o.stopPropagation())}),_e(2," public "),ee()}r&2&&z("matTooltip",ce(1,1,"igo.geo.catalog.externalProvider.catalog"))}function gFe(r,i){if(r&1){let e=We();$(0,"button",6),le(1,"translate"),ve("click",function(o){we(e);let s=ne();return xe(s.removeCatalogFromLibrary(o))}),$(2,"mat-icon"),_e(3,"delete"),ee()()}r&2&&z("matTooltip",ce(1,1,"igo.geo.catalog.library.remove"))}function _Fe(r,i){r&1&&($(0,"button",7),ct(1,"mat-icon"),ee())}var qte=(()=>{class r{catalog;map;catalogRemove=new Ke;get title(){return ed(this.catalog)}removeCatalogFromLibrary(e){e.stopPropagation(),this.catalogRemove.emit()}static \u0275fac=function(n){return new(n||r)};static \u0275cmp=nt({type:r,selectors:[["igo-catalog-library-item"]],inputs:{catalog:"catalog",map:"map"},outputs:{catalogRemove:"catalogRemove"},standalone:!0,features:[lt],decls:7,vars:4,consts:[["matListItemTitle",""],["matListItemMeta",""],["matListItemIcon","","class","igo-external-provider","tooltip-position","below","matTooltipShowDelay","500","color","primary",3,"matTooltip","click",4,"ngIf"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"matTooltip","click",4,"ngIf"],["class","igo-blank","disabled","true","mat-icon-button","",4,"ngIf"],["matListItemIcon","","tooltip-position","below","matTooltipShowDelay","500","color","primary",1,"igo-external-provider",3,"click","matTooltip"],["mat-icon-button","","tooltip-position","below","matTooltipShowDelay","500","color","warn",3,"click","matTooltip"],["disabled","true","mat-icon-button","",1,"igo-blank"]],template:function(n,o){n&1&&($(0,"mat-list-item")(1,"span",0),_e(2),ee(),$(3,"div",1),Pe(4,fFe,3,3,"mat-icon",2)(5,gFe,4,3,"button",3)(6,_Fe,2,0,"button",4),ee()()),n&2&&(j(2),Qe(" ",o.title," "),j(2),z("ngIf",o.catalog.externalProvider),j(),z("ngIf",o.catalog.removable),j(),z("ngIf",!o.catalog.removable))},dependencies:[Io,ks,oc,Ta,Ju,Gt,jt,$t,Qt,ti,Vt,ci,Et,Tt],styles:[`.igo-blank[_ngcontent-%COMP%]{cursor:pointer}.igo-external-provider[_ngcontent-%COMP%]{cursor:help}
/*# sourceMappingURL=catalog-library-item.component-3TYB53UJ.css.map */`],changeDetection:0})}return r})();function yFe(r,i){if(r&1){let e=We();$(0,"igo-catalog-library-item",3),ve("catalogRemove",function(){let o=we(e).$implicit,s=ne();return xe(s.onCatalogRemove(o))})("select",function(){let o=we(e).$implicit,s=ne();return xe(s.onCatalogSelect(o))}),ee()}if(r&2){let e=i.$implicit,n=ne();z("map",n.map)("catalog",e)}}function vFe(r,i){if(r&1){let e=We();$(0,"div",4)(1,"button",5),le(2,"translate"),ve("click",function(){we(e);let o=ne();return xe(o.addCatalogDialog())}),_e(3),le(4,"translate"),$(5,"mat-icon"),_e(6,"library_add"),ee()()()}r&2&&(j(),z("matTooltip",ce(2,2,"igo.geo.catalog.library.addBtn")),j(2),Qe(" ",ce(4,4,"igo.geo.catalog.library.addBtn")," "))}var Yte=(()=>{class r{capabilitiesService;messageService;storageService;dialog;store;map;addCatalogAllowed=!1;predefinedCatalogs=[];catalogSelectChange=new Ke;submitDisabled=!0;addingCatalog$$;get addedCatalogs(){return this.storageService.get("addedCatalogs")||[]}set addedCatalogs(e){this.storageService.set("addedCatalogs",e)}get selectedCatalogId(){return this.storageService.get("selectedCatalogId",gm.SESSION)}set selectedCatalogId(e){this.storageService.set("selectedCatalogId",e,gm.SESSION)}constructor(e,n,o,s){this.capabilitiesService=e,this.messageService=n,this.storageService=o,this.dialog=s}ngOnInit(){if(this.store.state.clear(),this.selectedCatalogId){let e=this.store.all().find(n=>n.id===this.selectedCatalogId);e&&this.onCatalogSelect(e)}this.predefinedCatalogs=this.predefinedCatalogs.map(e=>(e.id=Ph.hashStr((e.type||"wms")+pg(e.url)),e.title=e.title===""||!e.title?e.url:e.title,e))}getCatalogs(){return this.store.view.all$()}onCatalogSelect(e){this.store.state.update(e,{selected:!0,focused:!0},!0),this.selectedCatalogId=e.id,this.catalogSelectChange.emit({selected:!0,catalog:e})}unsubscribeAddingCatalog(){this.addingCatalog$$&&this.addingCatalog$$.unsubscribe()}addCatalog(e){if(!e)return;let n=Ph.hashStr(e.type+pg(e.url)),o=this.predefinedCatalogs.find(s=>s.id===e.id);if(o&&(e.version=o.version,e.externalProvider=o.externalProvider,n=o.id),this.store.get(n)){this.messageService.alert("igo.geo.catalog.library.inlist.message","igo.geo.catalog.library.inlist.title");return}this.unsubscribeAddingCatalog(),this.addingCatalog$$=this.capabilitiesService.getCapabilities(e.type,e.url,e.version).pipe(qr(s=>{if(s.error)return this.addCatalogDialog(!0,e),s.error.caught=!0,s;throw this.messageService.error("igo.geo.catalog.unavailable","igo.geo.catalog.unavailableTitle",void 0,{value:e.url}),s})).subscribe(s=>{let l,h;switch(e.type){case"wms":l=e.title||s.Service.Title,h=e.version||s.version;break;case"arcgisrest":case"imagearcgisrest":case"tilearcgisrest":l=e.title||s.mapName;break;case"wmts":l=e.title||s.ServiceIdentification.ServiceType;break;default:l=e.title}let p=rr.removeUndefined(Object.assign({},o,rr.removeUndefined({id:n,title:l,url:e.url,type:e.type||"wms",externalProvider:e.externalProvider||!1,removable:!0,version:h})));this.store.insert(p);let m=this.addedCatalogs.slice(0);m.push(p),this.addedCatalogs=m,this.unsubscribeAddingCatalog()})}ngOnDestroy(){this.unsubscribeAddingCatalog()}onCatalogRemove(e){this.store.delete(e),this.addedCatalogs=this.addedCatalogs.slice(0).filter(n=>n.id!==e.id)}addCatalogDialog(e,n){this.dialog.open(eF,{width:"700px",data:{predefinedCatalogs:this.predefinedCatalogs,store:this.store,error:e,addedCatalog:n}}).afterClosed().subscribe(s=>{this.addCatalog(s)})}static \u0275fac=function(n){return new(n||r)(Ie(Sl),Ie(Gn),Ie(Kr),Ie(Yc))};static \u0275cmp=nt({type:r,selectors:[["igo-catalog-library"]],inputs:{store:"store",map:"map",addCatalogAllowed:"addCatalogAllowed",predefinedCatalogs:"predefinedCatalogs"},outputs:{catalogSelectChange:"catalogSelectChange"},standalone:!0,features:[lt],decls:4,vars:5,consts:[[3,"navigation"],["ngFor","",3,"ngForOf"],["class","btnAddCatalog",4,"ngIf"],["igoListItem","","color","accent",3,"catalogRemove","select","map","catalog"],[1,"btnAddCatalog"],["mat-raised-button","","matTooltipPosition","above","color","primary",3,"click","matTooltip"]],template:function(n,o){n&1&&($(0,"igo-list",0),Pe(1,yFe,1,2,"ng-template",1),le(2,"async"),ee(),Pe(3,vFe,7,6,"div",2)),n&2&&(z("navigation",!1),j(),z("ngForOf",ce(2,3,o.getCatalogs())),j(2),z("ngIf",o.addCatalogAllowed))},dependencies:[yc,Li,qte,Qo,Gt,Vt,co,Qt,ti,jt,$t,Ei,Et,Tt],styles:[`[_nghost-%COMP%]   igo-list[_ngcontent-%COMP%]{height:auto}[_nghost-%COMP%]   .btnAddCatalog[_ngcontent-%COMP%]{justify-content:center;display:flex;margin:30px 0}
/*# sourceMappingURL=catalog-library.component-DBI7Z4ZB.css.map */`],changeDetection:0})}return r})();var Zte=[Yte,eF];var Eni=[CB,...Zte];function bFe(r,i){if(r&1){let e=We();$(0,"div",3)(1,"mat-button-toggle-group",4),le(2,"async"),eo("ngModelChange",function(o){we(e);let s=ne();return Jn(s.geometryType,o)||(s.geometryType=o),xe(o)}),$(3,"mat-button-toggle",5),_e(4),le(5,"translate"),ee(),$(6,"mat-button-toggle",6),_e(7),le(8,"translate"),ee(),$(9,"mat-button-toggle",7),_e(10),le(11,"translate"),ee()()()}if(r&2){let e=ne();j(),z("disabled",ce(2,8,e.value$)!==void 0),Qn("ngModel",e.geometryType),j(2),z("disabled",e.geometryTypes.indexOf("Point")<0),j(),Qe(" ",ce(5,10,"igo.geo.geometry.point")," "),j(2),z("disabled",e.geometryTypes.indexOf("LineString")<0),j(),Qe(" ",ce(8,12,"igo.geo.geometry.line")," "),j(2),z("disabled",e.geometryTypes.indexOf("Polygon")<0),j(),Qe(" ",ce(11,14,"igo.geo.geometry.polygon")," ")}}function wFe(r,i){if(r&1){let e=We();$(0,"mat-form-field",8)(1,"input",9),eo("ngModelChange",function(o){we(e);let s=ne();return Jn(s.drawGuide,o)||(s.drawGuide=o),xe(o)}),ee(),$(2,"mat-icon",10),_e(3,"adjust "),ee(),$(4,"span",11),_e(5),le(6,"translate"),ee()()}if(r&2){let e=ne();j(),z("placeholder",e.drawGuidePlaceholder),Qn("ngModel",e.drawGuide),j(),z("color","primary"),j(3),bt(ce(6,4,"igo.geo.measure.meters"))}}var AB=class MB{cdRef;value$=new ut(void 0);value$$;set drawControlIsActive(i){this._drawControlIsActive=i,this.cdRef.detectChanges()}get drawControlIsActive(){return this._drawControlIsActive}_drawControlIsActive=!0;set freehandDrawIsActive(i){this._freehandDrawIsActive=i,this.cdRef.detectChanges()}get freehandDrawIsActive(){return this._freehandDrawIsActive}_freehandDrawIsActive=!1;formControl;map;set geometryType(i){this.geometryType$.next(i)}get geometryType(){return this.geometryType$.value}geometryType$=new ut(void 0);geometryTypeField=!1;geometryTypes=["Point","LineString","Polygon"];drawGuideField=!1;set drawGuide(i){this.drawGuide$.next(i)}get drawGuide(){return this.drawGuide$.value}drawGuide$=new ut(0);drawGuidePlaceholder="";measure=!1;controlOptions={};drawStyle;overlayStyle;constructor(i){this.cdRef=i}ngOnInit(){this.value$.next(this.formControl.value?this.formControl.value:void 0),this.value$$=this.formControl.valueChanges.subscribe(i=>{this.value$.next(i||void 0)})}ngOnDestroy(){this.value$$.unsubscribe()}static \u0275fac=function(e){return new(e||MB)(Ie(lr))};static \u0275cmp=nt({type:MB,selectors:[["igo-geometry-form-field"]],inputs:{formControl:"formControl",map:"map",geometryType:"geometryType",geometryTypeField:"geometryTypeField",geometryTypes:"geometryTypes",drawGuideField:"drawGuideField",drawGuide:"drawGuide",drawGuidePlaceholder:"drawGuidePlaceholder",measure:"measure",controlOptions:"controlOptions",drawStyle:"drawStyle",overlayStyle:"overlayStyle"},standalone:!0,features:[lt],decls:5,vars:16,consts:[[3,"formControl","map","geometryType","drawGuide","measure","drawControlIsActive","freehandDrawIsActive","controlOptions","drawStyle","overlayStyle"],["class","geometry-type-toggle",4,"ngIf"],["class","draw-guide-field",4,"ngIf"],[1,"geometry-type-toggle"],[3,"ngModelChange","disabled","ngModel"],["value","Point",3,"disabled"],["value","LineString",3,"disabled"],["value","Polygon",3,"disabled"],[1,"draw-guide-field"],["matInput","","type","number",3,"ngModelChange","placeholder","ngModel"],["matPrefix","",3,"color"],["matSuffix","",1,"draw-guide-units"]],template:function(e,n){e&1&&(ct(0,"igo-geometry-form-field-input",0),le(1,"async"),le(2,"async"),Pe(3,bFe,12,16,"div",1)(4,wFe,7,6,"mat-form-field",2)),e&2&&(z("formControl",n.formControl)("map",n.map)("geometryType",ce(1,12,n.geometryType$))("drawGuide",ce(2,14,n.drawGuide$))("measure",n.measure)("drawControlIsActive",n.drawControlIsActive)("freehandDrawIsActive",n.freehandDrawIsActive)("controlOptions",n.controlOptions)("drawStyle",n.drawStyle)("overlayStyle",n.overlayStyle),j(3),z("ngIf",n.geometryTypeField),j(),z("ngIf",n.drawGuideField))},dependencies:[FC,Sn,os,c0,kn,nc,Sa,Th,Gt,Ed,Gu,mu,jr,Gr,OA,Vc,gn,Cn,jt,$t,Ei,Et,Tt],styles:[`[_nghost-%COMP%]{display:block;width:100%}.geometry-type-toggle[_ngcontent-%COMP%], .draw-guide-field[_ngcontent-%COMP%]{width:100%}.geometry-type-toggle[_ngcontent-%COMP%]{padding:10px;text-align:center}.draw-guide-field[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0 10px}.draw-guide-units[_ngcontent-%COMP%]{padding:10px}
/*# sourceMappingURL=geometry-form-field.component-WN7IE3IH.css.map */`],changeDetection:0})};AB=Hs([r9("geometry"),Xr("design:paramtypes",[lr])],AB);var Ioi=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=_r({type:r});static \u0275inj=gr({imports:[wJ,dJ,hJ,uJ,pJ,xJ,vJ,cJ]})}return r})();var xFe=r=>({column:r,value:130}),SFe=r=>({column:r,value:120}),CFe=(r,i)=>({column:r,value:i}),Xte=()=>["newpage","newimage"];function AFe(r,i){r&1&&($(0,"mat-error"),_e(1),le(2,"translate"),le(3,"translate"),ee()),r&2&&(j(),bt(Ao(3,3,"igo.geo.formValidation.maxLength",fn(6,xFe,ce(2,1,"igo.geo.printForm.title")))))}function MFe(r,i){r&1&&($(0,"mat-error"),_e(1),le(2,"translate"),le(3,"translate"),ee()),r&2&&(j(),bt(Ao(3,3,"igo.geo.formValidation.maxLength",fn(6,SFe,ce(2,1,"igo.geo.printForm.subtitle")))))}function IFe(r,i){if(r&1&&($(0,"mat-error"),_e(1),le(2,"translate"),le(3,"translate"),ee()),r&2){let e=ne();j(),bt(Ao(3,3,"igo.geo.formValidation.maxLength",Ys(6,CFe,ce(2,1,"igo.geo.printForm.comment"),e.maxLength)))}}function EFe(r,i){if(r&1&&(Dr(0),_e(1),le(2,"translate"),Rr()),r&2){let e=ne().$implicit;j(),Qe(" ",ce(2,1,"igo.geo.printForm.legendPositions."+e.value)," ")}}function TFe(r,i){if(r&1&&(Dr(0),_e(1),le(2,"translate"),Rr()),r&2){let e=ne(2);j(),Qe(" ",ce(2,1,e.outputFormat==="Pdf"?"igo.geo.printForm.legendPositions.newpage":"igo.geo.printForm.legendPositions.newimage")," ")}}function FFe(r,i){if(r&1&&($(0,"mat-option",21),Pe(1,EFe,3,3,"ng-container",3)(2,TFe,3,3,"ng-container",3),ee()),r&2){let e=i.$implicit;z("value",e.key),j(),z("ngIf",!Ih(3,Xte).includes(e.value)),j(),z("ngIf",Ih(4,Xte).includes(e.value))}}function PFe(r,i){if(r&1&&($(0,"mat-option",21),_e(1),ee()),r&2){let e=i.$implicit;z("value",e.key),j(),Qe(" ",e.value," ")}}function LFe(r,i){if(r&1&&($(0,"mat-option",21),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e.key),j(),Qe(" ",ce(2,2,"igo.geo.printForm.paperFormats."+e.value)," ")}}function kFe(r,i){if(r&1&&($(0,"mat-option",21),_e(1),ee()),r&2){let e=i.$implicit;z("value",e.key),j(),Qe(" ",e.value," ")}}function OFe(r,i){if(r&1&&($(0,"mat-option",21),_e(1),ee()),r&2){let e=i.$implicit;z("value",e),j(),Qe(" ",e," ")}}function DFe(r,i){if(r&1&&($(0,"mat-option",21),_e(1),le(2,"translate"),ee()),r&2){let e=i.$implicit;z("value",e.key),j(),Qe(" ",ce(2,2,"igo.geo.printForm."+e.value)," ")}}var IB=(()=>{class r{formBuilder;mediaService;form;outputFormats=HL;paperFormats=Xd;orientations=Cp;resolutions=[...HU];imageFormats=qL;legendPositions=YL;isPrintService=!0;disabled$;get imageFormat(){return this.imageFormatField.value}set imageFormat(e){this.imageFormatField.setValue(e||qL.Jpeg,{onlySelf:!0})}get outputFormat(){return this.outputFormatField.value}set outputFormat(e){this.outputFormatField.setValue(e||HL.Pdf,{onlySelf:!0})}get paperFormat(){return this.paperFormatField.value}set paperFormat(e){this.paperFormatField.setValue(e||Xd.Letter,{onlySelf:!0})}get orientation(){return this.orientationField.value}set orientation(e){this.orientationField.setValue(e||Cp.landscape,{onlySelf:!0})}get resolution(){return this.resolutionField.value}set resolution(e){this.resolutionField.setValue(e||"96",{onlySelf:!0})}get legendPosition(){return this.legendPositionField.value}set legendPosition(e){this.legendPositionField.setValue(e||YL.none,{onlySelf:!0})}get title(){return this.titleField.value}set title(e){this.titleField.setValue(e,{onlySelf:!0})}get subtitle(){return this.subtitleField.value}set subtitle(e){this.subtitleField.setValue(e,{onlySelf:!0})}get comment(){return this.commentField.value}set comment(e){this.commentField.setValue(e,{onlySelf:!0})}get showProjection(){return this.showProjectionField.value}set showProjection(e){this.showProjectionField.setValue(e,{onlySelf:!0})}get showScale(){return this.showScaleField.value}set showScale(e){this.showScaleField.setValue(e,{onlySelf:!0})}get showLegend(){return this.showLegendField.value}set showLegend(e){this.showLegendField.setValue(e,{onlySelf:!0})}get doZipFile(){return this.doZipFileField.value}set doZipFile(e){this.doZipFileField.setValue(e,{onlySelf:!0})}get showNorth(){return this.showNorthArrowField.value}set showNorth(e){this.showNorthArrowField.setValue(e,{onlySelf:!0})}get outputFormatField(){return this.form.controls.outputFormat}get paperFormatField(){return this.form.controls.paperFormat}get imageFormatField(){return this.form.controls.imageFormat}get orientationField(){return this.form.controls.orientation}get resolutionField(){return this.form.controls.resolution}get commentField(){return this.form.controls.comment}get showProjectionField(){return this.form.controls.showProjection}get showScaleField(){return this.form.controls.showScale}get showLegendField(){return this.form.controls.showLegend}get doZipFileField(){return this.form.controls.doZipFile}get showNorthArrowField(){return this.form.controls.showNorth}get titleField(){return this.form.controls.title}get subtitleField(){return this.form.controls.subtitle}get legendPositionField(){return this.form.controls.legendPosition}submit=new Ke;maxLength=180;constructor(e,n){this.formBuilder=e,this.mediaService=n,this.form=this.formBuilder.group({title:["",[Fn.minLength(0),Fn.maxLength(130)]],subtitle:["",[Fn.minLength(0),Fn.maxLength(120)]],comment:["",[Fn.minLength(0),Fn.maxLength(this.maxLength)]],outputFormat:["",[Fn.required]],paperFormat:["",[Fn.required]],imageFormat:["",[Fn.required]],resolution:["",[Fn.required]],orientation:["",[Fn.required]],legendPosition:["",[Fn.required]],showProjection:!1,showScale:!1,showLegend:!1,doZipFile:[{hidden:this.isPrintService}],showNorthArrow:!1})}ngOnInit(){this.doZipFileField.setValue(!1),this.mediaService.isMobile()&&(this.resolutions=this.resolutions.filter(e=>e!=="300"))}handleFormSubmit(e,n){e.isPrintService=this.isPrintService,n&&this.submit.emit(e)}toggleImageSaveProp(){this.outputFormatField.value==="Image"?(this.isPrintService=!1,this.commentField.clearValidators(),this.commentField.updateValueAndValidity()):this.isPrintService=!0}changeCommentLength(){switch(this.paperFormat){case Xd.A0:this.maxLength=this.orientation===Cp.landscape?900:600;break;case Xd.A1:this.maxLength=this.orientation===Cp.landscape?600:400;break;case Xd.A2:this.maxLength=this.orientation===Cp.landscape?400:300;break;case Xd.A3:this.maxLength=this.orientation===Cp.landscape?300:200;break;case Xd.A4:this.maxLength=this.orientation===Cp.landscape?200:100;break;case Xd.A5:this.maxLength=this.orientation===Cp.landscape?120:80;break;case Xd.Letter:this.maxLength=this.orientation===Cp.landscape?180:140;break;default:this.maxLength=this.orientation===Cp.landscape?200:140;break}this.commentField.setValidators([Fn.maxLength(this.maxLength)]),this.commentField.updateValueAndValidity()}static \u0275fac=function(n){return new(n||r)(Ie($c),Ie(Wc))};static \u0275cmp=nt({type:r,selectors:[["igo-print-form"]],inputs:{disabled$:"disabled$",imageFormat:"imageFormat",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",resolution:"resolution",legendPosition:"legendPosition",title:"title",subtitle:"subtitle",comment:"comment",showProjection:"showProjection",showScale:"showScale",showLegend:"showLegend",doZipFile:"doZipFile",showNorth:"showNorth"},outputs:{submit:"submit"},standalone:!0,features:[lt],decls:98,vars:107,consts:[[1,"igo-form",3,"formGroup"],[1,"igo-input-container"],["matInput","","formControlName","title",3,"placeholder"],[4,"ngIf"],["matInput","","formControlName","subtitle",3,"placeholder"],["matInput","","formControlName","comment",3,"placeholder"],[1,"igo-input-container","slide-toggle-container"],[1,"print-slide-toggle-container"],["formControlName","showProjection",1,"print-option",3,"labelPosition"],["formControlName","showScale",1,"print-option",3,"labelPosition"],["formControlName","doZipFile",1,"print-option",3,"labelPosition"],["formControlName","showNorthArrow",1,"print-option",3,"labelPosition"],["formControlName","legendPosition",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],["formControlName","outputFormat",3,"selectionChange","placeholder"],["formControlName","paperFormat",3,"selectionChange","placeholder"],["formControlName","imageFormat",3,"placeholder"],["formControlName","resolution",3,"placeholder"],["formControlName","orientation",3,"selectionChange","placeholder"],[1,"igo-form-button-group","print-button-top-padding"],["mat-raised-button","","type","button",3,"click","disabled"],[3,"value"]],template:function(n,o){n&1&&($(0,"form",0)(1,"div",1)(2,"mat-form-field")(3,"mat-label"),_e(4),le(5,"translate"),ee(),ct(6,"input",2),le(7,"translate"),Pe(8,AFe,4,8,"mat-error",3),ee()(),$(9,"div",1)(10,"mat-form-field")(11,"mat-label"),_e(12),le(13,"translate"),ee(),ct(14,"input",4),le(15,"translate"),Pe(16,MFe,4,8,"mat-error",3),ee()(),$(17,"div",1)(18,"mat-form-field")(19,"mat-label"),_e(20),le(21,"translate"),ee(),ct(22,"input",5),le(23,"translate"),Pe(24,IFe,4,9,"mat-error",3),ee()(),$(25,"div",6)(26,"div",7)(27,"mat-slide-toggle",8),_e(28),le(29,"translate"),ee(),$(30,"mat-slide-toggle",9),_e(31),le(32,"translate"),ee(),$(33,"mat-slide-toggle",10),_e(34),le(35,"translate"),ee(),$(36,"mat-slide-toggle",11),_e(37),le(38,"translate"),ee()()(),$(39,"div",1)(40,"mat-form-field")(41,"mat-label"),_e(42),le(43,"translate"),ee(),$(44,"mat-select",12),le(45,"translate"),Pe(46,FFe,3,5,"mat-option",13),le(47,"keyvalue"),ee()()(),$(48,"div",1)(49,"mat-form-field")(50,"mat-label"),_e(51),le(52,"translate"),ee(),$(53,"mat-select",14),le(54,"translate"),ve("selectionChange",function(){return o.toggleImageSaveProp()}),Pe(55,PFe,2,2,"mat-option",13),le(56,"keyvalue"),ee()()(),$(57,"div",1)(58,"mat-form-field")(59,"mat-label"),_e(60),le(61,"translate"),ee(),$(62,"mat-select",15),le(63,"translate"),ve("selectionChange",function(){return o.changeCommentLength()}),Pe(64,LFe,3,4,"mat-option",13),le(65,"keyvalue"),ee()()(),$(66,"div",1)(67,"mat-form-field")(68,"mat-label"),_e(69),le(70,"translate"),ee(),$(71,"mat-select",16),le(72,"translate"),Pe(73,kFe,2,2,"mat-option",13),le(74,"keyvalue"),ee()()(),$(75,"div",1)(76,"mat-form-field")(77,"mat-label"),_e(78),le(79,"translate"),le(80,"translate"),ee(),$(81,"mat-select",17),le(82,"translate"),Pe(83,OFe,2,2,"mat-option",13),ee()()(),$(84,"div",1)(85,"mat-form-field")(86,"mat-label"),_e(87),le(88,"translate"),ee(),$(89,"mat-select",18),le(90,"translate"),ve("selectionChange",function(){return o.changeCommentLength()}),Pe(91,DFe,3,4,"mat-option",13),le(92,"keyvalue"),ee()()(),$(93,"div",19)(94,"button",20),le(95,"async"),ve("click",function(){return o.handleFormSubmit(o.form.value,o.form.valid)}),_e(96),le(97,"translate"),ee()()()),n&2&&(z("formGroup",o.form),j(4),bt(ce(5,47,"igo.geo.printForm.title")),j(2),sr("placeholder",ce(7,49,"igo.geo.printForm.title")),j(2),z("ngIf",o.titleField.errors==null?null:o.titleField.errors.maxlength),j(4),bt(ce(13,51,"igo.geo.printForm.subtitle")),j(2),sr("placeholder",ce(15,53,"igo.geo.printForm.subtitle")),j(2),z("ngIf",o.subtitleField.errors==null?null:o.subtitleField.errors.maxlength),j(4),bt(ce(21,55,"igo.geo.printForm.comment")),j(2),sr("placeholder",ce(23,57,"igo.geo.printForm.comment")),j(2),z("ngIf",o.commentField.errors==null?null:o.commentField.errors.maxlength),j(3),z("labelPosition","before"),j(),Qe(" ",ce(29,59,"igo.geo.printForm.showProjection")," "),j(2),z("labelPosition","before"),j(),Qe(" ",ce(32,61,"igo.geo.printForm.showScale")," "),j(2),fo("display",o.isPrintService?"none":""),z("labelPosition","before"),j(),Qe(" ",ce(35,63,"igo.geo.printForm.doZipFile")," "),j(2),z("labelPosition","before"),j(),Qe(" ",ce(38,65,"igo.geo.printForm.showNorthArrow")," "),j(5),bt(ce(43,67,"igo.geo.printForm.legendPosition")),j(2),sr("placeholder",ce(45,69,"igo.geo.printForm.legendPosition")),j(2),z("ngForOf",ce(47,71,o.legendPositions)),j(5),bt(ce(52,73,"igo.geo.printForm.outputFormat")),j(2),sr("placeholder",ce(54,75,"igo.geo.printForm.outputFormat")),j(2),z("ngForOf",ce(56,77,o.outputFormats)),j(2),fo("display",o.isPrintService?"block":"none"),j(3),bt(ce(61,79,"igo.geo.printForm.paperFormat")),j(2),sr("placeholder",ce(63,81,"igo.geo.printForm.paperFormat")),j(2),z("ngForOf",ce(65,83,o.paperFormats)),j(2),fo("display",o.isPrintService?"none":"block"),j(3),bt(ce(70,85,"igo.geo.printForm.imageFormat")),j(2),sr("placeholder",ce(72,87,"igo.geo.printForm.imageFormat")),j(2),z("ngForOf",ce(74,89,o.imageFormats)),j(5),Nf("",ce(79,91,"igo.geo.printForm.resolution")," (",ce(80,93,"igo.geo.printForm.resolutionUnit"),")"),j(3),sr("placeholder",ce(82,95,"igo.geo.printForm.resolution")),j(2),z("ngForOf",o.resolutions),j(),fo("display",o.isPrintService?"block":"none"),j(3),bt(ce(88,97,"igo.geo.printForm.orientation")),j(2),sr("placeholder",ce(90,99,"igo.geo.printForm.orientation")),j(2),z("ngForOf",ce(92,101,o.orientations)),j(3),z("disabled",!o.form.valid||ce(95,103,o.disabled$)),j(2),Qe(" ",ce(97,105,"igo.geo.printForm.saveBtn")," "))},dependencies:[Sn,Xu,os,kn,Zu,Sa,Ku,Qu,jr,Gr,Mo,Q7,gn,Cn,Gt,bl,js,ho,uo,Nn,Li,Bn,Vt,co,Ei,E1,Et,Tt],styles:[`[_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}[_nghost-%COMP%]   .slide-toggle-container[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]{width:100%;padding:0 8px}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-form-field{width:100%}[_nghost-%COMP%]   .print-slide-toggle-container[_ngcontent-%COMP%]   mat-slide-toggle[_ngcontent-%COMP%]     .mdc-label{margin-left:0;width:calc(100% - 60px)}[_nghost-%COMP%]   .print-option[_ngcontent-%COMP%]{display:block;margin-bottom:12px}[_nghost-%COMP%]   .igo-form[_ngcontent-%COMP%]{padding:10px 5px 5px}[_nghost-%COMP%]   .igo-form-button-group[_ngcontent-%COMP%]{text-align:center}
/*# sourceMappingURL=print-form.component-4OWVUL6O.css.map */`]})}return r})();var RFe=(()=>{class r{printService;disabled$=new ut(!1);get map(){return this._map}set map(e){this._map=e}_map;get outputFormat(){return this._outputFormat}set outputFormat(e){this._outputFormat=e}_outputFormat;get paperFormat(){return this._paperFormat}set paperFormat(e){this._paperFormat=e}_paperFormat;get orientation(){return this._orientation}set orientation(e){this._orientation=e}_orientation;get imageFormat(){return this._imageFormat}set imageFormat(e){this._imageFormat=e}_imageFormat;get legendPosition(){return this._legendPosition}set legendPosition(e){this._legendPosition=e}_legendPosition;get resolution(){return this._resolution}set resolution(e){this._resolution=e}_resolution;constructor(e){this.printService=e}handleFormSubmit(e){if(this.disabled$.next(!0),e.isPrintService===!0)this.printService.print(this.map,e).pipe(Ol(1)).subscribe(()=>{this.disabled$.next(!1)});else{let n=1;e.showLegend&&n++,e.imageFormat.toLowerCase()==="tiff"&&n++,e.legendPosition==="newpage"&&n++,this.printService.defineNbFileToProcess(n),this.printService.downloadMapImage(this.map,e.resolution,e.imageFormat,e.showProjection,e.showScale,e.title,e.subtitle,e.comment,e.doZipFile,e.legendPosition,e.showNorthArrow).pipe(Ol(1)).subscribe(()=>{this.disabled$.next(!1)})}}static \u0275fac=function(n){return new(n||r)(Ie(JM))};static \u0275cmp=nt({type:r,selectors:[["igo-print"]],inputs:{map:"map",outputFormat:"outputFormat",paperFormat:"paperFormat",orientation:"orientation",imageFormat:"imageFormat",legendPosition:"legendPosition",resolution:"resolution"},standalone:!0,features:[lt],decls:1,vars:7,consts:[[3,"submit","outputFormat","paperFormat","orientation","imageFormat","resolution","legendPosition","disabled$"]],template:function(n,o){n&1&&($(0,"igo-print-form",0),ve("submit",function(l){return o.handleFormSubmit(l)}),ee()),n&2&&z("outputFormat",o.outputFormat)("paperFormat",o.paperFormat)("orientation",o.orientation)("imageFormat",o.imageFormat)("resolution",o.resolution)("legendPosition",o.legendPosition)("disabled$",o.disabled$)},dependencies:[IB],encapsulation:2})}return r})();function Mai(...r){let i=[{provide:jy,useClass:jy},ZU()];for(let e of r)i.push(...e.providers);return i}var EB=function(r){return r[r.OSRM=0]="OSRM",r}(EB||{});var Kte=(()=>{class r extends L0{_http;_config;get options(){return this._options}set options(e){this._options=e}get sourceName(){return this._options.name}set sourceName(e){this._options.name=e}get baseUrl(){return this._options.baseUrl}set baseUrl(e){this._options.baseUrl=e}get url(){return`${this.baseUrl}${this.getEnabledProfile().name}/`}get profiles(){return this._options.profiles}set profiles(e){this._options.profiles=e}_options;constructor(e,n){if(super(),this._http=e,this._config=n,this._options=this._config.getConfig("directionsSources.osrm"),this.baseUrl||(this.baseUrl="/apis/itineraire/route/v1/"),this.sourceName||(this.sourceName="OSRM Qu\xE9bec"),this.profiles)this.profiles.find(o=>o.enabled)||(this.profiles[0].enabled=!0);else{let o={enabled:!0,name:"driving"};this.profiles=[o]}}getSourceName(){return this.sourceName}getEnabledProfile(){return this.profiles.find(e=>e.enabled)}getProfileWithAuthorization(){return this.profiles.find(e=>e.authorization)}route(e,n={}){let o=this.getRouteParams(n);return this.getRoute(e,o)}getRoute(e,n){let o=this.url;return this._http.get(o+e.join(";"),{params:n}).pipe(Nt(s=>this.extractRoutesData(s)))}extractRoutesData(e){let n=[];return e.routes.forEach(o=>{n.push(this.formatRoute(o,e.waypoints))}),n}getRouteParams(e={}){return e.alternatives=e.alternatives!==void 0?e.alternatives:!0,e.steps=e.steps!==void 0?e.steps:!0,e.geometries=e.geometries!==void 0?e.geometries:"geojson",e.overview=e.overview!==void 0?e.overview:!1,e.continue_straight=e.continue_straight!==void 0?e.continue_straight:!1,new fs({fromObject:{alternatives:e.alternatives?"true":"false",overview:e.overview?"simplified":"full",steps:e.steps?"true":"false",geometries:e.geometries?e.geometries:"geojson",continue_straight:e.continue_straight?"true":"false"}})}formatRoute(e,n){let o=[];return e.legs.forEach(s=>{s.steps.forEach(l=>{o.push(l)})}),{id:rn(),title:e.legs[0].summary,source:this.url,sourceType:rR.Route,order:1,format:iR.GeoJSON,icon:"directions",projection:"EPSG:4326",waypoints:n,distance:e.distance,duration:e.duration,geometry:e.geometry,legs:e.legs,steps:o,weight:e.weight,weight_name:e.weight_name}}static \u0275fac=function(n){return new(n||r)(pt(Er),pt(Oi))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function NFe(r,i){return new Kte(r,i)}function BFe(){return{provide:L0,useFactory:NFe,multi:!0,deps:[Er,Oi]}}function zai(){return{kind:EB.OSRM,providers:[BFe()]}}function Tci(r,i){let e=[i?.analytics&&{provide:"searchAnalytics",useValue:i.analytics},{provide:ch,useClass:ch},R3()].filter(Boolean);for(let n of r)e.push(...n.providers);return e}var tF=class r extends So{http;languageService;static id="cadastre";static type=vr;constructor(i,e,n,o){super(o,n),this.http=i,this.languageService=e}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"Cadastre (Qu\xE9bec)",searchUrl:"https://carto.cptaq.gouv.qc.ca/php/find_lot_v1.php?"}}search(i,e){i=i.replace(/ /g,""),i=i.replace(/,+/g,","),i=i.endsWith(",")?i.slice(0,-1):i,i=i.startsWith(",")?i.substr(1):i;let n=this.computeSearchRequestParams(i,e||{});return!n.get("numero")||!n.get("numero").match(/^[0-9,]+$/g)?ai([]):this.getCadastre(i,n)}getCadastre(i,e){return this.http.get(this.searchUrl,{params:e,responseType:"text"}).pipe(Nt(n=>this.extractResults(n,i)))}computeSearchRequestParams(i,e){return new fs({fromObject:Object.assign({numero:i,epsg:"4326"},this.params,e.params||{})})}extractResults(i,e){return i.split("<br />").filter(n=>n.length>0).map(n=>this.dataToResult(n,e))}dataToResult(i,e){let n=i.split(";"),o=n[0],s=n[7],l=this.computeGeometry(s),h={NoLot:o,Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"},p=[this.getId(),"cadastre",o].join(".");return{source:this,meta:{dataType:vr,id:p,title:o,score:lh(e.trim(),o),icon:"location_on"},data:{type:vr,projection:"EPSG:4326",geometry:l,properties:h,meta:{id:p,title:o}}}}computeGeometry(i){let e=new _d().readFeature(i,{dataProjection:"EPSG:4326",featureProjection:"EPSG:4326"});return{type:e.getGeometry().getType(),coordinates:e.getGeometry().getCoordinates()}}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[String,fs]),Xr("design:returntype",$r)],tF.prototype,"getCadastre",null);var iF=class r extends So{http;static id="nominatim";static type=vr;constructor(i,e,n){super(e,n),this.http=i}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"Nominatim (OSM)",searchUrl:"https://nominatim.openstreetmap.org/search",settings:[{type:"checkbox",title:"results type",name:"amenity",values:[{title:"igo.geo.search.nominatim.type.food",value:"bar,bbq,biergaten,cafe,drinking_water,fast_food,food_court,ice_cream,pub,restaurant",enabled:!1},{title:"igo.geo.search.nominatim.type.health",value:"baby_hatch,clinic,dentist,doctors,hospital,nursing_home,pharmacy,social_facility,veterinary",enabled:!1},{title:"igo.geo.search.nominatim.type.entertainment",value:"arts_centre,brothel,casino,cinema,community_center_fountain,gambling,nightclub,planetarium                           ,public_bookcase,social_centre,stripclub,studio,swingerclub,theatre,internet_cafe",enabled:!1},{title:"igo.geo.search.nominatim.type.finance",value:"atm,bank,bureau_de_change",enabled:!1}]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"10",value:10,enabled:!0},{title:"20",value:20,enabled:!1},{title:"50",value:50,enabled:!1}]},{type:"radiobutton",title:"restrictExtent",name:"countrycodes",values:[{title:"igo.geo.search.nominatim.country.canada",value:"CA",enabled:!0},{title:"igo.geo.search.nominatim.country.all",value:null,enabled:!1}]},{type:"radiobutton",title:"multiple object",name:"dedupe",values:[{title:"igo.geo.search.searchSources.settings.true",value:0,enabled:!1},{title:"igo.geo.search.searchSources.settings.false",value:1,enabled:!0}]}]}}search(i,e){let n=this.computeSearchRequestParams(i,e||{});return n.get("q")?this.getSearch(i,n):ai([])}getSearch(i,e){return this.http.get(this.searchUrl,{params:e}).pipe(Nt(n=>this.extractResults(n,i)))}computeSearchRequestParams(i,e){return new fs({fromObject:Object.assign({q:this.computeTerm(i),format:"json"},this.params,e.params||{})})}extractResults(i,e){return i.map(n=>this.dataToResult(n,e))}dataToResult(i,e){let n=this.computeProperties(i),o=this.computeGeometry(i),s=this.computeExtent(i),l=[this.getId(),"place",i.place_id].join(".");return{source:this,meta:{dataType:vr,id:l,title:i.display_name,icon:"location_on",score:lh(e.trim(),i.display_name)},data:{type:vr,projection:"EPSG:4326",geometry:o,extent:s,properties:n,meta:{id:l,title:i.display_name}}}}computeProperties(i){return{display_name:i.display_name,place_id:i.place_id,osm_type:i.osm_type,class:i.class,type:i.type}}computeGeometry(i){return{type:"Point",coordinates:[parseFloat(i.lon),parseFloat(i.lat)]}}computeExtent(i){return[parseFloat(i.boundingbox[2]),parseFloat(i.boundingbox[0]),parseFloat(i.boundingbox[3]),parseFloat(i.boundingbox[1])]}computeTerm(i){return this.computeTermTags(i)}computeTermTags(i){let e=super.getHashtagsValid(i,"amenity");return e?e.length?(i=i.replace(/(#[^\s]*)/g,""),e.forEach(n=>{i+="+["+n+"]"}),i):null:this.computeTermSettings(i)}computeTermSettings(i){return this.options.settings.forEach(e=>{e.name==="amenity"&&e.values.forEach(n=>{n.enabled&&typeof n.value=="string"&&n.value.split(",").forEach(s=>{i+="+["+s+"]"})})}),i}static \u0275fac=function(e){return new(e||r)(pt(Er),pt("options"),pt(Kr))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[String,fs]),Xr("design:returntype",$r)],iF.prototype,"getSearch",null);var rF=class r extends So{http;languageService;static id="storedqueries";static type=vr;static propertiesBlacklist=["boundedBy","id","coord_x","coord_y"];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(i,e,n,o){if(super(o,n),this.http=i,this.languageService=e,this.storedQueriesOptions=o,this.storedQueriesOptions&&!this.storedQueriesOptions.available)return;let s="rtss",l=[{name:"rtss",defaultValue:"-99"},{name:"chainage",defaultValue:"0",splitPrefix:"\\+"}],h="text/xml; subtype=gml/3.1.1",p="EPSG:4326",m="title";if(this.storedQueriesOptions||(console.log(" No configuration for this search source (storedqueries). You will use the default values"),this.storedQueriesOptions={storedquery_id:s,fields:l,outputformat:h,srsname:p,resultTitle:m},this.resultTitle=m,console.log("Default values",this.storedQueriesOptions)),!this.storedQueriesOptions.storedquery_id){let g='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(g)}if(!this.storedQueriesOptions.fields)throw new Error('Stored Queries :You have to set "fields" into options. ex: fields: {"name": "rtss", "defaultValue": "-99"}');if(this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")&&this.storedQueriesOptions.outputformat.toLowerCase().includes("getfeaturebyid")){let g="You must set a geojson format for your stored query. This is due to an openlayers issue)";throw g+=" (wfs 1.1.0 & gml 3.1.1 limitation)",new Error(g)}this.storedQueriesOptions.fields instanceof Array||(this.storedQueriesOptions.fields=[this.storedQueriesOptions.fields]),this.multipleFieldsQuery=this.storedQueriesOptions.fields.length>1,this.storedQueriesOptions.fields.forEach((g,y)=>{if(this.multipleFieldsQuery&&!g.splitPrefix&&y!==0)throw new Error("Stored Queries :You must set a field spliter into your field definition (optional for the first one!)");if(!g.defaultValue)throw new Error("Stored Queries :You must set a field default value into your field definition")}),this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"Stored Queries",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}search(i,e){let n=this.termSplitter(i,this.storedQueriesOptions.fields),o=this.computeRequestParams(e||{},n);return this.options.params=this.options.params?this.options.params:{},this.options.params.page=e.page?String(e.page):"1",this.getSearch(i,o)}getSearch(i,e){return new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:e,responseType:"text"}).pipe(Nt(n=>{let o=this.extractResults(this.extractWFSData(n),i);if(o.sort((s,l)=>s.meta.score>l.meta.score||s.meta.score===l.meta.score&&s.meta.titleHtml<l.meta.titleHtml?1:-1),o.reverse(),o.length>Number(this.options.params.limit)){let s=Number(this.options.params.limit)*Number(this.options.params.page),l=o.length;o=o.slice(0,s),s<l?o[o.length-1].meta.nextPage=!0:o[o.length-1].meta.nextPage=!1}return o})):this.http.get(this.searchUrl,{params:e}).pipe(Nt(n=>this.extractResults(this.extractWFSData(n),i)))}getFormatFromOptions(){let i,e=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(e)&&(i=Qr),n.test(e)&&(i=Wh),new i}extractWFSData(i){let e=this.getFormatFromOptions(),n=Qr,o=e.readFeatures(i);return JSON.parse(new n().writeFeatures(o))}termSplitter(i,e){let n={},o=i,s=0;return e.forEach(h=>{n[h.name]=h.defaultValue;let p=new RegExp(h.splitPrefix+"(.+)","i");p.test(o)&&(s=h.splitPrefix?s+=1:s,o=o.split(p)[1])}),s===0?(n[e[0].name]=i,n):(o=i,[...e].reverse().forEach(h=>{let p=new RegExp(h.splitPrefix||"(.+)","i");if(o||o!==""){let m=o.split(p);o=m[0],m[1]&&(n[h.name]=m[1].trim())}}),n)}computeRequestParams(i,e){let n=this.storedQueriesOptions.storedquery_id.toLowerCase().includes("getfeaturebyid")?"2.0.0":"1.1.0";return new fs({fromObject:Object.assign({service:"wfs",version:n,request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},e,this.params,i.params||{})})}extractResults(i,e){return i.features.map(n=>this.dataToResult(n,e))}dataToResult(i,e){let n=this.computeProperties(i),o=[this.getId(),n.type,i.id].join("."),s=i.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:vr,projection:"EPSG:4326",geometry:i.geometry,properties:n,meta:{id:o,title:i.properties[s]}},meta:{dataType:vr,id:o,title:i.properties.title,titleHtml:i.properties[s],icon:"location_on",score:i.properties.title?lh(e.trim(),i.properties.title):lh(e.trim(),i.properties[s])}}}computeProperties(i){return Object.assign({},rr.removeKeys(i.properties,r.propertiesBlacklist),{Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"})}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[String,fs]),Xr("design:returntype",$r)],rF.prototype,"getSearch",null);var nF=class r extends So{http;languageService;static id="storedqueriesreverse";static type=vr;static propertiesBlacklist=[];resultTitle;storedQueriesOptions;multipleFieldsQuery;constructor(i,e,n,o){if(super(o,n),this.http=i,this.languageService=e,this.storedQueriesOptions=o,!(!this.storedQueriesOptions||this.storedQueriesOptions&&!this.storedQueriesOptions.available)){if(!this.storedQueriesOptions.storedquery_id){let s='Stored Queries :You have to set "storedquery_id" into StoredQueries options. ex: storedquery_id: "nameofstoredquerie"';throw new Error(s)}if(!this.storedQueriesOptions.longField)throw new Error('Stored Queries :You have to set "longField" to map the longitude coordinate to the query params.');if(!this.storedQueriesOptions.latField)throw new Error('Stored Queries :You have to set "latField" to map the latitude coordinate to the query params.');this.storedQueriesOptions.outputformat=this.storedQueriesOptions.outputformat||"text/xml; subtype=gml/3.1.1",this.storedQueriesOptions.srsname=this.storedQueriesOptions.srsname||"EPSG:4326",this.storedQueriesOptions.resultTitle=this.storedQueriesOptions.resultTitle||this.resultTitle}}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"Stored Queries (reverse)",searchUrl:"https://ws.mapserver.transports.gouv.qc.ca/swtq"}}reverseSearch(i,e){let n=this.computeRequestParams(i,e||{});return this.getReverseSearch(n)}getReverseSearch(i){return(new RegExp(".*?gml.*?","i").test(this.storedQueriesOptions.outputformat)?this.http.get(this.searchUrl,{params:i,responseType:"text"}):this.http.get(this.searchUrl,{params:i})).pipe(Nt(o=>this.extractResults(this.extractWFSData(o))))}getFormatFromOptions(){let i,e=this.storedQueriesOptions.outputformat,n=new RegExp(".*?gml.*?","i");return new RegExp(".*?json.*?","i").test(e)&&(i=Qr),n.test(e)&&(i=Wh),new i}extractWFSData(i){let e=this.getFormatFromOptions(),n=Qr,o=e.readFeatures(i);return JSON.parse(new n().writeFeatures(o))}computeRequestParams(i,e){let n={};return n[this.storedQueriesOptions.longField]=i[0],n[this.storedQueriesOptions.latField]=i[1],new fs({fromObject:Object.assign({service:"WFS",version:"1.1.0",request:"GetFeature",storedquery_id:this.storedQueriesOptions.storedquery_id,srsname:this.storedQueriesOptions.srsname,outputformat:this.storedQueriesOptions.outputformat},n,this.params,e.params||{})})}extractResults(i){return i.features.map(e=>this.dataToResult(e))}dataToResult(i){let e=this.computeProperties(i),n=[this.getId(),e.type,i.id].join("."),o=i.properties[this.storedQueriesOptions.resultTitle]?this.storedQueriesOptions.resultTitle:this.resultTitle;return{source:this,data:{type:vr,projection:"EPSG:4326",geometry:i.geometry,properties:e,meta:{id:n,title:i.properties[o]}},meta:{dataType:vr,id:n,title:i.properties[o],icon:"location_on"}}}computeProperties(i){let e=rr.removeKeys(i.properties,r.propertiesBlacklist),n={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign(e,{type:i.properties.doc_type},n)}static \u0275fac=function(e){return new(e||r)(pt(Er),pt(Di),pt(Kr),pt("options"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})};Hs([Nl({maxCacheCount:20,cacheHasher:Fh}),Xr("design:type",Function),Xr("design:paramtypes",[fs]),Xr("design:returntype",$r)],nF.prototype,"getReverseSearch",null);var TB=(()=>{class r extends So{languageService;static id="workspace";static type=vr;title$=new ut("");get title(){return this.title$.getValue()}constructor(e,n,o){super(o,n),this.languageService=e,this.languageService.translate.get(this.options.title).subscribe(s=>this.title$.next(s))}getId(){return r.id}getType(){return r.type}getDefaultOptions(){return{title:"igo.geo.search.workspace.name",searchUrl:void 0,settings:[{type:"checkbox",title:"datasets",name:"datasets",values:[]},{type:"radiobutton",title:"results limit",name:"limit",values:[{title:"1",value:1,enabled:!1},{title:"5",value:5,enabled:!0},{title:"10",value:10,enabled:!1},{title:"25",value:25,enabled:!1},{title:"50",value:50,enabled:!1}]}]}}search(e,n){let s=this.settings.find(g=>g.name==="limit").values.find(g=>g.enabled).value||5;this.options.params.limit=s.toLocaleString();let l=[];this.options.params.page=(n.page||1).toLocaleString();let h=n.page||1,p=this.options.params.datasets.split(",");this.featureStoresWithIndex.filter(g=>g.searchDocument&&p.includes(g.layer.title)).map(g=>{let y=e;g.searchDocument.search(y,{limit:h*s}).map(_=>{let w=_.field;_.result.map(A=>{let k=g.index.get(A),R=lh(y.trim(),k.properties[w]);l.push({index:A,feature:k,layer:g.layer,field:w,score:R})})})}),l.sort((g,y)=>g.score>y.score?-1:1);let m=[],f=[];return l.map(g=>{m.includes(g.index)||(m.push(g.index),f.push(g))}),ai(this.extractResults(f.sort((g,y)=>g.score>y.score?-1:1).slice(0,h*s)))}extractResults(e){return e.map(n=>this.dataToResult(n,e.length))}dataToResult(e,n){let o=this.computeProperties(e),s=[this.getId(),o.type,e.index].join("."),l=e.feature.properties[e.field],h="<br><small> "+e.layer.title+"</small>";return{source:this,data:{type:vr,projection:"EPSG:4326",geometry:e.feature.geometry,extent:e.feature.extent,properties:o,meta:{id:s,title:e.feature.properties[e.field],alias:this.getAllowedFieldsAndAlias(e.layer)}},meta:{dataType:vr,id:s,title:e.feature.meta.title,titleHtml:l+h,icon:"location_on",score:e.score,nextPage:n%+this.options.params.limit===0&&+this.options.params.page<10}}}getAllowedFieldsAndAlias(e){let n;return e.options?.source?.options?.sourceFields&&e.options.source.options.sourceFields.length>=1&&(n={},e.options.source.options.sourceFields.forEach(o=>{let s=o.alias?o.alias:o.name;n[o.name]=s})),n}computeProperties(e){if(!e.feature.geometry)return Object.assign({type:e.layer.title+"."+e.field},e.feature.properties);let n={GoogleMaps:""},o;if(e.feature.geometry.type==="Point")o=vc.getGoogleMapsCoordLink(e.feature.geometry.coordinates[0],e.feature.geometry.coordinates[1]);else{let l=Fb(e.feature.geometry);o=vc.getGoogleMapsCoordLink(l.geometry.coordinates[0],l.geometry.coordinates[1])}n.GoogleMaps="<a href="+o+' target="_blank">'+this.languageService.translate.instant("igo.geo.searchByCoord")+"</a>",e.feature.geometry.type==="Point"&&(n.GoogleStreetView=vc.getGoogleStreetViewLink(e.feature.geometry.coordinates[0],e.feature.geometry.coordinates[1]));let s={Route:'<span class="routing"> <u>'+this.languageService.translate.instant("igo.geo.seeRouting")+"</u> </span>"};return Object.assign({type:e.feature.sourceId},e.feature.properties,n,s)}static \u0275fac=function(n){return new(n||r)(pt(Di),pt(Kr),pt("options"))};static \u0275prov=qt({token:r,factory:r.\u0275fac})}return r})();function GFe(r,i,e){return new TB(r,i,e.getConfig(`searchSources.${TB.id}`))}function jFe(){return{provide:So,useFactory:GFe,multi:!0,deps:[Di,Kr,Oi]}}function ndi(){return{kind:gf.Workspace,providers:[jFe()]}}export{Wf as a,RLe as b,v9 as c,Sr as d,Zs as e,IP as f,uc as g,Ui as h,VU as i,zU as j,An as k,jn as l,cd as m,F0 as n,gi as o,Tr as p,Ii as q,on as r,Qr as s,an as t,hi as u,Bs as v,ui as w,oi as x,$a as y,kr as z,Jd as A,Ya as B,eh as C,qH as D,kc as E,fc as F,Fr as G,vr as H,Yi as I,vl as J,ku as K,Sb as L,By as M,eR as N,$fe as O,ih as P,is as Q,rs as R,t_ as S,Jq as T,eY as U,tY as V,iY as W,Fb as X,js as Y,bl as Z,Md as _,xl as $,Vp as aa,kE as ba,rl as ca,Id as da,nf as ea,oh as fa,Qo as ga,yc as ha,R6 as ia,Eve as ja,FT as ka,Nc as la,Za as ma,VN as na,tSe as oa,rSe as pa,qT as qa,sh as ra,aSe as sa,rJ as ta,nJ as ua,sSe as va,lSe as wa,LAt as xa,kAt as ya,sJ as za,cJ as Aa,dJ as Ba,hJ as Ca,vJ as Da,xJ as Ea,SSe as Fa,Bu as Ga,ZT as Ha,TJ as Ia,ISe as Ja,nl as Ka,uh as La,fC as Ma,FSe as Na,Gu as Oa,mu as Pa,Ed as Qa,c1 as Ra,$Ce as Sa,m8 as Ta,YCe as Ua,or as Va,u1 as Wa,vw as Xa,dIe as Ya,Kee as Za,YIe as _a,PC as $a,f3 as ab,g3 as bb,T5e as cb,DC as db,PEe as eb,eB as fb,OEe as gb,REe as hb,v3 as ib,b3 as jb,S3 as kb,wTe as lb,aB as mb,zzt as nb,ITe as ob,L3 as pb,O3 as qb,D3 as rb,Lte as sb,vc as tb,UYt as ub,L3e as vb,O3e as wb,B3e as xb,G3e as yb,Rte as zb,z3 as Ab,U3e as Bb,$3 as Cb,mQt as Db,fQt as Eb,kw as Fb,W3e as Gb,H3 as Hb,Dw as Ib,Hei as Jb,Y3e as Kb,Hti as Lb,CB as Mb,Yte as Nb,Ioi as Ob,RFe as Pb,Mai as Qb,zai as Rb,NPe as Sb,Tci as Tb,ndi as Ub};
//# sourceMappingURL=chunk-4UN2RPJE.js.map
